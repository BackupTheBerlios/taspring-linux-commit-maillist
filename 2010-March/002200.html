<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7430 - Lobby/TASClient
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2010-March/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7430%20-%20Lobby/TASClient&In-Reply-To=%3C20100315173030.C41142D36E%40it-l.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002199.html">
   <LINK REL="Next"  HREF="002201.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7430 - Lobby/TASClient</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7430%20-%20Lobby/TASClient&In-Reply-To=%3C20100315173030.C41142D36E%40it-l.eu%3E"
       TITLE="[Taspring-linux-commit] r7430 - Lobby/TASClient">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Mon Mar 15 18:30:30 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002199.html">[Taspring-linux-commit] r7429 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="002201.html">[Taspring-linux-commit] r7431 - in Lobby/TASClient: . Interface	Python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2200">[ date ]</a>
              <a href="thread.html#2200">[ thread ]</a>
              <a href="subject.html#2200">[ subject ]</a>
              <a href="author.html#2200">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2010-03-15 18:30:30 +0100 (Mon, 15 Mar 2010)
New Revision: 7430

Modified:
   Lobby/TASClient/AddBotUnit.dfm
   Lobby/TASClient/AddBotUnit.pas
   Lobby/TASClient/BattleFormUnit.pas
   Lobby/TASClient/DisableUnitsFormUnit.dfm
   Lobby/TASClient/DisableUnitsFormUnit.pas
   Lobby/TASClient/ExceptionUnit.dfm
   Lobby/TASClient/HttpGetUnit.dfm
   Lobby/TASClient/HttpGetUnit.pas
   Lobby/TASClient/MainUnit.dfm
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/MapListFormUnit.dfm
   Lobby/TASClient/MapListFormUnit.pas
   Lobby/TASClient/PreferencesFormUnit.pas
   Lobby/TASClient/ReplaysUnit.dfm
   Lobby/TASClient/ReplaysUnit.pas
   Lobby/TASClient/SpringDownloaderFormUnit.dfm
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.res
Log:
* more space for translations
* fixed a bug in the autoupdate when using a bad translation
* enabling the &quot;load unit icons and names&quot; when already hosting will load them instead of spamming errors
* map grades controls hidden
* minor bugs fixed

Modified: Lobby/TASClient/AddBotUnit.dfm
===================================================================
--- Lobby/TASClient/AddBotUnit.dfm	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/AddBotUnit.dfm	2010-03-15 17:30:30 UTC (rev 7430)
@@ -240,7 +240,7 @@
     end
   end
   object AIListPopupMenu: TSpTBXPopupMenu
-    OnInitPopup = AIListPopupMenuInitPopup
+    OnPopup = AIListPopupMenuPopup
     Left = 288
     Top = 184
     object mnuCopyItem: TSpTBXItem

Modified: Lobby/TASClient/AddBotUnit.pas
===================================================================
--- Lobby/TASClient/AddBotUnit.pas	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/AddBotUnit.pas	2010-03-15 17:30:30 UTC (rev 7430)
@@ -55,10 +55,9 @@
       Node: PVirtualNode; Column: TColumnIndex;
       var LineBreakStyle: TVTTooltipLineBreakStyle;
       var HintText: WideString);
-    procedure AIListPopupMenuInitPopup(Sender: TObject;
-      PopupView: TTBView);
     procedure mnuCopyItemClick(Sender: TObject);
     procedure mnuGotoUrlClick(Sender: TObject);
+    procedure AIListPopupMenuPopup(Sender: TObject);
   private
   public
     aiList: TList;
@@ -306,33 +305,32 @@
         end;
 end;
 
-procedure TAddBotForm.AIListPopupMenuInitPopup(Sender: TObject;
-  PopupView: TTBView);
+procedure TAddBotForm.mnuCopyItemClick(Sender: TObject);
 var
   celltxt: WideString;
   tt: TVSTTextType;
 begin
   VSTAIListGetText(VSTAIList,VSTAIList.GetFirstSelected,0,tt,celltxt);
-  mnuGotoUrl.Visible := Pos('<A HREF="http://">http://</A>',LowerCase(celltxt)) &gt; 0;
+  Clipboard.AsText := celltxt;
 end;
 
-procedure TAddBotForm.mnuCopyItemClick(Sender: TObject);
+procedure TAddBotForm.mnuGotoUrlClick(Sender: TObject);
 var
   celltxt: WideString;
   tt: TVSTTextType;
 begin
   VSTAIListGetText(VSTAIList,VSTAIList.GetFirstSelected,0,tt,celltxt);
-  Clipboard.AsText := celltxt;
+  celltxt := MidStr(celltxt,Pos('<A HREF="http://">http://</A>',LowerCase(celltxt)),900000);
+  Misc.OpenURLInDefaultBrowser(celltxt);
 end;
 
-procedure TAddBotForm.mnuGotoUrlClick(Sender: TObject);
+procedure TAddBotForm.AIListPopupMenuPopup(Sender: TObject);
 var
   celltxt: WideString;
   tt: TVSTTextType;
 begin
   VSTAIListGetText(VSTAIList,VSTAIList.GetFirstSelected,0,tt,celltxt);
-  celltxt := MidStr(celltxt,Pos('<A HREF="http://">http://</A>',LowerCase(celltxt)),900000);
-  Misc.OpenURLInDefaultBrowser(celltxt);
+  mnuGotoUrl.Visible := Pos('<A HREF="http://">http://</A>',LowerCase(celltxt)) &gt; 0;
 end;
 
 end.

Modified: Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- Lobby/TASClient/BattleFormUnit.pas	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/BattleFormUnit.pas	2010-03-15 17:30:30 UTC (rev 7430)
@@ -7352,7 +7352,7 @@
     case Column of
       0:
       begin
-        if (Preferences.DisplayUnitsIconsAndNames or (HostBattleForm.relayHoster &lt;&gt; nil)) and (TBitmap(UnitBitmaps[nodeIndex]).Width &gt; 0) then
+        if (Preferences.DisplayUnitsIconsAndNames or (HostBattleForm.relayHoster &lt;&gt; nil)) and (nodeIndex &lt; UnitBitmaps.Count) and (TBitmap(UnitBitmaps[nodeIndex]).Width &gt; 0) then
         begin
           availableWidth := R.Right-R.Left;
           availableHeight := R.Bottom-R.Top;

Modified: Lobby/TASClient/DisableUnitsFormUnit.dfm
===================================================================
--- Lobby/TASClient/DisableUnitsFormUnit.dfm	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/DisableUnitsFormUnit.dfm	2010-03-15 17:30:30 UTC (rev 7430)
@@ -29,22 +29,10 @@
     DesignSize = (
       592
       456)
-    object Label1: TSpTBXLabel
-      Left = 8
-      Top = 40
-      Width = 233
-      Height = 13
-      Caption = 'Note: put an X in front of units you wish to disable'
-      LinkFont.Charset = DEFAULT_CHARSET
-      LinkFont.Color = clBlue
-      LinkFont.Height = -11
-      LinkFont.Name = 'MS Sans Serif'
-      LinkFont.Style = [fsUnderline]
-    end
     object SpeedButton1: TSpTBXSpeedButton
-      Left = 512
+      Left = 472
       Top = 40
-      Width = 73
+      Width = 113
       Height = 22
       Caption = 'Clear all'
       Anchors = [akTop, akRight]
@@ -56,9 +44,9 @@
       LinkFont.Style = [fsUnderline]
     end
     object SpeedButton2: TSpTBXSpeedButton
-      Left = 336
+      Left = 232
       Top = 40
-      Width = 73
+      Width = 113
       Height = 22
       Caption = 'Save ...'
       Anchors = [akTop, akRight]
@@ -70,9 +58,9 @@
       LinkFont.Style = [fsUnderline]
     end
     object SpeedButton3: TSpTBXSpeedButton
-      Left = 424
+      Left = 352
       Top = 40
-      Width = 73
+      Width = 113
       Height = 22
       Caption = 'Open ...'
       Anchors = [akTop, akRight]
@@ -84,13 +72,13 @@
       LinkFont.Style = [fsUnderline]
     end
     object Button1: TSpTBXButton
-      Left = 368
+      Left = 288
       Top = 416
-      Width = 105
+      Width = 145
       Height = 25
       Caption = 'Close'
       Anchors = [akRight, akBottom]
-      TabOrder = 5
+      TabOrder = 4
       OnClick = Button1Click
       Cancel = True
       LinkFont.Charset = DEFAULT_CHARSET
@@ -117,7 +105,7 @@
       Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoShowSortGlyphs, hoVisible]
       Header.SortColumn = 2
       Header.Style = hsFlatButtons
-      TabOrder = 6
+      TabOrder = 5
       TreeOptions.AutoOptions = [toAutoDropExpand, toAutoScrollOnExpand, toAutoSort, toAutoTristateTracking, toAutoDeleteMovedNodes]
       TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning]
       TreeOptions.PaintOptions = [toHideFocusRect, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
@@ -150,13 +138,13 @@
         end&gt;
     end
     object Button2: TSpTBXButton
-      Left = 480
+      Left = 440
       Top = 416
-      Width = 105
+      Width = 145
       Height = 25
       Caption = 'Update selection'
       Anchors = [akRight, akBottom]
-      TabOrder = 7
+      TabOrder = 6
       OnClick = Button2Click
       LinkFont.Charset = DEFAULT_CHARSET
       LinkFont.Color = clBlue

Modified: Lobby/TASClient/DisableUnitsFormUnit.pas
===================================================================
--- Lobby/TASClient/DisableUnitsFormUnit.pas	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/DisableUnitsFormUnit.pas	2010-03-15 17:30:30 UTC (rev 7430)
@@ -18,7 +18,6 @@
 type
   TDisableUnitsForm = class(TForm)
     SpTBXTitleBar1: TSpTBXTitleBar;
-    Label1: TSpTBXLabel;
     SpeedButton1: TSpTBXSpeedButton;
     SpeedButton2: TSpTBXSpeedButton;
     SpeedButton3: TSpTBXSpeedButton;

Modified: Lobby/TASClient/ExceptionUnit.dfm
===================================================================
--- Lobby/TASClient/ExceptionUnit.dfm	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/ExceptionUnit.dfm	2010-03-15 17:30:30 UTC (rev 7430)
@@ -1,7 +1,7 @@
 object ExceptionDialog: TExceptionDialog
   Tag = 1
-  Left = 557
-  Top = 172
+  Left = 1353
+  Top = 181
   ActiveControl = OkBtn
   AutoScroll = False
   BorderIcons = [biSystemMenu]

Modified: Lobby/TASClient/HttpGetUnit.dfm
===================================================================
--- Lobby/TASClient/HttpGetUnit.dfm	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/HttpGetUnit.dfm	2010-03-15 17:30:30 UTC (rev 7430)
@@ -4,10 +4,10 @@
   BorderStyle = bsDialog
   Caption = 'File download 4'
   ClientHeight = 178
-  ClientWidth = 281
+  ClientWidth = 478
   Color = clBtnFace
-  Constraints.MaxHeight = 750
-  Constraints.MaxWidth = 1280
+  Constraints.MaxHeight = 1150
+  Constraints.MaxWidth = 1920
   Font.Charset = DEFAULT_CHARSET
   Font.Color = clWindowText
   Font.Height = -11
@@ -24,7 +24,7 @@
   object SpTBXTitleBar1: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 281
+    Width = 478
     Height = 178
     Caption = 'File download'
     FixedSize = True
@@ -32,9 +32,9 @@
     Options.Maximize = False
     TBXStyleBackground = True
     object CancelButton: TSpTBXSpeedButton
-      Left = 168
+      Left = 312
       Top = 104
-      Width = 97
+      Width = 153
       Height = 22
       Caption = 'Cancel download'
       Enabled = False
@@ -58,7 +58,7 @@
       LinkFont.Style = [fsUnderline]
     end
     object StatusLabel: TSpTBXLabel
-      Left = 56
+      Left = 112
       Top = 40
       Width = 6
       Height = 13
@@ -94,7 +94,7 @@
       LinkFont.Style = [fsUnderline]
     end
     object FileNameLabel: TSpTBXLabel
-      Left = 72
+      Left = 112
       Top = 56
       Width = 6
       Height = 13
@@ -106,9 +106,9 @@
       LinkFont.Style = [fsUnderline]
     end
     object CloseButton: TSpTBXButton
-      Left = 104
+      Left = 183
       Top = 144
-      Width = 75
+      Width = 112
       Height = 25
       Caption = 'Close'
       Enabled = False
@@ -124,7 +124,7 @@
     object ProgressBar: TSpTBXProgressBar
       Left = 16
       Top = 80
-      Width = 249
+      Width = 449
       Height = 17
       Caption = '0%'
       Font.Charset = DEFAULT_CHARSET
@@ -156,8 +156,8 @@
     OnDocBegin = HttpCli1DocBegin
     OnDocData = HttpCli1DocData
     SocksAuthentication = socksNoAuthentication
-    Left = 208
-    Top = 136
+    Left = 120
+    Top = 144
   end
   object SevenZip1: TSevenZip
     SFXCreate = False
@@ -171,7 +171,7 @@
     LPPMDsize = 0
     NumberOfFiles = -1
     VolumeSize = 0
-    Left = 112
-    Top = 40
+    Left = 288
+    Top = 32
   end
 end

Modified: Lobby/TASClient/HttpGetUnit.pas
===================================================================
--- Lobby/TASClient/HttpGetUnit.pas	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/HttpGetUnit.pas	2010-03-15 17:30:30 UTC (rev 7430)
@@ -165,7 +165,7 @@
     end
     else if (DownloadFile.ServerOptions and $4) = 4 then
     begin
-        StatusLabel.Caption := _('Download complete, extracting new files ...');
+        //StatusLabel.Caption := _('Download complete, extracting new files ...');
         ReceivedLabel.Visible := False;
         appExePath := Application.ExeName;
 
@@ -226,7 +226,6 @@
     else
       MessageDlg(_('Download complete!'), mtInformation, [mbOK], 0);
   end;
-
   Result := True;
 
 end;
@@ -252,7 +251,11 @@
   currentSize := HttpCli1.RcvdStream.Size;
   fileSize := HttpCli1.ContentLength;
 
-  ReceivedLabel.Caption := Format(_('Received %s KB (%d%%)'),[Misc.FormatFileSize(currentSize),Round(currentSize / fileSize * 100)]);
+  try
+    ReceivedLabel.Caption := Format(_('Received %s KB (%d%%)'),[Misc.FormatFileSize(currentSize),Round(currentSize / fileSize * 100)])
+  except
+    ReceivedLabel.Caption := Format('Received %s KB (%d%%)',[Misc.FormatFileSize(currentSize),Round(currentSize / fileSize * 100)])
+  end;
   if fileSize = 0 then
     ProgressBar.Position := 0
   else

Modified: Lobby/TASClient/MainUnit.dfm
===================================================================
--- Lobby/TASClient/MainUnit.dfm	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/MainUnit.dfm	2010-03-15 17:30:30 UTC (rev 7430)
@@ -1,6 +1,6 @@
 object MainForm: TMainForm
-  Left = 642
-  Top = 231
+  Left = 722
+  Top = 250
   Width = 847
   Height = 521
   Caption = '.'
@@ -627,7 +627,7 @@
                 object PresetListbox: TSpTBXListBox
                   Left = 152
                   Top = 26
-                  Width = 866
+                  Width = 657
                   Height = 113
                   Anchors = [akLeft, akTop, akRight]
                   ItemHeight = 16
@@ -1112,12 +1112,13 @@
               end
             end
             object EnableFilters: TSpTBXCheckBox
-              Left = 649
+              Left = 552
               Top = 154
-              Width = 110
+              Width = 263
               Height = 18
               Caption = 'Enable filters'
               Anchors = [akTop]
+              AutoSize = False
               Font.Charset = DEFAULT_CHARSET
               Font.Color = clWindowText
               Font.Height = -13
@@ -1126,6 +1127,7 @@
               ParentFont = False
               TabOrder = 1
               OnClick = EnableFiltersClick
+              Alignment = taRightJustify
             end
           end
           object FiltersButton: TSpTBXButton

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/MainUnit.pas	2010-03-15 17:30:30 UTC (rev 7430)
@@ -3758,7 +3758,10 @@
   TP_GlobalIgnoreClass (TWebBrowserWrapper);
   TP_GlobalIgnoreClass (TExRichEdit);
   TP_GlobalIgnoreClass (TRichEdit);
+  TP_GlobalIgnoreClass (THttpCli);
+
   TP_GlobalIgnoreClassProperty(TFont,'Name');
+  
   TP_Ignore (self,'.Caption');
   TP_Ignore (self,'MainTitleBar.Caption');
   //TP_Ignore (self,'SortLabel');
@@ -4696,10 +4699,22 @@
         BattleForm.AutoHostMsgsRichEdit.Clear;
         BattleState.AutoHost := True;
         BattleForm.AutoHostInfoPanel.Visible := True;
+        BattleForm.AutohostControlSplitter.Visible := BattleForm.AutoHostInfoPanel.Visible;
+        BattleForm.AutohostControlSplitter.Align := alBottom;
+        BattleForm.AutohostControlSplitter.Align := alTop;
+        BattleForm.AutoHostVotePanel.Align := alBottom;
+        BattleForm.AutoHostVotePanel.Align := alTop;
+        BattleForm.Refresh;
+        if tmpBool then
+        begin
+         BattleForm.ChatRichEdit.ScrollToTop;
+         BattleForm.ChatRichEdit.ScrollToBottom;
+        end;
       end;
     end
     else if (sl[0] = 'ISSPRINGIEAUTOHOST') and CameFromBattleScreen and (BattleState.Status = Joined) then
     begin
+      tmpBool := BattleForm.ChatRichEdit.atBottom;
       BattleState.AutoHostType := 1;
       BattleForm.AutoHostCommandsButton.DropDownMenu := BattleForm.SPRINGIEPopupMenu;
       BattleForm.AutoHostControlLabel.Caption := _('Autohost - ')+'Springie';
@@ -11063,7 +11078,7 @@
 procedure TMainForm.FilterGroupResize(Sender: TObject);
 begin
   FilterList.Width := FilterGroup.Width - 486;
-  EnableFilters.Left := FilterGroup.Width-174;
+  EnableFilters.Left := FilterGroup.Width-271;
 end;
 
 procedure TMainForm.ReplaysFilterClick(Sender: TObject);
@@ -12125,6 +12140,8 @@
         begin
             DownloadFile.URL := parsedHtml[1];
             DownloadFile.HeaderReceived := False;
+            if FileExists(ExtractFilePath(Application.ExeName)+'\_AutoUpdateTempFile.7z') then
+              DeleteFile(ExtractFilePath(Application.ExeName)+'\_AutoUpdateTempFile.7z');
             DownloadFile.FileName := '_AutoUpdateTempFile.7z';
             DownloadFile.ServerOptions := 4;
             PostMessage(HttpGetForm.Handle, WM_STARTDOWNLOAD, 0, 0);

Modified: Lobby/TASClient/MapListFormUnit.dfm
===================================================================
--- Lobby/TASClient/MapListFormUnit.dfm	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/MapListFormUnit.dfm	2010-03-15 17:30:30 UTC (rev 7430)
@@ -1,6 +1,6 @@
 object MapListForm: TMapListForm
-  Left = 522
-  Top = 175
+  Left = 694
+  Top = 216
   Width = 650
   Height = 400
   Caption = 'Map list'
@@ -35,8 +35,8 @@
       642
       65)
     object NoPreviewImage: TImage
-      Left = 456
-      Top = 0
+      Left = 432
+      Top = 48
       Width = 100
       Height = 100
       AutoSize = True
@@ -985,7 +985,7 @@
     end
     object TotalMapsLabel: TSpTBXLabel
       Left = 8
-      Top = 40
+      Top = 48
       Width = 64
       Height = 13
       Caption = 'Total maps: ?'
@@ -996,10 +996,10 @@
       LinkFont.Style = [fsUnderline]
     end
     object CloseButton: TSpTBXButton
-      Left = 558
+      Left = 528
       Top = 8
-      Width = 75
-      Height = 25
+      Width = 105
+      Height = 21
       Caption = 'Close'
       Anchors = [akTop, akRight]
       TabOrder = 1
@@ -1013,12 +1013,13 @@
       LinkFont.Style = [fsUnderline]
     end
     object SyncButton: TSpTBXButton
-      Left = 8
+      Left = 200
       Top = 8
       Width = 121
       Height = 25
       Caption = 'Synchronize grades'
       TabOrder = 2
+      Visible = False
       OnClick = SyncButtonClick
       DropDownArrow = False
       LinkFont.Charset = DEFAULT_CHARSET
@@ -1028,11 +1029,12 @@
       LinkFont.Style = [fsUnderline]
     end
     object SpTBXSpeedButton1: TSpTBXSpeedButton
-      Left = 128
+      Left = 320
       Top = 8
       Width = 23
       Height = 25
       Caption = '?'
+      Visible = False
       OnClick = SpTBXSpeedButton1Click
       DropDownArrow = False
       LinkFont.Charset = DEFAULT_CHARSET
@@ -1042,11 +1044,13 @@
       LinkFont.Style = [fsUnderline]
     end
     object SpTBXLabel1: TSpTBXLabel
-      Left = 184
-      Top = 40
-      Width = 33
+      Left = 8
+      Top = 24
+      Width = 137
       Height = 13
       Caption = 'Status:'
+      AutoSize = False
+      Alignment = taRightJustify
       LinkFont.Charset = DEFAULT_CHARSET
       LinkFont.Color = clBlue
       LinkFont.Height = -11
@@ -1054,8 +1058,8 @@
       LinkFont.Style = [fsUnderline]
     end
     object StatusLabel: TSpTBXLabel
-      Left = 224
-      Top = 40
+      Left = 152
+      Top = 24
       Width = 29
       Height = 13
       Caption = 'ready.'
@@ -1066,11 +1070,13 @@
       LinkFont.Style = [fsUnderline]
     end
     object SpTBXLabel2: TSpTBXLabel
-      Left = 184
-      Top = 16
-      Width = 82
+      Left = 8
+      Top = 8
+      Width = 137
       Height = 13
       Caption = 'Map sorting style:'
+      AutoSize = False
+      Alignment = taRightJustify
       LinkFont.Charset = DEFAULT_CHARSET
       LinkFont.Color = clBlue
       LinkFont.Height = -11
@@ -1078,8 +1084,8 @@
       LinkFont.Style = [fsUnderline]
     end
     object SortLabel: TSpTBXLabel
-      Left = 272
-      Top = 16
+      Left = 152
+      Top = 8
       Width = 42
       Height = 13
       Cursor = crHandPoint
@@ -1098,13 +1104,14 @@
       LinkFont.Style = [fsUnderline]
     end
     object SpTBXLabel3: TSpTBXLabel
-      Left = 500
+      Left = 352
       Top = 40
-      Width = 129
+      Width = 277
       Height = 13
       Cursor = crHandPoint
       Caption = 'Load missing minimaps'
       Anchors = [akTop, akRight]
+      AutoSize = False
       Font.Charset = DEFAULT_CHARSET
       Font.Color = clBlue
       Font.Height = -11
@@ -1112,6 +1119,7 @@
       Font.Style = [fsBold, fsUnderline]
       ParentFont = False
       OnClick = SpTBXLabel3Click
+      Alignment = taRightJustify
       LinkFont.Charset = DEFAULT_CHARSET
       LinkFont.Color = clBlue
       LinkFont.Height = -11
@@ -1119,9 +1127,9 @@
       LinkFont.Style = [fsUnderline]
     end
     object txtSearch: TEdit
-      Left = 340
-      Top = 32
-      Width = 113
+      Left = 416
+      Top = 8
+      Width = 101
       Height = 21
       Anchors = [akTop, akRight]
       TabOrder = 10
@@ -1129,12 +1137,14 @@
       OnKeyUp = txtSearchKeyUp
     end
     object lblSearch: TSpTBXLabel
-      Left = 340
-      Top = 16
-      Width = 40
+      Left = 320
+      Top = 12
+      Width = 89
       Height = 13
       Caption = 'Search :'
       Anchors = [akTop, akRight]
+      AutoSize = False
+      Alignment = taRightJustify
       LinkFont.Charset = DEFAULT_CHARSET
       LinkFont.Color = clBlue
       LinkFont.Height = -11
@@ -1164,8 +1174,9 @@
     TabOrder = 1
   end
   object ChooseGradePopupMenu: TSpTBXPopupMenu
-    Left = 368
-    Top = 4
+    AutoHotkeys = maManual
+    Left = 384
+    Top = 52
     object RemoveGradeItem: TSpTBXItem
       Caption = 'Remove grade'
     end
@@ -1189,10 +1200,12 @@
     Enabled = False
     Interval = 100
     OnTimer = SyncTimeoutTimerTimer
-    Left = 416
+    Left = 472
+    Top = 32
   end
   object SortStylePopupMenu: TSpTBXPopupMenu
-    Left = 288
-    Top = 32
+    AutoHotkeys = maManual
+    Left = 264
+    Top = 24
   end
 end

Modified: Lobby/TASClient/MapListFormUnit.pas
===================================================================
--- Lobby/TASClient/MapListFormUnit.pas	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/MapListFormUnit.pas	2010-03-15 17:30:30 UTC (rev 7430)
@@ -9,7 +9,7 @@
   JvExComCtrls, JvComCtrls, Utility,Misc, TntForms,Math,MainUnit;
 
 const
-  MAP_ITEM_WIDTH = 415;
+  MAP_ITEM_WIDTH = 355;
   MAP_ITEM_HEIGHT = 125;
 
 type
@@ -304,6 +304,7 @@
   GradeButton.OnClick := GradeButtonClick;
   GradeButton.Enabled := False; // user is not allow to grade map before map info is loaded
   GradeButton.Parent := MainPanel;
+  GradeButton.Visible := False;
 
   PublicGradeInfoLabel := TLabel.Create(MainPanel);
   PublicGradeInfoLabel.Caption := _('Global grade:');
@@ -313,6 +314,7 @@
   PublicGradeInfoLabel.OnMouseUp := LabelMouseUp;
   PublicGradeInfoLabel.Parent := MainPanel;
   PublicGradeInfoLabel.ParentColor := true;
+  PublicGradeInfoLabel.Visible := False;
 
   PublicGradeLabel := TLabel.Create(MainPanel);
   PublicGradeLabel.Caption := _('? (? votes)');
@@ -322,11 +324,12 @@
   PublicGradeLabel.OnMouseUp := LabelMouseUp;
   PublicGradeLabel.Parent := MainPanel;
   PublicGradeLabel.ParentColor := true;
+  PublicGradeLabel.Visible := False;
 
   TabControl := TSpTBXTabControl.Create(MainPanel);
-  TabControl.Left := 200;
+  TabControl.Left := 120;
   TabControl.Top := 20;
-  TabControl.Width := 205;
+  TabControl.Width := 225;
   TabControl.Height := 95;
   TabControl.TabAutofit := True;
   TabControl.Parent := MainPanel;
@@ -389,7 +392,7 @@
   with ExtRadiusLabel do
   begin
     Caption := _('Extractor radius: ?');
-    Left := 100;
+    Left := 110;
     Top := 2;
     OnMouseDown := LabelPanelMouseDown;
     OnMouseUp := LabelPanelMouseUp;
@@ -401,7 +404,7 @@
   with MinWindLabel do
   begin
     Caption := _('Min. wind: ?');
-    Left := 100;
+    Left := 110;
     Top := 17;
     OnMouseDown := LabelPanelMouseDown;
     OnMouseUp := LabelPanelMouseUp;
@@ -413,7 +416,7 @@
   with MaxWindLabel do
   begin
     Caption := _('Max. wind: ?');
-    Left := 100;
+    Left := 110;
     Top := 32;
     OnMouseDown := LabelPanelMouseDown;
     OnMouseUp := LabelPanelMouseUp;

Modified: Lobby/TASClient/PreferencesFormUnit.pas
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.pas	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/PreferencesFormUnit.pas	2010-03-15 17:30:30 UTC (rev 7430)
@@ -353,7 +353,8 @@
   ManageGroups, ReplaysUnit, PythonScriptDebugFormUnit, LobbyScriptUnit,
   SpringDownloaderFormUnit, LogonFormUnit, TipsFormUnit,
   TemplateEditorFormUnit, SpringSettingsProfileFormUnit, gnugettext,
-  AutoTeamsUnit, ChannelsListFormUnit, AutoJoinFormUnit;
+  AutoTeamsUnit, ChannelsListFormUnit, AutoJoinFormUnit, InitWaitFormUnit,
+  DisableUnitsFormUnit;
 
 {$R *.dfm}
 
@@ -1195,6 +1196,16 @@
         StartSpringDownloader
       else
         CloseSpringDownloader;
+
+    if not oldPref.DisplayUnitsIconsAndNames and Preferences.DisplayUnitsIconsAndNames and (BattleState.Status = Hosting) then
+    begin
+      // now let's update units:
+      InitWaitForm.ChangeCaption(MSG_GETUNITS);
+      InitWaitForm.TakeAction := 1; // load unit lists
+      InitWaitForm.ShowModal; // this loads unit lists (see OnFormActivate event)
+      DisableUnitsForm.PopulateUnitList;
+    end;
+
     AcquireMainThread;
     try if not Preferences.ScriptsDisabled then handlers.onSettingsChanged(); except end;
     ReleaseMainThread;

Modified: Lobby/TASClient/ReplaysUnit.dfm
===================================================================
--- Lobby/TASClient/ReplaysUnit.dfm	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/ReplaysUnit.dfm	2010-03-15 17:30:30 UTC (rev 7430)
@@ -168,20 +168,20 @@
           '10 - A must-see')
       end
       object PageControl1: TSpTBXTabControl
-        Left = 136
+        Left = 160
         Top = 0
-        Width = 635
+        Width = 611
         Height = 193
         Anchors = [akLeft, akTop, akRight, akBottom]
         Color = clBtnFace
-        ActiveTabIndex = 0
+        ActiveTabIndex = 1
         HiddenItems = &lt;&gt;
         object PlayersTab: TSpTBXTabItem
           Caption = 'Players'
-          Checked = True
         end
         object SpTBXTabItem3: TSpTBXTabItem
           Caption = 'Game settings'
+          Checked = True
         end
         object CommentsTab: TSpTBXTabItem
           Caption = 'Comments'
@@ -192,7 +192,7 @@
         object SpTBXTabSheet2: TSpTBXTabSheet
           Left = 0
           Top = 23
-          Width = 635
+          Width = 611
           Height = 170
           Caption = 'Comments'
           ImageIndex = -1
@@ -202,7 +202,7 @@
           object CommentsRichEdit: TRichEdit
             Left = 2
             Top = 0
-            Width = 631
+            Width = 607
             Height = 168
             Align = alClient
             ScrollBars = ssBoth
@@ -214,7 +214,7 @@
         object SpTBXTabSheet1: TSpTBXTabSheet
           Left = 0
           Top = 23
-          Width = 635
+          Width = 611
           Height = 170
           Caption = 'Script'
           ImageIndex = -1
@@ -224,7 +224,7 @@
           object ScriptRichEdit: TRichEdit
             Left = 2
             Top = 0
-            Width = 631
+            Width = 607
             Height = 168
             Align = alClient
             ReadOnly = True
@@ -233,17 +233,98 @@
             WordWrap = False
           end
         end
+        object SpTBXTabSheet3: TSpTBXTabSheet
+          Left = 0
+          Top = 23
+          Width = 611
+          Height = 170
+          Caption = 'Players'
+          ImageIndex = -1
+          Item = PlayersTab
+          TabControl = PageControl1
+          TabItem = 'PlayersTab'
+          object VDTPlayers: TVirtualDrawTree
+            Left = 2
+            Top = 0
+            Width = 607
+            Height = 168
+            Align = alClient
+            Header.AutoSizeIndex = 7
+            Header.DefaultHeight = 17
+            Header.Font.Charset = DEFAULT_CHARSET
+            Header.Font.Color = clWindowText
+            Header.Font.Height = -11
+            Header.Font.Name = 'MS Sans Serif'
+            Header.Font.Style = []
+            Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoShowHint, hoShowSortGlyphs, hoVisible]
+            Header.SortColumn = 2
+            Header.Style = hsFlatButtons
+            ParentShowHint = False
+            ShowHint = True
+            TabOrder = 0
+            TreeOptions.AutoOptions = [toAutoDropExpand, toAutoScrollOnExpand, toAutoSort, toAutoTristateTracking, toAutoDeleteMovedNodes]
+            TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning]
+            TreeOptions.PaintOptions = [toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
+            TreeOptions.SelectionOptions = [toFullRowSelect]
+            OnCompareNodes = VDTPlayersCompareNodes
+            OnDrawNode = VDTPlayersDrawNode
+            OnHeaderClick = VDTPlayersHeaderClick
+            Columns = &lt;
+              item
+                Position = 0
+                Width = 200
+                WideText = 'Player'
+              end
+              item
+                Position = 1
+                WideText = 'Id'
+              end
+              item
+                Position = 2
+                Width = 60
+                WideText = 'Team'
+              end
+              item
+                Position = 3
+                Width = 60
+                WideText = 'MP/M'
+                WideHint = 'Mouse movement in pixel per minute'
+              end
+              item
+                Position = 4
+                WideText = 'MC/M'
+                WideHint = 'Mouse clicks per minute'
+              end
+              item
+                Position = 5
+                WideText = 'KP/M'
+                WideHint = 'Keyboard presses per minute'
+              end
+              item
+                Position = 6
+                Width = 60
+                WideText = 'Cmds/M'
+                WideHint = 'Commands per minute'
+              end
+              item
+                Position = 7
+                Width = 73
+                WideText = 'ACS'
+                WideHint = 'Averange commands size (units affected per command)'
+              end&gt;
+          end
+        end
         object SpTBXTabSheet4: TSpTBXTabSheet
           Left = 0
           Top = 23
-          Width = 635
+          Width = 611
           Height = 170
           Caption = 'Game settings'
           ImageIndex = -1
           Item = SpTBXTabItem3
           TabControl = PageControl1
           DesignSize = (
-            635
+            611
             170)
           TabItem = 'SpTBXTabItem3'
           object frmGameOptions: TSpTBXGroupBox
@@ -316,7 +397,7 @@
               LinkFont.Style = [fsUnderline]
             end
             object chkLimiteDGun: TSpTBXCheckBox
-              Left = 176
+              Left = 264
               Top = 96
               Width = 14
               Height = 15
@@ -325,7 +406,7 @@
               AllowGrayed = True
             end
             object chkGhosted: TSpTBXCheckBox
-              Left = 176
+              Left = 264
               Top = 112
               Width = 14
               Height = 15
@@ -334,7 +415,7 @@
               AllowGrayed = True
             end
             object chkDiminishing: TSpTBXCheckBox
-              Left = 176
+              Left = 264
               Top = 128
               Width = 14
               Height = 15
@@ -404,7 +485,7 @@
           object SpTBXGroupBox1: TSpTBXGroupBox
             Left = 472
             Top = 8
-            Width = 151
+            Width = 127
             Height = 153
             Caption = 'Map/Mod options'
             Anchors = [akLeft, akTop, akRight, akBottom]
@@ -412,7 +493,7 @@
             object lstLuaOptions: TSpTBXListBox
               Left = 3
               Top = 16
-              Width = 145
+              Width = 121
               Height = 134
               Align = alClient
               BorderStyle = bsNone
@@ -422,87 +503,6 @@
             end
           end
         end
-        object SpTBXTabSheet3: TSpTBXTabSheet
-          Left = 0
-          Top = 23
-          Width = 635
-          Height = 170
-          Caption = 'Players'
-          ImageIndex = -1
-          Item = PlayersTab
-          TabControl = PageControl1
-          TabItem = 'PlayersTab'
-          object VDTPlayers: TVirtualDrawTree
-            Left = 2
-            Top = 0
-            Width = 631
-            Height = 168
-            Align = alClient
-            Header.AutoSizeIndex = 7
-            Header.DefaultHeight = 17
-            Header.Font.Charset = DEFAULT_CHARSET
-            Header.Font.Color = clWindowText
-            Header.Font.Height = -11
-            Header.Font.Name = 'MS Sans Serif'
-            Header.Font.Style = []
-            Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoShowHint, hoShowSortGlyphs, hoVisible]
-            Header.SortColumn = 2
-            Header.Style = hsFlatButtons
-            ParentShowHint = False
-            ShowHint = True
-            TabOrder = 0
-            TreeOptions.AutoOptions = [toAutoDropExpand, toAutoScrollOnExpand, toAutoSort, toAutoTristateTracking, toAutoDeleteMovedNodes]
-            TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning]
-            TreeOptions.PaintOptions = [toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
-            TreeOptions.SelectionOptions = [toFullRowSelect]
-            OnCompareNodes = VDTPlayersCompareNodes
-            OnDrawNode = VDTPlayersDrawNode
-            OnHeaderClick = VDTPlayersHeaderClick
-            Columns = &lt;
-              item
-                Position = 0
-                Width = 200
-                WideText = 'Player'
-              end
-              item
-                Position = 1
-                WideText = 'Id'
-              end
-              item
-                Position = 2
-                Width = 60
-                WideText = 'Team'
-              end
-              item
-                Position = 3
-                Width = 60
-                WideText = 'MP/M'
-                WideHint = 'Mouse movement in pixel per minute'
-              end
-              item
-                Position = 4
-                WideText = 'MC/M'
-                WideHint = 'Mouse clicks per minute'
-              end
-              item
-                Position = 5
-                WideText = 'KP/M'
-                WideHint = 'Keyboard presses per minute'
-              end
-              item
-                Position = 6
-                Width = 60
-                WideText = 'Cmds/M'
-                WideHint = 'Commands per minute'
-              end
-              item
-                Position = 7
-                Width = 97
-                WideText = 'ACS'
-                WideHint = 'Averange commands size (units affected per command)'
-              end&gt;
-          end
-        end
       end
       object HostReplayButton: TSpTBXButton
         Left = 536
@@ -554,7 +554,7 @@
       object DownloadButton: TSpTBXButton
         Left = 0
         Top = 150
-        Width = 129
+        Width = 153
         Height = 22
         Caption = 'Dowload replays'
         TabOrder = 6
@@ -568,7 +568,7 @@
       object UploadButton: TSpTBXButton
         Left = 0
         Top = 126
-        Width = 129
+        Width = 153
         Height = 22
         Caption = 'Upload'
         Enabled = False
@@ -583,7 +583,7 @@
       object SaveButton: TSpTBXSpeedButton
         Left = 0
         Top = 51
-        Width = 129
+        Width = 153
         Height = 22
         Caption = 'Save'
         Enabled = False
@@ -597,7 +597,7 @@
       object RenameButton: TSpTBXSpeedButton
         Left = 0
         Top = 27
-        Width = 129
+        Width = 153
         Height = 22
         Caption = 'Rename'
         Enabled = False
@@ -611,7 +611,7 @@
       object DeleteButton: TSpTBXSpeedButton
         Left = 0
         Top = 75
-        Width = 129
+        Width = 153
         Height = 22
         Caption = 'Delete'
         Enabled = False
@@ -625,7 +625,7 @@
       object ReloadButton: TSpTBXSpeedButton
         Left = 0
         Top = 3
-        Width = 129
+        Width = 153
         Height = 22
         Caption = 'Refresh list'
         Enabled = False
@@ -639,7 +639,7 @@
       object DeleteAllVisibleButton: TSpTBXButton
         Left = 0
         Top = 99
-        Width = 129
+        Width = 153
         Height = 25
         Caption = 'Delete all visible'
         TabOrder = 12
@@ -1374,12 +1374,13 @@
         end
       end
       object chkEnableFilters: TSpTBXCheckBox
-        Left = 613
+        Left = 496
         Top = 2
-        Width = 110
+        Width = 275
         Height = 18
         Caption = 'Enable filters'
         Anchors = [akTop, akRight]
+        AutoSize = False
         Font.Charset = DEFAULT_CHARSET
         Font.Color = clWindowText
         Font.Height = -13
@@ -1388,13 +1389,14 @@
         ParentFont = False
         TabOrder = 2
         OnClick = chkEnableFiltersClick
+        Alignment = taRightJustify
       end
     end
     object LoadingPanel: TSpTBXPanel
-      Left = 176
-      Top = 286
-      Width = 214
-      Height = 34
+      Left = 288
+      Top = 246
+      Width = 129
+      Height = 99
       Anchors = [akLeft, akTop, akRight, akBottom]
       Color = clNone
       Font.Charset = DEFAULT_CHARSET
@@ -1407,12 +1409,18 @@
       TabOrder = 2
       OnResize = LoadingPanelResize
       TBXStyleBackground = True
+      DesignSize = (
+        129
+        99)
       object LoadingLabel: TSpTBXLabel
         Left = 2
-        Top = 2
-        Width = 262
+        Top = 50
+        Width = 127
         Height = 20
         Caption = 'Please wait while building replay list ...'
+        Anchors = [akLeft, akTop, akRight]
+        AutoSize = False
+        Alignment = taCenter
         LinkFont.Charset = DEFAULT_CHARSET
         LinkFont.Color = clBlue
         LinkFont.Height = -11

Modified: Lobby/TASClient/ReplaysUnit.pas
===================================================================
--- Lobby/TASClient/ReplaysUnit.pas	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/ReplaysUnit.pas	2010-03-15 17:30:30 UTC (rev 7430)
@@ -1202,7 +1202,6 @@
 
 procedure TReplaysForm.LoadingPanelResize(Sender: TObject);
 begin
-  LoadingLabel.Left := LoadingPanel.Width div 2 - LoadingLabel.Width div 2;
   LoadingLabel.Top := LoadingPanel.Height div 2 - LoadingLabel.Height div 2;
 end;
 

Modified: Lobby/TASClient/SpringDownloaderFormUnit.dfm
===================================================================
--- Lobby/TASClient/SpringDownloaderFormUnit.dfm	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/SpringDownloaderFormUnit.dfm	2010-03-15 17:30:30 UTC (rev 7430)
@@ -6,8 +6,8 @@
   ClientHeight = 174
   ClientWidth = 455
   Color = clBtnFace
-  Constraints.MaxHeight = 1000
-  Constraints.MaxWidth = 1680
+  Constraints.MaxHeight = 1150
+  Constraints.MaxWidth = 1920
   Font.Charset = DEFAULT_CHARSET
   Font.Color = clWindowText
   Font.Height = -11
@@ -48,9 +48,9 @@
       Smooth = True
     end
     object CancelButton: TSpTBXButton
-      Left = 352
+      Left = 336
       Top = 136
-      Width = 89
+      Width = 105
       Height = 25
       Caption = 'Cancel'
       Anchors = [akTop, akRight]
@@ -100,9 +100,9 @@
       LinkFont.Style = [fsUnderline]
     end
     object DetailsButton: TSpTBXButton
-      Left = 352
+      Left = 336
       Top = 96
-      Width = 89
+      Width = 105
       Height = 33
       Caption = 'Show details'
       Anchors = [akTop, akRight]

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2010-03-12 15:37:29 UTC (rev 7429)
+++ Lobby/TASClient/TASClient.dof	2010-03-15 17:30:30 UTC (rev 7430)
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=69
 Release=0
-Build=825
+Build=828
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=Spring RTS Engine lobby client
-FileVersion=0.69.0.825
+FileVersion=0.69.0.828
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002199.html">[Taspring-linux-commit] r7429 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="002201.html">[Taspring-linux-commit] r7431 - in Lobby/TASClient: . Interface	Python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2200">[ date ]</a>
              <a href="thread.html#2200">[ thread ]</a>
              <a href="subject.html#2200">[ subject ]</a>
              <a href="author.html#2200">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
