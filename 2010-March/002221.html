<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7451 - Lobby/TASClient
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2010-March/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7451%20-%20Lobby/TASClient&In-Reply-To=%3C20100330184837.A7FFE29CD4%40it-l.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002220.html">
   <LINK REL="Next"  HREF="002222.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7451 - Lobby/TASClient</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7451%20-%20Lobby/TASClient&In-Reply-To=%3C20100330184837.A7FFE29CD4%40it-l.eu%3E"
       TITLE="[Taspring-linux-commit] r7451 - Lobby/TASClient">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Tue Mar 30 20:48:37 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002220.html">[Taspring-linux-commit] r7450 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="002222.html">[Taspring-linux-commit] r7452 - in Lobby/TASClient: .	LobbyComponents/DockPanel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2221">[ date ]</a>
              <a href="thread.html#2221">[ thread ]</a>
              <a href="subject.html#2221">[ subject ]</a>
              <a href="author.html#2221">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2010-03-30 20:48:36 +0200 (Tue, 30 Mar 2010)
New Revision: 7451

Modified:
   Lobby/TASClient/AddBotUnit.dfm
   Lobby/TASClient/AddBotUnit.pas
   Lobby/TASClient/AwayMessageFormUnit.dfm
   Lobby/TASClient/AwayMessageFormUnit.pas
   Lobby/TASClient/BattleFormUnit.dfm
   Lobby/TASClient/BattleFormUnit.pas
   Lobby/TASClient/DisableUnitsFormUnit.dfm
   Lobby/TASClient/DisableUnitsFormUnit.pas
   Lobby/TASClient/HostBattleFormUnit.dfm
   Lobby/TASClient/HostBattleFormUnit.pas
   Lobby/TASClient/MainUnit.dfm
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/Minimap3DPreviewUnit.dfm
   Lobby/TASClient/Minimap3DPreviewUnit.pas
   Lobby/TASClient/PreferencesFormUnit.dfm
   Lobby/TASClient/PreferencesFormUnit.pas
   Lobby/TASClient/ReplaysUnit.dfm
   Lobby/TASClient/ReplaysUnit.pas
   Lobby/TASClient/TASClient.dpr
Log:
* switch to latest sptbx part 12

Modified: Lobby/TASClient/AddBotUnit.dfm
===================================================================
--- Lobby/TASClient/AddBotUnit.dfm	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/AddBotUnit.dfm	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1,6 +1,6 @@
 object AddBotForm: TAddBotForm
-  Left = 527
-  Top = 153
+  Left = 1347
+  Top = 184
   BorderStyle = bsDialog
   Caption = 'Add bot dialog'
   ClientHeight = 482
@@ -154,6 +154,7 @@
       Height = 21
       Caption = 'Team color'
       Anchors = [akLeft, akBottom]
+      DropDownMenu = ColorPopupMenu
       Images = MainForm.ColorImageList
     end
     object AddBotButton: TSpTBXButton
@@ -193,4 +194,25 @@
       OnClick = mnuGotoUrlClick
     end
   end
+  object ColorPopupMenu: TSpTBXPopupMenu
+    AutoHotkeys = maManual
+    Left = 168
+    Top = 440
+    object mnuTeamColorPalette: TSpTBXColorPalette
+      CustomColors = True
+      ColCount = 5
+      RowCount = 4
+      OnCellClick = mnuTeamColorPaletteCellClick
+      OnGetColor = mnuTeamColorPaletteGetColor
+    end
+    object mnuTeamColorCustomize: TSpTBXItem
+      Caption = 'Customize ...'
+      OnClick = mnuTeamColorCustomizeClick
+    end
+    object SpTBXSeparatorItem1: TSpTBXSeparatorItem
+    end
+    object mnuTeamColorCancel: TSpTBXItem
+      Caption = 'Cancel'
+    end
+  end
 end

Modified: Lobby/TASClient/AddBotUnit.pas
===================================================================
--- Lobby/TASClient/AddBotUnit.pas	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/AddBotUnit.pas	2010-03-30 18:48:36 UTC (rev 7451)
@@ -35,8 +35,12 @@
     AIListPopupMenu: TSpTBXPopupMenu;
     mnuCopyItem: TSpTBXItem;
     mnuGotoUrl: TSpTBXItem;
+    ColorPopupMenu: TSpTBXPopupMenu;
+    mnuTeamColorPalette: TSpTBXColorPalette;
+    mnuTeamColorCustomize: TSpTBXItem;
+    SpTBXSeparatorItem1: TSpTBXSeparatorItem;
+    mnuTeamColorCancel: TSpTBXItem;
 
-    procedure ChangeTeamColor(ColorIndex: Integer);
     procedure ChangeSide(SideIndex: Integer);
 
     procedure ReloadButtonClick(Sender: TObject);
@@ -61,6 +65,11 @@
     procedure VSTAIListHeaderDraw(Sender: TVTHeader; HeaderCanvas: TCanvas;
       Column: TVirtualTreeColumn; R: TRect; Hover, Pressed: Boolean;
       DropMark: TVTDropMarkMode);
+    procedure mnuTeamColorCustomizeClick(Sender: TObject);
+    procedure mnuTeamColorPaletteCellClick(Sender: TObject; ACol,
+      ARow: Integer; var Allow: Boolean);
+    procedure mnuTeamColorPaletteGetColor(Sender: TObject; ACol,
+      ARow: Integer; var Color: TColor; var Name: WideString);
   private
   public
     aiList: TList;
@@ -69,6 +78,7 @@
 
 var
   AddBotForm: TAddBotForm;
+  BotColor: TColor;
 
 implementation
 
@@ -76,9 +86,6 @@
   MainUnit, Misc, BattleFormUnit, PreferencesFormUnit, Utility, gnugettext,
   StrUtils;
 
-var
-  BotColorIndex: Integer;
-
 {$R *.dfm}
 
 procedure TAddBotForm.ReloadButtonClick(Sender: TObject);
@@ -138,7 +145,6 @@
 begin
   TranslateComponent(self);
 
-  ChangeTeamColor(0);
   BotSideButton.Images := Utility.SideImageList;
   BotAllyButton.SpinOptions.MaxValue := MAX_TEAMS;
   BotTeamButton.SpinOptions.MaxValue := MAX_TEAMS;
@@ -171,18 +177,11 @@
   BattleStatus := Bot.BattleStatus;
   Bot.Free;
 
-  MainForm.TryToSendCommand('ADDBOT', BotNameEdit.Text + ' ' + IntToStr(BattleStatus) + ' ' + IntToStr(TeamColors[BotColorIndex]) + ' ' + getSelectedAI.values[getSelectedAI.keys.IndexOf('shortname')]);
+  MainForm.TryToSendCommand('ADDBOT', BotNameEdit.Text + ' ' + IntToStr(BattleStatus) + ' ' + IntToStr(BotColor) + ' ' + getSelectedAI.values[getSelectedAI.keys.IndexOf('shortname')]);
 
   Close;
 end;
 
-procedure TAddBotForm.ChangeTeamColor(ColorIndex: Integer);
-begin
-  BotColorIndex := ColorIndex;
-
-  BotTeamColorButton.ImageIndex := Length(TeamColors) + ColorIndex; // draw squares rather than circles
-end;
-
 procedure TAddBotForm.ChangeSide(SideIndex: Integer);
 begin
   BotSideButton.Caption := SideList[SideIndex];
@@ -233,6 +232,7 @@
 procedure TAddBotForm.FormShow(Sender: TObject);
 begin
   ReloadButton.OnClick(nil);
+  BotTeamColorButton.ImageIndex := Length(TeamColors)*2;
 end;
 
 procedure TAddBotForm.VSTAIListGetText(Sender: TBaseVirtualTree;
@@ -343,4 +343,23 @@
   MainForm.VDTBattlesHeaderDraw(Sender,HeaderCanvas,Column,R,Hover,Pressed,DropMark);
 end;
 
+procedure TAddBotForm.mnuTeamColorCustomizeClick(Sender: TObject);
+begin
+  BotColor := Misc.InputColor('Bot color',BotColor);
+  MainForm.UpdateColorImageList;
+end;
+
+procedure TAddBotForm.mnuTeamColorPaletteCellClick(Sender: TObject; ACol,
+  ARow: Integer; var Allow: Boolean);
+begin
+  BotColor := TeamColors[ARow*5+ACol];
+  MainForm.UpdateColorImageList;  
+end;
+
+procedure TAddBotForm.mnuTeamColorPaletteGetColor(Sender: TObject; ACol,
+  ARow: Integer; var Color: TColor; var Name: WideString);
+begin
+  Color := TeamColors[ARow*5+ACol];
+end;
+
 end.

Modified: Lobby/TASClient/AwayMessageFormUnit.dfm
===================================================================
--- Lobby/TASClient/AwayMessageFormUnit.dfm	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/AwayMessageFormUnit.dfm	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1,7 +1,8 @@
 object AwayMessageForm: TAwayMessageForm
   Left = 566
   Top = 224
-  BorderStyle = bsDialog
+  BorderIcons = [biSystemMenu]
+  BorderStyle = bsSingle
   Caption = 'AwayMessageForm'
   ClientHeight = 198
   ClientWidth = 452
@@ -15,6 +16,7 @@
   Font.Style = []
   OldCreateOrder = False
   Position = poMainFormCenter
+  Scaled = False
   OnCreate = FormCreate
   PixelsPerInch = 96
   TextHeight = 13

Modified: Lobby/TASClient/AwayMessageFormUnit.pas
===================================================================
--- Lobby/TASClient/AwayMessageFormUnit.pas	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/AwayMessageFormUnit.pas	2010-03-30 18:48:36 UTC (rev 7451)
@@ -4,7 +4,7 @@
 
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
-  Dialogs, SpTBXControls, StdCtrls, SpTBXEditors, SpTBXItem,
+  Dialogs, SpTBXControls, StdCtrls, SpTBXEditors, SpTBXItem,SpTBXSkins,
   ComCtrls,Misc;
 
 type
@@ -32,7 +32,7 @@
 
 implementation
 
-uses MainUnit, gnugettext;
+uses MainUnit, gnugettext, PreferencesFormUnit;
 
 {$R *.dfm}
 
@@ -82,6 +82,8 @@
 begin
   TranslateComponent(self);
 
+  SpTBXTitleBar1.Active := Preferences.ThemeType=sknSkin;
+
   if not SpTBXTitleBar1.Active then
     RemoveSpTBXTitleBarMarges(self);
 end;

Modified: Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/BattleFormUnit.dfm	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/BattleFormUnit.dfm	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1,6 +1,6 @@
 object BattleForm: TBattleForm
-  Left = 1231
-  Top = 306
+  Left = 1037
+  Top = 282
   Width = 920
   Height = 612
   Caption = 'Battle window'
@@ -4863,6 +4863,7 @@
           Width = 113
           Height = 22
           Caption = 'Team color'
+          DropDownMenu = ColorPopupMenu
           Images = MainForm.ColorImageList
         end
         object SpectateCheckBox: TSpTBXCheckBox
@@ -12752,7 +12753,7 @@
         Align = alClient
         BiDiMode = bdLeftToRight
         ParentBiDiMode = False
-        ActiveTabIndex = 1
+        ActiveTabIndex = 2
         OnActiveTabChange = SpTBXTabControl1ActiveTabChange
         HiddenItems = &lt;&gt;
         object QuickLookTab: TSpTBXTabItem
@@ -12763,13 +12764,13 @@
         object GameOptionsTab: TSpTBXTabItem
           Caption = 'Game options'
           Wrapping = twWrap
-          Checked = True
           CustomWidth = 80
           CustomHeight = 35
         end
         object DisabledUnitsTab: TSpTBXTabItem
           Caption = 'Disabled Units (0)'
           Wrapping = twWrap
+          Checked = True
           CustomWidth = 94
         end
         object MapTab: TSpTBXTabItem
@@ -12912,98 +12913,6 @@
             end
           end
         end
-        object SpTBXTabSheet1: TSpTBXTabSheet
-          Left = 0
-          Top = 39
-          Width = 417
-          Height = 234
-          Caption = 'Disabled Units (0)'
-          ImageIndex = -1
-          DesignSize = (
-            417
-            234)
-          TabItem = 'DisabledUnitsTab'
-          object UnitsGroupBox: TSpTBXGroupBox
-            Left = 8
-            Top = 4
-            Width = 401
-            Height = 227
-            Caption = 'Disabled units'
-            Anchors = [akLeft, akTop, akBottom]
-            TabOrder = 0
-            DesignSize = (
-              401
-              227)
-            object VDTDisabledUnits: TVirtualDrawTree
-              Left = 16
-              Top = 32
-              Width = 369
-              Height = 183
-              Anchors = [akLeft, akTop, akRight, akBottom]
-              DefaultNodeHeight = 64
-              Header.AutoSizeIndex = 1
-              Header.DefaultHeight = 17
-              Header.Font.Charset = DEFAULT_CHARSET
-              Header.Font.Color = clWindowText
-              Header.Font.Height = -11
-              Header.Font.Name = 'MS Sans Serif'
-              Header.Font.Style = []
-              Header.Options = [hoAutoResize, hoColumnResize, hoDrag]
-              TabOrder = 0
-              TreeOptions.PaintOptions = [toHideFocusRect, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
-              TreeOptions.SelectionOptions = [toFullRowSelect]
-              OnDrawNode = VDTDisabledUnitsDrawNode
-              Columns = &lt;
-                item
-                  Position = 0
-                  Width = 64
-                  WideText = 'Icon'
-                end
-                item
-                  Position = 1
-                  Width = 201
-                  WideText = 'FullName'
-                end
-                item
-                  Position = 2
-                  Width = 100
-                  WideText = 'Code name'
-                end&gt;
-            end
-            object AddUnitsSpeedButton: TSpTBXButton
-              Left = 232
-              Top = 10
-              Width = 153
-              Height = 22
-              Caption = 'Add more units'
-              TabOrder = 1
-              OnClick = AddUnitsSpeedButtonClick
-            end
-          end
-        end
-        object SpTBXTabSheet6: TSpTBXTabSheet
-          Left = 0
-          Top = 39
-          Width = 417
-          Height = 234
-          ImageIndex = 1
-          TabItem = 'QuickLookTab'
-          object QuickLookRichEdit: TRichEdit
-            Left = 2
-            Top = 0
-            Width = 413
-            Height = 232
-            Align = alClient
-            BorderStyle = bsNone
-            Color = clBtnFace
-            ParentShowHint = False
-            ReadOnly = True
-            ScrollBars = ssVertical
-            ShowHint = True
-            TabOrder = 0
-            OnMouseMove = QuickLookRichEditMouseMove
-          end
-        end
         object SpTBXTabSheet2: TSpTBXTabSheet
           Left = 0
           Top = 39
@@ -13194,6 +13103,99 @@
             OnClick = SetDefaultButtonClick
           end
         end
+        object SpTBXTabSheet6: TSpTBXTabSheet
+          Left = 0
+          Top = 39
+          Width = 417
+          Height = 234
+          ImageIndex = 1
+          TabItem = 'QuickLookTab'
+          object QuickLookRichEdit: TRichEdit
+            Left = 2
+            Top = 0
+            Width = 413
+            Height = 232
+            Align = alClient
+            BorderStyle = bsNone
+            Color = clBtnFace
+            ParentShowHint = False
+            ReadOnly = True
+            ScrollBars = ssVertical
+            ShowHint = True
+            TabOrder = 0
+            OnMouseMove = QuickLookRichEditMouseMove
+          end
+        end
+        object SpTBXTabSheet1: TSpTBXTabSheet
+          Left = 0
+          Top = 39
+          Width = 417
+          Height = 234
+          Caption = 'Disabled Units (0)'
+          ImageIndex = -1
+          DesignSize = (
+            417
+            234)
+          TabItem = 'DisabledUnitsTab'
+          object UnitsGroupBox: TSpTBXGroupBox
+            Left = 8
+            Top = 4
+            Width = 401
+            Height = 227
+            Caption = 'Disabled units'
+            Anchors = [akLeft, akTop, akBottom]
+            TabOrder = 0
+            DesignSize = (
+              401
+              227)
+            object VDTDisabledUnits: TVirtualDrawTree
+              Left = 16
+              Top = 32
+              Width = 369
+              Height = 183
+              Anchors = [akLeft, akTop, akRight, akBottom]
+              DefaultNodeHeight = 64
+              Header.AutoSizeIndex = 1
+              Header.DefaultHeight = 17
+              Header.Font.Charset = DEFAULT_CHARSET
+              Header.Font.Color = clWindowText
+              Header.Font.Height = -11
+              Header.Font.Name = 'MS Sans Serif'
+              Header.Font.Style = []
+              Header.Options = [hoAutoResize, hoColumnResize, hoDrag]
+              TabOrder = 0
+              TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning, toEditOnClick]
+              TreeOptions.PaintOptions = [toHideFocusRect, toHotTrack, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
+              TreeOptions.SelectionOptions = [toFullRowSelect]
+              OnDrawNode = VDTDisabledUnitsDrawNode
+              Columns = &lt;
+                item
+                  Position = 0
+                  Width = 64
+                  WideText = 'Icon'
+                end
+                item
+                  Position = 1
+                  Width = 201
+                  WideText = 'FullName'
+                end
+                item
+                  Position = 2
+                  Width = 100
+                  WideText = 'Code name'
+                end&gt;
+            end
+            object AddUnitsSpeedButton: TSpTBXButton
+              Left = 232
+              Top = 10
+              Width = 153
+              Height = 22
+              Caption = 'Add more units'
+              TabOrder = 1
+              OnClick = AddUnitsSpeedButtonClick
+            end
+          end
+        end
       end
     end
   end
@@ -13207,14 +13209,21 @@
   object ColorPopupMenu: TSpTBXPopupMenu
     AutoHotkeys = maManual
     Left = 280
-    Top = 488
-    object SpTBXItem4: TSpTBXItem
+    Top = 464
+    object mnuTeamColorPalette: TSpTBXColorPalette
+      CustomColors = True
+      ColCount = 5
+      RowCount = 4
+      OnCellClick = mnuTeamColorPaletteCellClick
+      OnGetColor = mnuTeamColorPaletteGetColor
+    end
+    object mnuTeamColorCustomize: TSpTBXItem
       Caption = 'Customize ...'
-      OnClick = SpTBXItem4Click
+      OnClick = mnuTeamColorCustomizeClick
     end
     object SpTBXSeparatorItem1: TSpTBXSeparatorItem
     end
-    object SpTBXItem1: TSpTBXItem
+    object mnuTeamColorCancel: TSpTBXItem
       Caption = 'Cancel'
     end
   end
@@ -13225,14 +13234,25 @@
     Top = 352
     object ForceTeamSpin: TSpTBXEditItem
       Caption = 'Set Id'
+      CustomWidth = -1
+      EditCaption = 'Set Id'
       OnChange = ForceTeamSpinChange
     end
     object ForceAllySpin: TSpTBXEditItem
       Caption = 'Set team'
+      CustomWidth = 10
+      EditCaption = 'Set team'
       OnChange = ForceAllySpinChange
     end
     object SetTeamColorItem: TSpTBXSubmenuItem
       Caption = 'Set id color'
+      object mnuForceTeamColorPalette: TSpTBXColorPalette
+        CustomColors = True
+        ColCount = 5
+        RowCount = 4
+        OnCellClick = mnuForceTeamColorPaletteCellClick
+        OnGetColor = mnuTeamColorPaletteGetColor
+      end
       object SpTBXItem7: TSpTBXItem
         Caption = 'Customize ...'
         OnClick = SpTBXItem7Click
@@ -13245,6 +13265,8 @@
     end
     object HandicapSpinEditItem: TSpTBXEditItem
       Caption = 'Bonus'
+      CustomWidth = 40
+      EditCaption = 'Bonus'
       OnChange = HandicapSpinEditItemChange
     end
     object KickPlayerItem: TSpTBXItem
@@ -13497,8 +13519,8 @@
   end
   object ChooseSidePopupMenu: TSpTBXPopupMenu
     AutoHotkeys = maManual
-    Left = 252
-    Top = 455
+    Left = 396
+    Top = 463
   end
   object NumberSelection: TSpTBXPopupMenu
     AutoHotkeys = maManual

Modified: Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- Lobby/TASClient/BattleFormUnit.pas	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/BattleFormUnit.pas	2010-03-30 18:48:36 UTC (rev 7451)
@@ -163,13 +163,13 @@
   TBattleForm = class(TForm)
     GameTimer: TTimer;
     ColorPopupMenu: TSpTBXPopupMenu;
-    SpTBXItem1: TSpTBXItem;
+    mnuTeamColorCancel: TSpTBXItem;
     PlayerControlPopupMenu: TSpTBXPopupMenu;
     KickPlayerItem: TSpTBXItem;
     SetTeamColorItem: TSpTBXSubmenuItem;
     SpTBXItem3: TSpTBXItem;
     SetBotSideSubitem: TSpTBXSubmenuItem;
-    SpTBXItem4: TSpTBXItem;
+    mnuTeamColorCustomize: TSpTBXItem;
     SpTBXSeparatorItem1: TSpTBXSeparatorItem;
     SpTBXSeparatorItem2: TSpTBXSeparatorItem;
     SpTBXItem7: TSpTBXItem;
@@ -433,6 +433,8 @@
     lblMetalValue: TSpTBXLabel;
     lblEnergyValue: TSpTBXLabel;
     lblUnitsValue: TSpTBXLabel;
+    mnuTeamColorPalette: TSpTBXColorPalette;
+    mnuForceTeamColorPalette: TSpTBXColorPalette;
 
     procedure CreateParams(var Params: TCreateParams); override;
 
@@ -457,7 +459,7 @@
     procedure ChangeTeamColor(ColorIndex: Integer; UpdateServer: Boolean);
     procedure ChangeSide(SideIndex: Integer; UpdateServer: Boolean);
 
-    function FigureOutBestPossibleTeamAllyAndColor(IgnoreMyself: Boolean; var BestTeam, BestAlly, BestColorIndex: Integer): Boolean;
+    function FigureOutBestPossibleTeamAllyAndColor(IgnoreMyself: Boolean; var BestTeam, BestAlly, BestColorIndex:integer): Boolean;
     procedure ChangeCurrentMod(ModName: string);
     procedure ChangeMapToNoMap(MapName: string); // use 'MapName' to display missing map caption
     procedure ChangeMapToFirstOne;
@@ -541,7 +543,7 @@
     procedure KickPlayerItemClick(Sender: TObject);
     procedure MySideButtonClick(Sender: TObject);
     procedure ReadyButtonClick(Sender: TObject);
-    procedure SpTBXItem4Click(Sender: TObject);
+    procedure mnuTeamColorCustomizeClick(Sender: TObject);
     procedure SpTBXItem7Click(Sender: TObject);
     procedure MapsButtonClick(Sender: TObject);
     procedure ReloadMapListButtonClick(Sender: TObject);
@@ -734,6 +736,12 @@
       Shift: TShiftState; X, Y: Integer);
     procedure EnergyTrackerMouseUp(Sender: TObject; Button: TMouseButton;
       Shift: TShiftState; X, Y: Integer);
+    procedure mnuTeamColorPaletteCellClick(Sender: TObject; ACol,
+      ARow: Integer; var Allow: Boolean);
+    procedure mnuTeamColorPaletteGetColor(Sender: TObject; ACol,
+      ARow: Integer; var Color: TColor; var Name: WideString);
+    procedure mnuForceTeamColorPaletteCellClick(Sender: TObject; ACol,
+      ARow: Integer; var Allow: Boolean);
   private
     History: TWideStringList;
     HistoryIndex: Integer;
@@ -1157,7 +1165,7 @@
   for example when trying to figure out best numbers once we've joined the battle,
   but our current numbers are undefined - although they are set to some value,
   these values should be reset. }
-function TBattleForm.FigureOutBestPossibleTeamAllyAndColor(IgnoreMyself: Boolean; var BestTeam, BestAlly, BestColorIndex: Integer): Boolean;
+function TBattleForm.FigureOutBestPossibleTeamAllyAndColor(IgnoreMyself: Boolean;  var BestTeam, BestAlly, BestColorIndex:integer): Boolean;
 var
   i,j: Integer;
   team, ally, color: Integer;
@@ -3216,8 +3224,9 @@
       GetMapItem(CurrentMapIndex).MaxHeight := GetMapMaxHeight(PChar(MapList[CurrentMapIndex]));
       GetMapItem(CurrentMapIndex).HeightBoundsLoaded := True;
     end;
-
     Application.CreateForm(TMinimap3DPreview, Minimap3DPreview);
+    if SkinManager.GetSkinType &lt;&gt; sknSkin then
+      Minimap3DPreview.SpTBXTitleBar1.Active := False;
     
     Minimap3DPreview.Camera.Position.X := -50;
     Minimap3DPreview.Camera.Position.Y := 50;
@@ -3330,6 +3339,7 @@
       heightMap.Free;
 
       Minimap3DPreview.Caption := MinimapZoomedForm.Caption;
+      Minimap3DPreview.SpTBXTitleBar1.Caption := Minimap3DPreview.Caption;
       Minimap3DPreview.ShowModal;
       Minimap3DPreview.Free;
       Minimap3DPreview := nil;
@@ -4169,7 +4179,8 @@
   begin
     AddBotForm.BotTeamButton.SpinOptions.ValueAsInteger := team+1;
     AddBotForm.BotAllyButton.SpinOptions.ValueAsInteger := ally+1;
-    AddBotForm.ChangeTeamColor(color);
+    AddBotUnit.BotColor := TeamColors[Color];
+    MainForm.UpdateColorImageList;
   end;
 
   // fix bot name to avoid any duplicates:
@@ -5251,7 +5262,7 @@
   BattleForm.AmIReady := not BattleForm.AmIReady;
 end;
 
-procedure TBattleForm.SpTBXItem4Click(Sender: TObject);
+procedure TBattleForm.mnuTeamColorCustomizeClick(Sender: TObject);
 begin
   if AddBotForm.Visible then
     Misc.InputColor(_('Color Picker'),clBlack)
@@ -5278,8 +5289,7 @@
     end
     else if WhatToDraw = NormalBot then
     begin
-      color := Misc.InputColor(_('Color Picker'),TClient(BattleState.Battle.Bots[RealIndex]).TeamColor);
-      TBot(BattleState.Battle.Bots[RealIndex]).TeamColor := color;
+      color := Misc.InputColor(_('Color Picker'),TBot(BattleState.Battle.Bots[RealIndex]).TeamColor);
       MainForm.TryToSendCommand('UPDATEBOT', TBot(BattleState.Battle.Bots[RealIndex]).Name + ' ' + IntToStr(TBot(BattleState.Battle.Bots[RealIndex]).BattleStatus) + ' ' + IntToStr(TBot(BattleState.Battle.Bots[RealIndex]).TeamColor));
     end;
   end;
@@ -7038,13 +7048,41 @@
   availableWidth: integer;
   availableHeight: integer;
   nodeIndex : integer;
+  BgRect: TRect;
+  pt: TPoint;
+  hot: Boolean;
+  hi: THitInfo;
+  itemState: TSpTBXSkinStatesType;
 begin
   with Sender as TVirtualDrawTree, PaintInfo do
   begin
     nodeIndex := UnitList.IndexOf(BattleState.DisabledUnits[Node.index]);
 
-    if (Node = FocusedNode) and Focused then
-      Canvas.Font.Color := clHighlightText
+    GetCursorPos(pt);
+    pt := ScreenToClient(pt);
+    GetHitTestInfoAt(pt.X,pt.Y,True,hi);
+
+    hot := (SkinManager.GetSkinType=sknSkin) and BattleForm.Active and (hi.HitNode = Node);
+
+    CopyRect(BgRect,CellRect);
+    if Position &lt;&gt; 0 then
+      BgRect.Left := -5;
+    if Position &lt;&gt; Header.Columns.Count-1 then
+      BgRect.Right := BgRect.Right+5;
+
+    if SkinManager.GetSkinType=sknSkin then
+    begin
+      itemState := SkinManager.CurrentSkin.GetState(True,False,hot,(Node = FocusedNode) and focused);
+      Canvas.Font.Color := SkinManager.CurrentSkin.GetTextColor(skncListItem,itemState);
+      SkinManager.CurrentSkin.PaintBackground(Canvas,BgRect,skncListItem,itemState,True,True);
+      Canvas.Brush.Style := Graphics.bsClear;
+    end
+    else if (Node = FocusedNode) and focused then
+    begin
+      Canvas.Font.Color := clHighlightText;
+      Canvas.Brush.Color := clHighlight;
+      Canvas.FillRect(CellRect);
+    end
     else
       Canvas.Font.Color := clWindowText;
 
@@ -7068,9 +7106,9 @@
           if TBitmap(UnitBitmaps[nodeIndex]).Width &gt; 0 then
           begin
             if (TBitmap(UnitBitmaps[nodeIndex]).Width/TBitmap(UnitBitmaps[nodeIndex]).Height) &gt; (availableWidth/availableHeight) then
-              Canvas.StretchDraw(Rect(R.Left,R.Top,R.Right,R.Top+Round(availableWidth*TBitmap(UnitBitmaps[nodeIndex]).Height/TBitmap(UnitBitmaps[nodeIndex]).Width)),TBitmap(UnitBitmaps[nodeIndex]))
+              Canvas.StretchDraw(Rect(R.Left,R.Top+2,R.Right,R.Top+2+Round(availableWidth*TBitmap(UnitBitmaps[nodeIndex]).Height/TBitmap(UnitBitmaps[nodeIndex]).Width)),TBitmap(UnitBitmaps[nodeIndex]))
             else
-              Canvas.StretchDraw(Rect(R.Left,R.Top,R.Left+Round(availableHeight*TBitmap(UnitBitmaps[nodeIndex]).Width/TBitmap(UnitBitmaps[nodeIndex]).Height),R.Bottom),TBitmap(UnitBitmaps[nodeIndex]));
+              Canvas.StretchDraw(Rect(R.Left,R.Top+2,R.Left+Round(availableHeight*TBitmap(UnitBitmaps[nodeIndex]).Width/TBitmap(UnitBitmaps[nodeIndex]).Height),R.Bottom),TBitmap(UnitBitmaps[nodeIndex]));
           end;
         end;
       end;
@@ -7711,8 +7749,8 @@
 
 procedure TBattleForm.ImgVoteBlankClick(Sender: TObject);
 begin
-  //if BattleState.AutoHostType = 0 then
-  //  MainForm.TryToSendCommand('SAYBATTLE','!vote b');
+  if BattleState.AutoHostType = 0 then
+    MainForm.TryToSendCommand('SAYBATTLE','!vote b');
   AutoHostVotePanel.Visible := False;
 end;
 
@@ -8396,5 +8434,42 @@
   MainForm.TryToSendCommand('SETSCRIPTTAGS', 'GAME/modoptions/StartEnergy='+IntToStr(EnergyTracker.Position));
 end;
 
+procedure TBattleForm.mnuTeamColorPaletteCellClick(Sender: TObject; ACol,
+  ARow: Integer; var Allow: Boolean);
+begin
+  Allow := True;
+  ChangeTeamColor(ARow*5+ACol, True);
+end;
+
+procedure TBattleForm.mnuTeamColorPaletteGetColor(Sender: TObject; ACol,
+  ARow: Integer; var Color: TColor; var Name: WideString);
+begin
+  Color := TeamColors[ARow*5+ACol];
+end;
+
+procedure TBattleForm.mnuForceTeamColorPaletteCellClick(Sender: TObject;
+  ACol, ARow: Integer; var Allow: Boolean);
+var
+  color: Integer;
+  RealIndex: Integer;
+  WhatToDraw: TClientNodeType;
+begin
+  if (VDTBattleClients.FocusedNode &lt;&gt; nil) then
+  begin
+    Allow := True;
+    GetNodeClient(VDTBattleClients.FocusedNode.Index,RealIndex,WhatToDraw);
+    if WhatToDraw = NormalClient then
+    begin
+      TClient(BattleState.Battle.Clients[RealIndex]).TeamColor := TeamColors[ARow*5+ACol];
+      MainForm.TryToSendCommand('FORCETEAMCOLOR', TClient(BattleState.Battle.Clients[RealIndex]).Name + ' ' + IntToStr(TeamColors[ARow*5+ACol]));
+    end
+    else if WhatToDraw = NormalBot then
+    begin
+      TBot(BattleState.Battle.Bots[RealIndex]).TeamColor := TeamColors[ARow*5+ACol];
+      MainForm.TryToSendCommand('UPDATEBOT', TBot(BattleState.Battle.Bots[RealIndex]).Name + ' ' + IntToStr(TBot(BattleState.Battle.Bots[RealIndex]).BattleStatus) + ' ' + IntToStr(TBot(BattleState.Battle.Bots[RealIndex]).TeamColor));
+    end;
+  end;
+end;
+
 end.
 

Modified: Lobby/TASClient/DisableUnitsFormUnit.dfm
===================================================================
--- Lobby/TASClient/DisableUnitsFormUnit.dfm	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/DisableUnitsFormUnit.dfm	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1,9 +1,10 @@
 object DisableUnitsForm: TDisableUnitsForm
   Left = 769
   Top = 204
-  Width = 600
-  Height = 483
+  BorderStyle = bsDialog
   Caption = 'Disable units dialog'
+  ClientHeight = 456
+  ClientWidth = 592
   Color = clBtnFace
   Constraints.MaxHeight = 1150
   Constraints.MaxWidth = 1920
@@ -81,21 +82,23 @@
       Header.Font.Height = -11
       Header.Font.Name = 'MS Sans Serif'
       Header.Font.Style = []
-      Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoShowSortGlyphs, hoVisible]
+      Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoHotTrack, hoOwnerDraw, hoShowSortGlyphs, hoVisible]
       Header.SortColumn = 2
       Header.Style = hsFlatButtons
       TabOrder = 5
       TreeOptions.AutoOptions = [toAutoDropExpand, toAutoScrollOnExpand, toAutoSort, toAutoTristateTracking, toAutoDeleteMovedNodes]
       TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning]
-      TreeOptions.PaintOptions = [toHideFocusRect, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
+      TreeOptions.PaintOptions = [toHideFocusRect, toHotTrack, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
       TreeOptions.SelectionOptions = [toFullRowSelect]
       OnColumnResize = VDTUnitsColumnResize
       OnCompareNodes = VDTUnitsCompareNodes
       OnDrawNode = VDTUnitsDrawNode
       OnHeaderClick = VDTUnitsHeaderClick
+      OnHeaderDraw = VDTUnitsHeaderDraw
       OnInitNode = VDTUnitsInitNode
       Columns = &lt;
         item
+          CheckBox = True
           Position = 0
           Width = 33
           WideText = 'Dis.'

Modified: Lobby/TASClient/DisableUnitsFormUnit.pas
===================================================================
--- Lobby/TASClient/DisableUnitsFormUnit.pas	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/DisableUnitsFormUnit.pas	2010-03-30 18:48:36 UTC (rev 7451)
@@ -12,7 +12,7 @@
 
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
-  Dialogs, VirtualTrees, StdCtrls, Buttons, SpTBXControls,
+  Dialogs, VirtualTrees, StdCtrls, Buttons, SpTBXControls,SpTBXSkins,
   SpTBXItem,Misc,ExtCtrls;
 
 type
@@ -48,6 +48,9 @@
       Node2: PVirtualNode; Column: TColumnIndex; var Result: Integer);
     procedure VDTUnitsHeaderClick(Sender: TVTHeader;
   HitInfo: TVTHeaderHitInfo);
+    procedure VDTUnitsHeaderDraw(Sender: TVTHeader; HeaderCanvas: TCanvas;
+      Column: TVirtualTreeColumn; R: TRect; Hover, Pressed: Boolean;
+      DropMark: TVTDropMarkMode);
   private
     { Private declarations }
   public
@@ -93,16 +96,54 @@
   forceWidth: integer;
   forceHeight: integer;
   nodeIndex : integer;
+  BgRect: TRect;
+  pt: TPoint;
+  hot: Boolean;
+  hi: THitInfo;
+  itemState: TSpTBXSkinStatesType;
+  CheckboxRect: TRect;
 begin
   with Sender as TVirtualDrawTree, PaintInfo do
   begin
     nodeIndex := UnitNodes.IndexOf(Node);
 
-    if (Node = FocusedNode) and Focused then
-      Canvas.Font.Color := clHighlightText
+    GetCursorPos(pt);
+    pt := ScreenToClient(pt);
+    GetHitTestInfoAt(pt.X,pt.Y,True,hi);
+
+    hot := (SkinManager.GetSkinType=sknSkin) and DisableUnitsForm.Active and (hi.HitNode = Node);
+
+    CopyRect(BgRect,CellRect);
+    if Position &lt;&gt; 0 then
+      BgRect.Left := -5;
+    if Position &lt;&gt; Header.Columns.Count-1 then
+      BgRect.Right := BgRect.Right+5;
+
+    if SkinManager.GetSkinType=sknSkin then
+    begin
+      itemState := SkinManager.CurrentSkin.GetState(True,False,hot,(Node = FocusedNode) and focused);
+      Canvas.Font.Color := SkinManager.CurrentSkin.GetTextColor(skncListItem,itemState);
+      SkinManager.CurrentSkin.PaintBackground(Canvas,BgRect,skncListItem,itemState,True,True);
+      Canvas.Brush.Style := Graphics.bsClear;
+    end
+    else if (Node = FocusedNode) and focused then
+    begin
+      Canvas.Font.Color := clHighlightText;
+      Canvas.Brush.Color := clHighlight;
+      Canvas.FillRect(CellRect);
+    end
     else
       Canvas.Font.Color := clWindowText;
 
+    if Header.Columns[Column].CheckBox then
+    begin
+      CopyRect(CheckboxRect,Canvas.ClipRect);
+      InflateRect(CheckboxRect,-3,-3);
+      SkinManager.CurrentSkin.PaintBackground(Canvas,CheckboxRect,skncCheckBox,itemState,True,True);
+      if (Node.CheckState = csCheckedNormal) then
+        SkinManager.CurrentSkin.PaintMenuCheckMark(Canvas,CheckboxRect,True,False,False,itemState);
+    end;
+
     R := ContentRect;
     if Column &lt;&gt; 1 then
     begin
@@ -347,4 +388,11 @@
   end;
 end;
 
+procedure TDisableUnitsForm.VDTUnitsHeaderDraw(Sender: TVTHeader;
+  HeaderCanvas: TCanvas; Column: TVirtualTreeColumn; R: TRect; Hover,
+  Pressed: Boolean; DropMark: TVTDropMarkMode);
+begin
+  MainForm.VDTBattlesHeaderDraw(Sender,HeaderCanvas,Column,R,Hover,Pressed,DropMark);
+end;
+
 end.

Modified: Lobby/TASClient/HostBattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/HostBattleFormUnit.dfm	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/HostBattleFormUnit.dfm	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1,7 +1,7 @@
 object HostBattleForm: THostBattleForm
   Left = 817
   Top = 329
-  BorderStyle = bsDialog
+  BorderStyle = bsSingle
   Caption = 'Host battle'
   ClientHeight = 380
   ClientWidth = 426

Modified: Lobby/TASClient/HostBattleFormUnit.pas
===================================================================
--- Lobby/TASClient/HostBattleFormUnit.pas	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/HostBattleFormUnit.pas	2010-03-30 18:48:36 UTC (rev 7451)
@@ -476,6 +476,7 @@
 begin
   TranslateComponent(self);
 
+  SpTBXTitleBar1.Active := Preferences.ThemeType=sknSkin;
 
   if not SpTBXTitleBar1.Active then
     RemoveSpTBXTitleBarMarges(self);

Modified: Lobby/TASClient/MainUnit.dfm
===================================================================
--- Lobby/TASClient/MainUnit.dfm	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/MainUnit.dfm	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1,7 +1,7 @@
 object MainForm: TMainForm
-  Left = 465
-  Top = 140
-  Width = 847
+  Left = 334
+  Top = 470
+  Width = 872
   Height = 521
   Caption = '.'
   Color = clBtnFace
@@ -23,7 +23,7 @@
   object MainTitleBar: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 839
+    Width = 864
     Height = 494
     Caption = 'TASClient'
     object DefaultSideImage: TImage
@@ -204,7 +204,7 @@
     object Panel1: TSpTBXPanel
       Left = 4
       Top = 108
-      Width = 831
+      Width = 856
       Height = 382
       Caption = 'Panel1'
       Align = alClient
@@ -214,7 +214,7 @@
       object MainDockPanel: TDockPanel
         Left = 0
         Top = 0
-        Width = 831
+        Width = 856
         Height = 382
         Align = alClient
         BevelOuter = bvNone
@@ -222,7 +222,7 @@
         TabOrder = 0
         TabPosition = tpTop
         object PlayerListPanel: TSpTBXPanel
-          Left = 619
+          Left = 644
           Top = 0
           Width = 212
           Height = 103
@@ -362,7 +362,7 @@
         object BattlesPanel: TSpTBXPanel
           Left = 0
           Top = 103
-          Width = 831
+          Width = 856
           Height = 279
           Caption = 'Battles'
           Align = alBottom
@@ -374,7 +374,7 @@
           object QuickJoinPanel: TSpTBXPanel
             Left = 0
             Top = 0
-            Width = 831
+            Width = 856
             Height = 25
             Hint = 'Quick join panel'
             Caption = 'QuickJoinPanel'
@@ -399,7 +399,7 @@
               ShowHint = True
             end
             object btSpecatateNow: TSpTBXButton
-              Left = 699
+              Left = 724
               Top = 0
               Width = 132
               Height = 25
@@ -430,7 +430,7 @@
           object VDTBattles: TVirtualDrawTree
             Left = 0
             Top = 25
-            Width = 831
+            Width = 856
             Height = 69
             Align = alClient
             BevelInner = bvNone
@@ -553,7 +553,7 @@
           object FilterGroup: TSpTBXPanel
             Left = 0
             Top = 106
-            Width = 831
+            Width = 856
             Height = 173
             Caption = 'FilterGroup'
             Align = alBottom
@@ -561,12 +561,12 @@
             OnResize = FilterGroupResize
             Borders = False
             DesignSize = (
-              831
+              856
               173)
             object FiltersTabs: TSpTBXTabControl
               Left = 0
               Top = 0
-              Width = 831
+              Width = 856
               Height = 173
               Align = alClient
               ActiveTabIndex = 0
@@ -582,18 +582,18 @@
               object SpTBXTabSheet2: TSpTBXTabSheet
                 Left = 0
                 Top = 0
-                Width = 831
+                Width = 856
                 Height = 150
                 Caption = 'Presets'
                 ImageIndex = -1
                 DesignSize = (
-                  831
+                  856
                   150)
                 TabItem = 'SpTBXTabItem2'
                 object PresetListbox: TSpTBXListBox
                   Left = 152
                   Top = 26
-                  Width = 657
+                  Width = 682
                   Height = 113
                   Anchors = [akLeft, akTop, akRight]
                   ItemHeight = 16
@@ -664,7 +664,7 @@
               object SpTBXTabSheet1: TSpTBXTabSheet
                 Left = 0
                 Top = 0
-                Width = 831
+                Width = 856
                 Height = 150
                 Caption = 'Filters'
                 ImageIndex = -1
@@ -1034,13 +1034,14 @@
                     SpinButton.Align = alRight
                     SpinOptions.MaxValue = 9.000000000000000000
                     SpinOptions.MinValue = 1.000000000000000000
+                    SpinOptions.Value = 1.000000000000000000
                     OnValueChanged = RankValueTextBoxChange
                   end
                 end
               end
             end
             object EnableFilters: TSpTBXCheckBox
-              Left = 552
+              Left = 573
               Top = 154
               Width = 263
               Height = 18
@@ -1061,7 +1062,7 @@
           object FiltersButton: TSpTBXButton
             Left = 0
             Top = 94
-            Width = 831
+            Width = 856
             Height = 12
             Align = alBottom
             TabOrder = 3
@@ -1075,17 +1076,17 @@
     object Panel4: TSpTBXPanel
       Left = 4
       Top = 26
-      Width = 831
+      Width = 856
       Height = 41
       Align = alTop
       TabOrder = 2
       BorderType = pbrRaised
       TBXStyleBackground = True
       DesignSize = (
-        831
+        856
         41)
       object OptionsSpeedButton: TSpTBXSpeedButton
-        Left = 448
+        Left = 456
         Top = 8
         Width = 121
         Height = 25
@@ -1093,7 +1094,7 @@
         DropDownMenu = OptionsPopupMenu
       end
       object BattleScreenSpeedButton: TSpTBXSpeedButton
-        Left = 64
+        Left = 72
         Top = 8
         Width = 121
         Height = 25
@@ -1101,7 +1102,7 @@
         DropDownMenu = HostBattlePopupMenu
       end
       object ReplaysButton: TSpTBXSpeedButton
-        Left = 320
+        Left = 328
         Top = 8
         Width = 121
         Height = 25
@@ -1114,7 +1115,7 @@
         OnClick = ReplaysButtonClick
       end
       object SearchButton: TSpTBXSpeedButton
-        Left = 576
+        Left = 584
         Top = 8
         Width = 121
         Height = 25
@@ -1125,7 +1126,7 @@
         DropDownMenu = SearchFormPopupMenu
       end
       object SinglePlayerButton: TSpTBXButton
-        Left = 192
+        Left = 200
         Top = 8
         Width = 121
         Height = 25
@@ -1140,7 +1141,7 @@
         OnClick = SinglePlayerButtonClick
       end
       object HelpButton: TSpTBXSpeedButton
-        Left = 704
+        Left = 729
         Top = 8
         Width = 121
         Height = 25
@@ -1154,34 +1155,35 @@
         ParentFont = False
         DropDownMenu = HelpPopupMenu
       end
-      object ConnectButton: TSpTBXSpeedButton
-        Left = 2
-        Top = 2
-        Width = 38
-        Height = 36
-        Hint = 'Connection/Disconnection'
-        ParentShowHint = False
-        ShowHint = True
-        OnClick = ConnectButtonClick
-        Images = ConnectionStateImageList
-        ImageIndex = 0
-      end
       object AwayMsgsButton: TSpTBXButton
-        Left = 39
-        Top = 2
+        Left = 41
+        Top = 8
         Width = 18
-        Height = 36
+        Height = 25
         Hint = 'Away message control'
         ParentShowHint = False
         ShowHint = True
-        TabOrder = 7
+        TabOrder = 6
         DropDownMenu = ConnectionPopupMenu
       end
+      object ConnectButton: TSpTBXLabel
+        Left = 4
+        Top = 4
+        Width = 32
+        Height = 32
+        AutoSize = False
+        OnClick = ConnectButtonClick
+        OnMouseEnter = ConnectButtonMouseEnter
+        OnMouseLeave = ConnectButtonMouseLeave
+        Images = ConnectionStateImageList
+        ImageIndex = 0
+        SkinType = sknNone
+      end
     end
     object NewsMainPanel: TSpTBXPanel
       Left = 4
       Top = 67
-      Width = 831
+      Width = 856
       Height = 41
       Caption = 'NewsMainPanel'
       Align = alTop
@@ -1190,7 +1192,7 @@
       object ExpandNewsButton: TSpTBXButton
         Left = 0
         Top = 29
-        Width = 831
+        Width = 856
         Height = 12
         Align = alBottom
         TabOrder = 0
@@ -1201,7 +1203,7 @@
       object ScrollingNewsPanel: TSpTBXPanel
         Left = 0
         Top = 0
-        Width = 831
+        Width = 856
         Height = 29
         Align = alClient
         TabOrder = 1

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/MainUnit.pas	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1229,7 +1229,6 @@
     RankFilter: TSpTBXCheckBox;
     RankSignButton: TSpTBXButton;
     mnuRename: TSpTBXItem;
-    ConnectButton: TSpTBXSpeedButton;
     AwayMsgsButton: TSpTBXButton;
     PlayersValueTextBox: TSpTBXSpinEdit;
     Players2ValueTextBox: TSpTBXSpinEdit;
@@ -1243,6 +1242,7 @@
     PlayersInfoPanel: TSpTBXPanel;
     PlayersLabel: TSpTBXLabel;
     SortLabel: TSpTBXButton;
+    ConnectButton: TSpTBXLabel;
     procedure mnuOpenPrivateChatClick(Sender: TObject);
     procedure mnuSelectBattleClick(Sender: TObject);
     procedure mnuPlayWithClick(Sender: TObject);
@@ -1421,6 +1421,8 @@
       TargetCanvas: TCanvas; Node: PVirtualNode; Column: TColumnIndex;
       const Text: WideString; const CellRect: TRect;
       var DefaultDraw: Boolean);
+    procedure ConnectButtonMouseEnter(Sender: TObject);
+    procedure ConnectButtonMouseLeave(Sender: TObject);
   published
     MainTitleBar: TSpTBXTitleBar;
     ButtonImageList: TImageList;
@@ -4425,6 +4427,26 @@
     bmp.Free;
   end;
 
+  // next bot form team color
+    bmp := TBitmap.Create;
+    bmp.Width := 16;
+    bmp.Height := 16;
+
+    with bmp.Canvas do
+    begin
+      if AddBotUnit.BotColor = clBlack then TransparentColor := clWhite else TransparentColor := clBlack;
+      Brush.Color := TransparentColor;
+      Pen.Color := TransparentColor;
+      Rectangle(0, 0, 16, 16);
+
+      Brush.Color := AddBotUnit.BotColor;
+      Pen.Color := clGray;
+      RoundRect(1, 1, 14, 14, 4, 4);
+    end;
+
+    ColorImageList.AddMasked(bmp, TransparentColor);
+
+    bmp.Free;
 end;
 
 { ChatTextPos is a position in the line where chat text begins. We need this when we are searching for keywords to highlight
@@ -5319,7 +5341,8 @@
   index: Integer;
   battletype, nattype: Integer;
   ms: TMemoryStream;
-  team, ally, color, teamcolor: Integer;
+  team, ally, teamcolor,color: Integer;
+  //color: TColor;
   mapitem: TMapItem;
   maphash: Integer;
   oldMapHash: integer;
@@ -13860,4 +13883,14 @@
   end;
 end;
 
+procedure TMainForm.ConnectButtonMouseEnter(Sender: TObject);
+begin
+  ConnectButton.ImageIndex := 1;
+end;
+
+procedure TMainForm.ConnectButtonMouseLeave(Sender: TObject);
+begin
+  ConnectButton.ImageIndex := Ord(Status.ConnectionState);
+end;
+
 end.

Modified: Lobby/TASClient/Minimap3DPreviewUnit.dfm
===================================================================
--- Lobby/TASClient/Minimap3DPreviewUnit.dfm	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/Minimap3DPreviewUnit.dfm	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1,9 +1,10 @@
 object Minimap3DPreview: TMinimap3DPreview
-  Left = 310
-  Top = 443
-  Width = 596
-  Height = 528
+  Left = 304
+  Top = 200
+  BorderStyle = bsDialog
   Caption = 'Minimap3DPreview'
+  ClientHeight = 509
+  ClientWidth = 585
   Color = clBtnFace
   Font.Charset = DEFAULT_CHARSET
   Font.Color = clWindowText
@@ -16,21 +17,29 @@
   OnShow = FormShow
   PixelsPerInch = 96
   TextHeight = 13
-  object GLSceneViewer: TGLSceneViewer
+  object SpTBXTitleBar1: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 588
-    Height = 501
-    Camera = Camera
-    VSync = vsmSync
-    Buffer.BackgroundColor = clBackground
-    Buffer.FaceCulling = False
-    Buffer.AntiAliasing = aa2x
-    FieldOfView = 140.000000000000000000
-    Align = alClient
-    OnMouseDown = GLSceneViewerMouseDown
-    OnMouseMove = GLSceneViewerMouseMove
-    OnMouseUp = GLSceneViewerMouseUp
+    Width = 585
+    Height = 509
+    Caption = 'Minimap3DPreview'
+    Options.Minimize = False
+    object GLSceneViewer: TGLSceneViewer
+      Left = 4
+      Top = 26
+      Width = 577
+      Height = 479
+      Camera = Camera
+      VSync = vsmSync
+      Buffer.BackgroundColor = clBackground
+      Buffer.FaceCulling = False
+      Buffer.AntiAliasing = aa2x
+      FieldOfView = 138.317642211914100000
+      Align = alClient
+      OnMouseDown = GLSceneViewerMouseDown
+      OnMouseMove = GLSceneViewerMouseMove
+      OnMouseUp = GLSceneViewerMouseUp
+    end
   end
   object GLScene: TGLScene
     Left = 8

Modified: Lobby/TASClient/Minimap3DPreviewUnit.pas
===================================================================
--- Lobby/TASClient/Minimap3DPreviewUnit.pas	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/Minimap3DPreviewUnit.pas	2010-03-30 18:48:36 UTC (rev 7451)
@@ -6,11 +6,10 @@
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, GLCadencer, GLTexture, jpeg, GLHeightData, GLScene,
   GLTerrainRenderer, GLObjects, GLMisc, GLWin32Viewer, GLVectorFileObjects,
-  GLPortal,VectorTypes,VectorGeometry;
+  GLPortal,VectorTypes,VectorGeometry, SpTBXItem;
 
 type
   TMinimap3DPreview = class(TForm)
-    GLSceneViewer: TGLSceneViewer;
     GLScene: TGLScene;
     CenterPoint: TGLRenderPoint;
     DummyCube: TGLDummyCube;
@@ -21,6 +20,8 @@
     TextureLib: TGLMaterialLibrary;
     GLCadencer: TGLCadencer;
     Water: TGLPlane;
+    SpTBXTitleBar1: TSpTBXTitleBar;
+    GLSceneViewer: TGLSceneViewer;
     procedure GLSceneViewerMouseDown(Sender: TObject; Button: TMouseButton;
       Shift: TShiftState; X, Y: Integer);
     procedure GLSceneViewerMouseMove(Sender: TObject; Shift: TShiftState;

Modified: Lobby/TASClient/PreferencesFormUnit.dfm
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.dfm	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/PreferencesFormUnit.dfm	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1,6 +1,6 @@
 object PreferencesForm: TPreferencesForm
-  Left = 1622
-  Top = 168
+  Left = 1078
+  Top = 243
   BorderStyle = bsDialog
   Caption = 'Preferences'
   ClientHeight = 518

Modified: Lobby/TASClient/PreferencesFormUnit.pas
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.pas	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/PreferencesFormUnit.pas	2010-03-30 18:48:36 UTC (rev 7451)
@@ -351,7 +351,7 @@
   SpringDownloaderFormUnit, LogonFormUnit, TipsFormUnit,
   TemplateEditorFormUnit, SpringSettingsProfileFormUnit, gnugettext,
   AutoTeamsUnit, ChannelsListFormUnit, AutoJoinFormUnit, InitWaitFormUnit,
-  DisableUnitsFormUnit, MenuFormUnit, AddBotUnit;
+  DisableUnitsFormUnit, MenuFormUnit, AddBotUnit, AwayMessageFormUnit;
 
 {$R *.dfm}
 
@@ -850,6 +850,17 @@
   for i := 0 to Screen.FormCount-1 do
   begin
     SkinManager.ChangeControlSkinType(Screen.Forms[i],Preferences.ThemeType,True);
+    if Preferences.ThemeType&lt;&gt;sknSkin then
+    begin
+      try
+        TSpTBXTitleBar(Screen.Forms[i].FindChildControl('SpTBXTitleBar1')).Active := False;
+      except
+      end;
+      try
+        TSpTBXTitleBar(Screen.Forms[i].FindChildControl('MainTitleBar')).Active := False;
+      except
+      end;
+    end;
   end;
 
   ApplyCurrentTheme;
@@ -875,25 +886,27 @@
     PanelDarkerColor := RGB(Floor(ColorToR(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1)*0.8),Floor(ColorToG(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1)*0.8),Floor(ColorToB(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1)*0.8));
     BattleForm.QuickLookRichEdit.Color :=  IfNotClNone(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1,clBtnFace);
     MapListForm.ScrollBox1.Color :=  PanelDarkerColor;
-    Colors.Normal := IfNotClNone(SkinManager.CurrentSkin.GetTextColor(skncEditFrame,sknsNormal),Colors.Normal);
     MainForm.ClientsListBox.Color := IfNotClNone(SkinManager.CurrentSkin.Options(skncListItem).Body.Color1,clWindow);
     MainForm.ClientsListBox.BorderStyle := Forms.bsNone;
     ReplaysForm.CommentsRichEdit.Color := IfNotClNone(SkinManager.CurrentSkin.Options(skncEditFrame).Body.Color1,clWindow);
     ReplaysForm.CommentsRichEdit.Font.Color := IfNotClNone(SkinManager.CurrentSkin.GetTextColor(skncEditFrame,sknsNormal),clWindow);
     ReplaysForm.ScriptRichEdit.Color := IfNotClNone(SkinManager.CurrentSkin.Options(skncEditFrame).Body.Color1,clWindow);
     ReplaysForm.ScriptRichEdit.Font.Color := IfNotClNone(SkinManager.CurrentSkin.GetTextColor(skncEditFrame,sknsNormal),clWindow);
+    BattleForm.AutoHostMsgsRichEdit.Color := IfNotClNone(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1,clWindow);
+    AwayMessageForm.MessageRichEdit.Color := IfNotClNone(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1,clWindow);
   end
   else
   begin
     SkinManager.SetToDefaultSkin;
     BattleForm.QuickLookRichEdit.Color :=  clBtnFace;
-    Colors.Normal := clWindowText;
     MainForm.ClientsListBox.Color := clWindow;
     MainForm.ClientsListBox.BorderStyle := Forms.bsSingle;
     ReplaysForm.CommentsRichEdit.Color := clWindow;
     ReplaysForm.CommentsRichEdit.Font.Color := clWindowText;
     ReplaysForm.ScriptRichEdit.Color := clWindow;
     ReplaysForm.ScriptRichEdit.Font.Color := clWindowText;
+    BattleForm.AutoHostMsgsRichEdit.Color := clBtnFace;
+    AwayMessageForm.MessageRichEdit.Color := clWindow;
   end;
   BattleForm.MapOptionsScrollBox.Color :=  BattleForm.QuickLookRichEdit.Color;
   BattleForm.ModOptionsScrollBox.Color :=  BattleForm.QuickLookRichEdit.Color;
@@ -907,11 +920,12 @@
   UpdateVirtualTreeSkin(AddBotForm.VSTAIList);
   UpdateVirtualTreeSkin(AutoJoinForm.VSTAutoplayPresetList);
   UpdateVirtualTreeSkin(AutoJoinForm.VSTAutospecPresetList);
+  UpdateVirtualTreeSkin(DisableUnitsForm.VDTUnits);
 
   UpdateRichEdit(BattleForm.ChatRichEdit);
   
   UpdateTntMemo(BattleForm.InputEdit);
-  UpdateRichEdit(BattleForm.AutoHostMsgsRichEdit);
+  
   for i:=0 to MainForm.ChatTabs.Count-1 do
   begin
     UpdateRichEdit(TExRichEdit(TMyTabSheet(MainForm.ChatTabs[i]).FindChildControl('RichEdit')));
@@ -976,10 +990,7 @@
 begin
   if Preferences.ThemeType = sknSkin then
   begin
-    if SkinManager.CurrentSkin.Options(skncPanel).Body.Color1 &lt;&gt; clNone then
-      RE.Color := SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1
-    else
-      RE.Color := clWindow;
+    RE.Color := IfNotClNone(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1,clWindow);
     RE.BorderStyle := Forms.bsNone;
   end
   else
@@ -1368,7 +1379,7 @@
       else
         CloseSpringDownloader;
 
-    if not oldPref.DisplayUnitsIconsAndNames and Preferences.DisplayUnitsIconsAndNames and (BattleState.Status = Hosting) then
+    if not oldPref.DisplayUnitsIconsAndNames and Preferences.DisplayUnitsIconsAndNames and (BattleState.Status &lt;&gt; None) then
     begin
       // now let's update units:
       InitWaitForm.ChangeCaption(MSG_GETUNITS);

Modified: Lobby/TASClient/ReplaysUnit.dfm
===================================================================
--- Lobby/TASClient/ReplaysUnit.dfm	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/ReplaysUnit.dfm	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1,6 +1,6 @@
 object ReplaysForm: TReplaysForm
-  Left = 1007
-  Top = 183
+  Left = 683
+  Top = 154
   Width = 860
   Height = 631
   Caption = 'Replays'
@@ -146,17 +146,17 @@
         Width = 678
         Height = 209
         Anchors = [akLeft, akTop, akRight, akBottom]
-        ActiveTabIndex = 2
+        ActiveTabIndex = 0
         HiddenItems = &lt;&gt;
         object PlayersTab: TSpTBXTabItem
           Caption = 'Players'
+          Checked = True
         end
         object SpTBXTabItem3: TSpTBXTabItem
           Caption = 'Game settings'
         end
         object CommentsTab: TSpTBXTabItem
           Caption = 'Comments'
-          Checked = True
         end
         object SpTBXTabItem1: TSpTBXTabItem
           Caption = 'Script'
@@ -181,86 +181,6 @@
             WordWrap = False
           end
         end
-        object SpTBXTabSheet3: TSpTBXTabSheet
-          Left = 0
-          Top = 23
-          Width = 678
-          Height = 186
-          Caption = 'Players'
-          ImageIndex = -1
-          TabItem = 'PlayersTab'
-          object VDTPlayers: TVirtualDrawTree
-            Left = 2
-            Top = 0
-            Width = 674
-            Height = 184
-            Align = alClient
-            Header.AutoSizeIndex = 7
-            Header.DefaultHeight = 17
-            Header.Font.Charset = DEFAULT_CHARSET
-            Header.Font.Color = clWindowText
-            Header.Font.Height = -11
-            Header.Font.Name = 'MS Sans Serif'
-            Header.Font.Style = []
-            Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoHotTrack, hoOwnerDraw, hoShowHint, hoShowSortGlyphs, hoVisible]
-            Header.SortColumn = 2
-            Header.Style = hsFlatButtons
-            ParentShowHint = False
-            ShowHint = True
-            TabOrder = 0
-            TreeOptions.AutoOptions = [toAutoDropExpand, toAutoScrollOnExpand, toAutoSort, toAutoTristateTracking, toAutoDeleteMovedNodes]
-            TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning]
-            TreeOptions.PaintOptions = [toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
-            TreeOptions.SelectionOptions = [toFullRowSelect]
-            OnCompareNodes = VDTPlayersCompareNodes
-            OnDrawNode = VDTPlayersDrawNode
-            OnHeaderClick = VDTPlayersHeaderClick
-            OnHeaderDraw = VDTPlayersHeaderDraw
-            Columns = &lt;
-              item
-                Position = 0
-                Width = 200
-                WideText = 'Player'
-              end
-              item
-                Position = 1
-                WideText = 'Id'
-              end
-              item
-                Position = 2
-                Width = 60
-                WideText = 'Team'
-              end
-              item
-                Position = 3
-                Width = 60
-                WideText = 'MP/M'
-                WideHint = 'Mouse movement in pixel per minute'
-              end
-              item
-                Position = 4
-                WideText = 'MC/M'
-                WideHint = 'Mouse clicks per minute'
-              end
-              item
-                Position = 5
-                WideText = 'KP/M'
-                WideHint = 'Keyboard presses per minute'
-              end
-              item
-                Position = 6
-                Width = 60
-                WideText = 'Cmds/M'
-                WideHint = 'Commands per minute'
-              end
-              item
-                Position = 7
-                Width = 140
-                WideText = 'ACS'
-                WideHint = 'Averange commands size (units affected per command)'
-              end&gt;
-          end
-        end
         object SpTBXTabSheet4: TSpTBXTabSheet
           Left = 0
           Top = 23
@@ -428,6 +348,86 @@
             OnChange = CommentsRichEditChange
           end
         end
+        object SpTBXTabSheet3: TSpTBXTabSheet
+          Left = 0
+          Top = 23
+          Width = 678
+          Height = 186
+          Caption = 'Players'
+          ImageIndex = -1
+          TabItem = 'PlayersTab'
+          object VDTPlayers: TVirtualDrawTree
+            Left = 2
+            Top = 0
+            Width = 674
+            Height = 184
+            Align = alClient
+            Header.AutoSizeIndex = 7
+            Header.DefaultHeight = 17
+            Header.Font.Charset = DEFAULT_CHARSET
+            Header.Font.Color = clWindowText
+            Header.Font.Height = -11
+            Header.Font.Name = 'MS Sans Serif'
+            Header.Font.Style = []
+            Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoHotTrack, hoOwnerDraw, hoShowHint, hoShowSortGlyphs, hoVisible]
+            Header.SortColumn = 2
+            Header.Style = hsFlatButtons
+            ParentShowHint = False
+            ShowHint = True
+            TabOrder = 0
+            TreeOptions.AutoOptions = [toAutoDropExpand, toAutoScrollOnExpand, toAutoSort, toAutoTristateTracking, toAutoDeleteMovedNodes]
+            TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning]
+            TreeOptions.PaintOptions = [toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
+            TreeOptions.SelectionOptions = [toFullRowSelect]
+            OnCompareNodes = VDTPlayersCompareNodes
+            OnDrawNode = VDTPlayersDrawNode
+            OnHeaderClick = VDTPlayersHeaderClick
+            OnHeaderDraw = VDTPlayersHeaderDraw
+            Columns = &lt;
+              item
+                Position = 0
+                Width = 200
+                WideText = 'Player'
+              end
+              item
+                Position = 1
+                WideText = 'Id'
+              end
+              item
+                Position = 2
+                Width = 60
+                WideText = 'Team'
+              end
+              item
+                Position = 3
+                Width = 60
+                WideText = 'MP/M'
+                WideHint = 'Mouse movement in pixel per minute'
+              end
+              item
+                Position = 4
+                WideText = 'MC/M'
+                WideHint = 'Mouse clicks per minute'
+              end
+              item
+                Position = 5
+                WideText = 'KP/M'
+                WideHint = 'Keyboard presses per minute'
+              end
+              item
+                Position = 6
+                Width = 60
+                WideText = 'Cmds/M'
+                WideHint = 'Commands per minute'
+              end
+              item
+                Position = 7
+                Width = 140
+                WideText = 'ACS'
+                WideHint = 'Averange commands size (units affected per command)'
+              end&gt;
+          end
+        end
       end
       object WatchButton: TSpTBXButton
         Left = 595

Modified: Lobby/TASClient/ReplaysUnit.pas
===================================================================
--- Lobby/TASClient/ReplaysUnit.pas	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/ReplaysUnit.pas	2010-03-30 18:48:36 UTC (rev 7451)
@@ -1524,6 +1524,11 @@
   i: integer;
   FlagBitmap: TBitmap;
   TempPenColor,TempBrushColor: TColor;
+  BgRect: TRect;
+  pt: TPoint;
+  hot: Boolean;
+  hi: THitInfo;
+  itemState: TSpTBXSkinStatesType;
 begin
   if not VDTReplays.Visible then
     Exit;
@@ -1535,14 +1540,37 @@
     Replay := GetReplayFromNode(VDTReplays.FocusedNode);
     ReplayPlayer := GetReplayPlayerFromNode(Node);
 
-    if (Node = FocusedNode) and Focused then
-      Canvas.Font.Color := clHighlightText
+    GetCursorPos(pt);
+    pt := ScreenToClient(pt);
+    GetHitTestInfoAt(pt.X,pt.Y,True,hi);
+
+    hot := (SkinManager.GetSkinType=sknSkin) and ReplaysForm.Active and (hi.HitNode = Node);
+
+    CopyRect(BgRect,CellRect);
+    if Position &lt;&gt; 0 then
+      BgRect.Left := -5;
+    if Position &lt;&gt; Header.Columns.Count-1 then
+      BgRect.Right := BgRect.Right+5;
+
+    if SkinManager.GetSkinType=sknSkin then
+    begin
+      itemState := SkinManager.CurrentSkin.GetState(True,False,hot,(Node = FocusedNode) and focused);
+      Canvas.Font.Color := SkinManager.CurrentSkin.GetTextColor(skncListItem,itemState);
+      SkinManager.CurrentSkin.PaintBackground(Canvas,BgRect,skncListItem,itemState,True,True);
+      Canvas.Brush.Style := Graphics.bsClear;
+    end
+    else if (Node = FocusedNode) and focused then
+    begin
+      Canvas.Font.Color := clHighlightText;
+      Canvas.Brush.Color := clHighlight;
+      Canvas.FillRect(CellRect);
+    end
     else
       Canvas.Font.Color := clWindowText;
 
     R := ContentRect;
 
-    if (Node &lt;&gt; VDTPlayers.FocusedNode) and (Replay.Version = 1) and (ReplayPlayer.Team = Replay.demoHeader.winningAllyTeam+1) and (Replay.demoHeader.winningAllyTeam &gt; -1) and not ReplayPlayer.Spectator then
+    if not hot and ((Node &lt;&gt; FocusedNode) or not focused) and (Replay.Version = 1) and (ReplayPlayer.Team = Replay.demoHeader.winningAllyTeam+1) and (Replay.demoHeader.winningAllyTeam &gt; -1) and not ReplayPlayer.Spectator then
     begin
       Canvas.Brush.Color := 12116153;
       Canvas.FillRect(CellRect);

Modified: Lobby/TASClient/TASClient.dpr
===================================================================
--- Lobby/TASClient/TASClient.dpr	2010-03-29 18:56:44 UTC (rev 7450)
+++ Lobby/TASClient/TASClient.dpr	2010-03-30 18:48:36 UTC (rev 7451)
@@ -240,12 +240,12 @@
   if MainUnit.Debug.Enabled then
     Misc.TryToAddLog(MainUnit.StartDebugLog,'Creating ChannelsListForm ...');
   Application.CreateForm(TChannelsListForm, ChannelsListForm);
-  if not MainUnit.NO3D then
+  {if not MainUnit.NO3D then
   begin
     if MainUnit.Debug.Enabled then
       Misc.TryToAddLog(MainUnit.StartDebugLog,'Creating Minimap3DPreview ...');
     //Application.CreateForm(TMinimap3DPreview, Minimap3DPreview);
-  end;
+  end;}
   if MainUnit.Debug.Enabled then
     Misc.TryToAddLog(MainUnit.StartDebugLog,'Creating MapSelectionForm ...');
   Application.CreateForm(TMapSelectionForm, MapSelectionForm);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002220.html">[Taspring-linux-commit] r7450 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="002222.html">[Taspring-linux-commit] r7452 - in Lobby/TASClient: .	LobbyComponents/DockPanel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2221">[ date ]</a>
              <a href="thread.html#2221">[ thread ]</a>
              <a href="subject.html#2221">[ subject ]</a>
              <a href="author.html#2221">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
