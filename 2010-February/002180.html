<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7410 - Lobby/TASClient
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2010-February/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7410%20-%20Lobby/TASClient&In-Reply-To=%3C20100210162604.E0A2A29CD4%40it-l.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002179.html">
   <LINK REL="Next"  HREF="002181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7410 - Lobby/TASClient</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7410%20-%20Lobby/TASClient&In-Reply-To=%3C20100210162604.E0A2A29CD4%40it-l.eu%3E"
       TITLE="[Taspring-linux-commit] r7410 - Lobby/TASClient">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Wed Feb 10 17:26:04 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002179.html">[Taspring-linux-commit] r7409 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="002181.html">[Taspring-linux-commit] r7411 - Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2180">[ date ]</a>
              <a href="thread.html#2180">[ thread ]</a>
              <a href="subject.html#2180">[ subject ]</a>
              <a href="author.html#2180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2010-02-10 17:26:04 +0100 (Wed, 10 Feb 2010)
New Revision: 7410

Added:
   Lobby/TASClient/SetStringsUnit.dfm
   Lobby/TASClient/SetStringsUnit.pas
Modified:
   Lobby/TASClient/BattleFormUnit.pas
   Lobby/TASClient/CustomizeGUIFormUnit.dfm
   Lobby/TASClient/CustomizeGUIFormUnit.pas
   Lobby/TASClient/LobbyScriptUnit.pas
   Lobby/TASClient/MainUnit.dfm
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/Misc.pas
   Lobby/TASClient/PreferencesFormUnit.pas
   Lobby/TASClient/SetValuesFormUnit.pas
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.dpr
   Lobby/TASClient/TASClient.res
   Lobby/TASClient/TemplateEditorFormUnit.dfm
   Lobby/TASClient/Utility.pas
Log:
* PYTHON : you can change and get TTntStrings properties
* PYTHON : you can load new pictures in TPicture TBitmap and TBitmap32
* Power user window : you can change TTntStrings, and load new pictures in TPicture TBitmap and TBitmap32

Modified: Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- Lobby/TASClient/BattleFormUnit.pas	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/BattleFormUnit.pas	2010-02-10 16:26:04 UTC (rev 7410)
@@ -8519,7 +8519,7 @@
 
 procedure TBattleForm.AutohostControlSplitterMoved(Sender: TObject);
 begin
-  ChatRichEdit.ScrollToBottom;  
+  ChatRichEdit.ScrollToBottom;
 end;
 
 end.

Modified: Lobby/TASClient/CustomizeGUIFormUnit.dfm
===================================================================
--- Lobby/TASClient/CustomizeGUIFormUnit.dfm	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/CustomizeGUIFormUnit.dfm	2010-02-10 16:26:04 UTC (rev 7410)
@@ -1,6 +1,6 @@
 object CustomizeGUIForm: TCustomizeGUIForm
-  Left = 425
-  Top = 210
+  Left = 702
+  Top = 142
   Width = 712
   Height = 520
   Caption = 'Poweruser window'
@@ -130,6 +130,7 @@
       BorderStyle = bsNone
       Color = clBtnFace
       DisplayOptions = [doAutoColResize, doKeyColFixed]
+      KeyOptions = [keyEdit]
       Options = [goFixedVertLine, goFixedHorzLine, goVertLine, goHorzLine, goColSizing, goEditing, goThumbTracking]
       ScrollBars = ssVertical
       Strings.Strings = (
@@ -279,6 +280,14 @@
           Caption = 'ScrollBox'
           OnClick = ScrollBox1Click
         end
+        object Image1: TMenuItem
+          Caption = 'Image'
+          OnClick = Image1Click
+        end
+        object Image321: TMenuItem
+          Caption = 'Image32'
+          OnClick = Image321Click
+        end
       end
       object Move1: TMenuItem
         Caption = 'Move'
@@ -309,4 +318,18 @@
     Left = 361
     Top = 72
   end
+  object OpenDialog1: TOpenDialog
+    Left = 401
+    Top = 72
+  end
+  object MultiActionPopupMenu: TPopupMenu
+    Left = 449
+    Top = 176
+  end
+  object SetStringsPopupMenu: TSpTBXFormPopupMenu
+    BorderStyle = pbsSizeableRightBottom
+    PopupFocus = True
+    Left = 48
+    Top = 184
+  end
 end

Modified: Lobby/TASClient/CustomizeGUIFormUnit.pas
===================================================================
--- Lobby/TASClient/CustomizeGUIFormUnit.pas	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/CustomizeGUIFormUnit.pas	2010-02-10 16:26:04 UTC (rev 7410)
@@ -6,7 +6,8 @@
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, VirtualTrees, StdCtrls, TntStdCtrls, SpTBXEditors, SpTBXControls,
   TBXDkPanels, TntForms, Buttons, Grids, ValEdit, Menus, SpTBXFormPopupMenu,
-  LobbyScriptUnit, ComCtrls, SpTBXTabs, STXControlResizer,Clipbrd;
+  LobbyScriptUnit, ComCtrls, SpTBXTabs, STXControlResizer,Clipbrd, OpenIL,GR32,
+  TntWideStrings;
 
 type
   TProperty = class
@@ -15,7 +16,7 @@
       FName: string;
       FObject: TObject;
 
-      procedure ValueChanged(v: Variant);
+      procedure ValueChanged(v: Variant);virtual;
 
     public
       constructor Create(name: string;value: Variant; obj: TObject);
@@ -25,6 +26,7 @@
       property Obj: TObject read FObject;
 
       procedure AddToList(l: TValueListEditor);
+      procedure OnEdit;virtual;
   end;
 
   TEnumerationProperty = class(TProperty)
@@ -35,25 +37,66 @@
   TSetProperty = class(TProperty)
     public
       procedure AddToList(l: TValueListEditor);
-      procedure ShowSetForm;
+      procedure OnEdit;override;
       procedure ChangeValue(v: string);
   end;
 
+  TStringsProperty = class(TProperty)
+    protected
+      FStrings: TWideStrings;
+    public
+      constructor Create(name: string;value: TWideStrings; obj: TObject);
+      procedure AddToList(l: TValueListEditor);
+      procedure OnEdit;override;
+      procedure ChangeValue(v: TWideStrings);
+  end;
+
   TClassProperty = class(TProperty)
     protected
       FValueObj: TObject;
     public
       constructor Create(name: string;value: TObject; obj: TObject);
       procedure AddToList(l: TValueListEditor);
-      procedure ListProperties;
+      procedure OnEdit;override;
   end;
 
+  TBitmap32Property = class(TProperty)
+    protected
+      FBmp32Obj: TBitmap32;
+    public
+      constructor Create(name: string;value: TBitmap32; obj: TObject);
+      procedure AddToList(l: TValueListEditor);
+      procedure OnEdit;override;
+      procedure LoadNewPicture(Sender: TObject);
+      procedure ShowProperties(Sender: TObject);
+  end;
+
   TColorProperty = class(TProperty)
     public
       procedure AddToList(l: TValueListEditor);
-      procedure ShowColorForm;
+      procedure OnEdit;override;
   end;
 
+  TPictureProperty = class(TProperty)
+    protected
+      FPictObj: TPicture;
+      procedure ValueChanged(v: Variant);override;
+    public
+      constructor Create(name: string;pictObj: TPicture; obj: TObject);
+      procedure AddToList(l: TValueListEditor);
+      procedure OnEdit;override;
+  end;
+
+  TBitmapProperty = class(TProperty)
+    protected
+      FBitmapObj: TBitmap;
+      procedure ValueChanged(v: Variant);override;
+    public
+      constructor Create(name: string;bmpObj: TBitmap; obj: TObject);
+      procedure AddToList(l: TValueListEditor);
+      procedure OnEdit;override;
+  end;
+
   THistoryItem = class
     public
       function getPythonCode(saveType: integer): string; virtual; abstract;
@@ -67,8 +110,9 @@
       FObject : TObject;
       FControl: TControl;
       FSubProp: string;
+      FDblQuoteResult: Boolean;
 
-      constructor Create(p: TProperty; newValue: Variant; subP: string; c: TControl);
+      constructor Create(p: TProperty; newValue: Variant; subP: string; c: TControl; dblQuoteResult : boolean = False);
       function getPythonCode(saveType: integer): string; override;
       procedure Revert; override;
   end;
@@ -146,6 +190,11 @@
     ScrollBox1: TMenuItem;
     DisplayResizer1: TMenuItem;
     Copycontrolpath1: TMenuItem;
+    OpenDialog1: TOpenDialog;
+    Image1: TMenuItem;
+    MultiActionPopupMenu: TPopupMenu;
+    SetStringsPopupMenu: TSpTBXFormPopupMenu;
+    Image321: TMenuItem;
     procedure Button1Click(Sender: TObject);
     procedure VDTControlsGetText(Sender: TBaseVirtualTree;
       Node: PVirtualNode; Column: TColumnIndex; TextType: TVSTTextType;
@@ -193,6 +242,8 @@
     procedure ScrollBox1Click(Sender: TObject);
     procedure DisplayResizer1Click(Sender: TObject);
     procedure Copycontrolpath1Click(Sender: TObject);
+    procedure Image1Click(Sender: TObject);
+    procedure Image321Click(Sender: TObject);
   protected
     NodeList: TList;
     NodeText: TStringList;
@@ -224,7 +275,8 @@
 
 implementation
 
-uses MainUnit, HelpUnit, Misc, SetValuesFormUnit, TemplateEditorFormUnit, gnugettext;
+uses MainUnit, HelpUnit, Misc, SetValuesFormUnit, TemplateEditorFormUnit, gnugettext,
+  SetStringsUnit;
 
 {$R *.dfm}
 
@@ -239,12 +291,71 @@
   end;
 end;
 
-procedure TClassProperty.ListProperties;
+procedure TBitmap32Property.LoadNewPicture(Sender: TObject);
+var
+  newVal: string;
 begin
+  CustomizeGUIForm.OpenDialog1.Filter := 'Picture files |*.jpg;*.bmp;*.gif;*.png;*.ico;*.tga';
+  if not CustomizeGUIForm.OpenDialog1.Execute then
+    Exit;
+  FBmp32Obj.LoadFromFile(CustomizeGUIForm.OpenDialog1.FileName);
+  newVal := StringReplace(CustomizeGUIForm.OpenDialog1.FileName,'\','\\',[rfReplaceAll]);
+  CustomizeGUIForm.AddToHistory(Self,newVal,CustomizeGUIForm.subProp,CustomizeGUIForm.CurrentControl);
+  FValue := newVal;
+end;
+procedure TBitmap32Property.ShowProperties(Sender: TObject);
+begin
   if CustomizeGUIForm.subProp = '' then
     CustomizeGUIForm.subProp := FName
   else
     CustomizeGUIForm.subProp := CustomizeGUIForm.subProp + '.' + FName;
+  CustomizeGUIForm.ListObjectProperties(FBmp32Obj);
+end;
+
+procedure TBitmap32Property.OnEdit;
+var
+  p: TPoint;
+begin
+  CustomizeGUIForm.MultiActionPopupMenu.Items.Clear;
+  CustomizeGUIForm.MultiActionPopupMenu.Items.Add(TMenuItem.Create(CustomizeGUIForm.MultiActionPopupMenu));
+  with CustomizeGUIForm.MultiActionPopupMenu.Items.Items[CustomizeGUIForm.MultiActionPopupMenu.Items.Count-1] do
+  begin
+    Caption := 'Load ...';
+    OnClick := Self.LoadNewPicture;
+  end;
+  CustomizeGUIForm.MultiActionPopupMenu.Items.Add(TMenuItem.Create(CustomizeGUIForm.MultiActionPopupMenu));
+  with CustomizeGUIForm.MultiActionPopupMenu.Items.Items[CustomizeGUIForm.MultiActionPopupMenu.Items.Count-1] do
+  begin
+    Caption := 'Properties ...';
+    OnClick := Self.ShowProperties;
+  end;
+  GetCursorPos(p);
+  CustomizeGUIForm.MultiActionPopupMenu.Popup(p.X,p.Y);
+end;
+
+constructor TBitmap32Property.Create(name: string;value: TBitmap32; obj: TObject);
+begin
+  FName := name;
+  FObject := obj;
+  FBmp32Obj := value;
+end;
+
+procedure TBitmap32Property.AddToList(l: TValueListEditor);
+begin
+  l.InsertRow(FName,FBmp32Obj.ClassName,True);
+  with l.ItemProps[FName] do
+  begin
+    EditStyle := esEllipsis;
+    ReadOnly := True;
+  end;
+end;
+
+procedure TClassProperty.OnEdit;
+begin
+  if CustomizeGUIForm.subProp = '' then
+    CustomizeGUIForm.subProp := FName
+  else
+    CustomizeGUIForm.subProp := CustomizeGUIForm.subProp + '.' + FName;
   CustomizeGUIForm.ListObjectProperties(FValueObj);
 end;
 
@@ -254,6 +365,7 @@
   FObject := obj;
   FValueObj := value;
 end;
+
 procedure TClassProperty.AddToList(l: TValueListEditor);
 begin
   l.InsertRow(FName,FValueObj.ClassName,True);
@@ -277,6 +389,10 @@
   l.InsertRow(FName,FValue,True);
 end;
 
+procedure TProperty.OnEdit;
+begin
+end;
+
 procedure TEnumerationProperty.AddToList(l: TValueListEditor);
 var
   enumList: TStringList;
@@ -310,7 +426,7 @@
   end;
 end;
 
-procedure TSetProperty.ShowSetForm;
+procedure TSetProperty.OnEdit;
 var
   p: TPoint;
   enumList: TStringList;
@@ -364,6 +480,61 @@
   CustomizeGUIForm.PropertiesListEditor.Values[FName] := v;
 end;
 
+constructor TStringsProperty.Create(name: string;value: TWideStrings; obj: TObject);
+begin
+  FName := name;
+  FObject := obj;
+  FStrings := value;
+end;
+
+procedure TStringsProperty.AddToList(l: TValueListEditor);
+var
+  enumList: TStringList;
+begin
+  enumList := TStringList.Create;
+
+  Misc.GetEnumPropertyList(FObject,FName,enumList);
+
+  l.InsertRow(FName,FStrings.Text,True);
+  with l.ItemProps[FName] do
+  begin
+    EditStyle := esEllipsis;
+    ReadOnly := True;
+  end;
+end;
+
+procedure TStringsProperty.OnEdit;
+var
+  p: TPoint;
+begin
+  SetStringsForm.StringsMemo.Lines.Assign(FStrings);
+  SetStringsForm.DisplayedProperty := Self;
+  GetCursorPos(p);
+  CustomizeGUIForm.SetStringsPopupMenu.Popup(p.X,p.Y);
+end;
+
+procedure TStringsProperty.ChangeValue(v: TWideStrings);
+var
+  i: integer;
+  newVal: string;
+begin
+  FStrings.Clear;
+  for i:=0 to v.Count-1 do
+  begin
+    if newVal = '' then
+      newVal := '[&quot;' + v.Strings[i] + '&quot;'
+    else
+      newVal := newVal + ', &quot;' + v.Strings[i] + '&quot;';
+    FStrings.Add(v.Strings[i]);
+  end;
+  newVal := newVal + ']';
+
+  CustomizeGUIForm.PropertiesListEditor.Values[FName] := FStrings.Text;
+
+  CustomizeGUIForm.AddToHistory(Self,newVal,CustomizeGUIForm.subProp,CustomizeGUIForm.CurrentControl);
+  FValue := newVal;
+end;
+
 procedure TColorProperty.AddToList(l: TValueListEditor);
 var
   enumList: TStringList;
@@ -380,11 +551,92 @@
   end;
 end;
 
-procedure TColorProperty.ShowColorForm;
+procedure TColorProperty.OnEdit;
 begin
   CustomizeGUIForm.PropertiesListEditor.Values[FName] := IntToStr(Misc.InputColor(FName,FValue));
 end;
 
+constructor TPictureProperty.Create(name: string;pictObj: TPicture; obj: TObject);
+begin
+  FName := name;
+  FObject := obj;
+  FPictObj := pictObj;
+end;
+
+procedure TPictureProperty.AddToList(l: TValueListEditor);
+var
+  enumList: TStringList;
+begin
+  enumList := TStringList.Create;
+
+  Misc.GetEnumPropertyList(FObject,FName,enumList);
+
+  l.InsertRow(FName,IntToStr(FPictObj.Width)+'x'+IntToStr(FPictObj.Height)+' picture',True);
+  with l.ItemProps[FName] do
+  begin
+    EditStyle := esEllipsis;
+    ReadOnly := False;
+  end;
+end;
+
+procedure TPictureProperty.OnEdit;
+var
+  newVal: string;
+begin
+  CustomizeGUIForm.OpenDialog1.Filter := 'Picture files |*.jpg;*.bmp;*.gif;*.png;*.ico;*.tga';
+  if not CustomizeGUIForm.OpenDialog1.Execute then
+    Exit;
+
+  if LoadPictureWithDevIL(CustomizeGUIForm.OpenDialog1.FileName,FPictObj) then
+  begin
+      newVal := StringReplace(CustomizeGUIForm.OpenDialog1.FileName,'\','\\',[rfReplaceAll]);
+      CustomizeGUIForm.AddToHistory(Self,newVal,CustomizeGUIForm.subProp,CustomizeGUIForm.CurrentControl);
+      FValue := newVal;
+      CustomizeGUIForm.PropertiesListEditor.Values[FName] := IntToStr(FPictObj.Width)+'x'+IntToStr(FPictObj.Height)+' picture';
+  end;
+end;
+
+constructor TBitmapProperty.Create(name: string;bmpObj: TBitmap; obj: TObject);
+begin
+  FName := name;
+  FObject := obj;
+  FBitmapObj := bmpObj;
+end;
+
+procedure TBitmapProperty.AddToList(l: TValueListEditor);
+var
+  enumList: TStringList;
+begin
+  enumList := TStringList.Create;
+
+  Misc.GetEnumPropertyList(FObject,FName,enumList);
+
+  l.InsertRow(FName,IntToStr(FBitmapObj.Width)+'x'+IntToStr(FBitmapObj.Height)+' picture',True);
+  with l.ItemProps[FName] do
+  begin
+    EditStyle := esEllipsis;
+    ReadOnly := False;
+  end;
+end;
+
+procedure TBitmapProperty.OnEdit;
+var
+  imgWidth,imgHeight: integer;
+  tmp,tmp2: TBitmap;
+  newVal: String;
+begin
+  CustomizeGUIForm.OpenDialog1.Filter := 'Picture files |*.jpg;*.bmp;*.gif;*.png;*.ico;*.tga';
+  if not CustomizeGUIForm.OpenDialog1.Execute then
+    Exit;
+  if LoadPictureWithDevIL(CustomizeGUIForm.OpenDialog1.FileName,FBitmapObj) then
+  begin
+      newVal := StringReplace(CustomizeGUIForm.OpenDialog1.FileName,'\','\\',[rfReplaceAll]);
+      CustomizeGUIForm.AddToHistory(Self,newVal,CustomizeGUIForm.subProp,CustomizeGUIForm.CurrentControl);
+      FValue := newVal;
+      CustomizeGUIForm.PropertiesListEditor.Values[FName] := IntToStr(FBitmapObj.Width)+'x'+IntToStr(FBitmapObj.Height)+' picture';
+  end;
+end;
+
 procedure TProperty.ValueChanged(v: Variant);
 begin
   try
@@ -395,6 +647,14 @@
   end;
 end;
 
+procedure TPictureProperty.ValueChanged(v: Variant);
+begin
+end;
+
+procedure TBitmapProperty.ValueChanged(v: Variant);
+begin
+end;
+
 procedure TCustomizeGUIForm.ListObjectProperties(c: TObject);
 var
   propNames: TStringList;
@@ -427,8 +687,31 @@
     end
     else if propTypes[i] = 'tkClass' then
     begin
-      p := TClassProperty.Create(propNames[i],TObject(propValue[i]),c);
-      TClassProperty(p).AddToList(PropertiesListEditor);
+      if TObject(propValue[i]).ClassType = TPicture then
+      begin
+        p := TPictureProperty.Create(propNames[i],TPicture(propValue[i]),c);
+        TPictureProperty(p).AddToList(PropertiesListEditor);
+      end
+      else if TObject(propValue[i]) is TWideStrings then
+      begin
+        p := TStringsProperty.Create(propNames[i],TWideStrings(propValue[i]),c);
+        TStringsProperty(p).AddToList(PropertiesListEditor);
+      end
+      else if TObject(propValue[i]).ClassType = TBitmap then
+      begin
+        p := TBitmapProperty.Create(propNames[i],TBitmap(propValue[i]),c);
+        TBitmapProperty(p).AddToList(PropertiesListEditor);
+      end
+      else if TObject(propValue[i]).ClassType = TBitmap32 then
+      begin
+        p := TBitmap32Property.Create(propNames[i],TBitmap32(propValue[i]),c);
+        TBitmap32Property(p).AddToList(PropertiesListEditor);
+      end
+      else
+      begin
+        p := TClassProperty.Create(propNames[i],TObject(propValue[i]),c);
+        TClassProperty(p).AddToList(PropertiesListEditor);
+      end;
     end
     else if propTypes[i] = 'tkSet' then
     begin
@@ -587,23 +870,13 @@
 var
   i:integer;
 begin
+  Caption := Sender.ClassName;
   for i:=0 to Properties.Count-1 do
     if (TProperty(Properties[i]).Name = PropertiesListEditor.Keys[PropertiesListEditor.Row]) then
-      if(TProperty(Properties[i]).ClassType = TClassProperty) then
-      begin
-        TClassProperty(Properties[i]).ListProperties;
-        Exit;
-      end
-      else if(TProperty(Properties[i]).ClassType = TSetProperty) then
-      begin
-        TSetProperty(Properties[i]).ShowSetForm;
-        Exit;
-      end
-      else if(TProperty(Properties[i]).ClassType = TColorProperty) then
-      begin
-        TColorProperty(Properties[i]).ShowColorForm;
-        Exit;
-      end;
+    begin
+      TProperty(Properties[i]).OnEdit;
+      Exit;
+    end;
 end;
 
 procedure TCustomizeGUIForm.VDTControlsClick(Sender: TObject);
@@ -968,7 +1241,7 @@
             if (p.FName = 'Left') or (p.FName = 'Top') or (p.FName = 'Width') or (p.FName = 'Height') then
               if THistoryItemProperty(history[i]).FPropName = 'Align' then
                 break;
-            if (THistoryItemProperty(history[i]).FObject = p.FObject) and (THistoryItemProperty(history[i]).FPropName = p.FName) then
+            if (THistoryItemProperty(history[i]).FObject = p.FObject) and (THistoryItemProperty(history[i]).FPropName = p.FName) and (THistoryItemProperty(history[i]).FSubProp = subP) then
             begin
               p.FValue := THistoryItemProperty(history[i]).FPropOldValue; // small hack :D
               history.Delete(i);
@@ -990,11 +1263,11 @@
             AddToHistory(prop,prop.FValue,subP,c,True);
         end;
       end;
-      history.Add(THistoryItemProperty.Create(p,newValue,subP,c));
+      history.Add(THistoryItemProperty.Create(p,newValue,subP,c,not(p is TStringsProperty)));
     end;
 end;
 
-constructor THistoryItemProperty.Create(p: TProperty; newValue: Variant; subP: string; c: TControl);
+constructor THistoryItemProperty.Create(p: TProperty; newValue: Variant; subP: string; c: TControl; dblQuoteResult : boolean = False);
 begin
   Self.FPropName := p.Name;
   Self.FPropOldValue := p.Value;
@@ -1002,6 +1275,7 @@
   Self.FControl := c;
   Self.FObject := p.FObject;
   Self.FSubProp := subP;
+  Self.FDblQuoteResult := dblQuoteResult;
 end;
 
 function THistoryItemProperty.getPythonCode(saveType: integer): string;
@@ -1014,7 +1288,10 @@
   Result := StringReplace(Result,'$control',GetStringFromComponent(TControl(Self.FControl)),[rfReplaceAll, rfIgnoreCase]);
   Result := StringReplace(Result,'$subprop',Self.FSubProp,[rfReplaceAll, rfIgnoreCase]);
   Result := StringReplace(Result,'$propname',Self.FPropName,[rfReplaceAll, rfIgnoreCase]);
-  Result := StringReplace(Result,'$newvalue',String(Self.FPropNewValue),[rfReplaceAll, rfIgnoreCase]);
+  if FDblQuoteResult then
+     Result := StringReplace(Result,'$newvalue','&quot;'+String(Self.FPropNewValue)+'&quot;',[rfReplaceAll, rfIgnoreCase])
+  else
+    Result := StringReplace(Result,'$newvalue',String(Self.FPropNewValue),[rfReplaceAll, rfIgnoreCase]);
 end;
 
 constructor THistoryItemControl.Create(control: TControl);
@@ -1254,4 +1531,14 @@
   end;
 end;
 
+procedure TCustomizeGUIForm.Image1Click(Sender: TObject);
+begin
+  AddControl('TImage');
+end;
+
+procedure TCustomizeGUIForm.Image321Click(Sender: TObject);
+begin
+  AddControl('TImage32');
+end;
+
 end.

Modified: Lobby/TASClient/LobbyScriptUnit.pas
===================================================================
--- Lobby/TASClient/LobbyScriptUnit.pas	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/LobbyScriptUnit.pas	2010-02-10 16:26:04 UTC (rev 7410)
@@ -4,9 +4,9 @@
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls,
   Dialogs,Misc,ExtCtrls, WrapDelphi, WrapDelphiClasses,PythonEngine,
-  PythonGUIInputOutput, StrUtils, JclDebug,
+  PythonGUIInputOutput, StrUtils, JclDebug,TntWideStrings,
   WSocket,MainUnit, class_TIntegerList, RichEdit2, ExRichEdit,
-  SyncObjs,SpTBXItem, TB2Item, JvDesktopAlert,
+  SyncObjs,SpTBXItem, TB2Item, JvDesktopAlert, GR32,
   SpTBXControls, SpTBXTabs,Forms, TBXDkPanels,ComCtrls, pngimage,
   Jpeg, Math, Dockpanel;
 
@@ -1873,11 +1873,12 @@
 var
   c : TControl;
   o: TObject;
-  i : integer;
+  i,j : integer;
   propNames : TStringList;
   propValues : TList;
   propTypes: TStringList;
   propSl: TStringList;
+  pyList: PPyObject;
 begin
   Result := GetPythonEngine.PyObjectAsVariant(GetPythonEngine.Py_None);
   try
@@ -1923,7 +1924,16 @@
 
     for i := 0 to propNames.Count-1 do
       if propTypes[i] = 'tkClass' then
-        PyDict_SetItemStringDecRef(pyProperties,PChar(propNames[i]),TObject(propValues[i]).ClassName)
+        if TObject(propValues[i]) is TWideStrings then
+        begin
+          pyList := PyList_New(TWideStrings(propValues[i]).Count);
+          for j:=0 to TWideStrings(propValues[i]).Count-1 do
+            PyList_SetItem(pyList,j,PyString_FromString(PChar(String(TWideStrings(propValues[i]).Strings[j]))));
+          PyDict_SetItemString(pyProperties,PChar(propNames[i]),pyList);
+          Py_XDECREF(pyList);
+        end
+        else
+          PyDict_SetItemStringDecRef(pyProperties,PChar(propNames[i]),TObject(propValues[i]).ClassName)
       else
         PyDict_SetItemStringDecRef(pyProperties,PChar(propNames[i]),Variant(propValues[i]^));
 
@@ -1950,6 +1960,8 @@
   propTypes: TStringList;
   propSl: TStringList;
 
+  tmpSl: TStringList;
+
   p: TProperty;
 begin
   Result := False;
@@ -2012,7 +2024,29 @@
             Result := False;
           end;
           p.Free;
-        end;
+        end
+        else if (propTypes[j] = 'tkClass') and (TObject(propValues[j]).ClassType = TBitmap32) then
+        begin
+          TBitmap32(propValues[j]).LoadFromFile(value);
+        end
+        else if (propTypes[j] = 'tkClass') and (TObject(propValues[j]).ClassType = TPicture) then
+        begin
+          LoadPictureWithDevIL(value,TPicture(propValues[j]));
+        end
+        else if (propTypes[j] = 'tkClass') and (TObject(propValues[j]).ClassType = TBitmap) then
+        begin
+          LoadPictureWithDevIL(value,TBitmap(propValues[j]));
+        end
+        else
+          if TObject(propValues[j]) is TWideStrings then
+            try
+              tmpSl := TStringList.Create;
+              GetPythonEngine.PyListToStrings(PyList_GetItem(values,i),tmpSl);
+              TWideStrings(propValues[j]).Clear;
+              TWideStrings(propValues[j]).AddStrings(tmpSl);
+              tmpSl.Free;
+            except
+            end;
       end;
       parent := PyString_AsString(PyDict_GetItem(properties,PyString_FromString('Parent')));
     end;

Modified: Lobby/TASClient/MainUnit.dfm
===================================================================
--- Lobby/TASClient/MainUnit.dfm	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/MainUnit.dfm	2010-02-10 16:26:04 UTC (rev 7410)
@@ -1,6 +1,6 @@
 object MainForm: TMainForm
-  Left = 367
-  Top = 128
+  Left = 289
+  Top = 467
   Width = 847
   Height = 521
   Caption = '.'
@@ -1030,6 +1030,16 @@
                     TabOrder = 15
                     OnClick = PlayersFilterClick
                   end
+                  object Image321: TImage32
+                    Left = 256
+                    Top = 64
+                    Width = 49
+                    Height = 33
+                    BitmapAlign = baTopLeft
+                    Scale = 1.000000000000000000
+                    ScaleMode = smNormal
+                    TabOrder = 16
+                  end
                 end
               end
             end

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/MainUnit.pas	2010-02-10 16:26:04 UTC (rev 7410)
@@ -402,7 +402,7 @@
   );
 
 const
-  VERSION_NUMBER = '0.60'; // Must be float value! (with a period as a decimal seperator)
+  VERSION_NUMBER = '0.61'; // Must be float value! (with a period as a decimal seperator)
   AUTOUPDATE_URL = '<A HREF="http://tasclient.no-ip.org/TASClient_update_v3.txt">http://tasclient.no-ip.org/TASClient_update_v3.txt</A>';
   PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER;
   KEEP_ALIVE_INTERVAL = 10000; // in milliseconds. Tells us what should be the maximum &quot;silence&quot; time before we send a ping to the server.
@@ -1211,6 +1211,7 @@
     DeleteLayoutSubmenu: TSpTBXSubmenuItem;
     mnuSpringOptions: TSpTBXItem;
     EnableFilters: TSpTBXCheckBox;
+    Image321: TImage32;
     procedure mnuOpenPrivateChatClick(Sender: TObject);
     procedure mnuSelectBattleClick(Sender: TObject);
     procedure mnuPlayWithClick(Sender: TObject);
@@ -1361,7 +1362,6 @@
     procedure AutojoinTimerTimer(Sender: TObject);
     procedure mnuAutoplayFirstAvailableClick(Sender: TObject);
     procedure mnuAutospecFirstAvailableClick(Sender: TObject);
-    procedure Button1Click(Sender: TObject);
     procedure ClearPlayersFilterButtonClick(Sender: TObject);
     procedure SpTBXButton1Click(Sender: TObject);
     procedure SpTBXItem5Click(Sender: TObject);
@@ -1788,7 +1788,7 @@
   ColorsPreferenceUnit, CustomizeGUIFormUnit, SetValuesFormUnit,
   TntWideStrings, SpringSettingsProfileFormUnit, gnugettext,
   AutoJoinFormUnit, AddBotUnit, Minimap3DPreviewUnit,
-  MinimapZoomedFormUnit, DisableUnitsFormUnit;
+  MinimapZoomedFormUnit, DisableUnitsFormUnit, SetStringsUnit;
 
 {$R *.dfm}
 
@@ -4183,6 +4183,7 @@
     SearchPlayerFormPopupMenu.PopupForm := SearchPlayerForm;
     BattleForm.MapsPopupMenu.PopupForm := MapSelectionForm;
     CustomizeGUIForm.SetValuesPopupMenu.PopupForm := SetValuesForm;
+    CustomizeGUIForm.SetStringsPopupMenu.PopupForm := SetStringsForm;
 
     OnlineMapsUnit.TReadCacheThrd.Create(False); // start reading online maps from cache
     ReplaysUnit.TReadReplaysThrd.Create(False); // start reading replays from disk
@@ -12058,7 +12059,7 @@
   if Preferences.ScriptsDisabled then Exit;
   if MainUnit.Debug.Enabled then
     Misc.TryToAddLog(MainUnit.StartDebugLog,'Initializing scripts ...');
-  RegisterClasses([TTntScrollBox ,TWebBrowserWrapper ,TSpTBXDock, TSpTBXMultiDock, TSpTBXToolbar, TSpTBXDockablePanel, TSpTBXTabSet, TSpTBXTabControl, TSpTBXStatusBar, TSpTBXLabel, TSpTBXCheckBox, TSpTBXRadioButton, TSpTBXProgressBar, TSpTBXTrackBar, TSpTBXSplitter, TSpTBXPanel, TSpTBXGroupBox, TSpTBXRadioGroup, TSpTBXEdit,TSpTBXSpinEdit, TSpTBXComboBox,TSpTBXListBox, TSpTBXCheckListBox, TExRichEdit, TImage32, TSpTBXButton]);
+  RegisterClasses([TImage, TTntScrollBox ,TWebBrowserWrapper ,TSpTBXDock, TSpTBXMultiDock, TSpTBXToolbar, TSpTBXDockablePanel, TSpTBXTabSet, TSpTBXTabControl, TSpTBXStatusBar, TSpTBXLabel, TSpTBXCheckBox, TSpTBXRadioButton, TSpTBXProgressBar, TSpTBXTrackBar, TSpTBXSplitter, TSpTBXPanel, TSpTBXGroupBox, TSpTBXRadioGroup, TSpTBXEdit,TSpTBXSpinEdit, TSpTBXComboBox,TSpTBXListBox, TSpTBXCheckListBox, TExRichEdit, TImage32, TSpTBXButton]);
   PyEngine.LoadDll;
   with GetPythonEngine do
   begin
@@ -12444,11 +12445,6 @@
   mnuAutoplayFirstAvailable.Checked := False;
 end;
 
-procedure TMainForm.Button1Click(Sender: TObject);
-begin
-  Caption := GetControlForm(TMyTabSheet(ChatTabs[1])).Name;
-end;
-
 procedure TMainForm.ClearPlayersFilterButtonClick(Sender: TObject);
 begin
   PlayerFiltersTextbox.Text := '';

Modified: Lobby/TASClient/Misc.pas
===================================================================
--- Lobby/TASClient/Misc.pas	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/Misc.pas	2010-02-10 16:26:04 UTC (rev 7410)
@@ -13,7 +13,7 @@
   SpTBXTabs,SpTBXItem,JvSpin,Dialogs, Classes, ComCtrls, Windows, Graphics, MMSystem,
   Controls, Registry, SysUtils,RichEdit2, ExRichEdit, WSocket, Winsock,
   ESBDates, GpTimeZone, JvColorCombo, Forms,StdCtrls,HttpProt,TntComCtrls,
-  JclUnicode,TntSysUtils,PreferencesFormUnit,Variants,typinfo;
+  JclUnicode,TntSysUtils,PreferencesFormUnit,Variants,typinfo, OpenIL;
 
 type
   TColorData = Array[0..128000] Of TRGBTriple;
@@ -176,6 +176,8 @@
 function getLanguageNameIgnoreCase(langcode:string):string;
 function GetWinVersion: string;
 function GetControlForm(control : TWinControl): TCustomForm;
+function LoadPictureWithDevIL(fileName: string; pict: TPicture): boolean;overload;
+function LoadPictureWithDevIL(fileName: string; bmp: TBitmap): boolean;overload;
 
 
 implementation
@@ -3038,5 +3040,68 @@
   Result := TForm(c);
 end;
 
+function LoadPictureWithDevIL(fileName: string; pict: TPicture): boolean;
+var
+  tmp,tmp2: TBitmap;
+begin
+  Result := False;
+  ilDisable(IL_ORIGIN_SET);
+  if ilLoadImage(PChar(fileName)) = IL_TRUE then
+  begin
+    tmp := TBitmap.Create;
 
+    tmp.Width := ilGetInteger(IL_IMAGE_WIDTH);
+    tmp.Height := ilGetInteger(IL_IMAGE_HEIGHT);
+
+    tmp.PixelFormat := pf24bit;
+
+    ilCopyPixels(0,0,0,tmp.Width,tmp.Height,1,IL_BGR,IL_BYTE,tmp.ScanLine[tmp.Height-1]);
+
+    if LowerCase(RightStr(fileName,3)) &lt;&gt; 'bmp' then
+    begin
+      tmp2 := TBitmap.Create;
+      BitmapFlip(True,False,tmp,tmp2);
+      pict.Assign(tmp2);
+      tmp2.FreeImage;
+      tmp2.Free;
+    end
+    else
+      pict.Assign(tmp);
+
+    tmp.FreeImage;
+    tmp.Free;
+    Result := True;
+  end;
+end;
+
+function LoadPictureWithDevIL(fileName: string; bmp: TBitmap): boolean;
+var
+  tmp: TBitmap;
+begin
+  Result := False;
+  ilDisable(IL_ORIGIN_SET);
+  if ilLoadImage(PChar(fileName)) = IL_TRUE then
+  begin
+    tmp := TBitmap.Create;
+    
+    tmp.Width := ilGetInteger(IL_IMAGE_WIDTH);
+    tmp.Height := ilGetInteger(IL_IMAGE_HEIGHT);
+
+    tmp.PixelFormat := pf24bit;
+
+    ilCopyPixels(0,0,0,tmp.Width,tmp.Height,1,IL_BGR,IL_BYTE,tmp.ScanLine[tmp.Height-1]);
+
+    if LowerCase(RightStr(fileName,3)) &lt;&gt; 'bmp' then
+      BitmapFlip(True,False,tmp,bmp)
+    else
+      bmp.Assign(tmp);
+
+    tmp.FreeImage;
+    tmp.Free;
+
+    Result := True;
+  end;
+end;
+
+
 end.

Modified: Lobby/TASClient/PreferencesFormUnit.pas
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.pas	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/PreferencesFormUnit.pas	2010-02-10 16:26:04 UTC (rev 7410)
@@ -554,9 +554,9 @@
 
     try TipsForm.chkShowTips.Checked := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TipsForm', 'ShowTips'); except end;
 
-    try TemplateEditorForm.ProfileTemplate.Lines.Text := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'LayoutGlobal'); except end;
-    try TemplateEditorForm.LayoutPropertyChange.Lines.Text := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'LayoutProperty'); except end;
-    try TemplateEditorForm.RecordPropertyChange.Lines.Text := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'RecordProperty'); except end;
+    try TemplateEditorForm.ProfileTemplate.Lines.Text := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'LayoutGlobal2'); except end;
+    try TemplateEditorForm.LayoutPropertyChange.Lines.Text := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'LayoutProperty2'); except end;
+    try TemplateEditorForm.RecordPropertyChange.Lines.Text := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'RecordProperty2'); except end;
 
     ReadPreferencesRecordFromRegistry(Preferences);
   except
@@ -761,9 +761,9 @@
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences\OtherColors', 'MapModUnavailable', rdInteger, Colors.MapModUnavailable);
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences\OtherColors', 'BotText', rdInteger, Colors.BotText);
 
-    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'LayoutGlobal', rdString, TemplateEditorForm.ProfileTemplate.Lines.Text);
-    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'LayoutProperty', rdString, TemplateEditorForm.LayoutPropertyChange.Lines.Text);
-    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'RecordProperty', rdString, TemplateEditorForm.RecordPropertyChange.Lines.Text);
+    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'LayoutGlobal2', rdString, TemplateEditorForm.ProfileTemplate.Lines.Text);
+    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'LayoutProperty2', rdString, TemplateEditorForm.LayoutPropertyChange.Lines.Text);
+    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\TemplateEditor', 'RecordProperty2', rdString, TemplateEditorForm.RecordPropertyChange.Lines.Text);
   except
   end;
 end;

Added: Lobby/TASClient/SetStringsUnit.dfm
===================================================================
--- Lobby/TASClient/SetStringsUnit.dfm	                        (rev 0)
+++ Lobby/TASClient/SetStringsUnit.dfm	2010-02-10 16:26:04 UTC (rev 7410)
@@ -0,0 +1,28 @@
+object SetStringsForm: TSetStringsForm
+  Left = 192
+  Top = 107
+  Width = 237
+  Height = 225
+  Caption = 'SetStringsForm'
+  Color = clBtnFace
+  Font.Charset = DEFAULT_CHARSET
+  Font.Color = clWindowText
+  Font.Height = -11
+  Font.Name = 'MS Sans Serif'
+  Font.Style = []
+  OldCreateOrder = False
+  DesignSize = (
+    229
+    198)
+  PixelsPerInch = 96
+  TextHeight = 13
+  object StringsMemo: TTntMemo
+    Left = 8
+    Top = 8
+    Width = 209
+    Height = 177
+    Anchors = [akLeft, akTop, akRight, akBottom]
+    TabOrder = 0
+    OnChange = StringsMemoChange
+  end
+end

Added: Lobby/TASClient/SetStringsUnit.pas
===================================================================
--- Lobby/TASClient/SetStringsUnit.pas	                        (rev 0)
+++ Lobby/TASClient/SetStringsUnit.pas	2010-02-10 16:26:04 UTC (rev 7410)
@@ -0,0 +1,32 @@
+unit SetStringsUnit;
+
+interface
+
+uses
+  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
+  Dialogs, StdCtrls, TntStdCtrls,CustomizeGUIFormUnit,gnugettext;
+
+type
+  TSetStringsForm = class(TForm)
+    StringsMemo: TTntMemo;
+    procedure StringsMemoChange(Sender: TObject);
+  private
+    { Private declarations }
+  public
+    DisplayedProperty: TStringsProperty;
+  end;
+
+var
+  SetStringsForm: TSetStringsForm;
+
+implementation
+
+{$R *.dfm}
+
+procedure TSetStringsForm.StringsMemoChange(Sender: TObject);
+begin
+  if StringsMemo.Focused then
+    DisplayedProperty.ChangeValue(StringsMemo.Lines);
+end;
+
+end.

Modified: Lobby/TASClient/SetValuesFormUnit.pas
===================================================================
--- Lobby/TASClient/SetValuesFormUnit.pas	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/SetValuesFormUnit.pas	2010-02-10 16:26:04 UTC (rev 7410)
@@ -4,7 +4,8 @@
 
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
-  Dialogs, TBXDkPanels, SpTBXControls, Grids, ValEdit, CustomizeGUIFormUnit, gnugettext;
+  Dialogs, TBXDkPanels, SpTBXControls, Grids, ValEdit, CustomizeGUIFormUnit,
+  gnugettext;
 
 type
   TSetValuesForm = class(TForm)

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/TASClient.dof	2010-02-10 16:26:04 UTC (rev 7410)
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=58
 Release=0
-Build=778
+Build=782
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=Spring RTS Engine lobby client
-FileVersion=0.58.0.778
+FileVersion=0.58.0.782
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.dpr
===================================================================
--- Lobby/TASClient/TASClient.dpr	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/TASClient.dpr	2010-02-10 16:26:04 UTC (rev 7410)
@@ -122,7 +122,8 @@
   gnugettext in '..\..\..\Program Files\dxgettext\gnugettext.pas',
   AutoJoinFormUnit in 'AutoJoinFormUnit.pas' {AutoJoinForm},
   Minimap3DPreviewUnit in 'Minimap3DPreviewUnit.pas' {Minimap3DPreview},
-  GIFImage in 'GIFImage.pas';
+  GIFImage in 'GIFImage.pas',
+  SetStringsUnit in 'SetStringsUnit.pas' {SetStringsForm};
 
 var
   i: Integer;
@@ -257,6 +258,7 @@
   if MainUnit.Debug.Enabled then
     Misc.TryToAddLog(MainUnit.StartDebugLog,'Creating MainForm ...');
   Application.CreateForm(TMainForm, MainForm);
+  Application.CreateForm(TSetStringsForm, SetStringsForm);
   if not MainUnit.NO3D then
   begin
     if MainUnit.Debug.Enabled then

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)

Modified: Lobby/TASClient/TemplateEditorFormUnit.dfm
===================================================================
--- Lobby/TASClient/TemplateEditorFormUnit.dfm	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/TemplateEditorFormUnit.dfm	2010-02-10 16:26:04 UTC (rev 7410)
@@ -118,9 +118,7 @@
       Height = 66
       Align = alTop
       Lines.Strings = (
-        
-          #9'changeControlProp(&quot;$control&quot;,&quot;$subprop&quot;,&quot;$propname&quot;,&quot;$newvalue&quot;' +
-          ');')
+        #9'changeControlProp(&quot;$control&quot;,&quot;$subprop&quot;,&quot;$propname&quot;,$newvalue);')
       TabOrder = 0
     end
   end

Modified: Lobby/TASClient/Utility.pas
===================================================================
--- Lobby/TASClient/Utility.pas	2010-02-06 16:00:58 UTC (rev 7409)
+++ Lobby/TASClient/Utility.pas	2010-02-10 16:26:04 UTC (rev 7410)
@@ -566,7 +566,6 @@
   size: integer;
   res: Integer;
   imgWidth,imgHeight: integer;
-  tmp: TBitmap;
   imgType: Cardinal;
 begin
   Result := TBitmap.Create;
@@ -609,24 +608,19 @@
     else
       imgType := IL_TYPE_UNKNOWN;
 
+    ilEnable(IL_ORIGIN_SET);
+    ilOriginFunc(IL_ORIGIN_LOWER_LEFT);
     if ilLoadL(imgType,Pointer(picture),size) = IL_TRUE then
     begin
-      tmp := TBitmap.Create;
-
       imgWidth := ilGetInteger(IL_IMAGE_WIDTH);
       imgHeight := ilGetInteger(IL_IMAGE_HEIGHT);
 
-      tmp.Width := imgWidth;
-      tmp.Height := imgHeight;
+      Result.Width := imgWidth;
+      Result.Height := imgHeight;
 
-      tmp.PixelFormat := pf24bit;
+      Result.PixelFormat := pf24bit;
 
-      ilCopyPixels(0,0,0,imgWidth,imgHeight,1,IL_BGR,IL_BYTE,tmp.ScanLine[imgHeight-1]);
-
-      BitmapFlip(True,True,tmp,Result);
-
-      tmp.FreeImage;
-      tmp.Free;
+      ilCopyPixels(0,0,0,imgWidth,imgHeight,1,IL_BGR,IL_BYTE,Result.ScanLine[imgHeight-1]);
     end;
   end;
 end;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002179.html">[Taspring-linux-commit] r7409 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="002181.html">[Taspring-linux-commit] r7411 - Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2180">[ date ]</a>
              <a href="thread.html#2180">[ thread ]</a>
              <a href="subject.html#2180">[ subject ]</a>
              <a href="author.html#2180">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
