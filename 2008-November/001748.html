<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6979 - in branches/caiinterface:	AI/Interfaces AI/Interfaces/C AI/Skirmish	AI/Skirmish/CSAI/ABICompatibilityLayer	AI/Skirmish/CSAI/CSAILoader rts/ExternalAI rts/ExternalAI/Interface
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-November/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6979%20-%20in%20branches/caiinterface%3A%0A%09AI/Interfaces%20AI/Interfaces/C%20AI/Skirmish%0A%09AI/Skirmish/CSAI/ABICompatibilityLayer%0A%09AI/Skirmish/CSAI/CSAILoader%20rts/ExternalAI%20rts/ExternalAI/Interface&In-Reply-To=%3C20081105151302.98FDC4763%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001747.html">
   <LINK REL="Next"  HREF="001749.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6979 - in branches/caiinterface:	AI/Interfaces AI/Interfaces/C AI/Skirmish	AI/Skirmish/CSAI/ABICompatibilityLayer	AI/Skirmish/CSAI/CSAILoader rts/ExternalAI rts/ExternalAI/Interface</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6979%20-%20in%20branches/caiinterface%3A%0A%09AI/Interfaces%20AI/Interfaces/C%20AI/Skirmish%0A%09AI/Skirmish/CSAI/ABICompatibilityLayer%0A%09AI/Skirmish/CSAI/CSAILoader%20rts/ExternalAI%20rts/ExternalAI/Interface&In-Reply-To=%3C20081105151302.98FDC4763%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6979 - in branches/caiinterface:	AI/Interfaces AI/Interfaces/C AI/Skirmish	AI/Skirmish/CSAI/ABICompatibilityLayer	AI/Skirmish/CSAI/CSAILoader rts/ExternalAI rts/ExternalAI/Interface">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Wed Nov  5 16:13:02 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001747.html">[Taspring-linux-commit] r6978 - in branches/caiinterface:	AI/Interfaces/Java AI/Skirmish/RAI rts/ExternalAI	rts/ExternalAI/Interface
</A></li>
        <LI>Next message: <A HREF="001749.html">[Taspring-linux-commit] r6980 - in branches/caiinterface:	installer/builddata/springcontent/gamedata rts/Game	rts/Game/StartScripts rts/Game/UI rts/Lua	rts/Rendering/UnitModels rts/Sim/Misc rts/Sim/Projectiles	rts/Sim/Projectiles/WeaponProjectiles rts/Sim/Units	rts/Sim/Weapons rts/System rts/build/vstudio8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1748">[ date ]</a>
              <a href="thread.html#1748">[ thread ]</a>
              <a href="subject.html#1748">[ subject ]</a>
              <a href="author.html#1748">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-11-05 16:13:01 +0100 (Wed, 05 Nov 2008)
New Revision: 6979

Modified:
   branches/caiinterface/AI/Interfaces/C/Interface.cpp
   branches/caiinterface/AI/Interfaces/C/Interface.h
   branches/caiinterface/AI/Interfaces/CMakeLists.txt
   branches/caiinterface/AI/Skirmish/CMakeLists.txt
   branches/caiinterface/AI/Skirmish/CSAI/ABICompatibilityLayer/AbicProxy.h
   branches/caiinterface/AI/Skirmish/CSAI/CSAILoader/CSAIProxy.h
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h
   branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp
   branches/caiinterface/rts/ExternalAI/AILibraryManager.h
   branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h
   branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/aidefines.h
   branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h
Log:
* no more &quot;impls&quot; dirs: AI binaries are now searched in the same directory where their AIInfo.lua lies.
* some small cleanups and fixes

Modified: branches/caiinterface/AI/Interfaces/C/Interface.cpp
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-11-05 15:13:01 UTC (rev 6979)
@@ -40,10 +40,12 @@
 
 #define MAX_INFOS 128
 
+/*
 std::string CInterface::relSkirmishAIImplsDir =
 		std::string(SKIRMISH_AI_IMPLS_DIR) + PS;
 std::string CInterface::relGroupAIImplsDir =
 		std::string(GROUP_AI_IMPLS_DIR) + PS;
+*/
 	
 CInterface::CInterface(const SStaticGlobalData* staticGlobalData) {
 	
@@ -51,18 +53,18 @@
 		springDataDirs.push_back(staticGlobalData-&gt;dataDirs[i]);
 	}
 	
-	// example: &quot;AI/Interfaces/data/C&quot;
+	// example: &quot;AI/Interfaces/C&quot;
 	std::string myDataDirRelative =
 			std::string(AI_INTERFACES_DATA_DIR) + PS + MY_SHORT_NAME;
-	// example: &quot;AI/Interfaces/data/C/0.1&quot;
+	// example: &quot;AI/Interfaces/C/0.1&quot;
 	std::string myDataDirVersRelative = myDataDirRelative + PS + MY_VERSION;
 	
-	// &quot;C:/Games/spring/AI/Interfaces/data/C&quot;
+	// &quot;C:/Games/spring/AI/Interfaces/C&quot;
 	myDataDir = FindDir(myDataDirRelative, true, true);
 	if (!FileExists(myDataDir)) {
 		MakeDirRecursive(myDataDir);
 	}
-	// &quot;C:/Games/spring/AI/Interfaces/data/C/0.1&quot;
+	// &quot;C:/Games/spring/AI/Interfaces/C/0.1&quot;
 	myDataDirVers = FindDir(myDataDirVersRelative, true, true);
 	if (!FileExists(myDataDirVers)) {
 		MakeDirRecursive(myDataDirVers);
@@ -392,22 +394,31 @@
 
 std::string CInterface::FindLibFile(const SSAISpecifier&amp; sAISpecifier) {
 	
-	// fetch the file from the info about this interface
-	// which were supplied to us by the engine
+	// fetch the data-dir and file-name from the info about the AI to load,
+	// which was supplied to us by the engine
 	T_skirmishAIInfos::const_iterator info =
 			mySkirmishAIInfos.find(sAISpecifier);
 	if (info == mySkirmishAIInfos.end()) {
 		reportError(std::string(&quot;Missing Skirmish-AI info for &quot;)
 				+ sAISpecifier.shortName + &quot; &quot; + sAISpecifier.version);
 	}
-	std::map&lt;std::string, InfoItem&gt;::const_iterator fileName =
-			info-&gt;second.find(SKIRMISH_AI_PROPERTY_FILE_NAME);
-	if (fileName == info-&gt;second.end()) {
+	
+	std::map&lt;std::string, InfoItem&gt;::const_iterator prop =
+			info-&gt;second.find(SKIRMISH_AI_PROPERTY_DATA_DIR);
+	if (prop == info-&gt;second.end()) {
+		reportError(std::string(&quot;Missing Skirmish-AI data dir for &quot;)
+				+ sAISpecifier.shortName + &quot; &quot; + sAISpecifier.version);
+	}
+	const std::string&amp; dataDir(prop-&gt;second.value);
+	
+	prop = info-&gt;second.find(SKIRMISH_AI_PROPERTY_FILE_NAME);
+	if (prop == info-&gt;second.end()) {
 		reportError(std::string(&quot;Missing Skirmish-AI file name for &quot;)
 				+ sAISpecifier.shortName + &quot; &quot; + sAISpecifier.version);
 	}
+	const std::string&amp; fileName(prop-&gt;second.value);
 	
-	std::string libFileName = fileName-&gt;second.value; // eg. RAI-0.600
+	std::string libFileName(fileName); // eg. RAI-0.600
 	#ifndef _WIN32
 		libFileName = &quot;lib&quot; + libFileName; // eg. libRAI-0.600
 	#endif
@@ -415,26 +426,36 @@
 	// eg. libRAI-0.600.so
 	libFileName = libFileName + &quot;.&quot; + SharedLib::GetLibExtension();
 	
-	return FindFile(relSkirmishAIImplsDir + libFileName);
+	//return FindFile(dataDir + PS + libFileName);
+	return dataDir + PS + libFileName;
 }
 
 std::string CInterface::FindLibFile(const SGAISpecifier&amp; gAISpecifier) {
 	
-	// fetch the file from the info about this interface
-	// which were supplied to us by the engine
+	// fetch the data-dir and file-name from the info about the AI to load,
+	// which was supplied to us by the engine
 	T_groupAIInfos::const_iterator info = myGroupAIInfos.find(gAISpecifier);
 	if (info == myGroupAIInfos.end()) {
 		reportError(std::string(&quot;Missing Group-AI info for &quot;)
 				+ gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
 	}
-	std::map&lt;std::string, InfoItem&gt;::const_iterator fileName =
-			info-&gt;second.find(GROUP_AI_PROPERTY_FILE_NAME);
-	if (fileName == info-&gt;second.end()) {
+	
+	std::map&lt;std::string, InfoItem&gt;::const_iterator prop =
+			info-&gt;second.find(GROUP_AI_PROPERTY_DATA_DIR);
+	if (prop == info-&gt;second.end()) {
+		reportError(std::string(&quot;Missing Group-AI data dir for &quot;)
+				+ gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
+	}
+	const std::string&amp; dataDir(prop-&gt;second.value);
+	
+	prop = info-&gt;second.find(GROUP_AI_PROPERTY_FILE_NAME);
+	if (prop == info-&gt;second.end()) {
 		reportError(std::string(&quot;Missing Group-AI file name for &quot;)
 				+ gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
 	}
+	const std::string&amp; fileName(prop-&gt;second.value);
 	
-	std::string libFileName = fileName-&gt;second.value; // eg. MetalMaker-1.0
+	std::string libFileName(fileName); // eg. MetalMaker-1.0
 	#ifndef _WIN32
 		libFileName = &quot;lib&quot; + libFileName; // eg. libMetalMaker-1.0
 	#endif
@@ -442,7 +463,8 @@
 	// eg. libMetalMaker-1.0.so
 	libFileName = libFileName + &quot;.&quot; + SharedLib::GetLibExtension();
 	
-	return FindFile(relGroupAIImplsDir + libFileName);
+	//return FindFile(dataDir + PS + libFileName);
+	return dataDir + PS + libFileName;
 }
 
 bool CInterface::FileExists(const std::string&amp; filePath) {

Modified: branches/caiinterface/AI/Interfaces/C/Interface.h
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/AI/Interfaces/C/Interface.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -98,8 +98,8 @@
 	bool FitsThisInterface(const std::string&amp; requestedShortName,
 			const std::string&amp; requestedVersion);
 private:
-	static std::string relSkirmishAIImplsDir;
-	static std::string relGroupAIImplsDir;
+//	static std::string relSkirmishAIImplsDir;
+//	static std::string relGroupAIImplsDir;
 	
 	std::vector&lt;std::string&gt; springDataDirs;
 	/**

Modified: branches/caiinterface/AI/Interfaces/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-11-05 15:13:01 UTC (rev 6979)
@@ -6,8 +6,7 @@
 add_definitions(-DBUILDING_AI_INTERFACE)
 
 set(AI_INTERFACES_SRC &quot;${CMAKE_SOURCE_DIR}/AI/Interfaces&quot;)
-set(AI_INTERFACES_LIBS &quot;${DATADIR}/AI/Interfaces/impls&quot;)
-set(AI_INTERFACES_DATA &quot;${DATADIR}/AI/Interfaces/data&quot;)
+set(AI_INTERFACES_DATA &quot;${DATADIR}/AI/Interfaces&quot;)
 
 
 # C &amp; C++ AI Interface
@@ -18,6 +17,7 @@
 		file(STRINGS &quot;${C_AIINTERFACE_SRC}/VERSION&quot; C_AIINTERFACE_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${C_AIINTERFACE_SRC}/VERSION)
 	set(C_AIINTERFACE_TARGET &quot;C-${C_AIINTERFACE_VERS}&quot;)
+	set(C_AIINTERFACE_DATA_DIR ${AI_INTERFACES_DATA}/C/${C_AIINTERFACE_VERS})
 	message(STATUS &quot;${C_AIINTERFACE_VERS}\t(C AI Interface Version)&quot;)
 
 	aux_source_directory(${C_AIINTERFACE_SRC} cAIInterface)
@@ -28,8 +28,8 @@
 		list (APPEND cAIInterface ${CMAKE_SOURCE_DIR}/rts/System/Platform/Win/DllLib)
 	endif (UNIX)
 	add_library(${C_AIINTERFACE_TARGET} MODULE ${cAIInterface} ${aienv}) # ${errorhandler})
-	install (FILES ${C_AIINTERFACE_SRC}/InterfaceInfo.lua DESTINATION ${AI_INTERFACES_DATA}/C/${C_AIINTERFACE_VERS})
-	install (TARGETS ${C_AIINTERFACE_TARGET} DESTINATION ${AI_INTERFACES_LIBS})
+	install (FILES ${C_AIINTERFACE_SRC}/InterfaceInfo.lua DESTINATION ${C_AIINTERFACE_DATA_DIR})
+	install (TARGETS ${C_AIINTERFACE_TARGET} DESTINATION ${C_AIINTERFACE_DATA_DIR})
 endif (EXISTS ${C_AIINTERFACE_SRC})
 
 
@@ -57,13 +57,14 @@
 		file(STRINGS &quot;${Java_AIINTERFACE_SRC}/VERSION&quot; Java_AIINTERFACE_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${Java_AIINTERFACE_SRC}/VERSION)
 	set(Java_AIINTERFACE_TARGET &quot;Java-${Java_AIINTERFACE_VERS}&quot;)
+	set(Java_AIINTERFACE_DATA_DIR ${AI_INTERFACES_DATA}/Java/${Java_AIINTERFACE_VERS})
 	message(STATUS &quot;${Java_AIINTERFACE_VERS}\t(Java AI Interface Version)&quot;)
 
 	aux_source_directory(${Java_AIINTERFACE_SRC} javaAIInterface)
 	add_library(${Java_AIINTERFACE_TARGET} MODULE ${javaAIInterface} ${aienv})
 	target_link_libraries(${Java_AIINTERFACE_TARGET} ${JAVA_JVM_LIBRARY})
-	install (FILES ${Java_AIINTERFACE_SRC}/InterfaceInfo.lua DESTINATION ${AI_INTERFACES_DATA}/Java/${Java_AIINTERFACE_VERS})
-	install (TARGETS ${Java_AIINTERFACE_TARGET} DESTINATION ${AI_INTERFACES_LIBS})
+	install (FILES ${Java_AIINTERFACE_SRC}/InterfaceInfo.lua DESTINATION ${Java_AIINTERFACE_DATA_DIR})
+	install (TARGETS ${Java_AIINTERFACE_TARGET} DESTINATION ${Java_AIINTERFACE_DATA_DIR})
 	INCLUDE_DIRECTORIES(BEFORE ${CMAKE_SOURCE_DIR}/rts/lib/streflop)
 	TARGET_LINK_LIBRARIES(${Java_AIINTERFACE_TARGET} streflop)
 	set_target_properties(${Java_AIINTERFACE_TARGET} PROPERTIES COMPILE_FLAGS &quot;-DSTREFLOP_X87&quot;)
@@ -76,11 +77,12 @@
 	ENDIF(UNIX)
 
 	# Install the Java part of the interface
-	install (FILES ${Java_AIINTERFACE_SRC}/java/interface.jar DESTINATION ${AI_INTERFACES_DATA}/Java/${Java_AIINTERFACE_VERS}/jlib)
-	install(DIRECTORY ${Java_AIINTERFACE_SRC}/jlib/ DESTINATION ${AI_INTERFACES_DATA}/Java/${Java_AIINTERFACE_VERS}/jlib FILES_MATCHING PATTERN &quot;*.jar&quot;)
+	install (FILES ${Java_AIINTERFACE_SRC}/java/interface.jar DESTINATION ${Java_AIINTERFACE_DATA_DIR}/jlib)
+	install(DIRECTORY ${Java_AIINTERFACE_SRC}/jlib/ DESTINATION ${Java_AIINTERFACE_DATA_DIR}/jlib FILES_MATCHING PATTERN &quot;*.jar&quot;)
 
 	# Install the Java test Skirmish AI
-	install (FILES ${Java_AIINTERFACE_SRC}/java/ai.jar DESTINATION ${CMAKE_SOURCE_DIR}/AI/Skirmish/hoijuiAI/jlib)
-	install (FILES ${Java_AIINTERFACE_SRC}/AIInfo.lua DESTINATION ${CMAKE_SOURCE_DIR}/AI/Skirmish/hoijuiAI)
+	#install (FILES ${Java_AIINTERFACE_SRC}/java/ai.jar DESTINATION ${CMAKE_SOURCE_DIR}/AI/Skirmish/hoijuiAI/${Java_AIINTERFACE_VERS}/jlib)
+	install (FILES ${Java_AIINTERFACE_SRC}/java/ai.jar DESTINATION ${CMAKE_SOURCE_DIR}/AI/Skirmish/hoijuiAI/${Java_AIINTERFACE_VERS})
+	install (FILES ${Java_AIINTERFACE_SRC}/AIInfo.lua DESTINATION ${CMAKE_SOURCE_DIR}/AI/Skirmish/hoijuiAI/${Java_AIINTERFACE_VERS})
 endif (JAVA_FOUND AND EXISTS ${Java_AIINTERFACE_SRC})
 

Modified: branches/caiinterface/AI/Skirmish/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-11-05 15:13:01 UTC (rev 6979)
@@ -2,8 +2,7 @@
 add_definitions(-DBUILDING_AI)
 
 set(SKIRMISH_SRC &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish&quot;)
-set(SKIRMISH_LIBS &quot;${DATADIR}/AI/Skirmish/impls&quot;)
-set(SKIRMISH_DATA &quot;${DATADIR}/AI/Skirmish/data&quot;)
+set(SKIRMISH_DATA &quot;${DATADIR}/AI/Skirmish&quot;)
 
 
 ## KAI
@@ -14,16 +13,17 @@
 		file(STRINGS &quot;${KAI_SRC}/VERSION&quot; KAI_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${KAI_SRC}/VERSION)
 	set(KAI_TARGET &quot;KAI-${KAI_VERS}&quot;)
+	set(KAI_DATA_DIR ${SKIRMISH_DATA}/KAI/${KAI_VERS})
 	message(STATUS &quot;${KAI_VERS}\t(KAI Version)&quot;)
 
 	aux_source_directory(${KAI_SRC} kai)
 	#add_library(${KAI_TARGET} MODULE ${kai} ${legacycppaienv} ${creg})
-	#install (FILES ${KAI_SRC}/AIInfo.lua DESTINATION ${SKIRMISH_DATA}/KAI/${KAI_VERS})
+	#install (FILES ${KAI_SRC}/AIInfo.lua DESTINATION ${KAI_DATA_DIR})
 	#if (EXISTS ${KAI_SRC}/AIOptions.lua)
-	#	install (FILES ${KAI_SRC}/AIOptions.lua DESTINATION ${SKIRMISH_DATA}/KAI/${KAI_VERS})
+	#	install (FILES ${KAI_SRC}/AIOptions.lua DESTINATION ${KAI_DATA_DIR})
 	#endif (EXISTS ${KAI_SRC}/AIOptions.lua)
 	#set_target_properties(${KAI_TARGET} PROPERTIES COMPILE_FLAGS &quot;-DUSING_CREG&quot;)
-	#install (TARGETS ${KAI_TARGET} DESTINATION ${SKIRMISH_LIBS})
+	#install (TARGETS ${KAI_TARGET} DESTINATION ${KAI_DATA_DIR})
 endif (EXISTS ${KAI_SRC})
 
 
@@ -35,16 +35,17 @@
 		file(STRINGS &quot;${KAIK_SRC}/VERSION&quot; KAIK_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${KAIK_SRC}/VERSION)
 	set(KAIK_TARGET &quot;KAIK-${KAIK_VERS}&quot;)
+	set(KAIK_DATA_DIR ${SKIRMISH_DATA}/KAIK/${KAIK_VERS})
 	message(STATUS &quot;${KAIK_VERS}\t(KAIK Version)&quot;)
 
 	aux_source_directory(${KAIK_SRC} kaik)
 	add_library(${KAIK_TARGET} MODULE ${kaik} ${legacycppaienv} ${creg})
-	install (FILES ${KAIK_SRC}/AIInfo.lua DESTINATION ${SKIRMISH_DATA}/KAIK/${KAIK_VERS})
+	install (FILES ${KAIK_SRC}/AIInfo.lua DESTINATION ${KAIK_DATA_DIR})
 	if (EXISTS ${KAIK_SRC}/AIOptions.lua)
-		install (FILES ${KAIK_SRC}/AIOptions.lua DESTINATION ${SKIRMISH_DATA}/KAIK/${KAIK_VERS})
+		install (FILES ${KAIK_SRC}/AIOptions.lua DESTINATION ${KAIK_DATA_DIR})
 	endif (EXISTS ${KAIK_SRC}/AIOptions.lua)
 	set_target_properties(${KAIK_TARGET} PROPERTIES COMPILE_FLAGS &quot;-DUSING_CREG&quot;)
-	install (TARGETS ${KAIK_TARGET} DESTINATION ${SKIRMISH_LIBS})
+	install (TARGETS ${KAIK_TARGET} DESTINATION ${KAIK_DATA_DIR})
 endif (EXISTS ${KAIK_SRC})
 
 
@@ -56,15 +57,16 @@
 		file(STRINGS &quot;${RAI_SRC}/VERSION&quot; RAI_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${RAI_SRC}/VERSION)
 	set(RAI_TARGET &quot;RAI-${RAI_VERS}&quot;)
+	set(RAI_DATA_DIR ${SKIRMISH_DATA}/RAI/${RAI_VERS})
 	message(STATUS &quot;${RAI_VERS}\t(RAI Version)&quot;)
 
 	aux_source_directory(${RAI_SRC} rai)
 	add_library(${RAI_TARGET} MODULE ${rai} ${legacycppaienv})
-	install (FILES ${RAI_SRC}/AIInfo.lua DESTINATION ${SKIRMISH_DATA}/RAI/${RAI_VERS})
+	install (FILES ${RAI_SRC}/AIInfo.lua DESTINATION ${RAI_DATA_DIR})
 	if (EXISTS ${RAI_SRC}/AIOptions.lua)
-		install (FILES ${RAI_SRC}/AIOptions.lua DESTINATION ${SKIRMISH_DATA}/RAI/${RAI_VERS})
+		install (FILES ${RAI_SRC}/AIOptions.lua DESTINATION ${RAI_DATA_DIR})
 	endif (EXISTS ${RAI_SRC}/AIOptions.lua)
-	install (TARGETS ${RAI_TARGET} DESTINATION ${SKIRMISH_LIBS})
+	install (TARGETS ${RAI_TARGET} DESTINATION ${RAI_DATA_DIR})
 endif (EXISTS ${RAI_SRC})
 
 
@@ -76,15 +78,16 @@
 		file(STRINGS &quot;${AAI_SRC}/VERSION&quot; AAI_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${AAI_SRC}/VERSION)
 	set(AAI_TARGET &quot;AAI-${AAI_VERS}&quot;)
+	set(AAI_DATA_DIR ${SKIRMISH_DATA}/AAI/${AAI_VERS})
 	message(STATUS &quot;${AAI_VERS}\t(AAI Version)&quot;)
 
 	aux_source_directory(${AAI_SRC} aai)
 	#add_library(${AAI_TARGET} MODULE ${aai} ${legacycppaienv})
-	#install (FILES ${AAI_SRC}/AIInfo.lua DESTINATION ${SKIRMISH_DATA}/AAI/${AAI_VERS})
+	#install (FILES ${AAI_SRC}/AIInfo.lua DESTINATION ${AAI_DATA_DIR})
 	#if (EXISTS ${AAI_SRC}/AIOptions.lua)
-	#	install (FILES ${AAI_SRC}/AIOptions.lua DESTINATION ${SKIRMISH_DATA}/AAI/${AAI_VERS})
+	#	install (FILES ${AAI_SRC}/AIOptions.lua DESTINATION ${AAI_DATA_DIR})
 	#endif (EXISTS ${AAI_SRC}/AIOptions.lua)
-	#install (TARGETS ${AAI_TARGET} DESTINATION ${SKIRMISH_LIBS})
+	#install (TARGETS ${AAI_TARGET} DESTINATION ${AAI_DATA_DIR})
 endif (EXISTS ${AAI_SRC})
 
 
@@ -96,6 +99,7 @@
 		file(STRINGS &quot;${NTai_SRC}/VERSION&quot; NTai_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${NTai_SRC}/VERSION)
 	set(NTai_TARGET &quot;NTai-${NTai_VERS}&quot;)
+	set(NTai_DATA_DIR ${SKIRMISH_DATA}/NTai/${NTai_VERS})
 	message(STATUS &quot;${NTai_VERS}\t(NTai Version)&quot;)
 
 	aux_source_directory(${NTai_SRC} ntai)
@@ -111,11 +115,11 @@
 	aux_source_directory(${NTai_SRC}/AI/NTai/Agents ntai)
 	#add_library(${NTai_TARGET} MODULE ${ntai} ${legacycppaienv})
 	#target_link_libraries(${NTai_TARGET} boost_thread-mt)
-	#install (FILES ${NTai_SRC}/AIInfo.lua DESTINATION ${SKIRMISH_DATA}/NTai/${NTai_VERS})
+	#install (FILES ${NTai_SRC}/AIInfo.lua DESTINATION ${NTai_DATA_DIR})
 	#if (EXISTS ${NTai_SRC}/AIOptions.lua)
-	#	install (FILES ${NTai_SRC}/AIOptions.lua DESTINATION ${SKIRMISH_DATA}/NTai/${NTai_VERS})
+	#	install (FILES ${NTai_SRC}/AIOptions.lua DESTINATION ${NTai_DATA_DIR})
 	#endif (EXISTS ${NTai_SRC}/AIOptions.lua)
-	#install (TARGETS ${NTai_TARGET} DESTINATION ${SKIRMISH_LIBS})
+	#install (TARGETS ${NTai_TARGET} DESTINATION ${NTai_DATA_DIR})
 endif (EXISTS ${NTai_SRC})
 
 
@@ -127,15 +131,16 @@
 		file(STRINGS &quot;${NullLegacyCppAI_SRC}/VERSION&quot; NullLegacyCppAI_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${NullLegacyCppAI_SRC}/VERSION)
 	set(NullLegacyCppAI_TARGET &quot;NullLegacyCppAI-${NullLegacyCppAI_VERS}&quot;)
+	set(NullLegacyCppAI_DATA_DIR ${SKIRMISH_DATA}/NullLegacyCppAI/${NullLegacyCppAI_VERS})
 	message(STATUS &quot;${NullLegacyCppAI_VERS}\t(NullLegacyCppAI Version)&quot;)
 
 	aux_source_directory(${NullLegacyCppAI_SRC} nulllegacycppai)
 	add_library(${NullLegacyCppAI_TARGET} MODULE ${nulllegacycppai} ${legacycppaienv})
-	install (FILES ${NullLegacyCppAI_SRC}/AIInfo.lua DESTINATION ${SKIRMISH_DATA}/NullLegacyCppAI/${NullLegacyCppAI_VERS})
+	install (FILES ${NullLegacyCppAI_SRC}/AIInfo.lua DESTINATION ${NullLegacyCppAI_DATA_DIR})
 	if (EXISTS ${NullLegacyCppAI_SRC}/AIOptions.lua)
-		install (FILES ${NullLegacyCppAI_SRC}/AIOptions.lua DESTINATION ${SKIRMISH_DATA}/NullLegacyCppAI/${NullLegacyCppAI_VERS})
+		install (FILES ${NullLegacyCppAI_SRC}/AIOptions.lua DESTINATION ${NullLegacyCppAI_DATA_DIR})
 	endif (EXISTS ${NullLegacyCppAI_SRC}/AIOptions.lua)
-	install (TARGETS ${NullLegacyCppAI_TARGET} DESTINATION ${SKIRMISH_LIBS})
+	install (TARGETS ${NullLegacyCppAI_TARGET} DESTINATION ${NullLegacyCppAI_DATA_DIR})
 endif (EXISTS ${NullLegacyCppAI_SRC})
 
 
@@ -147,15 +152,16 @@
 		file(STRINGS &quot;${NullAI_SRC}/VERSION&quot; NullAI_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${NullAI_SRC}/VERSION)
 	set(NullAI_TARGET &quot;NullAI-${NullAI_VERS}&quot;)
+	set(NullAI_DATA_DIR ${SKIRMISH_DATA}/NullAI/${NullAI_VERS})
 	message(STATUS &quot;${NullAI_VERS}\t(NullAI Version)&quot;)
 
 	aux_source_directory(${NullAI_SRC} nullai)
 	add_library(${NullAI_TARGET} MODULE ${mySrc} ${nullai})
-	install (FILES ${NullAI_SRC}/AIInfo.lua DESTINATION ${SKIRMISH_DATA}/NullAI/${NullAI_VERS})
+	install (FILES ${NullAI_SRC}/AIInfo.lua DESTINATION ${NullAI_DATA_DIR})
 	if (EXISTS ${NullAI_SRC}/AIOptions.lua)
-		install (FILES ${NullAI_SRC}/AIOptions.lua DESTINATION ${SKIRMISH_DATA}/NullAI/${NullAI_VERS})
+		install (FILES ${NullAI_SRC}/AIOptions.lua DESTINATION ${NullAI_DATA_DIR})
 	endif (EXISTS ${NullAI_SRC}/AIOptions.lua)
-	install (TARGETS ${NullAI_TARGET} DESTINATION ${SKIRMISH_LIBS})
+	install (TARGETS ${NullAI_TARGET} DESTINATION ${NullAI_DATA_DIR})
 endif (EXISTS ${NullAI_SRC})
 
 
@@ -169,15 +175,16 @@
 			file(STRINGS &quot;${JCAI_SRC}/VERSION&quot; JCAI_VERS LIMIT_COUNT 1)
 		endif (EXISTS ${JCAI_SRC}/VERSION)
 		set(JCAI_TARGET &quot;JCAI-${JCAI_VERS}&quot;)
+		set(JCAI_DATA_DIR ${SKIRMISH_DATA}/JCAI/${JCAI_VERS})
 		message(STATUS &quot;${JCAI_VERS}\t(JCAI Version)&quot;)
 
 		aux_source_directory(${JCAI_SRC} jcai)
 		#add_library(${JCAI_TARGET} MODULE ${jcai} ${legacycppaienv})
-		#install (FILES ${JCAI_SRC}/AIInfo.lua DESTINATION ${SKIRMISH_DATA}/JCAI/${JCAI_VERS})
+		#install (FILES ${JCAI_SRC}/AIInfo.lua DESTINATION ${JCAI_DATA_DIR})
 		#if (EXISTS ${JCAI_SRC}/AIOptions.lua)
-		#	install (FILES ${JCAI_SRC}/AIOptions.lua DESTINATION ${SKIRMISH_DATA}/JCAI/${JCAI_VERS})
+		#	install (FILES ${JCAI_SRC}/AIOptions.lua DESTINATION ${JCAI_DATA_DIR})
 		#endif (EXISTS ${JCAI_SRC}/AIOptions.lua)
-		#install (TARGETS ${JCAI_TARGET} DESTINATION ${SKIRMISH_LIBS})
+		#install (TARGETS ${JCAI_TARGET} DESTINATION ${JCAI_DATA_DIR})
 	endif (EXISTS ${JCAI_SRC})
 endif (UNIX)
 

Modified: branches/caiinterface/AI/Skirmish/CSAI/ABICompatibilityLayer/AbicProxy.h
===================================================================
--- branches/caiinterface/AI/Skirmish/CSAI/ABICompatibilityLayer/AbicProxy.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/AI/Skirmish/CSAI/ABICompatibilityLayer/AbicProxy.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -36,6 +36,7 @@
 #include &lt;set&gt;
 #include &lt;stdio.h&gt;
 
+#include &quot;aidefines.h&quot;
 #include &quot;Platform/SharedLib.h&quot;
 
 // #include &quot;AICallbackProxy.h&quot;
@@ -44,11 +45,7 @@
 
 using namespace std;
 
-#ifdef WIN32
-	#define AILOG_PATH &quot;AI\\Skirmish\\data\\&quot;
-#else
-	#define AILOG_PATH &quot;AI/Skirmish/data/&quot;
-#endif
+#define AILOG_PATH SKIRMISH_AI_DATA_DIR
 
 class AbicProxy : public ::IGlobalAI  
 {

Modified: branches/caiinterface/AI/Skirmish/CSAI/CSAILoader/CSAIProxy.h
===================================================================
--- branches/caiinterface/AI/Skirmish/CSAI/CSAILoader/CSAIProxy.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/AI/Skirmish/CSAI/CSAILoader/CSAIProxy.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -41,17 +41,14 @@
 
 #include &quot;CSAIProxyAICallback.h&quot;
 
+#include &quot;aidefines.h&quot;
 #include &quot;AbicAICallbackWrapper.h&quot;
 
 const char AI_NAME[]=&quot;.Net Interface&quot;;
 
 using namespace std;
 
-#ifdef WIN32
-	#define AILOG_PATH &quot;AI\\Skirmish\\data\\&quot;
-#else
-	#define AILOG_PATH &quot;AI/Skirmish/data/&quot;
-#endif
+#define AILOG_PATH SKIRMISH_AI_DATA_DIR
 
 struct AbicAICallbackWrapper;
 

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp	2008-11-05 15:13:01 UTC (rev 6979)
@@ -45,7 +45,7 @@
 				&quot; No file name specified in AIInterface.lua&quot;,
 				&quot;AI Interface Error&quot;, MBF_OK | MBF_EXCL);
 	}
-	libFilePath = FindLibFile(libFileName);
+	libFilePath = FindLibFile();
 	
 	sharedLib = SharedLib::Instantiate(libFilePath);
 	if (sharedLib == NULL) {
@@ -405,30 +405,28 @@
 }
 
 
-std::string CAIInterfaceLibrary::FindLibFile(
-		const std::string&amp; fileNameMainPart) {
+//std::string CAIInterfaceLibrary::FindLibFile(
+//		const std::string&amp; fileNameMainPart) {
+std::string CAIInterfaceLibrary::FindLibFile() {
 	
-	std::string libFileName = fileNameMainPart + &quot;.&quot; + SharedLib::GetLibExtension();
+	const std::string&amp; dataDir = info-&gt;GetDataDir();
+	const std::string&amp; fileName = info-&gt;GetFileName();
+	
+	std::string libFileName(fileName); // eg. C-0.1
 	#ifndef _WIN32
-		libFileName = &quot;lib&quot; + libFileName;
+		libFileName = &quot;lib&quot; + libFileName; // eg. libC-0.1
 	#endif
-	// libFileName should now look about like this: libJava-0.600.so or Java-0.600.dll
 	
+	// eg. libC-0.1.so
+	libFileName = libFileName + &quot;.&quot; + SharedLib::GetLibExtension();
+	
+/*
 	std::vector&lt;std::string&gt; libFile =
-			CFileHandler::FindFiles(AI_INTERFACES_IMPLS_DIR, libFileName);
+			CFileHandler::FindFiles(dataDir, libFileName);
 	
-	// generate a path like this: &quot;C:/Games/spring/AI/Interfaces/impls/Java-0.600.dll&quot;
-	std::string path = &quot;&quot;;
-	if (libFile.size() &gt;= 1) {
-		path = libFile.at(0);
-	} else {
-		// though the file is not available, we still return the relative path
-		// when trying ot load the lib, the user will see through
-		// the error message, which file is missing where
-		path = std::string(AI_INTERFACES_IMPLS_DIR) + &quot;/&quot; + libFileName;
-	}
-	
-	return path;
+	return libFile.size() &gt;= 1 ? libFile[0] : &quot;&quot;;
+*/
+	return dataDir + PS + libFileName;
 }
 
 /*

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -92,7 +92,8 @@
 			const std::string* functionName);
 	int InitializeFromLib(const std::string&amp; libFilePath);
 	
-	static std::string FindLibFile(const std::string&amp; fileNameMainPart);
+	//static std::string FindLibFile(const std::string&amp; fileNameMainPart);
+	std::string FindLibFile();
 };
 
 #endif	/* _AIINTERFACELIBRARY_H */

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp	2008-11-05 15:13:01 UTC (rev 6979)
@@ -27,18 +27,25 @@
 CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
 		const IAIInterfaceLibrary&amp; interface) {
 	
-	infoItems = interface.GetInfo();
-	//levelOfSupport = interface.GetLevelOfSupportFor(std::string(ENGINE_VERSION_STRING),
-	//		ENGINE_VERSION_NUMBER);
+	info = interface.GetInfo();
+	
+	std::map&lt;std::string, InfoItem&gt;::iterator iip;
+    for (iip = info.begin(); iip != info.begin(); ++iip) {
+		iip-&gt;second = copyInfoItem(&amp;(iip-&gt;second));
+    }
 }
 
 CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
 		const CAIInterfaceLibraryInfo&amp; interfaceInfo) {
 	
-	infoItems = std::map&lt;std::string, InfoItem&gt;(
-			interfaceInfo.infoItems.begin(),
-			interfaceInfo.infoItems.end());
-	//levelOfSupport = interfaceInfo.levelOfSupport;
+	info = std::map&lt;std::string, InfoItem&gt;(
+			interfaceInfo.info.begin(),
+			interfaceInfo.info.end());
+	
+	std::map&lt;std::string, InfoItem&gt;::iterator iip;
+    for (iip = info.begin(); iip != info.begin(); ++iip) {
+		iip-&gt;second = copyInfoItem(&amp;(iip-&gt;second));
+    }
 }
 
 CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
@@ -52,12 +59,20 @@
 		logOutput.Print(&quot;info %i: %s / %s / %s&quot;, i, tmpInfo[i].key,
 				tmpInfo[i].value, tmpInfo[i].desc);
 */
-		infoItems[std::string(tmpInfo[i].key)] = copyInfoItem(&amp;(tmpInfo[i]));
+		info[std::string(tmpInfo[i].key)] = copyInfoItem(&amp;(tmpInfo[i]));
     }
 	
 	//levelOfSupport = LOS_Unknown;
 }
 
+CAIInterfaceLibraryInfo::~CAIInterfaceLibraryInfo() {
+	
+	std::map&lt;std::string, InfoItem&gt;::const_iterator iip;
+    for (iip = info.begin(); iip != info.begin(); ++iip) {
+		deleteInfoItem(&amp;(iip-&gt;second));
+    }
+}
+
 /*
 LevelOfSupport CAIInterfaceLibraryInfo::GetLevelOfSupportForCurrentEngine() const {
 	return levelOfSupport;
@@ -66,12 +81,15 @@
 
 SAIInterfaceSpecifier CAIInterfaceLibraryInfo::GetSpecifier() const {
 	
-	const char* sn = infoItems.at(AI_INTERFACE_PROPERTY_SHORT_NAME).value;
-	const char* v = infoItems.at(AI_INTERFACE_PROPERTY_VERSION).value;
+	const char* sn = info.at(AI_INTERFACE_PROPERTY_SHORT_NAME).value;
+	const char* v = info.at(AI_INTERFACE_PROPERTY_VERSION).value;
 	SAIInterfaceSpecifier specifier = {sn, v};
 	return specifier;
 }
 
+std::string CAIInterfaceLibraryInfo::GetDataDir() const {
+	return GetInfo(AI_INTERFACE_PROPERTY_DATA_DIR);
+}
 std::string CAIInterfaceLibraryInfo::GetFileName() const {
 	return GetInfo(AI_INTERFACE_PROPERTY_FILE_NAME);
 }
@@ -92,19 +110,22 @@
 }
 std::string CAIInterfaceLibraryInfo::GetInfo(const std::string&amp; key) const {
 	
-	if (infoItems.find(key) == infoItems.end()) {
+	if (info.find(key) == info.end()) {
 		std::string errorMsg = std::string(&quot;AI interface property '&quot;) + key
 				+ &quot;' could not be found.\n&quot;;
 		handleerror(NULL, errorMsg.c_str(), &quot;AI Interface Info Error&quot;,
 				MBF_OK | MBF_EXCL);
 	}
-	return infoItems.at(key).value;
+	return info.at(key).value;
 }
 const std::map&lt;std::string, InfoItem&gt;* CAIInterfaceLibraryInfo::GetInfo() const {
-	return &infoItems;
+	return &info;
 }
 
 
+void CAIInterfaceLibraryInfo::SetDataDir(const std::string&amp; dataDir) {
+	SetInfo(AI_INTERFACE_PROPERTY_DATA_DIR, dataDir);
+}
 void CAIInterfaceLibraryInfo::SetFileName(const std::string&amp; fileName) {
 	SetInfo(AI_INTERFACE_PROPERTY_FILE_NAME, fileName);
 }
@@ -137,6 +158,8 @@
 	}
 	
 	InfoItem ii = {key.c_str(), value.c_str(), NULL};
-	infoItems[key] = ii;
+	ii = copyInfoItem(&amp;ii);
+	
+	info[key] = ii;
 	return true;
 }

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -31,33 +31,34 @@
 	CAIInterfaceLibraryInfo(const IAIInterfaceLibrary&amp; interface);
 	CAIInterfaceLibraryInfo(const CAIInterfaceLibraryInfo&amp; interfaceInfo);
 	CAIInterfaceLibraryInfo(const std::string&amp; interfaceInfoFile);
-    
-    //virtual LevelOfSupport GetLevelOfSupportForCurrentEngine() const;
-	
-    virtual SAIInterfaceSpecifier GetSpecifier() const;
-    
-    virtual std::string GetFileName() const; // when the AI is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
-    virtual std::string GetShortName() const; // restrictions: none of the following: spaces, '_', '#'
-    virtual std::string GetVersion() const; // restrictions: none of the following: spaces, '_', '#'
-    virtual std::string GetName() const;
-    virtual std::string GetDescription() const;
-    virtual std::string GetURL() const;
-    virtual std::string GetInfo(const std::string&amp; key) const;
-    virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
-	
-    virtual void SetFileName(const std::string&amp; fileName); // when the AI is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
-    virtual void SetShortName(const std::string&amp; shortName); // restrictions: none of the following: spaces, '_', '#'
-    virtual void SetVersion(const std::string&amp; version); // restrictions: none of the following: spaces, '_', '#'
-    virtual void SetName(const std::string&amp; name);
-    virtual void SetDescription(const std::string&amp; description);
-    virtual void SetURL(const std::string&amp; url);
-    virtual bool SetInfo(const std::string&amp; key, const std::string&amp; value);
-	
+	~CAIInterfaceLibraryInfo();
+
+	//virtual LevelOfSupport GetLevelOfSupportForCurrentEngine() const;
+
+	virtual SAIInterfaceSpecifier GetSpecifier() const;
+
+	virtual std::string GetDataDir() const;
+	virtual std::string GetFileName() const; // when the AI is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
+	virtual std::string GetShortName() const; // restrictions: none of the following: spaces, '_', '#'
+	virtual std::string GetVersion() const; // restrictions: none of the following: spaces, '_', '#'
+	virtual std::string GetName() const;
+	virtual std::string GetDescription() const;
+	virtual std::string GetURL() const;
+	virtual std::string GetInfo(const std::string&amp; key) const;
+	virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
+
+	virtual void SetDataDir(const std::string&amp; dataDir);
+	virtual void SetFileName(const std::string&amp; fileName); // when the AI is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
+	virtual void SetShortName(const std::string&amp; shortName); // restrictions: none of the following: spaces, '_', '#'
+	virtual void SetVersion(const std::string&amp; version); // restrictions: none of the following: spaces, '_', '#'
+	virtual void SetName(const std::string&amp; name);
+	virtual void SetDescription(const std::string&amp; description);
+	virtual void SetURL(const std::string&amp; url);
+	virtual bool SetInfo(const std::string&amp; key, const std::string&amp; value);
+
 private:
 	static const unsigned int MAX_INFOS = 128;
-	std::map&lt;std::string, InfoItem&gt; infoItems;
-	//LevelOfSupport levelOfSupport;
+	std::map&lt;std::string, InfoItem&gt; info;
 };
 
-#endif	/* _AIINTERFACELIBRARYINFO_H */
-
+#endif	// _AIINTERFACELIBRARYINFO_H

Modified: branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp	2008-11-05 15:13:01 UTC (rev 6979)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -44,14 +44,14 @@
 	handleerror(NULL, msg, topic, MBF_OK | MBF_EXCL);
 }
 void CAILibraryManager::reportError1(const char* topic, const char* msg, const char* arg0) {
-	
+
 	const int MAX_MSG_LENGTH = 511;
 	char s_msg[MAX_MSG_LENGTH + 1];
 	SNPRINTF(s_msg, MAX_MSG_LENGTH, msg, arg0);
 	reportError(topic, s_msg);
 }
 void CAILibraryManager::reportError2(const char* topic, const char* msg, const char* arg0, const char* arg1) {
-	
+
 	const int MAX_MSG_LENGTH = 511;
 	char s_msg[MAX_MSG_LENGTH + 1];
 	SNPRINTF(s_msg, MAX_MSG_LENGTH, msg, arg0, arg1);
@@ -59,13 +59,13 @@
 }
 
 std::string CAILibraryManager::extractFileName(const std::string&amp; libFile, bool includeExtension) {
-	
+
 	std::string::size_type firstChar = libFile.find_last_of(&quot;/\\&quot;);
 	std::string::size_type lastChar = std::string::npos;
 	if (!includeExtension) {
 		lastChar = libFile.find_last_of('.');
 	}
-	
+
 	return libFile.substr(firstChar+1, lastChar - firstChar -1);
 }
 
@@ -136,7 +136,7 @@
 		}
 		
 		delete interfaceLib;
-    }
+	}
 }
 */
 
@@ -160,24 +160,31 @@
 }
 */
 
+static std::string noSlashAtEnd(const std::string&amp; dir) {
+
+	std::string resDir = dir;
+	
+	char lastChar = dir.at(dir.size()-1);
+	if (lastChar == '/' || lastChar == '\\') {
+		resDir = resDir.substr(0, dir.size()-1);
+	}
+
+	return resDir;
+}
+
 void CAILibraryManager::GetAllInfosFromCache() {
-	
+
 	ClearAllInfos();
-	
-/*
-	if (!(vfsHandler)) {
-		reportError(&quot;Initialization Error&quot;, Call InitArchiveScanner before GetAllInfosFromCache.&quot;);
-	}
-*/
+
 	typedef std::vector&lt;std::string&gt; T_dirs;
-	
+
 	// cause we use CFileHandler for searching files,
 	// we are automatically searching in all data-dirs
-	
+
 	// Read from AI Interface info files
 	// we are looking for:
-	// AI/Interfaces/data/ * /InterfaceInfo.lua
-	// AI/Interfaces/data/ * / * /InterfaceInfo.lua
+	// {AI_INTERFACES_DATA_DIR}/{*}/InterfaceInfo.lua
+	// {AI_INTERFACES_DATA_DIR}/{*}/{*}/InterfaceInfo.lua
 	T_dirs aiInterfaceDataDirs =
 			FindDirsAndDirectSubDirs(AI_INTERFACES_DATA_DIR);
 	typedef std::map&lt;const SAIInterfaceSpecifier, std::set&lt;std::string&gt;,
@@ -189,29 +196,29 @@
 		T_dirs infoFile =
 				CFileHandler::FindFiles(possibleDataDir, &quot;InterfaceInfo.lua&quot;);
 		if (infoFile.size() &gt; 0) { // interface info is available
-			
+
 			// generate and store the interface info
 			CAIInterfaceLibraryInfo* interfaceInfo =
 					new CAIInterfaceLibraryInfo(infoFile.at(0));
-			
-			std::string sn = interfaceInfo-&gt;GetShortName();
-			std::string v = interfaceInfo-&gt;GetVersion();
-			SAIInterfaceSpecifier interfaceSpecifier = {sn.c_str(), v.c_str()};
-			interfaceSpecifier = copySAIInterfaceSpecifier(&amp;interfaceSpecifier);
+
+			interfaceInfo-&gt;SetDataDir(noSlashAtEnd(possibleDataDir));
+
+			SAIInterfaceSpecifier interfaceSpecifier = interfaceInfo-&gt;GetSpecifier();
+
 			interfaceSpecifiers.insert(interfaceSpecifier);
 			interfaceInfos[interfaceSpecifier] = interfaceInfo;
-			
+
 			// so we can check if one interface is specified multiple times
 			duplicateInterfaceInfoCheck[interfaceSpecifier].insert(infoFile.at(0));
 		}
 	}
-	
+
 	// filter out interfaces that are specified multiple times
 	for (T_dupInt::const_iterator info = duplicateInterfaceInfoCheck.begin();
 			info != duplicateInterfaceInfoCheck.end(); ++info) {
 		if (info-&gt;second.size() &gt;= 2) {
 			duplicateInterfaceInfos[info-&gt;first] = info-&gt;second;
-			
+
 			logOutput.Print(&quot;WARNING: Duplicate AI Interface Info found:&quot;);
 			logOutput.Print(&quot;\tfor interface: %s %s&quot;, info-&gt;first.shortName,
 					info-&gt;first.version);
@@ -225,8 +232,8 @@
 	
 	// Read from Skirmish AI info and option files
 	// we are looking for:
-	// AI/Skirmish/data/ * /AIInfo.lua
-	// AI/Skirmish/data/ * / * /AIInfo.lua
+	// {SKIRMISH_AI_DATA_DIR/{*}/AIInfo.lua
+	// {SKIRMISH_AI_DATA_DIR}/{*}/{*}/AIInfo.lua
 	T_dirs skirmishAIDataDirs = FindDirsAndDirectSubDirs(SKIRMISH_AI_DATA_DIR);
 	T_dupSkirm duplicateSkirmishAIInfoCheck;
 	for (T_dirs::iterator dir = skirmishAIDataDirs.begin();
@@ -244,10 +251,10 @@
 			// generate and store the ai info
 			CSkirmishAILibraryInfo* skirmishAIInfo =
 					new CSkirmishAILibraryInfo(infoFile.at(0), optionFileName);
-			
-			std::string sn = skirmishAIInfo-&gt;GetShortName();
-			std::string v = skirmishAIInfo-&gt;GetVersion();
-			SSAISpecifier aiSpecifier = {sn.c_str(), v.c_str()};
+
+			skirmishAIInfo-&gt;SetDataDir(noSlashAtEnd(possibleDataDir));
+
+			SSAISpecifier aiSpecifier = skirmishAIInfo-&gt;GetSpecifier();
 			SAIInterfaceSpecifier interfaceSpecifier =
 					FindFittingInterfaceSpecifier(
 							skirmishAIInfo-&gt;GetInterfaceShortName(),
@@ -258,19 +265,19 @@
 				SSAIKey skirmishAIKey = {interfaceSpecifier, aiSpecifier};
 				skirmishAIKeys.insert(skirmishAIKey);
 				skirmishAIInfos[skirmishAIKey] = skirmishAIInfo;
-			
+
 				// so we can check if one skirmish AI is specified multiple times
 				duplicateSkirmishAIInfoCheck[skirmishAIKey].insert(infoFile.at(0));
 			}
 		}
 	}
-	
+
 	// filter out skirmish AIs that are specified multiple times
 	for (T_dupSkirm::const_iterator info = duplicateSkirmishAIInfoCheck.begin();
 			info != duplicateSkirmishAIInfoCheck.end(); ++info) {
 		if (info-&gt;second.size() &gt;= 2) {
 			duplicateSkirmishAIInfos[info-&gt;first] = info-&gt;second;
-			
+
 			logOutput.Print(&quot;WARNING: Duplicate Skirmish AI Info found:&quot;);
 			logOutput.Print(&quot;\tfor Skirmish AI: %s %s&quot;, info-&gt;first.ai.shortName,
 					info-&gt;first.ai.version);
@@ -281,12 +288,12 @@
 			}
 		}
 	}
-	
-	
+
+
 	// Read from Group AI info and option files
 	// we are looking for:
-	// AI/Group/data/ * /AIInfo.lua
-	// AI/Group/data/ * / * /AIInfo.lua
+	// {GROUP_AI_DATA_DIR}/{*}/AIInfo.lua
+	// {GROUP_AI_DATA_DIR}/{*}/{*}/AIInfo.lua
 	T_dirs groupAIDataDirs = FindDirsAndDirectSubDirs(GROUP_AI_DATA_DIR);
 	T_dupGroup duplicateGroupAIInfoCheck;
 	for (T_dirs::iterator dir = groupAIDataDirs.begin();
@@ -304,10 +311,10 @@
 			// generate and store the ai info
 			CGroupAILibraryInfo* groupAIInfo =
 					new CGroupAILibraryInfo(infoFile.at(0), optionFileName);
-			
-			std::string sn = groupAIInfo-&gt;GetShortName();
-			std::string v = groupAIInfo-&gt;GetVersion();
-			SGAISpecifier aiSpecifier = {sn.c_str(), v.c_str()};
+
+			groupAIInfo-&gt;SetDataDir(noSlashAtEnd(possibleDataDir));
+
+			SGAISpecifier aiSpecifier = groupAIInfo-&gt;GetSpecifier();
 			SAIInterfaceSpecifier interfaceSpecifier =
 					FindFittingInterfaceSpecifier(
 							groupAIInfo-&gt;GetInterfaceShortName(),
@@ -318,19 +325,19 @@
 				SGAIKey groupAIKey = {interfaceSpecifier, aiSpecifier};
 				groupAIKeys.insert(groupAIKey);
 				groupAIInfos[groupAIKey] = groupAIInfo;
-			
+
 				// so we can check if one group AI is specified multiple times
 				duplicateGroupAIInfoCheck[groupAIKey].insert(infoFile.at(0));
 			}
 		}
 	}
-	
+
 	// filter out group AIs that are specified multiple times
 	for (T_dupGroup::const_iterator info = duplicateGroupAIInfoCheck.begin();
 			info != duplicateGroupAIInfoCheck.end(); ++info) {
 		if (info-&gt;second.size() &gt;= 2) {
 			duplicateGroupAIInfos[info-&gt;first] = info-&gt;second;
-			
+
 			logOutput.Print(&quot;WARNING: Duplicate Group AI Info found:&quot;);
 			logOutput.Print(&quot;\tfor Group AI: %s %s&quot;, info-&gt;first.ai.shortName,
 					info-&gt;first.ai.version);
@@ -341,7 +348,7 @@
 			}
 		}
 	}
-	
+
 /*
 	std::vector&lt;std::string&gt; infoFiles =
 			FindFiles(std::string(
@@ -398,40 +405,41 @@
 		}
 		
 		delete interfaceLib;
-    }
+	}
 */
 }
+
 void CAILibraryManager::ClearAllInfos() {
-	
+
 	IAILibraryManager::T_interfaceInfos::iterator iii;
 	for (iii=interfaceInfos.begin(); iii!=interfaceInfos.end(); iii++) {
 		delete iii-&gt;second;
 		iii-&gt;second = NULL;
 	}
-	
+
 	IAILibraryManager::T_skirmishAIInfos::iterator sai;
 	for (sai=skirmishAIInfos.begin(); sai!=skirmishAIInfos.end(); sai++) {
 		delete sai-&gt;second;
 		sai-&gt;second = NULL;
 	}
-	
+
 	IAILibraryManager::T_groupAIInfos::iterator gai;
 	for (gai=groupAIInfos.begin(); gai!=groupAIInfos.end(); gai++) {
 		delete gai-&gt;second;
 		gai-&gt;second = NULL;
 	}
-	
+
 	interfaceInfos.clear();
 	skirmishAIInfos.clear();
 	groupAIInfos.clear();
-	
+
 	interfaceSpecifiers.clear();
 	skirmishAIKeys.clear();
 	groupAIKeys.clear();
 }
 
 CAILibraryManager::~CAILibraryManager() {
-	
+
 	ReleaseEverything();
 
 	// delete all strings contained in skirmish AI specifiers
@@ -439,13 +447,13 @@
 	for (sSpec=skirmishAIKeys.begin(); sSpec!=skirmishAIKeys.end(); sSpec++) {
 		deleteSSAISpecifier(&amp;(sSpec-&gt;ai));
 	}
-	
+
 	// delete all strings contained in group AI specifiers
 	IAILibraryManager::T_groupAIKeys::iterator gSpec;
 	for (gSpec=groupAIKeys.begin(); gSpec!=groupAIKeys.end(); gSpec++) {
 		deleteSGAISpecifier(&amp;(gSpec-&gt;ai));
 	}
-	
+
 	// delete all strings contained in interface specifiers
 	IAILibraryManager::T_interfaceSpecs::iterator iSpec;
 	for (iSpec=interfaceSpecifiers.begin(); iSpec!=interfaceSpecifiers.end(); iSpec++) {
@@ -474,12 +482,8 @@
 }
 
 const IAILibraryManager::T_skirmishAIInfos* CAILibraryManager::GetUsedSkirmishAIInfos() {
-	
+
 	if (!usedSkirmishAIInfos_initialized) {
-/*
-		std::vector&lt;CGameSetup::TeamData&gt;::const_iterator td;
-		for (td = gameSetup-&gt;teamStartingData.begin(); td != gameSetup-&gt;teamStartingData.end(); ++td) {
-*/
 		const CTeam* team = NULL;
 		for (unsigned int t = 0; t &lt; (unsigned int)MAX_TEAMS; ++t) {
 			team = gs-&gt;Team(t);
@@ -498,7 +502,7 @@
 					}
 				}
 			}
-        }
+		}
 	}
 	
 	return &usedSkirmishAIInfos;
@@ -517,22 +521,22 @@
 
 std::vector&lt;SSAIKey&gt; CAILibraryManager::ResolveSkirmishAIKey(
 		const SSAISpecifier&amp; skirmishAISpecifier) const {
-	
+
 	std::vector&lt;SSAIKey&gt; applyingKeys;
-	
+
 	if (skirmishAISpecifier.shortName == NULL || strlen(skirmishAISpecifier.shortName) == 0) {
 		return applyingKeys;
 	}
-	
+
 	std::string aiName(skirmishAISpecifier.shortName);
-	
+
 	bool checkVersion = false;
 	std::string aiVersion;
 	if (skirmishAISpecifier.version != NULL &amp;&amp; strlen(skirmishAISpecifier.version) &gt; 0) {
 		aiVersion = std::string(skirmishAISpecifier.version);
 		checkVersion = true;
 	}
-	
+
 	std::set&lt;SSAIKey&gt;::const_iterator sasi;
 	for (sasi=skirmishAIKeys.begin(); sasi!=skirmishAIKeys.end(); sasi++) {
 
@@ -549,13 +553,13 @@
 		// if the programm raches here, we know that this key fits
 		applyingKeys.push_back(*sasi);
 	}
-	
+
 	return applyingKeys;
 }
 std::vector&lt;SSAIKey&gt; CAILibraryManager::ResolveSkirmishAIKey(const std::string&amp; skirmishAISpecifier) const {
-	
+
 	std::vector&lt;SSAIKey&gt; applyingKeys;
-	
+
 	std::string* aiName;
 	std::string* aiVersion;
 	std::string* interfaceName;
@@ -565,7 +569,7 @@
 		reportError1(&quot;AI Library Error&quot;, &quot;Invalid Skirmish AI Key: %s&quot;, skirmishAISpecifier.c_str());
 		return applyingKeys;
 	}
-	
+
 	std::set&lt;SSAIKey&gt;::const_iterator sasi;
 	for (sasi=skirmishAIKeys.begin(); sasi!=skirmishAIKeys.end(); sasi++) {
 
@@ -592,13 +596,12 @@
 		// if the programm raches here, we know that this key fits
 		applyingKeys.push_back(*sasi);
 	}
-	
+
 	return applyingKeys;
 }
 
 const ISkirmishAILibrary* CAILibraryManager::FetchSkirmishAILibrary(const SSAIKey&amp; skirmishAIKey) {
-	
-	//return FetchInterface(skirmishAIKey.interface)-&gt;FetchSkirmishAILibrary(skirmishAIKey.ai);
+
 	T_skirmishAIInfos::const_iterator aiInfo = skirmishAIInfos.find(skirmishAIKey);
 	if (aiInfo == skirmishAIInfos.end()) {
 		return NULL;
@@ -612,7 +615,7 @@
 }
 
 void CAILibraryManager::ReleaseAllSkirmishAILibraries() {
-	
+
 	T_loadedInterfaces::const_iterator lil;
 	for (lil=loadedAIInterfaceLibraries.begin(); lil!=loadedAIInterfaceLibraries.end(); lil++) {
 		FetchInterface(lil-&gt;first)-&gt;ReleaseAllSkirmishAILibraries();
@@ -622,9 +625,9 @@
 
 
 std::vector&lt;SGAIKey&gt; CAILibraryManager::ResolveGroupAIKey(const std::string&amp; groupAISpecifier) const {
-	
+
 	std::vector&lt;SGAIKey&gt; applyingKeys;
-	
+
 	std::string* aiName;
 	std::string* aiVersion;
 	std::string* interfaceName;
@@ -634,7 +637,7 @@
 		reportError1(&quot;AI Library Error&quot;, &quot;Invalid Group AI Key: %s&quot;, groupAISpecifier.c_str());
 		return applyingKeys;
 	}
-	
+
 	std::set&lt;SGAIKey&gt;::const_iterator gasi;
 	for (gasi=groupAIKeys.begin(); gasi!=groupAIKeys.end(); gasi++) {
 
@@ -661,12 +664,12 @@
 		// if the programm raches here, we know that this key fits
 		applyingKeys.push_back(*gasi);
 	}
-	
+
 	return applyingKeys;
 }
 
 const IGroupAILibrary* CAILibraryManager::FetchGroupAILibrary(const SGAIKey&amp; groupAIKey) {
-	
+
 	//return FetchInterface(groupAIKey.interface)-&gt;FetchGroupAILibrary(groupAIKey.ai);
 	T_groupAIInfos::const_iterator aiInfo = groupAIInfos.find(groupAIKey);
 	if (aiInfo == groupAIInfos.end()) {
@@ -681,7 +684,7 @@
 }
 
 void CAILibraryManager::ReleaseAllGroupAILibraries() {
-	
+
 	T_loadedInterfaces::const_iterator lil;
 	for (lil=loadedAIInterfaceLibraries.begin(); lil!=loadedAIInterfaceLibraries.end(); lil++) {
 		FetchInterface(lil-&gt;first)-&gt;ReleaseAllGroupAILibraries();
@@ -693,13 +696,14 @@
 
 
 IAIInterfaceLibrary* CAILibraryManager::FetchInterface(const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
-	
+
 	IAIInterfaceLibrary* interfaceLib = NULL;
-	
+
 	T_loadedInterfaces::const_iterator interfacePos = loadedAIInterfaceLibraries.find(interfaceSpecifier);
 	if (interfacePos == loadedAIInterfaceLibraries.end()) { // interface not yet loaded
 		T_interfaceInfos::const_iterator interfaceInfo = interfaceInfos.find(interfaceSpecifier);
 		if (interfaceInfo != interfaceInfos.end()) {
+std::string tst = interfaceInfo-&gt;second-&gt;GetDataDir();
 			//interfaceLib = new CAIInterfaceLibrary(interfaceSpecifier);
 			interfaceLib = new CAIInterfaceLibrary(interfaceInfo-&gt;second);
 			loadedAIInterfaceLibraries[interfaceSpecifier] = interfaceLib;
@@ -714,7 +718,7 @@
 }
 
 void CAILibraryManager::ReleaseInterface(const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
-	
+
 	T_loadedInterfaces::iterator interfacePos = loadedAIInterfaceLibraries.find(interfaceSpecifier);
 	if (interfacePos != loadedAIInterfaceLibraries.end()) {
 		IAIInterfaceLibrary* interfaceLib = interfacePos-&gt;second;
@@ -735,7 +739,7 @@
 }
 
 std::vector&lt;std::string&gt; CAILibraryManager::FindFiles(const std::string&amp; path, const std::string&amp; fileExtension) {
-	
+
 	std::vector&lt;std::string&gt; found;
 
 	if (boost::filesystem::exists(path)) {
@@ -747,22 +751,22 @@
 			  }
 		  }
 	}
-	
+
 	return found;
 }
 
 std::vector&lt;std::string&gt; CAILibraryManager::FindDirsAndDirectSubDirs(
 		const std::string&amp; path) {
-	
+
 	std::vector&lt;std::string&gt; found;
-	
+
 	 std::string pattern = &quot;*&quot;;
-	
+
 	// find dirs
 	std::vector&lt;std::string&gt; mainDirs = CFileHandler::SubDirs(path, pattern,
 			SPRING_VFS_RAW);
 	found = mainDirs;
-	
+
 	// find sub-dirs
 	for (std::vector&lt;std::string&gt;::iterator dir = mainDirs.begin();
 			dir != mainDirs.end(); ++dir) {
@@ -770,7 +774,7 @@
 				SPRING_VFS_RAW);
 		found.insert(found.end(), sub_dirs.begin(), sub_dirs.end());
 	}
-	
+
 	return found;
 }
 
@@ -778,7 +782,7 @@
 		const std::string&amp; shortName,
 		const std::string&amp; minVersion,
 		const T_interfaceSpecs&amp; specs) {
-	
+
 	std::set&lt;SAIInterfaceSpecifier&gt;::const_iterator spec;
 	int minDiff = INT_MAX;
 	const char* chosenShortName = NULL;
@@ -793,7 +797,7 @@
 			}
 		}
 	}
-	
+
 	SAIInterfaceSpecifier found = {chosenShortName, chosenVersion};
 	return found;
 }
@@ -835,20 +839,19 @@
 int CAILibraryManager::versionCompare(
 		const std::string&amp; version1,
 		const std::string&amp; version2) {/*TODO: test this function!*/
-	
+
 	std::vector&lt;std::string&gt; parts1 = split(version1, '.');
 	std::vector&lt;std::string&gt; parts2 = split(version2, '.');
 	//int partsDiff = parts1.size() - parts2.size();
 	unsigned int maxParts = parts1.size() &gt; parts2.size() ? parts1.size() : parts2.size();
-	
+
 	int diff = 0;
 	int mult = maxParts;
-    for (unsigned int i=0; i &lt; maxParts; ++i) {
+	for (unsigned int i=0; i &lt; maxParts; ++i) {
 		const std::string&amp; v1p = i &lt; parts1.size() ? parts1.at(i) : &quot;&quot;;
 		const std::string&amp; v2p = i &lt; parts2.size() ? parts2.at(i) : &quot;&quot;;
 		diff += (10^(mult*mult)) * v1p.compare(v2p);
-    }
+	}
 
 	return diff;
 }
-

Modified: branches/caiinterface/rts/ExternalAI/AILibraryManager.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/AILibraryManager.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/AILibraryManager.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -155,16 +155,16 @@
 	 *
 	 * The files are searched in all data-dirs (see fs.GetDataDirectories())
 	 * in the following sub-dirs:
-	 * AI/Interfaces/data/ * /InterfaceInfo.lua
-	 * AI/Interfaces/data/ * / * /InterfaceInfo.lua
-	 * AI/Skirmish/data/ * /AIInfo.lua
-	 * AI/Skirmish/data/ * / * /AIInfo.lua
-	 * AI/Group/data/ * /AIInfo.lua
-	 * AI/Group/data/ * / * /AIInfo.lua
+	 * {AI_INTERFACES_DATA_DIR}/{*}/InterfaceInfo.lua
+	 * {AI_INTERFACES_DATA_DIR}/{*}/{*}/InterfaceInfo.lua
+	 * {SKIRMISH_AI_DATA_DIR}/{*}/AIInfo.lua
+	 * {SKIRMISH_AI_DATA_DIR}/{*}/{*}/AIInfo.lua
+	 * {GROUP_AI_DATA_DIR}/{*}/AIInfo.lua
+	 * {GROUP_AI_DATA_DIR}/{*}/{*}/AIInfo.lua
 	 *
 	 * examples:
-	 * AI/Skirmish/data/KAIK-0.13/AIInfo.lua
-	 * AI/Skirmish/data/RAI/0.601/AIInfo.lua
+	 * AI/Skirmish/KAIK-0.13/AIInfo.lua
+	 * AI/Skirmish/RAI/0.601/AIInfo.lua
 	 */
 	void GetAllInfosFromCache();
 	/**

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp	2008-11-05 15:13:01 UTC (rev 6979)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software {} you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation {} either version 2 of the License, or
@@ -25,37 +25,32 @@
 #include &quot;Platform/errorhandler.h&quot;
 #include &quot;FileSystem/VFSModes.h&quot;
 
-/*
-CGroupAILibraryInfo::CGroupAILibraryInfo(const IGroupAILibrary&amp; ai,
-		const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
-	info = ai.GetInfo();
-	options = ai.GetOptions();
-	//levelOfSupport = ai.GetLevelOfSupportFor(std::string(ENGINE_VERSION_STRING),
-	//		ENGINE_VERSION_NUMBER, interfaceSpecifier);
-}
-*/
+CGroupAILibraryInfo::CGroupAILibraryInfo(const CGroupAILibraryInfo&amp; aiInfo) {
 
-CGroupAILibraryInfo::CGroupAILibraryInfo(const CGroupAILibraryInfo&amp; aiInfo) {
 	info = std::map&lt;std::string, InfoItem&gt;(
 			aiInfo.info.begin(),
 			aiInfo.info.end());
 	options = std::vector&lt;Option&gt;(
 			aiInfo.options.begin(),
 			aiInfo.options.end());
-	//levelOfSupport = aiInfo.levelOfSupport;
+
+	std::map&lt;std::string, InfoItem&gt;::iterator iip;
+	for (iip = info.begin(); iip != info.begin(); ++iip) {
+		iip-&gt;second = copyInfoItem(&amp;(iip-&gt;second));
+	}
 }
 
 CGroupAILibraryInfo::CGroupAILibraryInfo(
 		const std::string&amp; aiInfoFile,
 		const std::string&amp; aiOptionFile) {
-	
+
 	InfoItem tmpInfo[MAX_INFOS];
 	unsigned int num = ParseInfo(aiInfoFile.c_str(), SPRING_VFS_RAW,
 			SPRING_VFS_RAW, tmpInfo, MAX_INFOS);
-    for (unsigned int i=0; i &lt; num; ++i) {
+	for (unsigned int i=0; i &lt; num; ++i) {
 		info[std::string(tmpInfo[i].key)] = tmpInfo[i];
-    }
-	
+	}
+
 	if (!aiOptionFile.empty()) {
 		Option tmpOptions[MAX_OPTIONS];
 		num = ParseOptions(aiOptionFile.c_str(), SPRING_VFS_RAW, SPRING_VFS_RAW,
@@ -66,20 +61,25 @@
 	}
 }
 
-/*
-LevelOfSupport CGroupAILibraryInfo::GetLevelOfSupportForCurrentEngine() const {
-	return levelOfSupport;
+CGroupAILibraryInfo::~CGroupAILibraryInfo() {
+
+	std::map&lt;std::string, InfoItem&gt;::const_iterator iip;
+	for (iip = info.begin(); iip != info.begin(); ++iip) {
+		deleteInfoItem(&amp;(iip-&gt;second));
+	}
 }
-*/
 
 SGAISpecifier CGroupAILibraryInfo::GetSpecifier() const {
-	
+
 	const char* sn = info.at(GROUP_AI_PROPERTY_SHORT_NAME).value;
 	const char* v = info.at(GROUP_AI_PROPERTY_VERSION).value;
 	SGAISpecifier specifier = {sn, v};
 	return specifier;
 }
 
+std::string CGroupAILibraryInfo::GetDataDir() const {
+	return GetInfo(GROUP_AI_PROPERTY_DATA_DIR);
+}
 std::string CGroupAILibraryInfo::GetFileName() const {
 	return GetInfo(GROUP_AI_PROPERTY_FILE_NAME);
 }
@@ -118,30 +118,33 @@
 
 unsigned int CGroupAILibraryInfo::GetInfoCReference(InfoItem cInfo[],
 		unsigned int maxInfoItems) const {
-	
+
 	unsigned int i=0;
-	
+
 	std::map&lt;std::string, InfoItem&gt;::const_iterator infs;
 	for (infs=info.begin(); infs != info.end() &amp;&amp; i &lt; maxInfoItems; ++infs) {
 		cInfo[i++] = infs-&gt;second;
-    }
-	
+	}
+
 	return i;
 }
 unsigned int CGroupAILibraryInfo::GetOptionsCReference(Option cOptions[],
 		unsigned int maxOptions) const {
-	
+
 	unsigned int i=0;
-	
+
 	std::vector&lt;Option&gt;::const_iterator ops;
 	for (ops=options.begin(); ops != options.end() &amp;&amp; i &lt; maxOptions; ++ops) {
 		cOptions[i++] = *ops;
-    }
-	
+	}
+
 	return i;
 }
 
 
+void CGroupAILibraryInfo::SetDataDir(const std::string&amp; dataDir) {
+	SetInfo(GROUP_AI_PROPERTY_DATA_DIR, dataDir);
+}
 void CGroupAILibraryInfo::SetFileName(const std::string&amp; fileName) {
 	SetInfo(GROUP_AI_PROPERTY_FILE_NAME, fileName);
 }
@@ -170,7 +173,7 @@
 }
 bool CGroupAILibraryInfo::SetInfo(const std::string&amp; key,
 		const std::string&amp; value) {
-	
+
 	if (key == GROUP_AI_PROPERTY_SHORT_NAME ||
 			key == GROUP_AI_PROPERTY_VERSION) {
 		if (value.find_first_of(&quot;\t _#&quot;) != std::string::npos) {
@@ -181,8 +184,10 @@
 			return false;
 		}
 	}
-	
+
 	InfoItem ii = {key.c_str(), value.c_str(), NULL};
+	ii = copyInfoItem(&amp;ii);
+
 	info[key] = ii;
 	return true;
 }

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software {} you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation {} either version 2 of the License, or
@@ -33,43 +33,44 @@
 
 class CGroupAILibraryInfo {
 public:
-//	CGroupAILibraryInfo(const IGroupAILibrary&amp; ai,
-//			const SAIInterfaceSpecifier&amp; interfaceSpecifier);
 	CGroupAILibraryInfo(const CGroupAILibraryInfo&amp; aiInfo);
 	CGroupAILibraryInfo(const std::string&amp; aiInfoFile,
 			const std::string&amp; aiOptionFile);
-    
-    virtual SGAISpecifier GetSpecifier() const;
-	
-    virtual std::string GetFileName() const;
-    virtual std::string GetShortName() const; // restrictions: none of the following: spaces, '_', '#'
-    virtual std::string GetName() const;
-    virtual std::string GetVersion() const; // restrictions: none of the following: spaces, '_', '#'
-    virtual std::string GetDescription() const;
-    virtual std::string GetURL() const;
-    virtual std::string GetInterfaceShortName() const;
-    virtual std::string GetInterfaceVersion() const;
-    virtual std::string GetInfo(const std::string&amp; key) const;
-    virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
+	~CGroupAILibraryInfo();
+
+	virtual SGAISpecifier GetSpecifier() const;
+
+	virtual std::string GetDataDir() const;
+	virtual std::string GetFileName() const;
+	virtual std::string GetShortName() const; // restrictions: none of the following: spaces, '_', '#'
+	virtual std::string GetName() const;
+	virtual std::string GetVersion() const; // restrictions: none of the following: spaces, '_', '#'
+	virtual std::string GetDescription() const;
+	virtual std::string GetURL() const;
+	virtual std::string GetInterfaceShortName() const;
+	virtual std::string GetInterfaceVersion() const;
+	virtual std::string GetInfo(const std::string&amp; key) const;
+	virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
 	virtual unsigned int GetInfoCReference(InfoItem cInfo[],
 			unsigned int maxInfoItems) const;
 	virtual unsigned int GetOptionsCReference(Option cOptions[],
 			unsigned int maxOptions) const;
-	
+
 	virtual const std::vector&lt;Option&gt;* GetOptions() const;
-	
+
+	virtual void SetDataDir(const std::string&amp; dataDir);
 	virtual void SetFileName(const std::string&amp; fileName);
-    virtual void SetShortName(const std::string&amp; shortName); // restrictions: none of the following: spaces, '_', '#'
-    virtual void SetName(const std::string&amp; name);
-    virtual void SetVersion(const std::string&amp; version); // restrictions: none of the following: spaces, '_', '#'
-    virtual void SetDescription(const std::string&amp; description);
-    virtual void SetURL(const std::string&amp; url);
-    virtual void SetInterfaceShortName(const std::string&amp; interfaceShortName);
-    virtual void SetInterfaceVersion(const std::string&amp; interfaceVersion);
-    virtual bool SetInfo(const std::string&amp; key, const std::string&amp; value);
-	
+	virtual void SetShortName(const std::string&amp; shortName); // restrictions: none of the following: spaces, '_', '#'
+	virtual void SetName(const std::string&amp; name);
+	virtual void SetVersion(const std::string&amp; version); // restrictions: none of the following: spaces, '_', '#'
+	virtual void SetDescription(const std::string&amp; description);
+	virtual void SetURL(const std::string&amp; url);
+	virtual void SetInterfaceShortName(const std::string&amp; interfaceShortName);
+	virtual void SetInterfaceVersion(const std::string&amp; interfaceVersion);
+	virtual bool SetInfo(const std::string&amp; key, const std::string&amp; value);
+
 	virtual void SetOptions(const std::vector&lt;Option&gt;&amp; options);
-	
+
 private:
 	static const unsigned int MAX_INFOS = 128;
 	static const unsigned int MAX_OPTIONS = 128;
@@ -77,5 +78,4 @@
 	std::vector&lt;Option&gt; options;
 };
 
-#endif	/* _GROUPAILIBRARYINFO_H */
-
+#endif	// _GROUPAILIBRARYINFO_H

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -32,14 +32,15 @@
 
 struct SStaticGlobalData;
 
-#define AI_INTERFACE_PROPERTY_FILE_NAME &quot;fileName&quot;                     // [string] when the library file is &quot;libC-0.1.so&quot; or &quot;C-0.1.dll&quot;, this value should be &quot;C-0.1&quot;
-#define AI_INTERFACE_PROPERTY_SHORT_NAME &quot;shortName&quot;                   // [string: [a-zA-Z0-9_.]*]
-#define AI_INTERFACE_PROPERTY_VERSION &quot;version&quot;                        // [string: [a-zA-Z0-9_.]*]
-#define AI_INTERFACE_PROPERTY_NAME &quot;name&quot;                              // [string]
-#define AI_INTERFACE_PROPERTY_DESCRIPTION &quot;description&quot;                // [string]
-#define AI_INTERFACE_PROPERTY_URL &quot;url&quot;                                // [string]
-#define AI_INTERFACE_PROPERTY_SUPPORTED_LANGUAGES &quot;supportedLanguages&quot; // [string]
-#define AI_INTERFACE_PROPERTY_ENGINE_VERSION &quot;engineVersion&quot;           // [int] the engine version number the AI was compiled, but may work with newer or older ones too
+#define AI_INTERFACE_PROPERTY_DATA_DIR               &quot;dataDir&quot;               // [string] absolute data dir containing the AIs AIInfo.lua file. this property is by the engine, not read from any file.
+#define AI_INTERFACE_PROPERTY_FILE_NAME              &quot;fileName&quot;              // [string] when the library file is &quot;libC-0.1.so&quot; or &quot;C-0.1.dll&quot;, this value should be &quot;C-0.1&quot;
+#define AI_INTERFACE_PROPERTY_SHORT_NAME             &quot;shortName&quot;             // [string: [a-zA-Z0-9_.]*]
+#define AI_INTERFACE_PROPERTY_VERSION                &quot;version&quot;               // [string: [a-zA-Z0-9_.]*]
+#define AI_INTERFACE_PROPERTY_NAME                   &quot;name&quot;                  // [string]
+#define AI_INTERFACE_PROPERTY_DESCRIPTION            &quot;description&quot;           // [string]
+#define AI_INTERFACE_PROPERTY_URL                    &quot;url&quot;                   // [string]
+#define AI_INTERFACE_PROPERTY_SUPPORTED_LANGUAGES    &quot;supportedLanguages&quot;    // [string]
+#define AI_INTERFACE_PROPERTY_ENGINE_VERSION         &quot;engineVersion&quot;         // [int] the engine version number the AI was compiled, but may work with newer or older ones too
 
 /**
  * @brief struct Artificial Intelligence Interface Specifier
@@ -77,9 +78,9 @@
  * @brief struct Artificial Intelligence Interface
  */
 struct SAIInterfaceLibrary {
-	
+
 	// static AI interface library functions
-	
+
 	/**
 	 * This function is called right after the library is dynamically loaded.
 	 * It can be used to initialize variables and to check or prepare
@@ -97,7 +98,7 @@
 	 * @return	ok: 0, error: != 0
 	 */
 	int (CALLING_CONV *initStatic)(const struct SStaticGlobalData* staticGlobalData);
-	
+
 	/**
 	 * This function is called right right before the library is unloaded.
 	 * It can be used to deinitialize variables and to cleanup the environment,
@@ -111,7 +112,7 @@
 	 * @return	ok: 0, error: != 0
 	 */
 	int (CALLING_CONV *releaseStatic)();
-	
+
 	/**
 	 * Level of Support for a specific engine version.
 	 *
@@ -130,10 +131,10 @@
 	 */
 	unsigned int (CALLING_CONV *getInfo)(struct InfoItem info[],
 			unsigned int maxInfoItems);
-	
-	
+
+
 	// skirmish AI methods
-	
+
 	/**
 	 * Loads the specified Skirmish AI.
 	 *
@@ -143,7 +144,7 @@
 	//const struct SSAILibrary* (CALLING_CONV *loadSkirmishAILibrary)(const struct SSAISpecifier* const sAISpecifier);
 	const struct SSAILibrary* (CALLING_CONV *loadSkirmishAILibrary)(
 			const struct InfoItem info[], unsigned int numInfoItems);
-	
+
 	/**
 	 * Unloads the specified Skirmish AI.
 	 *
@@ -151,17 +152,17 @@
 	 */
 	int (CALLING_CONV *unloadSkirmishAILibrary)(
 			const struct SSAISpecifier* const sAISpecifier);
-	
+
 	/**
 	 * Unloads all Skirmish AI libraries currently loaded by this interface.
 	 *
 	 * @return	ok: 0, error: != 0
 	 */
 	int (CALLING_CONV *unloadAllSkirmishAILibraries)();
-	
-	
+
+
 	// group AI methods
-	
+
 	/**
 	 * Loads the specified Group AI.
 	 *
@@ -171,7 +172,7 @@
 	//const struct SGAILibrary* (CALLING_CONV *loadGroupAILibrary)(const struct SGAISpecifier* const gAISpecifier);
 	const struct SGAILibrary* (CALLING_CONV *loadGroupAILibrary)(
 			const struct InfoItem info[], unsigned int numInfoItems);
-	
+
 	/**
 	 * Unloads the specified Group AI.
 	 *
@@ -179,7 +180,7 @@
 	 */
 	int (CALLING_CONV *unloadGroupAILibrary)(
 			const struct SGAISpecifier* const gAISpecifier);
-	
+
 	/**
 	 * Unloads all Group AI libraries currently loaded by this interface.
 	 *

Modified: branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -27,16 +27,17 @@
 #include &quot;ELevelOfSupport.h&quot;
 #include &quot;exportdefines.h&quot;
 
-#define GROUP_AI_PROPERTY_FILE_NAME &quot;fileName&quot;                      // [string] when the library file is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
-#define GROUP_AI_PROPERTY_SHORT_NAME &quot;shortName&quot;                    // [string: [a-zA-Z0-9_.]*]
-#define GROUP_AI_PROPERTY_VERSION &quot;version&quot;                         // [string: [a-zA-Z0-9_.]*]
-#define GROUP_AI_PROPERTY_NAME &quot;name&quot;                               // [string]
-#define GROUP_AI_PROPERTY_DESCRIPTION &quot;description&quot;                 // [string]
-#define GROUP_AI_PROPERTY_URL &quot;url&quot;                                 // [string]
-#define GROUP_AI_PROPERTY_LOAD_SUPPORTED &quot;loadSupported&quot;            // [bool: &quot;yes&quot; | &quot;no&quot;]
-#define GROUP_AI_PROPERTY_ENGINE_VERSION &quot;engineVersion&quot;            // [int] the engine version number the AI was compiled, but may work with newer or older ones too
-#define GROUP_AI_PROPERTY_INTERFACE_SHORT_NAME &quot;interfaceShortName&quot; // [string: [a-zA-Z0-9_.]*] this interface has to be used to load the AI
-#define GROUP_AI_PROPERTY_INTERFACE_VERSION &quot;interfaceVersion&quot;      // [string: [a-zA-Z0-9_.]*] the interface version number the AI was compiled, but may work with newer or older ones too
+#define GROUP_AI_PROPERTY_DATA_DIR                &quot;dataDir&quot;               // [string] absolute data dir containing the AIs AIInfo.lua file. this property is by the engine, not read from any file.
+#define GROUP_AI_PROPERTY_FILE_NAME               &quot;fileName&quot;              // [string] when the library file is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
+#define GROUP_AI_PROPERTY_SHORT_NAME              &quot;shortName&quot;             // [string: [a-zA-Z0-9_.]*]
+#define GROUP_AI_PROPERTY_VERSION                 &quot;version&quot;               // [string: [a-zA-Z0-9_.]*]
+#define GROUP_AI_PROPERTY_NAME                    &quot;name&quot;                  // [string]
+#define GROUP_AI_PROPERTY_DESCRIPTION             &quot;description&quot;           // [string]
+#define GROUP_AI_PROPERTY_URL                     &quot;url&quot;                   // [string]
+#define GROUP_AI_PROPERTY_LOAD_SUPPORTED          &quot;loadSupported&quot;         // [bool: &quot;yes&quot; | &quot;no&quot;]
+#define GROUP_AI_PROPERTY_ENGINE_VERSION          &quot;engineVersion&quot;         // [int] the engine version number the AI was compiled, but may work with newer or older ones too
+#define GROUP_AI_PROPERTY_INTERFACE_SHORT_NAME    &quot;interfaceShortName&quot;    // [string: [a-zA-Z0-9_.]*] this interface has to be used to load the AI
+#define GROUP_AI_PROPERTY_INTERFACE_VERSION       &quot;interfaceVersion&quot;      // [string: [a-zA-Z0-9_.]*] the interface version number the AI was compiled, but may work with newer or older ones too
 
 #if !defined BUILDING_AI
 /**
@@ -71,9 +72,9 @@
  * @brief struct Group Artificial Intelligence
  */
 struct SGAILibrary {
-	
+
 	// static AI library functions
-	
+
 	/**
 	 * Level of Support for a specific engine version and AI interface version.
 	 *
@@ -87,7 +88,7 @@
 			int teamId, int groupId,
 			const char* engineVersionString, int engineVersionNumber,
 			const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-	
+
 	/**
 	 * Returns info about this AI library.
 	 *
@@ -100,7 +101,7 @@
 	 */
 	unsigned int (CALLING_CONV *getInfo)(int teamId, int groupId,
 			struct InfoItem info[], unsigned int maxInfoItems);
-	
+
 	/**
 	 * Returns options that can be set on this AI.
 	 *
@@ -114,9 +115,9 @@
 	unsigned int (CALLING_CONV *getOptions)(int teamId, int groupId,
 			struct Option options[], unsigned int maxOptions);
 
-	
+
 	// team and group instance functions
-	
+
 	/**
 	 * This function is called, when an AI instance shall be created for teamId.
 	 * It is called before the first call to handleEvent() for teamId.
@@ -149,7 +150,7 @@
 	 */
 	int (CALLING_CONV *init)(int teamId, int groupId,
 			const struct InfoItem info[], unsigned int numInfoItems);
-	
+
 	/**
 	 * This function is called, when an AI instance shall be deleted.
 	 * It is called after the last call to handleEvent() for teamId.
@@ -179,7 +180,7 @@
 	 * @return	ok: 0, error: != 0
 	 */
 	int (CALLING_CONV *release)(int teamId, int groupId);
-	
+
 	/**
 	 * Through this function, the AI receives events from the engine.
 	 * For details about events that may arrive here, see file AISEvents.h.

Modified: branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -27,16 +27,17 @@
 #include &quot;ELevelOfSupport.h&quot;
 #include &quot;exportdefines.h&quot;
 
-#define SKIRMISH_AI_PROPERTY_FILE_NAME &quot;fileName&quot;                      // [string] when the library file is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
-#define SKIRMISH_AI_PROPERTY_SHORT_NAME &quot;shortName&quot;                    // [string: [a-zA-Z0-9_.]*]
-#define SKIRMISH_AI_PROPERTY_VERSION &quot;version&quot;                         // [string: [a-zA-Z0-9_.]*]
-#define SKIRMISH_AI_PROPERTY_NAME &quot;name&quot;                               // [string]
-#define SKIRMISH_AI_PROPERTY_DESCRIPTION &quot;description&quot;                 // [string]
-#define SKIRMISH_AI_PROPERTY_URL &quot;url&quot;                                 // [string]
-#define SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED &quot;loadSupported&quot;            // [bool: &quot;yes&quot; | &quot;no&quot;]
-#define SKIRMISH_AI_PROPERTY_ENGINE_VERSION &quot;engineVersion&quot;            // [int] the engine version number the AI was compiled, but may work with newer or older ones too
-#define SKIRMISH_AI_PROPERTY_INTERFACE_SHORT_NAME &quot;interfaceShortName&quot; // [string: [a-zA-Z0-9_.]*] this interface has to be used to load the AI
-#define SKIRMISH_AI_PROPERTY_INTERFACE_VERSION &quot;interfaceVersion&quot;      // [string: [a-zA-Z0-9_.]*] the interface version number the AI was compiled, but may work with newer or older ones too
+#define SKIRMISH_AI_PROPERTY_DATA_DIR                &quot;dataDir&quot;               // [string] absolute data dir containing the AIs AIInfo.lua file. this property is by the engine, not read from any file.
+#define SKIRMISH_AI_PROPERTY_FILE_NAME               &quot;fileName&quot;              // [string] when the library file is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
+#define SKIRMISH_AI_PROPERTY_SHORT_NAME              &quot;shortName&quot;             // [string: [a-zA-Z0-9_.]*]
+#define SKIRMISH_AI_PROPERTY_VERSION                 &quot;version&quot;               // [string: [a-zA-Z0-9_.]*]
+#define SKIRMISH_AI_PROPERTY_NAME                    &quot;name&quot;                  // [string]
+#define SKIRMISH_AI_PROPERTY_DESCRIPTION             &quot;description&quot;           // [string]
+#define SKIRMISH_AI_PROPERTY_URL                     &quot;url&quot;                   // [string]
+#define SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED          &quot;loadSupported&quot;         // [bool: &quot;yes&quot; | &quot;no&quot;]
+#define SKIRMISH_AI_PROPERTY_ENGINE_VERSION          &quot;engineVersion&quot;         // [int] the engine version number the AI was compiled, but may work with newer or older ones too
+#define SKIRMISH_AI_PROPERTY_INTERFACE_SHORT_NAME    &quot;interfaceShortName&quot;    // [string: [a-zA-Z0-9_.]*] this interface has to be used to load the AI
+#define SKIRMISH_AI_PROPERTY_INTERFACE_VERSION       &quot;interfaceVersion&quot;      // [string: [a-zA-Z0-9_.]*] the interface version number the AI was compiled, but may work with newer or older ones too
 
 #if !defined BUILDING_AI
 /**
@@ -72,9 +73,9 @@
  * @brief struct Skirmish Artificial Intelligence
  */
 struct SSAILibrary {
-	
+
 	// static AI library functions
-	
+
 	/**
 	 * Level of Support for a specific engine version and AI interface version.
 	 *
@@ -87,7 +88,7 @@
 	enum LevelOfSupport (CALLING_CONV *getLevelOfSupportFor)(int teamId,
 			const char* engineVersionString, int engineVersionNumber,
 			const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-	
+
 	/**
 	 * Returns info about this AI library.
 	 *
@@ -100,7 +101,7 @@
 	 */
 	unsigned int (CALLING_CONV *getInfo)(int teamId, struct InfoItem info[],
 			unsigned int maxInfoItems);
-	
+
 	/**
 	 * Returns options that can be set on this AI.
 	 *
@@ -114,9 +115,9 @@
 	unsigned int (CALLING_CONV *getOptions)(int teamId, struct Option options[],
 			unsigned int maxOptions);
 
-	
+
 	// team instance functions
-	
+
 	/**
 	 * This function is called, when an AI instance shall be created for teamId.
 	 * It is called before the first call to handleEvent() for teamId.
@@ -148,7 +149,7 @@
 	 */
 	int (CALLING_CONV *init)(int teamId, const struct InfoItem info[],
 			unsigned int numInfoItems);
-	
+
 	/**
 	 * This function is called, when an AI instance shall be deleted.
 	 * It is called after the last call to handleEvent() for teamId.
@@ -177,7 +178,7 @@
 	 * @return	ok: 0, error: != 0
 	 */
 	int (CALLING_CONV *release)(int teamId);
-	
+
 	/**
 	 * Through this function, the AI receives events from the engine.
 	 * For details about events that may arrive here, see file AISEvents.h.
@@ -199,7 +200,7 @@
 };
 
 #ifdef	__cplusplus
-}
+}	// extern &quot;C&quot;
 #endif
 
 #endif	// _SSAILIBRARY_H

Modified: branches/caiinterface/rts/ExternalAI/Interface/aidefines.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/aidefines.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/Interface/aidefines.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -41,17 +41,12 @@
 //const unsigned int MAX_SKIRMISH_AIS = MAX_TEAMS - 1;
 #define MAX_SKIRMISH_AIS 16
 
-//const char* const AI_INTERFACES_DIR = &quot;AI/interfaces&quot;;
-//#define AI_INTERFACES_DIR &quot;AI/interfaces&quot;
-#define AI_INTERFACES_IMPLS_DIR &quot;AI/Interfaces/impls&quot;
-#define AI_INTERFACES_DATA_DIR &quot;AI/Interfaces/data&quot;
-//#define AI_INTERFACES_LOGS_DIR &quot;AI/Interfaces/logs&quot;
+//const char* const AI_INTERFACES_DATA_DIR = &quot;AI/Interfaces&quot;;
+#define AI_INTERFACES_DATA_DIR &quot;AI/Interfaces&quot;
 
-#define SKIRMISH_AI_IMPLS_DIR &quot;AI/Skirmish/impls&quot;
-#define SKIRMISH_AI_DATA_DIR &quot;AI/Skirmish/data&quot;
+#define SKIRMISH_AI_DATA_DIR &quot;AI/Skirmish&quot;
 
-#define GROUP_AI_IMPLS_DIR &quot;AI/Group/impls&quot;
-#define GROUP_AI_DATA_DIR &quot;AI/Group/data&quot;
+#define GROUP_AI_DATA_DIR &quot;AI/Group&quot;
 
 #ifdef	__cplusplus
 }	// extern &quot;C&quot;

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp	2008-11-05 15:13:01 UTC (rev 6979)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software {} you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation {} either version 2 of the License, or
@@ -25,38 +25,33 @@
 #include &quot;Platform/errorhandler.h&quot;
 #include &quot;FileSystem/VFSModes.h&quot;
 
-/*
-CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(const ISkirmishAILibrary&amp; ai,
-		const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
-	info = ai.GetInfo();
-	options = ai.GetOptions();
-	//levelOfSupport = ai.GetLevelOfSupportFor(std::string(ENGINE_VERSION_STRING),
-	//		ENGINE_VERSION_NUMBER, interfaceSpecifier);
-}
-*/
-
 CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(
 		const CSkirmishAILibraryInfo&amp; aiInfo) {
+
 	info = std::map&lt;std::string, InfoItem&gt;(
 			aiInfo.info.begin(),
 			aiInfo.info.end());
 	options = std::vector&lt;Option&gt;(
 			aiInfo.options.begin(),
 			aiInfo.options.end());
-	//levelOfSupport = aiInfo.levelOfSupport;
+
+	std::map&lt;std::string, InfoItem&gt;::iterator iip;
+	for (iip = info.begin(); iip != info.begin(); ++iip) {
+		iip-&gt;second = copyInfoItem(&amp;(iip-&gt;second));
+	}
 }
 
 CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(
 		const std::string&amp; aiInfoFile,
 		const std::string&amp; aiOptionFile) {
-	
+
 	InfoItem tmpInfo[MAX_INFOS];
 	unsigned int num = ParseInfo(aiInfoFile.c_str(), SPRING_VFS_RAW,
 			SPRING_VFS_RAW, tmpInfo, MAX_INFOS);
-    for (unsigned int i=0; i &lt; num; ++i) {
+	for (unsigned int i=0; i &lt; num; ++i) {
 		info[std::string(tmpInfo[i].key)] = tmpInfo[i];
-    }
-	
+	}
+
 	if (!aiOptionFile.empty()) {
 		Option tmpOptions[MAX_OPTIONS];
 		num = ParseOptions(aiOptionFile.c_str(), SPRING_VFS_RAW, SPRING_VFS_RAW,
@@ -65,23 +60,27 @@
 			options.push_back(tmpOptions[i]);
 		}
 	}
-	//options = ParseOptions(aiOptionFile, fileModes, accessModes);
 }
 
-/*
-LevelOfSupport CSkirmishAILibraryInfo::GetLevelOfSupportForCurrentEngineAndSetInterface() const {
-	return levelOfSupport;
+CSkirmishAILibraryInfo::~CSkirmishAILibraryInfo() {
+
+	std::map&lt;std::string, InfoItem&gt;::const_iterator iip;
+	for (iip = info.begin(); iip != info.begin(); ++iip) {
+		deleteInfoItem(&amp;(iip-&gt;second));
+	}
 }
-*/
 
 SSAISpecifier CSkirmishAILibraryInfo::GetSpecifier() const {
-	
+
 	const char* sn = info.at(SKIRMISH_AI_PROPERTY_SHORT_NAME).value;
 	const char* v = info.at(SKIRMISH_AI_PROPERTY_VERSION).value;
 	SSAISpecifier specifier = {sn, v};
 	return specifier;
 }
 
+std::string CSkirmishAILibraryInfo::GetDataDir() const {
+	return GetInfo(SKIRMISH_AI_PROPERTY_DATA_DIR);
+}
 std::string CSkirmishAILibraryInfo::GetFileName() const {
 	return GetInfo(SKIRMISH_AI_PROPERTY_FILE_NAME);
 }
@@ -120,30 +119,33 @@
 
 unsigned int CSkirmishAILibraryInfo::GetInfoCReference(InfoItem cInfo[],
 		unsigned int maxInfoItems) const {
-	
+
 	unsigned int i=0;
-	
+
 	std::map&lt;std::string, InfoItem&gt;::const_iterator infs;
 	for (infs=info.begin(); infs != info.end() &amp;&amp; i &lt; maxInfoItems; ++infs) {
 		cInfo[i++] = infs-&gt;second;
-    }
-	
+	}
+
 	return i;
 }
 unsigned int CSkirmishAILibraryInfo::GetOptionsCReference(Option cOptions[],
 		unsigned int maxOptions) const {
-	
+
 	unsigned int i=0;
-	
+
 	std::vector&lt;Option&gt;::const_iterator ops;
 	for (ops=options.begin(); ops != options.end() &amp;&amp; i &lt; maxOptions; ++ops) {
 		cOptions[i++] = *ops;
-    }
-	
+	}
+
 	return i;
 }
 
 
+void CSkirmishAILibraryInfo::SetDataDir(const std::string&amp; dataDir) {
+	SetInfo(SKIRMISH_AI_PROPERTY_DATA_DIR, dataDir);
+}
 void CSkirmishAILibraryInfo::SetFileName(const std::string&amp; fileName) {
 	SetInfo(SKIRMISH_AI_PROPERTY_FILE_NAME, fileName);
 }
@@ -169,7 +171,7 @@
 	SetInfo(SKIRMISH_AI_PROPERTY_INTERFACE_VERSION, interfaceVersion);
 }
 bool CSkirmishAILibraryInfo::SetInfo(const std::string&amp; key, const std::string&amp; value) {
-	
+
 	if (key == SKIRMISH_AI_PROPERTY_SHORT_NAME ||
 			key == SKIRMISH_AI_PROPERTY_VERSION) {
 		if (value.find_first_of(&quot;\t _#&quot;) != std::string::npos) {
@@ -177,8 +179,10 @@
 			return false;
 		}
 	}
-	
+
 	InfoItem ii = {key.c_str(), value.c_str(), NULL};
+	ii = copyInfoItem(&amp;ii);
+
 	info[key] = ii;
 	return true;
 }

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h	2008-11-04 16:51:06 UTC (rev 6978)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h	2008-11-05 15:13:01 UTC (rev 6979)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -16,7 +16,7 @@
 */
 
 #ifndef _SKIRMISHAILIBRARYINFO_H
-#define	_SKIRMISHAILIBRARYINFO_H
+#define _SKIRMISHAILIBRARYINFO_H
 
 #include &quot;Interface/ELevelOfSupport.h&quot;
 
@@ -32,54 +32,49 @@
 
 class CSkirmishAILibraryInfo {
 public:
-//	CSkirmishAILibraryInfo(const ISkirmishAILibrary&amp; ai,
-//			const SAIInterfaceSpecifier&amp; interfaceSpecifier);
 	CSkirmishAILibraryInfo(const CSkirmishAILibraryInfo&amp; aiInfo);
 	CSkirmishAILibraryInfo(const std::string&amp; aiInfoFile,
 			const std::string&amp; aiOptionFile);
-    
-//    virtual LevelOfSupport GetLevelOfSupportForCurrentEngineAndSetInterface() const;
-//    virtual LevelOfSupport GetLevelOfSupportForCurrentEngine(SAIInterfaceSpecifier interfaceSpecifier) const;
-	
-    virtual SSAISpecifier GetSpecifier() const;
-	
-    virtual std::string GetFileName() const;
-    virtual std::string GetShortName() const; // restrictions: none of the following: spaces, '_', '#'
-    virtual std::string GetName() const;
-    virtual std::string GetVersion() const; // restrictions: none of the following: spaces, '_', '#'
-    virtual std::string GetDescription() const;
-    virtual std::string GetURL() const;
-    virtual std::string GetInterfaceShortName() const;
-    virtual std::string GetInterfaceVersion() const;
-    virtual std::string GetInfo(const std::string&amp; key) const;
-    virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
-//    virtual std::vector&lt;std::string&gt; GetPropertyNames() const;
+	~CSkirmishAILibraryInfo();
+
+	virtual SSAISpecifier GetSpecifier() const;
+
+	virtual std::string GetDataDir() const;
+	virtual std::string GetFileName() const;
+	virtual std::string GetShortName() const; // restrictions: none of the following: spaces, '_', '#'
+	virtual std::string GetName() const;
+	virtual std::string GetVersion() const; // restrictions: none of the following: spaces, '_', '#'
+	virtual std::string GetDescription() const;
+	virtual std::string GetURL() const;
+	virtual std::string GetInterfaceShortName() const;
+	virtual std::string GetInterfaceVersion() const;
+	virtual std::string GetInfo(const std::string&amp; key) const;
+	virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
 	virtual unsigned int GetInfoCReference(InfoItem cInfo[],
 			unsigned int maxInfoItems) const;
 	virtual unsigned int GetOptionsCReference(Option cOptions[],
 			unsigned int maxOptions) const;
-	
+
 	virtual const std::vector&lt;Option&gt;* GetOptions() const;
-	
+
+	virtual void SetDataDir(const std::string&amp; dataDir);
 	virtual void SetFileName(const std::string&amp; fileName);
-    virtual void SetShortName(const std::string&amp; shortName); // restrictions: none of the following: spaces, '_', '#'
-    virtual void SetName(const std::string&amp; name);
-    virtual void SetVersion(const std::string&amp; version); // restrictions: none of the following: spaces, '_', '#'
-    virtual void SetDescription(const std::string&amp; description);
-    virtual void SetURL(const std::string&amp; url);
-    virtual void SetInterfaceShortName(const std::string&amp; interfaceShortName);
-    virtual void SetInterfaceVersion(const std::string&amp; interfaceVersion);
-    virtual bool SetInfo(const std::string&amp; key, const std::string&amp; value);
-	
+	virtual void SetShortName(const std::string&amp; shortName); // restrictions: none of the following: spaces, '_', '#'
+	virtual void SetName(const std::string&amp; name);
+	virtual void SetVersion(const std::string&amp; version); // restrictions: none of the following: spaces, '_', '#'
+	virtual void SetDescription(const std::string&amp; description);
+	virtual void SetURL(const std::string&amp; url);
+	virtual void SetInterfaceShortName(const std::string&amp; interfaceShortName);
+	virtual void SetInterfaceVersion(const std::string&amp; interfaceVersion);
+	virtual bool SetInfo(const std::string&amp; key, const std::string&amp; value);
+
 	virtual void SetOptions(const std::vector&lt;Option&gt;&amp; options);
-	
+
 private:
 	static const unsigned int MAX_INFOS = 128;
 	static const unsigned int MAX_OPTIONS = 128;
 	std::map&lt;std::string, InfoItem&gt; info;
 	std::vector&lt;Option&gt; options;
-	//LevelOfSupport levelOfSupport;
 };
 
 #endif	// _SKIRMISHAILIBRARYINFO_H
-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001747.html">[Taspring-linux-commit] r6978 - in branches/caiinterface:	AI/Interfaces/Java AI/Skirmish/RAI rts/ExternalAI	rts/ExternalAI/Interface
</A></li>
	<LI>Next message: <A HREF="001749.html">[Taspring-linux-commit] r6980 - in branches/caiinterface:	installer/builddata/springcontent/gamedata rts/Game	rts/Game/StartScripts rts/Game/UI rts/Lua	rts/Rendering/UnitModels rts/Sim/Misc rts/Sim/Projectiles	rts/Sim/Projectiles/WeaponProjectiles rts/Sim/Units	rts/Sim/Weapons rts/System rts/build/vstudio8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1748">[ date ]</a>
              <a href="thread.html#1748">[ thread ]</a>
              <a href="subject.html#1748">[ subject ]</a>
              <a href="author.html#1748">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
