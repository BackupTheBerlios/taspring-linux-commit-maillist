<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7262 - Lobby/TASClient
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2009-June/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7262%20-%20Lobby/TASClient&In-Reply-To=%3C20090605210306.23F083B6ED%40it-l.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002030.html">
   <LINK REL="Next"  HREF="002032.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7262 - Lobby/TASClient</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7262%20-%20Lobby/TASClient&In-Reply-To=%3C20090605210306.23F083B6ED%40it-l.eu%3E"
       TITLE="[Taspring-linux-commit] r7262 - Lobby/TASClient">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Fri Jun  5 23:03:06 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002030.html">[Taspring-linux-commit] r7261 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="002032.html">[Taspring-linux-commit] r7263 - Lobby/TASServer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2031">[ date ]</a>
              <a href="thread.html#2031">[ thread ]</a>
              <a href="subject.html#2031">[ subject ]</a>
              <a href="author.html#2031">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2009-06-05 23:03:04 +0200 (Fri, 05 Jun 2009)
New Revision: 7262

Modified:
   Lobby/TASClient/AutoTeamsUnit.dfm
   Lobby/TASClient/AutoTeamsUnit.pas
   Lobby/TASClient/BattleFormUnit.dfm
   Lobby/TASClient/BattleFormUnit.pas
   Lobby/TASClient/HostBattleFormUnit.dfm
   Lobby/TASClient/MainUnit.dfm
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.res
Log:
* replaced all id/team selectors by spinedits
* max ids/teams set to 100

Modified: Lobby/TASClient/AutoTeamsUnit.dfm
===================================================================
--- Lobby/TASClient/AutoTeamsUnit.dfm	2009-06-01 01:00:33 UTC (rev 7261)
+++ Lobby/TASClient/AutoTeamsUnit.dfm	2009-06-05 21:03:04 UTC (rev 7262)
@@ -1,6 +1,6 @@
 object AutoTeamsForm: TAutoTeamsForm
-  Left = 700
-  Top = 446
+  Left = 288
+  Top = 112
   Width = 599
   Height = 335
   BorderStyle = bsSizeToolWin
@@ -81,34 +81,6 @@
         LinkFont.Name = 'MS Sans Serif'
         LinkFont.Style = [fsUnderline]
       end
-      object NumOfAlliesButton: TTBXButton
-        Left = 128
-        Top = 54
-        Width = 41
-        Height = 20
-        AutoSize = False
-        Caption = '2'
-        Images = MainForm.MiscImageList
-        Layout = blGlyphRight
-        ParentShowHint = False
-        ShowHint = False
-        TabOrder = 2
-        OnClick = NumOfAlliesButtonClick
-      end
-      object PlayersPerCommButton: TTBXButton
-        Left = 128
-        Top = 78
-        Width = 41
-        Height = 20
-        AutoSize = False
-        Caption = '1'
-        Images = MainForm.MiscImageList
-        Layout = blGlyphRight
-        ParentShowHint = False
-        ShowHint = False
-        TabOrder = 3
-        OnClick = PlayersPerCommButtonClick
-      end
       object SpTBXLabel2: TSpTBXLabel
         Left = 8
         Top = 80
@@ -134,6 +106,48 @@
         LinkFont.Name = 'MS Sans Serif'
         LinkFont.Style = [fsUnderline]
       end
+      object NumOfAlliesSpin: TSpTBXSpinEdit
+        Left = 136
+        Top = 56
+        Width = 41
+        Height = 21
+        TabOrder = 4
+        MaxValue = 200.000000000000000000
+        MinValue = 1.000000000000000000
+        SpinButton.Left = 22
+        SpinButton.Top = 0
+        SpinButton.Width = 15
+        SpinButton.Height = 17
+        SpinButton.Align = alRight
+        SpinButton.LinkFont.Charset = DEFAULT_CHARSET
+        SpinButton.LinkFont.Color = clBlue
+        SpinButton.LinkFont.Height = -11
+        SpinButton.LinkFont.Name = 'MS Sans Serif'
+        SpinButton.LinkFont.Style = [fsUnderline]
+        Value = 1.000000000000000000
+        OnValueChanged = NumOfAlliesSpinValueChanged
+      end
+      object PlayersPerCommSpin: TSpTBXSpinEdit
+        Left = 136
+        Top = 80
+        Width = 41
+        Height = 21
+        TabOrder = 5
+        MaxValue = 200.000000000000000000
+        MinValue = 1.000000000000000000
+        SpinButton.Left = 22
+        SpinButton.Top = 0
+        SpinButton.Width = 15
+        SpinButton.Height = 17
+        SpinButton.Align = alRight
+        SpinButton.LinkFont.Charset = DEFAULT_CHARSET
+        SpinButton.LinkFont.Color = clBlue
+        SpinButton.LinkFont.Height = -11
+        SpinButton.LinkFont.Name = 'MS Sans Serif'
+        SpinButton.LinkFont.Style = [fsUnderline]
+        Value = 1.000000000000000000
+        OnValueChanged = PlayersPerCommSpinValueChanged
+      end
     end
     object SpTBXPanel3: TSpTBXPanel
       Left = 200

Modified: Lobby/TASClient/AutoTeamsUnit.pas
===================================================================
--- Lobby/TASClient/AutoTeamsUnit.pas	2009-06-01 01:00:33 UTC (rev 7261)
+++ Lobby/TASClient/AutoTeamsUnit.pas	2009-06-05 21:03:04 UTC (rev 7262)
@@ -34,8 +34,6 @@
     SpTBXGroupBox1: TSpTBXGroupBox;
     ClansCheckBox: TSpTBXCheckBox;
     SpTBXLabel1: TSpTBXLabel;
-    NumOfAlliesButton: TTBXButton;
-    PlayersPerCommButton: TTBXButton;
     SpTBXLabel2: TSpTBXLabel;
     SpTBXPanel3: TSpTBXPanel;
     SpTBXLabel6: TSpTBXLabel;
@@ -43,6 +41,8 @@
     AutoApplyCheckBox: TSpTBXCheckBox;
     CancelButton: TSpTBXButton;
     RandomizeButton: TSpTBXSpeedButton;
+    NumOfAlliesSpin: TSpTBXSpinEdit;
+    PlayersPerCommSpin: TSpTBXSpinEdit;
 
     procedure CreateParams(var Params: TCreateParams); override;
 
@@ -55,8 +55,6 @@
     procedure ScrollBoxLabelMouseMove(Sender: TObject; Shift: TShiftState; X, Y: Integer);
 
     procedure ApplyButtonClick(Sender: TObject);
-    procedure NumOfAlliesButtonClick(Sender: TObject);
-    procedure PlayersPerCommButtonClick(Sender: TObject);
     procedure ScrollBox1MouseMove(Sender: TObject; Shift: TShiftState; X,
       Y: Integer);
     procedure ScrollBox1MouseDown(Sender: TObject; Button: TMouseButton;
@@ -69,6 +67,8 @@
     procedure FormShow(Sender: TObject);
     procedure RandomizeButtonClick(Sender: TObject);
     function GetClanTag(Client: TClient): string;
+    procedure NumOfAlliesSpinValueChanged(Sender: TObject);
+    procedure PlayersPerCommSpinValueChanged(Sender: TObject);
   private
     LastX, LastY: Integer; // last mouse x/y position on the scroll box. We need it when scrolling by dragging
     Randomizer: TRandomizer;
@@ -406,34 +406,6 @@
   Close;
 end;
 
-procedure TAutoTeamsForm.NumOfAlliesButtonClick(Sender: TObject);
-var
-  Index: Integer;
-begin
-  Index := BattleForm.ChooseNumberDialog(Sender as TControl, StrToInt(NumOfAlliesButton.Caption)-1);
-  if Index = -1 then Exit;
-
-  //Index := Max(1, Index); // at least 2 allies!
-
-  if StrToInt(NumOfAlliesButton.Caption)-1 = Index then Exit; // no change
-  NumOfAlliesButton.Caption := IntToStr(Index+1);
-
-  CreatePreview;
-end;
-
-procedure TAutoTeamsForm.PlayersPerCommButtonClick(Sender: TObject);
-var
-  Index: Integer;
-begin
-  Index := BattleForm.ChooseNumberDialog(Sender as TControl, StrToInt(PlayersPerCommButton.Caption)-1);
-  if Index = -1 then Exit;
-
-  if StrToInt(PlayersPerCommButton.Caption)-1 = Index then Exit; // no change
-  PlayersPerCommButton.Caption := IntToStr(Index+1);
-
-  CreatePreview;
-end;
-
 procedure TAutoTeamsForm.ClearPreview;
 begin
   // remove any child controls:
@@ -505,7 +477,7 @@
 
   if Clients.Count = 0 then Exit; // should not really happen
 
-  Groups := AutoSortTeams(Clients, ClansCheckBox.Checked, StrToInt(NumOfAlliesButton.Caption), StrToInt(PlayersPerCommButton.Caption));
+  Groups := AutoSortTeams(Clients, ClansCheckBox.Checked, NumOfAlliesSpin.ValueAsInteger, PlayersPerCommSpin.ValueAsInteger);
 
   YSpacing := 13;
   TeamCounter := 0;
@@ -634,6 +606,10 @@
 
   ScrollBox1.DoubleBuffered := True;
   Randomizer := TRandomizer.Create;
+  NumOfAlliesSpin.MinValue := 1;
+  NumOfAlliesSpin.MaxValue := MAX_TEAMS;
+  PlayersPerCommSpin.MinValue := 1;
+  PlayersPerCommSpin.MaxValue := MAX_TEAMS;
 end;
 
 procedure TAutoTeamsForm.ClansCheckBoxClick(Sender: TObject);
@@ -764,4 +740,14 @@
   CreatePreview;
 end;
 
+procedure TAutoTeamsForm.NumOfAlliesSpinValueChanged(Sender: TObject);
+begin
+  CreatePreview;
+end;
+
+procedure TAutoTeamsForm.PlayersPerCommSpinValueChanged(Sender: TObject);
+begin
+  CreatePreview;
+end;
+
 end.

Modified: Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/BattleFormUnit.dfm	2009-06-01 01:00:33 UTC (rev 7261)
+++ Lobby/TASClient/BattleFormUnit.dfm	2009-06-05 21:03:04 UTC (rev 7262)
@@ -1,6 +1,6 @@
 object BattleForm: TBattleForm
-  Left = 320
-  Top = 52
+  Left = 420
+  Top = 72
   Width = 945
   Height = 589
   Caption = 'Battle window'
@@ -12705,15 +12705,15 @@
           LinkFont.Style = [fsUnderline]
         end
         object MyTeamNoButton: TSpTBXSpinEdit
-          Left = 64
+          Left = 72
           Top = 16
-          Width = 49
+          Width = 41
           Height = 21
           TabOrder = 5
           OnExit = MyTeamNoButtonExit
           MaxValue = 200.000000000000000000
           MinValue = 1.000000000000000000
-          SpinButton.Left = 30
+          SpinButton.Left = 22
           SpinButton.Top = 0
           SpinButton.Width = 15
           SpinButton.Height = 17
@@ -12726,15 +12726,15 @@
           Value = 1.000000000000000000
         end
         object MyAllyNoButton: TSpTBXSpinEdit
-          Left = 64
+          Left = 72
           Top = 40
-          Width = 49
+          Width = 41
           Height = 21
           TabOrder = 6
           OnExit = MyAllyNoButtonExit
           MaxValue = 200.000000000000000000
           MinValue = 1.000000000000000000
-          SpinButton.Left = 30
+          SpinButton.Left = 22
           SpinButton.Top = 0
           SpinButton.Width = 15
           SpinButton.Height = 17
@@ -12805,33 +12805,13 @@
     OnInitPopup = PlayerControlPopupMenuInitPopup
     Left = 304
     Top = 352
-    object SetTeamItem: TSpTBXSubmenuItem
+    object ForceTeamSpin: TTBXSpinEditItem
       Caption = 'Set id'
-      OnClick = SetTeamItemClick
-      object ForceTeamToolPalette: TTBXToolPalette
-        ColCount = 4
-        Images = MainForm.NumbersImageList
-        PaletteOptions = []
-        RowCount = 4
-        OnCellClick = ForceTeamToolPaletteCellClick
-      end
-      object SpTBXItem5: TSpTBXItem
-        Caption = 'Cancel'
-      end
+      OnValueChange = ForceTeamSpinValueChange
     end
-    object SetAllyItem: TSpTBXSubmenuItem
+    object ForceAllySpin: TTBXSpinEditItem
       Caption = 'Set team'
-      OnClick = SetAllyItemClick
-      object ForceAllyToolPalette: TTBXToolPalette
-        ColCount = 4
-        Images = MainForm.NumbersImageList
-        PaletteOptions = []
-        RowCount = 4
-        OnCellClick = ForceAllyToolPaletteCellClick
-      end
-      object SpTBXItem6: TSpTBXItem
-        Caption = 'Cancel'
-      end
+      OnValueChange = ForceAllySpinValueChange
     end
     object SetTeamColorItem: TSpTBXSubmenuItem
       Caption = 'Set id color'

Modified: Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- Lobby/TASClient/BattleFormUnit.pas	2009-06-01 01:00:33 UTC (rev 7261)
+++ Lobby/TASClient/BattleFormUnit.pas	2009-06-05 21:03:04 UTC (rev 7262)
@@ -170,12 +170,6 @@
     PlayerControlPopupMenu: TSpTBXPopupMenu;
     HandicapSpinEditItem: TTBXSpinEditItem;
     KickPlayerItem: TSpTBXItem;
-    SetTeamItem: TSpTBXSubmenuItem;
-    ForceTeamToolPalette: TTBXToolPalette;
-    SpTBXItem5: TSpTBXItem;
-    SetAllyItem: TSpTBXSubmenuItem;
-    ForceAllyToolPalette: TTBXToolPalette;
-    SpTBXItem6: TSpTBXItem;
     SetTeamColorItem: TSpTBXSubmenuItem;
     ForceTeamColorPalette: TTBXColorPalette;
     SpTBXItem3: TSpTBXItem;
@@ -336,6 +330,8 @@
     MyTeamNoButton: TSpTBXSpinEdit;
     MyAllyNoButton: TSpTBXSpinEdit;
     ChooseSidePopupMenu: TSpTBXPopupMenu;
+    ForceAllySpin: TTBXSpinEditItem;
+    ForceTeamSpin: TTBXSpinEditItem;
 
     procedure CreateParams(var Params: TCreateParams); override;
 
@@ -452,8 +448,6 @@
       Button: TMouseButton; Shift: TShiftState; X, Y: Integer);
     procedure ForceTeamToolPaletteCellClick(Sender: TTBXCustomToolPalette;
       var ACol, ARow: Integer; var AllowChange: Boolean);
-    procedure SetTeamItemClick(Sender: TObject);
-    procedure SetAllyItemClick(Sender: TObject);
     procedure ForceAllyToolPaletteCellClick(Sender: TTBXCustomToolPalette;
       var ACol, ARow: Integer; var AllowChange: Boolean);
     procedure KickPlayerItemClick(Sender: TObject);
@@ -559,6 +553,10 @@
       Shift: TShiftState; X, Y: Integer);
     procedure MyTeamNoButtonExit(Sender: TObject);
     procedure MyAllyNoButtonExit(Sender: TObject);
+    procedure ForceAllySpinValueChange(Sender: TTBXCustomSpinEditItem;
+      const AValue: Extended);
+    procedure ForceTeamSpinValueChange(Sender: TTBXCustomSpinEditItem;
+      const AValue: Extended);
   private
     History: TWideStringList;
     HistoryIndex: Integer;
@@ -2484,6 +2482,16 @@
 
   FCurrentMapIndex := -1;
 
+  MyTeamNoButton.MinValue := 1;
+  MyTeamNoButton.MaxValue := MAX_TEAMS;
+  MyAllyNoButton.MinValue := 1;
+  MyAllyNoButton.MaxValue := MAX_TEAMS;
+  ForceAllySpin.MinValue := 1;
+  ForceAllySpin.MaxValue := MAX_TEAMS;
+  ForceTeamSpin.MinValue := 1;
+  ForceTeamSpin.MaxValue := MAX_TEAMS;
+  
+
   Panel1.Constraints.MinHeight := Panel1.Height;
 
   InputEdit.Align := alBottom;
@@ -4624,54 +4632,6 @@
   end;
 end;
 
-procedure TBattleForm.SetTeamItemClick(Sender: TObject);
-var
-  team: Integer;
-  RealIndex: Integer;
-  WhatToDraw: TClientNodeType;
-begin
-  if (VDTBattleClients.FocusedNode &lt;&gt; nil) then
-  begin
-    GetNodeClient(VDTBattleClients.FocusedNode.Index,RealIndex,WhatToDraw);
-    if WhatToDraw = NormalClient then
-    begin
-      team := TClient(BattleState.Battle.Clients[RealIndex]).GetTeamNo;
-      ForceTeamToolPalette.SelectedCell := Point(team mod ForceTeamToolPalette.ColCount, team div ForceTeamToolPalette.ColCount);
-    end
-    else if WhatToDraw = NormalBot then
-    begin
-      team := TBot(BattleState.Battle.Bots[RealIndex]).GetTeamNo;
-      ForceTeamToolPalette.SelectedCell := Point(team mod ForceTeamToolPalette.ColCount, team div ForceTeamToolPalette.ColCount);
-    end;
-  end
-  else
-    ForceTeamToolPalette.SelectedCell := Point(-1, -1);
-end;
-
-procedure TBattleForm.SetAllyItemClick(Sender: TObject);
-var
-  ally: Integer;
-  RealIndex: Integer;
-  WhatToDraw: TClientNodeType;
-begin
-  if (VDTBattleClients.FocusedNode &lt;&gt; nil) then
-  begin
-    GetNodeClient(VDTBattleClients.FocusedNode.Index,RealIndex,WhatToDraw);
-    if WhatToDraw = NormalClient then
-    begin
-      ally := TClient(BattleState.Battle.Clients[RealIndex]).GetAllyNo;
-      ForceAllyToolPalette.SelectedCell := Point(ally mod ForceAllyToolPalette.ColCount, ally div ForceAllyToolPalette.ColCount);
-    end
-    else if WhatToDraw = NormalBot then
-    begin
-      ally := TBot(BattleState.Battle.Bots[RealIndex]).GetAllyNo;
-      ForceAllyToolPalette.SelectedCell := Point(ally mod ForceAllyToolPalette.ColCount, ally div ForceAllyToolPalette.ColCount);
-    end;
-  end
-  else
-    ForceAllyToolPalette.SelectedCell := Point(-1, -1);
-end;
-
 procedure TBattleForm.ForceAllyToolPaletteCellClick(
   Sender: TTBXCustomToolPalette; var ACol, ARow: Integer;
   var AllowChange: Boolean);
@@ -5209,7 +5169,7 @@
     if BattleState.StartRects[i].Enabled then nb := nb +1;
   end;
   if nb &gt; 2 then
-        AutoTeamsForm.NumOfAlliesButton.Caption := IntToStr(nb);
+        AutoTeamsForm.NumOfAlliesSpin.Value := nb;
     AutoTeamsForm.CreatePreview;
     AutoTeamsForm.ApplyCurrentConfiguration;
 end;
@@ -5224,7 +5184,7 @@
     if BattleState.StartRects[i].Enabled then nb := nb +1;
   end;
   if nb &gt; 2 then
-        AutoTeamsForm.NumOfAlliesButton.Caption := IntToStr(nb);
+        AutoTeamsForm.NumOfAlliesSpin.Value := nb;
   AutoTeamsForm.ShowModal;
 end;
 
@@ -5270,13 +5230,13 @@
 begin
   GetNodeClient(VDTBattleClients.FocusedNode.Index,RealIndex,WhatToDraw);
 
-  SetTeamItem.Visible := ((WhatToDraw &lt;&gt; OriginalClient) and (BattleState.Status = Hosting) ) or ((WhatToDraw = NormalBot) and ((BattleState.Status = Hosting) or (TBot(BattleState.Battle.Bots[RealIndex]).OwnerName = Status.Username)));
-  SetAllyItem.Visible := SetTeamItem.Visible;
-  SetTeamColorItem.Visible := SetTeamItem.Visible;
-  HandicapSpinEditItem.Visible := SetTeamItem.Visible;
-  KickPlayerItem.Visible := SetTeamItem.Visible;
-  SetBotSideSubitem.Visible := (SetTeamItem.Visible) and (WhatToDraw = NormalBot);
-  ForceSpectatorModeItem.Visible := SetTeamItem.Visible;
+  ForceTeamSpin.Visible := ((WhatToDraw &lt;&gt; OriginalClient) and (BattleState.Status = Hosting) ) or ((WhatToDraw = NormalBot) and ((BattleState.Status = Hosting) or (TBot(BattleState.Battle.Bots[RealIndex]).OwnerName = Status.Username)));
+  ForceAllySpin.Visible := ForceTeamSpin.Visible;
+  SetTeamColorItem.Visible := ForceTeamSpin.Visible;
+  HandicapSpinEditItem.Visible := ForceTeamSpin.Visible;
+  KickPlayerItem.Visible := ForceTeamSpin.Visible;
+  SetBotSideSubitem.Visible := (ForceTeamSpin.Visible) and (WhatToDraw = NormalBot);
+  ForceSpectatorModeItem.Visible := ForceTeamSpin.Visible;
   RingItem.Visible := (WhatToDraw = NormalClient) and ((BattleState.Status = Hosting) or (RealIndex=0));
   SpTBXSeparatorItem5.Visible := RingItem.Visible;
 
@@ -5297,6 +5257,17 @@
     UnbanSubitem.Enabled := UnbanSubitem.Count &gt; 0;
   end;
 
+  if WhatToDraw = NormalClient then
+  begin
+    ForceAllySpin.Value := TClient(BattleState.Battle.Clients[RealIndex]).GetAllyNo+1;
+    ForceTeamSpin.Value := TClient(BattleState.Battle.Clients[RealIndex]).GetTeamNo+1;
+  end
+  else
+  begin
+    ForceAllySpin.Value := TBot(BattleState.Battle.Bots[RealIndex]).GetAllyNo+1;
+    ForceTeamSpin.Value := TBot(BattleState.Battle.Bots[RealIndex]).GetTeamNo+1;
+  end;
+
   mnuAddToGroup.Visible := WhatToDraw = NormalClient;
   mnuRemoveFromGroup.Visible := mnuAddToGroup.Visible;
   if mnuAddToGroup.Visible then
@@ -7235,4 +7206,79 @@
   SendMyBattleStatusToServer;
 end;
 
+procedure TBattleForm.ForceAllySpinValueChange(
+  Sender: TTBXCustomSpinEditItem; const AValue: Extended);
+var
+  ally: Integer;
+  i:integer;
+  RealIndex: Integer;
+  WhatToDraw: TClientNodeType;
+begin
+  if (VDTBattleClients.FocusedNode &lt;&gt; nil) then
+  begin
+    GetNodeClient(VDTBattleClients.FocusedNode.Index,RealIndex,WhatToDraw);
+    ally := Round(AValue)-1;
+
+    if WhatToDraw = NormalClient then
+    begin
+      if mnuBlockTeams.Checked then
+        TClient(BattleState.Battle.Clients[RealIndex]).SetAllyNo(ally);
+      MainForm.TryToSendCommand('FORCEALLYNO', TClient(BattleState.Battle.Clients[RealIndex]).Name + ' ' + IntToStr(ally));
+      //AddTextToChat(_('Forcing ') + TClient(BattleState.Battle.Clients[RealIndex]).Name + _('''s ally number ...'), Colors.Info, 1);
+    end
+    else if WhatToDraw = NormalBot then
+    begin
+      TBot(BattleState.Battle.Bots[RealIndex]).SetAllyNo(Round(ally));
+      MainForm.TryToSendCommand('UPDATEBOT', TBot(BattleState.Battle.Bots[RealIndex]).Name + ' ' + IntToStr(TBot(BattleState.Battle.Bots[RealIndex]).BattleStatus) + ' ' + IntToStr(TBot(BattleState.Battle.Bots[RealIndex]).TeamColor));
+    end;
+
+  end;
+end;
+
+procedure TBattleForm.ForceTeamSpinValueChange(
+  Sender: TTBXCustomSpinEditItem; const AValue: Extended);
+var
+  team: Integer;
+  i:integer;
+  RealIndex: Integer;
+  WhatToDraw: TClientNodeType;
+begin
+  if (VDTBattleClients.FocusedNode &lt;&gt; nil) then
+  begin
+    GetNodeClient(VDTBattleClients.FocusedNode.Index,RealIndex,WhatToDraw);
+    team := Round(AValue)-1;
+
+    if WhatToDraw = NormalClient then
+    begin
+      if mnuBlockTeams.Checked then
+        TClient(BattleState.Battle.Clients[RealIndex]).SetTeamNo(team);
+      MainForm.TryToSendCommand('FORCETEAMNO', TClient(BattleState.Battle.Clients[RealIndex]).Name + ' ' + IntToStr(team));
+      //AddTextToChat(_('Forcing ') + TClient(BattleState.Battle.Clients[RealIndex]).Name + _('''s team number ...'), Colors.Info, 1);
+    end
+    else if WhatToDraw = NormalBot then
+    begin
+      with TBot(BattleState.Battle.Bots[RealIndex]) do begin
+        SetTeamNo(Round(team));
+        if isComSharing then begin
+          for i := 0 to BattleState.Battle.Clients.Count-1 do begin
+            if (TClient(BattleState.Battle.Clients[i]).GetTeamNo = GetTeamNo) then begin
+              TeamColor := TClient(BattleState.Battle.Clients[i]).TeamColor;
+              break;
+            end;
+          end;
+          if i &lt; BattleState.Battle.Clients.Count then begin
+            for i := 0 to BattleState.Battle.Bots.Count-1 do begin
+              if (TBot(BattleState.Battle.Bots[i]).GetTeamNo = GetTeamNo) and (TBot(BattleState.Battle.Bots[i]).Name &lt;&gt; Name) then begin
+                TeamColor := TBot(BattleState.Battle.Bots[i]).TeamColor;
+                break;
+              end;
+            end;
+          end;
+        end;
+      end;
+      MainForm.TryToSendCommand('UPDATEBOT', TBot(BattleState.Battle.Bots[RealIndex]).Name + ' ' + IntToStr(TBot(BattleState.Battle.Bots[RealIndex]).BattleStatus) + ' ' + IntToStr(TBot(BattleState.Battle.Bots[RealIndex]).TeamColor));
+    end;
+  end;
+end;
+
 end.

Modified: Lobby/TASClient/HostBattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/HostBattleFormUnit.dfm	2009-06-01 01:00:33 UTC (rev 7261)
+++ Lobby/TASClient/HostBattleFormUnit.dfm	2009-06-05 21:03:04 UTC (rev 7262)
@@ -313,8 +313,8 @@
     end
   end
   object HostPopupMenu: TPopupMenu
-    Left = 272
-    Top = 272
+    Left = 88
+    Top = 280
     object Host1: TMenuItem
       AutoHotkeys = maAutomatic
       Caption = 'Host'
@@ -325,6 +325,7 @@
     object HostLadder1: TMenuItem
       Caption = 'Host a ladder game'
       RadioItem = True
+      Visible = False
       OnClick = HostLadder1Click
     end
     object HostReplay1: TMenuItem

Modified: Lobby/TASClient/MainUnit.dfm
===================================================================
--- Lobby/TASClient/MainUnit.dfm	2009-06-01 01:00:33 UTC (rev 7261)
+++ Lobby/TASClient/MainUnit.dfm	2009-06-05 21:03:04 UTC (rev 7262)
@@ -1,6 +1,6 @@
 object MainForm: TMainForm
-  Left = 212
-  Top = 76
+  Left = 339
+  Top = 139
   Width = 850
   Height = 538
   Caption = '.'

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2009-06-01 01:00:33 UTC (rev 7261)
+++ Lobby/TASClient/TASClient.dof	2009-06-05 21:03:04 UTC (rev 7262)
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=47
 Release=0
-Build=601
+Build=602
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=Spring RTS Engine lobby client
-FileVersion=0.47.0.601
+FileVersion=0.47.0.602
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002030.html">[Taspring-linux-commit] r7261 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="002032.html">[Taspring-linux-commit] r7263 - Lobby/TASServer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2031">[ date ]</a>
              <a href="thread.html#2031">[ thread ]</a>
              <a href="subject.html#2031">[ subject ]</a>
              <a href="author.html#2031">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
