<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7130 - in	branches/caiinterface/AI/Skirmish: . AAI AAI/data	AAI/data/cfg/mod NTai/AI/NTai/Core NTai/data
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-December/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7130%20-%20in%0A%09branches/caiinterface/AI/Skirmish%3A%20.%20AAI%20AAI/data%0A%09AAI/data/cfg/mod%20NTai/AI/NTai/Core%20NTai/data&In-Reply-To=%3C20081205195734.1BAAF476B%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001898.html">
   <LINK REL="Next"  HREF="001900.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7130 - in	branches/caiinterface/AI/Skirmish: . AAI AAI/data	AAI/data/cfg/mod NTai/AI/NTai/Core NTai/data</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7130%20-%20in%0A%09branches/caiinterface/AI/Skirmish%3A%20.%20AAI%20AAI/data%0A%09AAI/data/cfg/mod%20NTai/AI/NTai/Core%20NTai/data&In-Reply-To=%3C20081205195734.1BAAF476B%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r7130 - in	branches/caiinterface/AI/Skirmish: . AAI AAI/data	AAI/data/cfg/mod NTai/AI/NTai/Core NTai/data">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Fri Dec  5 20:57:33 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001898.html">[Taspring-linux-commit] r7129 - in branches/caiinterface: . AI/Interfaces AI/Interfaces/C AI/Interfaces/C/data AI/Interfaces/Java AI/Interfaces/Java/bin AI/Interfaces/Java/data AI/Interfaces/Java/java AI/Interfaces/Java/java/src AI/Interfaces/Java/java/src/com AI/Interfaces/Java/java/src/com/clan_sy AI/Interfaces/Java/java/src/com/clan_sy/spring AI/Interfaces/Java/java/src/com/clan_sy/spring/ai AI/Interfaces/Java/jlib AI/Interfaces/Java/jlib/jna AI/Skirmish AI/Skirmish/AAI AI/Skirmish/AAI/data AI/Skirmish/AAI/data/cache AI/Skirmish/AAI/data/cfg AI/Skirmish/AAI/data/learn AI/Skirmish/AAI/data/log AI/Skirmish/CSAI AI/Skirmish/JCAI AI/Skirmish/KAI AI/Skirmish/KAIK AI/Skirmish/KAIK/data AI/Skirmish/NTai AI/Skirmish/NullAI AI/Skirmish/NullAI/data AI/Skirmish/NullJavaAI AI/Skirmish/NullJavaAI/data AI/Skirmish/NullJavaAI/nulljavaai AI/Skirmish/NullLegacyCppAI AI/Skirmish/NullLegacyCppAI/data AI/Skirmish/NullOOJavaAI AI/Skirmish/NullOOJavaAI/data AI/Skirmish/NullOOJavaAI/nulloojavaai AI/Skirmish/RA I AI/Skirmish/RAI/data game/AI rts/build/scons
</A></li>
        <LI>Next message: <A HREF="001900.html">[Taspring-linux-commit] r7131 - in branches/caiinterface:	game/LuaUI rts/Game rts/Game/UI rts/Lua rts/Map/SM3/terrain	rts/Map/SMF rts/Rendering rts/Rendering/Env rts/Rendering/GL	rts/Rendering/UnitModels rts/Sim/Misc rts/Sim/Path	rts/Sim/Projectiles rts/Sim/Projectiles/Unsynced	rts/Sim/Units rts/System rts/System/Net	rts/System/Platform/Linux rts/System/Platform/Win	rts/build/scons rts/lib/gml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1899">[ date ]</a>
              <a href="thread.html#1899">[ thread ]</a>
              <a href="subject.html#1899">[ subject ]</a>
              <a href="author.html#1899">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-12-05 20:57:33 +0100 (Fri, 05 Dec 2008)
New Revision: 7130

Added:
   branches/caiinterface/AI/Skirmish/AAI/AIExport.cpp
   branches/caiinterface/AI/Skirmish/AAI/AIExport.h
   branches/caiinterface/AI/Skirmish/AAI/VERSION
   branches/caiinterface/AI/Skirmish/AAI/data/AIInfo.lua
   branches/caiinterface/AI/Skirmish/AAI/data/AIOptions.lua
   branches/caiinterface/AI/Skirmish/AAI/data/cfg/mod/BA65.cfg
   branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.cpp
   branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.h
   branches/caiinterface/AI/Skirmish/NTai/data/AIInfo.lua
   branches/caiinterface/AI/Skirmish/NTai/data/AIOptions.lua
Modified:
   branches/caiinterface/AI/Skirmish/AAI/aidef.h
   branches/caiinterface/AI/Skirmish/CMakeLists.txt
Log:
* AAI and NTai run over the C AI interface aswell now

Added: branches/caiinterface/AI/Skirmish/AAI/AIExport.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/AIExport.cpp	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/AAI/AIExport.cpp	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1,99 @@
+/*
+	Copyright 2008  Nicolas Wu
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+*/
+
+#include &quot;AIExport.h&quot;
+
+#include &lt;map&gt;
+
+// AI interface stuff
+#include &quot;ExternalAI/Interface/SSAILibrary.h&quot;
+#include &quot;LegacyCpp/AI.h&quot;
+#include &quot;LegacyCpp/AIGlobalAI.h&quot;
+#include &quot;Game/GameVersion.h&quot;
+
+// AAI stuff
+#include &quot;AAI.h&quot;
+
+
+std::map&lt;int, CAIGlobalAI*&gt; myAIs; // teamId -&gt; AI map
+
+
+EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
+		const char* engineVersionString, int engineVersionNumber,
+		const char* aiInterfaceShortName, const char* aiInterfaceVersion) {
+
+	if (strcmp(engineVersionString, SpringVersion::GetFull().c_str()) == 0 &amp;&amp;
+			engineVersionNumber &lt;= ENGINE_VERSION_NUMBER) {
+		return LOS_Working;
+	}
+
+	return LOS_None;
+}
+
+EXPORT(int) init(int teamId,
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues) {
+
+	if (myAIs.count(teamId) &gt; 0) {
+		// the map already has an AI for this team.
+		// raise an error, since it's probably a mistake if we're trying
+		// to reinitialise a team that already had init() called on it.
+		return -1;
+	}
+
+	// CAIGlobalAI is the Legacy C++ wrapper
+	myAIs[teamId] = new CAIGlobalAI(teamId, new AAI());
+
+	// signal: everything went ok
+	return 0;
+}
+
+EXPORT(int) release(int teamId) {
+
+	if (myAIs.count(teamId) == 0) {
+		// the map has no AI for this team.
+		// raise an error, since it's probably a mistake if we're trying to
+		// release a team that's not initialized.
+		return -1;
+	}
+
+	delete myAIs[teamId];
+	myAIs.erase(teamId);
+
+	// signal: everything went ok
+	return 0;
+}
+
+EXPORT(int) handleEvent(int teamId, int topic, const void* data) {
+
+	if (teamId &lt; 0) {
+		// events sent to team -1 will always be to the AI object itself,
+		// not to a particular team.
+	} else if (myAIs.count(teamId) &gt; 0) {
+		// allow the AI instance to handle the event.
+		return myAIs[teamId]-&gt;handleEvent(topic, data);
+	}
+
+	// no AI for that team, so return error.
+	return -1;
+}
+


Property changes on: branches/caiinterface/AI/Skirmish/AAI/AIExport.cpp
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/AAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/AIExport.h	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/AAI/AIExport.h	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1,53 @@
+/*
+	Copyright 2008  Nicolas Wu
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+*/
+
+#ifndef _AIEXPORT_H
+#define _AIEXPORT_H
+
+// check if build system uses correct defines
+#if	!defined BUILDING_AI
+	#error BUILDING_AI should be defined when building AIs
+#endif
+#if	defined BUILDING_AI_INTERFACE
+	#error BUILDING_AI_INTERFACE should not be defined when building AIs
+#endif
+
+#include &quot;ExternalAI/Interface/aidefines.h&quot;
+#include &quot;ExternalAI/Interface/ELevelOfSupport.h&quot;
+
+// for a list of the functions that have to be exported,
+// see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
+
+// static AI library methods (optional to implement)
+EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
+		const char* engineVersionString, int engineVersionNumber,
+		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
+
+// team instance functions
+EXPORT(int) init(int teamId,
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues);
+EXPORT(int) release(int teamId);
+EXPORT(int) handleEvent(int teamId, int topic, const void* data);
+
+#endif // _AIEXPORT_H
+


Property changes on: branches/caiinterface/AI/Skirmish/AAI/AIExport.h
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/AAI/VERSION
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/VERSION	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/AAI/VERSION	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1 @@
+0.875


Property changes on: branches/caiinterface/AI/Skirmish/AAI/VERSION
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/AI/Skirmish/AAI/aidef.h
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/aidef.h	2008-12-05 16:12:49 UTC (rev 7129)
+++ branches/caiinterface/AI/Skirmish/AAI/aidef.h	2008-12-05 19:57:33 UTC (rev 7130)
@@ -44,7 +44,7 @@
 #define CONTINENT_DATA_VERSION &quot;MOVEMENT_MAPS_0_87&quot;
 
 // all paths
-#define MAIN_PATH &quot;AI/AAI/&quot;
+#define MAIN_PATH &quot;AI/Skirmish/AAI/&quot;AAI_VERSION&quot;/&quot;
 #define AILOG_PATH &quot;log/&quot;
 #define MOD_CFG_PATH &quot;cfg/mod/&quot;
 #define GENERAL_CFG_FILE &quot;cfg/general.cfg&quot;

Added: branches/caiinterface/AI/Skirmish/AAI/data/AIInfo.lua
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/data/AIInfo.lua	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/AAI/data/AIInfo.lua	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1,64 @@
+--
+--  Info Definition Table format
+--
+--
+--  These keywords must be lowercase for LuaParser to read them.
+--
+--  key:      user defined or one of the SKIRMISH_AI_PROPERTY_* defines in
+--            SSAILibrary.h
+--  value:    the value of the property
+--  desc:     the description (could be used as a tooltip)
+--
+--
+--------------------------------------------------------------------------------
+--------------------------------------------------------------------------------
+
+local infos = {
+	{
+		key    = 'fileName',
+		value  = 'AAI-0.875',
+		desc   = 'base of the library file of this AI. &quot;RAI-0.553&quot; means &quot;AI/Skirmish/lib/libRAI-0.553.so&quot;, &quot;AI/Skirmish/lib/libRAI-0.553.dylib&quot; or &quot;AI/Skirmish/lib/RAI-0.553.dll&quot;',
+	},
+	{
+		key    = 'shortName',
+		value  = 'AAI',
+		desc   = 'machine conform name.',
+	},
+	{
+		key    = 'version',
+		value  = '0.875',
+	},
+	{
+		key    = 'name',
+		value  = 'submarines Skirmish AI (AAI)',
+		desc   = 'human readable name.',
+	},
+	{
+		key    = 'description',
+		value  = 'Supports most TA based Mods plus a few others. Uses config files.',
+		desc   = 'tooltip.',
+	},
+	{
+		key    = 'url',
+		value  = '<A HREF="http://spring.clan-sy.com/wiki/AI:AAI">http://spring.clan-sy.com/wiki/AI:AAI</A>',
+		desc   = 'URL with more detailed info about the AI',
+	},
+	{
+		key    = 'loadSupported',
+		value  = 'no',
+		desc   = 'whether this AI supports loading or not',
+	},
+	{
+		key    = 'interfaceShortName',
+		value  = 'C',
+		desc   = 'the shortName of the AI interface this AI needs',
+	},
+	{
+		key    = 'interfaceVersion',
+		value  = '0.1',
+		desc   = 'the minimum version of the AI interface this AI needs',
+	},
+}
+
+return infos
+


Property changes on: branches/caiinterface/AI/Skirmish/AAI/data/AIInfo.lua
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/AAI/data/AIOptions.lua
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/data/AIOptions.lua	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/AAI/data/AIOptions.lua	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1,38 @@
+--
+--  Custom Options Definition Table format
+--
+--  NOTES:
+--  - using an enumerated table lets you specify the options order
+--
+--  These keywords must be lowercase for LuaParser to read them.
+--
+--  key:      the string used in the script.txt
+--  name:     the displayed name
+--  desc:     the description (could be used as a tooltip)
+--  type:     the option type
+--  def:      the default value;
+--  min:      minimum value for number options
+--  max:      maximum value for number options
+--  step:     quantization step, aligned to the def value
+--  maxlen:   the maximum string length for string options
+--  items:    array of item strings for list options
+--  scope:    'all', 'player', 'team', 'allyteam'      &lt;&lt;&lt; not supported yet &gt;&gt;&gt;
+--
+--------------------------------------------------------------------------------
+--------------------------------------------------------------------------------
+
+local options = {
+	{
+		key=&quot;difficulty&quot;,
+		name=&quot;AI Difficulty Level&quot;,
+		desc=&quot;1 means, the AI plays very poor, 5 means, it gives its best&quot;,
+		type   = 'number',
+		def    = 3,
+		min    = 1,
+		max    = 5,
+		step   = 1,
+	},
+}
+
+return options
+


Property changes on: branches/caiinterface/AI/Skirmish/AAI/data/AIOptions.lua
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/AAI/data/cfg/mod/BA65.cfg
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/data/cfg/mod/BA65.cfg	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/AAI/data/cfg/mod/BA65.cfg	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1,37 @@
+SIDES 2
+START_UNITS ARMCOM CORCOM
+SIDE_NAMES Arm Core
+MAX_SCOUTS 6
+MAX_BUILDERS 50
+MAX_BUILDERS_PER_TYPE 5
+MAX_FACTORIES_PER_TYPE 3
+MAX_GROUP_SIZE 12
+MAX_AIR_GROUP_SIZE 4
+MAX_XROW 8
+MAX_YROW 8
+X_SPACE 16
+Y_SPACE 16
+MAX_BASE_SIZE 12
+
+HIGH_RANGE_UNITS_RATE 4
+AIRCRAFT_RATE 4 
+
+SCOUT_SPEED 120.0
+SEA_ARTY_RANGE 1300.0
+STATIONARY_ARTY_RANGE 3210.0
+MAX_STAT_ARTY 3
+
+MIN_ENERGY 18 
+
+MAX_METAL_COST 8000
+MAX_DEFENCES 14
+METAL_ENERGY_RATIO 25
+MAX_METAL_MAKERS 15
+MAX_MEX_DISTANCE 8
+MAX_MEX_DEFENCE_DISTANCE 7
+
+NON_AMPHIB_MAX_WATERDEPTH 22
+
+SCOUTS 14 CORFAV ARMFAV ARMPEEP CORFINK ARMAWAC CORAWAC ARMFLEA ARMFAST ARMSH CORSH CORPT ARMPT ARMSPY CORSPY
+DONT_BUILD 12 aafus cafus armmlv cormlv armfmine3 armmine1 armmine2 armmine3 corfmine3 cormine1 cormine2 cormine3
+TRANSPORTERS 8 corthovr armthovr corvalk armatlas armsl armdfly cortship armtship
\ No newline at end of file


Property changes on: branches/caiinterface/AI/Skirmish/AAI/data/cfg/mod/BA65.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/AI/Skirmish/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-12-05 16:12:49 UTC (rev 7129)
+++ branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-12-05 19:57:33 UTC (rev 7130)
@@ -81,13 +81,13 @@
 	set(AAI_DATA_DIR ${SKIRMISH_DATA}/AAI/${AAI_VERS})
 	message(STATUS &quot;${AAI_VERS}\t(AAI Version)&quot;)
 
+	# install data files
+	install(DIRECTORY &quot;${AAI_SRC}/data/&quot;
+			DESTINATION &quot;${AAI_DATA_DIR}&quot; PATTERN &quot;.svn&quot; EXCLUDE)
+
 	aux_source_directory(${AAI_SRC} aai)
-	#add_library(${AAI_TARGET} MODULE ${aai} ${legacycppaienv})
-	#install (FILES ${AAI_SRC}/AIInfo.lua DESTINATION ${AAI_DATA_DIR})
-	#if (EXISTS ${AAI_SRC}/AIOptions.lua)
-	#	install (FILES ${AAI_SRC}/AIOptions.lua DESTINATION ${AAI_DATA_DIR})
-	#endif (EXISTS ${AAI_SRC}/AIOptions.lua)
-	#install (TARGETS ${AAI_TARGET} DESTINATION ${AAI_DATA_DIR})
+	add_library(${AAI_TARGET} MODULE ${aai} ${legacycppaienv})
+	install (TARGETS ${AAI_TARGET} DESTINATION ${AAI_DATA_DIR})
 endif (EXISTS ${AAI_SRC})
 
 
@@ -103,8 +103,8 @@
 	message(STATUS &quot;${NTai_VERS}\t(NTai Version)&quot;)
 
 	# install data files
-	#install(DIRECTORY &quot;${NTai_SRC}/data/&quot;
-	#		DESTINATION &quot;${NTai_DATA_DIR}&quot; PATTERN &quot;.svn&quot; EXCLUDE)
+	install(DIRECTORY &quot;${NTai_SRC}/data/&quot;
+			DESTINATION &quot;${NTai_DATA_DIR}&quot; PATTERN &quot;.svn&quot; EXCLUDE)
 
 	aux_source_directory(${NTai_SRC} ntai)
 	aux_source_directory(${NTai_SRC}/AI/NTai/Units ntai)
@@ -117,9 +117,9 @@
 	aux_source_directory(${NTai_SRC}/AI/NTai/Engine ntai)
 	aux_source_directory(${NTai_SRC}/AI/NTai/Core ntai)
 	aux_source_directory(${NTai_SRC}/AI/NTai/Agents ntai)
-	#add_library(${NTai_TARGET} MODULE ${ntai} ${legacycppaienv})
-	#target_link_libraries(${NTai_TARGET} boost_thread-mt)
-	#install (TARGETS ${NTai_TARGET} DESTINATION ${NTai_DATA_DIR})
+	add_library(${NTai_TARGET} MODULE ${ntai} ${legacycppaienv})
+	target_link_libraries(${NTai_TARGET} boost_thread-mt)
+	install (TARGETS ${NTai_TARGET} DESTINATION ${NTai_DATA_DIR})
 endif (EXISTS ${NTai_SRC})
 
 

Added: branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.cpp	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.cpp	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1,99 @@
+/*
+	Copyright 2008  Nicolas Wu
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+*/
+
+#include &quot;AIExport.h&quot;
+
+#include &lt;map&gt;
+
+// AI interface stuff
+#include &quot;ExternalAI/Interface/SSAILibrary.h&quot;
+#include &quot;LegacyCpp/AI.h&quot;
+#include &quot;LegacyCpp/AIGlobalAI.h&quot;
+#include &quot;Game/GameVersion.h&quot;
+
+// NTai stuff
+#include &quot;CNTai.h&quot;
+
+
+std::map&lt;int, CAIGlobalAI*&gt; myAIs; // teamId -&gt; AI map
+
+
+EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
+		const char* engineVersionString, int engineVersionNumber,
+		const char* aiInterfaceShortName, const char* aiInterfaceVersion) {
+
+	if (strcmp(engineVersionString, SpringVersion::GetFull().c_str()) == 0 &amp;&amp;
+			engineVersionNumber &lt;= ENGINE_VERSION_NUMBER) {
+		return LOS_Working;
+	}
+
+	return LOS_None;
+}
+
+EXPORT(int) init(int teamId,
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues) {
+
+	if (myAIs.count(teamId) &gt; 0) {
+		// the map already has an AI for this team.
+		// raise an error, since it's probably a mistake if we're trying
+		// to reinitialise a team that already had init() called on it.
+		return -1;
+	}
+
+	// CAIGlobalAI is the Legacy C++ wrapper, CGlobalAI is KAIK
+	myAIs[teamId] = new CAIGlobalAI(teamId, new ntai::CNTai());
+
+	// signal: everything went ok
+	return 0;
+}
+
+EXPORT(int) release(int teamId) {
+
+	if (myAIs.count(teamId) == 0) {
+		// the map has no AI for this team.
+		// raise an error, since it's probably a mistake if we're trying to
+		// release a team that's not initialized.
+		return -1;
+	}
+
+	delete myAIs[teamId];
+	myAIs.erase(teamId);
+
+	// signal: everything went ok
+	return 0;
+}
+
+EXPORT(int) handleEvent(int teamId, int topic, const void* data) {
+
+	if (teamId &lt; 0) {
+		// events sent to team -1 will always be to the AI object itself,
+		// not to a particular team.
+	} else if (myAIs.count(teamId) &gt; 0) {
+		// allow the AI instance to handle the event.
+		return myAIs[teamId]-&gt;handleEvent(topic, data);
+	}
+
+	// no AI for that team, so return error.
+	return -1;
+}
+


Property changes on: branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.cpp
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.h	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.h	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1,53 @@
+/*
+	Copyright 2008  Nicolas Wu
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+*/
+
+#ifndef _AIEXPORT_H
+#define _AIEXPORT_H
+
+// check if build system uses correct defines
+#if	!defined BUILDING_AI
+	#error BUILDING_AI should be defined when building AIs
+#endif
+#if	defined BUILDING_AI_INTERFACE
+	#error BUILDING_AI_INTERFACE should not be defined when building AIs
+#endif
+
+#include &quot;ExternalAI/Interface/aidefines.h&quot;
+#include &quot;ExternalAI/Interface/ELevelOfSupport.h&quot;
+
+// for a list of the functions that have to be exported,
+// see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
+
+// static AI library methods (optional to implement)
+EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
+		const char* engineVersionString, int engineVersionNumber,
+		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
+
+// team instance functions
+EXPORT(int) init(int teamId,
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues);
+EXPORT(int) release(int teamId);
+EXPORT(int) handleEvent(int teamId, int topic, const void* data);
+
+#endif // _AIEXPORT_H
+


Property changes on: branches/caiinterface/AI/Skirmish/NTai/AI/NTai/Core/AIExport.h
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/NTai/data/AIInfo.lua
===================================================================
--- branches/caiinterface/AI/Skirmish/NTai/data/AIInfo.lua	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/NTai/data/AIInfo.lua	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1,64 @@
+--
+--  Info Definition Table format
+--
+--
+--  These keywords must be lowercase for LuaParser to read them.
+--
+--  key:      user defined or one of the SKIRMISH_AI_PROPERTY_* defines in
+--            SSAILibrary.h
+--  value:    the value of the property
+--  desc:     the description (could be used as a tooltip)
+--
+--
+--------------------------------------------------------------------------------
+--------------------------------------------------------------------------------
+
+local infos = {
+	{
+		key    = 'fileName',
+		value  = 'NTai-UNKNOWN_VERSION',
+		desc   = 'base of the library file of this AI. &quot;RAI-0.553&quot; means &quot;AI/Skirmish/lib/libRAI-0.553.so&quot;, &quot;AI/Skirmish/lib/libRAI-0.553.dylib&quot; or &quot;AI/Skirmish/lib/RAI-0.553.dll&quot;',
+	},
+	{
+		key    = 'shortName',
+		value  = 'NTai',
+		desc   = 'machine conform name.',
+	},
+	{
+		key    = 'version',
+		value  = 'UNKNOWN_VERSION',
+	},
+	{
+		key    = 'name',
+		value  = 'AFs Skirmish AI (NTai). Uses config files.',
+		desc   = 'human readable name.',
+	},
+	{
+		key    = 'description',
+		value  = 'Competetive AI that supports most TA based Mods and plays decently.',
+		desc   = 'tooltip.',
+	},
+	{
+		key    = 'url',
+		value  = '<A HREF="http://spring.clan-sy.com/wiki/AI:NTai">http://spring.clan-sy.com/wiki/AI:NTai</A>',
+		desc   = 'URL with more detailed info about the AI',
+	},
+	{
+		key    = 'loadSupported',
+		value  = 'no',
+		desc   = 'whether this AI supports loading or not',
+	},
+	{
+		key    = 'interfaceShortName',
+		value  = 'C',
+		desc   = 'the shortName of the AI interface this AI needs',
+	},
+	{
+		key    = 'interfaceVersion',
+		value  = '0.1',
+		desc   = 'the minimum version of the AI interface this AI needs',
+	},
+}
+
+return infos
+


Property changes on: branches/caiinterface/AI/Skirmish/NTai/data/AIInfo.lua
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/NTai/data/AIOptions.lua
===================================================================
--- branches/caiinterface/AI/Skirmish/NTai/data/AIOptions.lua	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/NTai/data/AIOptions.lua	2008-12-05 19:57:33 UTC (rev 7130)
@@ -0,0 +1,37 @@
+--
+--  Custom Options Definition Table format
+--
+--  NOTES:
+--  - using an enumerated table lets you specify the options order
+--
+--  These keywords must be lowercase for LuaParser to read them.
+--
+--  key:      the string used in the script.txt
+--  name:     the displayed name
+--  desc:     the description (could be used as a tooltip)
+--  type:     the option type
+--  def:      the default value;
+--  min:      minimum value for number options
+--  max:      maximum value for number options
+--  step:     quantization step, aligned to the def value
+--  maxlen:   the maximum string length for string options
+--  items:    array of item strings for list options
+--  scope:    'all', 'player', 'team', 'allyteam'      &lt;&lt;&lt; not supported yet &gt;&gt;&gt;
+--
+--------------------------------------------------------------------------------
+--------------------------------------------------------------------------------
+
+local options = {
+	{
+		key=&quot;difficulty&quot;,
+		name=&quot;AI Difficulty Level&quot;,
+		desc=&quot;1 means, the AI plays very poor, 5 means, it gives its best&quot;,
+		type   = 'number',
+		def    = 3,
+		min    = 1,
+		max    = 5,
+		step   = 1,
+	},
+}
+
+return options


Property changes on: branches/caiinterface/AI/Skirmish/NTai/data/AIOptions.lua
___________________________________________________________________
Name: svn:eol-style
   + native


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001898.html">[Taspring-linux-commit] r7129 - in branches/caiinterface: . AI/Interfaces AI/Interfaces/C AI/Interfaces/C/data AI/Interfaces/Java AI/Interfaces/Java/bin AI/Interfaces/Java/data AI/Interfaces/Java/java AI/Interfaces/Java/java/src AI/Interfaces/Java/java/src/com AI/Interfaces/Java/java/src/com/clan_sy AI/Interfaces/Java/java/src/com/clan_sy/spring AI/Interfaces/Java/java/src/com/clan_sy/spring/ai AI/Interfaces/Java/jlib AI/Interfaces/Java/jlib/jna AI/Skirmish AI/Skirmish/AAI AI/Skirmish/AAI/data AI/Skirmish/AAI/data/cache AI/Skirmish/AAI/data/cfg AI/Skirmish/AAI/data/learn AI/Skirmish/AAI/data/log AI/Skirmish/CSAI AI/Skirmish/JCAI AI/Skirmish/KAI AI/Skirmish/KAIK AI/Skirmish/KAIK/data AI/Skirmish/NTai AI/Skirmish/NullAI AI/Skirmish/NullAI/data AI/Skirmish/NullJavaAI AI/Skirmish/NullJavaAI/data AI/Skirmish/NullJavaAI/nulljavaai AI/Skirmish/NullLegacyCppAI AI/Skirmish/NullLegacyCppAI/data AI/Skirmish/NullOOJavaAI AI/Skirmish/NullOOJavaAI/data AI/Skirmish/NullOOJavaAI/nulloojavaai AI/Skirmish/RA I AI/Skirmish/RAI/data game/AI rts/build/scons
</A></li>
	<LI>Next message: <A HREF="001900.html">[Taspring-linux-commit] r7131 - in branches/caiinterface:	game/LuaUI rts/Game rts/Game/UI rts/Lua rts/Map/SM3/terrain	rts/Map/SMF rts/Rendering rts/Rendering/Env rts/Rendering/GL	rts/Rendering/UnitModels rts/Sim/Misc rts/Sim/Path	rts/Sim/Projectiles rts/Sim/Projectiles/Unsynced	rts/Sim/Units rts/System rts/System/Net	rts/System/Platform/Linux rts/System/Platform/Win	rts/build/scons rts/lib/gml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1899">[ date ]</a>
              <a href="thread.html#1899">[ thread ]</a>
              <a href="subject.html#1899">[ subject ]</a>
              <a href="author.html#1899">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
