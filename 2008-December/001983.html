<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7214 - in branches/caiinterface: . AI	rts/build/scons
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-December/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7214%20-%20in%20branches/caiinterface%3A%20.%20AI%0A%09rts/build/scons&In-Reply-To=%3C20081223162227.1B75F47CC%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001982.html">
   <LINK REL="Next"  HREF="001984.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7214 - in branches/caiinterface: . AI	rts/build/scons</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7214%20-%20in%20branches/caiinterface%3A%20.%20AI%0A%09rts/build/scons&In-Reply-To=%3C20081223162227.1B75F47CC%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r7214 - in branches/caiinterface: . AI	rts/build/scons">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Tue Dec 23 17:22:26 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001982.html">[Taspring-linux-commit] r7213 -	trunk/installer/builddata/maphelper/maphelper
</A></li>
        <LI>Next message: <A HREF="001984.html">[Taspring-linux-commit] r7215 - in Lobby/TASClient: . Python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1983">[ date ]</a>
              <a href="thread.html#1983">[ thread ]</a>
              <a href="subject.html#1983">[ subject ]</a>
              <a href="author.html#1983">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-12-23 17:22:26 +0100 (Tue, 23 Dec 2008)
New Revision: 7214

Added:
   branches/caiinterface/AI/SConscript
Modified:
   branches/caiinterface/SConstruct
   branches/caiinterface/rts/build/scons/config.py
   branches/caiinterface/rts/build/scons/filelist.py
   branches/caiinterface/rts/build/scons/rts.py
Log:
experimental: extracted AI part out of SConstruct into Sconscript

Added: branches/caiinterface/AI/SConscript
===================================================================
--- branches/caiinterface/AI/SConscript	                        (rev 0)
+++ branches/caiinterface/AI/SConscript	2008-12-23 16:22:26 UTC (rev 7214)
@@ -0,0 +1,347 @@
+# Copyright (C) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+
+# use ../SConstruct to build spring.
+# even if you want to build only subparts of it,
+# that are possibly defined in this file.
+
+&quot;&quot;&quot; Available targets.
+Each target has an equivalent install target. E.g. `NullAI' has
+`install-NullAI' and the default target has `install'.
+
+[default]
+AIInterfaces
+	C
+	Java
+SkirmishAI
+	RAI
+	NTAI
+	KAI
+	KAIK
+	AAI
+	JCAI
+	NullAI
+	NullLegacyCppAI
+	NullJavaAI
+	NullOOJavaAI
+&quot;&quot;&quot;
+
+
+Import(['env'])
+
+import os, sys
+sys.path.append('rts/build/scons')
+import filelist
+
+# the next four lines are needed when compiling on windows
+# (seems to be a SCons bug)
+import SCons.Tool.javac
+import SCons.Tool.jar
+SCons.Tool.javac.generate(env)
+SCons.Tool.jar.generate(env)
+
+
+################################################################################
+### AIs
+################################################################################
+# Make a copy of the build environment for the AIs, but remove libraries and add include path.
+# TODO: make separate SConstructs for AIs
+#aienv = env.Clone()
+aienv = env.Clone(builddir=os.path.join(env['builddir'], 'AI'))
+#aienv['LIBS'] = []
+aienv.AppendUnique(CPPPATH = ['#rts/ExternalAI'])
+aienv.AppendUnique(LINKFLAGS = ['-Wl,--kill-at', '--add-stdcall-alias', '-mno-cygwin', '-lstdc++'])
+#print aienv['CPPDEFINES']
+
+for d in filelist.list_directories(aienv, '../rts', exclude_list=[&quot;crashrpt&quot;]):
+	aienv.BuildDir(os.path.join(aienv['builddir'], 'Interfaces', d), d)
+	#print &quot;d pj: %s&quot; % os.path.join(aienv['builddir'], 'Interfaces', d)
+	#print &quot;d: %s&quot; % d
+#aienv.BuildDir(os.path.join(aienv['builddir'], 'tools/unitsync'), 'tools/unitsync')
+
+aiinterfaceenv = aienv.Clone()
+aiinterfaceenv.AppendUnique(CPPDEFINES = ['BUILDING_AI_INTERFACE'])
+
+aienv.AppendUnique(CPPDEFINES = ['BUILDING_AI'])
+
+skirmishaienv = aienv.Clone()
+
+#groupaienv = aienv.Clone()
+
+# stores shared objects so newer scons versions don't choke with
+def create_shared_objects(env, fileList, suffix, additionalCPPDEFINES = []):
+	objsList = []
+	myEnv = env.Clone()
+	myEnv.AppendUnique(CPPDEFINES = additionalCPPDEFINES)
+	for f in fileList:
+		while isinstance(f, list):
+			f = f[0]
+		fpath, fbase = os.path.split(f)
+#		print &quot;file: %s&quot; % f
+#		print &quot;base: %s&quot; % fbase
+		fname, fext = fbase.rsplit('.', 1)
+		objsList.append(myEnv.SharedObject(os.path.join(fpath, fname + suffix), f))
+	return objsList
+
+
+# retrieves the version of a Skirmish AI from the following file
+# {spring_source}/AI/Skirmish/{ai-name}/VERSION
+def fetch_ai_version(aiName, subDir = 'Skirmish'):
+	version = 'VERSION_UNKNOWN'
+	versionFile = os.path.join(subDir, aiName, 'VERSION')
+	if os.path.exists(versionFile):
+		file = open(versionFile, 'r')
+		version = file.readline().strip()
+		file.close()
+	return version
+
+
+# appends the version to the end of the AI Interface name
+def construct_aiinterface_libName(interfaceName):
+	libName = interfaceName + '-' + fetch_ai_version(interfaceName, 'Interfaces')
+	return libName
+
+
+def getLocalShellExecPostfix():
+	if sys.platform == 'win32' or sys.platform == 'win64':
+		postfix = 'bat'
+	else:
+		postfix = 'sh'
+	return postfix
+
+
+def createJavaClasspath(path, pathPrefix = ''):
+	# helper function to get a list of all subdirectories
+	def addJars(jarList, dirname, names):
+		# internal function to pass to os.path.walk
+		for n in names:
+			f = os.path.join(dirname, n)
+			if os.path.isfile(f) and os.path.splitext(f)[1] == &quot;.jar&quot;:
+				jarList.append(os.path.join(pathPrefix, f))
+
+	jarList = []
+	os.path.walk(path, addJars, jarList)
+	clsPath = path
+	for j in jarList:
+		clsPath = clsPath + os.pathsep + j
+	return clsPath
+
+# installs files plus empty directories recursively, preserving directory structure
+def installDataDir(env, dstPath, srcPath, instList):
+	if os.path.exists(srcPath):
+		files = filelist.list_files_recursive(env, srcPath, exclude_regexp = '\.svn', exclude_dirs = False, path_relative = True)
+		for f in files:
+			f_src_file = os.path.join(srcPath, f)
+			f_dst_path = os.path.join(dstPath, os.path.split(f)[0])
+			f_dst_file = os.path.join(dstPath, f)
+
+			#print &quot;&quot;
+			#print &quot;f_dst_file: %s&quot; % f_dst_file
+			#print &quot;f_dst_path: %s&quot; % f_dst_path
+			#print &quot;f_dst_file: %s&quot; % f_dst_file
+			#print &quot;#build/f_src_file: %s&quot; % os.path.join(env['builddir'], f_src_file)
+
+			#print(&quot;f_dst_file, isdir exists: %i %i&quot;, os.path.isdir(f_src_file), os.path.exists(f_dst_file))
+			#print(&quot;#build/f_dst_file, isdir exists: %i %i&quot;, os.path.isdir(os.path.join(env['builddir'], f_src_file)), os.path.exists(os.path.join(env['builddir'], f_dst_file)))
+			if not (os.path.isdir(f_src_file) and (os.path.exists(f_dst_file) or len(os.listdir(f_src_file)) != 0)):
+			#if not (os.path.isdir(f_src_file) and os.path.exists(f_dst_file)):
+				instList += [env.Install(f_dst_path, f_src_file)]
+
+
+################################################################################
+### Build AI Interface shared objects
+################################################################################
+install_aiinterfaces_dir = os.path.join(aiinterfaceenv['installprefix'], aiinterfaceenv['datadir'], 'AI', 'Interfaces')
+#install_aiinterfaces_dir = os.path.join('Interfaces')
+
+# store shared ai-interface objects so newer scons versions don't choke with
+# *** Two environments with different actions were specified for the same target
+aiinterfaceobjs_main = create_shared_objects(aiinterfaceenv, filelist.get_shared_AIInterface_source(aiinterfaceenv), '-aiinterface')
+aiinterfaceobjs_SharedLib = create_shared_objects(aiinterfaceenv, filelist.get_shared_AIInterface_source_SharedLib(aiinterfaceenv), '-aiinterface')
+
+# Build
+aiinterfaces_exclude_list=['build']
+aiinterfaces_needSharedLib_list=['C']
+aiinterfaces_needStreflop_list=['Java']
+javaInterfaceCP = ''
+javaInterfaceJar = ''
+for baseName in filelist.list_AIInterfaces(aiinterfaceenv, exclude_list=aiinterfaces_exclude_list):
+	aiInterfaceVersion = fetch_ai_version(baseName, 'Interfaces')
+	print &quot;Found AI Interface: &quot; + baseName + &quot; &quot; + aiInterfaceVersion
+	myEnv = aiinterfaceenv.Clone()
+	install_data_interface_dir = os.path.join(install_aiinterfaces_dir, baseName, aiInterfaceVersion)
+	instList = []
+	objs = aiinterfaceobjs_main
+	if baseName in aiinterfaces_needSharedLib_list:
+		objs += aiinterfaceobjs_SharedLib
+	if baseName in aiinterfaces_needStreflop_list:
+		if env['fpmath'] == 'sse':
+			myEnv.AppendUnique(CPPDEFINES=['STREFLOP_SSE'])
+		else:
+			myEnv.AppendUnique(CPPDEFINES=['STREFLOP_X87'])
+		myEnv.AppendUnique(CPPPATH = ['#rts/lib/streflop'])
+		myEnv.AppendUnique(LIBS = ['streflop'])
+	mySource = objs + filelist.get_AIInterface_source(myEnv, baseName)
+	if baseName == 'Java':
+		myEnv.AppendUnique(LIBS = ['jvm'])
+		# generate class files
+		#print &quot;CWD %s&quot; % os.getcwd()
+		javaWrapperScript = 'java_generateWrappers.' + getLocalShellExecPostfix()
+		javaWrapperScriptPath = os.path.join('AI', 'Interfaces', baseName, 'bin')
+		if sys.platform == 'win32':
+			javaWrapperCmd = javaWrapperScript
+		else:
+			javaWrapperCmd = './' + javaWrapperScript
+		javaWrapperBld = myEnv.Builder(action = javaWrapperCmd, chdir = javaWrapperScriptPath)
+		myEnv.Append(BUILDERS = {'JavaWrapper' : javaWrapperBld})
+		javaSrcGen = myEnv.JavaWrapper(source = mySource)
+		Alias(baseName, javaSrcGen)
+		Alias('AIInterfaces', javaSrcGen)
+		Default(javaSrcGen)
+		# compile the Java part
+		javaSrc = os.path.join('Interfaces', baseName, 'java/src')
+		javaClasses = os.path.join(myEnv['builddir'], 'Interfaces', baseName, aiInterfaceVersion, 'classes')
+		#javaJar = os.path.join(myEnv['builddir'], 'Interfaces', baseName, aiInterfaceVersion, 'interface.jar')
+		#javaInterfaceJar = javaJar
+		javaInterfaceJar = os.path.join('Interfaces', baseName, aiInterfaceVersion, 'interface.jar')
+		javaJar = os.path.join(myEnv['builddir'], javaInterfaceJar)
+		javaInterfaceJar = os.path.join('build', 'AI', javaInterfaceJar)
+		jlibDir = os.path.join('Interfaces', baseName, 'data', 'jlib')
+		javaInterfaceCP = createJavaClasspath(jlibDir, 'AI')
+		myEnv['JAVACLASSPATH'] = javaInterfaceCP
+		myEnv['JAVASOURCEPATH'] = javaSrc
+		myClasses = myEnv.Java(target = javaClasses, source = javaSrc)
+		myEnv['JARCHDIR'] = [javaClasses]
+		myJar = myEnv.Jar(target = javaJar, source = myClasses)
+		Alias(baseName, myJar)
+		Alias('AIInterfaces', myJar)
+		Default(myJar)
+		instList += [myEnv.Install(install_data_interface_dir, myJar)]
+		#installDataDir(myEnv, install_data_interface_dir, jlibDir, instList)
+
+	#targetName = baseName + '-' + aiInterfaceVersion
+	targetName = baseName
+	lib = myEnv.SharedLibrary(os.path.join(myEnv['builddir'], 'Interfaces', baseName, aiInterfaceVersion, targetName), mySource)
+	Alias(baseName, lib)       # Allow e.g. `scons Java' to compile just that specific AI interface.
+	Alias('AIInterfaces', lib) # Allow `scons AIInterfaces' to compile all AI interfaces.
+	Default(lib)
+	instList += [myEnv.Install(install_data_interface_dir, lib)]
+	if myEnv['strip']:
+		myEnv.AddPostAction(lib, Action([['strip','$TARGET']]))
+
+	# record data files (eg InterfaceInfo.lua or config files) for installation
+	source_data_dir = os.path.join('Interfaces', baseName, 'data')
+	installDataDir(myEnv, install_data_interface_dir, source_data_dir, instList)
+
+	Alias('install', instList)
+	Alias('install-AIInterfaces', instList)
+	Alias('install-' + baseName, instList)
+
+################################################################################
+### Build Skirmish AI shared objects
+################################################################################
+#print &quot;&quot;
+#print &quot;installprefix: %s&quot; % skirmishaienv['installprefix']
+#print &quot;datadir: %s&quot; % skirmishaienv['datadir']
+#print &quot;prefix: %s&quot; % skirmishaienv['prefix']
+install_skirmishai_dir = os.path.join(skirmishaienv['installprefix'], skirmishaienv['datadir'], 'AI', 'Skirmish')
+#print &quot;install_skirmishai_dir.abspath: %s&quot; % SCons.Script.Dir(install_skirmishai_dir).abspath
+#install_skirmishai_dir = os.path.join('Skirmish')
+
+# store shared ai objects so newer scons versions don't choke with
+# *** Two environments with different actions were specified for the same target
+skirmishaiobjs_main = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source(skirmishaienv), '-skirmishai')
+skirmishaiobjs_mainCregged = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
+skirmishaiobjs_creg = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_Creg(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
+skirmishaiobjs_LegacyCpp = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_LegacyCpp(skirmishaienv), '-skirmishai')
+skirmishaiobjs_LegacyCppCregged = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_LegacyCpp(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
+
+# Build
+skirmishai_exclude_list=['build', 'CSAI', 'TestABICAI', 'AbicWrappersTestAI']
+# for some strange reason, NTai has a compile error
+# when compiling with MinGW on windows, because of
+# a class in the Legacy C++ wrapper, which is used
+# by all other legacy C++ AIs aswell
+if sys.platform == 'win32':
+	skirmishai_exclude_list += ['NTai']
+skirmishai_isLegacyCpp_list=['AAI', 'KAIK', 'RAI', 'NullLegacyCppAI', 'KAI', 'NTai']
+skirmishai_needCreg_list=['KAIK', 'KAI']
+skirmishai_needBoost_list=['NTai']
+skirmishai_isJava_list=['NullJavaAI', 'NullOOJavaAI']
+for baseName in filelist.list_skirmishAIs(skirmishaienv, exclude_list=skirmishai_exclude_list):
+	aiVersion = fetch_ai_version(baseName, 'Skirmish')
+	print &quot;Found Skirmish AI: &quot; + baseName + &quot; &quot; + aiVersion
+	isLegacyCpp = baseName in skirmishai_isLegacyCpp_list
+	useCreg = baseName in skirmishai_needCreg_list
+	useBoost = baseName in skirmishai_needBoost_list
+	isJava = baseName in skirmishai_isJava_list
+	myEnv = skirmishaienv.Clone()
+	install_data_ai_dir = os.path.join(install_skirmishai_dir, baseName, aiVersion)
+	instList = []
+
+	# create the library
+	if isJava:
+		javaSrc = os.path.join('Skirmish', baseName)
+		javaClasses = os.path.join(myEnv['builddir'], 'Skirmish', baseName, aiVersion, 'classes')
+		javaJar = os.path.join(myEnv['builddir'], 'Skirmish', baseName, aiVersion, 'ai.jar')
+		jlibDir = os.path.join('Skirmish', baseName, 'data', 'jlib')
+		aiCP = createJavaClasspath(jlibDir, 'AI')
+		aiFullCP = aiCP + os.pathsep + javaInterfaceJar + os.pathsep + javaInterfaceCP
+		myEnv['JAVACLASSPATH'] = aiFullCP
+		myEnv['JAVASOURCEPATH'] = javaSrc
+		myClasses = myEnv.Java(target = javaClasses, source = javaSrc)
+		myEnv['JARCHDIR'] = [javaClasses]
+		myJar = myEnv.Jar(target = javaJar, source = myClasses)
+		Alias(baseName, myJar)
+		Alias('SkirmishAI', myJar)
+		Default(myJar)
+		instList += [myEnv.Install(install_data_ai_dir, myJar)]
+		#installDataDir(myEnv, install_data_ai_dir, jlibDir, instList)
+
+	else:
+		#if useBoost:
+		#	# This code is stolen from config.py
+		#	boost_thread = ['boost_thread']
+		#	boost_regex  = ['boost_regex']
+		#	if myEnv.Dictionary('CC').find('gcc') != -1: gcc = True
+		#	else: gcc = False
+		#	for boost in (boost_thread, boost_regex):
+		#		l = boost[0]
+		#		if gcc: boost = [l+'-gcc-mt', l+'-mt', l+'-gcc', l]
+		#		else:   boost = [l+'-mt', l]
+		#		myEnv.AppendUnique(LIBS = boost)
+		#	#myEnv.AppendUnique(LIBS = boost_regex.libraries)
+		if useCreg:
+			myEnv.AppendUnique(CPPDEFINES = ['USING_CREG'])
+		objs = []
+		if useCreg:
+			objs += skirmishaiobjs_mainCregged
+			objs += skirmishaiobjs_creg
+		else:
+			objs += skirmishaiobjs_main
+		if isLegacyCpp:
+			myEnv.AppendUnique(CPPPATH = ['Wrappers'])
+			#myEnv.AppendUnique(CXXFLAGS = ['-IWrappers'])
+			if useCreg:
+				objs += skirmishaiobjs_LegacyCppCregged
+			else:
+				objs += skirmishaiobjs_LegacyCpp
+		mySource = objs + filelist.get_skirmishAI_source(myEnv, baseName)
+		#targetName = baseName + '-' + aiVersion
+		targetName = baseName
+		lib = myEnv.SharedLibrary(os.path.join(myEnv['builddir'], 'AI/Skirmish', baseName, aiVersion, targetName), mySource)
+		Alias(baseName, lib)     # Allow e.g. `scons JCAI' to compile just a skirmish AI.
+		Alias('SkirmishAI', lib) # Allow `scons SkirmishAI' to compile all skirmishAIs.
+		Default(lib)
+		instList += [myEnv.Install(install_data_ai_dir, lib)]
+		if myEnv['strip']:
+			myEnv.AddPostAction(lib, Action([['strip','$TARGET']]))
+
+	# record data files (eg AIInfo.lua or config files) for installation
+	source_data_dir = os.path.join('Skirmish', baseName, 'data')
+	installDataDir(myEnv, install_data_ai_dir, source_data_dir, instList)
+
+	# install everything from this AI
+	Alias('install', instList)
+	Alias('install-SkirmishAI', instList)
+	Alias('install-' + baseName, instList)
+


Property changes on: branches/caiinterface/AI/SConscript
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/SConstruct
===================================================================
--- branches/caiinterface/SConstruct	2008-12-22 04:57:52 UTC (rev 7213)
+++ branches/caiinterface/SConstruct	2008-12-23 16:22:26 UTC (rev 7214)
@@ -40,13 +40,6 @@
 env = Environment(tools = myTools, toolpath = ['.', 'rts/build/scons'])
 #env = Environment(tools = myTools, toolpath = ['.', 'rts/build/scons'], ENV = {'PATH' : os.environ['PATH']})
 
-# the next four lines are needed when compiling on windows
-# (seems to be a SCons bug)
-import SCons.Tool.javac
-import SCons.Tool.jar
-SCons.Tool.javac.generate(env)
-SCons.Tool.jar.generate(env)
-
 if env['use_gch']:
 	env['Gch'] = env.Gch('rts/System/StdAfx.h', CPPDEFINES=env['CPPDEFINES']+env['spring_defines'])[0]
 else:
@@ -173,324 +166,328 @@
 	Default(unitsync)
 
 
-################################################################################
-### AIs
-################################################################################
-# Make a copy of the build environment for the AIs, but remove libraries and add include path.
-# TODO: make separate SConstructs for AIs
-aienv = env.Clone()
-aienv.AppendUnique(CPPPATH = ['rts/ExternalAI'])
-aienv.AppendUnique(LINKFLAGS = ['-Wl,--kill-at', '--add-stdcall-alias', '-mno-cygwin', '-lstdc++'])
-#print aienv['CPPDEFINES']
-
-aiinterfaceenv = aienv.Clone()
-aiinterfaceenv.AppendUnique(CPPDEFINES = ['BUILDING_AI_INTERFACE'])
-
-aienv.AppendUnique(CPPDEFINES = ['BUILDING_AI'])
-
-skirmishaienv = aienv.Clone()
-
-#groupaienv = aienv.Clone()
-
-# stores shared objects so newer scons versions don't choke with
-def create_shared_objects(env, fileList, suffix, additionalCPPDEFINES = []):
-	objsList = []
-	myEnv = env.Clone()
-	myEnv.AppendUnique(CPPDEFINES = additionalCPPDEFINES)
-	for f in fileList:
-		while isinstance(f, list):
-			f = f[0]
-		fpath, fbase = os.path.split(f)
-#		print &quot;file: %s&quot; % f
-#		print &quot;base: %s&quot; % fbase
-		fname, fext = fbase.rsplit('.', 1)
-		objsList.append(myEnv.SharedObject(os.path.join(fpath, fname + suffix), f))
-	return objsList
-
-# retrieves the version of a Skirmish AI from the following file
-# {spring_source}/AI/Skirmish/{ai_name}/VERSION
-def fetch_ai_version(aiName, subDir = 'Skirmish'):
-	version = 'VERSION_UNKNOWN'
-	versionFile = os.path.join('AI', subDir, aiName, 'VERSION')
-	if os.path.exists(versionFile):
-		file = open(versionFile, 'r')
-		version = file.readline().strip()
-		file.close()
-	return version
-
-# appends the version to the end of the AI Interface name
-def construct_aiinterface_libName(interfaceName):
-	libName = interfaceName + '-' + fetch_ai_version(interfaceName, 'Interfaces')
-	return libName
-
-def getLocalShellExecPostfix():
-	#print('sys.platform: ' + sys.platform)
-	if sys.platform == 'win32' or sys.platform == 'win64':
-		postfix = 'bat'
-	else:
-		postfix = 'sh'
-	return postfix
-
-def createJavaClasspath(path):
-	# helper function to get a list of all subdirectories
-	def addJars(jarList, dirname, names):
-		# internal function to pass to os.path.walk
-		for n in names:
-			f = os.path.join(dirname, n)
-			if os.path.isfile(f) and os.path.splitext(f)[1] == &quot;.jar&quot;:
-				jarList.append(f)
-				#print('found jar: ' + n)
-
-	jarList = []
-	os.path.walk(path, addJars, jarList)
-	clsPath = path
-	for j in jarList:
-		clsPath = clsPath + os.pathsep + j
-	#print('clsPath: ' + clsPath)
-	return clsPath
-
-# instals files plus empty directories recursively, preserving directory structure
-def installDataDir(env, dstPath, srcPath, instList):
-	if os.path.exists(srcPath):
-		files = filelist.list_files_recursive(env, srcPath, exclude_regexp = '\.svn', exclude_dirs = False, path_relative = True)
-		for f in files:
-			f_src_file = os.path.join(srcPath, f)
-			f_dst_path = os.path.join(dstPath, os.path.split(f)[0])
-			f_dst_file = os.path.join(dstPath, f)
-			if not (os.path.isdir(f_src_file) and os.path.exists(f_dst_file)):
-				instList += [env.Install(f_dst_path, f_src_file)]
-
-################################################################################
-### Build AI Interface shared objects
-################################################################################
-install_aiinterfaces_dir = os.path.join(aiinterfaceenv['installprefix'], aiinterfaceenv['datadir'], 'AI/Interfaces')
-
-# store shared ai-interface objects so newer scons versions don't choke with
-# *** Two environments with different actions were specified for the same target
-aiinterfaceobjs_main = create_shared_objects(aiinterfaceenv, filelist.get_shared_AIInterface_source(aiinterfaceenv), '-aiinterface')
-aiinterfaceobjs_SharedLib = create_shared_objects(aiinterfaceenv, filelist.get_shared_AIInterface_source_SharedLib(aiinterfaceenv), '-aiinterface')
-
-# Build
-aiinterfaces_exclude_list=['build']
-aiinterfaces_needSharedLib_list=['C']
-aiinterfaces_needStreflop_list=['Java']
-javaInterfaceCP = ''
-javaInterfaceJar = ''
-for baseName in filelist.list_AIInterfaces(aiinterfaceenv, exclude_list=aiinterfaces_exclude_list):
-	aiInterfaceVersion = fetch_ai_version(baseName, 'Interfaces')
-	print &quot;Found AI Interface: &quot; + baseName + &quot; &quot; + aiInterfaceVersion
-	myEnv = aiinterfaceenv.Clone()
-	install_data_interface_dir = os.path.join(install_aiinterfaces_dir, baseName, aiInterfaceVersion)
-	instList = []
-	objs = aiinterfaceobjs_main
-	if baseName in aiinterfaces_needSharedLib_list:
-		objs += aiinterfaceobjs_SharedLib
-	if baseName in aiinterfaces_needStreflop_list:
-		if env['fpmath'] == 'sse':
-			myEnv.AppendUnique(CPPDEFINES=['STREFLOP_SSE'])
-		else:
-			myEnv.AppendUnique(CPPDEFINES=['STREFLOP_X87'])
-		myEnv.AppendUnique(CXXFLAGS = ['-Irts/lib/streflop'])
-		myEnv.AppendUnique(LIBS = ['streflop'])
-	mySource = objs + filelist.get_AIInterface_source(myEnv, baseName)
-	if baseName == 'Java':
-		myEnv.AppendUnique(LIBS = ['jvm'])
-		# generate class files
-		javaWrapperScript = 'java_generateWrappers.' + getLocalShellExecPostfix()
-		javaWrapperScriptPath = os.path.join('AI/Interfaces', baseName, 'bin')
-		if sys.platform == 'win32':
-			javaWrapperCmd = javaWrapperScript
-		else:
-			javaWrapperCmd = './' + javaWrapperScript
-		javaWrapperBld = myEnv.Builder(action = javaWrapperCmd, chdir = javaWrapperScriptPath)
-		myEnv.Append(BUILDERS = {'JavaWrapper' : javaWrapperBld})
-		javaSrcGen = myEnv.JavaWrapper(source = mySource)
-		Alias(baseName, javaSrcGen)
-		Alias('AIInterfaces', javaSrcGen)
-		Default(javaSrcGen)
-		# compile the Java part
-		javaSrc = os.path.join('AI/Interfaces', baseName, 'java/src')
-		javaClasses = os.path.join(myEnv['builddir'], 'AI/Interfaces', baseName, aiInterfaceVersion, 'classes')
-		javaJar = os.path.join(myEnv['builddir'], 'AI/Interfaces', baseName, aiInterfaceVersion, 'interface.jar')
-		javaInterfaceJar = javaJar
-		jlibDir = os.path.join('AI/Interfaces', baseName, 'data', 'jlib')
-		javaInterfaceCP = createJavaClasspath(jlibDir)
-		myEnv['JAVACLASSPATH'] = javaInterfaceCP
-		myEnv['JAVASOURCEPATH'] = javaSrc
-		myClasses = myEnv.Java(target = javaClasses, source = javaSrc)
-		myEnv['JARCHDIR'] = [javaClasses]
-		myJar = myEnv.Jar(target = javaJar, source = myClasses)
-		Alias(baseName, myJar)
-		Alias('AIInterfaces', myJar)
-		Default(myJar)
-		instList += [env.Install(install_data_interface_dir, myJar)]
-		#installDataDir(myEnv, install_data_interface_dir, jlibDir, instList)
-
-	#targetName = baseName + '-' + aiInterfaceVersion
-	targetName = baseName
-	lib = myEnv.SharedLibrary(os.path.join(myEnv['builddir'], 'AI/Interfaces', baseName, aiInterfaceVersion, targetName), mySource)
-	Alias(baseName, lib)       # Allow e.g. `scons Java' to compile just that specific AI interface.
-	Alias('AIInterfaces', lib) # Allow `scons AIInterfaces' to compile all AI interfaces.
-	Default(lib)
-	instList += [myEnv.Install(install_data_interface_dir, lib)]
-	if myEnv['strip']:
-		myEnv.AddPostAction(lib, Action([['strip','$TARGET']]))
-
-	# record data files (eg InterfaceInfo.lua or config files) for installation
-	source_data_dir = os.path.join('AI/Interfaces', baseName, 'data')
-	installDataDir(myEnv, install_data_interface_dir, source_data_dir, instList)
-
-	Alias('install', instList)
-	Alias('install-AIInterfaces', instList)
-	Alias('install-' + baseName, instList)
-
-################################################################################
-### Build Skirmish AI shared objects
-################################################################################
-install_skirmishai_dir = os.path.join(skirmishaienv['installprefix'], skirmishaienv['datadir'], 'AI/Skirmish')
-
-# store shared ai objects so newer scons versions don't choke with
-# *** Two environments with different actions were specified for the same target
-skirmishaiobjs_main = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source(skirmishaienv), '-skirmishai')
-skirmishaiobjs_mainCregged = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
-skirmishaiobjs_creg = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_Creg(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
-skirmishaiobjs_LegacyCpp = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_LegacyCpp(skirmishaienv), '-skirmishai')
-skirmishaiobjs_LegacyCppCregged = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_LegacyCpp(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
-
-# Build
-skirmishai_exclude_list=['build', 'CSAI', 'TestABICAI', 'AbicWrappersTestAI']
-# for some strange reason, NTai has a compile error
-# when compiling with MinGW on windows, because of
-# a class in the Legacy C++ wrapper, which is used
-# by all other legacy C++ AIs aswell
-if sys.platform == 'win32':
-	skirmishai_exclude_list += ['NTai']
-skirmishai_isLegacyCpp_list=['AAI', 'KAIK', 'RAI', 'NullLegacyCppAI', 'KAI', 'NTai']
-skirmishai_needCreg_list=['KAIK', 'KAI']
-skirmishai_isJava_list=['NullJavaAI', 'NullOOJavaAI']
-for baseName in filelist.list_skirmishAIs(skirmishaienv, exclude_list=skirmishai_exclude_list):
-	aiVersion = fetch_ai_version(baseName, 'Skirmish')
-	print &quot;Found Skirmish AI: &quot; + baseName + &quot; &quot; + aiVersion
-	isLegacyCpp = baseName in skirmishai_isLegacyCpp_list
-	useCreg = baseName in skirmishai_needCreg_list
-	isJava = baseName in skirmishai_isJava_list
-	myEnv = skirmishaienv.Clone()
-	install_data_ai_dir = os.path.join(install_skirmishai_dir, baseName, aiVersion)
-	instList = []
-
-	# create the library
-	if isJava:
-		javaSrc = os.path.join('AI/Skirmish', baseName)
-		javaClasses = os.path.join(myEnv['builddir'], 'AI/Skirmish', baseName, aiVersion, 'classes')
-		javaJar = os.path.join(myEnv['builddir'], 'AI/Skirmish', baseName, aiVersion, 'ai.jar')
-		jlibDir = os.path.join('AI/Skirmish', baseName, 'data', 'jlib')
-		aiCP = createJavaClasspath(jlibDir)
-		aiFullCP = aiCP + os.pathsep + javaInterfaceJar + os.pathsep + javaInterfaceCP
-		myEnv['JAVACLASSPATH'] = aiFullCP
-		myEnv['JAVASOURCEPATH'] = javaSrc
-		myClasses = myEnv.Java(target = javaClasses, source = javaSrc)
-		myEnv['JARCHDIR'] = [javaClasses]
-		myJar = myEnv.Jar(target = javaJar, source = myClasses)
-		Alias(baseName, myJar)
-		Alias('SkirmishAI', myJar)
-		Default(myJar)
-		instList += [env.Install(install_data_ai_dir, myJar)]
-		#installDataDir(myEnv, install_data_ai_dir, jlibDir, instList)
-
-	else:
-		if useCreg:
-			myEnv.AppendUnique(CPPDEFINES = ['USING_CREG'])
-		objs = []
-		if useCreg:
-			objs += skirmishaiobjs_mainCregged
-			objs += skirmishaiobjs_creg
-		else:
-			objs += skirmishaiobjs_main
-		if isLegacyCpp:
-			myEnv.AppendUnique(CXXFLAGS = ['-IAI/Wrappers'])
-			if useCreg:
-				objs += skirmishaiobjs_LegacyCppCregged
-			else:
-				objs += skirmishaiobjs_LegacyCpp
-		mySource = objs + filelist.get_skirmishAI_source(myEnv, baseName)
-		#targetName = baseName + '-' + aiVersion
-		targetName = baseName
-		lib = myEnv.SharedLibrary(os.path.join(myEnv['builddir'], 'AI/Skirmish', baseName, aiVersion, targetName), mySource)
-		Alias(baseName, lib)     # Allow e.g. `scons JCAI' to compile just a skirmish AI.
-		Alias('SkirmishAI', lib) # Allow `scons SkirmishAI' to compile all skirmishAIs.
-		Default(lib)
-		instList += [env.Install(install_data_ai_dir, lib)]
-		if myEnv['strip']:
-			myEnv.AddPostAction(lib, Action([['strip','$TARGET']]))
-
-	# record data files (eg AIInfo.lua or config files) for installation
-	source_data_dir = os.path.join('AI/Skirmish', baseName, 'data')
-	installDataDir(myEnv, install_data_ai_dir, source_data_dir, instList)
-
-	# install everything from this AI
-	Alias('install', instList)
-	Alias('install-SkirmishAI', instList)
-	Alias('install-' + baseName, instList)
-
-## install AAI config files
-#aai_data=filelist.list_files_recursive(env, 'game/AI/AAI')
-#for f in aai_data:
-#	if not os.path.isdir(f):
-#		inst = env.Install(os.path.join(skirmishaienv['installprefix'], skirmishaienv['datadir'], os.path.dirname(f)[5:]), f)
-#		Alias('install', inst)
-
-################################################################################
-### Build Group AI shared objects
-################################################################################
-#install_groupai_lib_dir = os.path.join(groupaienv['installprefix'], groupaienv['libdir'], 'AI/Helper-libs')
-##install_groupai_data_dir = os.path.join(groupaienv['installprefix'], groupaienv['datadir'], 'AI/Helper-libs/data')
+#################################################################################
+#### AIs
+#################################################################################
+## Make a copy of the build environment for the AIs,
+## but remove libraries and add include path.
+## TODO: make separate SConstructs for AIs
+#aienv = env.Clone()
+#aienv.AppendUnique(CPPPATH = ['rts/ExternalAI'])
+#aienv.AppendUnique(LINKFLAGS = ['-Wl,--kill-at', '--add-stdcall-alias', '-mno-cygwin', '-lstdc++'])
+##print aienv['CPPDEFINES']
 #
-## store shared ai objects so newer scons versions don't choke with
+#aiinterfaceenv = aienv.Clone()
+#aiinterfaceenv.AppendUnique(CPPDEFINES = ['BUILDING_AI_INTERFACE'])
+#
+#aienv.AppendUnique(CPPDEFINES = ['BUILDING_AI'])
+#
+#skirmishaienv = aienv.Clone()
+#
+##groupaienv = aienv.Clone()
+#
+## stores shared objects so newer scons versions don't choke with
+#def create_shared_objects(env, fileList, suffix, additionalCPPDEFINES = []):
+#	objsList = []
+#	myEnv = env.Clone()
+#	myEnv.AppendUnique(CPPDEFINES = additionalCPPDEFINES)
+#	for f in fileList:
+#		while isinstance(f, list):
+#			f = f[0]
+#		fpath, fbase = os.path.split(f)
+##		print &quot;file: %s&quot; % f
+##		print &quot;base: %s&quot; % fbase
+#		fname, fext = fbase.rsplit('.', 1)
+#		objsList.append(myEnv.SharedObject(os.path.join(fpath, fname + suffix), f))
+#	return objsList
+#
+## retrieves the version of a Skirmish AI from the following file
+## {spring_source}/AI/Skirmish/{ai_name}/VERSION
+#def fetch_ai_version(aiName, subDir = 'Skirmish'):
+#	version = 'VERSION_UNKNOWN'
+#	versionFile = os.path.join('AI', subDir, aiName, 'VERSION')
+#	if os.path.exists(versionFile):
+#		file = open(versionFile, 'r')
+#		version = file.readline().strip()
+#		file.close()
+#	return version
+#
+## appends the version to the end of the AI Interface name
+#def construct_aiinterface_libName(interfaceName):
+#	libName = interfaceName + '-' + fetch_ai_version(interfaceName, 'Interfaces')
+#	return libName
+#
+#def getLocalShellExecPostfix():
+#	#print('sys.platform: ' + sys.platform)
+#	if sys.platform == 'win32' or sys.platform == 'win64':
+#		postfix = 'bat'
+#	else:
+#		postfix = 'sh'
+#	return postfix
+#
+#def createJavaClasspath(path):
+#	# helper function to get a list of all subdirectories
+#	def addJars(jarList, dirname, names):
+#		# internal function to pass to os.path.walk
+#		for n in names:
+#			f = os.path.join(dirname, n)
+#			if os.path.isfile(f) and os.path.splitext(f)[1] == &quot;.jar&quot;:
+#				jarList.append(f)
+#				#print('found jar: ' + n)
+#
+#	jarList = []
+#	os.path.walk(path, addJars, jarList)
+#	clsPath = path
+#	for j in jarList:
+#		clsPath = clsPath + os.pathsep + j
+#	#print('clsPath: ' + clsPath)
+#	return clsPath
+#
+## instals files plus empty directories recursively, preserving directory structure
+#def installDataDir(env, dstPath, srcPath, instList):
+#	if os.path.exists(srcPath):
+#		files = filelist.list_files_recursive(env, srcPath, exclude_regexp = '\.svn', exclude_dirs = False, path_relative = True)
+#		for f in files:
+#			f_src_file = os.path.join(srcPath, f)
+#			f_dst_path = os.path.join(dstPath, os.path.split(f)[0])
+#			f_dst_file = os.path.join(dstPath, f)
+#			if not (os.path.isdir(f_src_file) and os.path.exists(f_dst_file)):
+#				instList += [env.Install(f_dst_path, f_src_file)]
+#
+#################################################################################
+#### Build AI Interface shared objects
+#################################################################################
+#install_aiinterfaces_dir = os.path.join(aiinterfaceenv['installprefix'], aiinterfaceenv['datadir'], 'AI/Interfaces')
+#
+## store shared ai-interface objects so newer scons versions don't choke with
 ## *** Two environments with different actions were specified for the same target
-#groupaiobjs_main = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source(groupaienv), '-groupai')
-#groupaiobjs_mainCregged = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source(groupaienv), '-groupai_creg', ['USING_CREG'])
-#groupaiobjs_creg = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source_Creg(groupaienv), '-groupai_creg', ['USING_CREG'])
-#groupaiobjs_LegacyCpp = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source_LegacyCpp(groupaienv), '-groupai')
-#groupaiobjs_LegacyCppCregged = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source_LegacyCpp(groupaienv), '-groupai_creg', ['USING_CREG'])
+#aiinterfaceobjs_main = create_shared_objects(aiinterfaceenv, filelist.get_shared_AIInterface_source(aiinterfaceenv), '-aiinterface')
+#aiinterfaceobjs_SharedLib = create_shared_objects(aiinterfaceenv, filelist.get_shared_AIInterface_source_SharedLib(aiinterfaceenv), '-aiinterface')
 #
 ## Build
-#groupai_exclude_list=['build']
-#groupai_isLegacyCpp_list=['?', '??']
-#groupai_needCreg_list=[]
-#for baseName in filelist.list_groupAIs(groupaienv, exclude_list=groupai_exclude_list):
-#	libName = construct_groupai_libName(baseName) # eg. MetalMaker-1.0
-#	print &quot;Group AI: &quot; + libName
-#	#TODO remove the True in the next line, uncomment the rest, and actualize groupai_needCreg_list
-#	useCreg = True #baseName in groupai_needCreg_list
-#	#TODO remove the True in the next line, uncomment the rest, and actualize groupai_isLegacyCpp_list
-#	isLegacyCpp = True #baseName in groupai_isLegacyCpp_list
-#	myEnv = groupaienv.Clone()
-#	if useCreg:
-#		myEnv.AppendUnique(CPPDEFINES = ['USING_CREG'])
-#	objs = []
-#	if useCreg:
-#		objs += groupaiobjs_mainCregged
-#		objs += groupaiobjs_creg
-#	else:
-#		objs += groupaiobjs_main
-#	if isLegacyCpp:
-#		if useCreg:
-#			objs += groupaiobjs_LegacyCppCregged
+#aiinterfaces_exclude_list=['build']
+#aiinterfaces_needSharedLib_list=['C']
+#aiinterfaces_needStreflop_list=['Java']
+#javaInterfaceCP = ''
+#javaInterfaceJar = ''
+#for baseName in filelist.list_AIInterfaces(aiinterfaceenv, exclude_list=aiinterfaces_exclude_list):
+#	aiInterfaceVersion = fetch_ai_version(baseName, 'Interfaces')
+#	print &quot;Found AI Interface: &quot; + baseName + &quot; &quot; + aiInterfaceVersion
+#	myEnv = aiinterfaceenv.Clone()
+#	install_data_interface_dir = os.path.join(install_aiinterfaces_dir, baseName, aiInterfaceVersion)
+#	instList = []
+#	objs = aiinterfaceobjs_main
+#	if baseName in aiinterfaces_needSharedLib_list:
+#		objs += aiinterfaceobjs_SharedLib
+#	if baseName in aiinterfaces_needStreflop_list:
+#		if env['fpmath'] == 'sse':
+#			myEnv.AppendUnique(CPPDEFINES=['STREFLOP_SSE'])
 #		else:
-#			objs += groupaiobjs_LegacyCpp
-#	mySource = objs + filelist.get_groupAI_source(myEnv, baseName)
-#	lib = myEnv.SharedLibrary(os.path.join('game/AI/Helper-libs', baseName), mySource)
-#	#lib = myEnv.SharedLibrary(os.path.join('game/AI/Helper-libs', libName), mySource)
-#	Alias(baseName, lib)         # Allow e.g. `scons CentralBuildAI' to compile just an AI.
-#	Alias('GroupAI', lib) # Allow `scons GroupAI' to compile all groupAIs.
+#			myEnv.AppendUnique(CPPDEFINES=['STREFLOP_X87'])
+#		myEnv.AppendUnique(CXXFLAGS = ['-Irts/lib/streflop'])
+#		myEnv.AppendUnique(LIBS = ['streflop'])
+#	mySource = objs + filelist.get_AIInterface_source(myEnv, baseName)
+#	if baseName == 'Java':
+#		myEnv.AppendUnique(LIBS = ['jvm'])
+#		# generate class files
+#		javaWrapperScript = 'java_generateWrappers.' + getLocalShellExecPostfix()
+#		javaWrapperScriptPath = os.path.join('AI/Interfaces', baseName, 'bin')
+#		if sys.platform == 'win32':
+#			javaWrapperCmd = javaWrapperScript
+#		else:
+#			javaWrapperCmd = './' + javaWrapperScript
+#		javaWrapperBld = myEnv.Builder(action = javaWrapperCmd, chdir = javaWrapperScriptPath)
+#		myEnv.Append(BUILDERS = {'JavaWrapper' : javaWrapperBld})
+#		javaSrcGen = myEnv.JavaWrapper(source = mySource)
+#		Alias(baseName, javaSrcGen)
+#		Alias('AIInterfaces', javaSrcGen)
+#		Default(javaSrcGen)
+#		# compile the Java part
+#		javaSrc = os.path.join('AI/Interfaces', baseName, 'java/src')
+#		javaClasses = os.path.join(myEnv['builddir'], 'AI/Interfaces', baseName, aiInterfaceVersion, 'classes')
+#		javaJar = os.path.join(myEnv['builddir'], 'AI/Interfaces', baseName, aiInterfaceVersion, 'interface.jar')
+#		javaInterfaceJar = javaJar
+#		jlibDir = os.path.join('AI/Interfaces', baseName, 'data', 'jlib')
+#		javaInterfaceCP = createJavaClasspath(jlibDir)
+#		myEnv['JAVACLASSPATH'] = javaInterfaceCP
+#		myEnv['JAVASOURCEPATH'] = javaSrc
+#		myClasses = myEnv.Java(target = javaClasses, source = javaSrc)
+#		myEnv['JARCHDIR'] = [javaClasses]
+#		myJar = myEnv.Jar(target = javaJar, source = myClasses)
+#		Alias(baseName, myJar)
+#		Alias('AIInterfaces', myJar)
+#		Default(myJar)
+#		instList += [env.Install(install_data_interface_dir, myJar)]
+#		#installDataDir(myEnv, install_data_interface_dir, jlibDir, instList)
+#
+#	#targetName = baseName + '-' + aiInterfaceVersion
+#	targetName = baseName
+#	lib = myEnv.SharedLibrary(os.path.join(myEnv['builddir'], 'AI/Interfaces', baseName, aiInterfaceVersion, targetName), mySource)
+#	Alias(baseName, lib)       # Allow e.g. `scons Java' to compile just that specific AI interface.
+#	Alias('AIInterfaces', lib) # Allow `scons AIInterfaces' to compile all AI interfaces.
 #	Default(lib)
-#	inst = env.Install(install_groupai_lib_dir, lib)
-#	Alias('install', inst)
-#	Alias('install-GroupAI', inst)
-#	Alias('install-'+baseName, inst)
+#	instList += [myEnv.Install(install_data_interface_dir, lib)]
 #	if myEnv['strip']:
 #		myEnv.AddPostAction(lib, Action([['strip','$TARGET']]))
+#
+#	# record data files (eg InterfaceInfo.lua or config files) for installation
+#	source_data_dir = os.path.join('AI/Interfaces', baseName, 'data')
+#	installDataDir(myEnv, install_data_interface_dir, source_data_dir, instList)
+#
+#	Alias('install', instList)
+#	Alias('install-AIInterfaces', instList)
+#	Alias('install-' + baseName, instList)
+#
+#################################################################################
+#### Build Skirmish AI shared objects
+#################################################################################
+#install_skirmishai_dir = os.path.join(skirmishaienv['installprefix'], skirmishaienv['datadir'], 'AI/Skirmish')
+#
+## store shared ai objects so newer scons versions don't choke with
+## *** Two environments with different actions were specified for the same target
+#skirmishaiobjs_main = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source(skirmishaienv), '-skirmishai')
+#skirmishaiobjs_mainCregged = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
+#skirmishaiobjs_creg = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_Creg(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
+#skirmishaiobjs_LegacyCpp = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_LegacyCpp(skirmishaienv), '-skirmishai')
+#skirmishaiobjs_LegacyCppCregged = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_LegacyCpp(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
+#
+## Build
+#skirmishai_exclude_list=['build', 'CSAI', 'TestABICAI', 'AbicWrappersTestAI']
+## for some strange reason, NTai has a compile error
+## when compiling with MinGW on windows, because of
+## a class in the Legacy C++ wrapper, which is used
+## by all other legacy C++ AIs aswell
+#if sys.platform == 'win32':
+#	skirmishai_exclude_list += ['NTai']
+#skirmishai_isLegacyCpp_list=['AAI', 'KAIK', 'RAI', 'NullLegacyCppAI', 'KAI', 'NTai']
+#skirmishai_needCreg_list=['KAIK', 'KAI']
+#skirmishai_isJava_list=['NullJavaAI', 'NullOOJavaAI']
+#for baseName in filelist.list_skirmishAIs(skirmishaienv, exclude_list=skirmishai_exclude_list):
+#	aiVersion = fetch_ai_version(baseName, 'Skirmish')
+#	print &quot;Found Skirmish AI: &quot; + baseName + &quot; &quot; + aiVersion
+#	isLegacyCpp = baseName in skirmishai_isLegacyCpp_list
+#	useCreg = baseName in skirmishai_needCreg_list
+#	isJava = baseName in skirmishai_isJava_list
+#	myEnv = skirmishaienv.Clone()
+#	install_data_ai_dir = os.path.join(install_skirmishai_dir, baseName, aiVersion)
+#	instList = []
+#
+#	# create the library
+#	if isJava:
+#		javaSrc = os.path.join('AI/Skirmish', baseName)
+#		javaClasses = os.path.join(myEnv['builddir'], 'AI/Skirmish', baseName, aiVersion, 'classes')
+#		javaJar = os.path.join(myEnv['builddir'], 'AI/Skirmish', baseName, aiVersion, 'ai.jar')
+#		jlibDir = os.path.join('AI/Skirmish', baseName, 'data', 'jlib')
+#		aiCP = createJavaClasspath(jlibDir)
+#		aiFullCP = aiCP + os.pathsep + javaInterfaceJar + os.pathsep + javaInterfaceCP
+#		myEnv['JAVACLASSPATH'] = aiFullCP
+#		myEnv['JAVASOURCEPATH'] = javaSrc
+#		myClasses = myEnv.Java(target = javaClasses, source = javaSrc)
+#		myEnv['JARCHDIR'] = [javaClasses]
+#		myJar = myEnv.Jar(target = javaJar, source = myClasses)
+#		Alias(baseName, myJar)
+#		Alias('SkirmishAI', myJar)
+#		Default(myJar)
+#		instList += [env.Install(install_data_ai_dir, myJar)]
+#		#installDataDir(myEnv, install_data_ai_dir, jlibDir, instList)
+#
+#	else:
+#		if useCreg:
+#			myEnv.AppendUnique(CPPDEFINES = ['USING_CREG'])
+#		objs = []
+#		if useCreg:
+#			objs += skirmishaiobjs_mainCregged
+#			objs += skirmishaiobjs_creg
+#		else:
+#			objs += skirmishaiobjs_main
+#		if isLegacyCpp:
+#			myEnv.AppendUnique(CXXFLAGS = ['-IAI/Wrappers'])
+#			if useCreg:
+#				objs += skirmishaiobjs_LegacyCppCregged
+#			else:
+#				objs += skirmishaiobjs_LegacyCpp
+#		mySource = objs + filelist.get_skirmishAI_source(myEnv, baseName)
+#		#targetName = baseName + '-' + aiVersion
+#		targetName = baseName
+#		lib = myEnv.SharedLibrary(os.path.join(myEnv['builddir'], 'AI/Skirmish', baseName, aiVersion, targetName), mySource)
+#		Alias(baseName, lib)     # Allow e.g. `scons JCAI' to compile just a skirmish AI.
+#		Alias('SkirmishAI', lib) # Allow `scons SkirmishAI' to compile all skirmishAIs.
+#		Default(lib)
+#		instList += [env.Install(install_data_ai_dir, lib)]
+#		if myEnv['strip']:
+#			myEnv.AddPostAction(lib, Action([['strip','$TARGET']]))
+#
+#	# record data files (eg AIInfo.lua or config files) for installation
+#	source_data_dir = os.path.join('AI/Skirmish', baseName, 'data')
+#	installDataDir(myEnv, install_data_ai_dir, source_data_dir, instList)
+#
+#	# install everything from this AI
+#	Alias('install', instList)
+#	Alias('install-SkirmishAI', instList)
+#	Alias('install-' + baseName, instList)
+#
+### install AAI config files
+##aai_data=filelist.list_files_recursive(env, 'game/AI/AAI')
+##for f in aai_data:
+##	if not os.path.isdir(f):
+##		inst = env.Install(os.path.join(skirmishaienv['installprefix'], skirmishaienv['datadir'], os.path.dirname(f)[5:]), f)
+##		Alias('install', inst)
+#
+#################################################################################
+#### Build Group AI shared objects
+#################################################################################
+##install_groupai_lib_dir = os.path.join(groupaienv['installprefix'], groupaienv['libdir'], 'AI/Helper-libs')
+###install_groupai_data_dir = os.path.join(groupaienv['installprefix'], groupaienv['datadir'], 'AI/Helper-libs/data')
+##
+### store shared ai objects so newer scons versions don't choke with
+### *** Two environments with different actions were specified for the same target
+##groupaiobjs_main = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source(groupaienv), '-groupai')
+##groupaiobjs_mainCregged = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source(groupaienv), '-groupai_creg', ['USING_CREG'])
+##groupaiobjs_creg = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source_Creg(groupaienv), '-groupai_creg', ['USING_CREG'])
+##groupaiobjs_LegacyCpp = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source_LegacyCpp(groupaienv), '-groupai')
+##groupaiobjs_LegacyCppCregged = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source_LegacyCpp(groupaienv), '-groupai_creg', ['USING_CREG'])
+##
+### Build
+##groupai_exclude_list=['build']
+##groupai_isLegacyCpp_list=['?', '??']
+##groupai_needCreg_list=[]
+##for baseName in filelist.list_groupAIs(groupaienv, exclude_list=groupai_exclude_list):
+##	libName = construct_groupai_libName(baseName) # eg. MetalMaker-1.0
+##	print &quot;Group AI: &quot; + libName
+##	#TODO remove the True in the next line, uncomment the rest, and actualize groupai_needCreg_list
+##	useCreg = True #baseName in groupai_needCreg_list
+##	#TODO remove the True in the next line, uncomment the rest, and actualize groupai_isLegacyCpp_list
+##	isLegacyCpp = True #baseName in groupai_isLegacyCpp_list
+##	myEnv = groupaienv.Clone()
+##	if useCreg:
+##		myEnv.AppendUnique(CPPDEFINES = ['USING_CREG'])
+##	objs = []
+##	if useCreg:
+##		objs += groupaiobjs_mainCregged
+##		objs += groupaiobjs_creg
+##	else:
+##		objs += groupaiobjs_main
+##	if isLegacyCpp:
+##		if useCreg:
+##			objs += groupaiobjs_LegacyCppCregged
+##		else:
+##			objs += groupaiobjs_LegacyCpp
+##	mySource = objs + filelist.get_groupAI_source(myEnv, baseName)
+##	lib = myEnv.SharedLibrary(os.path.join('game/AI/Helper-libs', baseName), mySource)
+##	#lib = myEnv.SharedLibrary(os.path.join('game/AI/Helper-libs', libName), mySource)
+##	Alias(baseName, lib)         # Allow e.g. `scons CentralBuildAI' to compile just an AI.
+##	Alias('GroupAI', lib) # Allow `scons GroupAI' to compile all groupAIs.
+##	Default(lib)
+##	inst = env.Install(install_groupai_lib_dir, lib)
+##	Alias('install', inst)
+##	Alias('install-GroupAI', inst)
+##	Alias('install-'+baseName, inst)
+##	if myEnv['strip']:
+##		myEnv.AddPostAction(lib, Action([['strip','$TARGET']]))
+#
+#
 
+SConscript(['AI/SConscript'], exports=['env'], variant_dir='build')
 
 ################################################################################
 ### Build streflop (which has it's own Makefile-based build system)

Modified: branches/caiinterface/rts/build/scons/config.py
===================================================================
--- branches/caiinterface/rts/build/scons/config.py	2008-12-22 04:57:52 UTC (rev 7213)
+++ branches/caiinterface/rts/build/scons/config.py	2008-12-23 16:22:26 UTC (rev 7214)
@@ -69,7 +69,7 @@
 def guess_include_path(env, conf, name, subdir):
 	print &quot;  Guessing&quot;, name, &quot;include path...&quot;,
 	if env['platform'] == 'windows':
-		path = [os.path.join(os.path.join('mingwlibs', 'include'), subdir)]
+		path = [os.path.join(os.path.join('#mingwlibs', 'include'), subdir)]
 		# Everything lives in mingwlibs anyway...
 		#if os.environ.has_key('MINGDIR'):
 		#	path += [os.path.join(os.path.join(os.environ['MINGDIR'], 'include'), subdir)]

Modified: branches/caiinterface/rts/build/scons/filelist.py
===================================================================
--- branches/caiinterface/rts/build/scons/filelist.py	2008-12-22 04:57:52 UTC (rev 7213)
+++ branches/caiinterface/rts/build/scons/filelist.py	2008-12-23 16:22:26 UTC (rev 7214)
@@ -90,7 +90,6 @@
 
 def get_spring_source(env):
 	exclude1 = [
-		'rts/AI',
 		'rts/build',
 		'rts/lib/crashrpt', # unused
 		'rts/lib/libhpi',
@@ -135,17 +134,17 @@
 
 # lists source files for each individual AI Interface
 def get_AIInterface_source(env, which):
-	result = get_AI_source(env, 'AI/Interfaces', which)
+	result = get_AI_source(env, 'Interfaces', which)
 	return result
 
 # lists source files for each individual Skirmish AI
 def get_skirmishAI_source(env, which):
-	result = get_AI_source(env, 'AI/Skirmish', which)
+	result = get_AI_source(env, 'Skirmish', which)
 	return result
 
 # lists source files for each individual Group AI
 def get_groupAI_source(env, which):
-	result = get_AI_source(env, 'AI/Group', which)
+	result = get_AI_source(env, 'Group', which)
 	return result
 
 
@@ -183,18 +182,18 @@
 	if env.has_key('builddir') and env['builddir']:
 		result += [os.path.join(env['builddir'], 'rts/System/float3.cpp')]
 		result += [os.path.join(env['builddir'], 'rts/Sim/Misc/DamageArray.cpp')]
-		result += [os.path.join(env['builddir'], 'AI/Wrappers/LegacyCpp/AISCommands.cpp')]
-		result += [os.path.join(env['builddir'], 'AI/Wrappers/LegacyCpp/AIAICallback.cpp')]
-		result += [os.path.join(env['builddir'], 'AI/Wrappers/LegacyCpp/AIAICheats.cpp')]
-		result += [os.path.join(env['builddir'], 'AI/Wrappers/LegacyCpp/AIGlobalAICallback.cpp')]
-		result += [os.path.join(env['builddir'], 'AI/Wrappers/LegacyCpp/AIGlobalAI.cpp')]
-		result += [os.path.join(env['builddir'], 'AI/Wrappers/LegacyCpp/AI.cpp')]
+		result += [os.path.join(env['builddir'], 'Wrappers/LegacyCpp/AISCommands.cpp')]
+		result += [os.path.join(env['builddir'], 'Wrappers/LegacyCpp/AIAICallback.cpp')]
+		result += [os.path.join(env['builddir'], 'Wrappers/LegacyCpp/AIAICheats.cpp')]
+		result += [os.path.join(env['builddir'], 'Wrappers/LegacyCpp/AIGlobalAICallback.cpp')]
+		result += [os.path.join(env['builddir'], 'Wrappers/LegacyCpp/AIGlobalAI.cpp')]
+		result += [os.path.join(env['builddir'], 'Wrappers/LegacyCpp/AI.cpp')]
 	return result
 # list Creg source files (used by some Skirmish AI libraries)
 def get_shared_skirmishAI_source_Creg(env):
 	result = []
 	if env.has_key('builddir') and env['builddir']:
-		result += get_source(env, 'rts/System/creg')
+		result += get_source(env, '../rts/System/creg')
 	return result
 
 # lists source files common for all Group AIs
@@ -207,13 +206,13 @@
 	if env.has_key('builddir') and env['builddir']:
 		result += [os.path.join(env['builddir'], 'rts/System/float3.cpp')]
 		result += [os.path.join(env['builddir'], 'rts/Sim/Misc/DamageArray.cpp')]
-		result += [os.path.join(env['builddir'], 'AI/Wrappers/LegacyCpp/AISCommands.cpp')]
+		result += [os.path.join(env['builddir'], 'Wrappers/LegacyCpp/AISCommands.cpp')]
 	return result
 # list Creg source files (used by some Group AI libraries)
 def get_shared_groupAI_source_Creg(env):
 	result = []
 	if env.has_key('builddir') and env['builddir']:
-		result += get_source(env, 'rts/System/creg')
+		result += get_source(env, '../rts/System/creg')
 	return result
 
 
@@ -231,12 +230,12 @@
 
 # lists source directories for AI Interfaces
 def list_AIInterfaces(env, exclude_list = (), exclude_regexp = '^\.'):
-	return list_AIs(env, 'AI/Interfaces', exclude_list, exclude_regexp)
+	return list_AIs(env, 'Interfaces', exclude_list, exclude_regexp)
 
 # lists source directories for Skirmish AIs
 def list_skirmishAIs(env, exclude_list = (), exclude_regexp = '^\.'):
-	return list_AIs(env, 'AI/Skirmish', exclude_list, exclude_regexp)
+	return list_AIs(env, 'Skirmish', exclude_list, exclude_regexp)
 
 # lists source directories for Group AIs
 def list_groupAIs(env, exclude_list = (), exclude_regexp = '^\.'):
-	return list_AIs(env, 'AI/Group', exclude_list, exclude_regexp)
+	return list_AIs(env, 'Group', exclude_list, exclude_regexp)

Modified: branches/caiinterface/rts/build/scons/rts.py
===================================================================
--- branches/caiinterface/rts/build/scons/rts.py	2008-12-22 04:57:52 UTC (rev 7213)
+++ branches/caiinterface/rts/build/scons/rts.py	2008-12-23 16:22:26 UTC (rev 7214)
@@ -67,19 +67,20 @@
 
 	# I don't see any reason to make this configurable --tvo.
 	# Note that commenting out / setting this to `None' will break the buildsystem.
-	env['builddir'] = 'build'
+	env['builddir'] = '#build'
+	bd = SCons.Script.Dir(env['builddir']).abspath
 
 	# SCons chokes in env.SConsignFile() if path doesn't exist.
-	if not os.path.exists(env['builddir']):
-		os.makedirs(env['builddir'])
+	if not os.path.exists(bd):
+		os.makedirs(bd)
 
 	# Avoid spreading .sconsign files everywhere - keep this line
 	# Use os.path.abspath() here because somehow the argument to SConsignFile is relative to the
 	# directory of the toplevel trunk/SConstruct and not the current directory, trunk/rts/SConstruct.
-	env.SConsignFile(os.path.abspath(os.path.join(env['builddir'], 'scons_signatures')))
+	env.SConsignFile(os.path.abspath(os.path.join(bd, 'scons_signatures')))
 
-	usrcachefile = os.path.join(env['builddir'], 'usropts.py')
-	intcachefile = os.path.join(env['builddir'], 'intopts.py')
+	usrcachefile = os.path.join(bd, 'usropts.py')
+	intcachefile = os.path.join(bd, 'intopts.py')
 	usropts = Options(usrcachefile)
 	intopts = Options(intcachefile)
 
@@ -440,9 +441,9 @@
 		stringarray_opt('cpppath', [])
 		stringarray_opt('libpath', [])
 
-		include_path = env['cpppath'] + ['rts', 'rts/System']
-		include_path += ['rts/lib/luabind', 'rts/lib/lua/include', 'rts/lib/streflop']
-		lib_path = env['libpath'] + ['rts/lib/streflop']
+		include_path = env['cpppath'] + ['#rts', '#rts/System']
+		include_path += ['#rts/lib/luabind', '#rts/lib/lua/include', '#rts/lib/streflop']
+		lib_path = env['libpath'] + ['#rts/lib/streflop']
 
 		if env['platform'] == 'freebsd':
 			include_path += ['/usr/local/include', '/usr/X11R6/include', '/usr/X11R6/include/GL']
@@ -457,8 +458,8 @@
 			env['SHLINKFLAGS'] = '$LINKFLAGS -dynamic'
 			env['SHLIBSUFFIX'] = '.dylib'
 		elif env['platform'] == 'windows':
-			include_path += [os.path.join('mingwlibs', 'include')]
-			lib_path += [os.path.join('mingwlibs', 'lib')]
+			include_path += [os.path.join('#mingwlibs', 'include')]
+			lib_path += [os.path.join('#mingwlibs', 'lib')]
 			if os.environ.has_key('MINGDIR'):
 				include_path += [os.path.join(os.environ['MINGDIR'], 'include')]
 				lib_path += [os.path.join(os.environ['MINGDIR'], 'lib')]
@@ -478,9 +479,12 @@
 		usropts.Save(usrcachefile, env)
 		intopts.Save(intcachefile, env)
 
-	# Substitute prefix in installprefix
-	env['installprefix'] = env.subst(env['installprefix'])
+	# make the prefix absolute
+	env['prefix'] = SCons.Script.Dir(env['prefix']).abspath
 
+	# Substitute prefix in installprefix, and make installprefix absolute
+	env['installprefix'] = SCons.Script.Dir(env.subst(env['installprefix'])).abspath
+
 	# Fix up some suffices for mingw crosscompile.
 	if env['platform'] == 'windows':
 		env['SHLIBSUFFIX'] = '.dll'


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001982.html">[Taspring-linux-commit] r7213 -	trunk/installer/builddata/maphelper/maphelper
</A></li>
	<LI>Next message: <A HREF="001984.html">[Taspring-linux-commit] r7215 - in Lobby/TASClient: . Python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1983">[ date ]</a>
              <a href="thread.html#1983">[ thread ]</a>
              <a href="subject.html#1983">[ subject ]</a>
              <a href="author.html#1983">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
