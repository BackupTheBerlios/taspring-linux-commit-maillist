<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7201 - in branches/caiinterface: .	AI/Interfaces AI/Interfaces/Java AI/Skirmish AI/Skirmish/JCAI	AI/Skirmish/NTai AI/Wrappers/LegacyCpp	AI/Wrappers/LegacyCpp/Event rts/ExternalAI/Interface rts/build/cmake
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-December/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7201%20-%20in%20branches/caiinterface%3A%20.%0A%09AI/Interfaces%20AI/Interfaces/Java%20AI/Skirmish%20AI/Skirmish/JCAI%0A%09AI/Skirmish/NTai%20AI/Wrappers/LegacyCpp%0A%09AI/Wrappers/LegacyCpp/Event%20rts/ExternalAI/Interface%20rts/build/cmake&In-Reply-To=%3C20081219131054.564B14760%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001969.html">
   <LINK REL="Next"  HREF="001971.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7201 - in branches/caiinterface: .	AI/Interfaces AI/Interfaces/Java AI/Skirmish AI/Skirmish/JCAI	AI/Skirmish/NTai AI/Wrappers/LegacyCpp	AI/Wrappers/LegacyCpp/Event rts/ExternalAI/Interface rts/build/cmake</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7201%20-%20in%20branches/caiinterface%3A%20.%0A%09AI/Interfaces%20AI/Interfaces/Java%20AI/Skirmish%20AI/Skirmish/JCAI%0A%09AI/Skirmish/NTai%20AI/Wrappers/LegacyCpp%0A%09AI/Wrappers/LegacyCpp/Event%20rts/ExternalAI/Interface%20rts/build/cmake&In-Reply-To=%3C20081219131054.564B14760%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r7201 - in branches/caiinterface: .	AI/Interfaces AI/Interfaces/Java AI/Skirmish AI/Skirmish/JCAI	AI/Skirmish/NTai AI/Wrappers/LegacyCpp	AI/Wrappers/LegacyCpp/Event rts/ExternalAI/Interface rts/build/cmake">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Fri Dec 19 14:10:53 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001969.html">[Taspring-linux-commit] r7200 - in	branches/caiinterface/AI/Skirmish/NTai/AI/NTai: Core Helpers
</A></li>
        <LI>Next message: <A HREF="001971.html">[Taspring-linux-commit] r7202 -	trunk/installer/builddata/springcontent/shaders
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1970">[ date ]</a>
              <a href="thread.html#1970">[ thread ]</a>
              <a href="subject.html#1970">[ subject ]</a>
              <a href="author.html#1970">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-12-19 14:10:53 +0100 (Fri, 19 Dec 2008)
New Revision: 7201

Added:
   branches/caiinterface/AI/Skirmish/JCAI/VERSION
   branches/caiinterface/AI/Skirmish/NTai/VERSION
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIReleaseEvent.h
Modified:
   branches/caiinterface/AI/Interfaces/CMakeLists.txt
   branches/caiinterface/AI/Interfaces/Java/JavaBridge.c
   branches/caiinterface/AI/Skirmish/CMakeLists.txt
   branches/caiinterface/AI/Wrappers/LegacyCpp/AI.cpp
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyDamagedEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyDestroyedEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyEnterLOSEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyEnterRadarEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyLeaveLOSEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyLeaveRadarEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEvents.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIInitEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIMessageEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AINullEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIPlayerCommandEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AISeismicPingEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitCapturedEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitCreatedEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitDamagedEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitDestroyedEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitFinishedEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitGivenEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitIdleEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitMoveFailedEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUpdateEvent.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIWeaponFiredEvent.h
   branches/caiinterface/SConstruct
   branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h
   branches/caiinterface/rts/build/cmake/FindJAVA.cmake
Log:
* cleaned up Legacy C++ Wrapper
* cleaned up CMake messages for AI Interfaces and Skirmish AIs (are now hideable)
* renamed SCons AI Interfaces and Skirmish AI messages when configuring to fit the standard (Found ...)
* Added NTai and JCAI VERSION files

Modified: branches/caiinterface/AI/Interfaces/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-12-19 13:10:53 UTC (rev 7201)
@@ -10,7 +10,9 @@
 	set(SHELL_EXEC_POSTFIX &quot;bat&quot;)
 ENDIF(UNIX)
 
+#set(AIINTERFACE_FIND_QUIETLY True)
 
+
 # C &amp; C++ AI Interface
 set(C_AIINTERFACE_SRC &quot;${AI_INTERFACES_SRC}/C&quot;)
 if (EXISTS ${C_AIINTERFACE_SRC})
@@ -20,7 +22,9 @@
 	endif (EXISTS ${C_AIINTERFACE_SRC}/VERSION)
 	set(C_AIINTERFACE_TARGET &quot;C-${C_AIINTERFACE_VERS}&quot;)
 	set(C_AIINTERFACE_DATA_DIR ${AI_INTERFACES_DATA}/C/${C_AIINTERFACE_VERS})
-	message(STATUS &quot;${C_AIINTERFACE_VERS}\t(C AI Interface Version)&quot;)
+	if (NOT AIINTERFACE_FIND_QUIETLY)
+		message(STATUS &quot;Found AI Interface: C ${C_AIINTERFACE_VERS}&quot;)
+	endif (NOT AIINTERFACE_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${C_AIINTERFACE_SRC}/data/&quot;
@@ -40,6 +44,7 @@
 
 # Java AI Interface
 if (NOT JAVA_FOUND)
+	set(JAVA_FIND_QUIETLY ${AIINTERFACE_FIND_QUIETLY})
 	FIND_PACKAGE(JAVA) # Note: this is not the CMake builtin FindJava
 endif (NOT JAVA_FOUND)
 #message(STATUS &quot;Interface JAVA_FOUND: ${JAVA_FOUND}&quot;)
@@ -64,7 +69,7 @@
 		message (&quot;No Java includes found -&gt; Java AI Interface will not be built&quot;)
 	endif (JAVA_INCLUDE_PATH)
 ENDIF (MINGW)
-message(STATUS &quot;Interface JNI_FOUND: ${JNI_FOUND}&quot;)
+#message(STATUS &quot;Interface JNI_FOUND: ${JNI_FOUND}&quot;)
 set(Java_AIINTERFACE_SRC &quot;${AI_INTERFACES_SRC}/Java&quot;)
 if (JNI_FOUND AND JAVA_FOUND AND EXISTS ${Java_AIINTERFACE_SRC} AND EXISTS ${Java_AIINTERFACE_SRC}/bin)
 	set(Java_AIINTERFACE_VERS &quot;UNKNOWN_VERSION&quot;)
@@ -77,7 +82,9 @@
 	set(Java_AIINTERFACE_PKG &quot;com/clan_sy/spring/ai&quot;)
 	set(Java_AIINTERFACE_PKG_FIRST_PART &quot;com&quot;)
 	set(Java_AIINTERFACE_CLASSPATH &quot;.:${PATH_DELIM}${Java_AIINTERFACE_SRC}/data/jlib/jna/jna.jar${PATH_DELIM}${Java_AIINTERFACE_SRC}/data/jlib/vecmath.jar&quot;)
-	message(STATUS &quot;${Java_AIINTERFACE_VERS}\t(Java AI Interface Version)&quot;)
+	if (NOT AIINTERFACE_FIND_QUIETLY)
+		message(STATUS &quot;Found AI Interface: Java ${Java_AIINTERFACE_VERS}&quot;)
+	endif (NOT AIINTERFACE_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${Java_AIINTERFACE_SRC}/data/&quot;

Modified: branches/caiinterface/AI/Interfaces/Java/JavaBridge.c
===================================================================
--- branches/caiinterface/AI/Interfaces/Java/JavaBridge.c	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Interfaces/Java/JavaBridge.c	2008-12-19 13:10:53 UTC (rev 7201)
@@ -80,7 +80,6 @@
  * {spring-data-dir}/{SKIRMISH_AI_DATA_DIR}/{ai-name}/ai.jar
  * {spring-data-dir}/{SKIRMISH_AI_DATA_DIR}/{ai-name}/jlib/
  * {spring-data-dir}/{SKIRMISH_AI_DATA_DIR}/{ai-name}/jlib/[*].jar
- * TODO: add class path for group AIs
  */
 static bool java_createClassPath(char* classPath) {
 

Modified: branches/caiinterface/AI/Skirmish/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-12-19 13:10:53 UTC (rev 7201)
@@ -3,8 +3,9 @@
 
 set(SKIRMISH_SRC &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish&quot;)
 set(SKIRMISH_DATA &quot;${DATADIR}/AI/Skirmish&quot;)
-#FIND_PACKAGE(Java)
 
+#set(SKIRMISHAI_FIND_QUIETLY True)
+
 ## KAI
 set(KAI_SRC &quot;${SKIRMISH_SRC}/KAI&quot;)
 if (EXISTS ${KAI_SRC})
@@ -14,7 +15,9 @@
 	endif (EXISTS ${KAI_SRC}/VERSION)
 	set(KAI_TARGET &quot;KAI-${KAI_VERS}&quot;)
 	set(KAI_DATA_DIR ${SKIRMISH_DATA}/KAI/${KAI_VERS})
-	message(STATUS &quot;${KAI_VERS}\t(KAI Version)&quot;)
+	if (NOT SKIRMISHAI_FIND_QUIETLY)
+		message(STATUS &quot;Found Skirmish AI: KAI ${KAI_VERS}&quot;)
+	endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 	# install data files
 	#install(DIRECTORY &quot;${KAI_SRC}/data/&quot;
@@ -36,7 +39,9 @@
 	endif (EXISTS ${KAIK_SRC}/VERSION)
 	set(KAIK_TARGET &quot;KAIK-${KAIK_VERS}&quot;)
 	set(KAIK_DATA_DIR ${SKIRMISH_DATA}/KAIK/${KAIK_VERS})
-	message(STATUS &quot;${KAIK_VERS}\t(KAIK Version)&quot;)
+	if (NOT SKIRMISHAI_FIND_QUIETLY)
+		message(STATUS &quot;Found Skirmish AI: KAIK ${KAIK_VERS}&quot;)
+	endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${KAIK_SRC}/data/&quot;
@@ -58,7 +63,9 @@
 	endif (EXISTS ${RAI_SRC}/VERSION)
 	set(RAI_TARGET &quot;RAI-${RAI_VERS}&quot;)
 	set(RAI_DATA_DIR ${SKIRMISH_DATA}/RAI/${RAI_VERS})
-	message(STATUS &quot;${RAI_VERS}\t(RAI Version)&quot;)
+	if (NOT SKIRMISHAI_FIND_QUIETLY)
+		message(STATUS &quot;Found Skirmish AI: RAI ${RAI_VERS}&quot;)
+	endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${RAI_SRC}/data/&quot;
@@ -79,7 +86,9 @@
 	endif (EXISTS ${AAI_SRC}/VERSION)
 	set(AAI_TARGET &quot;AAI-${AAI_VERS}&quot;)
 	set(AAI_DATA_DIR ${SKIRMISH_DATA}/AAI/${AAI_VERS})
-	message(STATUS &quot;${AAI_VERS}\t(AAI Version)&quot;)
+	if (NOT SKIRMISHAI_FIND_QUIETLY)
+		message(STATUS &quot;Found Skirmish AI: AAI ${AAI_VERS}&quot;)
+	endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${AAI_SRC}/data/&quot;
@@ -100,7 +109,9 @@
 	endif (EXISTS ${NTai_SRC}/VERSION)
 	set(NTai_TARGET &quot;NTai-${NTai_VERS}&quot;)
 	set(NTai_DATA_DIR ${SKIRMISH_DATA}/NTai/${NTai_VERS})
-	message(STATUS &quot;${NTai_VERS}\t(NTai Version)&quot;)
+	if (NOT SKIRMISHAI_FIND_QUIETLY)
+		message(STATUS &quot;Found Skirmish AI: NTai ${NTai_VERS}&quot;)
+	endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${NTai_SRC}/data/&quot;
@@ -132,7 +143,9 @@
 	endif (EXISTS ${NullLegacyCppAI_SRC}/VERSION)
 	set(NullLegacyCppAI_TARGET &quot;NullLegacyCppAI-${NullLegacyCppAI_VERS}&quot;)
 	set(NullLegacyCppAI_DATA_DIR ${SKIRMISH_DATA}/NullLegacyCppAI/${NullLegacyCppAI_VERS})
-	message(STATUS &quot;${NullLegacyCppAI_VERS}\t(NullLegacyCppAI Version)&quot;)
+	if (NOT SKIRMISHAI_FIND_QUIETLY)
+		message(STATUS &quot;Found Skirmish AI: NullLegacyCppAI ${NullLegacyCppAI_VERS}&quot;)
+	endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${NullLegacyCppAI_SRC}/data/&quot;
@@ -153,7 +166,9 @@
 	endif (EXISTS ${NullAI_SRC}/VERSION)
 	set(NullAI_TARGET &quot;NullAI-${NullAI_VERS}&quot;)
 	set(NullAI_DATA_DIR ${SKIRMISH_DATA}/NullAI/${NullAI_VERS})
-	message(STATUS &quot;${NullAI_VERS}\t(NullAI Version)&quot;)
+	if (NOT SKIRMISHAI_FIND_QUIETLY)
+		message(STATUS &quot;Found Skirmish AI: NullAI ${NullAI_VERS}&quot;)
+	endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${NullAI_SRC}/data/&quot;
@@ -167,6 +182,7 @@
 
 ## Null Java AI
 if (NOT JAVA_FOUND)
+	set(JAVA_FIND_QUIETLY ${SKIRMISHAI_FIND_QUIETLY})
 	FIND_PACKAGE(JAVA) # Note: this is not the CMake builtin FindJava
 endif (NOT JAVA_FOUND)
 set(NullJavaAI_SRC &quot;${SKIRMISH_SRC}/NullJavaAI&quot;)
@@ -181,7 +197,9 @@
 	set(NullJavaAI_PKG_FIRST_PART &quot;nulljavaai&quot;)
 	set(Java_AIINTERFACE_SRC &quot;../../Interfaces/Java&quot;)
 	set(NullJavaAI_CLASSPATH &quot;.${PATH_DELIM}${Java_AIINTERFACE_SRC}/interface.jar${PATH_DELIM}${Java_AIINTERFACE_SRC}/data/jlib/jna/jna.jar${PATH_DELIM}${Java_AIINTERFACE_SRC}/data/jlib/vecmath.jar&quot;)
-	message(STATUS &quot;${NullJavaAI_VERS}\t(NullJavaAI Version)&quot;)
+	if (NOT SKIRMISHAI_FIND_QUIETLY)
+		message(STATUS &quot;Found Skirmish AI: NullJavaAI ${NullJavaAI_VERS}&quot;)
+	endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${NullJavaAI_SRC}/data/&quot;
@@ -210,6 +228,7 @@
 
 ## Null Object Oriented Java AI
 if (NOT JAVA_FOUND)
+	set(JAVA_FIND_QUIETLY ${SKIRMISHAI_FIND_QUIETLY})
 	FIND_PACKAGE(JAVA) # Note: this is not the CMake builtin FindJava
 endif (NOT JAVA_FOUND)
 set(NullOOJavaAI_SRC &quot;${SKIRMISH_SRC}/NullOOJavaAI&quot;)
@@ -224,7 +243,9 @@
 	set(NullOOJavaAI_PKG_FIRST_PART &quot;nulloojavaai&quot;)
 	set(Java_AIINTERFACE_SRC &quot;../../Interfaces/Java&quot;)
 	set(NullOOJavaAI_CLASSPATH &quot;.${PATH_DELIM}${Java_AIINTERFACE_SRC}/interface.jar${PATH_DELIM}${Java_AIINTERFACE_SRC}/data/jlib/jna/jna.jar${PATH_DELIM}${Java_AIINTERFACE_SRC}/data/jlib/vecmath.jar&quot;)
-	message(STATUS &quot;${NullOOJavaAI_VERS}\t(NullOOJavaAI Version)&quot;)
+	if (NOT SKIRMISHAI_FIND_QUIETLY)
+		message(STATUS &quot;Found Skirmish AI: NullOOJavaAI ${NullOOJavaAI_VERS}&quot;)
+	endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 	# install data files
 	install(DIRECTORY &quot;${NullOOJavaAI_SRC}/data/&quot;
@@ -262,7 +283,9 @@
 		endif (EXISTS ${JCAI_SRC}/VERSION)
 		set(JCAI_TARGET &quot;JCAI-${JCAI_VERS}&quot;)
 		set(JCAI_DATA_DIR ${SKIRMISH_DATA}/JCAI/${JCAI_VERS})
-		message(STATUS &quot;${JCAI_VERS}\t(JCAI Version)&quot;)
+		if (NOT SKIRMISHAI_FIND_QUIETLY)
+			message(STATUS &quot;Found Skirmish AI: JCAI ${JCAI_VERS}&quot;)
+		endif (NOT SKIRMISHAI_FIND_QUIETLY)
 
 		# install data files
 		#install(DIRECTORY &quot;${JCAI_SRC}/data/&quot;

Added: branches/caiinterface/AI/Skirmish/JCAI/VERSION
===================================================================
--- branches/caiinterface/AI/Skirmish/JCAI/VERSION	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/JCAI/VERSION	2008-12-19 13:10:53 UTC (rev 7201)
@@ -0,0 +1 @@
+0.21
\ No newline at end of file


Property changes on: branches/caiinterface/AI/Skirmish/JCAI/VERSION
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/NTai/VERSION
===================================================================
--- branches/caiinterface/AI/Skirmish/NTai/VERSION	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/NTai/VERSION	2008-12-19 13:10:53 UTC (rev 7201)
@@ -0,0 +1 @@
+XE9.81
\ No newline at end of file


Property changes on: branches/caiinterface/AI/Skirmish/NTai/VERSION
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/AI.cpp
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/AI.cpp	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/AI.cpp	2008-12-19 13:10:53 UTC (rev 7201)
@@ -27,79 +27,115 @@
 
 int CAI::handleEvent(int topic, const void* data) {
 
+	static IGlobalAICallback* wrappedGlobalAICallback = NULL;
+
 	if (ai != NULL) {
-		CAIEvent* e;
+		CAIEvent* e = NULL;
 
-		switch(topic) {
-			case EVENT_NULL:
+		switch (topic) {
+			case EVENT_NULL: {
 				e = new CAINullEvent();
 				break;
-			case EVENT_INIT:
-				e = new CAIInitEvent((const SInitEvent*) data);
+			}
+			case EVENT_INIT: {
+				CAIInitEvent* initE = new CAIInitEvent(*((const SInitEvent*) data));
+				// The following two lines should not ever be needed,
+				// but they do not hurt either.
+				delete wrappedGlobalAICallback;
+				wrappedGlobalAICallback = NULL;
+				wrappedGlobalAICallback = initE-&gt;GetWrappedGlobalAICallback();
+				e = initE;
 				break;
-			case EVENT_UPDATE:
-				e = new CAIUpdateEvent((const SUpdateEvent*) data);
+			}
+			case EVENT_RELEASE: {
+				delete wrappedGlobalAICallback;
+				wrappedGlobalAICallback = NULL;
+				e = new CAIReleaseEvent(*((const SReleaseEvent*) data));
 				break;
-			case EVENT_MESSAGE:	
-				e = new CAIMessageEvent((const SMessageEvent*) data);
+			}
+			case EVENT_UPDATE: {
+				e = new CAIUpdateEvent(*((const SUpdateEvent*) data));
 				break;
-			case EVENT_UNIT_CREATED:
-				e = new CAIUnitCreatedEvent((const SUnitCreatedEvent*) data);
+			}
+			case EVENT_MESSAGE: {
+				e = new CAIMessageEvent(*((const SMessageEvent*) data));
 				break;
-			case EVENT_UNIT_FINISHED:
-				e = new CAIUnitFinishedEvent((const SUnitFinishedEvent*) data);
+			}
+			case EVENT_UNIT_CREATED: {
+				e = new CAIUnitCreatedEvent(*((const SUnitCreatedEvent*) data));
 				break;
-			case EVENT_UNIT_IDLE:
-				e = new CAIUnitIdleEvent((const SUnitIdleEvent*) data);
+			}
+			case EVENT_UNIT_FINISHED: {
+				e = new CAIUnitFinishedEvent(*((const SUnitFinishedEvent*) data));
 				break;
-			case EVENT_UNIT_MOVE_FAILED:
-				e = new CAIUnitMoveFailedEvent((const SUnitMoveFailedEvent*) data);
+			}
+			case EVENT_UNIT_IDLE: {
+				e = new CAIUnitIdleEvent(*((const SUnitIdleEvent*) data));
 				break;
-			case EVENT_UNIT_DAMAGED:
-				e = new CAIUnitDamagedEvent((const SUnitDamagedEvent*) data);
+			}
+			case EVENT_UNIT_MOVE_FAILED: {
+				e = new CAIUnitMoveFailedEvent(*((const SUnitMoveFailedEvent*) data));
 				break;
-			case EVENT_UNIT_DESTROYED: 
-				e = new CAIUnitDestroyedEvent((const SUnitDestroyedEvent*) data);
+			}
+			case EVENT_UNIT_DAMAGED: {
+				e = new CAIUnitDamagedEvent(*((const SUnitDamagedEvent*) data));
 				break;
-			case EVENT_UNIT_GIVEN:
-				e = new CAIUnitGivenEvent((const SUnitGivenEvent*) data);
+			}
+			case EVENT_UNIT_DESTROYED: {
+				e = new CAIUnitDestroyedEvent(*((const SUnitDestroyedEvent*) data));
 				break;
-			case EVENT_UNIT_CAPTURED:
-				e = new CAIUnitCapturedEvent((const SUnitCapturedEvent*) data);
+			}
+			case EVENT_UNIT_GIVEN: {
+				e = new CAIUnitGivenEvent(*((const SUnitGivenEvent*) data));
 				break;
-			case EVENT_ENEMY_ENTER_LOS:
-				e = new CAIEnemyEnterLOSEvent((const SEnemyEnterLOSEvent*) data);
+			}
+			case EVENT_UNIT_CAPTURED: {
+				e = new CAIUnitCapturedEvent(*((const SUnitCapturedEvent*) data));
 				break;
-			case EVENT_ENEMY_LEAVE_LOS:
-				e = new CAIEnemyLeaveLOSEvent((const SEnemyLeaveLOSEvent*) data);
+			}
+			case EVENT_ENEMY_ENTER_LOS: {
+				e = new CAIEnemyEnterLOSEvent(*((const SEnemyEnterLOSEvent*) data));
 				break;
-			case EVENT_ENEMY_ENTER_RADAR:
-				e = new CAIEnemyEnterRadarEvent((const SEnemyEnterRadarEvent*) data);
+			}
+			case EVENT_ENEMY_LEAVE_LOS: {
+				e = new CAIEnemyLeaveLOSEvent(*((const SEnemyLeaveLOSEvent*) data));
 				break;
-			case EVENT_ENEMY_LEAVE_RADAR:
-				e = new CAIEnemyLeaveRadarEvent((const SEnemyLeaveRadarEvent*) data);
+			}
+			case EVENT_ENEMY_ENTER_RADAR: {
+				e = new CAIEnemyEnterRadarEvent(*((const SEnemyEnterRadarEvent*) data));
 				break;
-			case EVENT_ENEMY_DAMAGED:
-				e = new CAIEnemyDamagedEvent((const SEnemyDamagedEvent*) data);
+			}
+			case EVENT_ENEMY_LEAVE_RADAR: {
+				e = new CAIEnemyLeaveRadarEvent(*((const SEnemyLeaveRadarEvent*) data));
 				break;
-			case EVENT_ENEMY_DESTROYED: 
-				e = new CAIEnemyDestroyedEvent((const SEnemyDestroyedEvent*) data);
+			}
+			case EVENT_ENEMY_DAMAGED: {
+				e = new CAIEnemyDamagedEvent(*((const SEnemyDamagedEvent*) data));
 				break;
-			case EVENT_WEAPON_FIRED: 
-				e = new CAIWeaponFiredEvent((const SWeaponFiredEvent*) data);
+			}
+			case EVENT_ENEMY_DESTROYED: {
+				e = new CAIEnemyDestroyedEvent(*((const SEnemyDestroyedEvent*) data));
 				break;
-			case EVENT_PLAYER_COMMAND: 
-				e = new CAIPlayerCommandEvent((const SPlayerCommandEvent*) data);
+			}
+			case EVENT_WEAPON_FIRED:{
+				e = new CAIWeaponFiredEvent(*((const SWeaponFiredEvent*) data));
 				break;
-			case EVENT_SEISMIC_PING: 
-				e = new CAISeismicPingEvent((const SSeismicPingEvent*) data);
+			}
+			case EVENT_PLAYER_COMMAND:  {
+				e = new CAIPlayerCommandEvent(*((const SPlayerCommandEvent*) data));
 				break;
-			default:
+			}
+			case EVENT_SEISMIC_PING:{
+				e = new CAISeismicPingEvent(*((const SSeismicPingEvent*) data));
+				break;
+			}
+			default: {
 				e = new CAINullEvent();
 				break;
+			}
 		}
 
-		e-&gt;run(ai);
+		e-&gt;Run(*ai, wrappedGlobalAICallback);
 		delete e;
 	}
 

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyDamagedEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyDamagedEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyDamagedEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIENEMYDAMAGEDEVENT_H
+#define _AIENEMYDAMAGEDEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIEnemyDamagedEvent : public CAIEvent {
 public:
-    CAIEnemyDamagedEvent(const SEnemyDamagedEvent* event): event(*event) {}
-    ~CAIEnemyDamagedEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;EnemyDamaged(event.enemy, event.attacker, event.damage, event.dir);
-    }
+    CAIEnemyDamagedEvent(const SEnemyDamagedEvent&amp; event) : event(event) {}
+	~CAIEnemyDamagedEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.EnemyDamaged(event.enemy, event.attacker, event.damage, event.dir);
+	}
+
 private:
     SEnemyDamagedEvent event;
 };
+
+#endif // _AIENEMYDAMAGEDEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyDestroyedEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyDestroyedEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyDestroyedEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIENEMYDESTROYEDEVENT_H
+#define _AIENEMYDESTROYEDEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIEnemyDestroyedEvent : public CAIEvent {
 public:
-    CAIEnemyDestroyedEvent(const SEnemyDestroyedEvent* event): event(*event) {}
-    ~CAIEnemyDestroyedEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;EnemyDestroyed(event.enemy, event.attacker);
-    }
+    CAIEnemyDestroyedEvent(const SEnemyDestroyedEvent&amp; event) : event(event) {}
+	~CAIEnemyDestroyedEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.EnemyDestroyed(event.enemy, event.attacker);
+	}
+
 private:
     SEnemyDestroyedEvent event;
 };
+
+#endif // _AIENEMYDESTROYEDEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyEnterLOSEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyEnterLOSEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyEnterLOSEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIENEMYENTERLOSEVENT_H
+#define _AIENEMYENTERLOSEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIEnemyEnterLOSEvent : public CAIEvent {
 public:
-    CAIEnemyEnterLOSEvent(const SEnemyEnterLOSEvent* event): event(*event) {}
-    ~CAIEnemyEnterLOSEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;EnemyEnterLOS(event.enemy);
-    }
+    CAIEnemyEnterLOSEvent(const SEnemyEnterLOSEvent&amp; event) : event(event) {}
+	~CAIEnemyEnterLOSEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.EnemyEnterLOS(event.enemy);
+	}
+
 private:
     SEnemyEnterLOSEvent event;
 };
+
+#endif // _AIENEMYENTERLOSEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyEnterRadarEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyEnterRadarEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyEnterRadarEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,28 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIENEMYENTERRADAREVENT_H
+#define _AIENEMYENTERRADAREVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIEnemyEnterRadarEvent : public CAIEvent {
 public:
-    CAIEnemyEnterRadarEvent(const SEnemyEnterRadarEvent* event): event(*event) {}
-    ~CAIEnemyEnterRadarEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;EnemyEnterRadar(event.enemy);
-    }
+    CAIEnemyEnterRadarEvent(const SEnemyEnterRadarEvent&amp; event)
+			: event(event) {}
+	~CAIEnemyEnterRadarEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.EnemyEnterRadar(event.enemy);
+	}
+
 private:
     SEnemyEnterRadarEvent event;
 };
+
+#endif // _AIENEMYENTERRADAREVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyLeaveLOSEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyLeaveLOSEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyLeaveLOSEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIENEMYLEAVELOSEVENT_H
+#define _AIENEMYLEAVELOSEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIEnemyLeaveLOSEvent : public CAIEvent {
 public:
-    CAIEnemyLeaveLOSEvent(const SEnemyLeaveLOSEvent* event): event(*event) {}
-    ~CAIEnemyLeaveLOSEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;EnemyLeaveLOS(event.enemy);
-    }
+    CAIEnemyLeaveLOSEvent(const SEnemyLeaveLOSEvent&amp; event) : event(event) {}
+	~CAIEnemyLeaveLOSEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.EnemyLeaveLOS(event.enemy);
+	}
+
 private:
     SEnemyLeaveLOSEvent event;
 };
+
+#endif // _AIENEMYLEAVELOSEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyLeaveRadarEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyLeaveRadarEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEnemyLeaveRadarEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,28 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIENEMYLEAVERADAREVENT_H
+#define _AIENEMYLEAVERADAREVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIEnemyLeaveRadarEvent : public CAIEvent {
 public:
-    CAIEnemyLeaveRadarEvent(const SEnemyLeaveRadarEvent* event): event(*event) {}
-    ~CAIEnemyLeaveRadarEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;EnemyLeaveRadar(event.enemy);
-    }
+    CAIEnemyLeaveRadarEvent(const SEnemyLeaveRadarEvent&amp; event)
+			: event(event) {}
+	~CAIEnemyLeaveRadarEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.EnemyLeaveRadar(event.enemy);
+	}
+
 private:
     SEnemyLeaveRadarEvent event;
 };
+
+#endif // _AIENEMYLEAVERADAREVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,12 +13,22 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIEVENT_H
+#define _AIEVENT_H
+
 #include &quot;ExternalAI/IGlobalAI.h&quot;
+#include &quot;ExternalAI/IGlobalAICallback.h&quot;
 
 class CAIEvent {
 public:
-    
-    virtual void run(IGlobalAI* ai) = 0;
+
+    virtual void Run(IGlobalAI&amp; ai,
+			IGlobalAICallback* globalAICallback = NULL) = 0;
 };
+
+#endif // _AIEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEvents.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEvents.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIEvents.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,12 +13,14 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIEVENTS_H
+#define _AIEVENTS_H
 
-#ifndef AIEVENTS_H
-#define AIEVENTS_H
-
 #include &quot;../AI.h&quot;
 #include &quot;../AIGlobalAI.h&quot;
 
@@ -30,6 +32,7 @@
 #include &quot;AINullEvent.h&quot;
 
 #include &quot;AIInitEvent.h&quot;
+#include &quot;AIReleaseEvent.h&quot;
 #include &quot;AIUpdateEvent.h&quot;
 
 #include &quot;AIMessageEvent.h&quot;
@@ -54,4 +57,4 @@
 #include &quot;AIPlayerCommandEvent.h&quot;
 #include &quot;AISeismicPingEvent.h&quot;
 
-#endif /*AIEVENTS_H*/
+#endif // _AIEVENTS_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIInitEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIInitEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIInitEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,22 +13,41 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIINITEVENT_H
+#define _AIINITEVENT_H
+
+#include &quot;AIEvent.h&quot;
 #include &quot;ExternalAI/IGlobalAICallback.h&quot;
 #include &quot;../AIGlobalAICallback.h&quot;
 
 class CAIInitEvent : public CAIEvent {
 public:
-    CAIInitEvent(const SInitEvent* event): event(*event) {}
-    ~CAIInitEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        //((CAIGlobalAI*) ai)-&gt;gai-&gt;InitAI(event.callback, event.team);
-        //((CAIGlobalAI*) ai)-&gt;InitAI(event.c_callback, event.team, event.callback);
-        IGlobalAICallback* wrappedGlobalAICallback = new CAIGlobalAICallback(event.callback, event.team);
-        ai-&gt;InitAI(wrappedGlobalAICallback, event.team);
-    }
+	CAIInitEvent(const SInitEvent&amp; event)
+			: event(event), wrappedGlobalAICallback(NULL) {}
+	~CAIInitEvent() {
+		// do not delete wrappedGlobalAICallback here.
+		// it should be deleted in AI.cpp
+	}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+
+	    wrappedGlobalAICallback
+				= new CAIGlobalAICallback(event.callback, event.team);
+	    ai.InitAI(wrappedGlobalAICallback, event.team);
+	}
+
+    IGlobalAICallback* GetWrappedGlobalAICallback() {
+	    return wrappedGlobalAICallback;
+	}
+
 private:
     SInitEvent event;
+    IGlobalAICallback* wrappedGlobalAICallback;
 };
+
+#endif // _AIINITEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIMessageEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIMessageEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIMessageEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIMESSAGEEVENT_H
+#define	_AIMESSAGEEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIMessageEvent : public CAIEvent {
 public:
-    CAIMessageEvent(const SMessageEvent* event): event(*event) {}
-    ~CAIMessageEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;GotChatMsg(event.message, event.player);
-    }
+    CAIMessageEvent(const SMessageEvent&amp; event) : event(event) {}
+	~CAIMessageEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.GotChatMsg(event.message, event.player);
+	}
+
 private:
     SMessageEvent event;
 };
+
+#endif // _AIMESSAGEEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AINullEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AINullEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AINullEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,11 +13,21 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AINULLEVENT_H
+#define	_AINULLEVENT_H
+
+#include &quot;AIEvent.h&quot;
+
 class CAINullEvent : public CAIEvent {
 public:
     CAINullEvent() {}
-    ~CAINullEvent() {}
-    void run(IGlobalAI* ai) {}
+	~CAINullEvent() {}
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {}
 };
+
+#endif // _AINULLEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIPlayerCommandEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIPlayerCommandEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIPlayerCommandEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -13,33 +13,37 @@
 
 	You should have received a copy of the GNU General Public License
 	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
 #ifndef _AIPLAYERCOMMANDEVENT_H
 #define	_AIPLAYERCOMMANDEVENT_H
 
+#include &quot;AIEvent.h&quot;
 #include &quot;ExternalAI/Interface/AISCommands.h&quot;
 
 class CAIPlayerCommandEvent : public CAIEvent {
 public:
-    CAIPlayerCommandEvent(const SPlayerCommandEvent* event): event(*event) {}
-    ~CAIPlayerCommandEvent() {}
-    
-    void run(IGlobalAI* ai) {
+    CAIPlayerCommandEvent(const SPlayerCommandEvent&amp; event) : event(event) {}
+	~CAIPlayerCommandEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
 		int evtId = AI_EVENT_PLAYER_COMMAND;
 		std::vector&lt;int&gt; unitIds;
 		int i;
 		for (i=0; i &lt; event.numUnitIds; i++) {
-            unitIds.push_back(event.unitIds[i]);
-        }
-		Command* c = (Command*) newCommand(event.commandData, event.commandTopic);
+		    unitIds.push_back(event.unitIds[i]);
+		}
+		Command* c = (Command*) newCommand(event.commandData,
+				event.commandTopic);
 		IGlobalAI::PlayerCommandEvent evt = {unitIds, *c, event.playerId};
-        ai-&gt;HandleEvent(evtId, &amp;evt);
+	    ai.HandleEvent(evtId, &amp;evt);
 		delete c;
-    }
+	}
+
 private:
     SPlayerCommandEvent event;
 };
 
-#endif	/* _AIPLAYERCOMMANDEVENT_H */
-
+#endif // _AIPLAYERCOMMANDEVENT_H

Added: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIReleaseEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIReleaseEvent.h	                        (rev 0)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIReleaseEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -0,0 +1,41 @@
+/*
+    Copyright 2008  Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+*/
+
+#ifndef _AIRELEASEEVENT_H
+#define _AIRELEASEEVENT_H
+
+#include &quot;AIEvent.h&quot;
+
+class CAIReleaseEvent : public CAIEvent {
+public:
+	CAIReleaseEvent(const SReleaseEvent&amp; event) : event(event) {}
+	~CAIReleaseEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+
+	    // As the Release method does not exist in IGlobalAI,
+		// we can not call it.
+	    //ai.ReleaseAI();
+	}
+
+private:
+    SReleaseEvent event;
+};
+
+#endif // _AIRELEASEEVENT_H


Property changes on: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIReleaseEvent.h
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AISeismicPingEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AISeismicPingEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AISeismicPingEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -13,24 +13,28 @@
 
 	You should have received a copy of the GNU General Public License
 	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
 #ifndef _AISEISMICPINGEVENT_H
 #define	_AISEISMICPINGEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAISeismicPingEvent : public CAIEvent {
 public:
-    CAISeismicPingEvent(const SSeismicPingEvent* event): event(*event) {}
-    ~CAISeismicPingEvent() {}
-    
-    void run(IGlobalAI* ai) {
+    CAISeismicPingEvent(const SSeismicPingEvent&amp; event) : event(event) {}
+	~CAISeismicPingEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
 		int evtId = AI_EVENT_SEISMIC_PING;
 		IGlobalAI::SeismicPingEvent evt = {float3(event.pos), event.strength};
-        ai-&gt;HandleEvent(evtId, &amp;evt);
-    }
+	    ai.HandleEvent(evtId, &amp;evt);
+	}
+
 private:
     SSeismicPingEvent event;
 };
 
-#endif	/* _AISEISMICPINGEVENT_H */
-
+#endif // _AISEISMICPINGEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitCapturedEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitCapturedEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitCapturedEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -13,24 +13,29 @@
 
 	You should have received a copy of the GNU General Public License
 	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
 #ifndef _AIUNITCAPTUREDEVENT_H
 #define	_AIUNITCAPTUREDEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIUnitCapturedEvent : public CAIEvent {
 public:
-    CAIUnitCapturedEvent(const SUnitCapturedEvent* event): event(*event) {}
-    ~CAIUnitCapturedEvent() {}
-    
-    void run(IGlobalAI* ai) {
+    CAIUnitCapturedEvent(const SUnitCapturedEvent&amp; event) : event(event) {}
+	~CAIUnitCapturedEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
 		int evtId = AI_EVENT_UNITCAPTURED;
-		IGlobalAI::ChangeTeamEvent evt = {event.unitId, event.newTeamId, event.oldTeamId};
-        ai-&gt;HandleEvent(evtId, &amp;evt);
-    }
+		IGlobalAI::ChangeTeamEvent evt = {event.unitId, event.newTeamId,
+				event.oldTeamId};
+	    ai.HandleEvent(evtId, &amp;evt);
+	}
+
 private:
     SUnitCapturedEvent event;
 };
 
-#endif	/* _AIUNITCAPTUREDEVENT_H */
-
+#endif // _AIUNITCAPTUREDEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitCreatedEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitCreatedEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitCreatedEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIUNITCREATEDEVENT_H
+#define	_AIUNITCREATEDEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIUnitCreatedEvent : public CAIEvent {
 public:
-    CAIUnitCreatedEvent(const SUnitCreatedEvent* event): event(*event) {}
-    ~CAIUnitCreatedEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;UnitCreated(event.unit);
-    }
+    CAIUnitCreatedEvent(const SUnitCreatedEvent&amp; event) : event(event) {}
+	~CAIUnitCreatedEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.UnitCreated(event.unit);
+	}
+
 private:
     SUnitCreatedEvent event;
 };
+
+#endif // _AIUNITCREATEDEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitDamagedEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitDamagedEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitDamagedEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIUNITDAMAGEDEVENT_H
+#define	_AIUNITDAMAGEDEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIUnitDamagedEvent : public CAIEvent {
 public:
-    CAIUnitDamagedEvent(const SUnitDamagedEvent* event): event(*event) {}
-    ~CAIUnitDamagedEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;UnitDamaged(event.unit, event.attacker, event.damage, event.dir);
-    }
+    CAIUnitDamagedEvent(const SUnitDamagedEvent&amp; event) : event(event) {}
+	~CAIUnitDamagedEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.UnitDamaged(event.unit, event.attacker, event.damage, event.dir);
+	}
+
 private:
     SUnitDamagedEvent event;
 };
+
+#endif // _AIUNITDAMAGEDEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitDestroyedEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitDestroyedEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitDestroyedEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIUNITDESTROYEDEVENT_H
+#define	_AIUNITDESTROYEDEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIUnitDestroyedEvent : public CAIEvent {
 public:
-    CAIUnitDestroyedEvent(const SUnitDestroyedEvent* event): event(*event) {}
-    ~CAIUnitDestroyedEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;UnitDestroyed(event.unit, event.attacker);
-    }
+    CAIUnitDestroyedEvent(const SUnitDestroyedEvent&amp; event) : event(event) {}
+	~CAIUnitDestroyedEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.UnitDestroyed(event.unit, event.attacker);
+	}
+
 private:
     SUnitDestroyedEvent event;
 };
+
+#endif // _AIUNITDESTROYEDEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitFinishedEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitFinishedEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitFinishedEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIUNITFINISHEDEVENT_H
+#define	_AIUNITFINISHEDEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIUnitFinishedEvent : public CAIEvent {
 public:
-    CAIUnitFinishedEvent(const SUnitFinishedEvent* event): event(*event) {}
-    ~CAIUnitFinishedEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;UnitFinished(event.unit);
-    }
+    CAIUnitFinishedEvent(const SUnitFinishedEvent&amp; event) : event(event) {}
+	~CAIUnitFinishedEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.UnitFinished(event.unit);
+	}
+
 private:
     SUnitFinishedEvent event;
 };
+
+#endif // _AIUNITFINISHEDEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitGivenEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitGivenEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitGivenEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -13,24 +13,29 @@
 
 	You should have received a copy of the GNU General Public License
 	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
 #ifndef _AIUNITGIVENEVENT_H
 #define	_AIUNITGIVENEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIUnitGivenEvent : public CAIEvent {
 public:
-    CAIUnitGivenEvent(const SUnitGivenEvent* event): event(*event) {}
-    ~CAIUnitGivenEvent() {}
-    
-    void run(IGlobalAI* ai) {
+    CAIUnitGivenEvent(const SUnitGivenEvent&amp; event) : event(event) {}
+	~CAIUnitGivenEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
 		int evtId = AI_EVENT_UNITGIVEN;
-		IGlobalAI::ChangeTeamEvent evt = {event.unitId, event.newTeamId, event.oldTeamId};
-        ai-&gt;HandleEvent(evtId, &amp;evt);
-    }
+		IGlobalAI::ChangeTeamEvent evt = {event.unitId, event.newTeamId,
+				event.oldTeamId};
+	    ai.HandleEvent(evtId, &amp;evt);
+	}
+
 private:
     SUnitGivenEvent event;
 };
 
-#endif	/* _AIUNITGIVENEVENT_H */
-
+#endif // _AIUNITGIVENEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitIdleEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitIdleEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitIdleEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIUNITIDLEEVENT_H
+#define	_AIUNITIDLEEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIUnitIdleEvent : public CAIEvent {
 public:
-    CAIUnitIdleEvent(const SUnitIdleEvent* event): event(*event) {}
-    ~CAIUnitIdleEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;UnitIdle(event.unit);
-    }
+    CAIUnitIdleEvent(const SUnitIdleEvent&amp; event) : event(event) {}
+	~CAIUnitIdleEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.UnitIdle(event.unit);
+	}
+
 private:
     SUnitIdleEvent event;
 };
+
+#endif // _AIUNITIDLEEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitMoveFailedEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitMoveFailedEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUnitMoveFailedEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,18 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
-//#include &quot;AIEvent.h&quot;
+#ifndef _AIUNITMOVEFAILEDEVENT_H
+#define	_AIUNITMOVEFAILEDEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIUnitMoveFailedEvent : public CAIEvent {
 public:
-    CAIUnitMoveFailedEvent(const SUnitMoveFailedEvent* event): event(*event) {}
-    ~CAIUnitMoveFailedEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;UnitMoveFailed(event.unit);
-    }
+    CAIUnitMoveFailedEvent(const SUnitMoveFailedEvent&amp; event) : event(event) {}
+	~CAIUnitMoveFailedEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.UnitMoveFailed(event.unit);
+	}
+
 private:
     SUnitMoveFailedEvent event;
 };
+
+#endif // _AIUNITMOVEFAILEDEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUpdateEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUpdateEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIUpdateEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,10 +1,10 @@
 /*
     Copyright 2008  Nicolas Wu
-    
+
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	(at your option) any later version.
 
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -13,17 +13,27 @@
 
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
+#ifndef _AIUPDATEEVENT_H
+#define	_AIUPDATEEVENT_H
 
+#include &quot;AIEvent.h&quot;
+
 class CAIUpdateEvent : public CAIEvent {
 public:
-    CAIUpdateEvent(const SUpdateEvent* event): event(*event) {}
-    ~CAIUpdateEvent() {}
-    
-    void run(IGlobalAI* ai) {
-        ai-&gt;Update();
-    }
+    CAIUpdateEvent(const SUpdateEvent&amp; event) : event(event) {}
+	~CAIUpdateEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
+	    ai.Update();
+	}
+
 private:
     SUpdateEvent event;
 };
+
+#endif // _AIUPDATEEVENT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIWeaponFiredEvent.h
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIWeaponFiredEvent.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/Event/AIWeaponFiredEvent.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -13,28 +13,47 @@
 
 	You should have received a copy of the GNU General Public License
 	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
 
 #ifndef _AIWEAPONFIREDEVENT_H
 #define	_AIWEAPONFIREDEVENT_H
 
+#include &quot;AIEvent.h&quot;
+#include &quot;ExternalAI/IAICallback.h&quot;
+
 class CAIWeaponFiredEvent : public CAIEvent {
 public:
-    CAIWeaponFiredEvent(const SWeaponFiredEvent* event): event(*event) {}
-    ~CAIWeaponFiredEvent() {}
-    
-    void run(IGlobalAI* ai) {
+    CAIWeaponFiredEvent(const SWeaponFiredEvent&amp; event) : event(event) {}
+	~CAIWeaponFiredEvent() {}
+
+    void Run(IGlobalAI&amp; ai, IGlobalAICallback* globalAICallback = NULL) {
 		int evtId = AI_EVENT_WEAPON_FIRED;
-		//TODO: maybe: retrieve a WeaponDef that contains all attributes
-		// as thisone contians only the correct id
-		WeaponDef weaponDef;
-		weaponDef.id = event.weaponDefId;
-		IGlobalAI::WeaponFireEvent evt = {event.unitId, &amp;weaponDef};
-        ai-&gt;HandleEvent(evtId, &amp;evt);
-    }
+
+		WeaponDef* weaponDef = NULL;
+		if (globalAICallback) {
+			AIHCGetWeaponDefById fetchCmd = {event.weaponDefId, weaponDef};
+			int ret = globalAICallback-&gt;GetAICallback()
+					-&gt;HandleCommand(AIHCGetWeaponDefByIdId, &amp;fetchCmd);
+			if (ret != 1) {
+				weaponDef = NULL;
+			}
+		}
+		if (weaponDef == NULL) {
+			weaponDef = new WeaponDef();
+			weaponDef-&gt;id = event.weaponDefId;
+		}
+
+		IGlobalAI::WeaponFireEvent evt = {event.unitId, weaponDef};
+	    ai.HandleEvent(evtId, &amp;evt);
+
+		delete weaponDef;
+		weaponDef = NULL;
+	}
+
 private:
     SWeaponFiredEvent event;
 };
 
-#endif	/* _AIWEAPONFIREDEVENT_H */
-
+#endif // _AIWEAPONFIREDEVENT_H

Modified: branches/caiinterface/SConstruct
===================================================================
--- branches/caiinterface/SConstruct	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/SConstruct	2008-12-19 13:10:53 UTC (rev 7201)
@@ -278,7 +278,7 @@
 javaInterfaceJar = ''
 for baseName in filelist.list_AIInterfaces(aiinterfaceenv, exclude_list=aiinterfaces_exclude_list):
 	aiInterfaceVersion = fetch_ai_version(baseName, 'Interfaces')
-	print &quot;AI Interface: &quot; + baseName + &quot; v&quot; + aiInterfaceVersion
+	print &quot;Found AI Interface: &quot; + baseName + &quot; &quot; + aiInterfaceVersion
 	myEnv = aiinterfaceenv.Clone()
 	install_data_interface_dir = os.path.join(install_aiinterfaces_dir, baseName, aiInterfaceVersion)
 	instList = []
@@ -368,7 +368,7 @@
 skirmishai_isJava_list=['NullJavaAI', 'NullOOJavaAI']
 for baseName in filelist.list_skirmishAIs(skirmishaienv, exclude_list=skirmishai_exclude_list):
 	aiVersion = fetch_ai_version(baseName, 'Skirmish')
-	print &quot;Skirmish AI: &quot; + baseName + &quot; v&quot; + aiVersion
+	print &quot;Found Skirmish AI: &quot; + baseName + &quot; &quot; + aiVersion
 	isLegacyCpp = baseName in skirmishai_isLegacyCpp_list
 	useCreg = baseName in skirmishai_needCreg_list
 	isJava = baseName in skirmishai_isJava_list

Modified: branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h	2008-12-19 13:10:53 UTC (rev 7201)
@@ -63,8 +63,6 @@
 struct SInitEvent {
 	int team;
 	struct SAICallback* callback;
-//	unsigned int sizeInfo;
-//	const struct InfoItem* info;
 	unsigned int infoSize;
 	const char** infoKeys;
 	const char** infoValues;

Modified: branches/caiinterface/rts/build/cmake/FindJAVA.cmake
===================================================================
--- branches/caiinterface/rts/build/cmake/FindJAVA.cmake	2008-12-19 10:19:31 UTC (rev 7200)
+++ branches/caiinterface/rts/build/cmake/FindJAVA.cmake	2008-12-19 13:10:53 UTC (rev 7201)
@@ -26,215 +26,216 @@
 MARK_AS_ADVANCED( JAVA_FOUND )
 
 IF( NOT DEFINED ENV{JDK_HOME} AND 
-    NOT DEFINED ENV{JAVA_HOME} AND
-    NOT DEFINED JAVA_HOME AND
-    NOT DEFINED JDK_HOME )
+	NOT DEFINED ENV{JAVA_HOME} AND
+	NOT DEFINED JAVA_HOME AND
+	NOT DEFINED JDK_HOME )
 
-    IF( NOT JAVA_FIND_QUIETLY )
-        MESSAGE( STATUS &quot;Autodetecting Java...&quot; )
-    ENDIF()
-    
-    # use the CMake FindJava.cmake module
-    FIND_PACKAGE( Java )
-    
-    IF( JAVA_RUNTIME AND JAVA_COMPILE AND JAVA_ARCHIVE )
-        IF( UNIX AND NOT APPLE )
-            # look for the file binary
-            FIND_PROGRAM( FILE_BIN
-                file
-                /bin
-                /usr/bin
-                /usr/local/bin
-                /sbin
-            )
-            MARK_AS_ADVANCED( FILE_BIN )
-            
-            IF( FILE_BIN )
+	IF( NOT JAVA_FIND_QUIETLY )
+		MESSAGE( STATUS &quot;Autodetecting Java...&quot; )
+	ENDIF()
 
-                # initialize some variables
-                SET( java_bin &quot;${JAVA_RUNTIME}&quot; )
-                SET( java_link_found TRUE )
-                SET( java_link_error FALSE )
-                MARK_AS_ADVANCED( java_bin java_link_found java_link_error )
+	# use the CMake FindJava.cmake module
+	FIND_PACKAGE( Java )
 
-                # dereference links
-                WHILE( java_link_found AND NOT java_link_error )
-                    # check if the java binary is a symbolic link
-                    EXEC_PROGRAM( ${FILE_BIN} ARGS &quot;${java_bin}&quot;
-                        OUTPUT_VARIABLE out_tmp
-                        RETURN_VALUE out_ret )
-                    IF( out_ret )
-                        IF( NOT JAVA_FIND_QUIETLY )
-                            MESSAGE( STATUS &quot;Error dereferencing links to Java Home!!&quot; )
-                            MESSAGE( STATUS &quot;${out_tmp}&quot; )
-                        ENDIF()
-                        SET( java_link_error TRUE )
-                    ENDIF()
-                    IF( NOT java_link_error )
-                        # set variable if link is found
-                        STRING( REGEX MATCH &quot; symbolic link to &quot; java_link_found &quot;${out_tmp}&quot; )
-                        IF( java_link_found )
-                            # get the file to where the link points to
-                            STRING( REGEX REPLACE &quot;.* symbolic link to[^/]+([^'`&#180;]+).*&quot; &quot;\\1&quot; out_regex &quot;${out_tmp}&quot; )
-                            IF( NOT JAVA_FIND_QUIETLY )
-                                MESSAGE( STATUS &quot;Java binary ${java_bin} is a symbolic link to ${out_regex}&quot; )
-                            ENDIF()
-                            SET( java_bin &quot;${out_regex}&quot; )
-                        ENDIF()
-                    ENDIF()
-                ENDWHILE()
+	IF( JAVA_RUNTIME AND JAVA_COMPILE AND JAVA_ARCHIVE )
+		IF( UNIX AND NOT APPLE )
+			# look for the file binary
+			FIND_PROGRAM( FILE_BIN
+				file
+				/bin
+				/usr/bin
+				/usr/local/bin
+				/sbin
+			)
+			MARK_AS_ADVANCED( FILE_BIN )
 
-                # check if something went wrong
-                IF( NOT java_link_error )
-                    # if not set JAVA_RUNTIME to the dereferenced link
-                    SET( JAVA_RUNTIME &quot;${java_bin}&quot; )
-                ENDIF()
-            ENDIF()
-        ENDIF()
-        
-        # extract java home path out of full path to java runtime
-        STRING( REGEX REPLACE &quot;(.*)\\/[^/]+\\/java$&quot; &quot;\\1&quot; JAVA_HOME ${JAVA_RUNTIME} )
-        # extract java bin path out of full path to java runtime
-        STRING( REGEX REPLACE &quot;(.*)\\/java$&quot; &quot;\\1&quot; JAVA_BIN_PATH ${JAVA_RUNTIME} )
-    ELSE()
-        IF( NOT JAVA_FIND_QUIETLY )
-            MESSAGE( STATUS &quot;Failed to autodetect Java!!&quot; )
-        ENDIF()
-    ENDIF()
+			IF( FILE_BIN )
+
+				# initialize some variables
+				SET( java_bin &quot;${JAVA_RUNTIME}&quot; )
+				SET( java_link_found TRUE )
+				SET( java_link_error FALSE )
+				MARK_AS_ADVANCED( java_bin java_link_found java_link_error )
+
+				# dereference links
+				WHILE( java_link_found AND NOT java_link_error )
+					# check if the java binary is a symbolic link
+					EXEC_PROGRAM( ${FILE_BIN} ARGS &quot;${java_bin}&quot;
+						OUTPUT_VARIABLE out_tmp
+						RETURN_VALUE out_ret )
+					IF( out_ret )
+						IF( NOT JAVA_FIND_QUIETLY )
+							MESSAGE( STATUS &quot;Error dereferencing links to Java Home!!&quot; )
+							MESSAGE( STATUS &quot;${out_tmp}&quot; )
+						ENDIF()
+						SET( java_link_error TRUE )
+					ENDIF()
+					IF( NOT java_link_error )
+						# set variable if link is found
+						STRING( REGEX MATCH &quot; symbolic link to &quot; java_link_found &quot;${out_tmp}&quot; )
+						IF( java_link_found )
+							# get the file to where the link points to
+							STRING( REGEX REPLACE &quot;.* symbolic link to[^/]+([^'`&#180;]+).*&quot; &quot;\\1&quot; out_regex &quot;${out_tmp}&quot; )
+							IF( NOT JAVA_FIND_QUIETLY )
+								MESSAGE( STATUS &quot;Java binary ${java_bin} is a symbolic link to ${out_regex}&quot; )
+							ENDIF()
+							SET( java_bin &quot;${out_regex}&quot; )
+						ENDIF()
+					ENDIF()
+				ENDWHILE()
+
+				# check if something went wrong
+				IF( NOT java_link_error )
+					# if not set JAVA_RUNTIME to the dereferenced link
+					SET( JAVA_RUNTIME &quot;${java_bin}&quot; )
+				ENDIF()
+			ENDIF()
+		ENDIF()
+
+		# extract java home path out of full path to java runtime
+		STRING( REGEX REPLACE &quot;(.*)\\/[^/]+\\/java$&quot; &quot;\\1&quot; JAVA_HOME ${JAVA_RUNTIME} )
+		# extract java bin path out of full path to java runtime
+		STRING( REGEX REPLACE &quot;(.*)\\/java$&quot; &quot;\\1&quot; JAVA_BIN_PATH ${JAVA_RUNTIME} )
+	ELSE()
+		IF( NOT JAVA_FIND_QUIETLY )
+			MESSAGE( STATUS &quot;Failed to autodetect Java!!&quot; )
+		ENDIF()
+	ENDIF()
 ELSE()
-    # definition of JAVA_HOME or JDK_HOME in cmake has priority over env vars
-    IF( DEFINED JDK_HOME OR DEFINED JAVA_HOME )
-        # ensure that both variables are set correctly (JDK_HOME as well as JAVA_HOME)
-        IF( DEFINED JDK_HOME AND DEFINED JAVA_HOME )
-            IF( NOT &quot;${JDK_HOME}&quot; STREQUAL &quot;${JAVA_HOME}&quot; )
-                IF( NOT JAVA_FIND_QUIETLY )
-                    MESSAGE( STATUS 
-                        &quot;WARNING: JDK_HOME and JAVA_HOME are set to different paths!!&quot; )
-                    MESSAGE( STATUS &quot;JDK_HOME: ${JDK_HOME}&quot; )
-                    MESSAGE( STATUS &quot;JAVA_HOME: ${JAVA_HOME}&quot; )
-                    MESSAGE( STATUS &quot;${JAVA_HOME} will be used in this installation!!&quot; )
-                ENDIF()
-            ENDIF()
-        ELSE()
-            IF( NOT DEFINED JAVA_HOME )
-                SET( JAVA_HOME &quot;${JDK_HOME}&quot; )
-            ENDIF()
-        ENDIF()
-    ELSE()
-        # in case JDK_HOME or JAVA_HOME already set ensure that both variables
-        # are set correctly (JDK_HOME as well as JAVA_HOME)
-        IF( DEFINED ENV{JDK_HOME} AND DEFINED ENV{JAVA_HOME} )
-            IF( NOT &quot;$ENV{JDK_HOME}&quot; STREQUAL &quot;$ENV{JAVA_HOME}&quot; )
-                IF( NOT JAVA_FIND_QUIETLY )
-                    MESSAGE( STATUS 
-                        &quot;WARNING: JDK_HOME and JAVA_HOME are set to different paths!!&quot; )
-                    MESSAGE( STATUS &quot;JDK_HOME: $ENV{JDK_HOME}&quot; )
-                    MESSAGE( STATUS &quot;JAVA_HOME: $ENV{JAVA_HOME}&quot; )
-                    MESSAGE( STATUS &quot;$ENV{JAVA_HOME} will be used in this installation!!&quot; )
-                ENDIF()
-            ENDIF()
-            SET( JAVA_HOME &quot;$ENV{JAVA_HOME}&quot; )
-        ELSE()
-            IF( DEFINED ENV{JAVA_HOME} )
-                SET( JAVA_HOME &quot;$ENV{JAVA_HOME}&quot; )
-            ENDIF()
-            IF( DEFINED ENV{JDK_HOME} )
-                SET( JAVA_HOME &quot;$ENV{JDK_HOME}&quot; )
-            ENDIF()
-        ENDIF()
-    ENDIF()
+	# definition of JAVA_HOME or JDK_HOME in cmake has priority over env vars
+	IF( DEFINED JDK_HOME OR DEFINED JAVA_HOME )
+		# ensure that both variables are set correctly (JDK_HOME as well as JAVA_HOME)
+		IF( DEFINED JDK_HOME AND DEFINED JAVA_HOME )
+			IF( NOT &quot;${JDK_HOME}&quot; STREQUAL &quot;${JAVA_HOME}&quot; )
+				IF( NOT JAVA_FIND_QUIETLY )
+					MESSAGE( STATUS
+						&quot;WARNING: JDK_HOME and JAVA_HOME are set to different paths!!&quot; )
+					MESSAGE( STATUS &quot;JDK_HOME: ${JDK_HOME}&quot; )
+					MESSAGE( STATUS &quot;JAVA_HOME: ${JAVA_HOME}&quot; )
+					MESSAGE( STATUS &quot;${JAVA_HOME} will be used in this installation!!&quot; )
+				ENDIF()
+			ENDIF()
+		ELSE()
+			IF( NOT DEFINED JAVA_HOME )
+				SET( JAVA_HOME &quot;${JDK_HOME}&quot; )
+			ENDIF()
+		ENDIF()
+	ELSE()
+		# in case JDK_HOME or JAVA_HOME already set ensure that both variables
+		# are set correctly (JDK_HOME as well as JAVA_HOME)
+		IF( DEFINED ENV{JDK_HOME} AND DEFINED ENV{JAVA_HOME} )
+			IF( NOT &quot;$ENV{JDK_HOME}&quot; STREQUAL &quot;$ENV{JAVA_HOME}&quot; )
+				IF( NOT JAVA_FIND_QUIETLY )
+					MESSAGE( STATUS
+						&quot;WARNING: JDK_HOME and JAVA_HOME are set to different paths!!&quot; )
+					MESSAGE( STATUS &quot;JDK_HOME: $ENV{JDK_HOME}&quot; )
+					MESSAGE( STATUS &quot;JAVA_HOME: $ENV{JAVA_HOME}&quot; )
+					MESSAGE( STATUS &quot;$ENV{JAVA_HOME} will be used in this installation!!&quot; )
+				ENDIF()
+			ENDIF()
+			SET( JAVA_HOME &quot;$ENV{JAVA_HOME}&quot; )
+		ELSE()
+			IF( DEFINED ENV{JAVA_HOME} )
+				SET( JAVA_HOME &quot;$ENV{JAVA_HOME}&quot; )
+			ENDIF()
+			IF( DEFINED ENV{JDK_HOME} )
+				SET( JAVA_HOME &quot;$ENV{JDK_HOME}&quot; )
+			ENDIF()
+		ENDIF()
+	ENDIF()
 
-    IF(WIN32)
-        SET(OS_BINARY_SUFFIX &quot;.exe&quot;)
-    ELSE(WIN32)
-        SET(OS_BINARY_SUFFIX &quot;&quot;)
-    ENDIF(WIN32)
-    SET( JAVA_BIN_PATH JAVA_BIN_PATH-NOTFOUND )
-    FIND_PATH(JAVA_BIN_PATH &quot;java${OS_BINARY_SUFFIX}&quot;
+	IF(WIN32)
+		SET(OS_BINARY_SUFFIX &quot;.exe&quot;)
+	ELSE(WIN32)
+		SET(OS_BINARY_SUFFIX &quot;&quot;)
+	ENDIF(WIN32)
+	SET( JAVA_BIN_PATH JAVA_BIN_PATH-NOTFOUND )
+	FIND_PATH(JAVA_BIN_PATH &quot;java${OS_BINARY_SUFFIX}&quot;
 	PATHS
-        &quot;${JAVA_HOME}/bin&quot;
-        &quot;${JAVA_HOME}/Commands&quot;   # FIXME MacOS
-        NO_DEFAULT_PATH )
-    
-    IF( NOT JAVA_BIN_PATH AND NOT JAVA_FIND_QUIETLY )
-        MESSAGE( STATUS &quot;${JAVA_HOME} is not a valid path for Java!!&quot; )
-    ENDIF()
+		&quot;${JAVA_HOME}/bin&quot;
+		&quot;${JAVA_HOME}/Commands&quot;   # FIXME MacOS
+		NO_DEFAULT_PATH )
 
-    IF( JAVA_BIN_PATH )
-        # find java, javac, jar and javadoc
-        SET( JAVA_RUNTIME JAVA_RUNTIME-NOTFOUND )
-        FIND_PROGRAM( JAVA_RUNTIME
-            java
-            ${JAVA_BIN_PATH}
-            NO_DEFAULT_PATH )
-      
-        SET( JAVA_COMPILE JAVA_COMPILE-NOTFOUND )
-        FIND_PROGRAM( JAVA_COMPILE
-            javac
-            ${JAVA_BIN_PATH}
-            NO_DEFAULT_PATH )
-        
-        SET( JAVA_ARCHIVE JAVA_ARCHIVE-NOTFOUND )
-        FIND_PROGRAM( JAVA_ARCHIVE
-            jar
-            ${JAVA_BIN_PATH}
-            NO_DEFAULT_PATH )
-         
-        SET( JAVA_DOC JAVA_DOC-NOTFOUND )
-        FIND_PROGRAM( JAVA_DOC
-            javadoc
-            ${JAVA_BIN_PATH}
-            NO_DEFAULT_PATH )
-        
-        # abort if not found
-        IF( NOT JAVA_RUNTIME AND NOT JAVA_FIND_QUIETLY )
-            MESSAGE( STATUS &quot;Could not find java!!&quot; )
-        ENDIF()
-        IF( NOT JAVA_COMPILE AND NOT JAVA_FIND_QUIETLY )
-            MESSAGE( STATUS &quot;Could not find javac!!&quot; )
-        ENDIF()
-        IF( NOT JAVA_ARCHIVE AND NOT JAVA_FIND_QUIETLY )
-            MESSAGE( STATUS &quot;Could not find jar!!&quot; )
-        ENDIF()
-        IF( NOT JAVA_DOC AND NOT JAVA_FIND_QUIETLY )
-            MESSAGE( STATUS &quot;Could not find javadoc!!&quot; )
-        ENDIF()
-    ENDIF()
+	IF( NOT JAVA_BIN_PATH AND NOT JAVA_FIND_QUIETLY )
+		MESSAGE( STATUS &quot;${JAVA_HOME} is not a valid path for Java!!&quot; )
+	ENDIF()
+
+	IF( JAVA_BIN_PATH )
+		# find java, javac, jar and javadoc
+		SET( JAVA_RUNTIME JAVA_RUNTIME-NOTFOUND )
+		FIND_PROGRAM( JAVA_RUNTIME
+			java
+			${JAVA_BIN_PATH}
+			NO_DEFAULT_PATH )
+
+		SET( JAVA_COMPILE JAVA_COMPILE-NOTFOUND )
+		FIND_PROGRAM( JAVA_COMPILE
+			javac
+			${JAVA_BIN_PATH}
+			NO_DEFAULT_PATH )
+
+		SET( JAVA_ARCHIVE JAVA_ARCHIVE-NOTFOUND )
+		FIND_PROGRAM( JAVA_ARCHIVE
+			jar
+			${JAVA_BIN_PATH}
+			NO_DEFAULT_PATH )
+
+		SET( JAVA_DOC JAVA_DOC-NOTFOUND )
+		FIND_PROGRAM( JAVA_DOC
+			javadoc
+			${JAVA_BIN_PATH}
+			NO_DEFAULT_PATH )
+
+		# abort if not found
+		IF( NOT JAVA_RUNTIME AND NOT JAVA_FIND_QUIETLY )
+			MESSAGE( STATUS &quot;Could not find java!!&quot; )
+		ENDIF()
+		IF( NOT JAVA_COMPILE AND NOT JAVA_FIND_QUIETLY )
+			MESSAGE( STATUS &quot;Could not find javac!!&quot; )
+		ENDIF()
+		IF( NOT JAVA_ARCHIVE AND NOT JAVA_FIND_QUIETLY )
+			MESSAGE( STATUS &quot;Could not find jar!!&quot; )
+		ENDIF()
+		IF( NOT JAVA_DOC AND NOT JAVA_FIND_QUIETLY )
+			MESSAGE( STATUS &quot;Could not find javadoc!!&quot; )
+		ENDIF()
+	ENDIF()
 ENDIF()
 
 IF( JAVA_RUNTIME AND JAVA_COMPILE AND JAVA_ARCHIVE )
-    
-    SET( JAVA_FOUND TRUE )
-    
-    # parse the output of java -version
-    EXEC_PROGRAM( &quot;${JAVA_RUNTIME}&quot; ARGS &quot;-version&quot;
-            OUTPUT_VARIABLE out_tmp
-            RETURN_VALUE out_ret )
 
-    IF( out_ret )
-        IF( NOT JAVA_FIND_QUIETLY )
-            MESSAGE( STATUS &quot;Error executing java -version!! Java version variables will not be set!!&quot; )
-        ENDIF()
-    ELSE()
-        # extract major/minor version and patch level from &quot;java -version&quot; output
-        STRING( REGEX REPLACE &quot;.* version \&quot;([0-9]+)\\.[0-9]+\\.[0-9]+.*&quot;
-                &quot;\\1&quot; JAVA_MAJOR_VERSION &quot;${out_tmp}&quot; )
-        STRING( REGEX REPLACE &quot;.* version \&quot;[0-9]+\\.([0-9]+)\\.[0-9]+.*&quot;
-                &quot;\\1&quot; JAVA_MINOR_VERSION &quot;${out_tmp}&quot; )
-        STRING( REGEX REPLACE &quot;.* version \&quot;[0-9]+\\.[0-9]+\\.([0-9]+).*&quot;
-                &quot;\\1&quot; JAVA_PATCH_LEVEL &quot;${out_tmp}&quot; )
+	SET( JAVA_FOUND TRUE )
 
-        SET( JAVA_VERSION &quot;${JAVA_MAJOR_VERSION}.${JAVA_MINOR_VERSION}.${JAVA_PATCH_LEVEL}&quot; )
+	# parse the output of java -version
+	EXEC_PROGRAM( &quot;${JAVA_RUNTIME}&quot; ARGS &quot;-version&quot;
+			OUTPUT_VARIABLE out_tmp
+			RETURN_VALUE out_ret )
 
-        # display info
-        MESSAGE( STATUS &quot;Java version ${JAVA_VERSION} configured successfully!&quot; )
-    ENDIF()
+	IF( out_ret )
+		IF( NOT JAVA_FIND_QUIETLY )
+			MESSAGE( STATUS &quot;Error executing java -version!! Java version variables will not be set!!&quot; )
+		ENDIF()
+	ELSE()
+		# extract major/minor version and patch level from &quot;java -version&quot; output
+		STRING( REGEX REPLACE &quot;.* version \&quot;([0-9]+)\\.[0-9]+\\.[0-9]+.*&quot;
+				&quot;\\1&quot; JAVA_MAJOR_VERSION &quot;${out_tmp}&quot; )
+		STRING( REGEX REPLACE &quot;.* version \&quot;[0-9]+\\.([0-9]+)\\.[0-9]+.*&quot;
+				&quot;\\1&quot; JAVA_MINOR_VERSION &quot;${out_tmp}&quot; )
+		STRING( REGEX REPLACE &quot;.* version \&quot;[0-9]+\\.[0-9]+\\.([0-9]+).*&quot;
+				&quot;\\1&quot; JAVA_PATCH_LEVEL &quot;${out_tmp}&quot; )
+
+		SET( JAVA_VERSION &quot;${JAVA_MAJOR_VERSION}.${JAVA_MINOR_VERSION}.${JAVA_PATCH_LEVEL}&quot; )
+
+		IF( NOT JAVA_FIND_QUIETLY )
+			MESSAGE( STATUS &quot;Java version ${JAVA_VERSION} configured successfully!&quot; )
+		ENDIF()
+	ENDIF()
 ELSE()
-    IF( JAVA_FIND_REQUIRED )
-        MESSAGE( FATAL_ERROR &quot;Failed configuring Java!!&quot; )
-    ENDIF()
-    IF( NOT JAVA_FIND_QUIETLY )
-        MESSAGE( STATUS &quot;Failed configuring Java!!&quot; )
-    ENDIF()
+	IF( JAVA_FIND_REQUIRED )
+		MESSAGE( FATAL_ERROR &quot;Failed configuring Java!!&quot; )
+	ENDIF()
+	IF( NOT JAVA_FIND_QUIETLY )
+		MESSAGE( STATUS &quot;Failed configuring Java!!&quot; )
+	ENDIF()
 ENDIF()
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001969.html">[Taspring-linux-commit] r7200 - in	branches/caiinterface/AI/Skirmish/NTai/AI/NTai: Core Helpers
</A></li>
	<LI>Next message: <A HREF="001971.html">[Taspring-linux-commit] r7202 -	trunk/installer/builddata/springcontent/shaders
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1970">[ date ]</a>
              <a href="thread.html#1970">[ thread ]</a>
              <a href="subject.html#1970">[ subject ]</a>
              <a href="author.html#1970">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
