<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7116 - in Lobby/TASClient: . Interface
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-December/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7116%20-%20in%20Lobby/TASClient%3A%20.%20Interface&In-Reply-To=%3C20081204131150.75517477A%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001884.html">
   <LINK REL="Next"  HREF="001886.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7116 - in Lobby/TASClient: . Interface</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7116%20-%20in%20Lobby/TASClient%3A%20.%20Interface&In-Reply-To=%3C20081204131150.75517477A%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r7116 - in Lobby/TASClient: . Interface">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Thu Dec  4 14:11:50 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001884.html">[Taspring-linux-commit] r7115 - in branches/caiinterface:	AI/Interfaces AI/Interfaces/C AI/Skirmish	AI/Wrappers/LegacyCpp rts/ExternalAI rts/ExternalAI/Interface	rts/Game rts/Game/StartScripts rts/Sim/Misc rts/System/Script	rts/build/cmake tools/unitsync
</A></li>
        <LI>Next message: <A HREF="001886.html">[Taspring-linux-commit] r7117 - in Lobby/springie: ModInfoBuilder	Springie Springie/PlanetWars Springie/autohost	Springie/client Springie/spring Springie/utils libs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1885">[ date ]</a>
              <a href="thread.html#1885">[ thread ]</a>
              <a href="subject.html#1885">[ subject ]</a>
              <a href="author.html#1885">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2008-12-04 14:11:49 +0100 (Thu, 04 Dec 2008)
New Revision: 7116

Modified:
   Lobby/TASClient/Interface/defaultCampaignSkin.html
   Lobby/TASClient/Interface/defaultMissionSkin.html
   Lobby/TASClient/Interface/skirmish.html
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/MenuFormUnit.dfm
   Lobby/TASClient/MenuFormUnit.pas
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.res
Log:
* glitch on the skirmish page fixed
* small fixes

Modified: Lobby/TASClient/Interface/defaultCampaignSkin.html
===================================================================
--- Lobby/TASClient/Interface/defaultCampaignSkin.html	2008-12-04 11:02:27 UTC (rev 7115)
+++ Lobby/TASClient/Interface/defaultCampaignSkin.html	2008-12-04 13:11:49 UTC (rev 7116)
@@ -1,6 +1,6 @@
 &lt;html&gt;
 &lt;head&gt;
-	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;../default.js&quot;&gt;&lt;/script&gt;
 	&lt;style type=&quot;text/css&quot;&gt;
 		@import &quot;../default.css&quot;;
 
@@ -17,7 +17,7 @@
 			[CampaignContent]
 		&lt;/div&gt;
 		&lt;div class=&quot;footer&quot;&gt;
-			&lt;a href=&quot;lobby:back&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:..\button.wav');&quot;&gt;Back&lt;/a&gt;
+			&lt;a href=&quot;lobby:back&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot;&gt;Back&lt;/a&gt;
 		&lt;/div&gt;
 	&lt;/div&gt;
 &lt;/body&gt;

Modified: Lobby/TASClient/Interface/defaultMissionSkin.html
===================================================================
--- Lobby/TASClient/Interface/defaultMissionSkin.html	2008-12-04 11:02:27 UTC (rev 7115)
+++ Lobby/TASClient/Interface/defaultMissionSkin.html	2008-12-04 13:11:49 UTC (rev 7116)
@@ -1,6 +1,6 @@
 &lt;html&gt;
 &lt;head&gt;
-	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;../default.js&quot;&gt;&lt;/script&gt;
 	&lt;style type=&quot;text/css&quot;&gt;
 		@import &quot;../default.css&quot;;
 
@@ -17,8 +17,8 @@
 			[CampaignContent]
 		&lt;/div&gt;
 		&lt;div class=&quot;footer&quot;&gt;
-			&lt;a href=&quot;lobby:back&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:..\button.wav');&quot;&gt;Back&lt;/a&gt;
-			&lt;a href=&quot;lobby:startmission:&quot; class=&quot;button&quot; style=&quot;float: right;margin-right:20px;&quot; onmouseover=&quot;sendData('playsound:..\button.wav');&quot;&gt;START&lt;/a&gt;
+			&lt;a href=&quot;lobby:back&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot;&gt;Back&lt;/a&gt;
+			&lt;a href=&quot;lobby:startmission:&quot; class=&quot;button&quot; style=&quot;float: right;margin-right:20px;&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot;&gt;START&lt;/a&gt;
 		&lt;/div&gt;
 	&lt;/div&gt;
 &lt;/body&gt;

Modified: Lobby/TASClient/Interface/skirmish.html
===================================================================
--- Lobby/TASClient/Interface/skirmish.html	2008-12-04 11:02:27 UTC (rev 7115)
+++ Lobby/TASClient/Interface/skirmish.html	2008-12-04 13:11:49 UTC (rev 7116)
@@ -451,6 +451,9 @@
 		&lt;/div&gt;
 		&lt;![endif]--&gt;
 	&lt;script type=&quot;text/javascript&quot;&gt;
+		// fix some glitches
+		debug('');
+		
 		// hide the blocks to fix issues on IE6
 		switchToPanel([LOBBY:LOADPARAM:activePanel:0:'GameoptionsPanel','Tab1']);
 

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2008-12-04 11:02:27 UTC (rev 7115)
+++ Lobby/TASClient/MainUnit.pas	2008-12-04 13:11:49 UTC (rev 7116)
@@ -7735,7 +7735,9 @@
 
   i := GetTabWindowPageIndex(ClientName);
   if i = -1 then i := AddTabWindow(ClientName, True) // switch focus to new tab
-  else ChangeActivePageAndUpdate(PageControl1, i);
+  else
+    if PageControl1.Pages[i].Visible then
+      ChangeActivePageAndUpdate(PageControl1, i);
 
 //  RemoveAllClientsFromTab(PageControl1.Pages[i] as TMyTabSheet);
   if not AddClientToTab((PageControl1.Pages[i] as TMyTabSheet).Clients, ClientName) then ; // nevermind, just ignore it

Modified: Lobby/TASClient/MenuFormUnit.dfm
===================================================================
--- Lobby/TASClient/MenuFormUnit.dfm	2008-12-04 11:02:27 UTC (rev 7115)
+++ Lobby/TASClient/MenuFormUnit.dfm	2008-12-04 13:11:49 UTC (rev 7116)
@@ -5,7 +5,7 @@
   Caption = 'MenuForm'
   ClientHeight = 671
   ClientWidth = 907
-  Color = clBtnFace
+  Color = clBackground
   Font.Charset = DEFAULT_CHARSET
   Font.Color = clWindowText
   Font.Height = -11

Modified: Lobby/TASClient/MenuFormUnit.pas
===================================================================
--- Lobby/TASClient/MenuFormUnit.pas	2008-12-04 11:02:27 UTC (rev 7115)
+++ Lobby/TASClient/MenuFormUnit.pas	2008-12-04 13:11:49 UTC (rev 7116)
@@ -369,7 +369,11 @@
 begin
   Self.GetCurrentLuaFile;
   Self.LoadReturnFile;
-  MenuForm.LoadMenu(StringReplace(FWarmapPath,'/','\',[rfReplaceAll]),Campaign);
+  if FIsCampaign then
+    MenuForm.LoadMenu(StringReplace(FWarmapPath,'/','\',[rfReplaceAll]),Campaign)
+  else
+    MenuForm.LoadMenu(StringReplace(FWarmapPath,'/','\',[rfReplaceAll]),Mission);
+
 end;
 
 
@@ -483,8 +487,6 @@
 var
   i: integer;
 begin
-  LockWindowUpdate(MenuForm.Handle);
-
   paramNames := TStringList.Create;
   paramValues := TStringList.Create;
   settingsNames := TStringList.Create;
@@ -533,8 +535,9 @@
   ModMenuPath := GetLongPathName(GetEnvironmentVariable('TEMP'))+'\tasclientmodgui\';
 
   AutorisedURLFiles := TStringList.Create;
-  
-  MenuForm.HookID := SetWindowsHookEx(WH_KEYBOARD, KeyProc, 0, GetCurrentThreadId());
+
+  if not MainUnit.RunningWithMainMenuDev then
+    MenuForm.HookID := SetWindowsHookEx(WH_KEYBOARD, KeyProc, 0, GetCurrentThreadId());
 end;
 
 procedure TMenuForm.SaveIERegistry;
@@ -997,6 +1000,7 @@
   SaveFile(ExtractFilePath(CurrentPath+fileName)+'temp654dsq.html',htmlCode);
   //Sleep(100); // to fix some loading bugs
   htmlBrowser.NavigateToLocalFile(ExtractFilePath(CurrentPath+fileName)+'temp654dsq.html');
+
   sl.Free;
 end;
 
@@ -1122,6 +1126,7 @@
 
 procedure TMenuForm.FormShow(Sender: TObject);
 begin
+
   if not MenuLoaded and not RunningWithMainMenuDev then
   begin
     MessageDlg('An error occured during the Single Player skin loading. Program will now exit ...',mtError,[mbOk],0);
@@ -1129,6 +1134,8 @@
     Exit;
   end;
 
+  LockWindowUpdate(MenuForm.Handle);
+
   tmrMusic.Enabled := true;
   SaveIERegistry;
   springExeVersion := Utility.AcquireSpringVersion;
@@ -1774,6 +1781,7 @@
     end;
     if LeftStr(LowerCase(command),7) = 'addbot:' then
     begin
+      if freeIds.Count = 0 then Exit; // 16 players/bots max
       tmpStr := MidStr(command,8,99999);
 
       New(bot);
@@ -2073,9 +2081,8 @@
 procedure TMenuForm.htmlBrowserControlDocumentComplete(Sender: TObject;
   const pDisp: IDispatch; var URL: OleVariant);
 begin
-    // to avoid white flashes
-    htmlBrowserControl.Invalidate;
-    PostMessage(MenuForm.Handle,WM_UNLOCK_WINDOW,0,0);
+  // to avoid white flashes
+  PostMessage(MenuForm.Handle,WM_UNLOCK_WINDOW,0,0);
 end;
 
 procedure TMenuForm.OnUnlockMessage(var Msg: TMessage);

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2008-12-04 11:02:27 UTC (rev 7115)
+++ Lobby/TASClient/TASClient.dof	2008-12-04 13:11:49 UTC (rev 7116)
@@ -100,7 +100,7 @@
 DebugSourceDirs=
 UsePackages=0
 [Parameters]
-RunParams=
+RunParams=-menu -menudev
 HostApplication=C:\Program Files\Spring\TASClient.exe
 Launcher=
 UseLauncher=0
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=3
 Release=0
-Build=512
+Build=516
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=TA Spring lobby client
-FileVersion=0.3.0.512
+FileVersion=0.3.0.516
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001884.html">[Taspring-linux-commit] r7115 - in branches/caiinterface:	AI/Interfaces AI/Interfaces/C AI/Skirmish	AI/Wrappers/LegacyCpp rts/ExternalAI rts/ExternalAI/Interface	rts/Game rts/Game/StartScripts rts/Sim/Misc rts/System/Script	rts/build/cmake tools/unitsync
</A></li>
	<LI>Next message: <A HREF="001886.html">[Taspring-linux-commit] r7117 - in Lobby/springie: ModInfoBuilder	Springie Springie/PlanetWars Springie/autohost	Springie/client Springie/spring Springie/utils libs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1885">[ date ]</a>
              <a href="thread.html#1885">[ thread ]</a>
              <a href="subject.html#1885">[ subject ]</a>
              <a href="author.html#1885">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
