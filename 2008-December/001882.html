<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7113 - in branches/caiinterface: .	AI/Interfaces AI/Interfaces/C AI/Interfaces/Java AI/Skirmish	AI/Skirmish/KAIK AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI	AI/Wrappers/LegacyCpp rts/ExternalAI rts/ExternalAI/Interface	rts/Game/StartScripts rts/Sim/Misc rts/System	rts/System/Script tools/unitsync
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-December/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7113%20-%20in%20branches/caiinterface%3A%20.%0A%09AI/Interfaces%20AI/Interfaces/C%20AI/Interfaces/Java%20AI/Skirmish%0A%09AI/Skirmish/KAIK%20AI/Skirmish/NullAI%0A%09AI/Skirmish/NullLegacyCppAI%20AI/Skirmish/RAI%0A%09AI/Wrappers/LegacyCpp%20rts/ExternalAI%20rts/ExternalAI/Interface%0A%09rts/Game/StartScripts%20rts/Sim/Misc%20rts/System%0A%09rts/System/Script%20tools/unitsync&In-Reply-To=%3C20081201194823.B0EAF487FB%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001881.html">
   <LINK REL="Next"  HREF="001883.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7113 - in branches/caiinterface: .	AI/Interfaces AI/Interfaces/C AI/Interfaces/Java AI/Skirmish	AI/Skirmish/KAIK AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI	AI/Wrappers/LegacyCpp rts/ExternalAI rts/ExternalAI/Interface	rts/Game/StartScripts rts/Sim/Misc rts/System	rts/System/Script tools/unitsync</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7113%20-%20in%20branches/caiinterface%3A%20.%0A%09AI/Interfaces%20AI/Interfaces/C%20AI/Interfaces/Java%20AI/Skirmish%0A%09AI/Skirmish/KAIK%20AI/Skirmish/NullAI%0A%09AI/Skirmish/NullLegacyCppAI%20AI/Skirmish/RAI%0A%09AI/Wrappers/LegacyCpp%20rts/ExternalAI%20rts/ExternalAI/Interface%0A%09rts/Game/StartScripts%20rts/Sim/Misc%20rts/System%0A%09rts/System/Script%20tools/unitsync&In-Reply-To=%3C20081201194823.B0EAF487FB%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r7113 - in branches/caiinterface: .	AI/Interfaces AI/Interfaces/C AI/Interfaces/Java AI/Skirmish	AI/Skirmish/KAIK AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI	AI/Wrappers/LegacyCpp rts/ExternalAI rts/ExternalAI/Interface	rts/Game/StartScripts rts/Sim/Misc rts/System	rts/System/Script tools/unitsync">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Mon Dec  1 20:48:23 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001881.html">[Taspring-linux-commit] r7112 - in Lobby/springie/Springie:	autohost spring
</A></li>
        <LI>Next message: <A HREF="001883.html">[Taspring-linux-commit] r7114 - trunk/rts/System/Net
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1882">[ date ]</a>
              <a href="thread.html#1882">[ thread ]</a>
              <a href="subject.html#1882">[ subject ]</a>
              <a href="author.html#1882">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-12-01 20:48:22 +0100 (Mon, 01 Dec 2008)
New Revision: 7113

Modified:
   branches/caiinterface/AI/Interfaces/C/Interface.cpp
   branches/caiinterface/AI/Interfaces/C/Interface.h
   branches/caiinterface/AI/Interfaces/C/InterfaceExport.cpp
   branches/caiinterface/AI/Interfaces/C/InterfaceExport.h
   branches/caiinterface/AI/Interfaces/CMakeLists.txt
   branches/caiinterface/AI/Interfaces/Java/InterfaceUtil.c
   branches/caiinterface/AI/Interfaces/Java/InterfaceUtil.h
   branches/caiinterface/AI/Skirmish/CMakeLists.txt
   branches/caiinterface/AI/Skirmish/KAIK/AIExport.cpp
   branches/caiinterface/AI/Skirmish/KAIK/AIExport.h
   branches/caiinterface/AI/Skirmish/NullAI/AIExport.c
   branches/caiinterface/AI/Skirmish/NullAI/AIExport.h
   branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.cpp
   branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h
   branches/caiinterface/AI/Skirmish/RAI/AIExport.cpp
   branches/caiinterface/AI/Skirmish/RAI/AIExport.h
   branches/caiinterface/AI/Wrappers/LegacyCpp/AIAICallback.cpp
   branches/caiinterface/CMakeLists.txt
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h
   branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp
   branches/caiinterface/rts/ExternalAI/AILibraryManager.h
   branches/caiinterface/rts/ExternalAI/EngineOutHandler.cpp
   branches/caiinterface/rts/ExternalAI/EngineOutHandler.h
   branches/caiinterface/rts/ExternalAI/GroupAI.cpp
   branches/caiinterface/rts/ExternalAI/GroupAI.h
   branches/caiinterface/rts/ExternalAI/IAIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/IAILibraryManager.cpp
   branches/caiinterface/rts/ExternalAI/IAILibraryManager.h
   branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h
   branches/caiinterface/rts/ExternalAI/Interface/SAICallback.h
   branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp
   branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h
   branches/caiinterface/rts/ExternalAI/SAICallback.cpp
   branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h
   branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h
   branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.h
   branches/caiinterface/rts/Game/StartScripts/CommanderScript.cpp
   branches/caiinterface/rts/Game/StartScripts/ScriptHandler.cpp
   branches/caiinterface/rts/Game/StartScripts/SkirmishAITestScript.cpp
   branches/caiinterface/rts/Sim/Misc/TeamHandler.cpp
   branches/caiinterface/rts/System/Script/LuaFunctions.cpp
   branches/caiinterface/rts/System/SpringApp.cpp
   branches/caiinterface/tools/unitsync/unitsync.cpp
Log:
* started removing GroupAIs (should already be compleetly out of the C interface)
* unified some C AI interface methods, eg: using a C String map for info aswell as for options values now

Modified: branches/caiinterface/AI/Interfaces/C/Interface.cpp
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -46,19 +46,31 @@
 std::string CInterface::relGroupAIImplsDir =
 		std::string(GROUP_AI_IMPLS_DIR) + PS;
 */
-	
-CInterface::CInterface(const SStaticGlobalData* staticGlobalData) {
-	
+static std::string local_getValueByKey(
+		const std::map&lt;std::string, std::string&gt;&amp; map, std::string key) {
+
+	std::map&lt;std::string, std::string&gt;::const_iterator it = map.find(key);
+	if (it != map.end()) {
+		return it-&gt;second;
+	} else {
+		return &quot;&quot;;
+	}
+}
+
+CInterface::CInterface(const std::map&lt;std::string, std::string&gt;&amp; myInfo,
+		const SStaticGlobalData* staticGlobalData)
+		: myInfo(myInfo), staticGlobalData(staticGlobalData) {
+
 	for (unsigned int i=0; i &lt; staticGlobalData-&gt;numDataDirs; ++i) {
 		springDataDirs.push_back(staticGlobalData-&gt;dataDirs[i]);
 	}
-	
+
 	// example: &quot;AI/Interfaces/C&quot;
 	std::string myDataDirRelative =
 			std::string(AI_INTERFACES_DATA_DIR) + PS + MY_SHORT_NAME;
 	// example: &quot;AI/Interfaces/C/0.1&quot;
 	std::string myDataDirVersRelative = myDataDirRelative + PS + MY_VERSION;
-	
+
 	// &quot;C:/Games/spring/AI/Interfaces/C&quot;
 	myDataDir = FindDir(myDataDirRelative, true, true);
 	if (!FileExists(myDataDir)) {
@@ -69,10 +81,10 @@
 	if (!FileExists(myDataDirVers)) {
 		MakeDirRecursive(myDataDirVers);
 	}
-	
+
 	std::string logFileName = myDataDirVers + PS + &quot;log.txt&quot;;
 	simpleLog_init(logFileName.c_str(), true);
-	
+
 	simpleLog_log(&quot;This is the log-file of the %s version %s&quot;, MY_NAME,
 			MY_VERSION);
 	simpleLog_log(&quot;Using data-directory (version-less): %s&quot;,
@@ -82,69 +94,61 @@
 	simpleLog_log(&quot;Using log file: %s&quot;, logFileName.c_str());
 }
 
-unsigned int CInterface::GetInfo(InfoItem info[], unsigned int maxInfoItems) {
-	
-	unsigned int i = 0;
-	
-	if (myInfo.empty()) {
-		InfoItem ii_0 = {AI_INTERFACE_PROPERTY_SHORT_NAME, MY_SHORT_NAME, NULL}; myInfo.push_back(ii_0);
-		InfoItem ii_1 = {AI_INTERFACE_PROPERTY_VERSION, MY_VERSION, NULL}; myInfo.push_back(ii_1);
-		InfoItem ii_2 = {AI_INTERFACE_PROPERTY_NAME, MY_NAME, NULL}; myInfo.push_back(ii_2);
-		InfoItem ii_3 = {AI_INTERFACE_PROPERTY_DESCRIPTION, &quot;This AI Interface library is needed for Skirmish and Group AIs written in C or C++. It is neded for legacy C++ AIs as well.&quot;, NULL}; myInfo.push_back(ii_3);
-		InfoItem ii_4 = {AI_INTERFACE_PROPERTY_URL, &quot;<A HREF="http://spring.clan-sy.com/wiki/AIInterface:C">http://spring.clan-sy.com/wiki/AIInterface:C</A>&quot;, NULL}; myInfo.push_back(ii_4);
-		InfoItem ii_5 = {AI_INTERFACE_PROPERTY_SUPPORTED_LANGUAGES, &quot;C, C++&quot;, NULL}; myInfo.push_back(ii_5);
-	}
-	
-	std::vector&lt;InfoItem&gt;::const_iterator inf;
-	for (inf=myInfo.begin(); inf!=myInfo.end() &amp;&amp; i &lt; maxInfoItems; inf++) {
-		info[i] = *inf;
-		i++;
-	}
-	
-	return i;
-}
+//unsigned int CInterface::GetInfo(InfoItem info[], unsigned int maxInfoItems) {
+//
+//	unsigned int i = 0;
+//
+//	if (myInfo.empty()) {
+//		InfoItem ii_0 = {AI_INTERFACE_PROPERTY_SHORT_NAME, MY_SHORT_NAME, NULL}; myInfo.push_back(ii_0);
+//		InfoItem ii_1 = {AI_INTERFACE_PROPERTY_VERSION, MY_VERSION, NULL}; myInfo.push_back(ii_1);
+//		InfoItem ii_2 = {AI_INTERFACE_PROPERTY_NAME, MY_NAME, NULL}; myInfo.push_back(ii_2);
+//		InfoItem ii_3 = {AI_INTERFACE_PROPERTY_DESCRIPTION, &quot;This AI Interface library is needed for Skirmish and Group AIs written in C or C++. It is neded for legacy C++ AIs as well.&quot;, NULL}; myInfo.push_back(ii_3);
+//		InfoItem ii_4 = {AI_INTERFACE_PROPERTY_URL, &quot;<A HREF="http://spring.clan-sy.com/wiki/AIInterface:C">http://spring.clan-sy.com/wiki/AIInterface:C</A>&quot;, NULL}; myInfo.push_back(ii_4);
+//		InfoItem ii_5 = {AI_INTERFACE_PROPERTY_SUPPORTED_LANGUAGES, &quot;C, C++&quot;, NULL}; myInfo.push_back(ii_5);
+//	}
+//
+//	std::vector&lt;InfoItem&gt;::const_iterator inf;
+//	for (inf=myInfo.begin(); inf!=myInfo.end() &amp;&amp; i &lt; maxInfoItems; inf++) {
+//		info[i] = *inf;
+//		i++;
+//	}
+//
+//	return i;
+//}
 
 LevelOfSupport CInterface::GetLevelOfSupportFor(
 		const char* engineVersion, int engineAIInterfaceGeneratedVersion) {
 	return LOS_Working;
 }
 
-void copyToInfoMap(std::map&lt;std::string, InfoItem&gt;&amp; infoMap,
-		const InfoItem info[], unsigned int numInfoItems) {
-
-	for (unsigned int i=0; i &lt; numInfoItems; ++i) {
-		infoMap[info[i].key] = copyInfoItem(&amp;(info[i]));
-	}
-}
 SSAISpecifier extractSSAISpecifier(
-		const std::map&lt;std::string, InfoItem&gt;&amp; infoMap) {
+		const std::map&lt;std::string, std::string&gt;&amp; infoMap) {
 
-	const char* sn = infoMap.find(SKIRMISH_AI_PROPERTY_SHORT_NAME)-&gt;second.value;
-	const char* v = infoMap.find(SKIRMISH_AI_PROPERTY_VERSION)-&gt;second.value;
+	const char* sn = infoMap.find(SKIRMISH_AI_PROPERTY_SHORT_NAME)-&gt;second.c_str();
+	const char* v = infoMap.find(SKIRMISH_AI_PROPERTY_VERSION)-&gt;second.c_str();
 
 	SSAISpecifier specifier = {sn, v};
 
 	return specifier;
 }
-SGAISpecifier extractSGAISpecifier(
-		const std::map&lt;std::string, InfoItem&gt;&amp; infoMap) {
+//SGAISpecifier extractSGAISpecifier(
+//		const std::map&lt;std::string, InfoItem&gt;&amp; infoMap) {
+//
+//	const char* sn = infoMap.find(GROUP_AI_PROPERTY_SHORT_NAME)-&gt;second.value;
+//	const char* v = infoMap.find(GROUP_AI_PROPERTY_VERSION)-&gt;second.value;
+//
+//	SGAISpecifier specifier = {sn, v};
+//
+//	return specifier;
+//}
 
-	const char* sn = infoMap.find(GROUP_AI_PROPERTY_SHORT_NAME)-&gt;second.value;
-	const char* v = infoMap.find(GROUP_AI_PROPERTY_VERSION)-&gt;second.value;
+const SSAILibrary* CInterface::LoadSkirmishAILibrary(
+		const std::map&lt;std::string, std::string&gt;&amp; infoMap) {
 
-	SGAISpecifier specifier = {sn, v};
-
-	return specifier;
-}
-
-const SSAILibrary* CInterface::LoadSkirmishAILibrary(const InfoItem info[],
-		unsigned int numInfoItems) {
-
 	SSAILibrary* ai;
 
-	std::map&lt;std::string, InfoItem&gt; infoMap;
-	copyToInfoMap(infoMap, info, numInfoItems);
 	SSAISpecifier sAISpecifier = extractSSAISpecifier(infoMap);
+
 	mySkirmishAISpecifiers.push_back(sAISpecifier);
 	mySkirmishAIInfos[sAISpecifier] = infoMap;
 
@@ -161,12 +165,15 @@
 
 	return ai;
 }
-int CInterface::UnloadSkirmishAILibrary(const SSAISpecifier* const sAISpecifier) {
+int CInterface::UnloadSkirmishAILibrary(
+		const std::map&lt;std::string, std::string&gt;&amp; infoMap) {
 
+	SSAISpecifier sAISpecifier = extractSSAISpecifier(infoMap);
+
 	T_skirmishAIs::iterator skirmishAI =
-			myLoadedSkirmishAIs.find(*sAISpecifier);
+			myLoadedSkirmishAIs.find(sAISpecifier);
 	T_skirmishAILibs::iterator skirmishAILib =
-			myLoadedSkirmishAILibs.find(*sAISpecifier);
+			myLoadedSkirmishAILibs.find(sAISpecifier);
 	if (skirmishAI == myLoadedSkirmishAIs.end()) {
 		// to unload AI is not loaded -&gt; no problem, do nothing
 	} else {
@@ -181,7 +188,8 @@
 int CInterface::UnloadAllSkirmishAILibraries() {
 
 	while (myLoadedSkirmishAIs.size() &gt; 0) {
-		UnloadSkirmishAILibrary(&amp;(myLoadedSkirmishAIs.begin()-&gt;first));
+		UnloadSkirmishAILibrary(
+				mySkirmishAIInfos[myLoadedSkirmishAIs.begin()-&gt;first]);
 	}
 
 	return 0;
@@ -189,55 +197,55 @@
 
 
 
-const SGAILibrary* CInterface::LoadGroupAILibrary(const struct InfoItem info[],
-		unsigned int numInfoItems) {
+//const SGAILibrary* CInterface::LoadGroupAILibrary(const struct InfoItem info[],
+//		unsigned int numInfoItems) {
+//
+//	SGAILibrary* ai = NULL;
+//
+//	std::map&lt;std::string, InfoItem&gt; infoMap;
+//	copyToInfoMap(infoMap, info, numInfoItems);
+//	SGAISpecifier gAISpecifier = extractSGAISpecifier(infoMap);
+//	myGroupAISpecifiers.push_back(gAISpecifier);
+//	myGroupAIInfos[gAISpecifier] = infoMap;
+//
+//	T_groupAIs::iterator groupAI;
+//	groupAI = myLoadedGroupAIs.find(gAISpecifier);
+//	if (groupAI == myLoadedGroupAIs.end()) {
+//		ai = new SGAILibrary;
+//		SharedLib* lib = Load(&amp;gAISpecifier, ai);
+//		myLoadedGroupAIs[gAISpecifier] = ai;
+//		myLoadedGroupAILibs[gAISpecifier] = lib;
+//	} else {
+//		ai = groupAI-&gt;second;
+//	}
+//
+//	return ai;
+//}
+//int CInterface::UnloadGroupAILibrary(const SGAISpecifier* const gAISpecifier) {
+//
+//	T_groupAIs::iterator groupAI = myLoadedGroupAIs.find(*gAISpecifier);
+//	T_groupAILibs::iterator groupAILib =
+//			myLoadedGroupAILibs.find(*gAISpecifier);
+//	if (groupAI == myLoadedGroupAIs.end()) {
+//		// to unload AI is not loaded -&gt; no problem, do nothing
+//	} else {
+//		delete groupAI-&gt;second;
+//		myLoadedGroupAIs.erase(groupAI);
+//		delete groupAILib-&gt;second;
+//		myLoadedGroupAILibs.erase(groupAILib);
+//	}
+//
+//	return 0;
+//}
+//int CInterface::UnloadAllGroupAILibraries() {
+//
+//	while (myLoadedGroupAIs.size() &gt; 0) {
+//		UnloadGroupAILibrary(&amp;(myLoadedGroupAIs.begin()-&gt;first));
+//	}
+//
+//	return 0;
+//}
 
-	SGAILibrary* ai = NULL;
-
-	std::map&lt;std::string, InfoItem&gt; infoMap;
-	copyToInfoMap(infoMap, info, numInfoItems);
-	SGAISpecifier gAISpecifier = extractSGAISpecifier(infoMap);
-	myGroupAISpecifiers.push_back(gAISpecifier);
-	myGroupAIInfos[gAISpecifier] = infoMap;
-
-	T_groupAIs::iterator groupAI;
-	groupAI = myLoadedGroupAIs.find(gAISpecifier);
-	if (groupAI == myLoadedGroupAIs.end()) {
-		ai = new SGAILibrary;
-		SharedLib* lib = Load(&amp;gAISpecifier, ai);
-		myLoadedGroupAIs[gAISpecifier] = ai;
-		myLoadedGroupAILibs[gAISpecifier] = lib;
-	} else {
-		ai = groupAI-&gt;second;
-	}
-
-	return ai;
-}
-int CInterface::UnloadGroupAILibrary(const SGAISpecifier* const gAISpecifier) {
-
-	T_groupAIs::iterator groupAI = myLoadedGroupAIs.find(*gAISpecifier);
-	T_groupAILibs::iterator groupAILib =
-			myLoadedGroupAILibs.find(*gAISpecifier);
-	if (groupAI == myLoadedGroupAIs.end()) {
-		// to unload AI is not loaded -&gt; no problem, do nothing
-	} else {
-		delete groupAI-&gt;second;
-		myLoadedGroupAIs.erase(groupAI);
-		delete groupAILib-&gt;second;
-		myLoadedGroupAILibs.erase(groupAILib);
-	}
-
-	return 0;
-}
-int CInterface::UnloadAllGroupAILibraries() {
-	
-	while (myLoadedGroupAIs.size() &gt; 0) {
-		UnloadGroupAILibrary(&amp;(myLoadedGroupAIs.begin()-&gt;first));
-	}
-	
-	return 0;
-}
-
 // private functions following
 
 SharedLib* CInterface::Load(const SSAISpecifier* const sAISpecifier,
@@ -264,7 +272,7 @@
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
 */
-	skirmishAILibrary-&gt;getInfo = NULL;
+//	skirmishAILibrary-&gt;getInfo = NULL;
 
 /*
 	funcName = &quot;getOptions&quot;;
@@ -274,113 +282,127 @@
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
 */
-	skirmishAILibrary-&gt;getOptions = NULL;
+//	skirmishAILibrary-&gt;getOptions = NULL;
 
 	funcName = &quot;getLevelOfSupportFor&quot;;
-	skirmishAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(int teamId, const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
+	skirmishAILibrary-&gt;getLevelOfSupportFor
+			= (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(int teamId,
+			const char*, int, const char*, const char*))
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (skirmishAILibrary-&gt;getLevelOfSupportFor == NULL) {
 		// do nothing: it is permitted that an AI does not export this function
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
-	
+
 	funcName = &quot;init&quot;;
-	skirmishAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int, const struct InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	skirmishAILibrary-&gt;init
+			= (int (CALLING_CONV_FUNC_POINTER *)(int teamId,
+			unsigned int infoSize,
+			const char** infoKeys, const char** infoValues,
+			unsigned int optionsSize,
+			const char** optionsKeys, const char** optionsValues))
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (skirmishAILibrary-&gt;init == NULL) {
 		// do nothing: it is permitted that an AI does not export this function,
 		// as it can still use EVENT_INIT instead
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
-	
+
 	funcName = &quot;release&quot;;
-	skirmishAILibrary-&gt;release = (int (CALLING_CONV_FUNC_POINTER *)(int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	skirmishAILibrary-&gt;release
+			= (int (CALLING_CONV_FUNC_POINTER *)(int teamId))
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (skirmishAILibrary-&gt;release == NULL) {
 		// do nothing: it is permitted that an AI does not export this function,
 		// as it can still use EVENT_RELEASE instead
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
-	
+
 	funcName = &quot;handleEvent&quot;;
-	skirmishAILibrary-&gt;handleEvent = (int (CALLING_CONV_FUNC_POINTER *)(int, int, const void*)) sharedLib-&gt;FindAddress(funcName.c_str());
+	skirmishAILibrary-&gt;handleEvent
+			= (int (CALLING_CONV_FUNC_POINTER *)(int teamId,
+			int, const void*))
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (skirmishAILibrary-&gt;handleEvent == NULL) {
 		reportInterfaceFunctionError(libFilePath, funcName);
 	}
-	
+
 	return sharedLib;
 }
 
 
-SharedLib* CInterface::Load(const SGAISpecifier* const gAISpecifier,
-		SGAILibrary* groupAILibrary) {
-	return LoadGroupAILib(FindLibFile(*gAISpecifier), groupAILibrary);
-}
-SharedLib* CInterface::LoadGroupAILib(const std::string&amp; libFilePath,
-		SGAILibrary* groupAILibrary) {
-	
-	SharedLib* sharedLib = SharedLib::Instantiate(libFilePath);
-	
-	if (sharedLib == NULL) {
-		reportError(std::string(&quot;Failed loading shared library: &quot;) + libFilePath);
-	}
-	
-	// initialize the AI library
-	std::string funcName;
-	
-/*
-	funcName = &quot;getInfo&quot;;
-	groupAILibrary-&gt;getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (groupAILibrary-&gt;getInfo == NULL) {
-		// do nothing: this is permitted, if the AI supplies info through an AIInfo.lua file
-		//reportInterfaceFunctionError(libFilePath, funcName);
-	}
-*/
-	groupAILibrary-&gt;getInfo = NULL;
-	
-/*
-	funcName = &quot;getOptions&quot;;
-	groupAILibrary-&gt;getOptions = (unsigned int (CALLING_CONV_FUNC_POINTER *)(Option[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (groupAILibrary-&gt;getOptions == NULL) {
-		// do nothing: this is permitted, if the AI supplies options through an AIOptions.lua file
-		//reportInterfaceFunctionError(libFilePath, funcName);
-	}
-*/
-	groupAILibrary-&gt;getOptions = NULL;
-	
-	funcName = &quot;getLevelOfSupportFor&quot;;
-	groupAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId, const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (groupAILibrary-&gt;getLevelOfSupportFor == NULL) {
-		// do nothing: it is permitted that an AI does not export this function
-		//reportInterfaceFunctionError(libFilePath, funcName);
-	}
-	
-	funcName = &quot;init&quot;;
-	groupAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId, const struct InfoItem info[], unsigned int maxInfoItems)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (groupAILibrary-&gt;init == NULL) {
-		// do nothing: it is permitted that an AI does not export this function,
-		// as it can still use EVENT_INIT instead
-		//reportInterfaceFunctionError(libFilePath, funcName);
-	}
-	
-	funcName = &quot;release&quot;;
-	groupAILibrary-&gt;release = (int (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (groupAILibrary-&gt;release == NULL) {
-		// do nothing: it is permitted that an AI does not export this function,
-		// as it can still use EVENT_RELEASE instead
-		//reportInterfaceFunctionError(libFilePath, funcName);
-	}
-	
-	funcName = &quot;handleEvent&quot;;
-	groupAILibrary-&gt;handleEvent = (int (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId, int topic, const void* data)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (groupAILibrary-&gt;handleEvent == NULL) {
-		reportInterfaceFunctionError(libFilePath, funcName);
-	}
-	
-	return sharedLib;
-}
+//SharedLib* CInterface::Load(const SGAISpecifier* const gAISpecifier,
+//		SGAILibrary* groupAILibrary) {
+//	return LoadGroupAILib(FindLibFile(*gAISpecifier), groupAILibrary);
+//}
+//SharedLib* CInterface::LoadGroupAILib(const std::string&amp; libFilePath,
+//		SGAILibrary* groupAILibrary) {
+//
+//	SharedLib* sharedLib = SharedLib::Instantiate(libFilePath);
+//
+//	if (sharedLib == NULL) {
+//		reportError(std::string(&quot;Failed loading shared library: &quot;) + libFilePath);
+//	}
+//
+//	// initialize the AI library
+//	std::string funcName;
+//
+///*
+//	funcName = &quot;getInfo&quot;;
+//	groupAILibrary-&gt;getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (groupAILibrary-&gt;getInfo == NULL) {
+//		// do nothing: this is permitted, if the AI supplies info through an AIInfo.lua file
+//		//reportInterfaceFunctionError(libFilePath, funcName);
+//	}
+//*/
+//	groupAILibrary-&gt;getInfo = NULL;
+//
+///*
+//	funcName = &quot;getOptions&quot;;
+//	groupAILibrary-&gt;getOptions = (unsigned int (CALLING_CONV_FUNC_POINTER *)(Option[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (groupAILibrary-&gt;getOptions == NULL) {
+//		// do nothing: this is permitted, if the AI supplies options through an AIOptions.lua file
+//		//reportInterfaceFunctionError(libFilePath, funcName);
+//	}
+//*/
+//	groupAILibrary-&gt;getOptions = NULL;
+//
+//	funcName = &quot;getLevelOfSupportFor&quot;;
+//	groupAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId, const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (groupAILibrary-&gt;getLevelOfSupportFor == NULL) {
+//		// do nothing: it is permitted that an AI does not export this function
+//		//reportInterfaceFunctionError(libFilePath, funcName);
+//	}
+//
+//	funcName = &quot;init&quot;;
+//	groupAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId, const struct InfoItem info[], unsigned int maxInfoItems)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (groupAILibrary-&gt;init == NULL) {
+//		// do nothing: it is permitted that an AI does not export this function,
+//		// as it can still use EVENT_INIT instead
+//		//reportInterfaceFunctionError(libFilePath, funcName);
+//	}
+//
+//	funcName = &quot;release&quot;;
+//	groupAILibrary-&gt;release = (int (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (groupAILibrary-&gt;release == NULL) {
+//		// do nothing: it is permitted that an AI does not export this function,
+//		// as it can still use EVENT_RELEASE instead
+//		//reportInterfaceFunctionError(libFilePath, funcName);
+//	}
+//
+//	funcName = &quot;handleEvent&quot;;
+//	groupAILibrary-&gt;handleEvent = (int (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId, int topic, const void* data)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (groupAILibrary-&gt;handleEvent == NULL) {
+//		reportInterfaceFunctionError(libFilePath, funcName);
+//	}
+//
+//	return sharedLib;
+//}
 
 
 void CInterface::reportInterfaceFunctionError(const std::string&amp; libFilePath,
 		const std::string&amp; functionName) {
-	
+
 	std::string msg(&quot;Failed loading AI Library from file \&quot;&quot;);
 	msg += libFilePath + &quot;\&quot;: no \&quot;&quot; + functionName + &quot;\&quot; function exported&quot;;
 	reportError(msg);
@@ -393,7 +415,7 @@
 
 
 std::string CInterface::FindLibFile(const SSAISpecifier&amp; sAISpecifier) {
-	
+
 	// fetch the data-dir and file-name from the info about the AI to load,
 	// which was supplied to us by the engine
 	T_skirmishAIInfos::const_iterator info =
@@ -402,90 +424,90 @@
 		reportError(std::string(&quot;Missing Skirmish-AI info for &quot;)
 				+ sAISpecifier.shortName + &quot; &quot; + sAISpecifier.version);
 	}
-	
-	std::map&lt;std::string, InfoItem&gt;::const_iterator prop =
+
+	std::map&lt;std::string, std::string&gt;::const_iterator prop =
 			info-&gt;second.find(SKIRMISH_AI_PROPERTY_DATA_DIR);
 	if (prop == info-&gt;second.end()) {
 		reportError(std::string(&quot;Missing Skirmish-AI data dir for &quot;)
 				+ sAISpecifier.shortName + &quot; &quot; + sAISpecifier.version);
 	}
-	const std::string&amp; dataDir(prop-&gt;second.value);
-	
+	const std::string&amp; dataDir(prop-&gt;second);
+
 	prop = info-&gt;second.find(SKIRMISH_AI_PROPERTY_FILE_NAME);
 	if (prop == info-&gt;second.end()) {
 		reportError(std::string(&quot;Missing Skirmish-AI file name for &quot;)
 				+ sAISpecifier.shortName + &quot; &quot; + sAISpecifier.version);
 	}
-	const std::string&amp; fileName(prop-&gt;second.value);
-	
+	const std::string&amp; fileName(prop-&gt;second);
+
 	std::string libFileName(fileName); // eg. RAI-0.600
 	#ifndef _WIN32
 		libFileName = &quot;lib&quot; + libFileName; // eg. libRAI-0.600
 	#endif
-	
+
 	// eg. libRAI-0.600.so
 	libFileName = libFileName + &quot;.&quot; + SharedLib::GetLibExtension();
-	
-	//return FindFile(dataDir + PS + libFileName);
-	return dataDir + PS + libFileName;
-}
 
-std::string CInterface::FindLibFile(const SGAISpecifier&amp; gAISpecifier) {
-	
-	// fetch the data-dir and file-name from the info about the AI to load,
-	// which was supplied to us by the engine
-	T_groupAIInfos::const_iterator info = myGroupAIInfos.find(gAISpecifier);
-	if (info == myGroupAIInfos.end()) {
-		reportError(std::string(&quot;Missing Group-AI info for &quot;)
-				+ gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
-	}
-	
-	std::map&lt;std::string, InfoItem&gt;::const_iterator prop =
-			info-&gt;second.find(GROUP_AI_PROPERTY_DATA_DIR);
-	if (prop == info-&gt;second.end()) {
-		reportError(std::string(&quot;Missing Group-AI data dir for &quot;)
-				+ gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
-	}
-	const std::string&amp; dataDir(prop-&gt;second.value);
-	
-	prop = info-&gt;second.find(GROUP_AI_PROPERTY_FILE_NAME);
-	if (prop == info-&gt;second.end()) {
-		reportError(std::string(&quot;Missing Group-AI file name for &quot;)
-				+ gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
-	}
-	const std::string&amp; fileName(prop-&gt;second.value);
-	
-	std::string libFileName(fileName); // eg. MetalMaker-1.0
-	#ifndef _WIN32
-		libFileName = &quot;lib&quot; + libFileName; // eg. libMetalMaker-1.0
-	#endif
-	
-	// eg. libMetalMaker-1.0.so
-	libFileName = libFileName + &quot;.&quot; + SharedLib::GetLibExtension();
-	
 	//return FindFile(dataDir + PS + libFileName);
 	return dataDir + PS + libFileName;
 }
 
+//std::string CInterface::FindLibFile(const SGAISpecifier&amp; gAISpecifier) {
+//
+//	// fetch the data-dir and file-name from the info about the AI to load,
+//	// which was supplied to us by the engine
+//	T_groupAIInfos::const_iterator info = myGroupAIInfos.find(gAISpecifier);
+//	if (info == myGroupAIInfos.end()) {
+//		reportError(std::string(&quot;Missing Group-AI info for &quot;)
+//				+ gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
+//	}
+//
+//	std::map&lt;std::string, InfoItem&gt;::const_iterator prop =
+//			info-&gt;second.find(GROUP_AI_PROPERTY_DATA_DIR);
+//	if (prop == info-&gt;second.end()) {
+//		reportError(std::string(&quot;Missing Group-AI data dir for &quot;)
+//				+ gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
+//	}
+//	const std::string&amp; dataDir(prop-&gt;second.value);
+//
+//	prop = info-&gt;second.find(GROUP_AI_PROPERTY_FILE_NAME);
+//	if (prop == info-&gt;second.end()) {
+//		reportError(std::string(&quot;Missing Group-AI file name for &quot;)
+//				+ gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
+//	}
+//	const std::string&amp; fileName(prop-&gt;second.value);
+//
+//	std::string libFileName(fileName); // eg. MetalMaker-1.0
+//	#ifndef _WIN32
+//		libFileName = &quot;lib&quot; + libFileName; // eg. libMetalMaker-1.0
+//	#endif
+//
+//	// eg. libMetalMaker-1.0.so
+//	libFileName = libFileName + &quot;.&quot; + SharedLib::GetLibExtension();
+//
+//	//return FindFile(dataDir + PS + libFileName);
+//	return dataDir + PS + libFileName;
+//}
+
 bool CInterface::FileExists(const std::string&amp; filePath) {
-	
+
 	struct stat fileInfo;
 	bool exists;
 	int intStat;
 
-	// Attempt to get the file attributes 
+	// Attempt to get the file attributes
 	intStat = stat(filePath.c_str(), &amp;fileInfo);
 	if (intStat == 0) {
-		// We were able to get the file attributes 
-		// so the file obviously exists. 
+		// We were able to get the file attributes
+		// so the file obviously exists.
 		exists = true;
 	} else {
-		// We were not able to get the file attributes. 
-		// This may mean that we don't have permission to 
-		// access the folder which contains this file. If you 
-		// need to do that level of checking, lookup the 
-		// return values of stat which will give you 
-		// more details on why stat failed. 
+		// We were not able to get the file attributes.
+		// This may mean that we don't have permission to
+		// access the folder which contains this file. If you
+		// need to do that level of checking, lookup the
+		// return values of stat which will give you
+		// more details on why stat failed.
 		exists = false;
 	}
 
@@ -493,7 +515,7 @@
 }
 
 bool CInterface::MakeDir(const std::string&amp; dirPath) {
-	
+
 	#ifdef	WIN32
 	int mkStat = _mkdir(dirPath.c_str());
 	if (mkStat == 0) {
@@ -514,7 +536,7 @@
 }
 
 bool CInterface::MakeDirRecursive(const std::string&amp; dirPath) {
-	
+
 	if (!FileExists(dirPath)) {
 		std::string::size_type pos = dirPath.find_last_of(&quot;/\\&quot;);
 		if (pos != std::string::npos) {
@@ -526,14 +548,14 @@
 		}
 		return false;
 	}
-	
+
 	return true;
 }
 
 std::string CInterface::FindFile(const std::string&amp; relativeFilePath) {
-	
+
 	std::string path = relativeFilePath;
-	
+
 	for (unsigned int i=0; i &lt; springDataDirs.size(); ++i) {
 		std::string tmpPath = springDataDirs.at(i);
 		tmpPath += PS + relativeFilePath;
@@ -542,19 +564,19 @@
 			break;
 		}
 	}
-	
+
 	return path;
 }
 std::string CInterface::FindDir(const std::string&amp; relativeDirPath,
 		bool searchOnlyWriteable, bool pretendAvailable) {
-	
+
 	std::string path = relativeDirPath;
-	
+
 	unsigned int numDds = springDataDirs.size();
 	if (searchOnlyWriteable &amp;&amp; numDds &gt; 1) {
 		numDds = 1;
 	}
-	
+
 	bool found = false;
 	for (unsigned int i=0; i &lt; numDds; ++i) {
 		std::string tmpPath = springDataDirs.at(i) + PS + relativeDirPath;
@@ -564,19 +586,19 @@
 			break;
 		}
 	}
-	
+
 	if (!found &amp;&amp; pretendAvailable &amp;&amp; numDds &gt;= 1) {
 		path = springDataDirs.at(0) + PS + relativeDirPath;
 	}
-	
+
 	return path;
 }
 
 /*
 SSAISpecifier CInterface::ExtractSpecifier(const SSAILibrary&amp; skirmishAILib) {
-	
+
 	SSAISpecifier skirmishAISpecifier;
-	
+
 	InfoItem info[MAX_INFOS];
 	int numInfo =  skirmishAILib.getInfo(info, MAX_INFOS);
 
@@ -590,16 +612,16 @@
 			skirmishAISpecifier.version = info[i].value;
 		}
 	}
-	
+
 	return skirmishAISpecifier;
 }
 */
 
 /*
 SGAISpecifier CInterface::ExtractSpecifier(const SGAILibrary&amp; groupAILib) {
-	
+
 	SGAISpecifier groupAISpecifier;
-	
+
 	InfoItem info[MAX_INFOS];
 	int numInfo =  groupAILib.getInfo(info, MAX_INFOS);
 
@@ -613,33 +635,19 @@
 			groupAISpecifier.version = info[i].value;
 		}
 	}
-	
+
 	return groupAISpecifier;
 }
 */
 
 bool CInterface::FitsThisInterface(const std::string&amp; requestedShortName,
 		const std::string&amp; requestedVersion) {
-	
-	bool shortNameFits = false;
-	bool versionFits = false;
-	
-	InfoItem info[MAX_INFOS];
-	int num = GetInfo(info, MAX_INFOS);
-	
-	std::string shortNameKey(AI_INTERFACE_PROPERTY_SHORT_NAME);
-	std::string versionKey(AI_INTERFACE_PROPERTY_VERSION);
-	for (int i=0; i &lt; num; ++i) {
-		if (shortNameKey == info[i].key) {
-			if (requestedShortName == info[i].value) {
-				shortNameFits = true;
-			}
-		} else if (versionKey == info[i].key) {
-			if (requestedVersion == info[i].value) {
-				versionFits = true;
-			}
-		}
-	}
-	
+
+	std::string myShortName = local_getValueByKey(myInfo, AI_INTERFACE_PROPERTY_SHORT_NAME);
+	std::string myVersion = local_getValueByKey(myInfo, AI_INTERFACE_PROPERTY_VERSION);
+
+	bool shortNameFits = (requestedShortName == myShortName);
+	bool versionFits = (requestedVersion == myVersion);
+
 	return shortNameFits &amp;&amp; versionFits;
 }

Modified: branches/caiinterface/AI/Interfaces/C/Interface.h
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Interfaces/C/Interface.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -19,7 +19,7 @@
 #define _INTERFACE_H
 
 #include &quot;ExternalAI/Interface/SSAILibrary.h&quot;
-#include &quot;ExternalAI/Interface/SGAILibrary.h&quot;
+//#include &quot;ExternalAI/Interface/SGAILibrary.h&quot;
 
 #include &lt;map&gt;
 #include &lt;vector&gt;
@@ -32,24 +32,26 @@
 class CInterface {
 public:
 	//CInterface();
-	CInterface(const SStaticGlobalData* staticGlobalData);
-	
+	CInterface(const std::map&lt;std::string, std::string&gt;&amp; infoMap,
+			const SStaticGlobalData* staticGlobalData);
+
 	// static properties
-	unsigned int GetInfo(InfoItem info[], unsigned int maxInfoItems);
+//	unsigned int GetInfo(InfoItem info[], unsigned int maxInfoItems);
 	LevelOfSupport GetLevelOfSupportFor(
 			const char* engineVersion, int engineAIInterfaceGeneratedVersion);
 
 	// skirmish AI methods
-	const SSAILibrary* LoadSkirmishAILibrary(const struct InfoItem info[],
-			unsigned int numInfoItems);
-	int UnloadSkirmishAILibrary(const SSAISpecifier* const sAISpecifier);
+	const SSAILibrary* LoadSkirmishAILibrary(
+			const std::map&lt;std::string, std::string&gt;&amp; infoMap);
+	int UnloadSkirmishAILibrary(
+			const std::map&lt;std::string, std::string&gt;&amp; infoMap);
 	int UnloadAllSkirmishAILibraries();
 
-	// group AI methods
-	const SGAILibrary* LoadGroupAILibrary(const struct InfoItem info[],
-			unsigned int numInfoItems);
-	int UnloadGroupAILibrary(const SGAISpecifier* const gAISpecifier);
-	int UnloadAllGroupAILibraries();
+//	// group AI methods
+//	const SGAILibrary* LoadGroupAILibrary(const struct InfoItem info[],
+//			unsigned int numInfoItems);
+//	int UnloadGroupAILibrary(const SGAISpecifier* const gAISpecifier);
+//	int UnloadAllGroupAILibraries();
 
 private:
 	// these functions actually load and unload the libraries
@@ -57,14 +59,14 @@
 	SharedLib* LoadSkirmishAILib(const std::string&amp; libFilePath,
 			SSAILibrary* ai);
 
-	SharedLib* Load(const SGAISpecifier* const gAISpecifier, SGAILibrary* ai);
-	SharedLib* LoadGroupAILib(const std::string&amp; libFilePath, SGAILibrary* ai);
+//	SharedLib* Load(const SGAISpecifier* const gAISpecifier, SGAILibrary* ai);
+//	SharedLib* LoadGroupAILib(const std::string&amp; libFilePath, SGAILibrary* ai);
 
 	static void reportInterfaceFunctionError(const std::string&amp; libFileName,
 			const std::string&amp; functionName);
 	static void reportError(const std::string&amp; msg);
 	std::string FindLibFile(const SSAISpecifier&amp; sAISpecifier);
-	std::string FindLibFile(const SGAISpecifier&amp; gAISpecifier);
+//	std::string FindLibFile(const SGAISpecifier&amp; gAISpecifier);
 	/**
 	 * Searches for a file in all data-dirs.
 	 * If not found, the input param relativeFilePath is returned.
@@ -82,13 +84,13 @@
 	static bool FileExists(const std::string&amp; filePath);
 	/**
 	 * Creates the directory if it does not yet exist.
-	 * 
+	 *
 	 * @return	true if the directory was created or already existed
 	 */
 	static bool MakeDir(const std::string&amp; dirPath);
 	/**
 	 * Creates the directory and all parent directories that do not yet exist.
-	 * 
+	 *
 	 * @return	true if the directory was created or already existed
 	 */
 	static bool MakeDirRecursive(const std::string&amp; dirPath);
@@ -100,7 +102,9 @@
 private:
 //	static std::string relSkirmishAIImplsDir;
 //	static std::string relGroupAIImplsDir;
-	
+	const std::map&lt;std::string, std::string&gt; myInfo;
+	const SStaticGlobalData* staticGlobalData;
+
 	std::vector&lt;std::string&gt; springDataDirs;
 	/**
 	 * All accompanying data for this interface that is not version specifc
@@ -115,24 +119,23 @@
 	//const SStaticGlobalData* staticGlobalData;
 	//std::string skirmishAIsLibDir;
 	//std::string groupAIsLibDir;
-	std::vector&lt;InfoItem&gt; myInfo;
+//	std::vector&lt;InfoItem&gt; myInfo;
 
 	std::vector&lt;SSAISpecifier&gt; mySkirmishAISpecifiers;
-	typedef std::map&lt;SSAISpecifier, std::map&lt;std::string, InfoItem&gt;,SSAISpecifier_Comparator&gt; T_skirmishAIInfos;
+	typedef std::map&lt;SSAISpecifier, std::map&lt;std::string, std::string&gt;,SSAISpecifier_Comparator&gt; T_skirmishAIInfos;
 	T_skirmishAIInfos mySkirmishAIInfos;
 	typedef std::map&lt;SSAISpecifier, SSAILibrary*, SSAISpecifier_Comparator&gt; T_skirmishAIs;
 	T_skirmishAIs myLoadedSkirmishAIs;
 	typedef std::map&lt;SSAISpecifier, SharedLib*, SSAISpecifier_Comparator&gt; T_skirmishAILibs;
 	T_skirmishAILibs myLoadedSkirmishAILibs;
 
-	std::vector&lt;SGAISpecifier&gt; myGroupAISpecifiers;
-	typedef std::map&lt;SGAISpecifier, std::map&lt;std::string, InfoItem&gt;, SGAISpecifier_Comparator&gt; T_groupAIInfos;
-	T_groupAIInfos myGroupAIInfos;
-	typedef std::map&lt;SGAISpecifier, SGAILibrary*, SGAISpecifier_Comparator&gt; T_groupAIs;
-	T_groupAIs myLoadedGroupAIs;
-	typedef std::map&lt;SGAISpecifier, SharedLib*, SGAISpecifier_Comparator&gt; T_groupAILibs;
-	T_groupAILibs myLoadedGroupAILibs;
+//	std::vector&lt;SGAISpecifier&gt; myGroupAISpecifiers;
+//	typedef std::map&lt;SGAISpecifier, std::map&lt;std::string, InfoItem&gt;, SGAISpecifier_Comparator&gt; T_groupAIInfos;
+//	T_groupAIInfos myGroupAIInfos;
+//	typedef std::map&lt;SGAISpecifier, SGAILibrary*, SGAISpecifier_Comparator&gt; T_groupAIs;
+//	T_groupAIs myLoadedGroupAIs;
+//	typedef std::map&lt;SGAISpecifier, SharedLib*, SGAISpecifier_Comparator&gt; T_groupAILibs;
+//	T_groupAILibs myLoadedGroupAILibs;
 };
 
-#endif	/* _INTERFACE_H */
-
+#endif	// _INTERFACE_H

Modified: branches/caiinterface/AI/Interfaces/C/InterfaceExport.cpp
===================================================================
--- branches/caiinterface/AI/Interfaces/C/InterfaceExport.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Interfaces/C/InterfaceExport.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -24,9 +24,24 @@
 
 CInterface* myInterface = NULL;
 
-EXPORT(int) initStatic(const SStaticGlobalData* staticGlobalData) {
+static void local_copyToInfoMap(std::map&lt;std::string, std::string&gt;&amp; map,
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues) {
+
+	for (unsigned int i=0; i &lt; infoSize; ++i) {
+		map[infoKeys[i]] = infoValues[i];
+	}
+}
+
+EXPORT(int) initStatic(
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		const SStaticGlobalData* staticGlobalData) {
+
+	std::map&lt;std::string, std::string&gt; infoMap;
+	local_copyToInfoMap(infoMap, infoSize, infoKeys, infoValues);
 	
-	myInterface = new CInterface(staticGlobalData);
+	myInterface = new CInterface(infoMap, staticGlobalData);
 	return 0;
 }
 
@@ -42,9 +57,9 @@
 	return myInterface-&gt;GetLevelOfSupportFor(engineVersion, engineAIInterfaceGeneratedVersion);
 }
 
-EXPORT(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems) {
-	return myInterface-&gt;GetInfo(info, maxInfoItems);
-}
+//EXPORT(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems) {
+//	return myInterface-&gt;GetInfo(info, maxInfoItems);
+//}
 
 
 // skirmish AI methods
@@ -57,11 +72,22 @@
 }
 */
 EXPORT(const struct SSAILibrary*) loadSkirmishAILibrary(
-		const struct InfoItem info[], unsigned int numInfoItems) {
-	return myInterface-&gt;LoadSkirmishAILibrary(info, numInfoItems);
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues) {
+
+	std::map&lt;std::string, std::string&gt; infoMap;
+	local_copyToInfoMap(infoMap, infoSize, infoKeys, infoValues);
+
+	return myInterface-&gt;LoadSkirmishAILibrary(infoMap);
 }
-EXPORT(int) unloadSkirmishAILibrary(const struct SSAISpecifier* const sAISpecifier) {
-	return myInterface-&gt;UnloadSkirmishAILibrary(sAISpecifier);
+EXPORT(int) unloadSkirmishAILibrary(
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues) {
+
+	std::map&lt;std::string, std::string&gt; infoMap;
+	local_copyToInfoMap(infoMap, infoSize, infoKeys, infoValues);
+
+	return myInterface-&gt;UnloadSkirmishAILibrary(infoMap);
 }
 EXPORT(int) unloadAllSkirmishAILibraries() {
 	return myInterface-&gt;UnloadAllSkirmishAILibraries();
@@ -69,22 +95,22 @@
 
 
 
-// group AI methods
-/*
-EXPORT(int) getGroupAISpecifiers(struct SGAISpecifier* gAISpecifiers, int max) {
-	return myInterface-&gt;GetGroupAISpecifiers(gAISpecifiers, max);
-}
-EXPORT(const struct SGAILibrary*) loadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier) {
-	return myInterface-&gt;LoadGroupAILibrary(gAISpecifier);
-}
-*/
-EXPORT(const struct SGAILibrary*) loadGroupAILibrary(
-		const struct InfoItem info[], unsigned int numInfoItems) {
-	return myInterface-&gt;LoadGroupAILibrary(info, numInfoItems);
-}
-EXPORT(int) unloadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier) {
-	return myInterface-&gt;UnloadGroupAILibrary(gAISpecifier);
-}
-EXPORT(int) unloadAllGroupAILibraries() {
-	return myInterface-&gt;UnloadAllGroupAILibraries();
-}
+//// group AI methods
+///*
+//EXPORT(int) getGroupAISpecifiers(struct SGAISpecifier* gAISpecifiers, int max) {
+//	return myInterface-&gt;GetGroupAISpecifiers(gAISpecifiers, max);
+//}
+//EXPORT(const struct SGAILibrary*) loadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier) {
+//	return myInterface-&gt;LoadGroupAILibrary(gAISpecifier);
+//}
+//*/
+//EXPORT(const struct SGAILibrary*) loadGroupAILibrary(
+//		const struct InfoItem info[], unsigned int numInfoItems) {
+//	return myInterface-&gt;LoadGroupAILibrary(info, numInfoItems);
+//}
+//EXPORT(int) unloadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier) {
+//	return myInterface-&gt;UnloadGroupAILibrary(gAISpecifier);
+//}
+//EXPORT(int) unloadAllGroupAILibraries() {
+//	return myInterface-&gt;UnloadAllGroupAILibraries();
+//}

Modified: branches/caiinterface/AI/Interfaces/C/InterfaceExport.h
===================================================================
--- branches/caiinterface/AI/Interfaces/C/InterfaceExport.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Interfaces/C/InterfaceExport.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -35,11 +35,11 @@
 #endif
 
 #include &quot;ExternalAI/Interface/ELevelOfSupport.h&quot;
-struct InfoItem;
+//struct InfoItem;
 struct SSAISpecifier;
 struct SSAILibrary;
-struct SGAISpecifier;
-struct SGAILibrary;
+//struct SGAISpecifier;
+//struct SGAILibrary;
 struct SStaticGlobalData;
 
 // for a list of the functions that have to be exported,
@@ -49,11 +49,13 @@
 
 // static AI interface library functions
 
-EXPORT(int) initStatic(const SStaticGlobalData* staticGlobalData);
+EXPORT(int) initStatic(
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		const SStaticGlobalData* staticGlobalData);
 EXPORT(int) releaseStatic();
 EXPORT(enum LevelOfSupport) getLevelOfSupportFor(
 		const char* engineVersion, int engineAIInterfaceGeneratedVersion);
-EXPORT(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
 
 
 // skirmish AI related methods
@@ -61,25 +63,27 @@
 //EXPORT(int) getSkirmishAISpecifiers(struct SSAISpecifier* sAISpecifiers, int max);
 //EXPORT(const struct SSAILibrary*) loadSkirmishAILibrary(const struct SSAISpecifier* const sAISpecifier);
 EXPORT(const struct SSAILibrary*) loadSkirmishAILibrary(
-		const struct InfoItem info[], unsigned int numInfoItems);
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues);
 EXPORT(int) unloadSkirmishAILibrary(
-		const struct SSAISpecifier* const sAISpecifier);
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues);
 EXPORT(int) unloadAllSkirmishAILibraries();
 
 
-// group AI related methods
+//// group AI related methods
+//
+////EXPORT(int) getGroupAISpecifiers(struct SGAISpecifier* gAISpecifiers, int max);
+////EXPORT(const struct SGAILibrary*) loadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier);
+//EXPORT(const struct SGAILibrary*) loadGroupAILibrary(
+//		const struct InfoItem info[], unsigned int numInfoItems);
+//EXPORT(int) unloadGroupAILibrary(
+//		const struct SGAISpecifier* const gAISpecifier);
+//EXPORT(int) unloadAllGroupAILibraries();
 
-//EXPORT(int) getGroupAISpecifiers(struct SGAISpecifier* gAISpecifiers, int max);
-//EXPORT(const struct SGAILibrary*) loadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier);
-EXPORT(const struct SGAILibrary*) loadGroupAILibrary(
-		const struct InfoItem info[], unsigned int numInfoItems);
-EXPORT(int) unloadGroupAILibrary(
-		const struct SGAISpecifier* const gAISpecifier);
-EXPORT(int) unloadAllGroupAILibraries();
 
-
 #ifdef	__cplusplus
 }
 #endif
 
-#endif	// _INTERFACEEXPORT_H
+#endif // _INTERFACEEXPORT_H

Modified: branches/caiinterface/AI/Interfaces/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-12-01 19:48:22 UTC (rev 7113)
@@ -36,52 +36,76 @@
 
 
 # Java AI Interface
+FIND_PACKAGE(JAVA) # Note: this is not the CMake builtin FindJava
+message(STATUS &quot;Interface JAVA_FOUND: ${JAVA_FOUND}&quot;)
+message(STATUS &quot;Interface JAVA_NOT_FOUND: ${JAVA_NOT_FOUND}&quot;)
+message(STATUS &quot;JAVA_RUNTIME ${JAVA_RUNTIME}&quot;)
+message(STATUS &quot;JAVA_COMPILE ${JAVA_COMPILE}&quot;)
+message(STATUS &quot;JAVA_ARCHIVE ${JAVA_ARCHIVE}&quot;)
 IF (MINGW)
 	set (JAVA_JVM_LIBRARY jvm)
-	set (JAVA_FOUND TRUE)
+	set (JNI_FOUND TRUE)
 ELSE (MINGW)
 	FIND_PACKAGE(JNI)
 	if (JAVA_INCLUDE_PATH)
+		set (JNI_FOUND TRUE)
 		include_directories(${JAVA_INCLUDE_PATH} ${JAVA_INCLUDE_PATH2} ${JNI_INCLUDE_DIRS})
 		#link_directories(${JAVA_JVM_LIBRARY})
 		#message(&quot;JAVA_JVM_LIBRARY ${JAVA_JVM_LIBRARY}&quot;)
 		#message(&quot;JAVA_JVM_LIB_PATH ${JAVA_JVM_LIB_PATH}&quot;)
 		#message(&quot;JNI_LIBRARIES ${JNI_LIBRARIES}&quot;)
-		set (JAVA_FOUND TRUE)
 	else (JAVA_INCLUDE_PATH)
+		set (JNI_FOUND FALSE)
 		message (&quot;No Java includes found -&gt; Java AI Interface will not be built&quot;)
 	endif (JAVA_INCLUDE_PATH)
 ENDIF (MINGW)
+message(STATUS &quot;Interface JNI_FOUND: ${JNI_FOUND}&quot;)
 set(Java_AIINTERFACE_SRC &quot;${AI_INTERFACES_SRC}/Java&quot;)
-if (JAVA_FOUND AND EXISTS ${Java_AIINTERFACE_SRC} AND EXISTS ${Java_AIINTERFACE_SRC}/bin)
+if (JNI_FOUND AND JAVA_FOUND AND EXISTS ${Java_AIINTERFACE_SRC} AND EXISTS ${Java_AIINTERFACE_SRC}/bin)
 	set(Java_AIINTERFACE_VERS &quot;UNKNOWN_VERSION&quot;)
 	if (EXISTS ${Java_AIINTERFACE_SRC}/VERSION)
 		file(STRINGS &quot;${Java_AIINTERFACE_SRC}/VERSION&quot; Java_AIINTERFACE_VERS LIMIT_COUNT 1)
 	endif (EXISTS ${Java_AIINTERFACE_SRC}/VERSION)
 	set(Java_AIINTERFACE_TARGET &quot;Java-${Java_AIINTERFACE_VERS}&quot;)
 	set(Java_AIINTERFACE_DATA_DIR ${AI_INTERFACES_DATA}/Java/${Java_AIINTERFACE_VERS})
+	#set(Java_AIINTERFACE_PKG &quot;com.clan_sy.spring.ai&quot;)
+	set(Java_AIINTERFACE_PKG &quot;com/clan_sy/spring/ai&quot;)
+	set(Java_AIINTERFACE_PKG_FIRST_PART &quot;com&quot;)
+	set(Java_AIINTERFACE_CLASSPATH &quot;.:${PATH_DELIM}${Java_AIINTERFACE_SRC}/jlib/jna.jar${PATH_DELIM}${Java_AIINTERFACE_SRC}/jlib/vecmath.jar&quot;)
 	message(STATUS &quot;${Java_AIINTERFACE_VERS}\t(Java AI Interface Version)&quot;)
 
+	# handle native part
 	aux_source_directory(${Java_AIINTERFACE_SRC} javaAIInterface)
 	add_library(${Java_AIINTERFACE_TARGET} MODULE ${javaAIInterface} ${aienv})
 	target_link_libraries(${Java_AIINTERFACE_TARGET} ${JAVA_JVM_LIBRARY})
-	install (FILES ${Java_AIINTERFACE_SRC}/InterfaceInfo.lua DESTINATION ${Java_AIINTERFACE_DATA_DIR})
-	install (TARGETS ${Java_AIINTERFACE_TARGET} DESTINATION ${Java_AIINTERFACE_DATA_DIR})
+	install(FILES ${Java_AIINTERFACE_SRC}/InterfaceInfo.lua DESTINATION ${Java_AIINTERFACE_DATA_DIR})
+	install(TARGETS ${Java_AIINTERFACE_TARGET} DESTINATION ${Java_AIINTERFACE_DATA_DIR})
 	INCLUDE_DIRECTORIES(BEFORE ${CMAKE_SOURCE_DIR}/rts/lib/streflop)
 	TARGET_LINK_LIBRARIES(${Java_AIINTERFACE_TARGET} streflop)
 	set_target_properties(${Java_AIINTERFACE_TARGET} PROPERTIES COMPILE_FLAGS &quot;-DSTREFLOP_SSE&quot;)
+
+	# handle Java part
+	file(REMOVE_RECURSE &quot;${Java_AIINTERFACE_SRC}/build&quot;)
+	file(MAKE_DIRECTORY &quot;${Java_AIINTERFACE_SRC}/build&quot;)
+	file(GLOB_RECURSE Java_AIINTERFACE_JAVA_SOURCES RELATIVE &quot;${Java_AIINTERFACE_SRC}/java/src&quot; FOLLOW_SYMLINKS &quot;${Java_AIINTERFACE_SRC}/java/src/*.java&quot;)
 	add_custom_command(TARGET ${Java_AIINTERFACE_TARGET} POST_BUILD
-		COMMAND &quot;${Java_AIINTERFACE_SRC}/bin/java_buildAll.${SHELL_EXEC_POSTFIX}&quot;
-		ARGS &quot;${Java_AIINTERFACE_VERS}&quot;
+		COMMAND &quot;${Java_AIINTERFACE_SRC}/bin/java_generateWrappers.${SHELL_EXEC_POSTFIX}&quot; ARGS &quot;${Java_AIINTERFACE_VERS}&quot;
 		WORKING_DIRECTORY &quot;${Java_AIINTERFACE_SRC}/bin&quot;
-		COMMENT &quot;  Creating Java library interface.jar&quot; VERBATIM)
-
-	# Install the Java part of the interface
-	install (FILES ${Java_AIINTERFACE_SRC}/java/interface.jar DESTINATION ${Java_AIINTERFACE_DATA_DIR}/jlib)
+		COMMENT &quot;  Generating Java source files ...&quot; VERBATIM)
+	add_custom_command(TARGET ${Java_AIINTERFACE_TARGET} POST_BUILD
+		COMMAND &quot;${JAVA_COMPILE}&quot; &quot;-cp&quot; &quot;${Java_AIINTERFACE_CLASSPATH}&quot; &quot;-d&quot; &quot;${Java_AIINTERFACE_SRC}/build&quot; ${Java_AIINTERFACE_JAVA_SOURCES}
+		WORKING_DIRECTORY &quot;${Java_AIINTERFACE_SRC}/java/src&quot;
+		COMMENT &quot;  Compiling Java sources ...&quot; VERBATIM)
+	add_custom_command(TARGET ${Java_AIINTERFACE_TARGET} POST_BUILD
+		COMMAND &quot;${JAVA_ARCHIVE}&quot; &quot;cmf&quot; &quot;${Java_AIINTERFACE_SRC}/java/src/manifest.mf&quot; &quot;${Java_AIINTERFACE_SRC}/interface.jar&quot; &quot;-C&quot; &quot;${Java_AIINTERFACE_SRC}/build&quot; &quot;${Java_AIINTERFACE_PKG_FIRST_PART}&quot;
+		WORKING_DIRECTORY &quot;${Java_AIINTERFACE_SRC}/bin&quot;
+		COMMENT &quot;  Creating Java library interface.jar ...&quot; VERBATIM)
+	install(FILES ${Java_AIINTERFACE_SRC}/interface.jar DESTINATION ${Java_AIINTERFACE_DATA_DIR})
+	#install(FILES ${Java_AIINTERFACE_SRC}/java/interface.jar DESTINATION ${Java_AIINTERFACE_DATA_DIR}/jlib)
 	install(DIRECTORY ${Java_AIINTERFACE_SRC}/jlib/ DESTINATION ${Java_AIINTERFACE_DATA_DIR}/jlib FILES_MATCHING PATTERN &quot;*.jar&quot;)
 
 # Install the Java test Skirmish AI (only a temp solution here, move it to AI/Skirmish/...)
-install (FILES ${Java_AIINTERFACE_SRC}/java/ai.jar DESTINATION ${CMAKE_SOURCE_DIR}/AI/Skirmish/hoijuiAI/${Java_AIINTERFACE_VERS})
-install (FILES ${Java_AIINTERFACE_SRC}/AIInfo.lua DESTINATION ${CMAKE_SOURCE_DIR}/AI/Skirmish/hoijuiAI/${Java_AIINTERFACE_VERS})
-endif (JAVA_FOUND AND EXISTS ${Java_AIINTERFACE_SRC} AND EXISTS ${Java_AIINTERFACE_SRC}/bin)
+#install (FILES ${Java_AIINTERFACE_SRC}/java/ai.jar DESTINATION ${CMAKE_SOURCE_DIR}/AI/Skirmish/hoijuiAI/${Java_AIINTERFACE_VERS})
+#install (FILES ${Java_AIINTERFACE_SRC}/AIInfo.lua DESTINATION ${CMAKE_SOURCE_DIR}/AI/Skirmish/hoijuiAI/${Java_AIINTERFACE_VERS})
+endif (JNI_FOUND AND JAVA_FOUND AND EXISTS ${Java_AIINTERFACE_SRC} AND EXISTS ${Java_AIINTERFACE_SRC}/bin)
 

Modified: branches/caiinterface/AI/Interfaces/Java/InterfaceUtil.c
===================================================================
--- branches/caiinterface/AI/Interfaces/Java/InterfaceUtil.c	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Interfaces/Java/InterfaceUtil.c	2008-12-01 19:48:22 UTC (rev 7113)
@@ -353,3 +353,22 @@
 	return shortNameFits &amp;&amp; versionFits;
 }
 */
+
+const char* util_map_getValueByKey(
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		const char* key) {
+
+	const char* value = NULL;
+
+	unsigned int i;
+    for (i = 0; i &lt; infoSize; i++) {
+		if (strcmp(infoKeys[i], key) == 0) {
+			value = infoValues[i];
+			break;
+		}
+    }
+
+	return value;
+}
+

Modified: branches/caiinterface/AI/Interfaces/Java/InterfaceUtil.h
===================================================================
--- branches/caiinterface/AI/Interfaces/Java/InterfaceUtil.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Interfaces/Java/InterfaceUtil.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -16,7 +16,7 @@
 */
 
 #ifndef _INTERFACEUTIL_H
-#define	_INTERFACEUTIL_H
+#define _INTERFACEUTIL_H
 
 #ifdef	__cplusplus
 extern &quot;C&quot; {
@@ -90,8 +90,16 @@
 		const char* relativeDirPath, char* absoluteDirPath,
 		bool searchOnlyWriteable, bool create);
 
+/**
+ * Return NULL if the key was not found.
+ */
+const char* util_map_getValueByKey(
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		const char* key);
+
 #ifdef	__cplusplus
 }
 #endif
 
-#endif	// _INTERFACEUTIL_H
+#endif // _INTERFACEUTIL_H

Modified: branches/caiinterface/AI/Skirmish/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-12-01 19:48:22 UTC (rev 7113)
@@ -3,8 +3,8 @@
 
 set(SKIRMISH_SRC &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish&quot;)
 set(SKIRMISH_DATA &quot;${DATADIR}/AI/Skirmish&quot;)
+FIND_PACKAGE(Java)
 
-
 ## KAI
 set(KAI_SRC &quot;${SKIRMISH_SRC}/KAI&quot;)
 if (EXISTS ${KAI_SRC})
@@ -165,6 +165,41 @@
 endif (EXISTS ${NullAI_SRC})
 
 
+## Null Java AI
+FIND_PACKAGE(JAVA) # Note: this is not the CMake builtin FindJava
+set(NullJavaAI_SRC &quot;${SKIRMISH_SRC}/NullJavaAI&quot;)
+if (JAVA_FOUND AND EXISTS ${NullJavaAI_SRC})
+	set(NullJavaAI_VERS &quot;UNKNOWN_VERSION&quot;)
+	if (EXISTS ${NullJavaAI_SRC}/VERSION)
+		file(STRINGS &quot;${NullJavaAI_SRC}/VERSION&quot; NullJavaAI_VERS LIMIT_COUNT 1)
+	endif (EXISTS ${NullJavaAI_SRC}/VERSION)
+	set(NullJavaAI_TARGET &quot;NullJavaAI-${NullJavaAI_VERS}&quot;)
+	set(NullJavaAI_DATA_DIR ${SKIRMISH_DATA}/NullJavaAI/${NullJavaAI_VERS})
+	set(NullJavaAI_PKG &quot;nulljavaai&quot;)
+	set(NullJavaAI_PKG_FIRST_PART &quot;nulljavaai&quot;)
+	set(Java_AIINTERFACE_SRC &quot;../../Interfaces/Java&quot;)
+	set(NullJavaAI_CLASSPATH &quot;.${PATH_DELIM}${Java_AIINTERFACE_SRC}/interface.jar${PATH_DELIM}${Java_AIINTERFACE_SRC}/jlib/jna.jar${PATH_DELIM}${Java_AIINTERFACE_SRC}/jlib/vecmath.jar&quot;)
+	message(STATUS &quot;${NullJavaAI_VERS}\t(NullJavaAI Version)&quot;)
+
+	file(REMOVE_RECURSE &quot;${NullJavaAI_SRC}/build&quot;)
+	file(MAKE_DIRECTORY &quot;${NullJavaAI_SRC}/build&quot;)
+	file(GLOB_RECURSE NullJavaAI_JAVA_SOURCES RELATIVE &quot;${NullJavaAI_SRC}&quot; FOLLOW_SYMLINKS &quot;${NullJavaAI_SRC}*.java&quot;)
+	#add_custom_command(OUTPUT &quot;${NullJavaAI_DATA_DIR}/ai.jar&quot;
+	#add_custom_command(TARGET ${NullJavaAI_TARGET}
+	add_custom_target(${NullJavaAI_TARGET} ALL
+		COMMAND &quot;${JAVA_COMPILE}&quot; &quot;-cp&quot; &quot;\&quot;${NullJavaAI_CLASSPATH}\&quot;&quot; &quot;-d&quot; &quot;${NullJavaAI_SRC}/build&quot; &quot;${NullJavaAI_JAVA_SOURCES}&quot;
+		COMMAND &quot;${JAVA_ARCHIVE}&quot; &quot;cmf&quot; &quot;${NullJavaAI_SRC}/manifest.mf&quot; &quot;${NullJavaAI_SRC}/ai.jar&quot; &quot;-C&quot; &quot;${NullJavaAI_SRC}/build&quot; &quot;${NullJavaAI_PKG_FIRST_PART}&quot;
+		WORKING_DIRECTORY &quot;${NullJavaAI_SRC}&quot;
+		COMMENT &quot;  Creating Java AI library ai.jar&quot; VERBATIM)
+
+	install (FILES ${NullJavaAI_SRC}/AIInfo.lua DESTINATION ${NullJavaAI_DATA_DIR})
+	if (EXISTS ${NullJavaAI_SRC}/AIOptions.lua)
+		install (FILES ${NullJavaAI_SRC}/AIOptions.lua DESTINATION ${NullJavaAI_DATA_DIR})
+	endif (EXISTS ${NullJavaAI_SRC}/AIOptions.lua)
+	install (FILES ${NullJavaAI_SRC}/ai.jar DESTINATION ${NullJavaAI_DATA_DIR})
+endif (JAVA_FOUND AND EXISTS ${NullJavaAI_SRC})
+
+
 ## JCAI
 # does currently not build in win32
 if (UNIX)

Modified: branches/caiinterface/AI/Skirmish/KAIK/AIExport.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/KAIK/AIExport.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Skirmish/KAIK/AIExport.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -33,35 +33,8 @@
 
 
 std::map&lt;int, CAIGlobalAI*&gt; myAIs; // teamId -&gt; AI map
-std::vector&lt;InfoItem&gt; myInfo;
 
 
-EXPORT(unsigned int) getInfo(int teamId,
-		struct InfoItem info[], unsigned int maxInfoItems) {
-
-	unsigned int i = 0;
-
-	// initialize the myInfo
-	if (myInfo.empty()) {
-		InfoItem ii_0 = {SKIRMISH_AI_PROPERTY_SHORT_NAME, &quot;KAIK&quot;, NULL}; myInfo.push_back(ii_0);
-		InfoItem ii_1 = {SKIRMISH_AI_PROPERTY_VERSION, &quot;0.13&quot;, NULL}; myInfo.push_back(ii_1);
-		InfoItem ii_2 = {SKIRMISH_AI_PROPERTY_NAME, &quot;Kloots Skirmish AI&quot;, NULL}; myInfo.push_back(ii_2);
-		InfoItem ii_3 = {SKIRMISH_AI_PROPERTY_DESCRIPTION, &quot;This Skirmish AI supports most TA based mods and plays decently.&quot;, NULL}; myInfo.push_back(ii_3);
-		InfoItem ii_4 = {SKIRMISH_AI_PROPERTY_URL, &quot;<A HREF="http://spring.clan-sy.com/wiki/AI:KAIK">http://spring.clan-sy.com/wiki/AI:KAIK</A>&quot;, NULL}; myInfo.push_back(ii_4);
-		InfoItem ii_5 = {SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED, &quot;no&quot;, NULL}; myInfo.push_back(ii_5);
-	}
-
-	// copy myInfo to the argument container info
-	std::vector&lt;InfoItem&gt;::const_iterator inf;
-	for (inf=myInfo.begin(); inf!=myInfo.end() &amp;&amp; i &lt; maxInfoItems; inf++) {
-		info[i] = *inf;
-		i++;
-	}
-
-	// return the number of elements copied to info 
-	return i;
-}
-
 EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 		const char* engineVersionString, int engineVersionNumber,
 		const char* aiInterfaceShortName, const char* aiInterfaceVersion) {
@@ -74,13 +47,11 @@
 	return LOS_None;
 }
 
-EXPORT(unsigned int) getOptions(int teamId,
-		struct Option options[], unsigned int maxOptions) {
-	return 0;
-}
-
 EXPORT(int) init(int teamId,
-		const struct InfoItem info[], unsigned int numInfoItems) {
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues) {
 
 	if (myAIs.count(teamId) &gt; 0) {
 		// the map already has an AI for this team.

Modified: branches/caiinterface/AI/Skirmish/KAIK/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/KAIK/AIExport.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Skirmish/KAIK/AIExport.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,19 +1,19 @@
 /*
-    Copyright 2008  Nicolas Wu
-    
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	Copyright 2008  Nicolas Wu
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
 
-    You should have received a copy of the GNU General Public License
-    along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-	
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
 	@author Nicolas Wu
 	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
@@ -32,26 +32,21 @@
 #include &quot;ExternalAI/Interface/aidefines.h&quot;
 #include &quot;ExternalAI/Interface/ELevelOfSupport.h&quot;
 
-struct InfoItem;
-struct Option;
-
 // for a list of the functions that have to be exported,
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-EXPORT(unsigned int) getInfo(int teamId,
-		struct InfoItem info[], unsigned int maxInfoItems);
 EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 		const char* engineVersionString, int engineVersionNumber,
 		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-EXPORT(unsigned int) getOptions(int teamId,
-		struct Option options[], unsigned int maxOptions);
 
 // team instance functions
 EXPORT(int) init(int teamId,
-		const struct InfoItem info[], unsigned int numInfoItems);
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues);
 EXPORT(int) release(int teamId);
 EXPORT(int) handleEvent(int teamId, int topic, const void* data);
 
-#endif /* _AIEXPORT_H */
-
+#endif // _AIEXPORT_H

Modified: branches/caiinterface/AI/Skirmish/NullAI/AIExport.c
===================================================================
--- branches/caiinterface/AI/Skirmish/NullAI/AIExport.c	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Skirmish/NullAI/AIExport.c	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,19 +1,19 @@
 /*
-    Copyright 2008  Nicolas Wu
-    
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	Copyright 2008  Nicolas Wu
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
 
-    You should have received a copy of the GNU General Public License
-    along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-	
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
 	@author Nicolas Wu
 	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
@@ -22,20 +22,20 @@
 If we do not have an init() method, then we would instead pass
 an event InitEvent to handleEvent. However, we would have to make
 handleEvent have to wait for an InitEvent as a special case, since
-the team in question would not yet exist. 
+the team in question would not yet exist.
 
 Therefore, the handleEvent code would look like this:
 [code]
 EXPORT(int) handleEvent(int teamId, int topic, const void* data) {
-    if (topic == INIT_EVENT) {
-        myAIs[teamId] = CAIObject();
-    }
-    if (myAIs.count(teamId) &gt; 0){
-        // allow the AI instance to handle the event.
-        return myAIs[teamId].handleEvent(topic, data);
-    }
-    // no AI for that team, so return error.
-    else return -1;
+	if (topic == INIT_EVENT) {
+		myAIs[teamId] = CAIObject();
+	}
+	if (myAIs.count(teamId) &gt; 0){
+		// allow the AI instance to handle the event.
+		return myAIs[teamId].handleEvent(topic, data);
+	}
+	// no AI for that team, so return error.
+	else return -1;
 }
 [/code]
 Advantages:
@@ -51,7 +51,7 @@
 I think we should keep it as minimal as possible, and ideally everything
 would go through handleEvent. Practically though, it does not make sense
 to do this: we'll be wasting our own time for no good reason in the
-case of initialisation. 
+case of initialisation.
 
 The (in my opinion much cleaner) alternative is the one I've implemented.
 Advantages:
@@ -62,9 +62,9 @@
 Disadvantage:
 * People might start adding other functions to the interface.
 
-I don't think that the disadvantage is a real one: it's pretty standard to 
+I don't think that the disadvantage is a real one: it's pretty standard to
 see initialisation as a special case. It's pretty clear that everything
-else goes through handleEvent. 
+else goes through handleEvent.
 
 The advantage is clear: a more efficient, simpler design. Of course, you could
 argue that the efficiency is nominal, one extra if per event is very little cost,
@@ -87,9 +87,9 @@
 #include &quot;AIExport.h&quot;
 
 EXPORT(int) handleEvent(int teamId, int topic, const void* data) {
-	
+
 	// TODO: do something
-	
+
 	// signal: ok
 	return 0;
 }

Modified: branches/caiinterface/AI/Skirmish/NullAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/NullAI/AIExport.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Skirmish/NullAI/AIExport.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,19 +1,19 @@
 /*
-    Copyright 2008  Nicolas Wu
-    
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	Copyright 2008  Nicolas Wu
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
 
-    You should have received a copy of the GNU General Public License
-    along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-	
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
 	@author Nicolas Wu
 	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
@@ -35,26 +35,21 @@
 #include &quot;ExternalAI/Interface/aidefines.h&quot;
 //#include &quot;ExternalAI/Interface/ELevelOfSupport.h&quot;
 
-//struct InfoItem;
-//struct Option;
-
 // for a list of the functions that have to be exported,
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-//EXPORT(unsigned int) getInfo(int teamId,
-//		struct InfoItem info[], unsigned int maxInfoItems);
 //EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 //		const char* engineVersionString, int engineVersionNumber,
 //		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-//EXPORT(unsigned int) getOptions(int teamId,
-//		struct Option options[], unsigned int maxOptions);
 
 // team instance functions
 //EXPORT(int) init(int teamId,
-//		const struct InfoItem info[], unsigned int numInfoItems);
+//		unsigned int infoSize,
+//		const char** infoKeys, const char** infoValues,
+//		unsigned int optionsSize,
+//		const char** optionsKeys, const char** optionsValues);
 //EXPORT(int) release(int teamId);
 EXPORT(int) handleEvent(int teamId, int topic, const void* data);
 
-#endif /* _AIEXPORT_H */
-
+#endif // _AIEXPORT_H

Modified: branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,19 +1,19 @@
 /*
-    Copyright 2008  Nicolas Wu
-    
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	Copyright 2008  Nicolas Wu
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
 
-    You should have received a copy of the GNU General Public License
-    along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-	
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
 	@author Nicolas Wu
 	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
@@ -35,48 +35,51 @@
 
 
 EXPORT(int) init(int teamId,
-		const struct InfoItem info[], unsigned int numInfoItems) {
-	
-    if (myAIs.count(teamId) &gt; 0) {
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues) {
+
+	if (myAIs.count(teamId) &gt; 0) {
 		// the map already has an AI for this team.
 		// raise an error, since it's probably a mistake if we're trying
 		// to reinitialise a team that already had init() called on it.
-        return -1;
-    }
-	
-    // CAIGlobalAI is the Legacy C++ wrapper, TestGlobalAI is NullLegacyCppAI
-    myAIs[teamId] = new CAIGlobalAI(teamId, new TestGlobalAI());
-	
+		return -1;
+	}
+
+	// CAIGlobalAI is the Legacy C++ wrapper, TestGlobalAI is NullLegacyCppAI
+	myAIs[teamId] = new CAIGlobalAI(teamId, new TestGlobalAI());
+
 	// signal: ok
 	return 0;
 }
 
 EXPORT(int) release(int teamId) {
-	
-    if (myAIs.count(teamId) == 0) {
+
+	if (myAIs.count(teamId) == 0) {
 		// the map has no AI for this team.
 		// raise an error, since it's probably a mistake if we're trying to
 		// release a team that's not initialized.
-        return -1;
-    }
-	
-    delete myAIs[teamId];
+		return -1;
+	}
+
+	delete myAIs[teamId];
 	myAIs.erase(teamId);
-	
+
 	// signal: ok
 	return 0;
 }
 
 EXPORT(int) handleEvent(int teamId, int topic, const void* data) {
-	
-    if (teamId &lt; 0) {
+
+	if (teamId &lt; 0) {
 		// events sent to team -1 will always be to the AI object itself,
 		// not to a particular team.
 	} else if (myAIs.count(teamId) &gt; 0) {
-        // allow the AI instance to handle the event.
-        return myAIs[teamId]-&gt;handleEvent(topic, data);
+		// allow the AI instance to handle the event.
+		return myAIs[teamId]-&gt;handleEvent(topic, data);
 	}
-	
+
 	// no AI for that team, so return error.
 	return -1;
 }

Modified: branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,19 +1,19 @@
 /*
-    Copyright 2008  Nicolas Wu
-    
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
+	Copyright 2008  Nicolas Wu
 
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
 
-    You should have received a copy of the GNU General Public License
-    along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-	
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+
 	@author Nicolas Wu
 	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
@@ -32,26 +32,21 @@
 #include &quot;ExternalAI/Interface/aidefines.h&quot;
 //#include &quot;ExternalAI/Interface/ELevelOfSupport.h&quot;
 
-//struct InfoItem;
-//struct Option;
-
 // for a list of the functions that have to be exported,
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-//EXPORT(unsigned int) getInfo(int teamId,
-//		struct InfoItem info[], unsigned int maxInfoItems);
 //EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 //		const char* engineVersionString, int engineVersionNumber,
 //		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-//EXPORT(unsigned int) getOptions(int teamId,
-//		struct Option options[], unsigned int maxOptions);
 
 // team instance functions
 EXPORT(int) init(int teamId,
-		const struct InfoItem info[], unsigned int numInfoItems);
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues);
 EXPORT(int) release(int teamId);
 EXPORT(int) handleEvent(int teamId, int topic, const void* data);
 
-#endif /* _AIEXPORT_H */
-
+#endif // _AIEXPORT_H

Modified: branches/caiinterface/AI/Skirmish/RAI/AIExport.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/RAI/AIExport.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Skirmish/RAI/AIExport.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -36,46 +36,6 @@
 
 std::map&lt;int, CAIGlobalAI*&gt; myAIs; // teamId -&gt; AI map
 
-EXPORT(unsigned int) getInfo(int teamId,
-		struct InfoItem info[], unsigned int maxInfoItems) {
-
-	unsigned int i = 0;
-
-	if (i &lt; maxInfoItems) {
-		InfoItem ii = {SKIRMISH_AI_PROPERTY_SHORT_NAME, MY_SHORT_NAME, NULL};
-		info[i] = ii;
-		i++;
-	}
-	if (i &lt; maxInfoItems) {
-		InfoItem ii = {SKIRMISH_AI_PROPERTY_VERSION, MY_VERSION, NULL};
-		info[i] = ii;
-		i++;
-	}
-	if (i &lt; maxInfoItems) {
-		InfoItem ii = {SKIRMISH_AI_PROPERTY_NAME, &quot;Reths Skirmish AI&quot;, NULL};
-		info[i] = ii;
-		i++;
-	}
-	if (i &lt; maxInfoItems) {
-		InfoItem ii = {SKIRMISH_AI_PROPERTY_DESCRIPTION, &quot;This Skirmish AI supports most mods and plays decently.&quot;, NULL};
-		info[i] = ii;
-		i++;
-	}
-	if (i &lt; maxInfoItems) {
-		InfoItem ii = {SKIRMISH_AI_PROPERTY_URL, &quot;<A HREF="http://spring.clan-sy.com/wiki/AI:RAI">http://spring.clan-sy.com/wiki/AI:RAI</A>&quot;, NULL};
-		info[i] = ii;
-		i++;
-	}
-	if (i &lt; maxInfoItems) {
-		InfoItem ii = {SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED, &quot;no&quot;, NULL};
-		info[i] = ii;
-		i++;
-	}
-
-	// return the number of elements copied to info
-	return i;
-}
-
 EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 		const char* engineVersionString, int engineVersionNumber,
 		const char* aiInterfaceShortName, const char* aiInterfaceVersion) {
@@ -88,13 +48,11 @@
 	return LOS_None;
 }
 
-EXPORT(unsigned int) getOptions(int teamId,
-		struct Option options[], unsigned int maxOptions) {
-	return 0;
-}
-
 EXPORT(int) init(int teamId,
-		const struct InfoItem info[], unsigned int numInfoItems) {
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues) {
 
 	if (myAIs.count(teamId) &gt; 0) {
 		// the map already has an AI for this team.

Modified: branches/caiinterface/AI/Skirmish/RAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/RAI/AIExport.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Skirmish/RAI/AIExport.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright 2008  Nicolas Wu
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -13,7 +13,7 @@
 
 	You should have received a copy of the GNU General Public License
 	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-	
+
 	@author Nicolas Wu
 	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
 */
@@ -32,26 +32,21 @@
 #include &quot;ExternalAI/Interface/aidefines.h&quot;
 #include &quot;ExternalAI/Interface/ELevelOfSupport.h&quot;
 
-struct InfoItem;
-struct Option;
-
 // for a list of the functions that have to be exported,
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-EXPORT(unsigned int) getInfo(int teamId,
-		struct InfoItem info[], unsigned int maxInfoItems);
 EXPORT(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 		const char* engineVersionString, int engineVersionNumber,
 		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-EXPORT(unsigned int) getOptions(int teamId,
-		struct Option options[], unsigned int maxOptions);
 
 // team instance functions
 EXPORT(int) init(int teamId,
-		const struct InfoItem info[], unsigned int numInfoItems);
+		unsigned int infoSize,
+		const char** infoKeys, const char** infoValues,
+		unsigned int optionsSize,
+		const char** optionsKeys, const char** optionsValues);
 EXPORT(int) release(int teamId);
 EXPORT(int) handleEvent(int teamId, int topic, const void* data);
 
-#endif /* _AIEXPORT_H */
-
+#endif // _AIEXPORT_H

Modified: branches/caiinterface/AI/Wrappers/LegacyCpp/AIAICallback.cpp
===================================================================
--- branches/caiinterface/AI/Wrappers/LegacyCpp/AIAICallback.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/AI/Wrappers/LegacyCpp/AIAICallback.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -803,13 +803,13 @@
 
 bool CAIAICallback::GetUnitResourceInfo(int unitId, UnitResourceInfo* resourceInfo) {
 
-	int m = getResourceIndex_Metal(sAICallback, teamId);
-	int e = getResourceIndex_Energy(sAICallback, teamId);
-	resourceInfo-&gt;energyMake = sAICallback-&gt;Clb_Unit_ResourceInfo_getMake(teamId, unitId, e);
+	static int m = getResourceIndex_Metal(sAICallback, teamId);
+	static int e = getResourceIndex_Energy(sAICallback, teamId);
+	resourceInfo-&gt;energyMake = sAICallback-&gt;Clb_Unit_0REF1Resource2resourceIndex0getResourceMake(teamId, unitId, e);
 	if (resourceInfo-&gt;energyMake &lt; 0) { return false; }
-	resourceInfo-&gt;energyUse = sAICallback-&gt;Clb_Unit_ResourceInfo_getUse(teamId, unitId, e);
-	resourceInfo-&gt;metalMake = sAICallback-&gt;Clb_Unit_ResourceInfo_getMake(teamId, unitId, m);
-	resourceInfo-&gt;metalUse = sAICallback-&gt;Clb_Unit_ResourceInfo_getUse(teamId, unitId, m);
+	resourceInfo-&gt;energyUse = sAICallback-&gt;Clb_Unit_0REF1Resource2resourceIndex0getResourceUse(teamId, unitId, e);
+	resourceInfo-&gt;metalMake = sAICallback-&gt;Clb_Unit_0REF1Resource2resourceIndex0getResourceMake(teamId, unitId, m);
+	resourceInfo-&gt;metalUse = sAICallback-&gt;Clb_Unit_0REF1Resource2resourceIndex0getResourceUse(teamId, unitId, m);
 	return true;
 }
 
@@ -821,6 +821,8 @@
 
 const UnitDef* CAIAICallback::GetUnitDefById(int unitDefId) {
 	//logT(&quot;entering: GetUnitDefById sAICallback&quot;);
+	static int m = getResourceIndex_Metal(sAICallback, teamId);
+	static int e = getResourceIndex_Energy(sAICallback, teamId);
 
 	if (unitDefId &lt; 0) {
 		return NULL;
@@ -834,26 +836,26 @@
 unitDef-&gt;valid = sAICallback-&gt;Clb_UnitDef_isValid(teamId, unitDefId);
 unitDef-&gt;name = sAICallback-&gt;Clb_UnitDef_getName(teamId, unitDefId);
 unitDef-&gt;humanName = sAICallback-&gt;Clb_UnitDef_getHumanName(teamId, unitDefId);
-unitDef-&gt;filename = sAICallback-&gt;Clb_UnitDef_getFilename(teamId, unitDefId);
+unitDef-&gt;filename = sAICallback-&gt;Clb_UnitDef_getFileName(teamId, unitDefId);
 unitDef-&gt;id = unitDefId;
 unitDef-&gt;aihint = sAICallback-&gt;Clb_UnitDef_getAiHint(teamId, unitDefId);
 unitDef-&gt;cobID = sAICallback-&gt;Clb_UnitDef_getCobId(teamId, unitDefId);
 unitDef-&gt;techLevel = sAICallback-&gt;Clb_UnitDef_getTechLevel(teamId, unitDefId);
 unitDef-&gt;gaia = sAICallback-&gt;Clb_UnitDef_getGaia(teamId, unitDefId);
-unitDef-&gt;metalUpkeep = sAICallback-&gt;Clb_UnitDef_getMetalUpkeep(teamId, unitDefId);
-unitDef-&gt;energyUpkeep = sAICallback-&gt;Clb_UnitDef_getEnergyUpkeep(teamId, unitDefId);
-unitDef-&gt;metalMake = sAICallback-&gt;Clb_UnitDef_getMetalMake(teamId, unitDefId);
-unitDef-&gt;makesMetal = sAICallback-&gt;Clb_UnitDef_getMakesMetal(teamId, unitDefId);
-unitDef-&gt;energyMake = sAICallback-&gt;Clb_UnitDef_getEnergyMake(teamId, unitDefId);
-unitDef-&gt;metalCost = sAICallback-&gt;Clb_UnitDef_getMetalCost(teamId, unitDefId);
-unitDef-&gt;energyCost = sAICallback-&gt;Clb_UnitDef_getEnergyCost(teamId, unitDefId);
+unitDef-&gt;metalUpkeep = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getUpkeep(teamId, unitDefId, m);
+unitDef-&gt;energyUpkeep = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getUpkeep(teamId, unitDefId, e);
+unitDef-&gt;metalMake = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getResourceMake(teamId, unitDefId, m);
+unitDef-&gt;makesMetal = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getMakesResource(teamId, unitDefId, m);
+unitDef-&gt;energyMake = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getResourceMake(teamId, unitDefId, e);
+unitDef-&gt;metalCost = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getCost(teamId, unitDefId, m);
+unitDef-&gt;energyCost = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getCost(teamId, unitDefId, e);
 unitDef-&gt;buildTime = sAICallback-&gt;Clb_UnitDef_getBuildTime(teamId, unitDefId);
-unitDef-&gt;extractsMetal = sAICallback-&gt;Clb_UnitDef_getExtractsMetal(teamId, unitDefId);
-unitDef-&gt;extractRange = sAICallback-&gt;Clb_UnitDef_getExtractRange(teamId, unitDefId);
-unitDef-&gt;windGenerator = sAICallback-&gt;Clb_UnitDef_getWindGenerator(teamId, unitDefId);
-unitDef-&gt;tidalGenerator = sAICallback-&gt;Clb_UnitDef_getTidalGenerator(teamId, unitDefId);
-unitDef-&gt;metalStorage = sAICallback-&gt;Clb_UnitDef_getMetalStorage(teamId, unitDefId);
-unitDef-&gt;energyStorage = sAICallback-&gt;Clb_UnitDef_getEnergyStorage(teamId, unitDefId);
+unitDef-&gt;extractsMetal = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getExtractsResource(teamId, unitDefId, m);
+unitDef-&gt;extractRange = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getResourceExtractorRange(teamId, unitDefId, m);
+unitDef-&gt;windGenerator = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getWindResourceGenerator(teamId, unitDefId, e);
+unitDef-&gt;tidalGenerator = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getTidalResourceGenerator(teamId, unitDefId, e);
+unitDef-&gt;metalStorage = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getStorage(teamId, unitDefId, m);
+unitDef-&gt;energyStorage = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getStorage(teamId, unitDefId, e);
 unitDef-&gt;autoHeal = sAICallback-&gt;Clb_UnitDef_getAutoHeal(teamId, unitDefId);
 unitDef-&gt;idleAutoHeal = sAICallback-&gt;Clb_UnitDef_getIdleAutoHeal(teamId, unitDefId);
 unitDef-&gt;idleTime = sAICallback-&gt;Clb_UnitDef_getIdleTime(teamId, unitDefId);
@@ -899,11 +901,11 @@
 unitDef-&gt;maxWaterDepth = sAICallback-&gt;Clb_UnitDef_getMaxWaterDepth(teamId, unitDefId);
 unitDef-&gt;armoredMultiple = sAICallback-&gt;Clb_UnitDef_getArmoredMultiple(teamId, unitDefId);
 unitDef-&gt;armorType = sAICallback-&gt;Clb_UnitDef_getArmorType(teamId, unitDefId);
-unitDef-&gt;flankingBonusMode = sAICallback-&gt;Clb_UnitDef_getFlankingBonusMode(teamId, unitDefId);
-unitDef-&gt;flankingBonusDir = float3(sAICallback-&gt;Clb_UnitDef_getFlankingBonusDir(teamId, unitDefId));
-unitDef-&gt;flankingBonusMax = sAICallback-&gt;Clb_UnitDef_getFlankingBonusMax(teamId, unitDefId);
-unitDef-&gt;flankingBonusMin = sAICallback-&gt;Clb_UnitDef_getFlankingBonusMin(teamId, unitDefId);
-unitDef-&gt;flankingBonusMobilityAdd = sAICallback-&gt;Clb_UnitDef_getFlankingBonusMobilityAdd(teamId, unitDefId);
+unitDef-&gt;flankingBonusMode = sAICallback-&gt;Clb_UnitDef_FlankingBonus_getMode(teamId, unitDefId);
+unitDef-&gt;flankingBonusDir = float3(sAICallback-&gt;Clb_UnitDef_FlankingBonus_getDir(teamId, unitDefId));
+unitDef-&gt;flankingBonusMax = sAICallback-&gt;Clb_UnitDef_FlankingBonus_getMax(teamId, unitDefId);
+unitDef-&gt;flankingBonusMin = sAICallback-&gt;Clb_UnitDef_FlankingBonus_getMin(teamId, unitDefId);
+unitDef-&gt;flankingBonusMobilityAdd = sAICallback-&gt;Clb_UnitDef_FlankingBonus_getMobilityAdd(teamId, unitDefId);
 unitDef-&gt;collisionVolumeType = sAICallback-&gt;Clb_UnitDef_CollisionVolume_getType(teamId, unitDefId);
 unitDef-&gt;collisionVolumeScales = float3(sAICallback-&gt;Clb_UnitDef_CollisionVolume_getScales(teamId, unitDefId));
 unitDef-&gt;collisionVolumeOffsets = float3(sAICallback-&gt;Clb_UnitDef_CollisionVolume_getOffsets(teamId, unitDefId));
@@ -1019,7 +1021,7 @@
 unitDef-&gt;flareSalvoSize = sAICallback-&gt;Clb_UnitDef_getFlareSalvoSize(teamId, unitDefId);
 unitDef-&gt;flareSalvoDelay = sAICallback-&gt;Clb_UnitDef_getFlareSalvoDelay(teamId, unitDefId);
 unitDef-&gt;smoothAnim = sAICallback-&gt;Clb_UnitDef_isSmoothAnim(teamId, unitDefId);
-unitDef-&gt;isMetalMaker = sAICallback-&gt;Clb_UnitDef_isMetalMaker(teamId, unitDefId);
+unitDef-&gt;isMetalMaker = sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0isResourceMaker(teamId, unitDefId, m);
 unitDef-&gt;canLoopbackAttack = sAICallback-&gt;Clb_UnitDef_isCanLoopbackAttack(teamId, unitDefId);
 unitDef-&gt;levelGround = sAICallback-&gt;Clb_UnitDef_isLevelGround(teamId, unitDefId);
 unitDef-&gt;useBuildingGroundDecal = sAICallback-&gt;Clb_UnitDef_isUseBuildingGroundDecal(teamId, unitDefId);
@@ -1033,8 +1035,8 @@
 unitDef-&gt;minAirBasePower = sAICallback-&gt;Clb_UnitDef_getMinAirBasePower(teamId, unitDefId);
 unitDef-&gt;maxThisUnit = sAICallback-&gt;Clb_UnitDef_getMaxThisUnit(teamId, unitDefId);
 //unitDef-&gt;decoyDef = sAICallback-&gt;Clb_UnitDef_getDecoyDefId(teamId, unitDefId);
-unitDef-&gt;shieldWeaponDef = this-&gt;GetWeaponDefById(sAICallback-&gt;Clb_UnitDef_getShieldWeaponDefId(teamId, unitDefId));
-unitDef-&gt;stockpileWeaponDef = this-&gt;GetWeaponDefById(sAICallback-&gt;Clb_UnitDef_getStockpileWeaponDefId(teamId, unitDefId));
+unitDef-&gt;shieldWeaponDef = this-&gt;GetWeaponDefById(sAICallback-&gt;Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getShieldDef(teamId, unitDefId));
+unitDef-&gt;stockpileWeaponDef = this-&gt;GetWeaponDefById(sAICallback-&gt;Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getStockpileDef(teamId, unitDefId));
 {
 	int numBo = sAICallback-&gt;Clb_UnitDef_0ARRAY1SIZE0getBuildOptions(teamId, unitDefId);
 	int* bo = new int[numBo];
@@ -1078,7 +1080,7 @@
 for (int w=0; w &lt; numWeapons; ++w) {
 	unitDef-&gt;weapons.push_back(UnitDef::UnitDefWeapon());
 	unitDef-&gt;weapons[w].name = sAICallback-&gt;Clb_UnitDef_WeaponMount_getName(teamId, unitDefId, w);
-	int weaponDefId = sAICallback-&gt;Clb_UnitDef_WeaponMount_getWeaponDefId(teamId, unitDefId, w);
+	int weaponDefId = sAICallback-&gt;Clb_UnitDef_WeaponMount_0SINGLE1FETCH2WeaponDef0getWeaponDef(teamId, unitDefId, w);
 	unitDef-&gt;weapons[w].def = this-&gt;GetWeaponDefById(weaponDefId);
 	unitDef-&gt;weapons[w].slavedTo = sAICallback-&gt;Clb_UnitDef_WeaponMount_getSlavedTo(teamId, unitDefId, w);
 	unitDef-&gt;weapons[w].mainDir = float3(sAICallback-&gt;Clb_UnitDef_WeaponMount_getMainDir(teamId, unitDefId, w));
@@ -1134,7 +1136,16 @@
 }
 
 const float* CAIAICallback::GetHeightMap() {
-	return sAICallback-&gt;Clb_Map_getHeightMap(teamId);
+
+	static float* heightMap = NULL;
+
+	if (heightMap == NULL) {
+		int size = sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getHeightMap(teamId);
+		heightMap = new float[size]; // NOTE: memory leack, but will be used till end of the game anyway
+		sAICallback-&gt;Clb_Map_0ARRAY1VALS0getHeightMap(teamId, heightMap, size);
+	}
+
+	return heightMap;
 }
 
 float CAIAICallback::GetMinHeight() {
@@ -1146,23 +1157,69 @@
 }
 
 const float* CAIAICallback::GetSlopeMap() {
-	return sAICallback-&gt;Clb_Map_getSlopeMap(teamId);
+
+	static float* slopeMap = NULL;
+
+	if (slopeMap == NULL) {
+		int size = sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getSlopeMap(teamId);
+		slopeMap = new float[size]; // NOTE: memory leack, but will be used till end of the game anyway
+		sAICallback-&gt;Clb_Map_0ARRAY1VALS0getSlopeMap(teamId, slopeMap, size);
+	}
+
+	return slopeMap;
 }
 
 const unsigned short* CAIAICallback::GetLosMap() {
-	return sAICallback-&gt;Clb_Map_getLosMap(teamId);
+
+	static unsigned short* losMap = NULL;
+
+	if (losMap == NULL) {
+		int size = sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getLosMap(teamId);
+		losMap = new unsigned short[size]; // NOTE: memory leack, but will be used till end of the game anyway
+		sAICallback-&gt;Clb_Map_0ARRAY1VALS0getLosMap(teamId, losMap, size);
+	}
+
+	return losMap;
 }
 
 const unsigned short* CAIAICallback::GetRadarMap() {
-	return sAICallback-&gt;Clb_Map_getRadarMap(teamId);
+
+	static unsigned short* radarMap = NULL;
+
+	if (radarMap == NULL) {
+		int size = sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getRadarMap(teamId);
+		radarMap = new unsigned short[size]; // NOTE: memory leack, but will be used till end of the game anyway
+		sAICallback-&gt;Clb_Map_0ARRAY1VALS0getRadarMap(teamId, radarMap, size);
+	}
+
+	return radarMap;
 }
 
 const unsigned short* CAIAICallback::GetJammerMap() {
-	return sAICallback-&gt;Clb_Map_getJammerMap(teamId);
+
+	static unsigned short* jammerMap = NULL;
+
+	if (jammerMap == NULL) {
+		int size = sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getJammerMap(teamId);
+		jammerMap = new unsigned short[size]; // NOTE: memory leack, but will be used till end of the game anyway
+		sAICallback-&gt;Clb_Map_0ARRAY1VALS0getJammerMap(teamId, jammerMap, size);
+	}
+
+	return jammerMap;
 }
 
 const unsigned char* CAIAICallback::GetMetalMap() {
-	return sAICallback-&gt;Clb_Map_getMetalMap(teamId);
+
+	static unsigned char* metalMap = NULL;
+	static int m = getResourceIndex_Metal(sAICallback, teamId);
+
+	if (metalMap == NULL) {
+		int size = sAICallback-&gt;Clb_Map_0ARRAY1SIZE0REF1Resource2resourceIndex0getResourceMap(teamId, m);
+		metalMap = new unsigned char[size]; // NOTE: memory leack, but will be used till end of the game anyway
+		sAICallback-&gt;Clb_Map_0ARRAY1VALS0REF1Resource2resourceIndex0getResourceMap(teamId, m, metalMap, size);
+	}
+
+	return metalMap;
 }
 
 const char* CAIAICallback::GetMapName() {
@@ -1178,11 +1235,13 @@
 }
 
 float CAIAICallback::GetMaxMetal() {
-	return sAICallback-&gt;Clb_Map_getMaxMetal(teamId);
+	static int m = getResourceIndex_Metal(sAICallback, teamId);
+	return sAICallback-&gt;Clb_Map_0REF1Resource2resourceIndex0getMaxResource(teamId, m);
 }
 
 float CAIAICallback::GetExtractorRadius() {
-	return sAICallback-&gt;Clb_Map_getExtractorRadius(teamId);
+	static int m = getResourceIndex_Metal(sAICallback, teamId);
+	return sAICallback-&gt;Clb_Map_0REF1Resource2resourceIndex0getExtractorRadius(teamId, m);
 }
 
 float CAIAICallback::GetMinWind() {
@@ -1354,42 +1413,42 @@
 
 float CAIAICallback::GetMetal() {
 	int m = getResourceIndex_Metal(sAICallback, teamId);
-	return sAICallback-&gt;Clb_Resource_getCurrent(teamId, m);
+	return sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getCurrent(teamId, m);
 }
 
 float CAIAICallback::GetMetalIncome() {
 	int m = getResourceIndex_Metal(sAICallback, teamId);
-	return sAICallback-&gt;Clb_Resource_getIncome(teamId, m);
+	return sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getIncome(teamId, m);
 }
 
 float CAIAICallback::GetMetalUsage() {
 	int m = getResourceIndex_Metal(sAICallback, teamId);
-	return sAICallback-&gt;Clb_Resource_getUsage(teamId, m);
+	return sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getUsage(teamId, m);
 }
 
 float CAIAICallback::GetMetalStorage() {
 	int m = getResourceIndex_Metal(sAICallback, teamId);
-	return sAICallback-&gt;Clb_Resource_getStorage(teamId, m);
+	return sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getStorage(teamId, m);
 }
 
 float CAIAICallback::GetEnergy() {
 	int e = getResourceIndex_Energy(sAICallback, teamId);
-	return sAICallback-&gt;Clb_Resource_getCurrent(teamId, e);
+	return sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getCurrent(teamId, e);
 }
 
 float CAIAICallback::GetEnergyIncome() {
 	int e = getResourceIndex_Energy(sAICallback, teamId);
-	return sAICallback-&gt;Clb_Resource_getIncome(teamId, e);
+	return sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getIncome(teamId, e);
 }
 
 float CAIAICallback::GetEnergyUsage() {
 	int e = getResourceIndex_Energy(sAICallback, teamId);
-	return sAICallback-&gt;Clb_Resource_getUsage(teamId, e);
+	return sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getUsage(teamId, e);
 }
 
 float CAIAICallback::GetEnergyStorage() {
 	int e = getResourceIndex_Energy(sAICallback, teamId);
-	return sAICallback-&gt;Clb_Resource_getStorage(teamId, e);
+	return sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getStorage(teamId, e);
 }
 
 int CAIAICallback::GetFeatures(int* featureIds, int featureIds_max) {
@@ -1407,6 +1466,9 @@
 
 const FeatureDef* CAIAICallback::GetFeatureDefById(int featureDefId) {
 
+	static int m = getResourceIndex_Metal(sAICallback, teamId);
+	static int e = getResourceIndex_Energy(sAICallback, teamId);
+
 	if (featureDefId &lt; 0) {
 		return NULL;
 	}
@@ -1420,8 +1482,8 @@
 featureDef-&gt;description = sAICallback-&gt;Clb_FeatureDef_getDescription(teamId, featureDefId);
 featureDef-&gt;filename = sAICallback-&gt;Clb_FeatureDef_getFileName(teamId, featureDefId);
 featureDef-&gt;id = sAICallback-&gt;Clb_FeatureDef_getId(teamId, featureDefId);
-featureDef-&gt;metal = sAICallback-&gt;Clb_FeatureDef_getMetal(teamId, featureDefId);
-featureDef-&gt;energy = sAICallback-&gt;Clb_FeatureDef_getEnergy(teamId, featureDefId);
+featureDef-&gt;metal = sAICallback-&gt;Clb_FeatureDef_0REF1Resource2resourceIndex0getContainedResource(teamId, featureDefId, m);
+featureDef-&gt;energy = sAICallback-&gt;Clb_FeatureDef_0REF1Resource2resourceIndex0getContainedResource(teamId, featureDefId, e);
 featureDef-&gt;maxHealth = sAICallback-&gt;Clb_FeatureDef_getMaxHealth(teamId, featureDefId);
 featureDef-&gt;reclaimTime = sAICallback-&gt;Clb_FeatureDef_getReclaimTime(teamId, featureDefId);
 featureDef-&gt;mass = sAICallback-&gt;Clb_FeatureDef_getMass(teamId, featureDefId);
@@ -1508,6 +1570,9 @@
 
 const WeaponDef* CAIAICallback::GetWeaponDefById(int weaponDefId) {
 
+	static int m = getResourceIndex_Metal(sAICallback, teamId);
+	static int e = getResourceIndex_Energy(sAICallback, teamId);
+
 //	logT(&quot;entering: GetWeaponDefById sAICallback&quot;);
 	if (weaponDefId &lt; 0) {
 		return NULL;
@@ -1553,7 +1618,7 @@
 weaponDef-&gt;name = sAICallback-&gt;Clb_WeaponDef_getName(teamId, weaponDefId);
 weaponDef-&gt;type = sAICallback-&gt;Clb_WeaponDef_getType(teamId, weaponDefId);
 weaponDef-&gt;description = sAICallback-&gt;Clb_WeaponDef_getDescription(teamId, weaponDefId);
-weaponDef-&gt;filename = sAICallback-&gt;Clb_WeaponDef_getFilename(teamId, weaponDefId);
+weaponDef-&gt;filename = sAICallback-&gt;Clb_WeaponDef_getFileName(teamId, weaponDefId);
 weaponDef-&gt;cegTag = sAICallback-&gt;Clb_WeaponDef_getCegTag(teamId, weaponDefId);
 weaponDef-&gt;range = sAICallback-&gt;Clb_WeaponDef_getRange(teamId, weaponDefId);
 weaponDef-&gt;heightmod = sAICallback-&gt;Clb_WeaponDef_getHeightMod(teamId, weaponDefId);
@@ -1585,8 +1650,8 @@
 weaponDef-&gt;restTime = sAICallback-&gt;Clb_WeaponDef_getRestTime(teamId, weaponDefId);
 weaponDef-&gt;uptime = sAICallback-&gt;Clb_WeaponDef_getUpTime(teamId, weaponDefId);
 weaponDef-&gt;flighttime = sAICallback-&gt;Clb_WeaponDef_getFlightTime(teamId, weaponDefId);
-weaponDef-&gt;metalcost = sAICallback-&gt;Clb_WeaponDef_getMetalCost(teamId, weaponDefId);
-weaponDef-&gt;energycost = sAICallback-&gt;Clb_WeaponDef_getEnergyCost(teamId, weaponDefId);
+weaponDef-&gt;metalcost = sAICallback-&gt;Clb_WeaponDef_0REF1Resource2resourceIndex0getCost(teamId, weaponDefId, m);
+weaponDef-&gt;energycost = sAICallback-&gt;Clb_WeaponDef_0REF1Resource2resourceIndex0getCost(teamId, weaponDefId, e);
 weaponDef-&gt;supplycost = sAICallback-&gt;Clb_WeaponDef_getSupplyCost(teamId, weaponDefId);
 weaponDef-&gt;projectilespershot = sAICallback-&gt;Clb_WeaponDef_getProjectilesPerShot(teamId, weaponDefId);
 weaponDef-&gt;id = sAICallback-&gt;Clb_WeaponDef_getId(teamId, weaponDefId);
@@ -1640,13 +1705,13 @@
 weaponDef-&gt;visibleShield = sAICallback-&gt;Clb_WeaponDef_isVisibleShield(teamId, weaponDefId);
 weaponDef-&gt;visibleShieldRepulse = sAICallback-&gt;Clb_WeaponDef_isVisibleShieldRepulse(teamId, weaponDefId);
 weaponDef-&gt;visibleShieldHitFrames = sAICallback-&gt;Clb_WeaponDef_getVisibleShieldHitFrames(teamId, weaponDefId);
-weaponDef-&gt;shieldEnergyUse = sAICallback-&gt;Clb_WeaponDef_Shield_getEnergyUse(teamId, weaponDefId);
+weaponDef-&gt;shieldEnergyUse = sAICallback-&gt;Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getResourceUse(teamId, weaponDefId, e);
 weaponDef-&gt;shieldRadius = sAICallback-&gt;Clb_WeaponDef_Shield_getRadius(teamId, weaponDefId);
 weaponDef-&gt;shieldForce = sAICallback-&gt;Clb_WeaponDef_Shield_getForce(teamId, weaponDefId);
 weaponDef-&gt;shieldMaxSpeed = sAICallback-&gt;Clb_WeaponDef_Shield_getMaxSpeed(teamId, weaponDefId);
 weaponDef-&gt;shieldPower = sAICallback-&gt;Clb_WeaponDef_Shield_getPower(teamId, weaponDefId);
 weaponDef-&gt;shieldPowerRegen = sAICallback-&gt;Clb_WeaponDef_Shield_getPowerRegen(teamId, weaponDefId);
-weaponDef-&gt;shieldPowerRegenEnergy = sAICallback-&gt;Clb_WeaponDef_Shield_getPowerRegenEnergy(teamId, weaponDefId);
+weaponDef-&gt;shieldPowerRegenEnergy = sAICallback-&gt;Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getPowerRegenResource(teamId, weaponDefId, e);
 weaponDef-&gt;shieldStartingPower = sAICallback-&gt;Clb_WeaponDef_Shield_getStartingPower(teamId, weaponDefId);
 weaponDef-&gt;shieldRechargeDelay = sAICallback-&gt;Clb_WeaponDef_Shield_getRechargeDelay(teamId, weaponDefId);
 weaponDef-&gt;shieldGoodColor = float3(sAICallback-&gt;Clb_WeaponDef_Shield_getGoodColor(teamId, weaponDefId));

Modified: branches/caiinterface/CMakeLists.txt
===================================================================
--- branches/caiinterface/CMakeLists.txt	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/CMakeLists.txt	2008-12-01 19:48:22 UTC (rev 7113)
@@ -34,8 +34,10 @@
 	IF (NOT WINDOWS_CONSOLE)
 		SET(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -mwindows&quot;)
 	ENDIF (NOT WINDOWS_CONSOLE)
+	SET(PATH_DELIM &quot;;&quot;)
 ELSE (WIN32)
 	ADD_DEFINITIONS(-DNO_AVI)
+	SET(PATH_DELIM &quot;:&quot;)
 ENDIF(WIN32)
 
 SET(SPRING_DATADIR ${CMAKE_INSTALL_PREFIX}/${DATADIR} CACHE STRING &quot;Path to game content (in addition to /etc/spring/datadir)&quot;)

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -29,6 +29,7 @@
 #include &quot;System/Util.h&quot;
 #include &quot;System/Platform/errorhandler.h&quot;
 #include &quot;System/FileSystem/FileHandler.h&quot;
+#include &quot;IAILibraryManager.h&quot;
 
 /*
 CAIInterfaceLibrary::CAIInterfaceLibrary(
@@ -72,7 +73,10 @@
 
 	if (sAIInterfaceLibrary.initStatic != NULL) {
 		staticGlobalData = createStaticGlobalData();
-		int ret = sAIInterfaceLibrary.initStatic(staticGlobalData);
+		unsigned int infSize = info-&gt;GetInfo().size();
+		const char** infKeys = info-&gt;GetCInfoKeys();
+		const char** infValues = info-&gt;GetCInfoValues();
+		int ret = sAIInterfaceLibrary.initStatic(infSize, infKeys, infValues, staticGlobalData);
 		if (ret != 0) {
 			// initializing the library failed!
 			const int MAX_MSG_LENGTH = 511;
@@ -121,24 +125,24 @@
 	}
 }
 
-std::map&lt;std::string, InfoItem&gt; CAIInterfaceLibrary::GetInfo() const {
+//std::map&lt;std::string, InfoItem&gt; CAIInterfaceLibrary::GetInfo() const {
+//
+//	std::map&lt;std::string, InfoItem&gt; info;
+//
+//	if (sAIInterfaceLibrary.getInfo != NULL) {
+//		InfoItem infs[MAX_INFOS];
+//		int num = sAIInterfaceLibrary.getInfo(infs, MAX_INFOS);
+//
+//		int i;
+//		for (i=0; i &lt; num; ++i) {
+//			InfoItem newII = copyInfoItem(&amp;infs[i]);
+//			info[std::string(newII.key)] = newII;
+//		}
+//	}
+//
+//	return info;
+//}
 
-	std::map&lt;std::string, InfoItem&gt; info;
-
-	if (sAIInterfaceLibrary.getInfo != NULL) {
-		InfoItem infs[MAX_INFOS];
-		int num = sAIInterfaceLibrary.getInfo(infs, MAX_INFOS);
-
-		int i;
-		for (i=0; i &lt; num; ++i) {
-			InfoItem newII = copyInfoItem(&amp;infs[i]);
-			info[std::string(newII.key)] = newII;
-		}
-	}
-
-	return info;
-}
-
 int CAIInterfaceLibrary::GetLoadCount() const {
 
 	int totalSkirmishAILibraryLoadCount = 0;
@@ -179,16 +183,19 @@
 
 	ISkirmishAILibrary* ai = NULL;
 
-	const unsigned int MAX_INFOS = 128;
-	InfoItem info[MAX_INFOS];
-	unsigned int numInfoItems = aiInfo-&gt;GetInfoCReference(info, MAX_INFOS);
+//	const struct InfoItem* info = aiInfo-&gt;GetInfoCReference();
+//	unsigned int numInfoItems = aiInfo-&gt;GetInfo().size();
+	unsigned int infSize = aiInfo-&gt;GetInfo().size();
+	const char** infKeys = aiInfo-&gt;GetCInfoKeys();
+	const char** infValues = aiInfo-&gt;GetCInfoValues();
 
 	SSAISpecifier sAISpecifier = aiInfo-&gt;GetSpecifier();
+	SSAIKey sAIkey = {info-&gt;GetSpecifier(), sAISpecifier};
 	if (skirmishAILoadCount[sAISpecifier] == 0) {
 		//const SSAILibrary* sLib = sAIInterfaceLibrary.loadSkirmishAILibrary(&amp;sAISpecifier);
 		const SSAILibrary* sLib =
-				sAIInterfaceLibrary.loadSkirmishAILibrary(info, numInfoItems);
-		ai = new CSkirmishAILibrary(*sLib, sAISpecifier, info, numInfoItems);
+				sAIInterfaceLibrary.loadSkirmishAILibrary(infSize, infKeys, infValues);
+		ai = new CSkirmishAILibrary(*sLib, sAIkey);
 		loadedSkirmishAILibraries[sAISpecifier] = ai;
 	} else {
 		ai = loadedSkirmishAILibraries[sAISpecifier];
@@ -200,6 +207,13 @@
 }
 int CAIInterfaceLibrary::ReleaseSkirmishAILibrary(const SSAISpecifier&amp; sAISpecifier) {
 
+	const IAILibraryManager* libMan = IAILibraryManager::GetInstance();
+	SSAIKey sAIkey = {info-&gt;GetSpecifier(), sAISpecifier};
+	const CSkirmishAILibraryInfo* aiInfo = libMan-&gt;GetSkirmishAIInfos().find(sAIkey)-&gt;second;
+	unsigned int infSize = aiInfo-&gt;GetInfo().size();
+	const char** infKeys = aiInfo-&gt;GetCInfoKeys();
+	const char** infValues = aiInfo-&gt;GetCInfoValues();
+
 	if (skirmishAILoadCount[sAISpecifier] == 0) {
 		return 0;
 	}
@@ -208,7 +222,7 @@
 
 	if (skirmishAILoadCount[sAISpecifier] == 0) {
 		loadedSkirmishAILibraries.erase(sAISpecifier);
-		sAIInterfaceLibrary.unloadSkirmishAILibrary(&amp;sAISpecifier);
+		sAIInterfaceLibrary.unloadSkirmishAILibrary(infSize, infKeys, infValues);
 	}
 
 	return skirmishAILoadCount[sAISpecifier];
@@ -227,73 +241,73 @@
 
 
 
-// Group AI methods
-/*
-std::vector&lt;SGAISpecifier&gt; CAIInterfaceLibrary::GetGroupAILibrarySpecifiers() const {
+//// Group AI methods
+///*
+//std::vector&lt;SGAISpecifier&gt; CAIInterfaceLibrary::GetGroupAILibrarySpecifiers() const {
+//
+//	std::vector&lt;SGAISpecifier&gt; specs;
+//
+//	int max = 128;
+//	SGAISpecifier specifiers[max];
+//	int num = sAIInterfaceLibrary.getGroupAISpecifiers(specifiers, max);
+//	for (int i=0; i &lt; num; ++i) {
+//		specs.push_back(specifiers[i]);
+//	}
+//
+//	return specs;
+//}
+//*/
+////const IGroupAILibrary* CAIInterfaceLibrary::FetchGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) {
+//const IGroupAILibrary* CAIInterfaceLibrary::FetchGroupAILibrary(const CGroupAILibraryInfo* aiInfo) {
+//
+//	IGroupAILibrary* ai = NULL;
+//
+//	const unsigned int MAX_INFOS = 128;
+//	InfoItem info[MAX_INFOS];
+//	unsigned int num = aiInfo-&gt;GetInfoCReference(info, MAX_INFOS);
+//
+//	SGAISpecifier gAISpecifier = aiInfo-&gt;GetSpecifier();
+//	if (groupAILoadCount[gAISpecifier] == 0) {
+//		const SGAILibrary* gLib = sAIInterfaceLibrary.loadGroupAILibrary(info, num);
+//		ai = new CGroupAILibrary(*gLib, gAISpecifier, info, num);
+//		loadedGroupAILibraries[gAISpecifier] = ai;
+//	} else {
+//		ai = loadedGroupAILibraries[gAISpecifier];
+//	}
+//
+//	groupAILoadCount[gAISpecifier]++;
+//
+//	return ai;
+//}
+//int CAIInterfaceLibrary::ReleaseGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) {
+//
+//	if (groupAILoadCount[gAISpecifier] == 0) {
+//		return 0;
+//	}
+//
+//	groupAILoadCount[gAISpecifier]--;
+//
+//	if (groupAILoadCount[gAISpecifier] == 0) {
+//		loadedGroupAILibraries.erase(gAISpecifier);
+//		sAIInterfaceLibrary.unloadGroupAILibrary(&amp;gAISpecifier);
+//	}
+//
+//	return groupAILoadCount[gAISpecifier];
+//}
+//int CAIInterfaceLibrary::GetGroupAILibraryLoadCount(const SGAISpecifier&amp; gAISpecifier) const {
+//	return groupAILoadCount.at(gAISpecifier);
+//}
+//int CAIInterfaceLibrary::ReleaseAllGroupAILibraries() {
+//
+//	int releasedAIs = sAIInterfaceLibrary.unloadAllGroupAILibraries();
+//	loadedGroupAILibraries.clear();
+//	groupAILoadCount.clear();
+//
+//	return releasedAIs;
+//}
 
-	std::vector&lt;SGAISpecifier&gt; specs;
 
-	int max = 128;
-	SGAISpecifier specifiers[max];
-	int num = sAIInterfaceLibrary.getGroupAISpecifiers(specifiers, max);
-	for (int i=0; i &lt; num; ++i) {
-		specs.push_back(specifiers[i]);
-	}
 
-	return specs;
-}
-*/
-//const IGroupAILibrary* CAIInterfaceLibrary::FetchGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) {
-const IGroupAILibrary* CAIInterfaceLibrary::FetchGroupAILibrary(const CGroupAILibraryInfo* aiInfo) {
-
-	IGroupAILibrary* ai = NULL;
-
-	const unsigned int MAX_INFOS = 128;
-	InfoItem info[MAX_INFOS];
-	unsigned int num = aiInfo-&gt;GetInfoCReference(info, MAX_INFOS);
-
-	SGAISpecifier gAISpecifier = aiInfo-&gt;GetSpecifier();
-	if (groupAILoadCount[gAISpecifier] == 0) {
-		const SGAILibrary* gLib = sAIInterfaceLibrary.loadGroupAILibrary(info, num);
-		ai = new CGroupAILibrary(*gLib, gAISpecifier, info, num);
-		loadedGroupAILibraries[gAISpecifier] = ai;
-	} else {
-		ai = loadedGroupAILibraries[gAISpecifier];
-	}
-
-	groupAILoadCount[gAISpecifier]++;
-
-	return ai;
-}
-int CAIInterfaceLibrary::ReleaseGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) {
-
-	if (groupAILoadCount[gAISpecifier] == 0) {
-		return 0;
-	}
-
-	groupAILoadCount[gAISpecifier]--;
-
-	if (groupAILoadCount[gAISpecifier] == 0) {
-		loadedGroupAILibraries.erase(gAISpecifier);
-		sAIInterfaceLibrary.unloadGroupAILibrary(&amp;gAISpecifier);
-	}
-
-	return groupAILoadCount[gAISpecifier];
-}
-int CAIInterfaceLibrary::GetGroupAILibraryLoadCount(const SGAISpecifier&amp; gAISpecifier) const {
-	return groupAILoadCount.at(gAISpecifier);
-}
-int CAIInterfaceLibrary::ReleaseAllGroupAILibraries() {
-
-	int releasedAIs = sAIInterfaceLibrary.unloadAllGroupAILibraries();
-	loadedGroupAILibraries.clear();
-	groupAILoadCount.clear();
-
-	return releasedAIs;
-}
-
-
-
 void CAIInterfaceLibrary::reportInterfaceFunctionError(const std::string* libFileName, const std::string* functionName) {
 
 	const int MAX_MSG_LENGTH = 511;
@@ -310,7 +324,12 @@
 	std::string funcName;
 
 	funcName = &quot;initStatic&quot;;
-	sAIInterfaceLibrary.initStatic = (int (CALLING_CONV_FUNC_POINTER *)(const SStaticGlobalData* staticGlobalData)) sharedLib-&gt;FindAddress(funcName.c_str());
+	sAIInterfaceLibrary.initStatic
+			= (int (CALLING_CONV_FUNC_POINTER *)(
+			unsigned int infoSize,
+			const char** infoKeys, const char** infoValues,
+			const struct SStaticGlobalData* staticGlobalData))
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (sAIInterfaceLibrary.initStatic == NULL) {
 		// do nothing: it is permitted that an AI does not export this function
 		//reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
@@ -318,7 +337,9 @@
 	}
 
 	funcName = &quot;releaseStatic&quot;;
-	sAIInterfaceLibrary.releaseStatic = (int (CALLING_CONV_FUNC_POINTER *)()) sharedLib-&gt;FindAddress(funcName.c_str());
+	sAIInterfaceLibrary.releaseStatic
+			= (int (CALLING_CONV_FUNC_POINTER *)())
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (sAIInterfaceLibrary.releaseStatic == NULL) {
 		// do nothing: it is permitted that an AI does not export this function
 		//reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
@@ -326,20 +347,22 @@
 	}
 
 	funcName = &quot;getLevelOfSupportFor&quot;;
-	sAIInterfaceLibrary.getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(const char*, int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	sAIInterfaceLibrary.getLevelOfSupportFor
+			= (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(const char*, int))
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (sAIInterfaceLibrary.getLevelOfSupportFor == NULL) {
 		// do nothing: it is permitted that an AI does not export this function
 		//reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
 		//return -2;
 	}
 
-	funcName = &quot;getInfo&quot;;
-	sAIInterfaceLibrary.getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (sAIInterfaceLibrary.getInfo == NULL) {
-		// do nothing: this is permitted, if the AI supplies info through an AIInfo.lua file
-		//reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
-		//return -1;
-	}
+//	funcName = &quot;getInfo&quot;;
+//	sAIInterfaceLibrary.getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (sAIInterfaceLibrary.getInfo == NULL) {
+//		// do nothing: this is permitted, if the AI supplies info through an AIInfo.lua file
+//		//reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
+//		//return -1;
+//	}
 
 /*
 	funcName = &quot;getSkirmishAISpecifiers&quot;;
@@ -351,56 +374,66 @@
 */
 
 	funcName = &quot;loadSkirmishAILibrary&quot;;
-	sAIInterfaceLibrary.loadSkirmishAILibrary = (const SSAILibrary* (CALLING_CONV_FUNC_POINTER *)(const struct InfoItem info[], unsigned int numInfoItems)) sharedLib-&gt;FindAddress(funcName.c_str());
+	sAIInterfaceLibrary.loadSkirmishAILibrary
+			= (const SSAILibrary* (CALLING_CONV_FUNC_POINTER *)(
+			unsigned int infoSize,
+			const char** infoKeys, const char** infoValues))
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (sAIInterfaceLibrary.loadSkirmishAILibrary == NULL) {
 		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
 		return -4;
 	}
 
 	funcName = &quot;unloadSkirmishAILibrary&quot;;
-	sAIInterfaceLibrary.unloadSkirmishAILibrary = (int (CALLING_CONV_FUNC_POINTER *)(const SSAISpecifier* const)) sharedLib-&gt;FindAddress(funcName.c_str());
+	sAIInterfaceLibrary.unloadSkirmishAILibrary
+			= (int (CALLING_CONV_FUNC_POINTER *)(
+			unsigned int infoSize,
+			const char** infoKeys, const char** infoValues))
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (sAIInterfaceLibrary.unloadSkirmishAILibrary == NULL) {
 		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
 		return -5;
 	}
 
 	funcName = &quot;unloadAllSkirmishAILibraries&quot;;
-	sAIInterfaceLibrary.unloadAllSkirmishAILibraries = (int (CALLING_CONV_FUNC_POINTER *)()) sharedLib-&gt;FindAddress(funcName.c_str());
+	sAIInterfaceLibrary.unloadAllSkirmishAILibraries
+			= (int (CALLING_CONV_FUNC_POINTER *)())
+			sharedLib-&gt;FindAddress(funcName.c_str());
 	if (sAIInterfaceLibrary.unloadAllSkirmishAILibraries == NULL) {
 		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
 		return -6;
 	}
 
-/*
-	funcName = &quot;getGroupAISpecifiers&quot;;
-	sAIInterfaceLibrary.getGroupAISpecifiers = (int (CALLING_CONV_FUNC_POINTER *)(SGAISpecifier*, int max)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (sAIInterfaceLibrary.getGroupAISpecifiers == NULL) {
-		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
-		return -7;
-	}
-*/
+///*
+//	funcName = &quot;getGroupAISpecifiers&quot;;
+//	sAIInterfaceLibrary.getGroupAISpecifiers = (int (CALLING_CONV_FUNC_POINTER *)(SGAISpecifier*, int max)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (sAIInterfaceLibrary.getGroupAISpecifiers == NULL) {
+//		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
+//		return -7;
+//	}
+//*/
+//
+//	funcName = &quot;loadGroupAILibrary&quot;;
+//	sAIInterfaceLibrary.loadGroupAILibrary = (const SGAILibrary* (CALLING_CONV_FUNC_POINTER *)(const struct InfoItem info[], unsigned int numInfoItems)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (sAIInterfaceLibrary.loadGroupAILibrary == NULL) {
+//		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
+//		return -8;
+//	}
+//
+//	funcName = &quot;unloadGroupAILibrary&quot;;
+//	sAIInterfaceLibrary.unloadGroupAILibrary = (int (CALLING_CONV_FUNC_POINTER *)(const SGAISpecifier* const)) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (sAIInterfaceLibrary.unloadGroupAILibrary == NULL) {
+//		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
+//		return -9;
+//	}
+//
+//	funcName = &quot;unloadAllGroupAILibraries&quot;;
+//	sAIInterfaceLibrary.unloadAllGroupAILibraries = (int (CALLING_CONV_FUNC_POINTER *)()) sharedLib-&gt;FindAddress(funcName.c_str());
+//	if (sAIInterfaceLibrary.unloadAllGroupAILibraries == NULL) {
+//		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
+//		return -10;
+//	}
 
-	funcName = &quot;loadGroupAILibrary&quot;;
-	sAIInterfaceLibrary.loadGroupAILibrary = (const SGAILibrary* (CALLING_CONV_FUNC_POINTER *)(const struct InfoItem info[], unsigned int numInfoItems)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (sAIInterfaceLibrary.loadGroupAILibrary == NULL) {
-		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
-		return -8;
-	}
-
-	funcName = &quot;unloadGroupAILibrary&quot;;
-	sAIInterfaceLibrary.unloadGroupAILibrary = (int (CALLING_CONV_FUNC_POINTER *)(const SGAISpecifier* const)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (sAIInterfaceLibrary.unloadGroupAILibrary == NULL) {
-		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
-		return -9;
-	}
-
-	funcName = &quot;unloadAllGroupAILibraries&quot;;
-	sAIInterfaceLibrary.unloadAllGroupAILibraries = (int (CALLING_CONV_FUNC_POINTER *)()) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (sAIInterfaceLibrary.unloadAllGroupAILibraries == NULL) {
-		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
-		return -10;
-	}
-
 	return 0;
 }
 

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -28,7 +28,7 @@
 
 class CAIInterfaceLibraryInfo;
 class CSkirmishAILibraryInfo;
-class CGroupAILibraryInfo;
+//class CGroupAILibraryInfo;
 
 class CAIInterfaceLibrary : public IAIInterfaceLibrary {
 public:
@@ -38,18 +38,19 @@
 	//CAIInterfaceLibrary(const SAIInterfaceSpecifier&amp; interfaceSpecifier, const std::string&amp; libFileName = &quot;&quot;);
 	CAIInterfaceLibrary(const CAIInterfaceLibraryInfo* info);
 	virtual ~CAIInterfaceLibrary();
-	
+
 //	static CAIInterfaceLibrary* Load(const std::string&amp; libFileName); // increments load counter
 //	static CAIInterfaceLibrary* Get(const std::string&amp; shortName, const std::string&amp; version); // does not increment load counter
-	
+
 	virtual SAIInterfaceSpecifier GetSpecifier() const;
+
 	virtual LevelOfSupport GetLevelOfSupportFor(
 			const std::string&amp; engineVersionString, int engineVersionNumber) const;
-	
+
 //    virtual std::string GetProperty(const std::string&amp; propertyName) const;
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const;
+//    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const;
 	virtual int GetLoadCount() const;
-	
+
 	// Skirmish AI methods
 	//virtual std::vector&lt;SSAISpecifier&gt; GetSkirmishAILibrarySpecifiers() const;
 	//virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const SSAISpecifier&amp; sAISpecifier);
@@ -58,43 +59,39 @@
 	virtual int ReleaseSkirmishAILibrary(const SSAISpecifier&amp; sAISpecifier);
 	virtual int GetSkirmishAILibraryLoadCount(const SSAISpecifier&amp; sAISpecifier) const;
 	virtual int ReleaseAllSkirmishAILibraries();
-	
-	// Group AI methods
-	//virtual std::vector&lt;SGAISpecifier&gt; GetGroupAILibrarySpecifiers() const;
-	//virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAISpecifier&amp; gAISpecifier);
-	//virtual const IGroupAILibrary* FetchGroupAILibrary(const InfoItem* info, unsigned int numInfo);
-	virtual const IGroupAILibrary* FetchGroupAILibrary(const CGroupAILibraryInfo* aiInfo);
-	virtual int ReleaseGroupAILibrary(const SGAISpecifier&amp; gAISpecifier);
-	virtual int GetGroupAILibraryLoadCount(const SGAISpecifier&amp; gAISpecifier) const;
-	virtual int ReleaseAllGroupAILibraries();
-	
+
+//	// Group AI methods
+//	//virtual std::vector&lt;SGAISpecifier&gt; GetGroupAILibrarySpecifiers() const;
+//	//virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAISpecifier&amp; gAISpecifier);
+//	//virtual const IGroupAILibrary* FetchGroupAILibrary(const InfoItem* info, unsigned int numInfo);
+//	virtual const IGroupAILibrary* FetchGroupAILibrary(const CGroupAILibraryInfo* aiInfo);
+//	virtual int ReleaseGroupAILibrary(const SGAISpecifier&amp; gAISpecifier);
+//	virtual int GetGroupAILibraryLoadCount(const SGAISpecifier&amp; gAISpecifier) const;
+//	virtual int ReleaseAllGroupAILibraries();
+
 private:
 	SStaticGlobalData* staticGlobalData;
 	void InitStatic();
 	void ReleaseStatic();
-	
+
 private:
-	//std::string aiInterfacesLibDir;
 	std::string libFilePath;
 	SharedLib* sharedLib;
 	SAIInterfaceLibrary sAIInterfaceLibrary;
-	//SAIInterfaceSpecifier specifier;
 	const CAIInterfaceLibraryInfo* info;
 	std::map&lt;const SSAISpecifier, ISkirmishAILibrary*, SSAISpecifier_Comparator&gt; loadedSkirmishAILibraries;
 	std::map&lt;const SSAISpecifier, int, SSAISpecifier_Comparator&gt; skirmishAILoadCount;
 	std::map&lt;const SGAISpecifier, IGroupAILibrary*, SGAISpecifier_Comparator&gt; loadedGroupAILibraries;
 	std::map&lt;const SGAISpecifier, int, SGAISpecifier_Comparator&gt; groupAILoadCount;
-	
+
 private:
 	static const int MAX_INFOS = 128;
-	
+
 	static void reportInterfaceFunctionError(const std::string* libFileName,
 			const std::string* functionName);
 	int InitializeFromLib(const std::string&amp; libFilePath);
-	
-	//static std::string FindLibFile(const std::string&amp; fileNameMainPart);
+
 	std::string FindLibFile();
 };
 
-#endif	/* _AIINTERFACELIBRARY_H */
-
+#endif // _AIINTERFACELIBRARY_H

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software {} you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation {} either version 2 of the License, or
@@ -24,24 +24,25 @@
 #include &quot;Platform/errorhandler.h&quot;
 #include &quot;FileSystem/VFSModes.h&quot;
 
+//CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
+//		const IAIInterfaceLibrary&amp; interface) {
+//
+//	info = interface.GetInfo();
+//
+//	std::map&lt;std::string, InfoItem&gt;::iterator iip;
+//    for (iip = info.begin(); iip != info.begin(); ++iip) {
+//		iip-&gt;second = copyInfoItem(&amp;(iip-&gt;second));
+//    }
+//}
+
 CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
-		const IAIInterfaceLibrary&amp; interface) {
-	
-	info = interface.GetInfo();
-	
-	std::map&lt;std::string, InfoItem&gt;::iterator iip;
-    for (iip = info.begin(); iip != info.begin(); ++iip) {
-		iip-&gt;second = copyInfoItem(&amp;(iip-&gt;second));
-    }
-}
+		const CAIInterfaceLibraryInfo&amp; interfaceInfo)
+		: infoKeys_c(NULL), infoValues_c(NULL) {
 
-CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
-		const CAIInterfaceLibraryInfo&amp; interfaceInfo) {
-	
 	info = std::map&lt;std::string, InfoItem&gt;(
 			interfaceInfo.info.begin(),
 			interfaceInfo.info.end());
-	
+
 	std::map&lt;std::string, InfoItem&gt;::iterator iip;
     for (iip = info.begin(); iip != info.begin(); ++iip) {
 		iip-&gt;second = copyInfoItem(&amp;(iip-&gt;second));
@@ -49,8 +50,9 @@
 }
 
 CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
-		const std::string&amp; interfaceInfoFile) {
-	
+		const std::string&amp; interfaceInfoFile)
+		: infoKeys_c(NULL), infoValues_c(NULL) {
+
 	InfoItem tmpInfo[MAX_INFOS];
 	unsigned int num = ParseInfo(interfaceInfoFile.c_str(), SPRING_VFS_RAW,
 			SPRING_VFS_RAW, tmpInfo, MAX_INFOS);
@@ -61,12 +63,13 @@
 */
 		info[std::string(tmpInfo[i].key)] = copyInfoItem(&amp;(tmpInfo[i]));
     }
-	
+
 	//levelOfSupport = LOS_Unknown;
 }
 
 CAIInterfaceLibraryInfo::~CAIInterfaceLibraryInfo() {
-	
+
+	FreeCReferences();
 	std::map&lt;std::string, InfoItem&gt;::const_iterator iip;
     for (iip = info.begin(); iip != info.begin(); ++iip) {
 		deleteInfoItem(&amp;(iip-&gt;second));
@@ -80,7 +83,7 @@
 */
 
 SAIInterfaceSpecifier CAIInterfaceLibraryInfo::GetSpecifier() const {
-	
+
 	const char* sn = info.at(AI_INTERFACE_PROPERTY_SHORT_NAME).value;
 	const char* v = info.at(AI_INTERFACE_PROPERTY_VERSION).value;
 	SAIInterfaceSpecifier specifier = {sn, v};
@@ -109,7 +112,7 @@
 	return GetInfo(AI_INTERFACE_PROPERTY_URL);
 }
 std::string CAIInterfaceLibraryInfo::GetInfo(const std::string&amp; key) const {
-	
+
 	if (info.find(key) == info.end()) {
 		std::string errorMsg = std::string(&quot;AI interface property '&quot;) + key
 				+ &quot;' could not be found.\n&quot;;
@@ -118,11 +121,39 @@
 	}
 	return info.at(key).value;
 }
-const std::map&lt;std::string, InfoItem&gt;* CAIInterfaceLibraryInfo::GetInfo() const {
-	return &info;
+const std::map&lt;std::string, InfoItem&gt;&amp; CAIInterfaceLibraryInfo::GetInfo() const {
+	return info;
 }
+void CAIInterfaceLibraryInfo::CreateCReferences() {
 
+	FreeCReferences();
 
+	infoKeys_c = (const char**) calloc(info.size(), sizeof(char*));
+	infoValues_c = (const char**) calloc(info.size(), sizeof(char*));
+	unsigned int i=0;
+	std::map&lt;std::string, InfoItem&gt;::const_iterator ii;
+	for (ii=info.begin(); ii != info.end(); ++ii) {
+		infoKeys_c[i] = ii-&gt;second.key;
+		infoValues_c[i] = ii-&gt;second.value;
+		i++;
+	}
+}
+void CAIInterfaceLibraryInfo::FreeCReferences() {
+
+	free(infoKeys_c);
+	infoKeys_c = NULL;
+	free(infoValues_c);
+	infoValues_c = NULL;
+}
+
+const char** CAIInterfaceLibraryInfo::GetCInfoKeys() const {
+	return infoKeys_c;
+}
+const char** CAIInterfaceLibraryInfo::GetCInfoValues() const {
+	return infoValues_c;
+}
+
+
 void CAIInterfaceLibraryInfo::SetDataDir(const std::string&amp; dataDir) {
 	SetInfo(AI_INTERFACE_PROPERTY_DATA_DIR, dataDir);
 }
@@ -146,7 +177,7 @@
 }
 bool CAIInterfaceLibraryInfo::SetInfo(const std::string&amp; key,
 		const std::string&amp; value) {
-	
+
 	if (key == AI_INTERFACE_PROPERTY_SHORT_NAME ||
 			key == AI_INTERFACE_PROPERTY_VERSION) {
 		if (value.find_first_of(&quot;\t _#&quot;) != std::string::npos) {
@@ -156,10 +187,10 @@
 			return false;
 		}
 	}
-	
+
 	InfoItem ii = {key.c_str(), value.c_str(), NULL};
 	ii = copyInfoItem(&amp;ii);
-	
+
 	info[key] = ii;
 	return true;
 }

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -28,11 +28,16 @@
 
 class CAIInterfaceLibraryInfo {
 public:
-	CAIInterfaceLibraryInfo(const IAIInterfaceLibrary&amp; interface);
+//	CAIInterfaceLibraryInfo(const IAIInterfaceLibrary&amp; interface);
 	CAIInterfaceLibraryInfo(const CAIInterfaceLibraryInfo&amp; interfaceInfo);
 	CAIInterfaceLibraryInfo(const std::string&amp; interfaceInfoFile);
 	~CAIInterfaceLibraryInfo();
 
+	virtual void CreateCReferences();
+private:
+	virtual void FreeCReferences();
+public:
+
 	//virtual LevelOfSupport GetLevelOfSupportForCurrentEngine() const;
 
 	virtual SAIInterfaceSpecifier GetSpecifier() const;
@@ -45,7 +50,9 @@
 	virtual std::string GetDescription() const;
 	virtual std::string GetURL() const;
 	virtual std::string GetInfo(const std::string&amp; key) const;
-	virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
+	virtual const std::map&lt;std::string, InfoItem&gt;&amp; GetInfo() const;
+	virtual const char** GetCInfoKeys() const;
+	virtual const char** GetCInfoValues() const;
 
 	virtual void SetDataDir(const std::string&amp; dataDir);
 	virtual void SetFileName(const std::string&amp; fileName); // when the AI is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
@@ -59,6 +66,8 @@
 private:
 	static const unsigned int MAX_INFOS = 128;
 	std::map&lt;std::string, InfoItem&gt; info;
+	const char** infoKeys_c;
+	const char** infoValues_c;
 };
 
 #endif	// _AIINTERFACELIBRARYINFO_H

Modified: branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -71,28 +71,79 @@
 	return libFile.substr(firstChar+1, lastChar - firstChar -1);
 }
 
+
+static unsigned int allocCPropertiesMap(
+		std::map&lt;std::string, std::string&gt; propMap,
+		const char*** cKeys, const char*** cValues) {
+
+	unsigned int size = propMap.size();
+
+	(*cKeys) = (const char**) calloc(size, sizeof(char*));
+	(*cValues) = (const char**) calloc(size, sizeof(char*));
+	unsigned int i;
+	std::map&lt;std::string, std::string&gt;::const_iterator pi;
+	for (i=0, pi=propMap.begin(); i &lt; size; ++i, ++pi) {
+		const char* key = pi-&gt;first.c_str();
+		const char* value = pi-&gt;second.c_str();
+		char* key_cpy = (char*) calloc(strlen(key) + 1, sizeof(char));
+		char* value_cpy = (char*) calloc(strlen(value) + 1, sizeof(char));
+		strcpy(key_cpy, key);
+		strcpy(value_cpy, value);
+		(*cKeys)[i] = key_cpy;
+		(*cValues)[i] = value_cpy;
+	}
+
+	return size;
+}
+static void freeCPropertiesMap(unsigned int mapSize, const char** cKeys,
+		const char** cValues) {
+
+	unsigned int i;
+	for (i=0; i &lt; mapSize; ++i) {
+		free(const_cast&lt;char*&gt;(cKeys[i]));
+		free(const_cast&lt;char*&gt;(cValues[i]));
+	}
+	free(const_cast&lt;char**&gt;(cKeys));
+	free(const_cast&lt;char**&gt;(cValues));
+	cKeys = NULL;
+	cValues = NULL;
+}
+
+static std::string noSlashAtEnd(const std::string&amp; dir) {
+
+	std::string resDir = dir;
+
+	char lastChar = dir.at(dir.size()-1);
+	if (lastChar == '/' || lastChar == '\\') {
+		resDir = resDir.substr(0, dir.size()-1);
+	}
+
+	return resDir;
+}
+
 CAILibraryManager::CAILibraryManager() : usedSkirmishAIInfos_initialized(false) {
 	//GetAllInfosFromLibraries();
 	GetAllInfosFromCache();
+	CreateCOptions();
 }
 
 /*
 void CAILibraryManager::GetAllInfosFromLibraries() {
-	
+
 	ClearAllInfos();
-	
+
 	// look for AI interface library files
 	std::vector&lt;std::string&gt; interfaceLibFiles =
 			FindFiles(std::string(PATH_TO_SPRING_HOME) +
 			std::string(&quot;&quot;) + AI_INTERFACES_IMPLS_DIR,
 			std::string(&quot;.&quot;) + SharedLib::GetLibExtension());
-	
+
 	// initialize the interface infos
 	std::vector&lt;std::string&gt;::const_iterator libFile;
 	for (libFile=interfaceLibFiles.begin(); libFile!=interfaceLibFiles.end(); libFile++) { // interfaces
-		
+
 		std::string fileName = std::string(extractFileName(*libFile, false));
-		
+
 		// load the interface
 		IAIInterfaceLibrary* interfaceLib = new CAIInterfaceLibrary(fileName);
 		if (interfaceLib == NULL) {
@@ -100,19 +151,19 @@
 					&quot;Failed to load interface shared library \&quot;%s\&quot;&quot;,
 					libFile-&gt;c_str());
 		}
-		
+
 		SAIInterfaceSpecifier interfaceSpecifier = interfaceLib-&gt;GetSpecifier();
 		interfaceSpecifier = copySAIInterfaceSpecifier(&amp;interfaceSpecifier);
 		interfaceSpecifiers.push_back(interfaceSpecifier);
-		
+
 		// generate and store the interface info
 		CAIInterfaceLibraryInfo* interfaceInfo = new CAIInterfaceLibraryInfo(*interfaceLib);
 		interfaceInfos[interfaceSpecifier] = interfaceInfo;
-		
+
 		// generate and store the pure file name
 		//interfaceFileNames[interfaceSpecifier] = fileName;
 		interfaceInfo-&gt;SetFileName(fileName);
-		
+
 		// fetch the info of all Skirmish AIs available through the interface
 		std::vector&lt;SSAISpecifier&gt; sass = interfaceLib-&gt;GetSkirmishAILibrarySpecifiers();
 		std::vector&lt;SSAISpecifier&gt;::const_iterator sas;
@@ -124,7 +175,7 @@
 			skirmishAIInfos[skirmishAIKey] = skirmishAIInfo;
 			interfaceLib-&gt;ReleaseSkirmishAILibrary(*sas);
 		}
-		
+
 		// fetch the info of all Group AIs available through the interface
 		std::vector&lt;SGAISpecifier&gt; gass = interfaceLib-&gt;GetGroupAILibrarySpecifiers();
 		std::vector&lt;SGAISpecifier&gt;::const_iterator gas;
@@ -136,7 +187,7 @@
 			groupAIInfos[groupAIKey] = groupAIInfo;
 			interfaceLib-&gt;ReleaseGroupAILibrary(*gas);
 		}
-		
+
 		delete interfaceLib;
 	}
 }
@@ -149,7 +200,7 @@
 		const std::string&amp; accessModes)
 {
 	std::vector&lt;InfoItem&gt; infos;
-	
+
 	//static const int MAX_INFOS = 128;
 #define MAX_INFOS 128
 	InfoItem tmpInfos[MAX_INFOS];
@@ -157,23 +208,12 @@
 	for (unsigned int i=0; i &lt; num; ++i) {
 		infos.push_back(copyInfoItem(&amp;(tmpInfos[i])));
     }
-	
+
 	return infos;
 }
 */
 
-static std::string noSlashAtEnd(const std::string&amp; dir) {
 
-	std::string resDir = dir;
-	
-	char lastChar = dir.at(dir.size()-1);
-	if (lastChar == '/' || lastChar == '\\') {
-		resDir = resDir.substr(0, dir.size()-1);
-	}
-
-	return resDir;
-}
-
 void CAILibraryManager::GetAllInfosFromCache() {
 
 	ClearAllInfos();
@@ -204,6 +244,7 @@
 					new CAIInterfaceLibraryInfo(infoFile.at(0));
 
 			interfaceInfo-&gt;SetDataDir(noSlashAtEnd(possibleDataDir));
+			interfaceInfo-&gt;CreateCReferences();
 
 			SAIInterfaceSpecifier interfaceSpecifier = interfaceInfo-&gt;GetSpecifier();
 
@@ -231,7 +272,7 @@
 			}
 		}
 	}
-	
+
 	// Read from Skirmish AI info and option files
 	// we are looking for:
 	// {SKIRMISH_AI_DATA_DIR/{*}/AIInfo.lua
@@ -255,6 +296,7 @@
 					new CSkirmishAILibraryInfo(infoFile.at(0), optionFileName);
 
 			skirmishAIInfo-&gt;SetDataDir(noSlashAtEnd(possibleDataDir));
+			skirmishAIInfo-&gt;CreateCReferences();
 
 			SSAISpecifier aiSpecifier = skirmishAIInfo-&gt;GetSpecifier();
 			SAIInterfaceSpecifier interfaceSpecifier =
@@ -292,77 +334,77 @@
 	}
 
 
-	// Read from Group AI info and option files
-	// we are looking for:
-	// {GROUP_AI_DATA_DIR}/{*}/AIInfo.lua
-	// {GROUP_AI_DATA_DIR}/{*}/{*}/AIInfo.lua
-	T_dirs groupAIDataDirs = FindDirsAndDirectSubDirs(GROUP_AI_DATA_DIR);
-	T_dupGroup duplicateGroupAIInfoCheck;
-	for (T_dirs::iterator dir = groupAIDataDirs.begin();
-			dir != groupAIDataDirs.end(); ++dir) {
-		const std::string&amp; possibleDataDir = *dir;
-		T_dirs infoFile = CFileHandler::FindFiles(possibleDataDir,
-				&quot;AIInfo.lua&quot;);
-		if (infoFile.size() &gt; 0) { // group AI info is available
-			std::string optionFileName = &quot;&quot;;
-			T_dirs optionFile = CFileHandler::FindFiles(possibleDataDir,
-					&quot;AIOptions.lua&quot;);
-			if (optionFile.size() &gt; 0) {
-				optionFileName = optionFile.at(0);
-			}
-			// generate and store the ai info
-			CGroupAILibraryInfo* groupAIInfo =
-					new CGroupAILibraryInfo(infoFile.at(0), optionFileName);
+//	// Read from Group AI info and option files
+//	// we are looking for:
+//	// {GROUP_AI_DATA_DIR}/{*}/AIInfo.lua
+//	// {GROUP_AI_DATA_DIR}/{*}/{*}/AIInfo.lua
+//	T_dirs groupAIDataDirs = FindDirsAndDirectSubDirs(GROUP_AI_DATA_DIR);
+//	T_dupGroup duplicateGroupAIInfoCheck;
+//	for (T_dirs::iterator dir = groupAIDataDirs.begin();
+//			dir != groupAIDataDirs.end(); ++dir) {
+//		const std::string&amp; possibleDataDir = *dir;
+//		T_dirs infoFile = CFileHandler::FindFiles(possibleDataDir,
+//				&quot;AIInfo.lua&quot;);
+//		if (infoFile.size() &gt; 0) { // group AI info is available
+//			std::string optionFileName = &quot;&quot;;
+//			T_dirs optionFile = CFileHandler::FindFiles(possibleDataDir,
+//					&quot;AIOptions.lua&quot;);
+//			if (optionFile.size() &gt; 0) {
+//				optionFileName = optionFile.at(0);
+//			}
+//			// generate and store the ai info
+//			CGroupAILibraryInfo* groupAIInfo =
+//					new CGroupAILibraryInfo(infoFile.at(0), optionFileName);
+//
+//			groupAIInfo-&gt;SetDataDir(noSlashAtEnd(possibleDataDir));
+//
+//			SGAISpecifier aiSpecifier = groupAIInfo-&gt;GetSpecifier();
+//			SAIInterfaceSpecifier interfaceSpecifier =
+//					FindFittingInterfaceSpecifier(
+//							groupAIInfo-&gt;GetInterfaceShortName(),
+//							groupAIInfo-&gt;GetInterfaceVersion(),
+//							interfaceSpecifiers);
+//			if (interfaceSpecifier.shortName != NULL) {
+//				aiSpecifier = copySGAISpecifier(&amp;aiSpecifier);
+//				SGAIKey groupAIKey = {interfaceSpecifier, aiSpecifier};
+//				groupAIKeys.insert(groupAIKey);
+//				groupAIInfos[groupAIKey] = groupAIInfo;
+//
+//				// so we can check if one group AI is specified multiple times
+//				duplicateGroupAIInfoCheck[groupAIKey].insert(infoFile.at(0));
+//			}
+//		}
+//	}
+//
+//	// filter out group AIs that are specified multiple times
+//	for (T_dupGroup::const_iterator info = duplicateGroupAIInfoCheck.begin();
+//			info != duplicateGroupAIInfoCheck.end(); ++info) {
+//		if (info-&gt;second.size() &gt;= 2) {
+//			duplicateGroupAIInfos[info-&gt;first] = info-&gt;second;
+//
+//			logOutput.Print(&quot;WARNING: Duplicate Group AI Info found:&quot;);
+//			logOutput.Print(&quot;\tfor Group AI: %s %s&quot;, info-&gt;first.ai.shortName,
+//					info-&gt;first.ai.version);
+//			logOutput.Print(&quot;\tin files:&quot;);
+//			std::set&lt;std::string&gt;::const_iterator dir;
+//			for (dir = info-&gt;second.begin(); dir != info-&gt;second.end(); ++dir) {
+//				logOutput.Print(&quot;\t%s&quot;, dir-&gt;c_str());
+//			}
+//		}
+//	}
 
-			groupAIInfo-&gt;SetDataDir(noSlashAtEnd(possibleDataDir));
-
-			SGAISpecifier aiSpecifier = groupAIInfo-&gt;GetSpecifier();
-			SAIInterfaceSpecifier interfaceSpecifier =
-					FindFittingInterfaceSpecifier(
-							groupAIInfo-&gt;GetInterfaceShortName(),
-							groupAIInfo-&gt;GetInterfaceVersion(),
-							interfaceSpecifiers);
-			if (interfaceSpecifier.shortName != NULL) {
-				aiSpecifier = copySGAISpecifier(&amp;aiSpecifier);
-				SGAIKey groupAIKey = {interfaceSpecifier, aiSpecifier};
-				groupAIKeys.insert(groupAIKey);
-				groupAIInfos[groupAIKey] = groupAIInfo;
-
-				// so we can check if one group AI is specified multiple times
-				duplicateGroupAIInfoCheck[groupAIKey].insert(infoFile.at(0));
-			}
-		}
-	}
-
-	// filter out group AIs that are specified multiple times
-	for (T_dupGroup::const_iterator info = duplicateGroupAIInfoCheck.begin();
-			info != duplicateGroupAIInfoCheck.end(); ++info) {
-		if (info-&gt;second.size() &gt;= 2) {
-			duplicateGroupAIInfos[info-&gt;first] = info-&gt;second;
-
-			logOutput.Print(&quot;WARNING: Duplicate Group AI Info found:&quot;);
-			logOutput.Print(&quot;\tfor Group AI: %s %s&quot;, info-&gt;first.ai.shortName,
-					info-&gt;first.ai.version);
-			logOutput.Print(&quot;\tin files:&quot;);
-			std::set&lt;std::string&gt;::const_iterator dir;
-			for (dir = info-&gt;second.begin(); dir != info-&gt;second.end(); ++dir) {
-				logOutput.Print(&quot;\t%s&quot;, dir-&gt;c_str());
-			}
-		}
-	}
-
 /*
 	std::vector&lt;std::string&gt; infoFiles =
 			FindFiles(std::string(
 			std::string(&quot;&quot;) + AI_INTERFACES_DATA_DIR,
 			std::string(&quot;.&quot;) + SharedLib::GetLibExtension());
-	
+
 	// initialize the interface infos
 	std::vector&lt;std::string&gt;::const_iterator libFile;
 	for (libFile=interfaceLibFiles.begin(); libFile!=interfaceLibFiles.end(); libFile++) { // interfaces
-		
+
 		std::string fileName = std::string(extractFileName(*libFile, false));
-		
+
 		// load the interface
 		IAIInterfaceLibrary* interfaceLib = new CAIInterfaceLibrary(fileName);
 		if (interfaceLib == NULL) {
@@ -370,18 +412,18 @@
 					&quot;Failed to load interface shared library \&quot;%s\&quot;&quot;,
 					libFile-&gt;c_str());
 		}
-		
+
 		SAIInterfaceSpecifier interfaceSpecifier = interfaceLib-&gt;GetSpecifier();
 		interfaceSpecifier = copySAIInterfaceSpecifier(&amp;interfaceSpecifier);
 		interfaceSpecifiers.push_back(interfaceSpecifier);
-		
+
 		// generate and store the interface info
 		CAIInterfaceLibraryInfo* interfaceInfo = new CAIInterfaceLibraryInfo(*interfaceLib);
 		interfaceInfos[interfaceSpecifier] = interfaceInfo;
-		
+
 		// generate and store the pure file name
 		interfaceFileNames[interfaceSpecifier] = fileName;
-		
+
 		// fetch the info of all Skirmish AIs available through the interface
 		std::vector&lt;SSAISpecifier&gt; sass = interfaceLib-&gt;GetSkirmishAILibrarySpecifiers();
 		std::vector&lt;SSAISpecifier&gt;::const_iterator sas;
@@ -393,7 +435,7 @@
 			skirmishAIInfos[skirmishAIKey] = skirmishAIInfo;
 			interfaceLib-&gt;ReleaseSkirmishAILibrary(*sas);
 		}
-		
+
 		// fetch the info of all Group AIs available through the interface
 		std::vector&lt;SGAISpecifier&gt; gass = interfaceLib-&gt;GetGroupAILibrarySpecifiers();
 		std::vector&lt;SGAISpecifier&gt;::const_iterator gas;
@@ -405,7 +447,7 @@
 			groupAIInfos[groupAIKey] = groupAIInfo;
 			interfaceLib-&gt;ReleaseGroupAILibrary(*gas);
 		}
-		
+
 		delete interfaceLib;
 	}
 */
@@ -425,21 +467,83 @@
 		sai-&gt;second = NULL;
 	}
 
-	IAILibraryManager::T_groupAIInfos::iterator gai;
-	for (gai=groupAIInfos.begin(); gai!=groupAIInfos.end(); gai++) {
-		delete gai-&gt;second;
-		gai-&gt;second = NULL;
-	}
+//	IAILibraryManager::T_groupAIInfos::iterator gai;
+//	for (gai=groupAIInfos.begin(); gai!=groupAIInfos.end(); gai++) {
+//		delete gai-&gt;second;
+//		gai-&gt;second = NULL;
+//	}
 
 	interfaceInfos.clear();
 	skirmishAIInfos.clear();
-	groupAIInfos.clear();
+//	groupAIInfos.clear();
 
 	interfaceSpecifiers.clear();
 	skirmishAIKeys.clear();
-	groupAIKeys.clear();
+//	groupAIKeys.clear();
 }
 
+void CAILibraryManager::CreateCOptions() {
+
+	int t;
+	int size_t = teamHandler-&gt;ActiveTeams();
+	for (t=0; t &lt; size_t; ++t) {
+		std::map&lt;std::string, std::string&gt; teamOptions = teamHandler-&gt;Team(t)-&gt;skirmishAIOptions;
+		const char** keys;// = (const char**) malloc(sizeof(const char**));
+		const char** values;// = (const char**) malloc(sizeof(const char**));
+		int unsigned size = allocCPropertiesMap(teamOptions, &amp;keys, &amp;values);
+		teamId_skirmishOptionKeys_c[t] = values;
+		teamId_skirmishOptionValues_c[t] = keys;
+		teamId_skirmishOptionsSize_c[t] = size;
+	}
+}
+
+void CAILibraryManager::DeleteCOptions() {
+
+	std::map&lt;int, const char**&gt;::const_iterator ki;
+	for (ki=teamId_skirmishOptionKeys_c.begin();
+			ki != teamId_skirmishOptionKeys_c.end(); ++ki) {
+		int t = ki-&gt;first;
+		const char** keys = ki-&gt;second;
+		const char** values = teamId_skirmishOptionValues_c[t];
+		int unsigned size = teamId_skirmishOptionsSize_c[t];
+		freeCPropertiesMap(size, keys, values);
+//		free(keys);
+//		free(values);
+	}
+}
+
+
+unsigned int CAILibraryManager::GetSkirmishAICOptionSize(int teamId) const {
+
+	std::map&lt;int, unsigned int&gt;::const_iterator size
+			= teamId_skirmishOptionsSize_c.find(teamId);
+	if (size != teamId_skirmishOptionsSize_c.end()) {
+		return size-&gt;second;
+	} else {
+		return 0;
+	}
+}
+const char** CAILibraryManager::GetSkirmishAICOptionKeys(int teamId) const {
+
+	std::map&lt;int, const char**&gt;::const_iterator keys
+			= teamId_skirmishOptionKeys_c.find(teamId);
+	if (keys != teamId_skirmishOptionKeys_c.end()) {
+		return keys-&gt;second;
+	} else {
+		return NULL;
+	}
+}
+const char** CAILibraryManager::GetSkirmishAICOptionValues(int teamId) const {
+
+	std::map&lt;int, const char**&gt;::const_iterator values
+			= teamId_skirmishOptionValues_c.find(teamId);
+	if (values != teamId_skirmishOptionValues_c.end()) {
+		return values-&gt;second;
+	} else {
+		return NULL;
+	}
+}
+
 CAILibraryManager::~CAILibraryManager() {
 
 	ReleaseEverything();
@@ -450,40 +554,42 @@
 		deleteSSAISpecifier(&amp;(sSpec-&gt;ai));
 	}
 
-	// delete all strings contained in group AI specifiers
-	IAILibraryManager::T_groupAIKeys::iterator gSpec;
-	for (gSpec=groupAIKeys.begin(); gSpec!=groupAIKeys.end(); gSpec++) {
-		deleteSGAISpecifier(&amp;(gSpec-&gt;ai));
-	}
+//	// delete all strings contained in group AI specifiers
+//	IAILibraryManager::T_groupAIKeys::iterator gSpec;
+//	for (gSpec=groupAIKeys.begin(); gSpec!=groupAIKeys.end(); gSpec++) {
+//		deleteSGAISpecifier(&amp;(gSpec-&gt;ai));
+//	}
 
 	// delete all strings contained in interface specifiers
 	IAILibraryManager::T_interfaceSpecs::iterator iSpec;
 	for (iSpec=interfaceSpecifiers.begin(); iSpec!=interfaceSpecifiers.end(); iSpec++) {
 		deleteSAIInterfaceSpecifier(&amp;(*iSpec));
 	}
+
+	DeleteCOptions();
 }
 
-const IAILibraryManager::T_interfaceSpecs* CAILibraryManager::GetInterfaceSpecifiers() const {
-	return &interfaceSpecifiers;
+const IAILibraryManager::T_interfaceSpecs&amp; CAILibraryManager::GetInterfaceSpecifiers() const {
+	return interfaceSpecifiers;
 }
-const IAILibraryManager::T_skirmishAIKeys* CAILibraryManager::GetSkirmishAIKeys() const {
-	return &skirmishAIKeys;
+const IAILibraryManager::T_skirmishAIKeys&amp; CAILibraryManager::GetSkirmishAIKeys() const {
+	return skirmishAIKeys;
 }
-const IAILibraryManager::T_groupAIKeys* CAILibraryManager::GetGroupAIKeys() const {
-	return &groupAIKeys;
-}
+//const IAILibraryManager::T_groupAIKeys&amp; CAILibraryManager::GetGroupAIKeys() const {
+//	return groupAIKeys;
+//}
 
-const IAILibraryManager::T_interfaceInfos* CAILibraryManager::GetInterfaceInfos() const {
-	return &interfaceInfos;
+const IAILibraryManager::T_interfaceInfos&amp; CAILibraryManager::GetInterfaceInfos() const {
+	return interfaceInfos;
 }
-const IAILibraryManager::T_skirmishAIInfos* CAILibraryManager::GetSkirmishAIInfos() const {
-	return &skirmishAIInfos;
+const IAILibraryManager::T_skirmishAIInfos&amp; CAILibraryManager::GetSkirmishAIInfos() const {
+	return skirmishAIInfos;
 }
-const IAILibraryManager::T_groupAIInfos* CAILibraryManager::GetGroupAIInfos() const {
-	return &groupAIInfos;
-}
+//const IAILibraryManager::T_groupAIInfos&amp; CAILibraryManager::GetGroupAIInfos() const {
+//	return groupAIInfos;
+//}
 
-const IAILibraryManager::T_skirmishAIInfos* CAILibraryManager::GetUsedSkirmishAIInfos() {
+const IAILibraryManager::T_skirmishAIInfos&amp; CAILibraryManager::GetUsedSkirmishAIInfos() {
 
 	if (!usedSkirmishAIInfos_initialized) {
 		const CTeam* team = NULL;
@@ -506,22 +612,22 @@
 			}
 		}
 	}
-	
-	return &usedSkirmishAIInfos;
+
+	return usedSkirmishAIInfos;
 }
 
-const IAILibraryManager::T_dupInt* CAILibraryManager::GetDuplicateInterfaceInfos() const {
-	return &duplicateInterfaceInfos;
+const IAILibraryManager::T_dupInt&amp; CAILibraryManager::GetDuplicateInterfaceInfos() const {
+	return duplicateInterfaceInfos;
 }
-const IAILibraryManager::T_dupSkirm* CAILibraryManager::GetDuplicateSkirmishAIInfos() const {
-	return &duplicateSkirmishAIInfos;
+const IAILibraryManager::T_dupSkirm&amp; CAILibraryManager::GetDuplicateSkirmishAIInfos() const {
+	return duplicateSkirmishAIInfos;
 }
-const IAILibraryManager::T_dupGroup* CAILibraryManager::GetDuplicateGroupAIInfos() const {
-	return &duplicateGroupAIInfos;
-}
+//const IAILibraryManager::T_dupGroup&amp; CAILibraryManager::GetDuplicateGroupAIInfos() const {
+//	return duplicateGroupAIInfos;
+//}
 
 
-std::vector&lt;SSAIKey&gt; CAILibraryManager::ResolveSkirmishAIKey(
+std::vector&lt;SSAIKey&gt; CAILibraryManager::FittingSkirmishAIKeys(
 		const SSAISpecifier&amp; skirmishAISpecifier) const {
 
 	std::vector&lt;SSAIKey&gt; applyingKeys;
@@ -558,50 +664,50 @@
 
 	return applyingKeys;
 }
-std::vector&lt;SSAIKey&gt; CAILibraryManager::ResolveSkirmishAIKey(const std::string&amp; skirmishAISpecifier) const {
+//std::vector&lt;SSAIKey&gt; CAILibraryManager::FittingSkirmishAIKeys(const std::string&amp; skirmishAISpecifier) const {
+//
+//	std::vector&lt;SSAIKey&gt; applyingKeys;
+//
+//	std::string* aiName;
+//	std::string* aiVersion;
+//	std::string* interfaceName;
+//	std::string* interfaceVersion;
+//	bool isValid = SplittAIKey(skirmishAISpecifier, aiName, aiVersion, interfaceName, interfaceVersion);
+//	if (!isValid) {
+//		reportError1(&quot;AI Library Error&quot;, &quot;Invalid Skirmish AI Key: %s&quot;, skirmishAISpecifier.c_str());
+//		return applyingKeys;
+//	}
+//
+//	std::set&lt;SSAIKey&gt;::const_iterator sasi;
+//	for (sasi=skirmishAIKeys.begin(); sasi!=skirmishAIKeys.end(); sasi++) {
+//
+//		// check if the ai name fits
+//		if (*aiName != sasi-&gt;ai.shortName) {
+//			continue;
+//		}
+//
+//		// check if the ai version fits (if one is specifyed)
+//		if (aiVersion &amp;&amp; *aiVersion != sasi-&gt;ai.version) {
+//			continue;
+//		}
+//
+//		// check if the interface name fits (if one is specifyed)
+//		if (interfaceName &amp;&amp; *interfaceName != sasi-&gt;interface.shortName) {
+//			continue;
+//		}
+//
+//		// check if the interface version fits (if one is specifyed)
+//		if (interfaceVersion &amp;&amp; *interfaceVersion != sasi-&gt;interface.version) {
+//			continue;
+//		}
+//
+//		// if the programm raches here, we know that this key fits
+//		applyingKeys.push_back(*sasi);
+//	}
+//
+//	return applyingKeys;
+//}
 
-	std::vector&lt;SSAIKey&gt; applyingKeys;
-
-	std::string* aiName;
-	std::string* aiVersion;
-	std::string* interfaceName;
-	std::string* interfaceVersion;
-	bool isValid = SplittAIKey(skirmishAISpecifier, aiName, aiVersion, interfaceName, interfaceVersion);
-	if (!isValid) {
-		reportError1(&quot;AI Library Error&quot;, &quot;Invalid Skirmish AI Key: %s&quot;, skirmishAISpecifier.c_str());
-		return applyingKeys;
-	}
-
-	std::set&lt;SSAIKey&gt;::const_iterator sasi;
-	for (sasi=skirmishAIKeys.begin(); sasi!=skirmishAIKeys.end(); sasi++) {
-
-		// check if the ai name fits
-		if (*aiName != sasi-&gt;ai.shortName) {
-			continue;
-		}
-
-		// check if the ai version fits (if one is specifyed)
-		if (aiVersion &amp;&amp; *aiVersion != sasi-&gt;ai.version) {
-			continue;
-		}
-
-		// check if the interface name fits (if one is specifyed)
-		if (interfaceName &amp;&amp; *interfaceName != sasi-&gt;interface.shortName) {
-			continue;
-		}
-
-		// check if the interface version fits (if one is specifyed)
-		if (interfaceVersion &amp;&amp; *interfaceVersion != sasi-&gt;interface.version) {
-			continue;
-		}
-
-		// if the programm raches here, we know that this key fits
-		applyingKeys.push_back(*sasi);
-	}
-
-	return applyingKeys;
-}
-
 const ISkirmishAILibrary* CAILibraryManager::FetchSkirmishAILibrary(const SSAIKey&amp; skirmishAIKey) {
 
 	T_skirmishAIInfos::const_iterator aiInfo = skirmishAIInfos.find(skirmishAIKey);
@@ -626,77 +732,77 @@
 }
 
 
-std::vector&lt;SGAIKey&gt; CAILibraryManager::ResolveGroupAIKey(const std::string&amp; groupAISpecifier) const {
+//std::vector&lt;SGAIKey&gt; CAILibraryManager::ResolveGroupAIKey(const std::string&amp; groupAISpecifier) const {
+//
+//	std::vector&lt;SGAIKey&gt; applyingKeys;
+//
+//	std::string* aiName;
+//	std::string* aiVersion;
+//	std::string* interfaceName;
+//	std::string* interfaceVersion;
+//	bool isValid = SplittAIKey(groupAISpecifier, aiName, aiVersion, interfaceName, interfaceVersion);
+//	if (!isValid) {
+//		reportError1(&quot;AI Library Error&quot;, &quot;Invalid Group AI Key: %s&quot;, groupAISpecifier.c_str());
+//		return applyingKeys;
+//	}
+//
+//	std::set&lt;SGAIKey&gt;::const_iterator gasi;
+//	for (gasi=groupAIKeys.begin(); gasi!=groupAIKeys.end(); gasi++) {
+//
+//		// check if the ai name fits
+//		if (*aiName != gasi-&gt;ai.shortName) {
+//			continue;
+//		}
+//
+//		// check if the ai version fits (if one is specifyed)
+//		if (aiVersion &amp;&amp; *aiVersion != gasi-&gt;ai.version) {
+//			continue;
+//		}
+//
+//		// check if the interface name fits (if one is specifyed)
+//		if (interfaceName &amp;&amp; *interfaceName != gasi-&gt;interface.shortName) {
+//			continue;
+//		}
+//
+//		// check if the interface version fits (if one is specifyed)
+//		if (interfaceVersion &amp;&amp; *interfaceVersion != gasi-&gt;interface.version) {
+//			continue;
+//		}
+//
+//		// if the programm raches here, we know that this key fits
+//		applyingKeys.push_back(*gasi);
+//	}
+//
+//	return applyingKeys;
+//}
+//
+//const IGroupAILibrary* CAILibraryManager::FetchGroupAILibrary(const SGAIKey&amp; groupAIKey) {
+//
+//	//return FetchInterface(groupAIKey.interface)-&gt;FetchGroupAILibrary(groupAIKey.ai);
+//	T_groupAIInfos::const_iterator aiInfo = groupAIInfos.find(groupAIKey);
+//	if (aiInfo == groupAIInfos.end()) {
+//		return NULL;
+//	}
+//	return FetchInterface(groupAIKey.interface)-&gt;FetchGroupAILibrary(aiInfo-&gt;second);
+//}
+//
+//void CAILibraryManager::ReleaseGroupAILibrary(const SGAIKey&amp; groupAIKey) {
+//	FetchInterface(groupAIKey.interface)-&gt;ReleaseGroupAILibrary(groupAIKey.ai);
+//	ReleaseInterface(groupAIKey.interface); // only releases the library if its load count is 0
+//}
+//
+//void CAILibraryManager::ReleaseAllGroupAILibraries() {
+//
+//	T_loadedInterfaces::const_iterator lil;
+//	for (lil=loadedAIInterfaceLibraries.begin(); lil!=loadedAIInterfaceLibraries.end(); lil++) {
+//		FetchInterface(lil-&gt;first)-&gt;ReleaseAllGroupAILibraries();
+//		ReleaseInterface(lil-&gt;first); // only releases the library if its load count is 0
+//	}
+//}
 
-	std::vector&lt;SGAIKey&gt; applyingKeys;
 
-	std::string* aiName;
-	std::string* aiVersion;
-	std::string* interfaceName;
-	std::string* interfaceVersion;
-	bool isValid = SplittAIKey(groupAISpecifier, aiName, aiVersion, interfaceName, interfaceVersion);
-	if (!isValid) {
-		reportError1(&quot;AI Library Error&quot;, &quot;Invalid Group AI Key: %s&quot;, groupAISpecifier.c_str());
-		return applyingKeys;
-	}
 
-	std::set&lt;SGAIKey&gt;::const_iterator gasi;
-	for (gasi=groupAIKeys.begin(); gasi!=groupAIKeys.end(); gasi++) {
 
-		// check if the ai name fits
-		if (*aiName != gasi-&gt;ai.shortName) {
-			continue;
-		}
-
-		// check if the ai version fits (if one is specifyed)
-		if (aiVersion &amp;&amp; *aiVersion != gasi-&gt;ai.version) {
-			continue;
-		}
-
-		// check if the interface name fits (if one is specifyed)
-		if (interfaceName &amp;&amp; *interfaceName != gasi-&gt;interface.shortName) {
-			continue;
-		}
-
-		// check if the interface version fits (if one is specifyed)
-		if (interfaceVersion &amp;&amp; *interfaceVersion != gasi-&gt;interface.version) {
-			continue;
-		}
-
-		// if the programm raches here, we know that this key fits
-		applyingKeys.push_back(*gasi);
-	}
-
-	return applyingKeys;
-}
-
-const IGroupAILibrary* CAILibraryManager::FetchGroupAILibrary(const SGAIKey&amp; groupAIKey) {
-
-	//return FetchInterface(groupAIKey.interface)-&gt;FetchGroupAILibrary(groupAIKey.ai);
-	T_groupAIInfos::const_iterator aiInfo = groupAIInfos.find(groupAIKey);
-	if (aiInfo == groupAIInfos.end()) {
-		return NULL;
-	}
-	return FetchInterface(groupAIKey.interface)-&gt;FetchGroupAILibrary(aiInfo-&gt;second);
-}
-
-void CAILibraryManager::ReleaseGroupAILibrary(const SGAIKey&amp; groupAIKey) {
-	FetchInterface(groupAIKey.interface)-&gt;ReleaseGroupAILibrary(groupAIKey.ai);
-	ReleaseInterface(groupAIKey.interface); // only releases the library if its load count is 0
-}
-
-void CAILibraryManager::ReleaseAllGroupAILibraries() {
-
-	T_loadedInterfaces::const_iterator lil;
-	for (lil=loadedAIInterfaceLibraries.begin(); lil!=loadedAIInterfaceLibraries.end(); lil++) {
-		FetchInterface(lil-&gt;first)-&gt;ReleaseAllGroupAILibraries();
-		ReleaseInterface(lil-&gt;first); // only releases the library if its load count is 0
-	}
-}
-
-
-
-
 IAIInterfaceLibrary* CAILibraryManager::FetchInterface(const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
 
 	IAIInterfaceLibrary* interfaceLib = NULL;
@@ -735,9 +841,9 @@
 
 /** unloads all interfaces and AIs */
 void CAILibraryManager::ReleaseEverything() {
-	
+
 	ReleaseAllSkirmishAILibraries();
-	ReleaseAllGroupAILibraries();
+//	ReleaseAllGroupAILibraries();
 }
 
 std::vector&lt;std::string&gt; CAILibraryManager::FindFiles(const std::string&amp; path, const std::string&amp; fileExtension) {
@@ -805,22 +911,22 @@
 }
 
 std::vector&lt;std::string&gt; split(const std::string&amp; str, const char sep) {
-	
+
 /*
 	std::vector&lt;std::string&gt; parts;
-	
+
 	std::istringstream s(str);
 	std::string temp;
 
 	while (std::getline(s, temp, sep)) {
 		parts.push_back(temp);
 	}
-	
+
 	return parts;
 */
 	std::vector&lt;std::string&gt; tokens;
 	std::string delimitters = &quot;.&quot;;
-	
+
     // Skip delimiters at beginning.
     std::string::size_type lastPos = str.find_first_not_of(delimitters, 0);
     // Find first &quot;non-delimiter&quot;.
@@ -835,7 +941,7 @@
         // Find next &quot;non-delimiter&quot;
         pos = str.find_first_of(delimitters, lastPos);
     }
-	
+
 	return tokens;
 }
 int CAILibraryManager::versionCompare(

Modified: branches/caiinterface/rts/ExternalAI/AILibraryManager.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/AILibraryManager.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/AILibraryManager.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -35,30 +35,34 @@
 //	typedef s_cont&lt;CSkirmishAILibraryInfoKey&gt;::vector T_infoKeys;
 ////	typedef s_cont&lt;ISkirmishAILibraryInfo&gt;::vector T_aiInfos;
 //	typedef s_cont&lt;std::string&gt;::vector T_specifiers;
-//	
+//
 //	typedef s_assoc&lt;ISkirmishAILibraryInterfaceInfo, std::string&gt;::map T_fileNames;
 //	typedef s_assoc&lt;ISkirmishAILibraryInterfaceInfo, ISkirmishAILibraryInterface&gt;::map T_loadedInterfaces;
-	
+
 public:
 	CAILibraryManager(); // looks for interface and AIs supported by them (ret != 0: error)
 	~CAILibraryManager(); // unloads all shared libraries that are currently loaded (interfaces and implementations)
-	
-	virtual const T_interfaceSpecs* GetInterfaceSpecifiers() const;
-	virtual const T_skirmishAIKeys* GetSkirmishAIKeys() const;
-	virtual const T_groupAIKeys* GetGroupAIKeys() const;
-	
-	virtual const T_interfaceInfos* GetInterfaceInfos() const;
-	virtual const T_skirmishAIInfos* GetSkirmishAIInfos() const;
-	virtual const T_groupAIInfos* GetGroupAIInfos() const;
-	
-	virtual const T_skirmishAIInfos* GetUsedSkirmishAIInfos();
-	
-	virtual const T_dupInt* GetDuplicateInterfaceInfos() const;
-	virtual const T_dupSkirm* GetDuplicateSkirmishAIInfos() const;
-	virtual const T_dupGroup* GetDuplicateGroupAIInfos() const;
 
-	virtual std::vector&lt;SSAIKey&gt; ResolveSkirmishAIKey(const SSAISpecifier&amp; skirmishAISpecifier) const;
-	virtual std::vector&lt;SSAIKey&gt; ResolveSkirmishAIKey(const std::string&amp; skirmishAISpecifier) const;
+	virtual const T_interfaceSpecs&amp; GetInterfaceSpecifiers() const;
+	virtual const T_skirmishAIKeys&amp; GetSkirmishAIKeys() const;
+//	virtual const T_groupAIKeys&amp; GetGroupAIKeys() const;
+
+	virtual const T_interfaceInfos&amp; GetInterfaceInfos() const;
+	virtual const T_skirmishAIInfos&amp; GetSkirmishAIInfos() const;
+//	virtual const T_groupAIInfos&amp; GetGroupAIInfos() const;
+
+	virtual unsigned int GetSkirmishAICOptionSize(int teamId) const;
+	virtual const char** GetSkirmishAICOptionKeys(int teamId) const;
+	virtual const char** GetSkirmishAICOptionValues(int teamId) const;
+
+	virtual const T_skirmishAIInfos&amp; GetUsedSkirmishAIInfos();
+
+	virtual const T_dupInt&amp; GetDuplicateInterfaceInfos() const;
+	virtual const T_dupSkirm&amp; GetDuplicateSkirmishAIInfos() const;
+//	virtual const T_dupGroup&amp; GetDuplicateGroupAIInfos() const;
+
+	virtual std::vector&lt;SSAIKey&gt; FittingSkirmishAIKeys(const SSAISpecifier&amp; skirmishAISpecifier) const;
+//	virtual std::vector&lt;SSAIKey&gt; FittingSkirmishAIKeys(const std::string&amp; skirmishAISpecifier) const;
 	// a Skirmish AI (its library) is only really loaded when it is not yet loaded.
 	virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const SSAIKey&amp; skirmishAIKey);
 	// a Skirmish AI is only unloaded when ReleaseSkirmishAILibrary() is called
@@ -67,41 +71,45 @@
 	// is handled internally/automatically.
 	virtual void ReleaseSkirmishAILibrary(const SSAIKey&amp; skirmishAIKey);
 	virtual void ReleaseAllSkirmishAILibraries(); // unloads all currently Skirmish loaded AIs
-	
-	virtual std::vector&lt;SGAIKey&gt; ResolveGroupAIKey(const std::string&amp; groupAISpecifier) const;
-	// a Group AI (its library) is only really loaded when it is not yet loaded.
-	virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAIKey&amp; groupAIKey);
-	// a Group AI is only unloaded when ReleaseSkirmishAILibrary() is called
-	// as many times as GetSkirmishAILibrary() was.
-	// loading and unloading of the interfaces
-	// is handled internally/automatically.
-	virtual void ReleaseGroupAILibrary(const SGAIKey&amp; groupAIKey);
-	virtual void ReleaseAllGroupAILibraries(); // unloads all currently loaded Group AIs
-	
+
+//	virtual std::vector&lt;SGAIKey&gt; ResolveGroupAIKey(const std::string&amp; groupAISpecifier) const;
+//	// a Group AI (its library) is only really loaded when it is not yet loaded.
+//	virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAIKey&amp; groupAIKey);
+//	// a Group AI is only unloaded when ReleaseSkirmishAILibrary() is called
+//	// as many times as GetSkirmishAILibrary() was.
+//	// loading and unloading of the interfaces
+//	// is handled internally/automatically.
+//	virtual void ReleaseGroupAILibrary(const SGAIKey&amp; groupAIKey);
+//	virtual void ReleaseAllGroupAILibraries(); // unloads all currently loaded Group AIs
+
 	virtual void ReleaseEverything(); // unloads all currently loaded AIs and interfaces
-	
+
 private:
 	typedef std::map&lt;const SAIInterfaceSpecifier, IAIInterfaceLibrary*, SAIInterfaceSpecifier_Comparator&gt; T_loadedInterfaces;
 	T_loadedInterfaces loadedAIInterfaceLibraries;
-	
+
 	T_interfaceSpecs interfaceSpecifiers;
 	T_skirmishAIKeys skirmishAIKeys;
-	T_groupAIKeys groupAIKeys;
+//	T_groupAIKeys groupAIKeys;
 //	std::vector&lt;const SAIInterfaceSpecifier&gt; interfaceLibrarySpecifiers;
 //	std::vector&lt;const SSAIKey&gt; skirmishAILibrarySpecifiers;
 //	std::vector&lt;const SGAIKey&gt; groupAILibrarySpecifiers;
 	//std::map&lt;const SAIInterfaceSpecifier, std::string, SAIInterfaceSpecifier_Comparator&gt; interfaceFileNames; // file name of the AI interface library and (LUA-)info cache file (these two have to be the same [without extension])
-	
+
 	T_interfaceInfos interfaceInfos;
 	T_skirmishAIInfos skirmishAIInfos;
-	T_groupAIInfos groupAIInfos;
-	
+//	T_groupAIInfos groupAIInfos;
+
+	std::map&lt;int, const char**&gt; teamId_skirmishOptionKeys_c;
+	std::map&lt;int, const char**&gt; teamId_skirmishOptionValues_c;
+	std::map&lt;int, unsigned int&gt; teamId_skirmishOptionsSize_c;
+
 	T_skirmishAIInfos usedSkirmishAIInfos;
 	bool usedSkirmishAIInfos_initialized;
-	
+
 	T_dupInt duplicateInterfaceInfos;
 	T_dupSkirm duplicateSkirmishAIInfos;
-	T_dupGroup duplicateGroupAIInfos;
+//	T_dupGroup duplicateGroupAIInfos;
 //	T_interfaceInfos interfaceInfos;
 //	T_infoKeys infoKeys;
 ////	typedef s_cont&lt;ISkirmishAILibraryInfo&gt;::vector T_aiInfos;
@@ -109,16 +117,16 @@
 ////	T_aiInfos aiInfos;
 //	T_specifiers specifiers;
 //	T_fileNames fileNames; // file name of the library and (LUA-)info cache file (without extension)
-//	
+//
 //	T_loadedInterfaces loadedInterfaces;
 ////	std::map&lt;const ISkirmishAILibraryInterfaceInfo, ISkirmishAILibraryInterface*&gt; interfaceInfo_interface; // loaded interfaces
 ////	std::map&lt;const CSkirmishAILibraryInfoKey&amp;, CSkirmishAILibraryKey*&gt; infoKey_key; // loaded AI keys
 ////	std::map&lt;const ISkirmishAILibraryInterfaceInfo&amp;, SAIInterfaceLibrary*&gt; interfaceInfo_interface; // interface shared-lib file and interface
 ////	std::map&lt;const ISkirmishAILibraryInterfaceInfo&amp;, int&gt; interfaceInfo_loadCounter; // interface shared-lib file and how many times it is loaded
-//	
+//
 ////	std::map&lt;const std::string, const SAI*&gt; aiLibFile_ai; // ai shared-lib file and ai
 ////	std::map&lt;const std::string, int&gt; aiLibFile_counter; // ai shared-lib file and how many times it is loaded
-	
+
 private:
 	/**
 	 * Loads the interface if it is not yet loaded; increments load count.
@@ -141,7 +149,7 @@
 //	void UnloadInterface(const s_p&lt;const ISkirmishAILibraryInterfaceInfo&gt;&amp; interfaceInfo);
 //	// actually unloads an interface (always unloads it)
 //	static void DeinitializeInterface(const std::string&amp; libFileName);
-//	
+//
 //	std::string GenerateLibFilePath(const s_p&lt;const ISkirmishAILibraryInterfaceInfo&gt;&amp; interfaceInfo);
 ////	static std::string GenerateLibFileName(const ISkirmishAILibraryInterfaceInfo&amp; interfaceInfo);
 ////	static ISkirmishAILibraryInterfaceInfo GenerateInfo(const std::string&amp; libFileName);
@@ -171,7 +179,10 @@
 	 * Clears info about available AIs.
 	 */
 	void ClearAllInfos();
-	
+
+	void CreateCOptions();
+	void DeleteCOptions();
+
 private:
 	// helper functions
 	static void reportError(const char* topic, const char* msg);
@@ -200,4 +211,4 @@
 			const std::string&amp; version2);
 };
 
-#endif	/* _AILIBRARYMANAGER_H */
+#endif // _AILIBRARYMANAGER_H

Modified: branches/caiinterface/rts/ExternalAI/EngineOutHandler.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/EngineOutHandler.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/EngineOutHandler.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -556,8 +556,7 @@
 
 
 
-bool CEngineOutHandler::CreateSkirmishAI(int teamId, const SSAIKey&amp; key,
-		const std::map&lt;std::string, std::string&gt;&amp; options) {
+bool CEngineOutHandler::CreateSkirmishAI(int teamId, const SSAIKey&amp; key) {
 
 	if ((teamId &lt; 0) || (teamId &gt;= (int)activeTeams)) {
 		return false;
@@ -569,7 +568,7 @@
 			skirmishAIs[teamId] = NULL;
 		}
 
-		skirmishAIs[teamId] = SAFE_NEW CSkirmishAIWrapper(teamId, key, options);
+		skirmishAIs[teamId] = SAFE_NEW CSkirmishAIWrapper(teamId, key);
 		hasSkirmishAIs = true;
 		
 		return true;

Modified: branches/caiinterface/rts/ExternalAI/EngineOutHandler.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/EngineOutHandler.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/EngineOutHandler.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -80,8 +80,7 @@
 
 
 	// Skirmish AI stuff
-	bool CreateSkirmishAI(int teamId, const SSAIKey&amp; key,
-			const std::map&lt;std::string, std::string&gt;&amp; options);
+	bool CreateSkirmishAI(int teamId, const SSAIKey&amp; key);
 	bool IsSkirmishAI(int teamId) const;
 	void DestroySkirmishAI(int teamId);
 	//const CSkirmishAIWrapper* GetSkirmishAI(int teamId);

Modified: branches/caiinterface/rts/ExternalAI/GroupAI.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAI.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/GroupAI.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -20,19 +20,20 @@
 #include &quot;IAILibraryManager.h&quot;
 #include &quot;IGroupAILibrary.h&quot;
 
-CGroupAI::CGroupAI(int teamId, int groupId, const SGAIKey&amp; key)
-		: teamId(teamId), groupId(groupId), key(key) {
+//CGroupAI::CGroupAI(int teamId, int groupId, const SGAIKey&amp; key)
+//		: teamId(teamId), groupId(groupId), key(key) {
+//
+////	library = IAILibraryManager::GetInstance()-&gt;FetchGroupAILibrary(key);
+////	library-&gt;Init(teamId, groupId);
+//}
+//
+//CGroupAI::~CGroupAI() {
+//
+////	library-&gt;Release(teamId, groupId);
+////	IAILibraryManager::GetInstance()-&gt;ReleaseGroupAILibrary(key);
+//}
 
-	library = IAILibraryManager::GetInstance()-&gt;FetchGroupAILibrary(key);
-	library-&gt;Init(teamId, groupId);
-}
-
-CGroupAI::~CGroupAI() {
-
-	library-&gt;Release(teamId, groupId);
-	IAILibraryManager::GetInstance()-&gt;ReleaseGroupAILibrary(key);
-}
-
 int CGroupAI::HandleEvent(int topic, const void* data) const {
-	return library-&gt;HandleEvent(teamId, groupId, topic, data);
+//	return library-&gt;HandleEvent(teamId, groupId, topic, data);
+return -1;
 }

Modified: branches/caiinterface/rts/ExternalAI/GroupAI.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAI.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/GroupAI.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -26,16 +26,16 @@
 
 class CGroupAI : public IGroupAI {
 public:
-	CGroupAI(int teamId, int groupId, const SGAIKey&amp; key);
-	virtual ~CGroupAI();
+//	CGroupAI(int teamId, int groupId, const SGAIKey&amp; key);
+//	virtual ~CGroupAI();
 
 	virtual int HandleEvent(int topic, const void* data) const;
 
 private:
 	int teamId;
 	int groupId;
-	const SGAIKey key;
+//	const SGAIKey key;
 	const IGroupAILibrary* library;
 };
 
-#endif	// _GROUPAI_H
+#endif // _GROUPAI_H

Modified: branches/caiinterface/rts/ExternalAI/IAIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/IAIInterfaceLibrary.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/IAIInterfaceLibrary.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -28,14 +28,15 @@
 class IAIInterfaceLibrary {
 public:
 	virtual ~IAIInterfaceLibrary() {}
-	
+
 	virtual SAIInterfaceSpecifier GetSpecifier() const = 0;
+
 	virtual LevelOfSupport GetLevelOfSupportFor(
 			const std::string&amp; engineVersionString, int engineVersionNumber) const = 0;
-	
+
 //    virtual std::string GetProperty(const std::string&amp; propertyName) const = 0;
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const = 0;
-	
+//    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const = 0;
+
 	/**
 	 * @brief	how many times is this interface loaded
 	 * Thought the AI library may be loaded only once, it can be logically
@@ -44,9 +45,9 @@
 	 * the interface load counter will be three.
 	 */
 	virtual int GetLoadCount() const = 0;
-	
-	
-	
+
+
+
 //	virtual std::vector&lt;ISkirmishAILibraryInfo*&gt; GetSkirmishAILibraryInfo(bool forceLoadFromLibrary = false) const;
 	/**
 	 * Returns the specifiers for all Skirmish AIs available through this interface.
@@ -88,21 +89,20 @@
 	 * Unloads all AI libraries currently loaded through this interface.
 	 */
 	virtual int ReleaseAllSkirmishAILibraries() = 0;
-	
-	
-	
-//	virtual std::vector&lt;IGroupAILibraryInfo*&gt; GetGroupAILibraryInfo(bool forceLoadFromLibrary = false) const;
-	//virtual std::vector&lt;SGAISpecifier&gt; GetGroupAILibrarySpecifiers() const = 0;
-	//virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) = 0;
-	//virtual const IGroupAILibrary* FetchGroupAILibrary(const InfoItem* info, unsigned int numInfo) = 0;
-	virtual const IGroupAILibrary* FetchGroupAILibrary(const CGroupAILibraryInfo* aiInfo) = 0;
-	virtual int ReleaseGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) = 0;
-	virtual int GetGroupAILibraryLoadCount(const SGAISpecifier&amp; gAISpecifier) const = 0;
-	bool IsGroupAILibraryLoaded(const SGAISpecifier&amp; gAISpecifier) const {
-		return GetGroupAILibraryLoadCount(gAISpecifier) &gt; 0;
-	}
-	virtual int ReleaseAllGroupAILibraries() = 0;
+
+
+
+////	virtual std::vector&lt;IGroupAILibraryInfo*&gt; GetGroupAILibraryInfo(bool forceLoadFromLibrary = false) const;
+//	//virtual std::vector&lt;SGAISpecifier&gt; GetGroupAILibrarySpecifiers() const = 0;
+//	//virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) = 0;
+//	//virtual const IGroupAILibrary* FetchGroupAILibrary(const InfoItem* info, unsigned int numInfo) = 0;
+//	virtual const IGroupAILibrary* FetchGroupAILibrary(const CGroupAILibraryInfo* aiInfo) = 0;
+//	virtual int ReleaseGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) = 0;
+//	virtual int GetGroupAILibraryLoadCount(const SGAISpecifier&amp; gAISpecifier) const = 0;
+//	bool IsGroupAILibraryLoaded(const SGAISpecifier&amp; gAISpecifier) const {
+//		return GetGroupAILibraryLoadCount(gAISpecifier) &gt; 0;
+//	}
+//	virtual int ReleaseAllGroupAILibraries() = 0;
 };
 
-#endif	/* _IAIINTERFACELIBRARY_H */
-
+#endif // _IAIINTERFACELIBRARY_H

Modified: branches/caiinterface/rts/ExternalAI/IAILibraryManager.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/IAILibraryManager.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/IAILibraryManager.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -46,7 +46,7 @@
 void IAILibraryManager::OutputAIInterfacesInfo() {
 
 	const IAILibraryManager* myLibManager = IAILibraryManager::GetInstance();
-	const T_interfaceSpecs* specs =
+	const T_interfaceSpecs&amp; specs =
 			myLibManager-&gt;GetInterfaceSpecifiers();
 	
 	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
@@ -55,7 +55,7 @@
 	std::cout &lt;&lt; &quot;# [Name]              [Version]&quot; &lt;&lt; std::endl;
 	
 	T_interfaceSpecs::const_iterator spec;
-    for (spec=specs-&gt;begin(); spec != specs-&gt;end(); spec++) {
+    for (spec=specs.begin(); spec != specs.end(); spec++) {
 		std::cout &lt;&lt; &quot;  &quot;;
 		std::cout &lt;&lt; spec-&gt;shortName &lt;&lt; fillUpTo(spec-&gt;shortName, 20);
 		std::cout &lt;&lt; spec-&gt;version &lt;&lt; fillUpTo(spec-&gt;version, 20) &lt;&lt; std::endl;
@@ -64,10 +64,21 @@
 	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
 }
 
+SSAIKey IAILibraryManager::ResolveSkirmishAIKey(const SSAISpecifier&amp; skirmishAISpecifier) const {
+
+	std::vector&lt;SSAIKey&gt; fittingKeys = FittingSkirmishAIKeys(skirmishAISpecifier);
+	if (fittingKeys.size() &gt; 0) {
+		return fittingKeys[0];
+	} else {
+		SSAIKey nullKey = {{NULL, NULL}, {NULL, NULL}};
+		return nullKey;
+	}
+}
+
 void IAILibraryManager::OutputSkirmishAIInfo() {
 
 	const IAILibraryManager* myLibManager = IAILibraryManager::GetInstance();
-	const T_skirmishAIKeys* keys = myLibManager-&gt;GetSkirmishAIKeys();
+	const T_skirmishAIKeys&amp; keys = myLibManager-&gt;GetSkirmishAIKeys();
 	
 	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
 	std::cout &lt;&lt; &quot;# Available Spring Skirmish AIs&quot; &lt;&lt; std::endl;
@@ -76,7 +87,7 @@
 			&quot;[Interface-name]    [Interface-version]&quot; &lt;&lt; std::endl;
 	
 	T_skirmishAIKeys::const_iterator key;
-    for (key=keys-&gt;begin(); key != keys-&gt;end(); key++) {
+    for (key=keys.begin(); key != keys.end(); key++) {
 		std::cout &lt;&lt; &quot;  &quot;;
 		std::cout &lt;&lt; key-&gt;ai.shortName &lt;&lt; fillUpTo(key-&gt;ai.shortName, 20);
 		std::cout &lt;&lt; key-&gt;ai.version &lt;&lt; fillUpTo(key-&gt;ai.version, 20);
@@ -85,10 +96,10 @@
 		std::cout &lt;&lt; key-&gt;interface.version &lt;&lt; std::endl;
     }
 	
-	const T_dupSkirm* duplicateSkirmishAIInfos =
+	const T_dupSkirm&amp; duplicateSkirmishAIInfos =
 			myLibManager-&gt;GetDuplicateSkirmishAIInfos();
-	for (T_dupSkirm::const_iterator info = duplicateSkirmishAIInfos-&gt;begin();
-			info != duplicateSkirmishAIInfos-&gt;end(); ++info) {
+	for (T_dupSkirm::const_iterator info = duplicateSkirmishAIInfos.begin();
+			info != duplicateSkirmishAIInfos.end(); ++info) {
 		std::cout &lt;&lt; &quot;# WARNING: Duplicate Skirmish AI Info found:&quot;
 				&lt;&lt; std::endl;
 		std::cout &lt;&lt; &quot;# \tfor Skirmish AI: &quot; &lt;&lt; info-&gt;first.ai.shortName
@@ -103,82 +114,82 @@
 	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
 }
 
-void IAILibraryManager::OutputGroupAIInfo() {
+//void IAILibraryManager::OutputGroupAIInfo() {
+//
+//	const IAILibraryManager* myLibManager = IAILibraryManager::GetInstance();
+//	const T_groupAIKeys&amp; keys = myLibManager-&gt;GetGroupAIKeys();
+//
+//	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
+//	std::cout &lt;&lt; &quot;# Available Spring Group AIs&quot; &lt;&lt; std::endl;
+//	std::cout &lt;&lt; &quot;# --------------------------&quot; &lt;&lt; std::endl;
+//	std::cout &lt;&lt; &quot;# [Name]              [Version]           &quot;
+//			&quot;[Interface-name]    [Interface-version]&quot; &lt;&lt; std::endl;
+//
+//	T_groupAIKeys::const_iterator key;
+//    for (key=keys.begin(); key != keys.end(); key++) {
+//		std::cout &lt;&lt; &quot;  &quot;;
+//		std::cout &lt;&lt; key-&gt;ai.shortName &lt;&lt; fillUpTo(key-&gt;ai.shortName, 20);
+//		std::cout &lt;&lt; key-&gt;ai.version &lt;&lt; fillUpTo(key-&gt;ai.version, 20);
+//		std::cout &lt;&lt; key-&gt;interface.shortName
+//				&lt;&lt; fillUpTo(key-&gt;interface.shortName, 20);
+//		std::cout &lt;&lt; key-&gt;interface.version &lt;&lt; std::endl;
+//    }
+//
+//	const T_dupGroup&amp; duplicateGroupAIInfos =
+//			myLibManager-&gt;GetDuplicateGroupAIInfos();
+//	for (T_dupGroup::const_iterator info = duplicateGroupAIInfos.begin();
+//			info != duplicateGroupAIInfos.end(); ++info) {
+//		std::cout &lt;&lt; &quot;# WARNING: Duplicate Group AI Info found:&quot;
+//				&lt;&lt; std::endl;
+//		std::cout &lt;&lt; &quot;# \tfor Group AI: &quot; &lt;&lt; info-&gt;first.ai.shortName
+//				&lt;&lt; &quot; &quot; &lt;&lt; info-&gt;first.ai.version &lt;&lt; std::endl;
+//		std::cout &lt;&lt; &quot;# \tin files:&quot; &lt;&lt; std::endl;
+//		std::set&lt;std::string&gt;::const_iterator dir;
+//		for (dir = info-&gt;second.begin(); dir != info-&gt;second.end(); ++dir) {
+//			std::cout &lt;&lt; &quot;# \t&quot; &lt;&lt; dir-&gt;c_str() &lt;&lt; std::endl;
+//		}
+//	}
+//
+//	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
+//}
 	
-	const IAILibraryManager* myLibManager = IAILibraryManager::GetInstance();
-	const T_groupAIKeys* keys = myLibManager-&gt;GetGroupAIKeys();
-	
-	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
-	std::cout &lt;&lt; &quot;# Available Spring Group AIs&quot; &lt;&lt; std::endl;
-	std::cout &lt;&lt; &quot;# --------------------------&quot; &lt;&lt; std::endl;
-	std::cout &lt;&lt; &quot;# [Name]              [Version]           &quot;
-			&quot;[Interface-name]    [Interface-version]&quot; &lt;&lt; std::endl;
-	
-	T_groupAIKeys::const_iterator key;
-    for (key=keys-&gt;begin(); key != keys-&gt;end(); key++) {
-		std::cout &lt;&lt; &quot;  &quot;;
-		std::cout &lt;&lt; key-&gt;ai.shortName &lt;&lt; fillUpTo(key-&gt;ai.shortName, 20);
-		std::cout &lt;&lt; key-&gt;ai.version &lt;&lt; fillUpTo(key-&gt;ai.version, 20);
-		std::cout &lt;&lt; key-&gt;interface.shortName
-				&lt;&lt; fillUpTo(key-&gt;interface.shortName, 20);
-		std::cout &lt;&lt; key-&gt;interface.version &lt;&lt; std::endl;
-    }
-	
-	const T_dupGroup* duplicateGroupAIInfos =
-			myLibManager-&gt;GetDuplicateGroupAIInfos();
-	for (T_dupGroup::const_iterator info = duplicateGroupAIInfos-&gt;begin();
-			info != duplicateGroupAIInfos-&gt;end(); ++info) {
-		std::cout &lt;&lt; &quot;# WARNING: Duplicate Group AI Info found:&quot;
-				&lt;&lt; std::endl;
-		std::cout &lt;&lt; &quot;# \tfor Group AI: &quot; &lt;&lt; info-&gt;first.ai.shortName
-				&lt;&lt; &quot; &quot; &lt;&lt; info-&gt;first.ai.version &lt;&lt; std::endl;
-		std::cout &lt;&lt; &quot;# \tin files:&quot; &lt;&lt; std::endl;
-		std::set&lt;std::string&gt;::const_iterator dir;
-		for (dir = info-&gt;second.begin(); dir != info-&gt;second.end(); ++dir) {
-			std::cout &lt;&lt; &quot;# \t&quot; &lt;&lt; dir-&gt;c_str() &lt;&lt; std::endl;
-		}
-	}
-	
-	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
-}
-	
-bool IAILibraryManager::SplittAIKey(const std::string&amp; key,
-		std::string* aiName,
-		std::string* aiVersion,
-		std::string* interfaceName,
-		std::string* interfaceVersion) {
-
-	bool isValid = true;
-
-	size_t sepPos;
-	size_t versionSepPos;
-	std::string tmp;
-
-	// interface
-	sepPos = key.find('_');
-	if (sepPos != std::string::npos) { // interface info is available
-		tmp = key.substr(0, sepPos); // interface part
-		versionSepPos = tmp.find('#');
-		if (versionSepPos != std::string::npos) { // interface version info available
-			interfaceName = new std::string(tmp.substr(0, versionSepPos));
-			interfaceVersion = new std::string(tmp.substr(versionSepPos+1));
-		} else {
-			interfaceName = new std::string(tmp);
-		}
-
-		tmp = key.substr(sepPos+1); // ai part
-	} else {
-		tmp = key; // ai part
-	}
-
-	// ai
-	versionSepPos = tmp.find('#');
-	if (versionSepPos != std::string::npos) { // ai version info available
-		aiName = new std::string(tmp.substr(0, versionSepPos));
-		aiVersion = new std::string(tmp.substr(versionSepPos+1));
-	} else {
-		aiName = new std::string(tmp);
-	}
-
-	return isValid;
-}
+//bool IAILibraryManager::SplittAIKey(const std::string&amp; key,
+//		std::string* aiName,
+//		std::string* aiVersion,
+//		std::string* interfaceName,
+//		std::string* interfaceVersion) {
+//
+//	bool isValid = true;
+//
+//	size_t sepPos;
+//	size_t versionSepPos;
+//	std::string tmp;
+//
+//	// interface
+//	sepPos = key.find('_');
+//	if (sepPos != std::string::npos) { // interface info is available
+//		tmp = key.substr(0, sepPos); // interface part
+//		versionSepPos = tmp.find('#');
+//		if (versionSepPos != std::string::npos) { // interface version info available
+//			interfaceName = new std::string(tmp.substr(0, versionSepPos));
+//			interfaceVersion = new std::string(tmp.substr(versionSepPos+1));
+//		} else {
+//			interfaceName = new std::string(tmp);
+//		}
+//
+//		tmp = key.substr(sepPos+1); // ai part
+//	} else {
+//		tmp = key; // ai part
+//	}
+//
+//	// ai
+//	versionSepPos = tmp.find('#');
+//	if (versionSepPos != std::string::npos) { // ai version info available
+//		aiName = new std::string(tmp.substr(0, versionSepPos));
+//		aiVersion = new std::string(tmp.substr(versionSepPos+1));
+//	} else {
+//		aiName = new std::string(tmp);
+//	}
+//
+//	return isValid;
+//}

Modified: branches/caiinterface/rts/ExternalAI/IAILibraryManager.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/IAILibraryManager.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/IAILibraryManager.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -35,46 +35,53 @@
  * @brief manages AIs and AI interfaces
  */
 class IAILibraryManager {
-	
+
 public:
 	virtual ~IAILibraryManager() {}
-	
+
 	typedef std::set&lt;SAIInterfaceSpecifier, SAIInterfaceSpecifier_Comparator&gt; T_interfaceSpecs;
 	typedef std::set&lt;SSAIKey, SSAIKey_Comparator&gt; T_skirmishAIKeys;
-	typedef std::set&lt;SGAIKey, SGAIKey_Comparator&gt; T_groupAIKeys;
-	
-	virtual const T_interfaceSpecs* GetInterfaceSpecifiers() const = 0;
-	virtual const T_skirmishAIKeys* GetSkirmishAIKeys() const = 0;
-	virtual const T_groupAIKeys* GetGroupAIKeys() const = 0;
-	
+//	typedef std::set&lt;SGAIKey, SGAIKey_Comparator&gt; T_groupAIKeys;
+
+	virtual const T_interfaceSpecs&amp; GetInterfaceSpecifiers() const = 0;
+	virtual const T_skirmishAIKeys&amp; GetSkirmishAIKeys() const = 0;
+//	virtual const T_groupAIKeys&amp; GetGroupAIKeys() const = 0;
+
 	typedef std::map&lt;const SAIInterfaceSpecifier, CAIInterfaceLibraryInfo*,
 			SAIInterfaceSpecifier_Comparator&gt; T_interfaceInfos;
 	typedef std::map&lt;const SSAIKey, CSkirmishAILibraryInfo*, SSAIKey_Comparator&gt;
 			T_skirmishAIInfos;
-	typedef std::map&lt;const SGAIKey, CGroupAILibraryInfo*, SGAIKey_Comparator&gt;
-			T_groupAIInfos;
-	
-	virtual const T_interfaceInfos* GetInterfaceInfos() const = 0;
-	virtual const T_skirmishAIInfos* GetSkirmishAIInfos() const = 0;
-	virtual const T_groupAIInfos* GetGroupAIInfos() const = 0;
-	
-	virtual const T_skirmishAIInfos* GetUsedSkirmishAIInfos() = 0;
-	
+//	typedef std::map&lt;const SGAIKey, CGroupAILibraryInfo*, SGAIKey_Comparator&gt;
+//			T_groupAIInfos;
+
+	virtual const T_interfaceInfos&amp; GetInterfaceInfos() const = 0;
+	virtual const T_skirmishAIInfos&amp; GetSkirmishAIInfos() const = 0;
+//	virtual const T_groupAIInfos&amp; GetGroupAIInfos() const = 0;
+
+	virtual unsigned int GetSkirmishAICOptionSize(int teamId) const = 0;
+	virtual const char** GetSkirmishAICOptionKeys(int teamId) const = 0;
+	virtual const char** GetSkirmishAICOptionValues(int teamId) const = 0;
+
+	virtual const T_skirmishAIInfos&amp; GetUsedSkirmishAIInfos() = 0;
+
 	typedef std::map&lt;const SAIInterfaceSpecifier, std::set&lt;std::string&gt;,
 			SAIInterfaceSpecifier_Comparator&gt; T_dupInt;
 	typedef std::map&lt;const SSAIKey, std::set&lt;std::string&gt;, SSAIKey_Comparator&gt;
 			T_dupSkirm;
-	typedef std::map&lt;const SGAIKey, std::set&lt;std::string&gt;, SGAIKey_Comparator&gt;
-			T_dupGroup;
-	
+//	typedef std::map&lt;const SGAIKey, std::set&lt;std::string&gt;, SGAIKey_Comparator&gt;
+//			T_dupGroup;
+
 	// The following three methods return sets of files which contain duplicate
 	// infos. These methods can be used for issueing warnings.
-	virtual const T_dupInt* GetDuplicateInterfaceInfos() const = 0;
-	virtual const T_dupSkirm* GetDuplicateSkirmishAIInfos() const = 0;
-	virtual const T_dupGroup* GetDuplicateGroupAIInfos() const = 0;
+	virtual const T_dupInt&amp; GetDuplicateInterfaceInfos() const = 0;
+	virtual const T_dupSkirm&amp; GetDuplicateSkirmishAIInfos() const = 0;
+//	virtual const T_dupGroup&amp; GetDuplicateGroupAIInfos() const = 0;
 
-	virtual std::vector&lt;SSAIKey&gt; ResolveSkirmishAIKey(const SSAISpecifier&amp; skirmishAISpecifier) const = 0;
-	virtual std::vector&lt;SSAIKey&gt; ResolveSkirmishAIKey(const std::string&amp; skirmishAISpecifier) const = 0;
+	SSAIKey ResolveSkirmishAIKey(const SSAISpecifier&amp; skirmishAISpecifier) const;
+protected:
+	virtual std::vector&lt;SSAIKey&gt; FittingSkirmishAIKeys(const SSAISpecifier&amp; skirmishAISpecifier) const = 0;
+//	virtual std::vector&lt;SSAIKey&gt; FittingSkirmishAIKeys(const std::string&amp; skirmishAISpecifier) const = 0;
+public:
 	// a Skirmish AI (its library) is only really loaded when it is not yet loaded.
 	virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const SSAIKey&amp; skirmishAIKey) = 0;
 	// a Skirmish AI is only unloaded when ReleaseSkirmishAILibrary() is called
@@ -83,34 +90,34 @@
 	// is handled internally/automatically.
 	virtual void ReleaseSkirmishAILibrary(const SSAIKey&amp; skirmishAIKey) = 0;
 	virtual void ReleaseAllSkirmishAILibraries() = 0; // unloads all currently Skirmish loaded AIs
-	
-	virtual std::vector&lt;SGAIKey&gt; ResolveGroupAIKey(const std::string&amp; groupAISpecifier) const = 0;
-	// a Group AI (its library) is only really loaded when it is not yet loaded.
-	virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAIKey&amp; groupAIKey) = 0;
-	// a Group AI is only unloaded when ReleaseSkirmishAILibrary() is called
-	// as many times as GetSkirmishAILibrary() was.
-	// loading and unloading of the interfaces
-	// is handled internally/automatically.
-	virtual void ReleaseGroupAILibrary(const SGAIKey&amp; groupAIKey) = 0;
-	virtual void ReleaseAllGroupAILibraries() = 0; // unloads all currently loaded Group AIs
-	
+
+//	virtual std::vector&lt;SGAIKey&gt; ResolveGroupAIKey(const std::string&amp; groupAISpecifier) const = 0;
+//	// a Group AI (its library) is only really loaded when it is not yet loaded.
+//	virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAIKey&amp; groupAIKey) = 0;
+//	// a Group AI is only unloaded when ReleaseSkirmishAILibrary() is called
+//	// as many times as GetSkirmishAILibrary() was.
+//	// loading and unloading of the interfaces
+//	// is handled internally/automatically.
+//	virtual void ReleaseGroupAILibrary(const SGAIKey&amp; groupAIKey) = 0;
+//	virtual void ReleaseAllGroupAILibraries() = 0; // unloads all currently loaded Group AIs
+
 	virtual void ReleaseEverything() = 0; // unloads all currently loaded AIs and interfaces
-	
+
 public:
 	/* guaranteed to not return NULL */
 	static IAILibraryManager* GetInstance();
 	static void OutputAIInterfacesInfo();
 	static void OutputSkirmishAIInfo();
-	static void OutputGroupAIInfo();
+//	static void OutputGroupAIInfo();
 private:
 	static IAILibraryManager* myAILibraryManager;
-	
+
 protected:
-	static bool SplittAIKey(const std::string&amp; key,
-			std::string* aiName,
-			std::string* aiVersion,
-			std::string* interfaceName,
-			std::string* interfaceVersion);
+//	static bool SplittAIKey(const std::string&amp; key,
+//			std::string* aiName,
+//			std::string* aiVersion,
+//			std::string* interfaceName,
+//			std::string* interfaceVersion);
 };
 
-#endif	/* _IAILIBRARYMANAGER_H */
+#endif // _IAILIBRARYMANAGER_H

Modified: branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -63,13 +63,17 @@
 struct SInitEvent {
 	int team;
 	struct SAICallback* callback;
-	unsigned int sizeOptions;
-	const char** optionKeys;
-	const char** optionValues;
+//	unsigned int sizeInfo;
+//	const struct InfoItem* info;
+	unsigned int infoSize;
+	const char** infoKeys;
+	const char** infoValues;
+	unsigned int optionsSize;
+	const char** optionsKeys;
+	const char** optionsValues;
 }; // EVENT_INIT
 
 struct SReleaseEvent {
-	int team;
 }; // EVENT_RELEASE
 
 struct SUpdateEvent {

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAICallback.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAICallback.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAICallback.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -91,19 +91,19 @@
 int (CALLING_CONV *Clb_0MULTI1SIZE0Resource)(int teamId);
 int (CALLING_CONV *Clb_0MULTI1FETCH3ResourceByName0Resource)(int teamId, const char* resourceName);
 const char* (CALLING_CONV *Clb_Resource_getName)(int teamId, int resourceIndex);
-bool (CALLING_CONV *Clb_Resource_isGoodToHave)(int teamId, int resourceIndex);
-float (CALLING_CONV *Clb_Resource_getCurrent)(int teamId, int resourceIndex);
-float (CALLING_CONV *Clb_Resource_getIncome)(int teamId, int resourceIndex);
-float (CALLING_CONV *Clb_Resource_getUsage)(int teamId, int resourceIndex);
-float (CALLING_CONV *Clb_Resource_getStorage)(int teamId, int resourceIndex);
+float (CALLING_CONV *Clb_Resource_getOptimum)(int teamId, int resourceIndex);
+float (CALLING_CONV *Clb_Economy_0REF1Resource2resourceIndex0getCurrent)(int teamId, int resourceIndex);
+float (CALLING_CONV *Clb_Economy_0REF1Resource2resourceIndex0getIncome)(int teamId, int resourceIndex);
+float (CALLING_CONV *Clb_Economy_0REF1Resource2resourceIndex0getUsage)(int teamId, int resourceIndex);
+float (CALLING_CONV *Clb_Economy_0REF1Resource2resourceIndex0getStorage)(int teamId, int resourceIndex);
 // END OBJECT Resource
 
 
 // BEGINN OBJECT File
 int (CALLING_CONV *Clb_File_getSize)(int teamId, const char* fileName);
-bool (CALLING_CONV *Clb_File_getContent)(int teamId, const char* filename, void* buffer, int bufferLen);
-bool (CALLING_CONV *Clb_File_locateForReading)(int teamId, char* filename);
-bool (CALLING_CONV *Clb_File_locateForWriting)(int teamId, char* filename);
+bool (CALLING_CONV *Clb_File_getContent)(int teamId, const char* fileName, void* buffer, int bufferLen);
+bool (CALLING_CONV *Clb_File_locateForReading)(int teamId, char* fileName);
+bool (CALLING_CONV *Clb_File_locateForWriting)(int teamId, char* fileName);
 // END OBJECT File
 
 
@@ -117,25 +117,21 @@
 bool (CALLING_CONV *Clb_UnitDef_isValid)(int teamId, int unitDefId);
 const char* (CALLING_CONV *Clb_UnitDef_getName)(int teamId, int unitDefId);
 const char* (CALLING_CONV *Clb_UnitDef_getHumanName)(int teamId, int unitDefId);
-const char* (CALLING_CONV *Clb_UnitDef_getFilename)(int teamId, int unitDefId);
+const char* (CALLING_CONV *Clb_UnitDef_getFileName)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_getAiHint)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_getCobId)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_getTechLevel)(int teamId, int unitDefId);
 const char* (CALLING_CONV *Clb_UnitDef_getGaia)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getMetalUpkeep)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getEnergyUpkeep)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getMetalMake)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getMakesMetal)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getEnergyMake)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getMetalCost)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getEnergyCost)(int teamId, int unitDefId);
+float (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0getUpkeep)(int teamId, int unitDefId, int resourceIndex);
+float (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0getResourceMake)(int teamId, int unitDefId, int resourceIndex);
+float (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0getMakesResource)(int teamId, int unitDefId, int resourceIndex);
+float (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0getCost)(int teamId, int unitDefId, int resourceIndex);
+float (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0getExtractsResource)(int teamId, int unitDefId, int resourceIndex);
+float (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0getResourceExtractorRange)(int teamId, int unitDefId, int resourceIndex);
+float (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0getWindResourceGenerator)(int teamId, int unitDefId, int resourceIndex);
+float (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0getTidalResourceGenerator)(int teamId, int unitDefId, int resourceIndex);
+float (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0getStorage)(int teamId, int unitDefId, int resourceIndex);
 float (CALLING_CONV *Clb_UnitDef_getBuildTime)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getExtractsMetal)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getExtractRange)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getWindGenerator)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getTidalGenerator)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getMetalStorage)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getEnergyStorage)(int teamId, int unitDefId);
 float (CALLING_CONV *Clb_UnitDef_getAutoHeal)(int teamId, int unitDefId);
 float (CALLING_CONV *Clb_UnitDef_getIdleAutoHeal)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_getIdleTime)(int teamId, int unitDefId);
@@ -181,11 +177,11 @@
 float (CALLING_CONV *Clb_UnitDef_getMaxWaterDepth)(int teamId, int unitDefId);
 float (CALLING_CONV *Clb_UnitDef_getArmoredMultiple)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_getArmorType)(int teamId, int unitDefId);
-int (CALLING_CONV *Clb_UnitDef_getFlankingBonusMode)(int teamId, int unitDefId);
-struct SAIFloat3 (CALLING_CONV *Clb_UnitDef_getFlankingBonusDir)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getFlankingBonusMax)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getFlankingBonusMin)(int teamId, int unitDefId);
-float (CALLING_CONV *Clb_UnitDef_getFlankingBonusMobilityAdd)(int teamId, int unitDefId);
+int (CALLING_CONV *Clb_UnitDef_FlankingBonus_getMode)(int teamId, int unitDefId);
+struct SAIFloat3 (CALLING_CONV *Clb_UnitDef_FlankingBonus_getDir)(int teamId, int unitDefId);
+float (CALLING_CONV *Clb_UnitDef_FlankingBonus_getMax)(int teamId, int unitDefId);
+float (CALLING_CONV *Clb_UnitDef_FlankingBonus_getMin)(int teamId, int unitDefId);
+float (CALLING_CONV *Clb_UnitDef_FlankingBonus_getMobilityAdd)(int teamId, int unitDefId);
 const char* (CALLING_CONV *Clb_UnitDef_CollisionVolume_getType)(int teamId, int unitDefId);
 struct SAIFloat3 (CALLING_CONV *Clb_UnitDef_CollisionVolume_getScales)(int teamId, int unitDefId);
 struct SAIFloat3 (CALLING_CONV *Clb_UnitDef_CollisionVolume_getOffsets)(int teamId, int unitDefId);
@@ -302,7 +298,7 @@
 int (CALLING_CONV *Clb_UnitDef_getFlareSalvoSize)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_getFlareSalvoDelay)(int teamId, int unitDefId);
 bool (CALLING_CONV *Clb_UnitDef_isSmoothAnim)(int teamId, int unitDefId);
-bool (CALLING_CONV *Clb_UnitDef_isMetalMaker)(int teamId, int unitDefId);
+bool (CALLING_CONV *Clb_UnitDef_0REF1Resource2resourceIndex0isResourceMaker)(int teamId, int unitDefId, int resourceIndex);
 bool (CALLING_CONV *Clb_UnitDef_isCanLoopbackAttack)(int teamId, int unitDefId);
 bool (CALLING_CONV *Clb_UnitDef_isLevelGround)(int teamId, int unitDefId);
 bool (CALLING_CONV *Clb_UnitDef_isUseBuildingGroundDecal)(int teamId, int unitDefId);
@@ -315,10 +311,10 @@
 float (CALLING_CONV *Clb_UnitDef_getRefuelTime)(int teamId, int unitDefId);
 float (CALLING_CONV *Clb_UnitDef_getMinAirBasePower)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_getMaxThisUnit)(int teamId, int unitDefId);
-int (CALLING_CONV *Clb_UnitDef_getDecoyDefId)(int teamId, int unitDefId);
+int (CALLING_CONV *Clb_UnitDef_0SINGLE1FETCH2UnitDef0getDecoyDef)(int teamId, int unitDefId);
 bool (CALLING_CONV *Clb_UnitDef_isDontLand)(int teamId, int unitDefId);
-int (CALLING_CONV *Clb_UnitDef_getShieldWeaponDefId)(int teamId, int unitDefId);
-int (CALLING_CONV *Clb_UnitDef_getStockpileWeaponDefId)(int teamId, int unitDefId);
+int (CALLING_CONV *Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getShieldDef)(int teamId, int unitDefId);
+int (CALLING_CONV *Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getStockpileDef)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_0ARRAY1SIZE0getBuildOptions)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_0ARRAY1VALS0getBuildOptions)(int teamId, int unitDefId, int unitDefIds[], int unitDefIds_max);
 int (CALLING_CONV *Clb_UnitDef_0MAP1SIZE0getCustomParams)(int teamId, int unitDefId);
@@ -343,7 +339,7 @@
 bool (CALLING_CONV *Clb_UnitDef_MoveData_isSubMarine)(int teamId, int unitDefId);
 int (CALLING_CONV *Clb_UnitDef_0MULTI1SIZE0WeaponMount)(int teamId, int unitDefId);
 const char* (CALLING_CONV *Clb_UnitDef_WeaponMount_getName)(int teamId, int unitDefId, int weaponMountIndex);
-int (CALLING_CONV *Clb_UnitDef_WeaponMount_getWeaponDefId)(int teamId, int unitDefId, int weaponMountIndex);
+int (CALLING_CONV *Clb_UnitDef_WeaponMount_0SINGLE1FETCH2WeaponDef0getWeaponDef)(int teamId, int unitDefId, int weaponMountIndex);
 int (CALLING_CONV *Clb_UnitDef_WeaponMount_getSlavedTo)(int teamId, int unitDefId, int weaponMountIndex);
 struct SAIFloat3 (CALLING_CONV *Clb_UnitDef_WeaponMount_getMainDir)(int teamId, int unitDefId, int weaponMountIndex);
 float (CALLING_CONV *Clb_UnitDef_WeaponMount_getMaxAngleDif)(int teamId, int unitDefId, int weaponMountIndex);
@@ -409,8 +405,8 @@
 float (CALLING_CONV *Clb_Unit_getSpeed)(int teamId, int unitId);
 float (CALLING_CONV *Clb_Unit_getPower)(int teamId, int unitId);
 int (CALLING_CONV *Clb_Unit_0MULTI1SIZE0ResourceInfo)(int teamId, int unitId);
-float (CALLING_CONV *Clb_Unit_ResourceInfo_getUse)(int teamId, int unitId, int resourceIndex);
-float (CALLING_CONV *Clb_Unit_ResourceInfo_getMake)(int teamId, int unitId, int resourceIndex);
+float (CALLING_CONV *Clb_Unit_0REF1Resource2resourceIndex0getResourceUse)(int teamId, int unitId, int resourceIndex);
+float (CALLING_CONV *Clb_Unit_0REF1Resource2resourceIndex0getResourceMake)(int teamId, int unitId, int resourceIndex);
 struct SAIFloat3 (CALLING_CONV *Clb_Unit_getPos)(int teamId, int unitId);
 bool (CALLING_CONV *Clb_Unit_isActivated)(int teamId, int unitId);
 bool (CALLING_CONV *Clb_Unit_isBeingBuilt)(int teamId, int unitId);
@@ -459,18 +455,24 @@
 bool (CALLING_CONV *Clb_Map_isPosInCamera)(int teamId, struct SAIFloat3 pos, float radius);
 int (CALLING_CONV *Clb_Map_getWidth)(int teamId);
 int (CALLING_CONV *Clb_Map_getHeight)(int teamId);
-const float* (CALLING_CONV *Clb_Map_getHeightMap)(int teamId);
+int (CALLING_CONV *Clb_Map_0ARRAY1SIZE0getHeightMap)(int teamId);
+int (CALLING_CONV *Clb_Map_0ARRAY1VALS0getHeightMap)(int teamId, float heights[], int heights_max);
 float (CALLING_CONV *Clb_Map_getMinHeight)(int teamId);
 float (CALLING_CONV *Clb_Map_getMaxHeight)(int teamId);
-const float* (CALLING_CONV *Clb_Map_getSlopeMap)(int teamId);
-const unsigned short* (CALLING_CONV *Clb_Map_getLosMap)(int teamId);
-const unsigned short* (CALLING_CONV *Clb_Map_getRadarMap)(int teamId);
-const unsigned short* (CALLING_CONV *Clb_Map_getJammerMap)(int teamId);
-const unsigned char* (CALLING_CONV *Clb_Map_getMetalMap)(int teamId);
+int (CALLING_CONV *Clb_Map_0ARRAY1SIZE0getSlopeMap)(int teamId);
+int (CALLING_CONV *Clb_Map_0ARRAY1VALS0getSlopeMap)(int teamId, float slopes[], int slopes_max);
+int (CALLING_CONV *Clb_Map_0ARRAY1SIZE0getLosMap)(int teamId);
+int (CALLING_CONV *Clb_Map_0ARRAY1VALS0getLosMap)(int teamId, unsigned short losValues[], int losValues_max);
+int (CALLING_CONV *Clb_Map_0ARRAY1SIZE0getRadarMap)(int teamId);
+int (CALLING_CONV *Clb_Map_0ARRAY1VALS0getRadarMap)(int teamId, unsigned short radarValues[], int radarValues_max);
+int (CALLING_CONV *Clb_Map_0ARRAY1SIZE0getJammerMap)(int teamId);
+int (CALLING_CONV *Clb_Map_0ARRAY1VALS0getJammerMap)(int teamId, unsigned short jammerValues[], int jammerValues_max);
+int (CALLING_CONV *Clb_Map_0ARRAY1SIZE0REF1Resource2resourceIndex0getResourceMap)(int teamId, int resourceIndex);
+int (CALLING_CONV *Clb_Map_0ARRAY1VALS0REF1Resource2resourceIndex0getResourceMap)(int teamId, int resourceIndex, unsigned char resources[], int resources_max);
 const char* (CALLING_CONV *Clb_Map_getName)(int teamId);
 float (CALLING_CONV *Clb_Map_getElevationAt)(int teamId, float x, float z);
-float (CALLING_CONV *Clb_Map_getMaxMetal)(int teamId);
-float (CALLING_CONV *Clb_Map_getExtractorRadius)(int teamId);
+float (CALLING_CONV *Clb_Map_0REF1Resource2resourceIndex0getMaxResource)(int teamId, int resourceIndex);
+float (CALLING_CONV *Clb_Map_0REF1Resource2resourceIndex0getExtractorRadius)(int teamId, int resourceIndex);
 float (CALLING_CONV *Clb_Map_getMinWind)(int teamId);
 float (CALLING_CONV *Clb_Map_getMaxWind)(int teamId);
 float (CALLING_CONV *Clb_Map_getTidalStrength)(int teamId);
@@ -496,12 +498,11 @@
 // BEGINN OBJECT FeatureDef
 int (CALLING_CONV *Clb_0MULTI1SIZE0FeatureDef)(int teamId);
 int (CALLING_CONV *Clb_0MULTI1VALS0FeatureDef)(int teamId, int featureDefIds[], int featureDefIds_max);
+int (CALLING_CONV *Clb_FeatureDef_getId)(int teamId, int featureDefId);
 const char* (CALLING_CONV *Clb_FeatureDef_getName)(int teamId, int featureDefId);
 const char* (CALLING_CONV *Clb_FeatureDef_getDescription)(int teamId, int featureDefId);
 const char* (CALLING_CONV *Clb_FeatureDef_getFileName)(int teamId, int featureDefId);
-int (CALLING_CONV *Clb_FeatureDef_getId)(int teamId, int featureDefId);
-float (CALLING_CONV *Clb_FeatureDef_getMetal)(int teamId, int featureDefId);
-float (CALLING_CONV *Clb_FeatureDef_getEnergy)(int teamId, int featureDefId);
+float (CALLING_CONV *Clb_FeatureDef_0REF1Resource2resourceIndex0getContainedResource)(int teamId, int featureDefId, int resourceIndex);
 float (CALLING_CONV *Clb_FeatureDef_getMaxHealth)(int teamId, int featureDefId);
 float (CALLING_CONV *Clb_FeatureDef_getReclaimTime)(int teamId, int featureDefId);
 float (CALLING_CONV *Clb_FeatureDef_getMass)(int teamId, int featureDefId);
@@ -546,12 +547,14 @@
 
 
 // BEGINN OBJECT WeaponDef
+int (CALLING_CONV *Clb_0MULTI1SIZE0WeaponDef)(int teamId);
+//int (CALLING_CONV *Clb_0MULTI1VALS0WeaponDef)(int teamId, int weaponDefIds[], int weaponDefIds_max);
 int (CALLING_CONV *Clb_0MULTI1FETCH3WeaponDefByName0WeaponDef)(int teamId, const char* weaponDefName);
 //const SAIWeaponDef* (CALLING_CONV *Clb_getWeaponDef)(int teamId, int weaponDefId);
 const char* (CALLING_CONV *Clb_WeaponDef_getName)(int teamId, int weaponDefId);
 const char* (CALLING_CONV *Clb_WeaponDef_getType)(int teamId, int weaponDefId);
 const char* (CALLING_CONV *Clb_WeaponDef_getDescription)(int teamId, int weaponDefId);
-const char* (CALLING_CONV *Clb_WeaponDef_getFilename)(int teamId, int weaponDefId);
+const char* (CALLING_CONV *Clb_WeaponDef_getFileName)(int teamId, int weaponDefId);
 const char* (CALLING_CONV *Clb_WeaponDef_getCegTag)(int teamId, int weaponDefId);
 float (CALLING_CONV *Clb_WeaponDef_getRange)(int teamId, int weaponDefId);
 float (CALLING_CONV *Clb_WeaponDef_getHeightMod)(int teamId, int weaponDefId);
@@ -575,6 +578,7 @@
 int (CALLING_CONV *Clb_WeaponDef_Damage_0ARRAY1SIZE0getTypes)(int teamId, int weaponDefId);
 int (CALLING_CONV *Clb_WeaponDef_Damage_0ARRAY1VALS0getTypes)(int teamId, int weaponDefId, float types[], int types_max);
 
+int (CALLING_CONV *Clb_WeaponDef_getId)(int teamId, int weaponDefId);
 float (CALLING_CONV *Clb_WeaponDef_getAreaOfEffect)(int teamId, int weaponDefId);
 bool (CALLING_CONV *Clb_WeaponDef_isNoSelfDamage)(int teamId, int weaponDefId);
 float (CALLING_CONV *Clb_WeaponDef_getFireStarter)(int teamId, int weaponDefId);
@@ -596,11 +600,9 @@
 float (CALLING_CONV *Clb_WeaponDef_getRestTime)(int teamId, int weaponDefId);
 float (CALLING_CONV *Clb_WeaponDef_getUpTime)(int teamId, int weaponDefId);
 int (CALLING_CONV *Clb_WeaponDef_getFlightTime)(int teamId, int weaponDefId);
-float (CALLING_CONV *Clb_WeaponDef_getMetalCost)(int teamId, int weaponDefId);
-float (CALLING_CONV *Clb_WeaponDef_getEnergyCost)(int teamId, int weaponDefId);
+float (CALLING_CONV *Clb_WeaponDef_0REF1Resource2resourceIndex0getCost)(int teamId, int weaponDefId, int resourceIndex);
 float (CALLING_CONV *Clb_WeaponDef_getSupplyCost)(int teamId, int weaponDefId);
 int (CALLING_CONV *Clb_WeaponDef_getProjectilesPerShot)(int teamId, int weaponDefId);
-int (CALLING_CONV *Clb_WeaponDef_getId)(int teamId, int weaponDefId);
 int (CALLING_CONV *Clb_WeaponDef_getTdfId)(int teamId, int weaponDefId);
 bool (CALLING_CONV *Clb_WeaponDef_isTurret)(int teamId, int weaponDefId);
 bool (CALLING_CONV *Clb_WeaponDef_isOnlyForward)(int teamId, int weaponDefId);
@@ -651,13 +653,13 @@
 bool (CALLING_CONV *Clb_WeaponDef_isVisibleShield)(int teamId, int weaponDefId);
 bool (CALLING_CONV *Clb_WeaponDef_isVisibleShieldRepulse)(int teamId, int weaponDefId);
 int (CALLING_CONV *Clb_WeaponDef_getVisibleShieldHitFrames)(int teamId, int weaponDefId);
-float (CALLING_CONV *Clb_WeaponDef_Shield_getEnergyUse)(int teamId, int weaponDefId);
+float (CALLING_CONV *Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getResourceUse)(int teamId, int weaponDefId, int resourceIndex);
 float (CALLING_CONV *Clb_WeaponDef_Shield_getRadius)(int teamId, int weaponDefId);
 float (CALLING_CONV *Clb_WeaponDef_Shield_getForce)(int teamId, int weaponDefId);
 float (CALLING_CONV *Clb_WeaponDef_Shield_getMaxSpeed)(int teamId, int weaponDefId);
 float (CALLING_CONV *Clb_WeaponDef_Shield_getPower)(int teamId, int weaponDefId);
 float (CALLING_CONV *Clb_WeaponDef_Shield_getPowerRegen)(int teamId, int weaponDefId);
-float (CALLING_CONV *Clb_WeaponDef_Shield_getPowerRegenEnergy)(int teamId, int weaponDefId);
+float (CALLING_CONV *Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getPowerRegenResource)(int teamId, int weaponDefId, int resourceIndex);
 float (CALLING_CONV *Clb_WeaponDef_Shield_getStartingPower)(int teamId, int weaponDefId);
 int (CALLING_CONV *Clb_WeaponDef_Shield_getRechargeDelay)(int teamId, int weaponDefId);
 struct SAIFloat3 (CALLING_CONV *Clb_WeaponDef_Shield_getGoodColor)(int teamId, int weaponDefId);

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -22,17 +22,17 @@
 #include &lt;stdlib.h&gt;
 
 struct SAIInterfaceSpecifier copySAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const orig) {
-	
+
 	struct SAIInterfaceSpecifier copy;
-	
+
 	char* tmpStr = (char *) malloc(sizeof(char) * strlen(orig-&gt;shortName) + 1);
 	strcpy(tmpStr, orig-&gt;shortName);
 	copy.shortName = tmpStr;
-	
+
 	tmpStr = (char *) malloc(sizeof(char) * strlen(orig-&gt;version) + 1);
 	strcpy(tmpStr, orig-&gt;version);
 	copy.version = tmpStr;
-	
+
 	return copy;
 }
 void deleteSAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const spec) {
@@ -44,18 +44,18 @@
 #ifdef	__cplusplus
 
 CR_BIND(SSAIKey,)
-CR_BIND(SGAIKey,)
+//CR_BIND(SGAIKey,)
 
 bool SAIInterfaceSpecifier_Comparator::operator()(const struct SAIInterfaceSpecifier&amp; a, const struct SAIInterfaceSpecifier&amp; b) const {
 
 	bool isLess = false;
-	
+
 	int shortNameComp = strcmp(a.shortName, b.shortName);
 	if (shortNameComp &lt; 0) {
 		return isLess = true;
 	} else if (shortNameComp == 0) {
 		int versionComp = strcmp(a.version, b.version);
-		
+
 		if (versionComp &lt; 0) {
 			isLess = true;
 		}
@@ -64,26 +64,26 @@
 	return isLess;
 }
 bool SAIInterfaceSpecifier_Comparator::IsEmpty(const struct SAIInterfaceSpecifier&amp; spec) {
-	
+
 	bool empty = false;
-	
+
 	if (spec.shortName == NULL || spec.version == NULL) {
 		empty = true;
 	}
-	
+
 	return empty;
 }
 
 bool SSAIKey_Comparator::operator()(const struct SSAIKey&amp; a, const struct SSAIKey&amp; b) const {
-	
+
 	bool isLess = false;
-	
+
 	bool interfaceLess = SAIInterfaceSpecifier_Comparator()(a.interface, b.interface);
 	if (interfaceLess) {
 		isLess = true;
 	} else if (!(SAIInterfaceSpecifier_Comparator()(b.interface, a.interface))) { // -&gt; interfaces are equal
 		bool aiLess = SSAISpecifier_Comparator()(a.ai, b.ai);
-		
+
 		if (aiLess) {
 			isLess = true;
 		}
@@ -92,45 +92,45 @@
 	return isLess;
 }
 bool SSAIKey_Comparator::IsEmpty(const struct SSAIKey&amp; key) {
-	
+
 	bool empty = false;
-	
+
 	if (SAIInterfaceSpecifier_Comparator::IsEmpty(key.interface)
 			|| SSAISpecifier_Comparator::IsEmpty(key.ai)) {
 		empty = true;
 	}
-	
+
 	return empty;
 }
 
-bool SGAIKey_Comparator::operator()(const struct SGAIKey&amp; a, const struct SGAIKey&amp; b) const {
+//bool SGAIKey_Comparator::operator()(const struct SGAIKey&amp; a, const struct SGAIKey&amp; b) const {
+//
+//	bool isLess = false;
+//
+//	bool interfaceLess = SAIInterfaceSpecifier_Comparator()(a.interface, b.interface);
+//	if (interfaceLess) {
+//		isLess = true;
+//	} else if (!(SAIInterfaceSpecifier_Comparator()(b.interface, a.interface))) { // -&gt; interfaces are equal
+//		bool aiLess = SGAISpecifier_Comparator()(a.ai, b.ai);
+//
+//		if (aiLess) {
+//			isLess = true;
+//		}
+//	}
+//
+//	return isLess;
+//}
+//bool SGAIKey_Comparator::IsEmpty(const struct SGAIKey&amp; key) {
+//
+//	bool empty = false;
+//
+//	if (SAIInterfaceSpecifier_Comparator::IsEmpty(key.interface)
+//			|| SGAISpecifier_Comparator::IsEmpty(key.ai)) {
+//		empty = true;
+//	}
+//
+//	return empty;
+//}
 
-	bool isLess = false;
-	
-	bool interfaceLess = SAIInterfaceSpecifier_Comparator()(a.interface, b.interface);
-	if (interfaceLess) {
-		isLess = true;
-	} else if (!(SAIInterfaceSpecifier_Comparator()(b.interface, a.interface))) { // -&gt; interfaces are equal
-		bool aiLess = SGAISpecifier_Comparator()(a.ai, b.ai);
-		
-		if (aiLess) {
-			isLess = true;
-		}
-	}
-
-	return isLess;
-}
-bool SGAIKey_Comparator::IsEmpty(const struct SGAIKey&amp; key) {
-	
-	bool empty = false;
-	
-	if (SAIInterfaceSpecifier_Comparator::IsEmpty(key.interface)
-			|| SGAISpecifier_Comparator::IsEmpty(key.ai)) {
-		empty = true;
-	}
-	
-	return empty;
-}
-
 #endif	// __cplusplus
 #endif	// !defined BUILDING_AI

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -50,8 +50,10 @@
 	const char* version; // [may not contain: spaces, '_', '#']
 };
 
-struct SAIInterfaceSpecifier copySAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const orig);
-void deleteSAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const spec);
+struct SAIInterfaceSpecifier copySAIInterfaceSpecifier(
+		const struct SAIInterfaceSpecifier* const orig);
+void deleteSAIInterfaceSpecifier(
+		const struct SAIInterfaceSpecifier* const spec);
 
 
 /**
@@ -68,11 +70,11 @@
  * @brief struct Group Artificial Intelligence Key
  * Compleetly specifies a group AI together with an interface.
  */
-struct SGAIKey {
-	CR_DECLARE_STRUCT(SGAIKey);
-	struct SAIInterfaceSpecifier interface;
-	struct SGAISpecifier ai;
-};
+//struct SGAIKey {
+//	CR_DECLARE_STRUCT(SGAIKey);
+//	struct SAIInterfaceSpecifier interface;
+//	struct SGAISpecifier ai;
+//};
 
 /**
  * @brief struct Artificial Intelligence Interface
@@ -97,7 +99,10 @@
 	 *								and the environment
 	 * @return	ok: 0, error: != 0
 	 */
-	int (CALLING_CONV *initStatic)(const struct SStaticGlobalData* staticGlobalData);
+	int (CALLING_CONV *initStatic)(
+			unsigned int infoSize,
+			const char** infoKeys, const char** infoValues,
+			const struct SStaticGlobalData* staticGlobalData);
 
 	/**
 	 * This function is called right right before the library is unloaded.
@@ -129,8 +134,8 @@
 	 *
 	 * @return number of elements stored into parameter info
 	 */
-	unsigned int (CALLING_CONV *getInfo)(struct InfoItem info[],
-			unsigned int maxInfoItems);
+//	unsigned int (CALLING_CONV *getInfo)(struct InfoItem info[],
+//			unsigned int maxInfoItems);
 
 
 	// skirmish AI methods
@@ -143,7 +148,8 @@
 	//int (CALLING_CONV *getSkirmishAISpecifiers)(struct SSAISpecifier* sAISpecifiers, int max);
 	//const struct SSAILibrary* (CALLING_CONV *loadSkirmishAILibrary)(const struct SSAISpecifier* const sAISpecifier);
 	const struct SSAILibrary* (CALLING_CONV *loadSkirmishAILibrary)(
-			const struct InfoItem info[], unsigned int numInfoItems);
+			unsigned int infoSize,
+			const char** infoKeys, const char** infoValues);
 
 	/**
 	 * Unloads the specified Skirmish AI.
@@ -151,7 +157,8 @@
 	 * @return	ok: 0, error: != 0
 	 */
 	int (CALLING_CONV *unloadSkirmishAILibrary)(
-			const struct SSAISpecifier* const sAISpecifier);
+			unsigned int infoSize,
+			const char** infoKeys, const char** infoValues);
 
 	/**
 	 * Unloads all Skirmish AI libraries currently loaded by this interface.
@@ -170,23 +177,23 @@
 	 */
 	//int (CALLING_CONV *getGroupAISpecifiers)(struct SGAISpecifier* gAISpecifiers, int max);
 	//const struct SGAILibrary* (CALLING_CONV *loadGroupAILibrary)(const struct SGAISpecifier* const gAISpecifier);
-	const struct SGAILibrary* (CALLING_CONV *loadGroupAILibrary)(
-			const struct InfoItem info[], unsigned int numInfoItems);
+//	const struct SGAILibrary* (CALLING_CONV *loadGroupAILibrary)(
+//			const struct InfoItem info[], unsigned int numInfoItems);
 
 	/**
 	 * Unloads the specified Group AI.
 	 *
 	 * @return	ok: 0, error: != 0
 	 */
-	int (CALLING_CONV *unloadGroupAILibrary)(
-			const struct SGAISpecifier* const gAISpecifier);
+//	int (CALLING_CONV *unloadGroupAILibrary)(
+//			const struct SGAISpecifier* const gAISpecifier);
 
 	/**
 	 * Unloads all Group AI libraries currently loaded by this interface.
 	 *
 	 * @return	ok: 0, error: != 0
 	 */
-	int (CALLING_CONV *unloadAllGroupAILibraries)();
+//	int (CALLING_CONV *unloadAllGroupAILibraries)();
 };
 
 #ifdef	__cplusplus
@@ -202,7 +209,8 @@
 	 * than its second argument, and false otherwise.
 	 * This is also defined as map::key_compare.
 	 */
-	bool operator()(const struct SAIInterfaceSpecifier&amp; a, const struct SAIInterfaceSpecifier&amp; b) const;
+	bool operator()(const struct SAIInterfaceSpecifier&amp; a,
+			const struct SAIInterfaceSpecifier&amp; b) const;
 	static bool IsEmpty(const struct SAIInterfaceSpecifier&amp; spec);
 };
 
@@ -217,17 +225,17 @@
 	static bool IsEmpty(const struct SSAIKey&amp; key);
 };
 
-struct SGAIKey_Comparator {
-	/**
-	 * The key comparison function, a Strict Weak Ordering;
-	 * it returns true if its first argument is less
-	 * than its second argument, and false otherwise.
-	 * This is also defined as map::key_compare.
-	 */
-	bool operator()(const struct SGAIKey&amp; a, const struct SGAIKey&amp; b) const;
-	static bool IsEmpty(const struct SGAIKey&amp; key);
-};
-#endif	// __cplusplus
+//struct SGAIKey_Comparator {
+//	/**
+//	 * The key comparison function, a Strict Weak Ordering;
+//	 * it returns true if its first argument is less
+//	 * than its second argument, and false otherwise.
+//	 * This is also defined as map::key_compare.
+//	 */
+//	bool operator()(const struct SGAIKey&amp; a, const struct SGAIKey&amp; b) const;
+//	static bool IsEmpty(const struct SGAIKey&amp; key);
+//};
+#endif // __cplusplus
 
-#endif	// !defined BUILDING_AI
-#endif	// _SAIINTERFACELIBRARY_H
+#endif // !defined BUILDING_AI
+#endif // _SAIINTERFACELIBRARY_H

Modified: branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -22,8 +22,8 @@
 extern &quot;C&quot; {
 #endif
 
-#include &quot;SInfo.h&quot;
-#include &quot;SOption.h&quot;
+//#include &quot;SInfo.h&quot;
+//#include &quot;SOption.h&quot;
 #include &quot;ELevelOfSupport.h&quot;
 #include &quot;exportdefines.h&quot;
 
@@ -99,8 +99,8 @@
 	 * @param	max	the maximum number of elements to store into param info
 	 * @return	number of elements stored into parameter info
 	 */
-	unsigned int (CALLING_CONV *getInfo)(int teamId, struct InfoItem info[],
-			unsigned int maxInfoItems);
+//	unsigned int (CALLING_CONV *getInfo)(int teamId, struct InfoItem info[],
+//			unsigned int maxInfoItems);
 
 	/**
 	 * Returns options that can be set on this AI.
@@ -112,8 +112,8 @@
 	 * @param	max	the maximum number of elements to store into param options
 	 * @return	number of elements stored into parameter options
 	 */
-	unsigned int (CALLING_CONV *getOptions)(int teamId, struct Option options[],
-			unsigned int maxOptions);
+//	unsigned int (CALLING_CONV *getOptions)(int teamId, struct Option options[],
+//			unsigned int maxOptions);
 
 
 	// team instance functions
@@ -142,13 +142,19 @@
 	 * NOTE: this method is optional. An AI not exporting this function is still
 	 * valid.
 	 *
-	 * @param	teamId	the teamId this library shall create an instance for
-	 * @param	info	info about this AI (a technical nessecity for non C/C++ AIs)
-	 * @param	numInfoItems	now many items are stored in info
+	 * @param	teamId        the teamId this library shall create an instance for
+	 * @param	info          info about this AI (nessesary for non C/C++ AIs)
+	 * @param	numInfoItems  now many items are stored in info
+	 * @param	optionKeys    user specified option values (keys)
+	 * @param	optionValues  user specified option values (values)
+	 * @param	numOptions    user specified option values (size)
 	 * @return	ok: 0, error: != 0
 	 */
-	int (CALLING_CONV *init)(int teamId, const struct InfoItem info[],
-			unsigned int numInfoItems);
+	int (CALLING_CONV *init)(int teamId,
+			unsigned int infoSize,
+			const char** infoKeys, const char** infoValues,
+			unsigned int optionsSize,
+			const char** optionsKeys, const char** optionsValues);
 
 	/**
 	 * This function is called, when an AI instance shall be deleted.

Modified: branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -22,7 +22,7 @@
 extern &quot;C&quot; {
 #endif	// __cplusplus
 
-struct InfoItem;
+//struct InfoItem;
 
 // paths/dirs stored in this struct are guaranteed
 // to come with no '/' or '\\' at the end.
@@ -40,15 +40,18 @@
 	// This is used by AI Interface libs to prepare the environment.
 	// The Java AI Interface needs this info to prepare the classpath eg.
 	unsigned int numSkirmishAIs;
-	unsigned int* numsSkirmishAIInfo;
-	const struct InfoItem** skirmishAIInfos;
+//	unsigned int* numsSkirmishAIInfo;
+//	const struct InfoItem** skirmishAIInfos;
+	unsigned int* skirmishAIInfosSizes;
+	const char*** skirmishAIInfosKeys;
+	const char*** skirmishAIInfosValues;
 	// The following three members define the Group AI libraries
 	// that are available.
 	// This is used by AI Interface libs to prepare the environment.
 	// The Java AI Interface needs this info to prepare the classpath eg.
-	unsigned int numGroupAIs;
-	unsigned int* numsGroupAIInfo;
-	const struct InfoItem** groupAIInfos;
+//	unsigned int numGroupAIs;
+//	unsigned int* numsGroupAIInfo;
+//	const struct InfoItem** groupAIInfos;
 };
 
 // define the OS specific path separator

Modified: branches/caiinterface/rts/ExternalAI/SAICallback.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SAICallback.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/SAICallback.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -29,6 +29,10 @@
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
 #include &quot;Sim/Misc/Resource.h&quot;
 #include &quot;Sim/Misc/ResourceHandler.h&quot;
+#include &quot;Sim/Misc/LosHandler.h&quot;
+#include &quot;Sim/Misc/RadarHandler.h&quot;
+#include &quot;Map/ReadMap.h&quot;
+#include &quot;Map/MetalMap.h&quot;
 #include &quot;Game/SelectedUnits.h&quot;
 #include &quot;Game/UI/GuiHandler.h&quot;		//TODO: fix some switch for new gui
 #include &quot;ExternalAI/Group.h&quot;
@@ -514,10 +518,6 @@
 	IAICallback* clb = team_callback[teamId]; return wrapper_HandleCommand(clb, NULL, AIHCQuerySubVersionId, NULL);
 }
 
-EXPORT(bool) _Clb_Map_isPosInCamera(int teamId, SAIFloat3 pos, float radius) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;PosInCamera(SAIFloat3(pos), radius);
-}
-
 EXPORT(int) _Clb_Game_getCurrentFrame(int teamId) {
 	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetCurrentFrame();
 }
@@ -551,15 +551,6 @@
 	}
 	return numDamageTypes;
 }
-EXPORT(unsigned int) _Clb_Map_getChecksum(int teamId) {
-	unsigned int checksum;
-	IAICallback* clb = team_callback[teamId];
-	bool fetchOk = clb-&gt;GetValue(AIVAL_MAP_CHECKSUM, &amp;checksum);
-	if (!fetchOk) {
-		checksum = -1;
-	}
-	return checksum;
-}
 
 EXPORT(bool) _Clb_Game_isExceptionHandlingEnabled(int teamId) {
 	bool exceptionHandlingEnabled;
@@ -653,13 +644,13 @@
 	return cameraPosition.toSAIFloat3();
 }
 
-EXPORT(bool) _Clb_File_locateForReading(int teamId, char* filename) {
+EXPORT(bool) _Clb_File_locateForReading(int teamId, char* fileName) {
 	IAICallback* clb = team_callback[teamId];
-	return clb-&gt;GetValue(AIVAL_LOCATE_FILE_R, filename);
+	return clb-&gt;GetValue(AIVAL_LOCATE_FILE_R, fileName);
 }
-EXPORT(bool) _Clb_File_locateForWriting(int teamId, char* filename) {
+EXPORT(bool) _Clb_File_locateForWriting(int teamId, char* fileName) {
 	IAICallback* clb = team_callback[teamId];
-	return clb-&gt;GetValue(AIVAL_LOCATE_FILE_W, filename);
+	return clb-&gt;GetValue(AIVAL_LOCATE_FILE_W, fileName);
 }
 
 
@@ -669,6 +660,18 @@
 }
 
 //########### BEGINN Map
+EXPORT(bool) _Clb_Map_isPosInCamera(int teamId, SAIFloat3 pos, float radius) {
+	IAICallback* clb = team_callback[teamId]; return clb-&gt;PosInCamera(SAIFloat3(pos), radius);
+}
+EXPORT(unsigned int) _Clb_Map_getChecksum(int teamId) {
+	unsigned int checksum;
+	IAICallback* clb = team_callback[teamId];
+	bool fetchOk = clb-&gt;GetValue(AIVAL_MAP_CHECKSUM, &amp;checksum);
+	if (!fetchOk) {
+		checksum = -1;
+	}
+	return checksum;
+}
 EXPORT(int) _Clb_Map_getWidth(int teamId) {
 	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetMapWidth();
 }
@@ -677,10 +680,22 @@
 	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetMapHeight();
 }
 
-EXPORT(const float*) _Clb_Map_getHeightMap(int teamId) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetHeightMap();
+EXPORT(int) _Clb_Map_0ARRAY1SIZE0getHeightMap(int teamId) {
+	return gs-&gt;mapx * gs-&gt;mapy;
 }
+EXPORT(int) _Clb_Map_0ARRAY1VALS0getHeightMap(int teamId, float heights[], int heights_max) {
 
+	IAICallback* clb = team_callback[teamId];
+	const float* tmpMap = clb-&gt;GetHeightMap();
+	int size = _Clb_Map_0ARRAY1SIZE0getHeightMap(teamId);
+	size = min(size, heights_max);
+	int i;
+	for (i=0; i &lt; size; ++i) {
+		heights[i] = tmpMap[i];
+	}
+	return size;
+}
+
 EXPORT(float) _Clb_Map_getMinHeight(int teamId) {
 	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetMinHeight();
 }
@@ -689,26 +704,109 @@
 	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetMaxHeight();
 }
 
-EXPORT(const float*) _Clb_Map_getSlopeMap(int teamId) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetSlopeMap();
+EXPORT(int) _Clb_Map_0ARRAY1SIZE0getSlopeMap(int teamId) {
+	return gs-&gt;hmapx * gs-&gt;hmapy;
 }
+EXPORT(int) _Clb_Map_0ARRAY1VALS0getSlopeMap(int teamId, float slopes[], int slopes_max) {
 
-EXPORT(const unsigned short*) _Clb_Map_getLosMap(int teamId) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetLosMap();
+	IAICallback* clb = team_callback[teamId];
+	const float* tmpMap = clb-&gt;GetSlopeMap();
+	int size = _Clb_Map_0ARRAY1SIZE0getSlopeMap(teamId);
+	size = min(size, slopes_max);
+	int i;
+	for (i=0; i &lt; size; ++i) {
+		slopes[i] = tmpMap[i];
+	}
+	return size;
 }
 
-EXPORT(const unsigned short*) _Clb_Map_getRadarMap(int teamId) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetRadarMap();
+EXPORT(int) _Clb_Map_0ARRAY1SIZE0getLosMap(int teamId) {
+	return loshandler-&gt;losSizeX * loshandler-&gt;losSizeY;
 }
+EXPORT(int) _Clb_Map_0ARRAY1VALS0getLosMap(int teamId, unsigned short losValues[], int losValues_max) {
 
-EXPORT(const unsigned short*) _Clb_Map_getJammerMap(int teamId) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetJammerMap();
+	IAICallback* clb = team_callback[teamId];
+	const unsigned short* tmpMap = clb-&gt;GetLosMap();
+	int size = _Clb_Map_0ARRAY1SIZE0getLosMap(teamId);
+	size = min(size, losValues_max);
+	int i;
+	for (i=0; i &lt; size; ++i) {
+		losValues[i] = tmpMap[i];
+	}
+	return size;
 }
 
-EXPORT(const unsigned char*) _Clb_Map_getMetalMap(int teamId) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetMetalMap();
+EXPORT(int) _Clb_Map_0ARRAY1SIZE0getRadarMap(int teamId) {
+	return radarhandler-&gt;xsize * radarhandler-&gt;zsize;
 }
+EXPORT(int) _Clb_Map_0ARRAY1VALS0getRadarMap(int teamId, unsigned short radarValues[], int radarValues_max) {
 
+	IAICallback* clb = team_callback[teamId];
+	const unsigned short* tmpMap = clb-&gt;GetRadarMap();
+	int size = _Clb_Map_0ARRAY1SIZE0getRadarMap(teamId);
+	size = min(size, radarValues_max);
+	int i;
+	for (i=0; i &lt; size; ++i) {
+		radarValues[i] = tmpMap[i];
+	}
+	return size;
+}
+
+EXPORT(int) _Clb_Map_0ARRAY1SIZE0getJammerMap(int teamId) {
+	return radarhandler-&gt;xsize * radarhandler-&gt;zsize; // Yes, it is correct, jamme-map has the same size as the radar map
+}
+EXPORT(int) _Clb_Map_0ARRAY1VALS0getJammerMap(int teamId, unsigned short jammerValues[], int jammerValues_max) {
+
+	IAICallback* clb = team_callback[teamId];
+	const unsigned short* tmpMap = clb-&gt;GetJammerMap();
+	int size = _Clb_Map_0ARRAY1SIZE0getJammerMap(teamId);
+	size = min(size, jammerValues_max);
+	int i;
+	for (i=0; i &lt; size; ++i) {
+		jammerValues[i] = tmpMap[i];
+	}
+	return size;
+}
+
+EXPORT(const unsigned char*) _Clb_Map_0REF1Resource2resourceIndex0getResourceMap(int teamId, int resourceIndex) {
+
+	IAICallback* clb = team_callback[teamId];
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return clb-&gt;GetMetalMap();
+	} else {
+		return NULL;
+	}
+}
+EXPORT(int) _Clb_Map_0ARRAY1SIZE0REF1Resource2resourceIndex0getResourceMap(int teamId, int resourceIndex) {
+
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return readmap-&gt;metalMap-&gt;GetSizeX() * readmap-&gt;metalMap-&gt;GetSizeZ();
+	} else {
+		return 0;
+	}
+}
+EXPORT(int) _Clb_Map_0ARRAY1VALS0REF1Resource2resourceIndex0getResourceMap(int teamId, int resourceIndex, unsigned char resources[], int resources_max) {
+
+	IAICallback* clb = team_callback[teamId];
+	int size = _Clb_Map_0ARRAY1SIZE0REF1Resource2resourceIndex0getResourceMap(teamId, resourceIndex);
+	size = min(size, resources_max);
+
+	const unsigned char* tmpMap;
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		tmpMap = clb-&gt;GetMetalMap();
+	} else {
+		tmpMap = NULL;
+		size = 0;
+	}
+
+	int i;
+	for (i=0; i &lt; size; ++i) {
+		resources[i] = tmpMap[i];
+	}
+
+	return size;
+}
+
 EXPORT(const char*) _Clb_Map_getName(int teamId) {
 	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetMapName();
 }
@@ -717,12 +815,24 @@
 	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetElevation(x, z);
 }
 
-EXPORT(float) _Clb_Map_getMaxMetal(int teamId) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetMaxMetal();
+EXPORT(float) _Clb_Map_0REF1Resource2resourceIndex0getMaxResource(int teamId, int resourceIndex) {
+
+	IAICallback* clb = team_callback[teamId];
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return clb-&gt;GetMaxMetal();
+	} else {
+		return NULL;
+	}
 }
 
-EXPORT(float) _Clb_Map_getExtractorRadius(int teamId) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetExtractorRadius();
+EXPORT(float) _Clb_Map_0REF1Resource2resourceIndex0getExtractorRadius(int teamId, int resourceIndex) {
+
+	IAICallback* clb = team_callback[teamId];
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return clb-&gt;GetExtractorRadius();
+	} else {
+		return NULL;
+	}
 }
 
 EXPORT(float) _Clb_Map_getMinWind(int teamId) {
@@ -784,6 +894,13 @@
 	SAIFloat3 f3color = {color[0], color[1], color[2]};
 	return f3color;
 }
+EXPORT(SAIFloat3) _Clb_Map_getStartPos(int teamId) {
+	IAICallback* clb = team_callback[teamId];
+	return clb-&gt;GetStartPos()-&gt;toSAIFloat3();
+}
+EXPORT(SAIFloat3) _Clb_Map_getMousePos(int teamId) {
+	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetMousePos().toSAIFloat3();
+}
 //########### END Map
 
 
@@ -807,26 +924,18 @@
 }
 */
 
-EXPORT(int) _Clb_File_getSize(int teamId, const char* filename) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetFileSize(filename);
+EXPORT(int) _Clb_File_getSize(int teamId, const char* fileName) {
+	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetFileSize(fileName);
 }
 
-EXPORT(bool) _Clb_File_getContent(int teamId, const char* filename, void* buffer, int bufferLen) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;ReadFile(filename, buffer, bufferLen);
+EXPORT(bool) _Clb_File_getContent(int teamId, const char* fileName, void* buffer, int bufferLen) {
+	IAICallback* clb = team_callback[teamId]; return clb-&gt;ReadFile(fileName, buffer, bufferLen);
 }
 
 
 
 
-EXPORT(SAIFloat3) _Clb_Map_getStartPos(int teamId) {
-	IAICallback* clb = team_callback[teamId];
-	return clb-&gt;GetStartPos()-&gt;toSAIFloat3();
-}
 
-EXPORT(SAIFloat3) _Clb_Map_getMousePos(int teamId) {
-	IAICallback* clb = team_callback[teamId]; return clb-&gt;GetMousePos().toSAIFloat3();
-}
-
 // BEGINN OBJECT Resource
 EXPORT(int) _Clb_0MULTI1SIZE0Resource(int teamId) {
 	return rh-&gt;GetNumResources();
@@ -837,10 +946,10 @@
 EXPORT(const char*) _Clb_Resource_getName(int teamId, int resourceIndex) {
 	return rh-&gt;GetResource(resourceIndex)-&gt;name.c_str();
 }
-EXPORT(bool) _Clb_Resource_isGoodToHave(int teamId, int resourceIndex) {
-	return rh-&gt;GetResource(resourceIndex)-&gt;goodToHave;
+EXPORT(float) _Clb_Resource_getOptimum(int teamId, int resourceIndex) {
+	return rh-&gt;GetResource(resourceIndex)-&gt;optimum;
 }
-EXPORT(float) _Clb_Resource_getCurrent(int teamId, int resourceIndex) {
+EXPORT(float) _Clb_Economy_0REF1Resource2resourceIndex0getCurrent(int teamId, int resourceIndex) {
 
 	IAICallback* clb = team_callback[teamId];
 	if (resourceIndex == rh-&gt;GetMetalIndex()) {
@@ -852,7 +961,7 @@
 	}
 }
 
-EXPORT(float) _Clb_Resource_getIncome(int teamId, int resourceIndex) {
+EXPORT(float) _Clb_Economy_0REF1Resource2resourceIndex0getIncome(int teamId, int resourceIndex) {
 
 	IAICallback* clb = team_callback[teamId];
 	if (resourceIndex == rh-&gt;GetMetalIndex()) {
@@ -864,7 +973,7 @@
 	}
 }
 
-EXPORT(float) _Clb_Resource_getUsage(int teamId, int resourceIndex) {
+EXPORT(float) _Clb_Economy_0REF1Resource2resourceIndex0getUsage(int teamId, int resourceIndex) {
 
 	IAICallback* clb = team_callback[teamId];
 	if (resourceIndex == rh-&gt;GetMetalIndex()) {
@@ -876,7 +985,7 @@
 	}
 }
 
-EXPORT(float) _Clb_Resource_getStorage(int teamId, int resourceIndex) {
+EXPORT(float) _Clb_Economy_0REF1Resource2resourceIndex0getStorage(int teamId, int resourceIndex) {
 
 	IAICallback* clb = team_callback[teamId];
 	if (resourceIndex == rh-&gt;GetMetalIndex()) {
@@ -948,26 +1057,102 @@
 EXPORT(bool) _Clb_UnitDef_isValid(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;valid;}
 EXPORT(const char*) _Clb_UnitDef_getName(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;name.c_str();}
 EXPORT(const char*) _Clb_UnitDef_getHumanName(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;humanName.c_str();}
-EXPORT(const char*) _Clb_UnitDef_getFilename(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;filename.c_str();}
+EXPORT(const char*) _Clb_UnitDef_getFileName(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;filename.c_str();}
 EXPORT(int) _Clb_UnitDef_getId(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;id;}
 EXPORT(int) _Clb_UnitDef_getAiHint(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;aihint;}
 EXPORT(int) _Clb_UnitDef_getCobId(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;cobID;}
 EXPORT(int) _Clb_UnitDef_getTechLevel(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;techLevel;}
 EXPORT(const char*) _Clb_UnitDef_getGaia(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;gaia.c_str();}
-EXPORT(float) _Clb_UnitDef_getMetalUpkeep(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;metalUpkeep;}
-EXPORT(float) _Clb_UnitDef_getEnergyUpkeep(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;energyUpkeep;}
-EXPORT(float) _Clb_UnitDef_getMetalMake(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;metalMake;}
-EXPORT(float) _Clb_UnitDef_getMakesMetal(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;makesMetal;}
-EXPORT(float) _Clb_UnitDef_getEnergyMake(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;energyMake;}
-EXPORT(float) _Clb_UnitDef_getMetalCost(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;metalCost;}
-EXPORT(float) _Clb_UnitDef_getEnergyCost(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;energyCost;}
+EXPORT(float) _Clb_UnitDef_0REF1Resource2resourceIndex0getUpkeep(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return ud-&gt;metalUpkeep;
+	} else if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return ud-&gt;energyUpkeep;
+	} else {
+		return 0.0f;
+	}
+}
+EXPORT(float) _Clb_UnitDef_0REF1Resource2resourceIndex0getResourceMake(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return ud-&gt;metalMake;
+	} else if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return ud-&gt;energyMake;
+	} else {
+		return 0.0f;
+	}
+}
+EXPORT(float) _Clb_UnitDef_0REF1Resource2resourceIndex0getMakesResource(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return ud-&gt;makesMetal;
+	} else {
+		return 0.0f;
+	}
+}
+EXPORT(float) _Clb_UnitDef_0REF1Resource2resourceIndex0getCost(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return ud-&gt;metalCost;
+	} else if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return ud-&gt;energyCost;
+	} else {
+		return 0.0f;
+	}
+}
+EXPORT(float) _Clb_UnitDef_0REF1Resource2resourceIndex0getExtractsResource(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return ud-&gt;extractsMetal;
+	} else {
+		return 0.0f;
+	}
+}
+EXPORT(float) _Clb_UnitDef_0REF1Resource2resourceIndex0getResourceExtractorRange(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return ud-&gt;extractRange;
+	} else {
+		return 0.0f;
+	}
+}
+EXPORT(float) _Clb_UnitDef_0REF1Resource2resourceIndex0getWindResourceGenerator(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return ud-&gt;windGenerator;
+	} else {
+		return 0.0f;
+	}
+}
+EXPORT(float) _Clb_UnitDef_0REF1Resource2resourceIndex0getTidalResourceGenerator(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return ud-&gt;tidalGenerator;
+	} else {
+		return 0.0f;
+	}
+}
+EXPORT(float) _Clb_UnitDef_0REF1Resource2resourceIndex0getStorage(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return ud-&gt;metalStorage;
+	} else if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return ud-&gt;energyStorage;
+	} else {
+		return 0.0f;
+	}
+}
 EXPORT(float) _Clb_UnitDef_getBuildTime(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;buildTime;}
-EXPORT(float) _Clb_UnitDef_getExtractsMetal(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;extractsMetal;}
-EXPORT(float) _Clb_UnitDef_getExtractRange(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;extractRange;}
-EXPORT(float) _Clb_UnitDef_getWindGenerator(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;windGenerator;}
-EXPORT(float) _Clb_UnitDef_getTidalGenerator(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;tidalGenerator;}
-EXPORT(float) _Clb_UnitDef_getMetalStorage(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;metalStorage;}
-EXPORT(float) _Clb_UnitDef_getEnergyStorage(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;energyStorage;}
 EXPORT(float) _Clb_UnitDef_getAutoHeal(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;autoHeal;}
 EXPORT(float) _Clb_UnitDef_getIdleAutoHeal(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;idleAutoHeal;}
 EXPORT(int) _Clb_UnitDef_getIdleTime(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;idleTime;}
@@ -1013,11 +1198,11 @@
 EXPORT(float) _Clb_UnitDef_getMaxWaterDepth(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;maxWaterDepth;}
 EXPORT(float) _Clb_UnitDef_getArmoredMultiple(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;armoredMultiple;}
 EXPORT(int) _Clb_UnitDef_getArmorType(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;armorType;}
-EXPORT(int) _Clb_UnitDef_getFlankingBonusMode(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusMode;}
-EXPORT(SAIFloat3) _Clb_UnitDef_getFlankingBonusDir(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusDir.toSAIFloat3();}
-EXPORT(float) _Clb_UnitDef_getFlankingBonusMax(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusMax;}
-EXPORT(float) _Clb_UnitDef_getFlankingBonusMin(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusMin;}
-EXPORT(float) _Clb_UnitDef_getFlankingBonusMobilityAdd(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusMobilityAdd;}
+EXPORT(int) _Clb_UnitDef_FlankingBonus_getMode(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusMode;}
+EXPORT(SAIFloat3) _Clb_UnitDef_FlankingBonus_getDir(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusDir.toSAIFloat3();}
+EXPORT(float) _Clb_UnitDef_FlankingBonus_getMax(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusMax;}
+EXPORT(float) _Clb_UnitDef_FlankingBonus_getMin(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusMin;}
+EXPORT(float) _Clb_UnitDef_FlankingBonus_getMobilityAdd(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flankingBonusMobilityAdd;}
 EXPORT(const char*) _Clb_UnitDef_CollisionVolume_getType(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;collisionVolumeType.c_str();}
 EXPORT(SAIFloat3) _Clb_UnitDef_CollisionVolume_getScales(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;collisionVolumeScales.toSAIFloat3();}
 EXPORT(SAIFloat3) _Clb_UnitDef_CollisionVolume_getOffsets(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;collisionVolumeOffsets.toSAIFloat3();}
@@ -1133,7 +1318,15 @@
 EXPORT(int) _Clb_UnitDef_getFlareSalvoSize(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flareSalvoSize;}
 EXPORT(int) _Clb_UnitDef_getFlareSalvoDelay(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;flareSalvoDelay;}
 EXPORT(bool) _Clb_UnitDef_isSmoothAnim(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;smoothAnim;}
-EXPORT(bool) _Clb_UnitDef_isMetalMaker(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;isMetalMaker;}
+EXPORT(bool) _Clb_UnitDef_0REF1Resource2resourceIndex0isResourceMaker(int teamId, int unitDefId, int resourceIndex) {
+
+	const UnitDef* ud = getUnitDefById(teamId, unitDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return ud-&gt;isMetalMaker;
+	} else {
+		return false;
+	}
+}
 EXPORT(bool) _Clb_UnitDef_isCanLoopbackAttack(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;canLoopbackAttack;}
 EXPORT(bool) _Clb_UnitDef_isLevelGround(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;levelGround;}
 EXPORT(bool) _Clb_UnitDef_isUseBuildingGroundDecal(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;useBuildingGroundDecal;}
@@ -1146,16 +1339,16 @@
 EXPORT(float) _Clb_UnitDef_getRefuelTime(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;refuelTime;}
 EXPORT(float) _Clb_UnitDef_getMinAirBasePower(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;minAirBasePower;}
 EXPORT(int) _Clb_UnitDef_getMaxThisUnit(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;maxThisUnit;}
-EXPORT(int) _Clb_UnitDef_getDecoyDefId(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;decoyDef-&gt;id;}
+EXPORT(int) _Clb_UnitDef_0SINGLE1FETCH2UnitDef0getDecoyDef(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;decoyDef-&gt;id;}
 EXPORT(bool) _Clb_UnitDef_isDontLand(int teamId, int unitDefId) {return getUnitDefById(teamId, unitDefId)-&gt;DontLand();}
-EXPORT(int) _Clb_UnitDef_getShieldWeaponDefId(int teamId, int unitDefId) {
+EXPORT(int) _Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getShieldDef(int teamId, int unitDefId) {
 	const WeaponDef* wd = getUnitDefById(teamId, unitDefId)-&gt;shieldWeaponDef;
 	if (wd == NULL)
 		return -1;
 	else
 		return wd-&gt;id;
 }
-EXPORT(int) _Clb_UnitDef_getStockpileWeaponDefId(int teamId, int unitDefId) {
+EXPORT(int) _Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getStockpileDef(int teamId, int unitDefId) {
 	const WeaponDef* wd = getUnitDefById(teamId, unitDefId)-&gt;stockpileWeaponDef;
 	if (wd == NULL)
 		return -1;
@@ -1202,7 +1395,7 @@
 EXPORT(const char*) _Clb_UnitDef_WeaponMount_getName(int teamId, int unitDefId, int weaponIndex) {
 	return getUnitDefById(teamId, unitDefId)-&gt;weapons.at(weaponIndex).name.c_str();
 }
-EXPORT(int) _Clb_UnitDef_WeaponMount_getWeaponDefId(int teamId, int unitDefId, int weaponIndex) {return getUnitDefById(teamId, unitDefId)-&gt;weapons.at(weaponIndex).def-&gt;id;}
+EXPORT(int) _Clb_UnitDef_WeaponMount_0SINGLE1FETCH2WeaponDef0getWeaponDef(int teamId, int unitDefId, int weaponIndex) {return getUnitDefById(teamId, unitDefId)-&gt;weapons.at(weaponIndex).def-&gt;id;}
 EXPORT(int) _Clb_UnitDef_WeaponMount_getSlavedTo(int teamId, int unitDefId, int weaponIndex) {return getUnitDefById(teamId, unitDefId)-&gt;weapons.at(weaponIndex).slavedTo;}
 EXPORT(SAIFloat3) _Clb_UnitDef_WeaponMount_getMainDir(int teamId, int unitDefId, int weaponIndex) {return getUnitDefById(teamId, unitDefId)-&gt;weapons.at(weaponIndex).mainDir.toSAIFloat3();}
 EXPORT(float) _Clb_UnitDef_WeaponMount_getMaxAngleDif(int teamId, int unitDefId, int weaponIndex) {return getUnitDefById(teamId, unitDefId)-&gt;weapons.at(weaponIndex).maxAngleDif;}
@@ -1477,7 +1670,7 @@
 EXPORT(int) _Clb_Unit_0MULTI1SIZE0ResourceInfo(int teamId, int unitId) {
 	return _Clb_0MULTI1SIZE0Resource(teamId);
 }
-EXPORT(float) _Clb_Unit_ResourceInfo_getUse(int teamId, int unitId, int resourceIndex) {
+EXPORT(float) _Clb_Unit_0REF1Resource2resourceIndex0getResourceUse(int teamId, int unitId, int resourceIndex) {
 
 	int res = -1.0F;
 	UnitResourceInfo resourceInfo;
@@ -1498,7 +1691,7 @@
 
 	return res;
 }
-EXPORT(float) _Clb_Unit_ResourceInfo_getMake(int teamId, int unitId, int resourceIndex) {
+EXPORT(float) _Clb_Unit_0REF1Resource2resourceIndex0getResourceMake(int teamId, int unitId, int resourceIndex) {
 
 	int res = -1.0F;
 	UnitResourceInfo resourceInfo;
@@ -1694,8 +1887,17 @@
 EXPORT(const char*) _Clb_FeatureDef_getDescription(int teamId, int featureDefId) {return getFeatureDefById(teamId, featureDefId)-&gt;description.c_str();}
 EXPORT(const char*) _Clb_FeatureDef_getFileName(int teamId, int featureDefId) {return getFeatureDefById(teamId, featureDefId)-&gt;filename.c_str();}
 EXPORT(int) _Clb_FeatureDef_getId(int teamId, int featureDefId) {return getFeatureDefById(teamId, featureDefId)-&gt;id;}
-EXPORT(float) _Clb_FeatureDef_getMetal(int teamId, int featureDefId) {return getFeatureDefById(teamId, featureDefId)-&gt;metal;}
-EXPORT(float) _Clb_FeatureDef_getEnergy(int teamId, int featureDefId) {return getFeatureDefById(teamId, featureDefId)-&gt;energy;}
+EXPORT(float) _Clb_FeatureDef_0REF1Resource2resourceIndex0getContainedResource(int teamId, int featureDefId, int resourceIndex) {
+
+	const FeatureDef* fd = getFeatureDefById(teamId, featureDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return fd-&gt;metal;
+	} else if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return fd-&gt;energy;
+	} else {
+		return 0.0f;
+	}
+}
 EXPORT(float) _Clb_FeatureDef_getMaxHealth(int teamId, int featureDefId) {return getFeatureDefById(teamId, featureDefId)-&gt;maxHealth;}
 EXPORT(float) _Clb_FeatureDef_getReclaimTime(int teamId, int featureDefId) {return getFeatureDefById(teamId, featureDefId)-&gt;reclaimTime;}
 EXPORT(float) _Clb_FeatureDef_getMass(int teamId, int featureDefId) {return getFeatureDefById(teamId, featureDefId)-&gt;mass;}
@@ -1770,6 +1972,12 @@
 
 
 //########### BEGINN WeaponDef
+EXPORT(int) _Clb_0MULTI1SIZE0WeaponDef(int teamId) {
+	return weaponDefHandler-&gt;numWeaponDefs;
+}
+//EXPORT(int) _Clb_0MULTI1VALS0WeaponDef(int teamId, int weaponDefIds[], int weaponDefIds_max) {
+//	;kk
+//}
 EXPORT(int) _Clb_0MULTI1FETCH3WeaponDefByName0WeaponDef(int teamId, const char* weaponDefName) {
 
 	int weaponDefId = -1;
@@ -1782,7 +1990,9 @@
 
 	return weaponDefId;
 }
-
+EXPORT(int) _Clb_WeaponDef_getId(int teamId, int weaponDefId) {
+	return getWeaponDefById(teamId, weaponDefId)-&gt;id;
+}
 EXPORT(const char*) _Clb_WeaponDef_getName(int teamId, int weaponDefId) {
 	return getWeaponDefById(teamId, weaponDefId)-&gt;name.c_str();
 }
@@ -1790,7 +2000,7 @@
 	return getWeaponDefById(teamId, weaponDefId)-&gt;type.c_str();
 }
 EXPORT(const char*) _Clb_WeaponDef_getDescription(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;description.c_str();}
-EXPORT(const char*) _Clb_WeaponDef_getFilename(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;filename.c_str();}
+EXPORT(const char*) _Clb_WeaponDef_getFileName(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;filename.c_str();}
 EXPORT(const char*) _Clb_WeaponDef_getCegTag(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;cegTag.c_str();}
 EXPORT(float) _Clb_WeaponDef_getRange(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;range;}
 EXPORT(float) _Clb_WeaponDef_getHeightMod(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;heightmod;}
@@ -1856,11 +2066,19 @@
 EXPORT(float) _Clb_WeaponDef_getRestTime(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;restTime;}
 EXPORT(float) _Clb_WeaponDef_getUpTime(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;uptime;}
 EXPORT(int) _Clb_WeaponDef_getFlightTime(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;flighttime;}
-EXPORT(float) _Clb_WeaponDef_getMetalCost(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;metalcost;}
-EXPORT(float) _Clb_WeaponDef_getEnergyCost(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;energycost;}
+EXPORT(float) _Clb_WeaponDef_0REF1Resource2resourceIndex0getCost(int teamId, int weaponDefId, int resourceIndex) {
+
+	const WeaponDef* wd = getWeaponDefById(teamId, weaponDefId);
+	if (resourceIndex == rh-&gt;GetMetalIndex()) {
+		return wd-&gt;metalcost;
+	} else if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return wd-&gt;energycost;
+	} else {
+		return 0.0f;
+	}
+}
 EXPORT(float) _Clb_WeaponDef_getSupplyCost(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;supplycost;}
 EXPORT(int) _Clb_WeaponDef_getProjectilesPerShot(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;projectilespershot;}
-EXPORT(int) _Clb_WeaponDef_getId(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;id;}
 EXPORT(int) _Clb_WeaponDef_getTdfId(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;tdfId;}
 EXPORT(bool) _Clb_WeaponDef_isTurret(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;turret;}
 EXPORT(bool) _Clb_WeaponDef_isOnlyForward(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;onlyForward;}
@@ -1911,13 +2129,29 @@
 EXPORT(bool) _Clb_WeaponDef_isVisibleShield(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;visibleShield;}
 EXPORT(bool) _Clb_WeaponDef_isVisibleShieldRepulse(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;visibleShieldRepulse;}
 EXPORT(int) _Clb_WeaponDef_getVisibleShieldHitFrames(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;visibleShieldHitFrames;}
-EXPORT(float) _Clb_WeaponDef_Shield_getEnergyUse(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldEnergyUse;}
+EXPORT(float) _Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getResourceUse(int teamId, int weaponDefId, int resourceIndex) {
+
+	const WeaponDef* wd = getWeaponDefById(teamId, weaponDefId);
+	if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return wd-&gt;shieldEnergyUse;
+	} else {
+		return 0.0f;
+	}
+}
 EXPORT(float) _Clb_WeaponDef_Shield_getRadius(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldRadius;}
 EXPORT(float) _Clb_WeaponDef_Shield_getForce(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldForce;}
 EXPORT(float) _Clb_WeaponDef_Shield_getMaxSpeed(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldMaxSpeed;}
 EXPORT(float) _Clb_WeaponDef_Shield_getPower(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldPower;}
 EXPORT(float) _Clb_WeaponDef_Shield_getPowerRegen(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldPowerRegen;}
-EXPORT(float) _Clb_WeaponDef_Shield_getPowerRegenEnergy(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldPowerRegenEnergy;}
+EXPORT(float) _Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getPowerRegenResource(int teamId, int weaponDefId, int resourceIndex) {
+
+	const WeaponDef* wd = getWeaponDefById(teamId, weaponDefId);
+	if (resourceIndex == rh-&gt;GetEnergyIndex()) {
+		return wd-&gt;shieldPowerRegenEnergy;
+	} else {
+		return 0.0f;
+	}
+}
 EXPORT(float) _Clb_WeaponDef_Shield_getStartingPower(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldStartingPower;}
 EXPORT(int) _Clb_WeaponDef_Shield_getRechargeDelay(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldRechargeDelay;}
 EXPORT(struct SAIFloat3) _Clb_WeaponDef_Shield_getGoodColor(int teamId, int weaponDefId) {return getWeaponDefById(teamId, weaponDefId)-&gt;shieldGoodColor.toSAIFloat3();}
@@ -2106,11 +2340,11 @@
 	sAICallback-&gt;Clb_0MULTI1SIZE0Resource = _Clb_0MULTI1SIZE0Resource;
 	sAICallback-&gt;Clb_0MULTI1FETCH3ResourceByName0Resource = _Clb_0MULTI1FETCH3ResourceByName0Resource;
 	sAICallback-&gt;Clb_Resource_getName = _Clb_Resource_getName;
-	sAICallback-&gt;Clb_Resource_isGoodToHave = _Clb_Resource_isGoodToHave;
-	sAICallback-&gt;Clb_Resource_getCurrent = _Clb_Resource_getCurrent;
-	sAICallback-&gt;Clb_Resource_getIncome = _Clb_Resource_getIncome;
-	sAICallback-&gt;Clb_Resource_getUsage = _Clb_Resource_getUsage;
-	sAICallback-&gt;Clb_Resource_getStorage = _Clb_Resource_getStorage;
+	sAICallback-&gt;Clb_Resource_getOptimum = _Clb_Resource_getOptimum;
+	sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getCurrent = _Clb_Economy_0REF1Resource2resourceIndex0getCurrent;
+	sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getIncome = _Clb_Economy_0REF1Resource2resourceIndex0getIncome;
+	sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getUsage = _Clb_Economy_0REF1Resource2resourceIndex0getUsage;
+	sAICallback-&gt;Clb_Economy_0REF1Resource2resourceIndex0getStorage = _Clb_Economy_0REF1Resource2resourceIndex0getStorage;
 	sAICallback-&gt;Clb_File_getSize = _Clb_File_getSize;
 	sAICallback-&gt;Clb_File_getContent = _Clb_File_getContent;
 	sAICallback-&gt;Clb_File_locateForReading = _Clb_File_locateForReading;
@@ -2123,25 +2357,21 @@
 	sAICallback-&gt;Clb_UnitDef_isValid = _Clb_UnitDef_isValid;
 	sAICallback-&gt;Clb_UnitDef_getName = _Clb_UnitDef_getName;
 	sAICallback-&gt;Clb_UnitDef_getHumanName = _Clb_UnitDef_getHumanName;
-	sAICallback-&gt;Clb_UnitDef_getFilename = _Clb_UnitDef_getFilename;
+	sAICallback-&gt;Clb_UnitDef_getFileName = _Clb_UnitDef_getFileName;
 	sAICallback-&gt;Clb_UnitDef_getAiHint = _Clb_UnitDef_getAiHint;
 	sAICallback-&gt;Clb_UnitDef_getCobId = _Clb_UnitDef_getCobId;
 	sAICallback-&gt;Clb_UnitDef_getTechLevel = _Clb_UnitDef_getTechLevel;
 	sAICallback-&gt;Clb_UnitDef_getGaia = _Clb_UnitDef_getGaia;
-	sAICallback-&gt;Clb_UnitDef_getMetalUpkeep = _Clb_UnitDef_getMetalUpkeep;
-	sAICallback-&gt;Clb_UnitDef_getEnergyUpkeep = _Clb_UnitDef_getEnergyUpkeep;
-	sAICallback-&gt;Clb_UnitDef_getMetalMake = _Clb_UnitDef_getMetalMake;
-	sAICallback-&gt;Clb_UnitDef_getMakesMetal = _Clb_UnitDef_getMakesMetal;
-	sAICallback-&gt;Clb_UnitDef_getEnergyMake = _Clb_UnitDef_getEnergyMake;
-	sAICallback-&gt;Clb_UnitDef_getMetalCost = _Clb_UnitDef_getMetalCost;
-	sAICallback-&gt;Clb_UnitDef_getEnergyCost = _Clb_UnitDef_getEnergyCost;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getUpkeep = _Clb_UnitDef_0REF1Resource2resourceIndex0getUpkeep;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getResourceMake = _Clb_UnitDef_0REF1Resource2resourceIndex0getResourceMake;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getMakesResource = _Clb_UnitDef_0REF1Resource2resourceIndex0getMakesResource;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getCost = _Clb_UnitDef_0REF1Resource2resourceIndex0getCost;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getExtractsResource = _Clb_UnitDef_0REF1Resource2resourceIndex0getExtractsResource;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getResourceExtractorRange = _Clb_UnitDef_0REF1Resource2resourceIndex0getResourceExtractorRange;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getWindResourceGenerator = _Clb_UnitDef_0REF1Resource2resourceIndex0getWindResourceGenerator;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getTidalResourceGenerator = _Clb_UnitDef_0REF1Resource2resourceIndex0getTidalResourceGenerator;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0getStorage = _Clb_UnitDef_0REF1Resource2resourceIndex0getStorage;
 	sAICallback-&gt;Clb_UnitDef_getBuildTime = _Clb_UnitDef_getBuildTime;
-	sAICallback-&gt;Clb_UnitDef_getExtractsMetal = _Clb_UnitDef_getExtractsMetal;
-	sAICallback-&gt;Clb_UnitDef_getExtractRange = _Clb_UnitDef_getExtractRange;
-	sAICallback-&gt;Clb_UnitDef_getWindGenerator = _Clb_UnitDef_getWindGenerator;
-	sAICallback-&gt;Clb_UnitDef_getTidalGenerator = _Clb_UnitDef_getTidalGenerator;
-	sAICallback-&gt;Clb_UnitDef_getMetalStorage = _Clb_UnitDef_getMetalStorage;
-	sAICallback-&gt;Clb_UnitDef_getEnergyStorage = _Clb_UnitDef_getEnergyStorage;
 	sAICallback-&gt;Clb_UnitDef_getAutoHeal = _Clb_UnitDef_getAutoHeal;
 	sAICallback-&gt;Clb_UnitDef_getIdleAutoHeal = _Clb_UnitDef_getIdleAutoHeal;
 	sAICallback-&gt;Clb_UnitDef_getIdleTime = _Clb_UnitDef_getIdleTime;
@@ -2187,11 +2417,11 @@
 	sAICallback-&gt;Clb_UnitDef_getMaxWaterDepth = _Clb_UnitDef_getMaxWaterDepth;
 	sAICallback-&gt;Clb_UnitDef_getArmoredMultiple = _Clb_UnitDef_getArmoredMultiple;
 	sAICallback-&gt;Clb_UnitDef_getArmorType = _Clb_UnitDef_getArmorType;
-	sAICallback-&gt;Clb_UnitDef_getFlankingBonusMode = _Clb_UnitDef_getFlankingBonusMode;
-	sAICallback-&gt;Clb_UnitDef_getFlankingBonusDir = _Clb_UnitDef_getFlankingBonusDir;
-	sAICallback-&gt;Clb_UnitDef_getFlankingBonusMax = _Clb_UnitDef_getFlankingBonusMax;
-	sAICallback-&gt;Clb_UnitDef_getFlankingBonusMin = _Clb_UnitDef_getFlankingBonusMin;
-	sAICallback-&gt;Clb_UnitDef_getFlankingBonusMobilityAdd = _Clb_UnitDef_getFlankingBonusMobilityAdd;
+	sAICallback-&gt;Clb_UnitDef_FlankingBonus_getMode = _Clb_UnitDef_FlankingBonus_getMode;
+	sAICallback-&gt;Clb_UnitDef_FlankingBonus_getDir = _Clb_UnitDef_FlankingBonus_getDir;
+	sAICallback-&gt;Clb_UnitDef_FlankingBonus_getMax = _Clb_UnitDef_FlankingBonus_getMax;
+	sAICallback-&gt;Clb_UnitDef_FlankingBonus_getMin = _Clb_UnitDef_FlankingBonus_getMin;
+	sAICallback-&gt;Clb_UnitDef_FlankingBonus_getMobilityAdd = _Clb_UnitDef_FlankingBonus_getMobilityAdd;
 	sAICallback-&gt;Clb_UnitDef_CollisionVolume_getType = _Clb_UnitDef_CollisionVolume_getType;
 	sAICallback-&gt;Clb_UnitDef_CollisionVolume_getScales = _Clb_UnitDef_CollisionVolume_getScales;
 	sAICallback-&gt;Clb_UnitDef_CollisionVolume_getOffsets = _Clb_UnitDef_CollisionVolume_getOffsets;
@@ -2306,7 +2536,7 @@
 	sAICallback-&gt;Clb_UnitDef_getFlareSalvoSize = _Clb_UnitDef_getFlareSalvoSize;
 	sAICallback-&gt;Clb_UnitDef_getFlareSalvoDelay = _Clb_UnitDef_getFlareSalvoDelay;
 	sAICallback-&gt;Clb_UnitDef_isSmoothAnim = _Clb_UnitDef_isSmoothAnim;
-	sAICallback-&gt;Clb_UnitDef_isMetalMaker = _Clb_UnitDef_isMetalMaker;
+	sAICallback-&gt;Clb_UnitDef_0REF1Resource2resourceIndex0isResourceMaker = _Clb_UnitDef_0REF1Resource2resourceIndex0isResourceMaker;
 	sAICallback-&gt;Clb_UnitDef_isCanLoopbackAttack = _Clb_UnitDef_isCanLoopbackAttack;
 	sAICallback-&gt;Clb_UnitDef_isLevelGround = _Clb_UnitDef_isLevelGround;
 	sAICallback-&gt;Clb_UnitDef_isUseBuildingGroundDecal = _Clb_UnitDef_isUseBuildingGroundDecal;
@@ -2319,10 +2549,10 @@
 	sAICallback-&gt;Clb_UnitDef_getRefuelTime = _Clb_UnitDef_getRefuelTime;
 	sAICallback-&gt;Clb_UnitDef_getMinAirBasePower = _Clb_UnitDef_getMinAirBasePower;
 	sAICallback-&gt;Clb_UnitDef_getMaxThisUnit = _Clb_UnitDef_getMaxThisUnit;
-	sAICallback-&gt;Clb_UnitDef_getDecoyDefId = _Clb_UnitDef_getDecoyDefId;
+	sAICallback-&gt;Clb_UnitDef_0SINGLE1FETCH2UnitDef0getDecoyDef = _Clb_UnitDef_0SINGLE1FETCH2UnitDef0getDecoyDef;
 	sAICallback-&gt;Clb_UnitDef_isDontLand = _Clb_UnitDef_isDontLand;
-	sAICallback-&gt;Clb_UnitDef_getShieldWeaponDefId = _Clb_UnitDef_getShieldWeaponDefId;
-	sAICallback-&gt;Clb_UnitDef_getStockpileWeaponDefId = _Clb_UnitDef_getStockpileWeaponDefId;
+	sAICallback-&gt;Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getShieldDef = _Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getShieldDef;
+	sAICallback-&gt;Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getStockpileDef = _Clb_UnitDef_0SINGLE1FETCH2WeaponDef0getStockpileDef;
 	sAICallback-&gt;Clb_UnitDef_0ARRAY1SIZE0getBuildOptions = _Clb_UnitDef_0ARRAY1SIZE0getBuildOptions;
 	sAICallback-&gt;Clb_UnitDef_0ARRAY1VALS0getBuildOptions = _Clb_UnitDef_0ARRAY1VALS0getBuildOptions;
 	sAICallback-&gt;Clb_UnitDef_0MAP1SIZE0getCustomParams = _Clb_UnitDef_0MAP1SIZE0getCustomParams;
@@ -2345,7 +2575,7 @@
 	sAICallback-&gt;Clb_UnitDef_MoveData_isSubMarine = _Clb_UnitDef_MoveData_isSubMarine;
 	sAICallback-&gt;Clb_UnitDef_0MULTI1SIZE0WeaponMount = _Clb_UnitDef_0MULTI1SIZE0WeaponMount;
 	sAICallback-&gt;Clb_UnitDef_WeaponMount_getName = _Clb_UnitDef_WeaponMount_getName;
-	sAICallback-&gt;Clb_UnitDef_WeaponMount_getWeaponDefId = _Clb_UnitDef_WeaponMount_getWeaponDefId;
+	sAICallback-&gt;Clb_UnitDef_WeaponMount_0SINGLE1FETCH2WeaponDef0getWeaponDef = _Clb_UnitDef_WeaponMount_0SINGLE1FETCH2WeaponDef0getWeaponDef;
 	sAICallback-&gt;Clb_UnitDef_WeaponMount_getSlavedTo = _Clb_UnitDef_WeaponMount_getSlavedTo;
 	sAICallback-&gt;Clb_UnitDef_WeaponMount_getMainDir = _Clb_UnitDef_WeaponMount_getMainDir;
 	sAICallback-&gt;Clb_UnitDef_WeaponMount_getMaxAngleDif = _Clb_UnitDef_WeaponMount_getMaxAngleDif;
@@ -2401,8 +2631,8 @@
 	sAICallback-&gt;Clb_Unit_getSpeed = _Clb_Unit_getSpeed;
 	sAICallback-&gt;Clb_Unit_getPower = _Clb_Unit_getPower;
 	sAICallback-&gt;Clb_Unit_0MULTI1SIZE0ResourceInfo = _Clb_Unit_0MULTI1SIZE0ResourceInfo;
-	sAICallback-&gt;Clb_Unit_ResourceInfo_getUse = _Clb_Unit_ResourceInfo_getUse;
-	sAICallback-&gt;Clb_Unit_ResourceInfo_getMake = _Clb_Unit_ResourceInfo_getMake;
+	sAICallback-&gt;Clb_Unit_0REF1Resource2resourceIndex0getResourceUse = _Clb_Unit_0REF1Resource2resourceIndex0getResourceUse;
+	sAICallback-&gt;Clb_Unit_0REF1Resource2resourceIndex0getResourceMake = _Clb_Unit_0REF1Resource2resourceIndex0getResourceMake;
 	sAICallback-&gt;Clb_Unit_getPos = _Clb_Unit_getPos;
 	sAICallback-&gt;Clb_Unit_isActivated = _Clb_Unit_isActivated;
 	sAICallback-&gt;Clb_Unit_isBeingBuilt = _Clb_Unit_isBeingBuilt;
@@ -2435,18 +2665,24 @@
 	sAICallback-&gt;Clb_Map_isPosInCamera = _Clb_Map_isPosInCamera;
 	sAICallback-&gt;Clb_Map_getWidth = _Clb_Map_getWidth;
 	sAICallback-&gt;Clb_Map_getHeight = _Clb_Map_getHeight;
-	sAICallback-&gt;Clb_Map_getHeightMap = _Clb_Map_getHeightMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getHeightMap = _Clb_Map_0ARRAY1SIZE0getHeightMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1VALS0getHeightMap = _Clb_Map_0ARRAY1VALS0getHeightMap;
 	sAICallback-&gt;Clb_Map_getMinHeight = _Clb_Map_getMinHeight;
 	sAICallback-&gt;Clb_Map_getMaxHeight = _Clb_Map_getMaxHeight;
-	sAICallback-&gt;Clb_Map_getSlopeMap = _Clb_Map_getSlopeMap;
-	sAICallback-&gt;Clb_Map_getLosMap = _Clb_Map_getLosMap;
-	sAICallback-&gt;Clb_Map_getRadarMap = _Clb_Map_getRadarMap;
-	sAICallback-&gt;Clb_Map_getJammerMap = _Clb_Map_getJammerMap;
-	sAICallback-&gt;Clb_Map_getMetalMap = _Clb_Map_getMetalMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getSlopeMap = _Clb_Map_0ARRAY1SIZE0getSlopeMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1VALS0getSlopeMap = _Clb_Map_0ARRAY1VALS0getSlopeMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getLosMap = _Clb_Map_0ARRAY1SIZE0getLosMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1VALS0getLosMap = _Clb_Map_0ARRAY1VALS0getLosMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getRadarMap = _Clb_Map_0ARRAY1SIZE0getRadarMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1VALS0getRadarMap = _Clb_Map_0ARRAY1VALS0getRadarMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1SIZE0getJammerMap = _Clb_Map_0ARRAY1SIZE0getJammerMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1VALS0getJammerMap = _Clb_Map_0ARRAY1VALS0getJammerMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1SIZE0REF1Resource2resourceIndex0getResourceMap = _Clb_Map_0ARRAY1SIZE0REF1Resource2resourceIndex0getResourceMap;
+	sAICallback-&gt;Clb_Map_0ARRAY1VALS0REF1Resource2resourceIndex0getResourceMap = _Clb_Map_0ARRAY1VALS0REF1Resource2resourceIndex0getResourceMap;
 	sAICallback-&gt;Clb_Map_getName = _Clb_Map_getName;
 	sAICallback-&gt;Clb_Map_getElevationAt = _Clb_Map_getElevationAt;
-	sAICallback-&gt;Clb_Map_getMaxMetal = _Clb_Map_getMaxMetal;
-	sAICallback-&gt;Clb_Map_getExtractorRadius = _Clb_Map_getExtractorRadius;
+	sAICallback-&gt;Clb_Map_0REF1Resource2resourceIndex0getMaxResource = _Clb_Map_0REF1Resource2resourceIndex0getMaxResource;
+	sAICallback-&gt;Clb_Map_0REF1Resource2resourceIndex0getExtractorRadius = _Clb_Map_0REF1Resource2resourceIndex0getExtractorRadius;
 	sAICallback-&gt;Clb_Map_getMinWind = _Clb_Map_getMinWind;
 	sAICallback-&gt;Clb_Map_getMaxWind = _Clb_Map_getMaxWind;
 	sAICallback-&gt;Clb_Map_getTidalStrength = _Clb_Map_getTidalStrength;
@@ -2463,12 +2699,11 @@
 	sAICallback-&gt;Clb_Map_findClosestBuildSite = _Clb_Map_findClosestBuildSite;
 	sAICallback-&gt;Clb_0MULTI1SIZE0FeatureDef = _Clb_0MULTI1SIZE0FeatureDef;
 	sAICallback-&gt;Clb_0MULTI1VALS0FeatureDef = _Clb_0MULTI1VALS0FeatureDef;
+	sAICallback-&gt;Clb_FeatureDef_getId = _Clb_FeatureDef_getId;
 	sAICallback-&gt;Clb_FeatureDef_getName = _Clb_FeatureDef_getName;
 	sAICallback-&gt;Clb_FeatureDef_getDescription = _Clb_FeatureDef_getDescription;
 	sAICallback-&gt;Clb_FeatureDef_getFileName = _Clb_FeatureDef_getFileName;
-	sAICallback-&gt;Clb_FeatureDef_getId = _Clb_FeatureDef_getId;
-	sAICallback-&gt;Clb_FeatureDef_getMetal = _Clb_FeatureDef_getMetal;
-	sAICallback-&gt;Clb_FeatureDef_getEnergy = _Clb_FeatureDef_getEnergy;
+	sAICallback-&gt;Clb_FeatureDef_0REF1Resource2resourceIndex0getContainedResource = _Clb_FeatureDef_0REF1Resource2resourceIndex0getContainedResource;
 	sAICallback-&gt;Clb_FeatureDef_getMaxHealth = _Clb_FeatureDef_getMaxHealth;
 	sAICallback-&gt;Clb_FeatureDef_getReclaimTime = _Clb_FeatureDef_getReclaimTime;
 	sAICallback-&gt;Clb_FeatureDef_getMass = _Clb_FeatureDef_getMass;
@@ -2503,11 +2738,12 @@
 	sAICallback-&gt;Clb_Feature_getHealth = _Clb_Feature_getHealth;
 	sAICallback-&gt;Clb_Feature_getReclaimLeft = _Clb_Feature_getReclaimLeft;
 	sAICallback-&gt;Clb_Feature_getPosition = _Clb_Feature_getPosition;
+	sAICallback-&gt;Clb_0MULTI1SIZE0WeaponDef = _Clb_0MULTI1SIZE0WeaponDef;
 	sAICallback-&gt;Clb_0MULTI1FETCH3WeaponDefByName0WeaponDef = _Clb_0MULTI1FETCH3WeaponDefByName0WeaponDef;
 	sAICallback-&gt;Clb_WeaponDef_getName = _Clb_WeaponDef_getName;
 	sAICallback-&gt;Clb_WeaponDef_getType = _Clb_WeaponDef_getType;
 	sAICallback-&gt;Clb_WeaponDef_getDescription = _Clb_WeaponDef_getDescription;
-	sAICallback-&gt;Clb_WeaponDef_getFilename = _Clb_WeaponDef_getFilename;
+	sAICallback-&gt;Clb_WeaponDef_getFileName = _Clb_WeaponDef_getFileName;
 	sAICallback-&gt;Clb_WeaponDef_getCegTag = _Clb_WeaponDef_getCegTag;
 	sAICallback-&gt;Clb_WeaponDef_getRange = _Clb_WeaponDef_getRange;
 	sAICallback-&gt;Clb_WeaponDef_getHeightMod = _Clb_WeaponDef_getHeightMod;
@@ -2526,6 +2762,7 @@
 	sAICallback-&gt;Clb_WeaponDef_Damage_getCraterBoost = _Clb_WeaponDef_Damage_getCraterBoost;
 	sAICallback-&gt;Clb_WeaponDef_Damage_0ARRAY1SIZE0getTypes = _Clb_WeaponDef_Damage_0ARRAY1SIZE0getTypes;
 	sAICallback-&gt;Clb_WeaponDef_Damage_0ARRAY1VALS0getTypes = _Clb_WeaponDef_Damage_0ARRAY1VALS0getTypes;
+	sAICallback-&gt;Clb_WeaponDef_getId = _Clb_WeaponDef_getId;
 	sAICallback-&gt;Clb_WeaponDef_getAreaOfEffect = _Clb_WeaponDef_getAreaOfEffect;
 	sAICallback-&gt;Clb_WeaponDef_isNoSelfDamage = _Clb_WeaponDef_isNoSelfDamage;
 	sAICallback-&gt;Clb_WeaponDef_getFireStarter = _Clb_WeaponDef_getFireStarter;
@@ -2547,11 +2784,9 @@
 	sAICallback-&gt;Clb_WeaponDef_getRestTime = _Clb_WeaponDef_getRestTime;
 	sAICallback-&gt;Clb_WeaponDef_getUpTime = _Clb_WeaponDef_getUpTime;
 	sAICallback-&gt;Clb_WeaponDef_getFlightTime = _Clb_WeaponDef_getFlightTime;
-	sAICallback-&gt;Clb_WeaponDef_getMetalCost = _Clb_WeaponDef_getMetalCost;
-	sAICallback-&gt;Clb_WeaponDef_getEnergyCost = _Clb_WeaponDef_getEnergyCost;
+	sAICallback-&gt;Clb_WeaponDef_0REF1Resource2resourceIndex0getCost = _Clb_WeaponDef_0REF1Resource2resourceIndex0getCost;
 	sAICallback-&gt;Clb_WeaponDef_getSupplyCost = _Clb_WeaponDef_getSupplyCost;
 	sAICallback-&gt;Clb_WeaponDef_getProjectilesPerShot = _Clb_WeaponDef_getProjectilesPerShot;
-	sAICallback-&gt;Clb_WeaponDef_getId = _Clb_WeaponDef_getId;
 	sAICallback-&gt;Clb_WeaponDef_getTdfId = _Clb_WeaponDef_getTdfId;
 	sAICallback-&gt;Clb_WeaponDef_isTurret = _Clb_WeaponDef_isTurret;
 	sAICallback-&gt;Clb_WeaponDef_isOnlyForward = _Clb_WeaponDef_isOnlyForward;
@@ -2602,13 +2837,13 @@
 	sAICallback-&gt;Clb_WeaponDef_isVisibleShield = _Clb_WeaponDef_isVisibleShield;
 	sAICallback-&gt;Clb_WeaponDef_isVisibleShieldRepulse = _Clb_WeaponDef_isVisibleShieldRepulse;
 	sAICallback-&gt;Clb_WeaponDef_getVisibleShieldHitFrames = _Clb_WeaponDef_getVisibleShieldHitFrames;
-	sAICallback-&gt;Clb_WeaponDef_Shield_getEnergyUse = _Clb_WeaponDef_Shield_getEnergyUse;
+	sAICallback-&gt;Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getResourceUse = _Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getResourceUse;
 	sAICallback-&gt;Clb_WeaponDef_Shield_getRadius = _Clb_WeaponDef_Shield_getRadius;
 	sAICallback-&gt;Clb_WeaponDef_Shield_getForce = _Clb_WeaponDef_Shield_getForce;
 	sAICallback-&gt;Clb_WeaponDef_Shield_getMaxSpeed = _Clb_WeaponDef_Shield_getMaxSpeed;
 	sAICallback-&gt;Clb_WeaponDef_Shield_getPower = _Clb_WeaponDef_Shield_getPower;
 	sAICallback-&gt;Clb_WeaponDef_Shield_getPowerRegen = _Clb_WeaponDef_Shield_getPowerRegen;
-	sAICallback-&gt;Clb_WeaponDef_Shield_getPowerRegenEnergy = _Clb_WeaponDef_Shield_getPowerRegenEnergy;
+	sAICallback-&gt;Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getPowerRegenResource = _Clb_WeaponDef_Shield_0REF1Resource2resourceIndex0getPowerRegenResource;
 	sAICallback-&gt;Clb_WeaponDef_Shield_getStartingPower = _Clb_WeaponDef_Shield_getStartingPower;
 	sAICallback-&gt;Clb_WeaponDef_Shield_getRechargeDelay = _Clb_WeaponDef_Shield_getRechargeDelay;
 	sAICallback-&gt;Clb_WeaponDef_Shield_getGoodColor = _Clb_WeaponDef_Shield_getGoodColor;

Modified: branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -28,33 +28,35 @@
 #include &quot;ExternalAI/IAILibraryManager.h&quot;
 #include &quot;IAILibraryManager.h&quot;	// for AI info
 
+#include &quot;LogOutput.h&quot; // TODO: remove again
+
 #include &lt;string&gt;
 
 /**
  * Appends '/' to inPath if it is not empty and does not yet have a '/'
  * or a '\\'at the end.
  */
-std::string ensureNoPathSeparatorAtTail(const std::string&amp; inPath) {
-	
+static std::string ensureNoPathSeparatorAtTail(const std::string&amp; inPath) {
+
 	std::string outPath = inPath;
-	
+
 	if (!outPath.empty()) {
 		char lastChar = outPath.at(outPath.size()-1);
 		if (lastChar == '/' || lastChar == '\\') {
 			outPath.erase(outPath.size()-1, 1);
 		}
 	}
-	
+
 	return outPath;
 }
 
-#include &lt;stdio.h&gt;	// for file IO
+//#include &lt;stdio.h&gt;	// for file IO
 struct SStaticGlobalData* createStaticGlobalData() {
-	
+
 	const std::vector&lt;std::string&gt; dds =
 			FileSystemHandler::GetInstance().GetDataDirectories();
 	unsigned int numDataDirs = dds.size();
-	
+
 	// converting the data-dirs vector to a C strings array (char*[])
 	char** dataDirs = (char**) calloc(numDataDirs, sizeof(char*));
 	unsigned int i;
@@ -63,35 +65,48 @@
 		dataDirs[i] = (char*) calloc(cleanPath.size()+1, sizeof(char));
 		strcpy(dataDirs[i], cleanPath.c_str());
 	}
-	
+
 	IAILibraryManager* aiLibMan = IAILibraryManager::GetInstance();
-	
+
 	// fetch infos for the Skirmish AI libraries that will be used
 	// in the current game
-	const IAILibraryManager::T_skirmishAIInfos* sAIInfos = aiLibMan-&gt;GetUsedSkirmishAIInfos();
-	unsigned int numSkirmishAIs = sAIInfos-&gt;size();
-	unsigned int* numsSkirmishAIInfo = (unsigned int*) calloc(numSkirmishAIs, sizeof(unsigned int));
-	InfoItem** skirmishAIInfos = (InfoItem**) calloc(numSkirmishAIs, sizeof(InfoItem*));
+	const IAILibraryManager::T_skirmishAIInfos&amp; sAIInfos = aiLibMan-&gt;GetUsedSkirmishAIInfos();
 	IAILibraryManager::T_skirmishAIInfos::const_iterator sInfs;
-	for (i=0, sInfs=sAIInfos-&gt;begin(); sInfs != sAIInfos-&gt;end(); ++i, ++sInfs) {
-		numsSkirmishAIInfo[i] = sInfs-&gt;second-&gt;GetInfo()-&gt;size();
-		skirmishAIInfos[i] = (InfoItem*) calloc(numsSkirmishAIInfo[i], sizeof(InfoItem));
-		numsSkirmishAIInfo[i] = sInfs-&gt;second-&gt;GetInfoCReference(skirmishAIInfos[i], numsSkirmishAIInfo[i]);
+	unsigned int numSkirmishAIs = sAIInfos.size();
+//	unsigned int* numsSkirmishAIInfo = (unsigned int*) calloc(numSkirmishAIs, sizeof(unsigned int));
+//	const InfoItem** skirmishAIInfos = (const InfoItem**) calloc(numSkirmishAIs, sizeof(InfoItem*));
+//	for (i=0, sInfs=sAIInfos.begin(); sInfs != sAIInfos.end(); ++i, ++sInfs) {
+//		numsSkirmishAIInfo[i] = sInfs-&gt;second-&gt;GetInfo().size();
+////		skirmishAIInfos[i] = (InfoItem*) calloc(numsSkirmishAIInfo[i], sizeof(InfoItem));
+////		numsSkirmishAIInfo[i] = sInfs-&gt;second-&gt;GetInfoCReference(skirmishAIInfos[i], numsSkirmishAIInfo[i]);
+//		skirmishAIInfos[i] = sInfs-&gt;second-&gt;GetInfoCReference();
+////unsigned int x;
+////for (x=0; x &lt; numsSkirmishAIInfo[i]; ++x) {
+////logOutput.Print(&quot;SStaticGlobalData.cpp skirmishAI[%u].info[%u] key / value: %s / %s&quot;, i, x, skirmishAIInfos[i][x].key, skirmishAIInfos[i][x].value);
+////}
+//	}
+	unsigned int* skirmishAIInfosSizes = (unsigned int*) calloc(numSkirmishAIs, sizeof(unsigned int));
+	const char*** skirmishAIInfosKeys = (const char***) calloc(numSkirmishAIs, sizeof(char**));
+	const char*** skirmishAIInfosValues = (const char***) calloc(numSkirmishAIs, sizeof(char**));
+	for (i=0, sInfs=sAIInfos.begin(); sInfs != sAIInfos.end(); ++i, ++sInfs) {
+		skirmishAIInfosSizes[i] = sInfs-&gt;second-&gt;GetInfo().size();
+		skirmishAIInfosKeys[i] = sInfs-&gt;second-&gt;GetCInfoKeys();
+		skirmishAIInfosValues[i] = sInfs-&gt;second-&gt;GetCInfoValues();
 	}
-	
-	// fetch infos for the Group AI libraries that will be used
-	// in the current game
-	const IAILibraryManager::T_groupAIInfos* gAIInfos = aiLibMan-&gt;GetGroupAIInfos();
-	unsigned int numGroupAIs = gAIInfos-&gt;size();
-	unsigned int* numsGroupAIInfo = (unsigned int*) calloc(numGroupAIs, sizeof(unsigned int));
-	InfoItem** groupAIInfos = (InfoItem**) calloc(numGroupAIs, sizeof(InfoItem*));
-	IAILibraryManager::T_groupAIInfos::const_iterator gInfs;
-	for (i=0, gInfs=gAIInfos-&gt;begin(); gInfs != gAIInfos-&gt;end(); ++i, ++gInfs) {
-		numsGroupAIInfo[i] = gInfs-&gt;second-&gt;GetInfo()-&gt;size();
-		groupAIInfos[i] = (InfoItem*) calloc(numsGroupAIInfo[i], sizeof(InfoItem));
-		numsGroupAIInfo[i] = gInfs-&gt;second-&gt;GetInfoCReference(groupAIInfos[i], numsGroupAIInfo[i]);
-	}
-	
+
+//	// fetch infos for the Group AI libraries that will be used
+//	// in the current game
+//	const IAILibraryManager::T_groupAIInfos&amp; gAIInfos = aiLibMan-&gt;GetGroupAIInfos();
+//	unsigned int numGroupAIs = gAIInfos.size();
+//	unsigned int* numsGroupAIInfo = (unsigned int*) calloc(numGroupAIs, sizeof(unsigned int));
+//	InfoItem** groupAIInfos = (InfoItem**) calloc(numGroupAIs, sizeof(InfoItem*));
+//	IAILibraryManager::T_groupAIInfos::const_iterator gInfs;
+//	for (i=0, gInfs=gAIInfos.begin(); gInfs != gAIInfos.end(); ++i, ++gInfs) {
+//		numsGroupAIInfo[i] = gInfs-&gt;second-&gt;GetInfo()-&gt;size();
+//		groupAIInfos[i] = (InfoItem*) calloc(numsGroupAIInfo[i], sizeof(InfoItem));
+//		numsGroupAIInfo[i] = gInfs-&gt;second-&gt;GetInfoCReference(groupAIInfos[i], numsGroupAIInfo[i]);
+//	}
+
 	const SStaticGlobalData sgd = {
 		MAX_TEAMS,
 		MAX_GROUPS,
@@ -99,28 +114,56 @@
 		numDataDirs,
 		(const char**) dataDirs,
 		numSkirmishAIs,
-		numsSkirmishAIInfo,
-		(const InfoItem**) skirmishAIInfos,
-		numGroupAIs,
-		numsGroupAIInfo,
-		(const InfoItem**) groupAIInfos
+//		numsSkirmishAIInfo,
+//		(const InfoItem**) skirmishAIInfos,
+		skirmishAIInfosSizes,
+		skirmishAIInfosKeys,
+		skirmishAIInfosValues,
+//		numGroupAIs,
+//		numsGroupAIInfo,
+//		(const InfoItem**) groupAIInfos
 	};
-	
+
 	SStaticGlobalData* staticGlobalData = (struct SStaticGlobalData*)
 			malloc(sizeof(struct SStaticGlobalData));
 	*staticGlobalData = sgd;
-	
+
 	return staticGlobalData;
 }
 
 void freeStaticGlobalData(struct SStaticGlobalData* staticGlobalData) {
-	
-	free(const_cast&lt;char*&gt;(staticGlobalData-&gt;springVersion));
-	for(unsigned int i=0; i &lt; staticGlobalData-&gt;numDataDirs; ++i)
+
+	//free(const_cast&lt;char*&gt;(staticGlobalData-&gt;springVersion));
+
+	// free the data dirs
+	for(unsigned int i=0; i &lt; staticGlobalData-&gt;numDataDirs; ++i) {
 		free(const_cast&lt;char*&gt;(staticGlobalData-&gt;dataDirs[i]));
+	}
 	free(const_cast&lt;char**&gt;(staticGlobalData-&gt;dataDirs));
+
+	// free the skirmish AI infos
+//	// we only hold refs to the Infos in CSkirmishAILibraryInfo,
+//	// therefore, we do not call freeInfoItem()
+//	for(unsigned int i=0; i &lt; staticGlobalData-&gt;numSkirmishAIs; ++i) {
+//		free(const_cast&lt;struct InfoItem*&gt;(staticGlobalData-&gt;skirmishAIInfos[i]));
+//	}
+//	free(const_cast&lt;unsigned int*&gt;(staticGlobalData-&gt;numsSkirmishAIInfo));
+//	free(const_cast&lt;struct InfoItem**&gt;(staticGlobalData-&gt;skirmishAIInfos));
+	free(const_cast&lt;unsigned int*&gt;(staticGlobalData-&gt;skirmishAIInfosSizes));
+	free(const_cast&lt;char***&gt;(staticGlobalData-&gt;skirmishAIInfosKeys));
+	free(const_cast&lt;char***&gt;(staticGlobalData-&gt;skirmishAIInfosValues));
+
+//	// free the group AI infos
+//	// we only hold refs to the Infos in CGroupAILibraryInfo,
+//	// therefore, we do not call freeInfoItem()
+//	for(unsigned int i=0; i &lt; staticGlobalData-&gt;numGroupAIs; ++i) {
+//		free(const_cast&lt;struct InfoItem*&gt;(staticGlobalData-&gt;groupAIInfos[i]));
+//	}
+//	free(const_cast&lt;unsigned int*&gt;(staticGlobalData-&gt;numsGroupAIInfo));
+//	free(const_cast&lt;struct InfoItem**&gt;(staticGlobalData-&gt;groupAIInfos));
+
 	free(staticGlobalData);
 	staticGlobalData = NULL;
 }
 
-#endif	/* defined	__cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
+#endif // defined __cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -17,40 +17,28 @@
 
 #include &quot;SkirmishAILibrary.h&quot;
 
-#include &quot;Interface/SAIInterfaceLibrary.h&quot;
+//#include &quot;Interface/SAIInterfaceLibrary.h&quot;
 #include &quot;LogOutput.h&quot;
+#include &quot;IAILibraryManager.h&quot;
 #include &lt;string&gt;
 
 CSkirmishAILibrary::CSkirmishAILibrary(const SSAILibrary&amp; ai,
-		const SSAISpecifier&amp; specifier,
-		const struct InfoItem p_info[], unsigned int numInfoItems)
-		: sSAI(ai), specifier(specifier), numInfoItems(numInfoItems) {
+		const SSAIKey&amp; key)
+		: sSAI(ai), key(key) {}
 
-	struct InfoItem* tmpInfo = (struct InfoItem*) calloc(numInfoItems, sizeof(struct InfoItem));
-	unsigned int i;
-    for (i=0; i &lt; numInfoItems; ++i) {
-        tmpInfo[i] = copyInfoItem(&amp;(p_info[i]));
-    }
-	info = tmpInfo;
-}
+CSkirmishAILibrary::~CSkirmishAILibrary() {}
 
-CSkirmishAILibrary::~CSkirmishAILibrary() {
-
-	unsigned int i;
-    for (i=0; i &lt; numInfoItems; ++i) {
-        deleteInfoItem(&amp;(info[i]));
-    }
-	free(const_cast&lt;struct InfoItem*&gt;(info));
-}
-	
 SSAISpecifier CSkirmishAILibrary::GetSpecifier() const {
-	return specifier;
+	return key.ai;
 }
+SSAIKey CSkirmishAILibrary::GetKey() const {
+	return key;
+}
 
 LevelOfSupport CSkirmishAILibrary::GetLevelOfSupportFor(int teamId,
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 		const SAIInterfaceSpecifier&amp; interfaceSpecifier) const {
-	
+
 	if (sSAI.getLevelOfSupportFor != NULL) {
 		return sSAI.getLevelOfSupportFor(teamId, engineVersionString.c_str(),
 				engineVersionNumber, interfaceSpecifier.shortName,
@@ -59,48 +47,24 @@
 		return LOS_Unknown;
 	}
 }
-	
-/*
-std::map&lt;std::string, InfoItem&gt; CSkirmishAILibrary::GetInfo(unsigned int teamId) const {
-	
-	std::map&lt;std::string, InfoItem&gt; info;
-	
-	if (sSAI.getInfo != NULL) {
-		InfoItem infs[MAX_INFOS];
-		int num = sSAI.getInfo(teamId, infs, MAX_INFOS);
 
-		int i;
-		for (i=0; i &lt; num; ++i) {
-			InfoItem newII = copyInfoItem(&amp;infs[i]);
-			info[std::string(newII.key)] = newII;
-		}
-	}
+void CSkirmishAILibrary::Init(int teamId) const {
 
-	return info;
-}
-std::vector&lt;Option&gt; CSkirmishAILibrary::GetOptions(unsigned int teamId) const {
-	
-	std::vector&lt;Option&gt; ops;
-	
-	if (sSAI.getOptions != NULL) {
-		Option options[MAX_OPTIONS];
-		int num = sSAI.getOptions(teamId, options, MAX_OPTIONS);
+	if (sSAI.init != NULL) {
+		const IAILibraryManager* libMan = IAILibraryManager::GetInstance();
+		const CSkirmishAILibraryInfo* skiInf = libMan-&gt;GetSkirmishAIInfos().find(key)-&gt;second;
 
-		int i;
-		for (i=0; i &lt; num; ++i) {
-			ops.push_back(options[i]);
-		}
-	}
+		unsigned int infSize = skiInf-&gt;GetInfo().size();
+		const char** infKeys = skiInf-&gt;GetCInfoKeys();
+		const char** infValues = skiInf-&gt;GetCInfoValues();
 
-	return ops;
-}
-*/
+		unsigned int optSize = libMan-&gt;GetSkirmishAICOptionSize(teamId);
+		const char** optKeys = libMan-&gt;GetSkirmishAICOptionKeys(teamId);
+		const char** optValues = libMan-&gt;GetSkirmishAICOptionValues(teamId);
 
-
-void CSkirmishAILibrary::Init(int teamId) const {
-	
-	if (sSAI.init != NULL) {
-		int error = sSAI.init(teamId, info, numInfoItems);
+		int error = sSAI.init(teamId,
+				infSize, infKeys, infValues,
+				optSize, optKeys, optValues);
 		if (error != 0) {
 			// init failed
 			logOutput.Print(&quot;Failed to initialize an AI for team %d, error: %d&quot;, teamId, error);
@@ -109,7 +73,7 @@
 }
 
 void CSkirmishAILibrary::Release(int teamId) const {
-	
+
 	if (sSAI.release != NULL) {
 		int error = sSAI.release(teamId);
 		if (error != 0) {

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -1,6 +1,6 @@
 /*
 	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-	
+
 	This program is free software; you can redistribute it and/or modify
 	it under the terms of the GNU General Public License as published by
 	the Free Software Foundation; either version 2 of the License, or
@@ -20,15 +20,18 @@
 
 #include &quot;ISkirmishAILibrary.h&quot;
 
+#include &quot;Interface/SAIInterfaceLibrary.h&quot;
 #include &quot;Interface/SSAILibrary.h&quot;
+#include &lt;vector&gt;
 
 class CSkirmishAILibrary : public ISkirmishAILibrary {
 public:
-	CSkirmishAILibrary(const SSAILibrary&amp; ai, const SSAISpecifier&amp; specifier,
-			const InfoItem info[], unsigned int numInfoItems);
+	CSkirmishAILibrary(const SSAILibrary&amp; ai, const SSAIKey&amp; key);
 	virtual ~CSkirmishAILibrary();
-	
+
 	virtual SSAISpecifier GetSpecifier() const;
+	virtual SSAIKey GetKey() const;
+
 	/**
 	 * Level of Support for a specific engine version and ai interface.
 	 * @return see enum LevelOfSupport (higher values could be used optionally)
@@ -36,26 +39,18 @@
 	virtual LevelOfSupport GetLevelOfSupportFor(int teamId,
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 			const SAIInterfaceSpecifier&amp; interfaceSpecifier) const;
-	
-//    virtual std::map&lt;std::string, InfoItem&gt; GetInfo(int teamId) const;
-//	virtual std::vector&lt;Option&gt; GetOptions(int teamId) const;
-	
-	
-    virtual void Init(int teamId) const;
-    virtual void Release(int teamId) const;
-    virtual int HandleEvent(int teamId, int topic, const void* data) const;
-	
+
+	virtual void Init(int teamId) const;
+	virtual void Release(int teamId) const;
+	virtual int HandleEvent(int teamId, int topic, const void* data) const;
+
 private:
 	SSAILibrary sSAI;
-	SSAISpecifier specifier;
-	const InfoItem* info;
-	unsigned int numInfoItems;
-	
+	SSAIKey key;
+
 private:
-//	void reportInterfaceFunctionError(const std::string* libFileName, const std::string* functionName);
-	
 	static const int MAX_INFOS = 128;
 	static const int MAX_OPTIONS = 128;
 };
 
-#endif	/* _SKIRMISHAILIBRARY_H */
+#endif // _SKIRMISHAILIBRARY_H

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -26,7 +26,8 @@
 #include &quot;FileSystem/VFSModes.h&quot;
 
 CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(
-		const CSkirmishAILibraryInfo&amp; aiInfo) {
+		const CSkirmishAILibraryInfo&amp; aiInfo)
+		: infoKeys_c(NULL), infoValues_c(NULL) {
 
 	info = std::map&lt;std::string, InfoItem&gt;(
 			aiInfo.info.begin(),
@@ -43,7 +44,8 @@
 
 CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(
 		const std::string&amp; aiInfoFile,
-		const std::string&amp; aiOptionFile) {
+		const std::string&amp; aiOptionFile)
+		: infoKeys_c(NULL), infoValues_c(NULL) {
 
 	InfoItem tmpInfo[MAX_INFOS];
 	unsigned int num = ParseInfo(aiInfoFile.c_str(), SPRING_VFS_RAW,
@@ -64,6 +66,7 @@
 
 CSkirmishAILibraryInfo::~CSkirmishAILibraryInfo() {
 
+	FreeCReferences();
 	std::map&lt;std::string, InfoItem&gt;::const_iterator iip;
 	for (iip = info.begin(); iip != info.begin(); ++iip) {
 		deleteInfoItem(&amp;(iip-&gt;second));
@@ -108,41 +111,64 @@
 std::string CSkirmishAILibraryInfo::GetInfo(const std::string&amp; key) const {
 	return info.at(key).value;
 }
-const std::map&lt;std::string, InfoItem&gt;* CSkirmishAILibraryInfo::GetInfo() const {
-	return &info;
+const std::map&lt;std::string, InfoItem&gt;&amp; CSkirmishAILibraryInfo::GetInfo() const {
+	return info;
 }
 
-const std::vector&lt;Option&gt;* CSkirmishAILibraryInfo::GetOptions() const {
-	return &options;
+const std::vector&lt;Option&gt;&amp; CSkirmishAILibraryInfo::GetOptions() const {
+	return options;
 }
 
 
-unsigned int CSkirmishAILibraryInfo::GetInfoCReference(InfoItem cInfo[],
-		unsigned int maxInfoItems) const {
+//unsigned int CSkirmishAILibraryInfo::GetInfoCReference(InfoItem cInfo[],
+//		unsigned int maxInfoItems) const {
+//
+//	unsigned int i=0;
+//
+//	std::map&lt;std::string, InfoItem&gt;::const_iterator infs;
+//	for (infs=info.begin(); infs != info.end() &amp;&amp; i &lt; maxInfoItems; ++infs) {
+//		cInfo[i++] = infs-&gt;second;
+//	}
+//
+//	return i;
+//}
 
-	unsigned int i=0;
+void CSkirmishAILibraryInfo::CreateCReferences() {
 
-	std::map&lt;std::string, InfoItem&gt;::const_iterator infs;
-	for (infs=info.begin(); infs != info.end() &amp;&amp; i &lt; maxInfoItems; ++infs) {
-		cInfo[i++] = infs-&gt;second;
-	}
+	FreeCReferences();
 
-	return i;
-}
-unsigned int CSkirmishAILibraryInfo::GetOptionsCReference(Option cOptions[],
-		unsigned int maxOptions) const {
-
+//	info_c = (struct InfoItem*) calloc(info.size(), sizeof(struct InfoItem));
+//	unsigned int i=0;
+//	std::map&lt;std::string, InfoItem&gt;::const_iterator ii;
+//	for (ii=info.begin(); ii != info.end(); ++ii) {
+//		info_c[i++] = ii-&gt;second;
+//	}
+	infoKeys_c = (const char**) calloc(info.size(), sizeof(char*));
+	infoValues_c = (const char**) calloc(info.size(), sizeof(char*));
 	unsigned int i=0;
-
-	std::vector&lt;Option&gt;::const_iterator ops;
-	for (ops=options.begin(); ops != options.end() &amp;&amp; i &lt; maxOptions; ++ops) {
-		cOptions[i++] = *ops;
+	std::map&lt;std::string, InfoItem&gt;::const_iterator ii;
+	for (ii=info.begin(); ii != info.end(); ++ii) {
+		infoKeys_c[i] = ii-&gt;second.key;
+		infoValues_c[i] = ii-&gt;second.value;
+		i++;
 	}
+}
+void CSkirmishAILibraryInfo::FreeCReferences() {
 
-	return i;
+	free(infoKeys_c);
+	infoKeys_c = NULL;
+	free(infoValues_c);
+	infoValues_c = NULL;
 }
 
+const char** CSkirmishAILibraryInfo::GetCInfoKeys() const {
+	return infoKeys_c;
+}
+const char** CSkirmishAILibraryInfo::GetCInfoValues() const {
+	return infoValues_c;
+}
 
+
 void CSkirmishAILibraryInfo::SetDataDir(const std::string&amp; dataDir) {
 	SetInfo(SKIRMISH_AI_PROPERTY_DATA_DIR, dataDir);
 }

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -37,6 +37,11 @@
 			const std::string&amp; aiOptionFile);
 	~CSkirmishAILibraryInfo();
 
+	virtual void CreateCReferences();
+private:
+	virtual void FreeCReferences();
+public:
+
 	virtual SSAISpecifier GetSpecifier() const;
 
 	virtual std::string GetDataDir() const;
@@ -49,13 +54,14 @@
 	virtual std::string GetInterfaceShortName() const;
 	virtual std::string GetInterfaceVersion() const;
 	virtual std::string GetInfo(const std::string&amp; key) const;
-	virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
-	virtual unsigned int GetInfoCReference(InfoItem cInfo[],
-			unsigned int maxInfoItems) const;
-	virtual unsigned int GetOptionsCReference(Option cOptions[],
-			unsigned int maxOptions) const;
+	virtual const std::map&lt;std::string, InfoItem&gt;&amp; GetInfo() const;
+//	virtual unsigned int GetInfoCReference(InfoItem cInfo[],
+//			unsigned int maxInfoItems) const;
+//	virtual const struct InfoItem* GetInfoCReference() const;
+	virtual const char** GetCInfoKeys() const;
+	virtual const char** GetCInfoValues() const;
 
-	virtual const std::vector&lt;Option&gt;* GetOptions() const;
+	virtual const std::vector&lt;Option&gt;&amp; GetOptions() const;
 
 	virtual void SetDataDir(const std::string&amp; dataDir);
 	virtual void SetFileName(const std::string&amp; fileName);
@@ -74,6 +80,9 @@
 	static const unsigned int MAX_INFOS = 128;
 	static const unsigned int MAX_OPTIONS = 128;
 	std::map&lt;std::string, InfoItem&gt; info;
+//	struct InfoItem* info_c;
+	const char** infoKeys_c;
+	const char** infoValues_c;
 	std::vector&lt;Option&gt; options;
 };
 

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -32,6 +32,7 @@
 #include &quot;Interface/AISEvents.h&quot;
 #include &quot;Interface/AISCommands.h&quot;
 #include &quot;Interface/SSAILibrary.h&quot;
+#include &quot;SkirmishAILibraryInfo.h&quot;
 
 #include &lt;sstream&gt;
 
@@ -40,13 +41,12 @@
 	CR_MEMBER(teamId),
 	CR_MEMBER(cheatEvents),
 	CR_MEMBER(key),
-	CR_MEMBER(optionKeys),
-	CR_MEMBER(optionValues),
-/*
-	CR_MEMBER(libName),
-	CR_MEMBER(IsCInterface),
-	CR_MEMBER(IsLoadSupported),
-*/
+//	CR_MEMBER(options),
+//	CR_MEMBER(optionKeys),
+//	CR_MEMBER(optionValues),
+//	CR_MEMBER(libName),
+//	CR_MEMBER(IsCInterface),
+//	CR_MEMBER(IsLoadSupported),
 	CR_SERIALIZER(Serialize),
 	CR_POSTLOAD(PostLoad)
 ));
@@ -72,16 +72,9 @@
 	}
 
 
-CSkirmishAIWrapper::CSkirmishAIWrapper(int teamId, const SSAIKey&amp; key,
-		const std::map&lt;std::string, std::string&gt;&amp; options)
+CSkirmishAIWrapper::CSkirmishAIWrapper(int teamId, const SSAIKey&amp; key)
 		: teamId(teamId), cheatEvents(false), key(key) {
 
-	std::map&lt;std::string, std::string&gt;::const_iterator op;
-	for (op = options.begin(); op != options.end(); ++op) {
-		optionKeys.push_back(op-&gt;first);
-		optionValues.push_back(op-&gt;second);
-	}
-
 	LoadSkirmishAI(false);
 
 	Init();
@@ -117,7 +110,7 @@
 	IAILibraryManager* libManager = IAILibraryManager::GetInstance();
 	libManager-&gt;FetchSkirmishAILibrary(key);
 	const CSkirmishAILibraryInfo* infos =
-			libManager-&gt;GetSkirmishAIInfos()-&gt;at(key);
+			libManager-&gt;GetSkirmishAIInfos().at(key);
 	bool loadSupported =
 			infos-&gt;GetInfo(SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED) == &quot;yes&quot;;
 	libManager-&gt;ReleaseSkirmishAILibrary(key);
@@ -158,39 +151,36 @@
 	}
 }
 
-static const char** allocCStrArray(std::vector&lt;std::string&gt; strVec) {
 
-	const char** strArr = NULL;
-
-	unsigned int size = strVec.size();
-	strArr = (const char**) calloc(size, sizeof(char*));
-	unsigned int i;
-	for (i = 0; i &lt; size; ++i) {
-		strArr[i] = strVec[i].c_str();
-	}
-
-	return strArr;
-}
-
 void CSkirmishAIWrapper::Init() {
 
 	callback = SAFE_NEW CGlobalAICallback(this);
 	c_callback = initSAICallback(teamId, callback);
-	optionKeys_c = allocCStrArray(optionKeys);
-	optionValues_c = allocCStrArray(optionValues);
 
-	SInitEvent evtData = {teamId, c_callback, optionKeys.size(), optionKeys_c, optionValues_c};
+	const IAILibraryManager* libMan = IAILibraryManager::GetInstance();
+	const CSkirmishAILibraryInfo* skiInf = libMan-&gt;GetSkirmishAIInfos().find(key)-&gt;second;
+
+//	unsigned int sizeInfo = skiInf-&gt;GetInfo().size();
+//	const struct InfoItem* info = skiInf-&gt;GetInfoCReference();
+	unsigned int infSize = skiInf-&gt;GetInfo().size();
+	const char** infKeys = skiInf-&gt;GetCInfoKeys();
+	const char** infValues = skiInf-&gt;GetCInfoValues();
+
+	unsigned int optSize = libMan-&gt;GetSkirmishAICOptionSize(teamId);
+	const char** optKeys = libMan-&gt;GetSkirmishAICOptionKeys(teamId);
+	const char** optValues = libMan-&gt;GetSkirmishAICOptionValues(teamId);
+
+	SInitEvent evtData = {teamId, c_callback,
+			infSize, infKeys, infValues,
+			optSize, optKeys, optValues};
 	ai-&gt;HandleEvent(EVENT_INIT, &amp;evtData);
 }
 
 void CSkirmishAIWrapper::Release() {
 
-	SReleaseEvent evtData = {teamId};
+	SReleaseEvent evtData = {};
 	ai-&gt;HandleEvent(EVENT_RELEASE, &amp;evtData);
 
-	free(optionKeys_c);
-	free(optionValues_c);
-
 	// further cleanup is done in the destructor
 }
 

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.h	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.h	2008-12-01 19:48:22 UTC (rev 7113)
@@ -35,9 +35,8 @@
 class CSkirmishAIWrapper : public CObject, public ISkirmishAI {
 public:
 	CR_DECLARE(CSkirmishAIWrapper);
-//	CSkirmishAIWrapper();
-	CSkirmishAIWrapper(int teamId, const SSAIKey&amp; key,
-			const std::map&lt;std::string, std::string&gt;&amp; options = (std::map&lt;std::string, std::string&gt;()));
+
+	CSkirmishAIWrapper(int teamId, const SSAIKey&amp; key);
 	~CSkirmishAIWrapper();
 
 	void Serialize(creg::ISerializer *s);
@@ -76,9 +75,8 @@
 	virtual void SetCheatEventsEnabled(bool enable);
 	virtual bool IsCheatEventsEnabled() const;
 
-
 	/**
-	 * inherited form ISkirmishAI.
+	 * inherited from ISkirmishAI.
 	 * CAUTION: takes C AI Interface events, not engine C++ ones!
 	 */
 	virtual int HandleEvent(int topic, const void* data) const;
@@ -91,31 +89,13 @@
 	int teamId;
 	bool cheatEvents;
 
-//	bool loadSupported;
-
 	ISkirmishAI* ai;
 	CGlobalAICallback* callback;
 	SAICallback* c_callback;
 	SSAIKey key;
-	std::vector&lt;std::string&gt; optionKeys;
-	std::vector&lt;std::string&gt; optionValues;
-	const char** optionKeys_c;
-	const char** optionValues_c;
+	const struct InfoItem* info;
+	unsigned int size_info;
 
-//	typedef bool (*ISCINTERFACE)();
-//	typedef int (*GETGLOBALAIVERSION)();
-//	typedef IGlobalAI* (*GETNEWAI)();
-//	typedef IGlobalAI* (*GETNEWAIBYNAME)(const char*, int);
-//	typedef void (*RELEASEAI)(IGlobalAI* i);
-//	typedef bool (*ISLOADSUPPORTED)();
-
-//	ISCINTERFACE _IsCInterfaceFunc;
-//	GETGLOBALAIVERSION _GetGlobalAiVersionFunc;
-//	GETNEWAI _GetNewAIFunc;
-//	GETNEWAIBYNAME _GetNewAIByNameFunc;
-//	RELEASEAI _ReleaseAIFunc;
-//	ISLOADSUPPORTED _IsLoadSupportedFunc;
-
 private:
 	void LoadSkirmishAI(bool postLoad);
 };

Modified: branches/caiinterface/rts/Game/StartScripts/CommanderScript.cpp
===================================================================
--- branches/caiinterface/rts/Game/StartScripts/CommanderScript.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/Game/StartScripts/CommanderScript.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -60,7 +60,7 @@
 		// create a Skirmish AI if required
 		if (!SSAIKey_Comparator::IsEmpty(team-&gt;skirmishAISpecifier) // is an AI specifyed?
 				&amp;&amp; (gu-&gt;myPlayerNum == team-&gt;leader)) {
-			eoh-&gt;CreateSkirmishAI(a, team-&gt;skirmishAISpecifier, team-&gt;skirmishAIOptions);
+			eoh-&gt;CreateSkirmishAI(a, team-&gt;skirmishAISpecifier);
 		}
 
 		// get the team startup info

Modified: branches/caiinterface/rts/Game/StartScripts/ScriptHandler.cpp
===================================================================
--- branches/caiinterface/rts/Game/StartScripts/ScriptHandler.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/Game/StartScripts/ScriptHandler.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -48,11 +48,11 @@
 	loaded_scripts.push_back( SAFE_NEW CSpawnScript(true) );
 	loaded_scripts.push_back( SAFE_NEW CTestScript() );
 
-	const IAILibraryManager::T_skirmishAIKeys* skirmishAIKeys =
+	const IAILibraryManager::T_skirmishAIKeys&amp; skirmishAIKeys =
 			IAILibraryManager::GetInstance()-&gt;GetSkirmishAIKeys();
 	
 	IAILibraryManager::T_skirmishAIKeys::const_iterator ai, e;
-	for(ai=skirmishAIKeys-&gt;begin(), e=skirmishAIKeys-&gt;end(); ai != e; ++ai) {
+	for(ai=skirmishAIKeys.begin(), e=skirmishAIKeys.end(); ai != e; ++ai) {
 		loaded_scripts.push_back(SAFE_NEW CSkirmishAITestScript(*ai));
 	}
 

Modified: branches/caiinterface/rts/Game/StartScripts/SkirmishAITestScript.cpp
===================================================================
--- branches/caiinterface/rts/Game/StartScripts/SkirmishAITestScript.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/Game/StartScripts/SkirmishAITestScript.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -42,7 +42,7 @@
 
 void CSkirmishAITestScript::GameStart(void)
 {
-	eoh-&gt;CreateSkirmishAI(1, key, options);
+	eoh-&gt;CreateSkirmishAI(1, key);
 
 	teamHandler-&gt;Team(0)-&gt;energy        = 1000;
 	teamHandler-&gt;Team(0)-&gt;energyStorage = 1000;

Modified: branches/caiinterface/rts/Sim/Misc/TeamHandler.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Misc/TeamHandler.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/Sim/Misc/TeamHandler.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -99,10 +99,10 @@
 				const char* v = teamStartingData.skirmishAIVersion.empty()
 						? NULL : teamStartingData.skirmishAIVersion.c_str();
 				SSAISpecifier spec = {sn, v};
-				std::vector&lt;SSAIKey&gt; fittingKeys =
+				SSAIKey fittingKey =
 						IAILibraryManager::GetInstance()-&gt;ResolveSkirmishAIKey(spec);
-				if (fittingKeys.size() &gt; 0) {
-					team-&gt;skirmishAISpecifier = fittingKeys[0];
+				if (!SSAIKey_Comparator::IsEmpty(fittingKey)) {
+					team-&gt;skirmishAISpecifier = fittingKey;
 					team-&gt;skirmishAIOptions = teamStartingData.skirmishAIOptions;
 					team-&gt;isAI = true;
 				} else {

Modified: branches/caiinterface/rts/System/Script/LuaFunctions.cpp
===================================================================
--- branches/caiinterface/rts/System/Script/LuaFunctions.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/System/Script/LuaFunctions.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -47,7 +47,11 @@
 	void CreateSkirmishAI(int teamId, const SSAIKey&amp; key,
 			const std::map&lt;std::string, std::string&gt;&amp; options)
 	{
-			eoh-&gt;CreateSkirmishAI(teamId, key, options);
+		teamHandler-&gt;Team(teamId)-&gt;isAI = true;
+		teamHandler-&gt;Team(teamId)-&gt;skirmishAISpecifier = key;
+		teamHandler-&gt;Team(teamId)-&gt;skirmishAIOptions = options;
+		teamHandler-&gt;Team(teamId)-&gt;leader = 0;
+		eoh-&gt;CreateSkirmishAI(teamId, key);
 	}
 
 	void UnitGiveCommand(CObject_pointer&lt;CUnit&gt;* u, Command* c)

Modified: branches/caiinterface/rts/System/SpringApp.cpp
===================================================================
--- branches/caiinterface/rts/System/SpringApp.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/rts/System/SpringApp.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -657,7 +657,7 @@
 	cmdline-&gt;addoption('C', &quot;config&quot;,             OPTPARM_STRING, &quot;&quot;,  &quot;Configuration file&quot;);
 	cmdline-&gt;addoption(0,   &quot;list-ai-interfaces&quot;, OPTPARM_NONE,   &quot;&quot;,  &quot;Dump a list of available AI Interfaces to stdout&quot;);
 	cmdline-&gt;addoption(0,   &quot;list-skirmish-ais&quot;,  OPTPARM_NONE,   &quot;&quot;,  &quot;Dump a list of available Skirmish AIs to stdout&quot;);
-	cmdline-&gt;addoption(0,   &quot;list-group-ais&quot;,     OPTPARM_NONE,   &quot;&quot;,  &quot;Dump a list of available Group AIs to stdout&quot;);
+//	cmdline-&gt;addoption(0,   &quot;list-group-ais&quot;,     OPTPARM_NONE,   &quot;&quot;,  &quot;Dump a list of available Group AIs to stdout&quot;);
 	cmdline-&gt;parse();
 
 	string configSource;
@@ -687,9 +687,9 @@
 	} else if (cmdline-&gt;result(&quot;list-skirmish-ais&quot;)) {
 		IAILibraryManager::OutputSkirmishAIInfo();
 		exit(0);
-	} else if (cmdline-&gt;result(&quot;list-group-ais&quot;)) {
-		IAILibraryManager::OutputGroupAIInfo();
-		exit(0);
+//	} else if (cmdline-&gt;result(&quot;list-group-ais&quot;)) {
+//		IAILibraryManager::OutputGroupAIInfo();
+//		exit(0);
 	}
 
 	// flags

Modified: branches/caiinterface/tools/unitsync/unitsync.cpp
===================================================================
--- branches/caiinterface/tools/unitsync/unitsync.cpp	2008-12-01 19:28:04 UTC (rev 7112)
+++ branches/caiinterface/tools/unitsync/unitsync.cpp	2008-12-01 19:48:22 UTC (rev 7113)
@@ -22,6 +22,8 @@
 #include &quot;Sim/Misc/SideParser.h&quot;
 #include &quot;ExternalAI/Interface/aidefines.h&quot;
 #include &quot;ExternalAI/Interface/SSAILibrary.h&quot;
+#include &quot;ExternalAI/Interface/SInfo.h&quot;
+#include &quot;ExternalAI/Interface/SOption.h&quot;
 #include &quot;System/Exceptions.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &quot;System/Util.h&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001881.html">[Taspring-linux-commit] r7112 - in Lobby/springie/Springie:	autohost spring
</A></li>
	<LI>Next message: <A HREF="001883.html">[Taspring-linux-commit] r7114 - trunk/rts/System/Net
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1882">[ date ]</a>
              <a href="thread.html#1882">[ thread ]</a>
              <a href="subject.html#1882">[ subject ]</a>
              <a href="author.html#1882">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
