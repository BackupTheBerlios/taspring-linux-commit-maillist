<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7525 - in Lobby/TASClient: . Python/scripts
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2010-November/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7525%20-%20in%20Lobby/TASClient%3A%20.%20Python/scripts&In-Reply-To=%3C20101116232516.3FE19234BF%40it-l.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002294.html">
   <LINK REL="Next"  HREF="002296.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7525 - in Lobby/TASClient: . Python/scripts</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7525%20-%20in%20Lobby/TASClient%3A%20.%20Python/scripts&In-Reply-To=%3C20101116232516.3FE19234BF%40it-l.eu%3E"
       TITLE="[Taspring-linux-commit] r7525 - in Lobby/TASClient: . Python/scripts">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Wed Nov 17 00:25:16 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002294.html">[Taspring-linux-commit] r7524 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="002296.html">[Taspring-linux-commit] r7526 - Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2295">[ date ]</a>
              <a href="thread.html#2295">[ thread ]</a>
              <a href="subject.html#2295">[ subject ]</a>
              <a href="author.html#2295">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2010-11-17 00:25:15 +0100 (Wed, 17 Nov 2010)
New Revision: 7525

Modified:
   Lobby/TASClient/AutoJoinFormUnit.dfm
   Lobby/TASClient/AutoJoinFormUnit.pas
   Lobby/TASClient/BotOptionsFormUnit.dfm
   Lobby/TASClient/BotOptionsFormUnit.pas
   Lobby/TASClient/ChannelsListFormUnit.dfm
   Lobby/TASClient/HelpUnit.dfm
   Lobby/TASClient/HelpUnit.pas
   Lobby/TASClient/HighlightingUnit.dfm
   Lobby/TASClient/HighlightingUnit.pas
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/ManageGroups.pas
   Lobby/TASClient/PreferencesFormUnit.dfm
   Lobby/TASClient/PreferencesFormUnit.pas
   Lobby/TASClient/Python/scripts/mapdownload.py
   Lobby/TASClient/SpringDownloaderFormUnit.dfm
   Lobby/TASClient/SpringDownloaderFormUnit.pas
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.res
   Lobby/TASClient/WidgetDBFormUnit.dfm
   Lobby/TASClient/WidgetDBFormUnit.pas
Log:
* removed/updated many old things
* several windows skin display bugs fixed
* the integrated downloader now supports dependencies

Modified: Lobby/TASClient/AutoJoinFormUnit.dfm
===================================================================
--- Lobby/TASClient/AutoJoinFormUnit.dfm	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/AutoJoinFormUnit.dfm	2010-11-16 23:25:15 UTC (rev 7525)
@@ -59,6 +59,7 @@
         TreeOptions.SelectionOptions = [toFullRowSelect]
         OnDrawText = VSTAutoplayPresetListDrawText
         OnGetText = VSTAutoplayPresetListGetText
+        OnPaintText = VSTAutoplayPresetListPaintText
         OnHeaderDraw = VSTAutoplayPresetListHeaderDraw
         Columns = &lt;
           item
@@ -237,6 +238,7 @@
         TreeOptions.SelectionOptions = [toFullRowSelect]
         OnDrawText = VSTAutospecPresetListDrawText
         OnGetText = VSTAutospecPresetListGetText
+        OnPaintText = VSTAutospecPresetListPaintText
         OnHeaderDraw = VSTAutospecPresetListHeaderDraw
         Columns = &lt;
           item

Modified: Lobby/TASClient/AutoJoinFormUnit.pas
===================================================================
--- Lobby/TASClient/AutoJoinFormUnit.pas	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/AutoJoinFormUnit.pas	2010-11-16 23:25:15 UTC (rev 7525)
@@ -83,6 +83,12 @@
     procedure VSTAutospecPresetListHeaderDraw(Sender: TVTHeader;
       HeaderCanvas: TCanvas; Column: TVirtualTreeColumn; R: TRect; Hover,
       Pressed: Boolean; DropMark: TVTDropMarkMode);
+    procedure VSTAutospecPresetListPaintText(Sender: TBaseVirtualTree;
+      const TargetCanvas: TCanvas; Node: PVirtualNode;
+      Column: TColumnIndex; TextType: TVSTTextType);
+    procedure VSTAutoplayPresetListPaintText(Sender: TBaseVirtualTree;
+      const TargetCanvas: TCanvas; Node: PVirtualNode;
+      Column: TColumnIndex; TextType: TVSTTextType);
   private
     { Private declarations }
   public
@@ -455,6 +461,22 @@
   MainForm.VDTBattlesHeaderDraw(Sender,HeaderCanvas,Column,R,Hover,Pressed,DropMark);
 end;
 
+procedure TAutoJoinForm.VSTAutospecPresetListPaintText(
+  Sender: TBaseVirtualTree; const TargetCanvas: TCanvas;
+  Node: PVirtualNode; Column: TColumnIndex; TextType: TVSTTextType);
+begin
+  TargetCanvas.Font.Style := [];
+  inherited;
+end;
+
+procedure TAutoJoinForm.VSTAutoplayPresetListPaintText(
+  Sender: TBaseVirtualTree; const TargetCanvas: TCanvas;
+  Node: PVirtualNode; Column: TColumnIndex; TextType: TVSTTextType);
+begin
+  TargetCanvas.Font.Style := [];
+  inherited;
+end;
+
 end.
 
 

Modified: Lobby/TASClient/BotOptionsFormUnit.dfm
===================================================================
--- Lobby/TASClient/BotOptionsFormUnit.dfm	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/BotOptionsFormUnit.dfm	2010-11-16 23:25:15 UTC (rev 7525)
@@ -1,6 +1,6 @@
 object BotOptionsForm: TBotOptionsForm
-  Left = 325
-  Top = 87
+  Left = 498
+  Top = 356
   Width = 433
   Height = 470
   Caption = 'AIOptions'
@@ -12,7 +12,6 @@
   Font.Style = []
   OldCreateOrder = False
   Position = poMainFormCenter
-  Scaled = False
   OnCreate = FormCreate
   OnShow = FormShow
   PixelsPerInch = 96
@@ -24,113 +23,126 @@
     Height = 443
     Caption = 'AI Options'
     Active = False
-    DesignSize = (
-      425
-      443)
-    object gbGameOptions: TSpTBXGroupBox
-      Left = 8
-      Top = 34
-      Width = 409
-      Height = 71
-      Caption = 'Game options'
-      Anchors = [akLeft, akTop, akRight]
+    object pnlMain: TSpTBXPanel
+      Left = 0
+      Top = 22
+      Width = 425
+      Height = 421
+      Align = alClient
       TabOrder = 1
-      TBXStyleBackground = True
-      object lblId: TSpTBXLabel
+      Borders = False
+      DesignSize = (
+        425
+        421)
+      object gbGameOptions: TSpTBXGroupBox
         Left = 8
-        Top = 22
-        Width = 127
-        Height = 13
-        Caption = 'Id :'
-        AutoSize = False
-        Alignment = taRightJustify
+        Top = 10
+        Width = 409
+        Height = 71
+        Caption = 'Game options'
+        Anchors = [akLeft, akTop, akRight]
+        Font.Charset = DEFAULT_CHARSET
+        Font.Color = clWindowText
+        Font.Height = -11
+        Font.Name = 'MS Sans Serif'
+        Font.Style = []
+        ParentFont = False
+        TabOrder = 0
+        TBXStyleBackground = True
+        object lblId: TSpTBXLabel
+          Left = 8
+          Top = 22
+          Width = 127
+          Height = 13
+          Caption = 'Id :'
+          AutoSize = False
+          Alignment = taRightJustify
+        end
+        object BotTeamButton: TSpTBXSpinEdit
+          Left = 144
+          Top = 18
+          Width = 49
+          Height = 21
+          TabOrder = 1
+          OnExit = BotTeamButtonExit
+          SpinButton.Left = 30
+          SpinButton.Top = 0
+          SpinButton.Width = 15
+          SpinButton.Height = 17
+          SpinButton.Align = alRight
+          SpinOptions.Decimal = 0
+          SpinOptions.MinValue = 1.000000000000000000
+        end
+        object BotSideButton: TSpTBXSpeedButton
+          Left = 200
+          Top = 17
+          Width = 121
+          Height = 22
+          Caption = 'Side'
+          OnClick = BotSideButtonClick
+        end
+        object lblTeam: TSpTBXLabel
+          Left = 8
+          Top = 46
+          Width = 129
+          Height = 13
+          Caption = 'Team :'
+          AutoSize = False
+          Alignment = taRightJustify
+        end
+        object BotAllyButton: TSpTBXSpinEdit
+          Left = 144
+          Top = 42
+          Width = 49
+          Height = 21
+          TabOrder = 4
+          OnExit = BotAllyButtonExit
+          SpinButton.Left = 30
+          SpinButton.Top = 0
+          SpinButton.Width = 15
+          SpinButton.Height = 17
+          SpinButton.Align = alRight
+          SpinOptions.Decimal = 0
+          SpinOptions.MinValue = 1.000000000000000000
+        end
+        object BotTeamColorButton: TSpTBXSpeedButton
+          Left = 200
+          Top = 42
+          Width = 121
+          Height = 21
+          Caption = 'Team color'
+          DropDownMenu = ColorPopupMenu
+          Images = MainForm.ColorImageList
+        end
       end
-      object BotTeamButton: TSpTBXSpinEdit
-        Left = 144
-        Top = 18
-        Width = 49
-        Height = 21
+      object gpOtherOptions: TSpTBXGroupBox
+        Left = 8
+        Top = 88
+        Width = 409
+        Height = 321
+        Caption = 'Other options'
+        Anchors = [akLeft, akTop, akRight, akBottom]
         TabOrder = 1
-        OnExit = BotTeamButtonExit
-        SpinButton.Left = 30
-        SpinButton.Top = 0
-        SpinButton.Width = 15
-        SpinButton.Height = 17
-        SpinButton.Align = alRight
-        SpinOptions.Decimal = 0
-        SpinOptions.MinValue = 1.000000000000000000
-        SpinOptions.Value = 1.000000000000000000
+        object AIOptionsScrollBox: TTntScrollBox
+          Left = 2
+          Top = 15
+          Width = 405
+          Height = 304
+          VertScrollBar.Smooth = True
+          VertScrollBar.Tracking = True
+          Align = alClient
+          BiDiMode = bdLeftToRight
+          BorderStyle = bsNone
+          Color = clBtnFace
+          Ctl3D = False
+          ParentBiDiMode = False
+          ParentBackground = True
+          ParentColor = False
+          ParentCtl3D = False
+          TabOrder = 0
+        end
       end
-      object BotSideButton: TSpTBXSpeedButton
-        Left = 200
-        Top = 17
-        Width = 121
-        Height = 22
-        Caption = 'Side'
-        OnClick = BotSideButtonClick
-      end
-      object lblTeam: TSpTBXLabel
-        Left = 8
-        Top = 46
-        Width = 129
-        Height = 13
-        Caption = 'Team :'
-        AutoSize = False
-        Alignment = taRightJustify
-      end
-      object BotAllyButton: TSpTBXSpinEdit
-        Left = 144
-        Top = 42
-        Width = 49
-        Height = 21
-        TabOrder = 4
-        OnExit = BotAllyButtonExit
-        SpinButton.Left = 30
-        SpinButton.Top = 0
-        SpinButton.Width = 15
-        SpinButton.Height = 17
-        SpinButton.Align = alRight
-        SpinOptions.Decimal = 0
-        SpinOptions.MinValue = 1.000000000000000000
-        SpinOptions.Value = 1.000000000000000000
-      end
-      object BotTeamColorButton: TSpTBXSpeedButton
-        Left = 200
-        Top = 42
-        Width = 121
-        Height = 21
-        Caption = 'Team color'
-        DropDownMenu = ColorPopupMenu
-        Images = MainForm.ColorImageList
-      end
     end
-    object gpOtherOptions: TSpTBXGroupBox
-      Left = 8
-      Top = 113
-      Width = 409
-      Height = 320
-      Caption = 'Other options'
-      Anchors = [akLeft, akTop, akRight, akBottom]
-      TabOrder = 2
-      object AIOptionsScrollBox: TTntScrollBox
-        Left = 2
-        Top = 15
-        Width = 405
-        Height = 303
-        VertScrollBar.Smooth = True
-        VertScrollBar.Tracking = True
-        Align = alClient
-        BiDiMode = bdLeftToRight
-        BorderStyle = bsNone
-        Color = clBtnFace
-        Ctl3D = False
-        ParentBiDiMode = False
-        ParentBackground = True
-        ParentColor = False
-        ParentCtl3D = False
-        TabOrder = 0
-      end
-    end
   end
   object ColorPopupMenu: TSpTBXPopupMenu
     AutoHotkeys = maManual

Modified: Lobby/TASClient/BotOptionsFormUnit.pas
===================================================================
--- Lobby/TASClient/BotOptionsFormUnit.pas	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/BotOptionsFormUnit.pas	2010-11-16 23:25:15 UTC (rev 7525)
@@ -11,6 +11,12 @@
  
   TBotOptionsForm = class(TForm)
     SpTBXTitleBar1: TSpTBXTitleBar;
+    ColorPopupMenu: TSpTBXPopupMenu;
+    mnuTeamColorPalette: TSpTBXColorPalette;
+    mnuTeamColorCustomize: TSpTBXItem;
+    SpTBXSeparatorItem1: TSpTBXSeparatorItem;
+    mnuTeamColorCancel: TSpTBXItem;
+    pnlMain: TSpTBXPanel;
     gbGameOptions: TSpTBXGroupBox;
     lblId: TSpTBXLabel;
     BotTeamButton: TSpTBXSpinEdit;
@@ -18,11 +24,6 @@
     lblTeam: TSpTBXLabel;
     BotAllyButton: TSpTBXSpinEdit;
     BotTeamColorButton: TSpTBXSpeedButton;
-    ColorPopupMenu: TSpTBXPopupMenu;
-    mnuTeamColorPalette: TSpTBXColorPalette;
-    mnuTeamColorCustomize: TSpTBXItem;
-    SpTBXSeparatorItem1: TSpTBXSeparatorItem;
-    mnuTeamColorCancel: TSpTBXItem;
     gpOtherOptions: TSpTBXGroupBox;
     AIOptionsScrollBox: TTntScrollBox;
     procedure FormCreate(Sender: TObject);

Modified: Lobby/TASClient/ChannelsListFormUnit.dfm
===================================================================
--- Lobby/TASClient/ChannelsListFormUnit.dfm	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/ChannelsListFormUnit.dfm	2010-11-16 23:25:15 UTC (rev 7525)
@@ -14,7 +14,6 @@
   Font.Style = []
   OldCreateOrder = False
   Position = poOwnerFormCenter
-  Scaled = False
   OnCreate = FormCreate
   PixelsPerInch = 96
   TextHeight = 13

Modified: Lobby/TASClient/HelpUnit.dfm
===================================================================
--- Lobby/TASClient/HelpUnit.dfm	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/HelpUnit.dfm	2010-11-16 23:25:15 UTC (rev 7525)
@@ -2,7 +2,7 @@
   Left = 282
   Top = 318
   Width = 793
-  Height = 501
+  Height = 506
   Caption = 'Help'
   Color = clBtnFace
   Constraints.MaxHeight = 1150
@@ -22,7 +22,7 @@
     Left = 0
     Top = 0
     Width = 785
-    Height = 474
+    Height = 479
     Caption = 'Help'
     Active = False
     FixedSize = True
@@ -30,21 +30,24 @@
     Options.Maximize = False
     object PageControl1: TSpTBXTabControl
       Left = 0
-      Top = 22
+      Top = 24
       Width = 785
-      Height = 401
-      Align = alTop
+      Height = 417
       ActiveTabIndex = 0
       HiddenItems = &lt;&gt;
       object SpTBXTabItem3: TSpTBXTabItem
-        Caption = 'Page 1'
+        Caption = 'Icons and Shortcuts'
         Checked = True
+        CustomHeight = 35
+        FontSettings.Style = [fsBold]
       end
       object SpTBXTabItem2: TSpTBXTabItem
-        Caption = 'Page 2'
+        Caption = 'Ranks'
+        FontSettings.Style = [fsBold]
       end
       object SpTBXTabItem1: TSpTBXTabItem
-        Caption = 'Page 3'
+        Caption = 'Tips and commands'
+        FontSettings.Style = [fsBold]
       end
       object SpTBXTabItem4: TSpTBXTabItem
         Caption = 'Page 4'
@@ -52,7 +55,7 @@
       end
       object SpTBXTabSheet4: TSpTBXTabSheet
         Left = 0
-        Top = 23
+        Top = 39
         Width = 785
         Height = 378
         Caption = 'Page 4'
@@ -269,252 +272,12 @@
           Wrapping = twWrap
         end
       end
-      object SpTBXTabSheet1: TSpTBXTabSheet
-        Left = 0
-        Top = 23
-        Width = 785
-        Height = 378
-        Caption = 'Page 3'
-        ImageIndex = -1
-        TabItem = 'SpTBXTabItem1'
-        object TntScrollBox1: TTntScrollBox
-          Left = 2
-          Top = 0
-          Width = 781
-          Height = 376
-          HorzScrollBar.Range = 408
-          VertScrollBar.Range = 480
-          VertScrollBar.Smooth = True
-          Align = alClient
-          AutoScroll = False
-          BorderStyle = bsNone
-          ParentBackground = True
-          TabOrder = 0
-          object Label18: TSpTBXLabel
-            Left = 0
-            Top = 0
-            Width = 52
-            Height = 13
-            Caption = 'Useful tips:'
-          end
-          object Label19: TSpTBXLabel
-            Left = 0
-            Top = 16
-            Width = 259
-            Height = 13
-            Caption = '* Right-click on a channel or private chat tab to close it'
-          end
-          object Label20: TSpTBXLabel
-            Left = 0
-            Top = 32
-            Width = 318
-            Height = 13
-            Caption = 
-              '* Double on the player to open private chat (in the list or in t' +
-              'he chat)'
-          end
-          object Label21: TSpTBXLabel
-            Left = 0
-            Top = 48
-            Width = 233
-            Height = 13
-            Caption = '* Double-click or click on Join button to join battle'
-          end
-          object Label34: TSpTBXLabel
-            Left = 0
-            Top = 64
-            Width = 203
-            Height = 13
-            Caption = '* Double-click on bot to change his options'
-          end
-          object Label22: TSpTBXLabel
-            Left = 0
-            Top = 80
-            Width = 215
-            Height = 13
-            Caption = '* Click on minimap to view fixed start positions'
-          end
-          object Label23: TSpTBXLabel
-            Left = 0
-            Top = 96
-            Width = 334
-            Height = 13
-            Caption = 
-              '* Right click on the minimap to get options like auto boxes or k' +
-              'eep ratio'
-          end
-          object Label24: TSpTBXLabel
-            Left = 0
-            Top = 128
-            Width = 87
-            Height = 13
-            Caption = 'Useful commands:'
-          end
-          object Label25: TSpTBXLabel
-            Left = 0
-            Top = 152
-            Width = 154
-            Height = 13
-            Caption = '* /me to talk in &quot;/me&quot; mIRC style'
-          end
-          object Label26: TSpTBXLabel
-            Left = 0
-            Top = 168
-            Width = 211
-            Height = 13
-            Caption = '* /join or /j (+channel'#39's name) to join channel'
-          end
-          object Label27: TSpTBXLabel
-            Left = 0
-            Top = 184
-            Width = 283
-            Height = 13
-            Caption = '* /part or /p to close current channel or private chat window'
-          end
-          object Label28: TSpTBXLabel
-            Left = 0
-            Top = 200
-            Width = 246
-            Height = 13
-            Caption = '* /channels or /list to receive a list of open channels'
-          end
-          object Label67: TSpTBXLabel
-            Left = 0
-            Top = 216
-            Width = 283
-            Height = 13
-            Caption = '* /rename &lt;new name&gt; to change your account'#39's username'
-          end
-          object SpTBXLabel1: TSpTBXLabel
-            Left = 0
-            Top = 232
-            Width = 334
-            Height = 13
-            Caption = 
-              '* /password &lt;oldpass&gt; &lt;newpass&gt; will change your account passwor' +
-              'd'
-          end
-          object Label68: TSpTBXLabel
-            Left = 0
-            Top = 248
-            Width = 202
-            Height = 13
-            Caption = '* /ring while hosting a battle to call a player'
-          end
-          object Label44: TSpTBXLabel
-            Left = 0
-            Top = 264
-            Width = 283
-            Height = 13
-            Caption = '* /ping will tell you the lag between you and the lobby server'
-          end
-          object Label69: TSpTBXLabel
-            Left = 0
-            Top = 280
-            Width = 242
-            Height = 13
-            Caption = '* /msg &lt;user&gt; {message} will send message to user'
-          end
-          object Label70: TSpTBXLabel
-            Left = 0
-            Top = 296
-            Width = 295
-            Height = 13
-            Caption = 
-              '* /ignore [&lt;user&gt;] will add &lt;user&gt; to ignore list and open the l' +
-              'ist'
-          end
-          object Label72: TSpTBXLabel
-            Left = 0
-            Top = 312
-            Width = 236
-            Height = 13
-            Caption = '* /mutelist &lt;channel&gt; will return channel'#39's mute list'
-          end
-          object SpTBXLabel4: TSpTBXLabel
-            Left = 0
-            Top = 328
-            Width = 265
-            Height = 13
-            Caption = '* /ingame will return your total amount of ingame minutes'
-          end
-          object SpTBXLabel18: TSpTBXLabel
-            Left = 0
-            Top = 344
-            Width = 408
-            Height = 13
-            Caption = 
-              '* /forceupdate /forcebetaupdate will force the lobby update even' +
-              ' if it seems up to date'
-          end
-          object SpTBXLabel19: TSpTBXLabel
-            Left = 0
-            Top = 360
-            Width = 122
-            Height = 13
-            Caption = '* /help  will show this help'
-          end
-          object SpTBXLabel20: TSpTBXLabel
-            Left = 0
-            Top = 376
-            Width = 180
-            Height = 13
-            Caption = '* /uptime will tell you the server uptime'
-          end
-          object SpTBXLabel21: TSpTBXLabel
-            Left = 0
-            Top = 392
-            Width = 292
-            Height = 13
-            Caption = 
-              '* /version will tell you the TASClient lobby version and revisio' +
-              'n'
-          end
-          object SpTBXLabel22: TSpTBXLabel
-            Left = 0
-            Top = 408
-            Width = 326
-            Height = 13
-            Caption = 
-              '* /scriptsdebugwindow will show the pythong scripting debug wind' +
-              'ow'
-          end
-          object SpTBXLabel23: TSpTBXLabel
-            Left = 0
-            Top = 422
-            Width = 664
-            Height = 13
-            Caption = 
-              '* /forcestart will simulate a game start event (either to try to' +
-              ' rejoin a game already started or to force a game start even if ' +
-              'players are not ready)'
-          end
-          object SpTBXLabel24: TSpTBXLabel
-            Left = 0
-            Top = 436
-            Width = 494
-            Height = 13
-            Caption = 
-              '* /isspadsautohost to tell the lobby the current host is a spads' +
-              ' autohost (and show the autohost interface)'
-          end
-          object SpTBXLabel25: TSpTBXLabel
-            Left = 0
-            Top = 452
-            Width = 510
-            Height = 13
-            Caption = 
-              '* /isspringieautohost to tell the lobby the current host is a sp' +
-              'ringie autohost (and show the autohost interface)'
-          end
-        end
-      end
       object SpTBXTabSheet2: TSpTBXTabSheet
         Left = 0
-        Top = 23
+        Top = 39
         Width = 785
         Height = 378
-        Caption = 'Page 2'
+        Caption = 'Ranks'
         ImageIndex = -1
         TabItem = 'SpTBXTabItem2'
         object Image5: TImage
@@ -868,21 +631,6 @@
           Height = 13
           Caption = 'Highly experienced'
         end
-        object Label58: TSpTBXLabel
-          Left = 32
-          Top = 264
-          Width = 329
-          Height = 105
-          Caption = 
-            'Tip: Hold down SHIFT while dragging over the small minimap when ' +
-            'hosting a game to set start rectangles. Press 0...9 to change hi' +
-            'ghlighted rectangle'#39's ally number, and DELETE to remove it. To s' +
-            'et the starting rectangles automatically, right-click on the min' +
-            'imap and select this option. To move a box hold down CTRL and dr' +
-            'ag it.'
-          AutoSize = False
-          Wrapping = twWrap
-        end
         object Label50: TSpTBXLabel
           Left = 392
           Top = 232
@@ -993,12 +741,252 @@
           Caption = '&gt; 3000 h = ghost'
         end
       end
+      object SpTBXTabSheet1: TSpTBXTabSheet
+        Left = 0
+        Top = 39
+        Width = 785
+        Height = 378
+        Caption = 'Tips and commands'
+        ImageIndex = -1
+        TabItem = 'SpTBXTabItem1'
+        object TntScrollBox1: TTntScrollBox
+          Left = 2
+          Top = 0
+          Width = 781
+          Height = 376
+          HorzScrollBar.Range = 408
+          VertScrollBar.Range = 480
+          VertScrollBar.Smooth = True
+          Align = alClient
+          AutoScroll = False
+          BorderStyle = bsNone
+          ParentBackground = True
+          TabOrder = 0
+          object Label18: TSpTBXLabel
+            Left = 0
+            Top = 0
+            Width = 52
+            Height = 13
+            Caption = 'Useful tips:'
+          end
+          object Label19: TSpTBXLabel
+            Left = 0
+            Top = 16
+            Width = 259
+            Height = 13
+            Caption = '* Right-click on a channel or private chat tab to close it'
+          end
+          object Label20: TSpTBXLabel
+            Left = 0
+            Top = 32
+            Width = 318
+            Height = 13
+            Caption = 
+              '* Double on the player to open private chat (in the list or in t' +
+              'he chat)'
+          end
+          object Label21: TSpTBXLabel
+            Left = 0
+            Top = 48
+            Width = 233
+            Height = 13
+            Caption = '* Double-click or click on Join button to join battle'
+          end
+          object Label34: TSpTBXLabel
+            Left = 0
+            Top = 64
+            Width = 203
+            Height = 13
+            Caption = '* Double-click on bot to change his options'
+          end
+          object Label22: TSpTBXLabel
+            Left = 0
+            Top = 80
+            Width = 215
+            Height = 13
+            Caption = '* Click on minimap to view fixed start positions'
+          end
+          object Label23: TSpTBXLabel
+            Left = 0
+            Top = 96
+            Width = 334
+            Height = 13
+            Caption = 
+              '* Right click on the minimap to get options like auto boxes or k' +
+              'eep ratio'
+          end
+          object Label24: TSpTBXLabel
+            Left = 0
+            Top = 128
+            Width = 87
+            Height = 13
+            Caption = 'Useful commands:'
+          end
+          object Label25: TSpTBXLabel
+            Left = 0
+            Top = 152
+            Width = 154
+            Height = 13
+            Caption = '* /me to talk in &quot;/me&quot; mIRC style'
+          end
+          object Label26: TSpTBXLabel
+            Left = 0
+            Top = 168
+            Width = 211
+            Height = 13
+            Caption = '* /join or /j (+channel'#39's name) to join channel'
+          end
+          object Label27: TSpTBXLabel
+            Left = 0
+            Top = 184
+            Width = 283
+            Height = 13
+            Caption = '* /part or /p to close current channel or private chat window'
+          end
+          object Label28: TSpTBXLabel
+            Left = 0
+            Top = 200
+            Width = 246
+            Height = 13
+            Caption = '* /channels or /list to receive a list of open channels'
+          end
+          object Label67: TSpTBXLabel
+            Left = 0
+            Top = 216
+            Width = 283
+            Height = 13
+            Caption = '* /rename &lt;new name&gt; to change your account'#39's username'
+          end
+          object SpTBXLabel1: TSpTBXLabel
+            Left = 0
+            Top = 232
+            Width = 334
+            Height = 13
+            Caption = 
+              '* /password &lt;oldpass&gt; &lt;newpass&gt; will change your account passwor' +
+              'd'
+          end
+          object Label68: TSpTBXLabel
+            Left = 0
+            Top = 248
+            Width = 202
+            Height = 13
+            Caption = '* /ring while hosting a battle to call a player'
+          end
+          object Label44: TSpTBXLabel
+            Left = 0
+            Top = 264
+            Width = 283
+            Height = 13
+            Caption = '* /ping will tell you the lag between you and the lobby server'
+          end
+          object Label69: TSpTBXLabel
+            Left = 0
+            Top = 280
+            Width = 242
+            Height = 13
+            Caption = '* /msg &lt;user&gt; {message} will send message to user'
+          end
+          object Label70: TSpTBXLabel
+            Left = 0
+            Top = 296
+            Width = 295
+            Height = 13
+            Caption = 
+              '* /ignore [&lt;user&gt;] will add &lt;user&gt; to ignore list and open the l' +
+              'ist'
+          end
+          object Label72: TSpTBXLabel
+            Left = 0
+            Top = 312
+            Width = 236
+            Height = 13
+            Caption = '* /mutelist &lt;channel&gt; will return channel'#39's mute list'
+          end
+          object SpTBXLabel4: TSpTBXLabel
+            Left = 0
+            Top = 328
+            Width = 265
+            Height = 13
+            Caption = '* /ingame will return your total amount of ingame minutes'
+          end
+          object SpTBXLabel18: TSpTBXLabel
+            Left = 0
+            Top = 344
+            Width = 408
+            Height = 13
+            Caption = 
+              '* /forceupdate /forcebetaupdate will force the lobby update even' +
+              ' if it seems up to date'
+          end
+          object SpTBXLabel19: TSpTBXLabel
+            Left = 0
+            Top = 360
+            Width = 122
+            Height = 13
+            Caption = '* /help  will show this help'
+          end
+          object SpTBXLabel20: TSpTBXLabel
+            Left = 0
+            Top = 376
+            Width = 180
+            Height = 13
+            Caption = '* /uptime will tell you the server uptime'
+          end
+          object SpTBXLabel21: TSpTBXLabel
+            Left = 0
+            Top = 392
+            Width = 292
+            Height = 13
+            Caption = 
+              '* /version will tell you the TASClient lobby version and revisio' +
+              'n'
+          end
+          object SpTBXLabel22: TSpTBXLabel
+            Left = 0
+            Top = 408
+            Width = 326
+            Height = 13
+            Caption = 
+              '* /scriptsdebugwindow will show the pythong scripting debug wind' +
+              'ow'
+          end
+          object SpTBXLabel23: TSpTBXLabel
+            Left = 0
+            Top = 422
+            Width = 664
+            Height = 13
+            Caption = 
+              '* /forcestart will simulate a game start event (either to try to' +
+              ' rejoin a game already started or to force a game start even if ' +
+              'players are not ready)'
+          end
+          object SpTBXLabel24: TSpTBXLabel
+            Left = 0
+            Top = 436
+            Width = 494
+            Height = 13
+            Caption = 
+              '* /isspadsautohost to tell the lobby the current host is a spads' +
+              ' autohost (and show the autohost interface)'
+          end
+          object SpTBXLabel25: TSpTBXLabel
+            Left = 0
+            Top = 452
+            Width = 510
+            Height = 13
+            Caption = 
+              '* /isspringieautohost to tell the lobby the current host is a sp' +
+              'ringie autohost (and show the autohost interface)'
+          end
+        end
+      end
       object SpTBXTabSheet3: TSpTBXTabSheet
         Left = 0
-        Top = 23
+        Top = 39
         Width = 785
         Height = 378
-        Caption = 'Page 1'
+        Caption = 'Icons and Shortcuts'
         ImageIndex = -1
         TabItem = 'SpTBXTabItem3'
         object Image1: TImage
@@ -1112,9 +1100,8 @@
         object Image2: TImage
           Left = 32
           Top = 152
-          Width = 64
+          Width = 41
           Height = 86
-          AutoSize = True
           Picture.Data = {
             07544269746D6170B6400000424DB64000000000000036000000280000004000
             000056000000010018000000000080400000120B0000120B0000000000000000
@@ -2329,21 +2316,21 @@
           Caption = 'Battle status icons:'
         end
         object Label5: TSpTBXLabel
-          Left = 104
+          Left = 80
           Top = 152
           Width = 64
           Height = 13
           Caption = 'Battle is open'
         end
         object Label6: TSpTBXLabel
-          Left = 104
+          Left = 80
           Top = 168
           Width = 169
           Height = 13
           Caption = 'Battle is full (spectators may still join)'
         end
         object Label7: TSpTBXLabel
-          Left = 104
+          Left = 80
           Top = 184
           Width = 117
           Height = 13
@@ -2495,6 +2482,7 @@
           Width = 62
           Height = 13
           Caption = 'Ladder battle'
+          Visible = False
         end
         object SpTBXLabel5: TSpTBXLabel
           Left = 400
@@ -2523,7 +2511,7 @@
     end
     object Button3: TSpTBXButton
       Left = 444
-      Top = 440
+      Top = 448
       Width = 41
       Height = 25
       Caption = '&gt;&gt;'
@@ -2532,7 +2520,7 @@
     end
     object Button1: TSpTBXButton
       Left = 356
-      Top = 440
+      Top = 448
       Width = 75
       Height = 25
       Caption = 'Close'
@@ -2543,7 +2531,7 @@
     end
     object Button2: TSpTBXButton
       Left = 300
-      Top = 440
+      Top = 448
       Width = 43
       Height = 25
       Caption = '&lt;&lt;'

Modified: Lobby/TASClient/HelpUnit.pas
===================================================================
--- Lobby/TASClient/HelpUnit.pas	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/HelpUnit.pas	2010-11-16 23:25:15 UTC (rev 7525)
@@ -66,7 +66,6 @@
     Label37: TSpTBXLabel;
     Label38: TSpTBXLabel;
     Label39: TSpTBXLabel;
-    Label58: TSpTBXLabel;
     Label50: TSpTBXLabel;
     Label45: TSpTBXLabel;
     Label46: TSpTBXLabel;

Modified: Lobby/TASClient/HighlightingUnit.dfm
===================================================================
--- Lobby/TASClient/HighlightingUnit.dfm	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/HighlightingUnit.dfm	2010-11-16 23:25:15 UTC (rev 7525)
@@ -1,10 +1,9 @@
 object HighlightingForm: THighlightingForm
   Left = 623
   Top = 169
-  BorderStyle = bsDialog
+  Width = 404
+  Height = 396
   Caption = 'Highlights manager'
-  ClientHeight = 392
-  ClientWidth = 396
   Color = clBtnFace
   Constraints.MaxHeight = 750
   Constraints.MaxWidth = 1280
@@ -24,14 +23,15 @@
     Left = 0
     Top = 0
     Width = 396
-    Height = 392
+    Height = 369
     Caption = 'Highlights manager'
     Active = False
+    FixedSize = True
     Options.Minimize = False
     Options.Maximize = False
     object Image1: TImage
       Left = 21
-      Top = 52
+      Top = 36
       Width = 31
       Height = 18
       AutoSize = True
@@ -97,14 +97,14 @@
     end
     object Label1: TSpTBXLabel
       Left = 16
-      Top = 298
+      Top = 282
       Width = 65
       Height = 13
       Caption = 'Add keyword:'
     end
     object AddButton: TSpTBXSpeedButton
       Left = 280
-      Top = 296
+      Top = 280
       Width = 97
       Height = 22
       Caption = 'Add'
@@ -112,28 +112,30 @@
     end
     object Label2: TSpTBXLabel
       Left = 56
-      Top = 46
+      Top = 30
       Width = 126
       Height = 13
       Caption = 'is keyword case-sensitive?'
     end
     object Label3: TSpTBXLabel
       Left = 16
-      Top = 325
+      Top = 309
       Width = 215
       Height = 13
       Caption = '(To remove item, select it and press DELETE)'
     end
     object Label4: TSpTBXLabel
       Left = 16
-      Top = 232
-      Width = 70
+      Top = 214
+      Width = 265
       Height = 13
       Caption = 'Highlight color:'
+      AutoSize = False
+      Alignment = taRightJustify
     end
     object CloseButton: TSpTBXButton
       Left = 157
-      Top = 352
+      Top = 336
       Width = 75
       Height = 25
       Caption = 'Close'
@@ -143,7 +145,7 @@
     end
     object HighlightsCheckListBox: TSpTBXCheckListBox
       Left = 16
-      Top = 72
+      Top = 56
       Width = 361
       Height = 153
       ItemHeight = 13
@@ -152,14 +154,14 @@
     end
     object KeywordEdit: TSpTBXEdit
       Left = 136
-      Top = 296
+      Top = 280
       Width = 137
       Height = 21
       TabOrder = 8
     end
     object UseNotificationsCheckBox: TSpTBXCheckBox
       Left = 16
-      Top = 260
+      Top = 244
       Width = 203
       Height = 15
       Hint = 
@@ -172,37 +174,24 @@
       Checked = True
       State = cbChecked
     end
-    object JvColorComboBox1: TJvColorComboBox
-      Left = 240
-      Top = 232
-      Width = 137
-      Height = 22
-      ColorNameMap.Strings = (
-        'clBlack=Black'
-        'clMaroon=Maroon'
-        'clGreen=Green'
-        'clOlive=Olive green'
-        'clNavy=Navy blue'
-        'clPurple=Purple'
-        'clTeal=Teal'
-        'clGray=Gray'
-        'clSilver=Silver'
-        'clRed=Red'
-        'clLime=Lime'
-        'clYellow=Yellow'
-        'clBlue=Blue'
-        'clFuchsia=Fuchsia'
-        'clAqua=Aqua'
-        'clWhite=White'
-        'clMoneyGreen=Money green'
-        'clSkyBlue=Sky blue'
-        'clCream=Cream'
-        'clMedGray=Medium gray')
-      ColorValue = clGreen
-      ColorDialogText = 'Custom...'
-      DroppedDownWidth = 137
-      NewColorText = 'Custom'
+    object HightlightColorPanel: TPanel
+      Left = 293
+      Top = 211
+      Width = 57
+      Height = 21
+      BevelOuter = bvNone
+      BorderStyle = bsSingle
+      Color = clGreen
       TabOrder = 10
     end
+    object PickColorButton: TSpTBXButton
+      Left = 352
+      Top = 211
+      Width = 25
+      Height = 20
+      Caption = '...'
+      TabOrder = 11
+      OnClick = PickColorButtonClick
+    end
   end
 end

Modified: Lobby/TASClient/HighlightingUnit.pas
===================================================================
--- Lobby/TASClient/HighlightingUnit.pas	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/HighlightingUnit.pas	2010-11-16 23:25:15 UTC (rev 7525)
@@ -22,7 +22,8 @@
     HighlightsCheckListBox: TSpTBXCheckListBox;
     KeywordEdit: TSpTBXEdit;
     UseNotificationsCheckBox: TSpTBXCheckBox;
-    JvColorComboBox1: TJvColorComboBox;
+    HightlightColorPanel: TPanel;
+    PickColorButton: TSpTBXButton;
 
     procedure CreateParams(var Params: TCreateParams); override;
     function CheckLastLineForHighlights(RichEdit: TExRichEdit; ChatTextPos: Integer): Boolean;
@@ -34,6 +35,7 @@
       Shift: TShiftState);
     procedure FormCreate(Sender: TObject);
     procedure FormClose(Sender: TObject; var Action: TCloseAction);
+    procedure PickColorButtonClick(Sender: TObject);
 
   private
     { Private declarations }
@@ -234,7 +236,7 @@
     begin
       RichEdit.SelStart := Length(RichEdit.Text) - (Length(sn) - Highlights[i].X) - 2;
       RichEdit.SelLength := Highlights[i].Y - Highlights[i].X;
-      RichEdit.SelAttributes.Color := HighlightingForm.JvColorComboBox1.Colors[Max(0, Misc.MapColorNameToIndex(Preferences.HighlightColor, HighlightingForm.JvColorComboBox1))];
+      RichEdit.SelAttributes.Color := HightlightColorPanel.Color;//HighlightingForm.JvColorComboBox1.Colors[Max(0, Misc.MapColorNameToIndex(Preferences.HighlightColor, HighlightingForm.JvColorComboBox1))];
       RichEdit.SelAttributes.Style := [fsUnderLine];
       RichEdit.SelLength := 0;
     end;
@@ -255,4 +257,9 @@
   HighlightingForm.SaveHighlightsToFile(ExtractFilePath(Application.ExeName) + VAR_FOLDER + '\highlights.dat');
 end;
 
+procedure THighlightingForm.PickColorButtonClick(Sender: TObject);
+begin
+  HightlightColorPanel.Color := InputColor(_('Choose a color ...'),HightlightColorPanel.Color);
+end;
+
 end.

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/MainUnit.pas	2010-11-16 23:25:15 UTC (rev 7525)
@@ -413,7 +413,7 @@
   );
 
 const
-  VERSION_NUMBER = '0.78'; // Must be float value! (with a period as a decimal seperator)
+  VERSION_NUMBER = '0.79'; // Must be float value! (with a period as a decimal seperator)
   AUTOUPDATE_URL = '<A HREF="http://tasclient.no-ip.org/TASClient_update_v5.txt">http://tasclient.no-ip.org/TASClient_update_v5.txt</A>';
   PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER;
   KEEP_ALIVE_INTERVAL = 10000; // in milliseconds. Tells us what should be the maximum &quot;silence&quot; time before we send a ping to the server.
@@ -1453,7 +1453,6 @@
     procedure mnuRenameClick(Sender: TObject);
     procedure BattleListPopupMenuPopup(Sender: TObject);
     procedure ClientPopupMenuPopup(Sender: TObject);
-    procedure Button1Click(Sender: TObject);
     procedure VDTBattlesHeaderDraw(Sender: TVTHeader;
       HeaderCanvas: TCanvas; Column: TVirtualTreeColumn; R: TRect; Hover,
       Pressed: Boolean; DropMark: TVTDropMarkMode);
@@ -2129,6 +2128,7 @@
   // Shift+Ctrl+F5 to reset the mainform and battle form pos and size
   if (Msg.CharCode = VK_F5) and (GetKeyState(VK_SHIFT) &lt; 0) and (GetKeyState(VK_CONTROL) &lt; 0) then
   begin
+    if MessageDlg(_('Do you really want to reset the main TASClient windows positions and sizes ?'),mtConfirmation,[mbYes,mbNo],0) = mrNo then Exit;
     MainForm.Show;
     MainForm.WindowState := wsNormal;
     MainForm.Left := 0;
@@ -9420,7 +9420,7 @@
     begin
       Canvas.Brush.Color := Battle.GetHighlightColor;
       Canvas.FillRect(CellRect);
-      Canvas.Font.Color := clWindowText;
+      Canvas.Font.Color := IFF(Battle.GetHighlightColor &lt;&gt; VDTBattles.Color,Misc.ComplementaryTextColor(Canvas.Brush.Color),clWindowText);
     end;
 
     if Column = 0 then
@@ -14179,17 +14179,6 @@
   SelectedUserName := Client.Name;
 end;
 
-procedure TMainForm.Button1Click(Sender: TObject);
-var
-  sl: TStringList;
-  i: integer;
-begin
-  sl := GetDownloadLinks('TheRockFinal');
-  for i:=0 to sl.count-1 do
-    AddMainLog(sl[i],colors.Normal);
-  DownloadMap(0,'TheRockFinal');
-end;
-
 procedure TMainForm.VDTBattlesHeaderDraw(Sender: TVTHeader;
   HeaderCanvas: TCanvas; Column: TVirtualTreeColumn; R: TRect; Hover,
   Pressed: Boolean; DropMark: TVTDropMarkMode);

Modified: Lobby/TASClient/ManageGroups.pas
===================================================================
--- Lobby/TASClient/ManageGroups.pas	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/ManageGroups.pas	2010-11-16 23:25:15 UTC (rev 7525)
@@ -417,9 +417,8 @@
     (Sender as TSpTBXComboBox).Canvas.FillRect(ARect);
 
   ACanvas.Brush.Style := bsClear;
-  if Index &lt;&gt; 0 then MainForm.RanksImageList.Draw(ACanvas, ARect.Left, ARect.Top, Index);
-  if Index &lt;&gt; 0 then ACanvas.TextOut(ARect.Left + MainForm.RanksImageList.Width + 3, ARect.Top, (Sender as TSpTBxComboBox).Items[Index])
-  else ACanvas.TextOut(ARect.Left + 3, ARect.Top, (Sender as TSpTBXComboBox).Items[Index]);
+  MainForm.RanksImageList.Draw(ACanvas, ARect.Left, ARect.Top, Index);
+  ACanvas.TextOut(ARect.Left + MainForm.RanksImageList.Width + 3, ARect.Top, (Sender as TSpTBxComboBox).Items[Index])
 end;
 
 end.

Modified: Lobby/TASClient/PreferencesFormUnit.dfm
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.dfm	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/PreferencesFormUnit.dfm	2010-11-16 23:25:15 UTC (rev 7525)
@@ -90,13 +90,12 @@
       Top = 56
       Width = 553
       Height = 417
-      ActiveTabIndex = 0
+      ActiveTabIndex = 2
       TabAutofit = True
       HiddenItems = &lt;&gt;
       object SpTBXTabItem6: TSpTBXTabItem
         Caption = 'Server'
         Wrapping = twWrap
-        Checked = True
         CustomWidth = 78
         CustomHeight = 40
       end
@@ -108,6 +107,7 @@
       object SpTBXTabItem4: TSpTBXTabItem
         Caption = 'Program'
         Wrapping = twWrap
+        Checked = True
         CustomWidth = 78
       end
       object SpTBXTabItem3: TSpTBXTabItem
@@ -130,219 +130,6 @@
         Wrapping = twWrap
         CustomWidth = 78
       end
-      object SpTBXTabSheet3: TSpTBXTabSheet
-        Left = 0
-        Top = 44
-        Width = 553
-        Height = 373
-        Caption = 'Interface'
-        ImageIndex = -1
-        TabItem = 'SpTBXTabItem3'
-        object GroupBox4: TSpTBXGroupBox
-          Left = 8
-          Top = 8
-          Width = 529
-          Height = 345
-          Caption = 'Interface preferences'
-          TabOrder = 0
-          object CheckBox1: TSpTBXCheckBox
-            Left = 24
-            Top = 16
-            Width = 104
-            Height = 15
-            Caption = 'Timestamp events'
-            TabOrder = 0
-            Checked = True
-            State = cbChecked
-          end
-          object CheckBox3: TSpTBXCheckBox
-            Left = 24
-            Top = 32
-            Width = 128
-            Height = 15
-            Caption = 'Filter join/left messages'
-            TabOrder = 1
-          end
-          object CheckBox4: TSpTBXCheckBox
-            Left = 24
-            Top = 64
-            Width = 108
-            Height = 15
-            Caption = 'Show country flags'
-            TabOrder = 2
-            Checked = True
-            State = cbChecked
-          end
-          object CheckBox5: TSpTBXCheckBox
-            Left = 24
-            Top = 80
-            Width = 147
-            Height = 15
-            Caption = 'Mark unknown maps/mods'
-            TabOrder = 3
-            Checked = True
-            State = cbChecked
-          end
-          object CheckBox6: TSpTBXCheckBox
-            Left = 24
-            Top = 96
-            Width = 251
-            Height = 15
-            Caption = 'Use taskbar button for each form (requires restart)'
-            TabOrder = 4
-          end
-          object WarnNATCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 112
-            Width = 271
-            Height = 15
-            Caption = 'Display warning icons on battles using NAT traversing'
-            TabOrder = 5
-            Checked = True
-            State = cbChecked
-          end
-          object AutoFocusOnPMCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 128
-            Width = 262
-            Height = 15
-            Caption = 'Automatically switch focus to new private messages'
-            TabOrder = 6
-            Checked = True
-            State = cbChecked
-          end
-          object DisableAllSoundsCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 144
-            Width = 103
-            Height = 15
-            Caption = 'Disable all sounds'
-            TabOrder = 7
-          end
-          object UploadReplayCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 240
-            Width = 227
-            Height = 15
-            Caption = 'Ask what to do with replays after each battle'
-            TabOrder = 8
-          end
-          object SortLocalCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 160
-            Width = 132
-            Height = 15
-            Caption = 'Sort the $local player list'
-            TabOrder = 9
-          end
-          object DisplayQuickJoinPanelCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 176
-            Width = 131
-            Height = 15
-            Caption = 'Display Quick join panel'
-            TabOrder = 10
-          end
-          object FilterBattleJoinLeftCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 48
-            Width = 157
-            Height = 15
-            Caption = 'Filter battle join/left messages'
-            TabOrder = 11
-          end
-          object AutoCompletionCurrentChannelCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 192
-            Width = 252
-            Height = 15
-            Caption = 'Auto-completion from current channel'#39's players list'
-            TabOrder = 12
-          end
-          object ChatLogsLimitCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 208
-            Width = 145
-            Height = 15
-            Caption = 'Limit chat logs to 800 lines '
-            TabOrder = 13
-          end
-          object ChatLogsLimitTracker: TSpTBXTrackBar
-            Left = 400
-            Top = 208
-            Width = 121
-            Height = 17
-            Max = 3000
-            Min = 50
-            Frequency = 100
-            Position = 800
-            TabOrder = 14
-            ThumbLength = 10
-            OnChange = ChatLogsLimitTrackerChange
-          end
-          object DisplayUnitsIconsAndNamesCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 224
-            Width = 251
-            Height = 15
-            Caption = 'Load units icons and names when joining (slower)'
-            TabOrder = 15
-          end
-          object DisableNewsCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 256
-            Width = 159
-            Height = 15
-            Caption = 'Disable news (requires restart)'
-            TabOrder = 16
-          end
-          object DoNotLoadMapInfos: TSpTBXCheckBox
-            Left = 24
-            Top = 272
-            Width = 240
-            Height = 15
-            Caption = 'Disable minimaps and maps info loading at start'
-            TabOrder = 17
-          end
-          object LoadMetalHeightMaps: TSpTBXCheckBox
-            Left = 24
-            Top = 288
-            Width = 295
-            Height = 15
-            Caption = 'Load metal and height minimaps (enables 3D map preview)'
-            TabOrder = 18
-          end
-          object DisplayAutoHostInterfaceCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 304
-            Width = 158
-            Height = 15
-            Caption = 'Display the autohost interface'
-            TabOrder = 19
-          end
-          object ChatLogLoadingTracker: TSpTBXTrackBar
-            Left = 400
-            Top = 320
-            Width = 121
-            Height = 17
-            Max = 1000
-            Min = 2
-            Frequency = 50
-            Position = 30
-            TabOrder = 20
-            ThumbLength = 10
-            OnChange = ChatLogLoadingTrackerChange
-          end
-          object ChatLogLoadingCheckBox: TSpTBXCheckBox
-            Left = 24
-            Top = 320
-            Width = 162
-            Height = 15
-            Caption = 'Load the last 30 chat log lines '
-            TabOrder = 21
-          end
-        end
-      end
       object SpTBXTabSheet7: TSpTBXTabSheet
         Left = 0
         Top = 44
@@ -675,6 +462,307 @@
           end
         end
       end
+      object SpTBXTabSheet6: TSpTBXTabSheet
+        Left = 0
+        Top = 44
+        Width = 553
+        Height = 373
+        Caption = 'Server'
+        ImageIndex = -1
+        TabItem = 'SpTBXTabItem6'
+        object GroupBox1: TSpTBXGroupBox
+          Left = 16
+          Top = 8
+          Width = 529
+          Height = 345
+          Caption = 'Server settings'
+          TabOrder = 0
+          object Label1: TSpTBXLabel
+            Left = 16
+            Top = 32
+            Width = 74
+            Height = 13
+            Caption = 'Server address:'
+          end
+          object Label2: TSpTBXLabel
+            Left = 16
+            Top = 56
+            Width = 55
+            Height = 13
+            Caption = 'Server port:'
+          end
+          object ServerPortEdit: TSpTBXEdit
+            Left = 128
+            Top = 56
+            Width = 41
+            Height = 21
+            TabOrder = 1
+            Text = '8200'
+          end
+          object CheckBox10: TSpTBXCheckBox
+            Left = 16
+            Top = 128
+            Width = 197
+            Height = 15
+            Caption = 'Connect to backup host if primary fails'
+            TabOrder = 2
+            Checked = True
+            State = cbChecked
+          end
+          object CheckBox2: TSpTBXCheckBox
+            Left = 16
+            Top = 144
+            Width = 108
+            Height = 15
+            Caption = 'Connect on startup'
+            TabOrder = 3
+          end
+          object CheckBox7: TSpTBXCheckBox
+            Left = 16
+            Top = 160
+            Width = 226
+            Height = 15
+            Caption = 'Join #main once connected (recommended)'
+            TabOrder = 4
+          end
+          object ServerAddressEdit: TSpTBXButtonEdit
+            Left = 128
+            Top = 32
+            Width = 385
+            Height = 21
+            TabOrder = 0
+            EditButton.Left = 361
+            EditButton.Top = 0
+            EditButton.Width = 20
+            EditButton.Height = 17
+            EditButton.Caption = '...'
+            EditButton.Align = alRight
+            EditButton.DropDownArrow = False
+            EditButton.DropDownMenu = AddressPopupMenu
+          end
+          object PerformButton: TSpTBXSpeedButton
+            Left = 400
+            Top = 56
+            Width = 113
+            Height = 21
+            Caption = 'Perform ...'
+            OnClick = PerformButtonClick
+          end
+        end
+      end
+      object SpTBXTabSheet3: TSpTBXTabSheet
+        Left = 0
+        Top = 44
+        Width = 553
+        Height = 373
+        Caption = 'Interface'
+        ImageIndex = -1
+        TabItem = 'SpTBXTabItem3'
+        object GroupBox4: TSpTBXGroupBox
+          Left = 8
+          Top = 8
+          Width = 529
+          Height = 345
+          Caption = 'Interface preferences'
+          TabOrder = 0
+          object CheckBox1: TSpTBXCheckBox
+            Left = 24
+            Top = 16
+            Width = 104
+            Height = 15
+            Caption = 'Timestamp events'
+            TabOrder = 0
+            Checked = True
+            State = cbChecked
+          end
+          object CheckBox3: TSpTBXCheckBox
+            Left = 24
+            Top = 32
+            Width = 128
+            Height = 15
+            Caption = 'Filter join/left messages'
+            TabOrder = 1
+          end
+          object CheckBox4: TSpTBXCheckBox
+            Left = 24
+            Top = 64
+            Width = 108
+            Height = 15
+            Caption = 'Show country flags'
+            TabOrder = 2
+            Checked = True
+            State = cbChecked
+          end
+          object CheckBox5: TSpTBXCheckBox
+            Left = 24
+            Top = 80
+            Width = 147
+            Height = 15
+            Caption = 'Mark unknown maps/mods'
+            TabOrder = 3
+            Checked = True
+            State = cbChecked
+          end
+          object CheckBox6: TSpTBXCheckBox
+            Left = 24
+            Top = 96
+            Width = 251
+            Height = 15
+            Caption = 'Use taskbar button for each form (requires restart)'
+            TabOrder = 4
+          end
+          object WarnNATCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 112
+            Width = 271
+            Height = 15
+            Caption = 'Display warning icons on battles using NAT traversing'
+            TabOrder = 5
+            Checked = True
+            State = cbChecked
+          end
+          object AutoFocusOnPMCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 128
+            Width = 262
+            Height = 15
+            Caption = 'Automatically switch focus to new private messages'
+            TabOrder = 6
+            Checked = True
+            State = cbChecked
+          end
+          object DisableAllSoundsCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 144
+            Width = 103
+            Height = 15
+            Caption = 'Disable all sounds'
+            TabOrder = 7
+          end
+          object UploadReplayCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 240
+            Width = 227
+            Height = 15
+            Caption = 'Ask what to do with replays after each battle'
+            TabOrder = 8
+          end
+          object SortLocalCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 160
+            Width = 132
+            Height = 15
+            Caption = 'Sort the $local player list'
+            TabOrder = 9
+          end
+          object DisplayQuickJoinPanelCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 176
+            Width = 131
+            Height = 15
+            Caption = 'Display Quick join panel'
+            TabOrder = 10
+          end
+          object FilterBattleJoinLeftCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 48
+            Width = 157
+            Height = 15
+            Caption = 'Filter battle join/left messages'
+            TabOrder = 11
+          end
+          object AutoCompletionCurrentChannelCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 192
+            Width = 252
+            Height = 15
+            Caption = 'Auto-completion from current channel'#39's players list'
+            TabOrder = 12
+          end
+          object ChatLogsLimitCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 208
+            Width = 145
+            Height = 15
+            Caption = 'Limit chat logs to 800 lines '
+            TabOrder = 13
+          end
+          object ChatLogsLimitTracker: TSpTBXTrackBar
+            Left = 400
+            Top = 208
+            Width = 121
+            Height = 17
+            Max = 3000
+            Min = 50
+            Frequency = 100
+            Position = 800
+            TabOrder = 14
+            ThumbLength = 10
+            OnChange = ChatLogsLimitTrackerChange
+          end
+          object DisplayUnitsIconsAndNamesCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 224
+            Width = 251
+            Height = 15
+            Caption = 'Load units icons and names when joining (slower)'
+            TabOrder = 15
+          end
+          object DisableNewsCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 256
+            Width = 159
+            Height = 15
+            Caption = 'Disable news (requires restart)'
+            TabOrder = 16
+          end
+          object DoNotLoadMapInfos: TSpTBXCheckBox
+            Left = 24
+            Top = 272
+            Width = 240
+            Height = 15
+            Caption = 'Disable minimaps and maps info loading at start'
+            TabOrder = 17
+          end
+          object LoadMetalHeightMaps: TSpTBXCheckBox
+            Left = 24
+            Top = 288
+            Width = 295
+            Height = 15
+            Caption = 'Load metal and height minimaps (enables 3D map preview)'
+            TabOrder = 18
+          end
+          object DisplayAutoHostInterfaceCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 304
+            Width = 158
+            Height = 15
+            Caption = 'Display the autohost interface'
+            TabOrder = 19
+          end
+          object ChatLogLoadingTracker: TSpTBXTrackBar
+            Left = 400
+            Top = 320
+            Width = 121
+            Height = 17
+            Max = 1000
+            Min = 2
+            Frequency = 50
+            Position = 30
+            TabOrder = 20
+            ThumbLength = 10
+            OnChange = ChatLogLoadingTrackerChange
+          end
+          object ChatLogLoadingCheckBox: TSpTBXCheckBox
+            Left = 24
+            Top = 320
+            Width = 162
+            Height = 15
+            Caption = 'Load the last 30 chat log lines '
+            TabOrder = 21
+          end
+        end
+      end
       object SpTBXTabSheet4: TSpTBXTabSheet
         Left = 0
         Top = 44
@@ -698,14 +786,6 @@
             Caption = 'Reset registry data'
             OnClick = ResetRegistryButtonClick
           end
-          object GameSettingsButton: TSpTBXSpeedButton
-            Left = 296
-            Top = 88
-            Width = 225
-            Height = 22
-            Caption = 'Game settings'
-            OnClick = GameSettingsButtonClick
-          end
           object NotificationsButton: TSpTBXSpeedButton
             Left = 296
             Top = 40
@@ -765,7 +845,7 @@
           end
           object CheckBox8: TSpTBXCheckBox
             Left = 16
-            Top = 296
+            Top = 312
             Width = 88
             Height = 15
             Caption = 'Enable logging'
@@ -775,7 +855,7 @@
           end
           object CheckBox9: TSpTBXCheckBox
             Left = 16
-            Top = 280
+            Top = 296
             Width = 128
             Height = 15
             Caption = 'Use sound notifications'
@@ -783,168 +863,72 @@
             Checked = True
             State = cbChecked
           end
-          object KeyEditorButton: TSpTBXSpeedButton
-            Left = 296
-            Top = 112
-            Width = 225
-            Height = 22
-            Caption = 'Selection key editor'
-            OnClick = KeyEditorButtonClick
-          end
           object CheckForNewVersionCheckBox: TSpTBXCheckBox
             Left = 16
-            Top = 264
+            Top = 280
             Width = 168
             Height = 15
             Caption = 'Auto update lobby to latest beta'
-            TabOrder = 12
+            TabOrder = 10
           end
           object ColorsButton: TSpTBXButton
             Left = 296
-            Top = 136
+            Top = 88
             Width = 225
             Height = 22
             Caption = 'Colors and font ...'
-            TabOrder = 13
+            TabOrder = 11
             OnClick = ColorsButtonClick
           end
           object ManageGroupsButton: TSpTBXButton
             Left = 296
-            Top = 160
+            Top = 112
             Width = 225
             Height = 22
             Caption = 'Manage groups ...'
-            TabOrder = 14
+            TabOrder = 12
             OnClick = ManageGroupsButtonClick
           end
           object EnableSpringDownloaderCheckBox: TSpTBXCheckBox
             Left = 16
-            Top = 248
+            Top = 264
             Width = 162
             Height = 15
             Caption = 'Enable Integrated Downloader'
-            TabOrder = 15
+            TabOrder = 13
             Checked = True
             State = cbChecked
           end
           object UseLogonFormCheckBox: TSpTBXCheckBox
             Left = 16
-            Top = 232
+            Top = 248
             Width = 89
             Height = 15
             Caption = 'Use logon form'
-            TabOrder = 16
+            TabOrder = 14
             Checked = True
             State = cbChecked
           end
           object TipsButton: TSpTBXButton
             Left = 296
-            Top = 184
+            Top = 136
             Width = 225
             Height = 22
             Caption = 'Tips ...'
-            TabOrder = 17
+            TabOrder = 15
             OnClick = TipsButtonClick
           end
           object SpringSettingsProfilesButton: TSpTBXButton
             Left = 296
-            Top = 208
+            Top = 160
             Width = 225
             Height = 22
             Caption = 'Spring Settings profiles'
-            TabOrder = 18
+            TabOrder = 16
             OnClick = SpringSettingsProfilesButtonClick
           end
         end
       end
-      object SpTBXTabSheet6: TSpTBXTabSheet
-        Left = 0
-        Top = 44
-        Width = 553
-        Height = 373
-        Caption = 'Server'
-        ImageIndex = -1
-        TabItem = 'SpTBXTabItem6'
-        object GroupBox1: TSpTBXGroupBox
-          Left = 16
-          Top = 8
-          Width = 529
-          Height = 345
-          Caption = 'Server settings'
-          TabOrder = 0
-          object Label1: TSpTBXLabel
-            Left = 16
-            Top = 32
-            Width = 74
-            Height = 13
-            Caption = 'Server address:'
-          end
-          object Label2: TSpTBXLabel
-            Left = 16
-            Top = 56
-            Width = 55
-            Height = 13
-            Caption = 'Server port:'
-          end
-          object ServerPortEdit: TSpTBXEdit
-            Left = 128
-            Top = 56
-            Width = 41
-            Height = 21
-            TabOrder = 1
-            Text = '8200'
-          end
-          object CheckBox10: TSpTBXCheckBox
-            Left = 16
-            Top = 128
-            Width = 197
-            Height = 15
-            Caption = 'Connect to backup host if primary fails'
-            TabOrder = 2
-            Checked = True
-            State = cbChecked
-          end
-          object CheckBox2: TSpTBXCheckBox
-            Left = 16
-            Top = 144
-            Width = 108
-            Height = 15
-            Caption = 'Connect on startup'
-            TabOrder = 3
-          end
-          object CheckBox7: TSpTBXCheckBox
-            Left = 16
-            Top = 160
-            Width = 226
-            Height = 15
-            Caption = 'Join #main once connected (recommended)'
-            TabOrder = 4
-          end
-          object ServerAddressEdit: TSpTBXButtonEdit
-            Left = 128
-            Top = 32
-            Width = 385
-            Height = 21
-            TabOrder = 0
-            EditButton.Left = 361
-            EditButton.Top = 0
-            EditButton.Width = 20
-            EditButton.Height = 17
-            EditButton.Caption = '...'
-            EditButton.Align = alRight
-            EditButton.DropDownArrow = False
-            EditButton.DropDownMenu = AddressPopupMenu
-          end
-          object PerformButton: TSpTBXSpeedButton
-            Left = 400
-            Top = 56
-            Width = 113
-            Height = 21
-            Caption = 'Perform ...'
-            OnClick = PerformButtonClick
-          end
-        end
-      end
     end
     object ApplyAndCloseButton: TSpTBXButton
       Left = 119

Modified: Lobby/TASClient/PreferencesFormUnit.pas
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.pas	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/PreferencesFormUnit.pas	2010-11-16 23:25:15 UTC (rev 7525)
@@ -73,7 +73,7 @@
     ProxyUsername: string;
     ProxyPassword: string;
 
-    HighlightColor: string; // e.g.: 'Green'
+    HighlightColor: Integer; // e.g.: 'Green'
     UseNotificationsForHighlights: Boolean; // use notifications when highlighting selected keywords?
 
     UseIgnoreList: Boolean; // if true, then each time we receive something from a user we check if he is in our ignore list and filter out his message accordingly
@@ -147,7 +147,6 @@
     SpTBXTabSheet4: TSpTBXTabSheet;
     GroupBox3: TSpTBXGroupBox;
     ResetRegistryButton: TSpTBXSpeedButton;
-    GameSettingsButton: TSpTBXSpeedButton;
     NotificationsButton: TSpTBXSpeedButton;
     HighlightingButton: TSpTBXSpeedButton;
     IgnoreListButton: TSpTBXSpeedButton;
@@ -157,7 +156,6 @@
     RadioButton6: TSpTBXRadioButton;
     CheckBox8: TSpTBXCheckBox;
     CheckBox9: TSpTBXCheckBox;
-    KeyEditorButton: TSpTBXSpeedButton;
     CheckForNewVersionCheckBox: TSpTBXCheckBox;
     ColorsButton: TSpTBXButton;
     ManageGroupsButton: TSpTBXButton;
@@ -307,7 +305,7 @@
                                         BattleClientSortStyle: 2;FilterJoinLeftMessages: False;FilterBattleJoinLeftMessages: False; ShowFlags: True;
                                         MarkUnknownMaps: False; TaskbarButtons: True; JoinMainChannel: True; ReconnectToBackup: True; SaveLogs: True;
                                         UseSoundNotifications: True;AutoCompletionFromCurrentChannel: False; AutoUpdateToBeta: False;DisplayUnitsIconsAndNames: False;
-                                        DisplayAutohostInterface: True; UseProxy: False; HighlightColor: 'Green'; UseNotificationsForHighlights: True; UseIgnoreList: False;
+                                        DisplayAutohostInterface: True; UseProxy: False; HighlightColor: clGreen; UseNotificationsForHighlights: True; UseIgnoreList: False;
                                         WarnIfUsingNATTraversing: True; AutoFocusOnPM: True; MapSortStyle: 1; ThemeType: sknSkin; Theme: 'TASClient';AdvancedSkinning : True;
                                         SkinnedTitlebars: True ;DisableAllSounds: False; SortLocal: False; DisplayQuickJoinPanel : True; LimitChatLogs: False; ChatLogsLimit: 800;
                                         ChatLogLoadLoading: True; ChatLogLoadLines: 30; SPSkin: 'default.ssk'; ScriptsDisabled : False; EnableScripts : True;
@@ -486,6 +484,14 @@
     try WidgetDBForm.WindowState := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'WindowState'); except end;
     try WidgetDBForm.pnlWidgetInfo.Height := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'PnlWidgetInfoHeight'); except end;
     try WidgetDBForm.wbScreenShots.Height := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'WbScreenShotsHeight'); except end;
+    try WidgetDBForm.vstWidgetList.Header.SortColumn := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'SortColumn'); except end;
+    try
+      if Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'SortDirection') = 0 then
+        WidgetDBForm.vstWidgetList.Header.SortDirection := sdAscending
+      else
+        WidgetDBForm.vstWidgetList.Header.SortDirection := sdDescending;
+    except
+    end;
     with WidgetDBForm.vstWidgetList.Header.Columns do
       for i := 0 to Count-1 do
       try
@@ -642,6 +648,8 @@
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'WindowState', rdInteger, WidgetDBForm.WindowState);
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'PnlWidgetInfoHeight', rdInteger, WidgetDBForm.pnlWidgetInfo.Height);
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'WbScreenShotsHeight', rdInteger, WidgetDBForm.wbScreenShots.Height);
+    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'SortColumn', rdInteger, WidgetDBForm.vstWidgetList.Header.SortColumn);
+    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\WidgetDBForm', 'SortDirection', rdInteger, IfThen(WidgetDBForm.vstWidgetList.Header.SortDirection = sdAscending,0,1));
     with WidgetDBForm.vstWidgetList.Header.Columns do
       for i := 0 to Count-1 do
       begin
@@ -777,7 +785,7 @@
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'ProxyPort', rdinteger, Preferences.ProxyPort);
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'ProxyUsername', rdString, Preferences.ProxyUsername);
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'ProxyPassword', rdString, Preferences.ProxyPassword);
-    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'HighlightColor', rdString, Preferences.HighlightColor);
+    Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'HighlightColor', rdinteger, Preferences.HighlightColor);
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'UseNotificationsForHighlights', rdInteger, Preferences.UseNotificationsForHighlights);
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'CheckForNewVersion', rdInteger, Misc.BoolToInt(Preferences.AutoUpdateToBeta));
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'EnableSpringDownloader', rdInteger, Misc.BoolToInt(Preferences.EnableSpringDownloader));
@@ -1274,7 +1282,7 @@
   p.ProxyUsername := ProxyUserEdit.Text;
   p.ProxyPassword := ProxyPassEdit.Text;
 
-  p.HighlightColor := HighlightingForm.JvColorComboBox1.Text;
+  p.HighlightColor := HighlightingForm.HightlightColorPanel.Color; //JvColorComboBox1.Text;
   p.UseNotificationsForHighlights := HighlightingForm.UseNotificationsCheckBox.Checked;
 
   p.UseIgnoreList := IgnoreListForm.EnableIgnoresCheckBox.Checked;
@@ -1376,7 +1384,7 @@
   ProxyPassEdit.Text := p.ProxyPassword;
 
   try
-    HighlightingForm.JvColorComboBox1.ItemIndex := Max(0, HighlightingForm.JvColorComboBox1.Items.IndexOf(p.HighlightColor));
+    HighlightingForm.HightlightColorPanel.Color := p.HighlightColor;// JvColorComboBox1.ItemIndex := Max(0, HighlightingForm.JvColorComboBox1.Items.IndexOf(p.HighlightColor));
   except
   end;
   HighlightingForm.UseNotificationsCheckBox.Checked := p.UseNotificationsForHighlights;

Modified: Lobby/TASClient/Python/scripts/mapdownload.py
===================================================================
--- Lobby/TASClient/Python/scripts/mapdownload.py	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/Python/scripts/mapdownload.py	2010-11-16 23:25:15 UTC (rev 7525)
@@ -73,6 +73,7 @@
 			p = gui.GetControlProperties(formName+'.ProgressBar','')
 			oldParent[formName+'.ProgressBar'] = p['Parent']
 			changeComponentProp(formName+'.ProgressBar','Parent','BattleForm.SpTBXPanel3')
+			changeComponentProp(formName+'.ProgressBar','Height','20')
 			changeComponentProp(formName+'.ProgressBar','Align','alBottom')
 			
 			p = gui.GetControlProperties(formName+'.lblProgress','')

Modified: Lobby/TASClient/SpringDownloaderFormUnit.dfm
===================================================================
--- Lobby/TASClient/SpringDownloaderFormUnit.dfm	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/SpringDownloaderFormUnit.dfm	2010-11-16 23:25:15 UTC (rev 7525)
@@ -1,8 +1,8 @@
 object SpringDownloaderForm: TSpringDownloaderForm
-  Left = 1236
-  Top = 672
-  Width = 463
-  Height = 192
+  Left = 678
+  Top = 655
+  Width = 429
+  Height = 153
   Caption = 'Downloading ...'
   Color = clBtnFace
   Constraints.MaxHeight = 1150
@@ -14,7 +14,6 @@
   Font.Style = []
   OldCreateOrder = False
   Position = poMainFormCenter
-  Scaled = False
   OnClose = FormClose
   OnCreate = FormCreate
   PixelsPerInch = 96
@@ -22,83 +21,84 @@
   object SpTBXTitleBar1: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 455
-    Height = 165
+    Width = 421
+    Height = 126
     Caption = 'Downloading ...'
     Active = False
     FixedSize = True
     Options.Maximize = False
-    DesignSize = (
-      455
-      165)
-    object ProgressBar: TSpTBXProgressBar
-      Left = 16
-      Top = 64
-      Width = 425
-      Height = 25
-      Caption = '0%'
-      Anchors = [akLeft, akTop, akRight]
-      Font.Charset = DEFAULT_CHARSET
-      Font.Color = clWhite
-      Font.Height = -11
-      Font.Name = 'MS Sans Serif'
-      Font.Style = [fsBold]
-      ParentFont = False
-      CaptionGlow = gldBottomRight
-      CaptionGlowColor = clBlack
-      Smooth = True
+    object pnlMain: TSpTBXPanel
+      Left = 0
+      Top = 22
+      Width = 421
+      Height = 104
+      Align = alClient
+      TabOrder = 1
+      Borders = False
+      DesignSize = (
+        421
+        104)
+      object lblInfo: TSpTBXLabel
+        Left = 8
+        Top = 8
+        Width = 163
+        Height = 13
+        Caption = 'Retreiving download information ...'
+      end
+      object ProgressBar: TSpTBXProgressBar
+        Left = 8
+        Top = 32
+        Width = 407
+        Height = 8
+        Caption = '0%'
+        Anchors = [akLeft, akTop, akRight, akBottom]
+        Font.Charset = DEFAULT_CHARSET
+        Font.Color = clWhite
+        Font.Height = -11
+        Font.Name = 'MS Sans Serif'
+        Font.Style = [fsBold]
+        ParentFont = False
+        CaptionGlow = gldBottomRight
+        CaptionGlowColor = clBlack
+        Smooth = True
+      end
+      object lblRemainingTime: TSpTBXLabel
+        Left = 8
+        Top = 49
+        Width = 93
+        Height = 13
+        Caption = 'Remaining time : ??'
+        Anchors = [akLeft, akBottom]
+      end
+      object lblProgress: TSpTBXLabel
+        Left = 8
+        Top = 65
+        Width = 62
+        Height = 13
+        Caption = 'Progress : ??'
+        Anchors = [akLeft, akBottom]
+      end
+      object joinBattleCheckBox: TSpTBXCheckBox
+        Left = 8
+        Top = 81
+        Width = 195
+        Height = 15
+        Caption = 'Join battle after download is complete'
+        Anchors = [akLeft, akBottom]
+        TabOrder = 4
+        Visible = False
+      end
+      object CancelButton: TSpTBXButton
+        Left = 310
+        Top = 47
+        Width = 105
+        Height = 25
+        Caption = 'Cancel'
+        Anchors = [akRight, akBottom]
+        TabOrder = 5
+        OnClick = CancelButtonClick
+      end
     end
-    object CancelButton: TSpTBXButton
-      Left = 336
-      Top = 136
-      Width = 105
-      Height = 25
-      Caption = 'Cancel'
-      Anchors = [akTop, akRight]
-      TabOrder = 2
-      OnClick = CancelButtonClick
-    end
-    object lblInfo: TSpTBXLabel
-      Left = 16
-      Top = 40
-      Width = 163
-      Height = 13
-      Caption = 'Retreiving download information ...'
-    end
-    object lblRemainingTime: TSpTBXLabel
-      Left = 16
-      Top = 96
-      Width = 93
-      Height = 13
-      Caption = 'Remaining time : ??'
-    end
-    object lblProgress: TSpTBXLabel
-      Left = 16
-      Top = 112
-      Width = 62
-      Height = 13
-      Caption = 'Progress : ??'
-    end
-    object DetailsButton: TSpTBXButton
-      Left = 336
-      Top = 96
-      Width = 105
-      Height = 33
-      Caption = 'Show details'
-      Anchors = [akTop, akRight]
-      TabOrder = 6
-      Visible = False
-      OnClick = DetailsButtonClick
-    end
-    object joinBattleCheckBox: TSpTBXCheckBox
-      Left = 16
-      Top = 136
-      Width = 195
-      Height = 15
-      Caption = 'Join battle after download is complete'
-      TabOrder = 7
-      Visible = False
-    end
   end
   object tmrProgress: TTimer
     Enabled = False

Modified: Lobby/TASClient/SpringDownloaderFormUnit.pas
===================================================================
--- Lobby/TASClient/SpringDownloaderFormUnit.pas	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/SpringDownloaderFormUnit.pas	2010-11-16 23:25:15 UTC (rev 7525)
@@ -15,17 +15,17 @@
 
   TSpringDownloaderForm = class(TForm)
     SpTBXTitleBar1: TSpTBXTitleBar;
-    ProgressBar: TSpTBXProgressBar;
-    CancelButton: TSpTBXButton;
-    lblInfo: TSpTBXLabel;
     tmrProgress: TTimer;
     tmrTimeout: TTimer;
+    HttpCli1: THttpCli;
+    MultisourceHttpDownloader1: TMultisourceHttpDownloader;
+    pnlMain: TSpTBXPanel;
+    lblInfo: TSpTBXLabel;
+    ProgressBar: TSpTBXProgressBar;
     lblRemainingTime: TSpTBXLabel;
     lblProgress: TSpTBXLabel;
-    DetailsButton: TSpTBXButton;
     joinBattleCheckBox: TSpTBXCheckBox;
-    HttpCli1: THttpCli;
-    MultisourceHttpDownloader1: TMultisourceHttpDownloader;
+    CancelButton: TSpTBXButton;
 
     procedure CreateParams(var Params: TCreateParams); override;
     procedure tmrProgressTimer(Sender: TObject);
@@ -50,6 +50,8 @@
     joinBattleId : Integer;
     fileName: string;
     downloadLinks: TStringList;
+    parentDownloadForm: TSpringDownloaderForm;
+    dependenciesDlForm: TList;
     downloadCanceled: boolean;
 
     downloading: boolean;
@@ -58,13 +60,14 @@
     FOnProgress: TProgressEvent;
 
     procedure TryNextLink;
+    procedure DependencyDownloadComplete(Sender: TSpringDownloaderForm);
   public
     cbInfo: PScriptDownloadCallback;
     procedure StartDownload(dlType: string; dlHash : integer; dlName: string; joinBattleWhenDownloadComplete : integer = 0);
     property OnProgress: TProgressEvent read FOnProgress write FOnProgress;
   end;
 
-  function GetDownloadLinks(name: string): TStringList;
+  function GetDownloadLinks(name: string; var dependencies: TStringList): TStringList;
   function DownloadMod(modHash : integer; modName: string; joinBattleWhenDownloadComplete : integer = 0; scriptCallBack: PScriptDownloadCallback = nil; cb: TCallback=nil):TSpringDownloaderForm;
   function DownloadMap(mapHash : integer; mapName: string; noBrowser : boolean = False; scriptCallBack: PScriptDownloadCallback = nil; cb: TCallback=nil):TSpringDownloaderForm;
   procedure StartSpringDownloader;
@@ -83,7 +86,8 @@
 
 implementation
 
-uses  BattleFormUnit,PreferencesFormUnit, MainUnit, StrUtils, Misc, ComObj, gnugettext;
+uses  BattleFormUnit,PreferencesFormUnit, MainUnit, StrUtils, Misc, ComObj, gnugettext,
+      Utility;
 
 {$R *.dfm}
 
@@ -152,10 +156,27 @@
   end;
 end;
 
+procedure TSpringDownloaderForm.DependencyDownloadComplete(Sender: TSpringDownloaderForm);
+var
+  battle: TBattle;
+begin
+  dependenciesDlForm.Remove(Sender);
+  if joinBattleCheckBox.Checked and (dependenciesDlForm.Count = 0) then
+  begin
+    battle := MainForm.GetBattle(joinBattleId);
+    if battle &lt;&gt; nil then
+      MainForm.JoinBattle(battle);
+    Close;
+  end;
+end;
+
 procedure TSpringDownloaderForm.StartDownload(dlType: string; dlHash : integer; dlName: string; joinBattleWhenDownloadComplete : integer = 0);
 var
   sl: TStringList;
+  dep: TStringList;
   path : string;
+  i: integer;
+  dlForm: TSpringDownloaderForm;
 begin
   DownloadList.BeginUpdate;
   DownloadList.Add(dlName);
@@ -174,8 +195,21 @@
   Self.Caption := lblInfo.Caption;
 
   ShowAndSetFocus(CancelButton);
-  downloadLinks := GetDownloadLinks(dlName);
+  dep := TStringList.Create;
+  downloadLinks := GetDownloadLinks(dlName,dep);
 
+  for i:=0 to dep.Count-1 do
+    if Utility.ModList.IndexOf(dep[i]) = -1 then
+    begin
+      dlForm := DownloadMod(0,dep[i]);
+      if joinBattleWhenDownloadComplete &lt;&gt; 0 then
+      begin
+        dependenciesDlForm.Add(dlForm);
+        dlForm.parentDownloadForm := Self;
+      end;
+    end;
+
+
   tmrProgress.Enabled := True;
 
   TryNextLink;
@@ -236,7 +270,7 @@
 
 end;
 
-function GetDownloadLinks(name: string): TStringList;
+function GetDownloadLinks(name: string; var dependencies: TStringList): TStringList;
 var
   idHttp: TIdHTTP;
   xmlRequest : TStringList;
@@ -244,7 +278,7 @@
   responseStream: TStringStream;
   xmlDoc: TXMLDocument;
   test: string;
-  linksNode: IXMLNode;
+  valueNode: IXMLNode;
   i:integer;
 begin
   idHttp := TIdHTTP.Create(MainForm);
@@ -276,13 +310,22 @@
   result := TStringList.Create;
 
   try
-    linksNode := xmlDoc.DocumentElement.ChildNodes.FindNode('soap:Body').ChildNodes.First.ChildNodes.FindNode('links');
-    for i:=0 to linksNode.ChildNodes.Count-1 do
+    valueNode := xmlDoc.DocumentElement.ChildNodes.FindNode('soap:Body').ChildNodes.First.ChildNodes.FindNode('links');
+    for i:=0 to valueNode.ChildNodes.Count-1 do
     begin
-      result.Add(StringReplace(linksNode.ChildNodes.Nodes[i].Text,' ','%20',[rfReplaceAll]));
+      result.Add(StringReplace(valueNode.ChildNodes.Nodes[i].Text,' ','%20',[rfReplaceAll]));
     end;
   except
   end;
+
+  try
+    valueNode := xmlDoc.DocumentElement.ChildNodes.FindNode('soap:Body').ChildNodes.First.ChildNodes.FindNode('dependencies');
+    for i:=0 to valueNode.ChildNodes.Count-1 do
+    begin
+      dependencies.Add(valueNode.ChildNodes.Nodes[i].Text);
+    end;
+  except
+  end;
 end;
 
 procedure CleanUnusedDownloadForms;
@@ -389,6 +432,8 @@
   end;
 
   downloadLinks := TStringList.Create;
+  dependenciesDlForm := TList.Create;
+  parentDownloadForm := nil;
   downloadCanceled := False;
 
   FOnProgress := nil;
@@ -414,6 +459,7 @@
 var
   sl: TStringList;
   path : string;
+  i: integer;
 begin
   if downloadCanceled then
   begin
@@ -444,6 +490,9 @@
   DownloadList.BeginUpdate;
   try DownloadList.Delete(DownloadList.IndexOf(downloadName)); except end;
   DownloadList.EndUpdate;
+  for i:=0 to dependenciesDlForm.Count-1 do
+    TSpringDownloaderForm(dependenciesDlForm[i]).parentDownloadForm := nil;
+  dependenciesDlForm.Clear;
   ClosedDownloadFormList.Add(Self);
 end;
 
@@ -530,6 +579,7 @@
   Sender: TObject; ErrorCode: Integer; const Reason: String);
 var
   battle: TBattle;
+  i: integer;
 begin
   tmrProgress.Enabled := False;
 
@@ -551,18 +601,29 @@
   except
   end;
   MultisourceHttpDownloader1.FileStream := nil;
+  ProgressBar.Position := ProgressBar.Max;
   lblInfo.Caption := _('Done.');
   if Assigned(FOnProgress) then
     FOnProgress(cbInfo,-1);
+  if parentDownloadForm &lt;&gt; nil then
+    parentDownloadForm.DependencyDownloadComplete(Self);
   If downloadType = 'MAP' then
     BattleForm.ReloadMapListButtonClick(nil);
-  if joinBattleCheckBox.Checked then
+  if joinBattleCheckBox.Checked and (dependenciesDlForm.Count = 0) then
   begin
+    for i:=0 to dependenciesDlForm.Count-1 do
+      TSpringDownloaderForm(dependenciesDlForm[i]).parentDownloadForm := nil;
+    dependenciesDlForm.Clear;
     battle := MainForm.GetBattle(joinBattleId);
     if battle &lt;&gt; nil then
       MainForm.JoinBattle(battle);
   end;
-  Close;
+  if dependenciesDlForm.Count &gt; 0 then
+  begin
+    lblInfo.Caption := _('Downloading dependencies ...');
+  end
+  else
+    Close;
 end;
 
 procedure TSpringDownloaderForm.MultisourceHttpDownloader1Display(

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/TASClient.dof	2010-11-16 23:25:15 UTC (rev 7525)
@@ -113,9 +113,9 @@
 IncludeVerInfo=1
 AutoIncBuild=1
 MajorVer=0
-MinorVer=78
+MinorVer=79
 Release=0
-Build=1048
+Build=1064
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=Spring RTS Engine lobby client
-FileVersion=0.78.0.1048
+FileVersion=0.79.0.1064
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)

Modified: Lobby/TASClient/WidgetDBFormUnit.dfm
===================================================================
--- Lobby/TASClient/WidgetDBFormUnit.dfm	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/WidgetDBFormUnit.dfm	2010-11-16 23:25:15 UTC (rev 7525)
@@ -57,7 +57,7 @@
         Header.Font.Name = 'MS Sans Serif'
         Header.Font.Style = []
         Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoHotTrack, hoOwnerDraw, hoShowSortGlyphs, hoVisible]
-        Header.SortColumn = 0
+        Header.SortColumn = 1
         Header.Style = hsFlatButtons
         TabOrder = 1
         TreeOptions.AutoOptions = [toAutoDropExpand, toAutoScrollOnExpand, toAutoSort, toAutoTristateTracking, toAutoDeleteMovedNodes]

Modified: Lobby/TASClient/WidgetDBFormUnit.pas
===================================================================
--- Lobby/TASClient/WidgetDBFormUnit.pas	2010-11-13 20:22:30 UTC (rev 7524)
+++ Lobby/TASClient/WidgetDBFormUnit.pas	2010-11-16 23:25:15 UTC (rev 7525)
@@ -353,11 +353,12 @@
       Sender.SortDirection := sdAscending
     else
       Sender.SortDirection := sdDescending
-  else
+  else if HitInfo.Column &gt;= 0 then
   begin
     Sender.SortColumn := HitInfo.Column;
     Sender.SortDirection := sdAscending
   end;
+  Sender.Treeview.Invalidate;
 end;
 
 procedure TWidgetDBForm.vstWidgetListHeaderDraw(Sender: TVTHeader;
@@ -455,6 +456,11 @@
 
   btUninstall.Enabled := widget.Installed;
   btInstall.Enabled := True;
+  btRate1.Enabled := True;
+  btRate2.Enabled := True;
+  btRate3.Enabled := True;
+  btRate4.Enabled := True;
+  btRate5.Enabled := True;
   if widget.Installed then
     btInstall.Caption := _('Update')
   else
@@ -867,6 +873,11 @@
   btRefresh.Enabled := False;
   btInstall.Enabled := False;
   btUninstall.Enabled := False;
+  btRate1.Enabled := False;
+  btRate2.Enabled := False;
+  btRate3.Enabled := False;
+  btRate4.Enabled := False;
+  btRate5.Enabled := False;
   refreshThread := TRefreshWidgetListThread.Create(False);
 end;
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002294.html">[Taspring-linux-commit] r7524 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="002296.html">[Taspring-linux-commit] r7526 - Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2295">[ date ]</a>
              <a href="thread.html#2295">[ thread ]</a>
              <a href="subject.html#2295">[ subject ]</a>
              <a href="author.html#2295">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
