<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r5475 - trunk/Lobby/TASClient
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-February/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r5475%20-%20trunk/Lobby/TASClient&In-Reply-To=%3CE1JOHVX-0005ew-E4%40proserver.fnord.lan%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000281.html">
   <LINK REL="Next"  HREF="000283.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r5475 - trunk/Lobby/TASClient</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r5475%20-%20trunk/Lobby/TASClient&In-Reply-To=%3CE1JOHVX-0005ew-E4%40proserver.fnord.lan%3E"
       TITLE="[Taspring-linux-commit] r5475 - trunk/Lobby/TASClient">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sun Feb 10 20:06:31 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000281.html">[Taspring-linux-commit] r5474 - in trunk/tools/springie/Springie: .	autohost utils
</A></li>
        <LI>Next message: <A HREF="000283.html">[Taspring-linux-commit] r5476 - in trunk/tools/springie/Springie: .	autohost doc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#282">[ date ]</a>
              <a href="thread.html#282">[ thread ]</a>
              <a href="subject.html#282">[ subject ]</a>
              <a href="author.html#282">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2008-02-10 20:06:30 +0100 (Sun, 10 Feb 2008)
New Revision: 5475

Modified:
   trunk/Lobby/TASClient/DisableUnitsFormUnit.dfm
   trunk/Lobby/TASClient/MainUnit.dfm
   trunk/Lobby/TASClient/MainUnit.pas
   trunk/Lobby/TASClient/TASClient.dof
   trunk/Lobby/TASClient/TASClient.res
Log:
- checkboxes added to filters list

Modified: trunk/Lobby/TASClient/DisableUnitsFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/DisableUnitsFormUnit.dfm	2008-02-10 04:48:16 UTC (rev 5474)
+++ trunk/Lobby/TASClient/DisableUnitsFormUnit.dfm	2008-02-10 19:06:30 UTC (rev 5475)
@@ -100,6 +100,7 @@
       Top = 64
       Width = 577
       Height = 337
+      CheckImageKind = ckSystem
       Header.AutoSizeIndex = 2
       Header.Font.Charset = DEFAULT_CHARSET
       Header.Font.Color = clWindowText
@@ -107,6 +108,7 @@
       Header.Font.Name = 'MS Sans Serif'
       Header.Font.Style = []
       Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoVisible]
+      Header.Style = hsFlatButtons
       TabOrder = 6
       TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning]
       TreeOptions.PaintOptions = [toHideFocusRect, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]

Modified: trunk/Lobby/TASClient/MainUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/MainUnit.dfm	2008-02-10 04:48:16 UTC (rev 5474)
+++ trunk/Lobby/TASClient/MainUnit.dfm	2008-02-10 19:06:30 UTC (rev 5475)
@@ -341,6 +341,7 @@
             Top = 16
             Width = 177
             Height = 145
+            CheckImageKind = ckSystem
             ClipboardFormats.Strings = (
               'Unicode text')
             CustomCheckImages = ButtonImageList
@@ -352,31 +353,41 @@
             Header.Font.Name = 'MS Sans Serif'
             Header.Font.Style = []
             Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoShowSortGlyphs, hoVisible]
-            Header.SortColumn = 0
+            Header.SortColumn = 1
             Header.Style = hsFlatButtons
             TabOrder = 8
             TreeOptions.AutoOptions = [toAutoDropExpand, toAutoScrollOnExpand, toAutoSort, toAutoTristateTracking, toAutoDeleteMovedNodes]
+            TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning]
             TreeOptions.PaintOptions = [toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
             TreeOptions.SelectionOptions = [toFullRowSelect, toMultiSelect]
+            OnChecking = FilterListChecking
             OnCompareNodes = FilterListCompareNodes
             OnGetText = FilterListGetText
             OnHeaderClick = FilterListHeaderClick
             OnResize = FilterListResize
             Columns = &lt;
               item
+                MaxWidth = 20
+                MinWidth = 20
+                Options = [coAllowClick, coEnabled, coParentBidiMode, coParentColor, coShowDropMark, coVisible, coFixed]
+                Position = 0
+                Width = 20
+              end
+              item
                 Options = [coAllowClick, coEnabled, coParentBidiMode, coParentColor, coResizable, coShowDropMark, coVisible]
-                Position = 0
+                Position = 1
                 Width = 80
                 WideText = 'Type'
               end
               item
                 Options = [coAllowClick, coEnabled, coParentBidiMode, coParentColor, coResizable, coShowDropMark, coVisible]
-                Position = 1
+                Position = 2
+                Width = 63
                 WideText = ' '
               end
               item
-                Position = 2
-                Width = 43
+                Position = 3
+                Width = 10
                 WideText = 'Value'
               end&gt;
           end

Modified: trunk/Lobby/TASClient/MainUnit.pas
===================================================================
--- trunk/Lobby/TASClient/MainUnit.pas	2008-02-10 04:48:16 UTC (rev 5474)
+++ trunk/Lobby/TASClient/MainUnit.pas	2008-02-10 19:06:30 UTC (rev 5475)
@@ -566,6 +566,7 @@
     filterType : (HostName, MapName, ModName, Description);
     contains: boolean;
     node : PVirtualNode;
+    enabled: boolean;
     value: string;
   end;
 
@@ -1035,6 +1036,8 @@
     procedure mnuFindIPClick(Sender: TObject);
     procedure mnuUnmuteClick(Sender: TObject);
     procedure LadderCupsRefreshTimer(Sender: TObject);
+    procedure FilterListChecking(Sender: TBaseVirtualTree;
+      Node: PVirtualNode; var NewState: TCheckState; var Allowed: Boolean);
 
   published
     MainTitleBar: TSpTBXTitleBar;
@@ -7290,23 +7293,26 @@
   begin
     with TFilterText(Filters.TextFilters[i]^) do
     begin
-      if filterType = HostName then
-        tmpStr := TClient(Battle.Clients[0]).Name
-      else if filterType = MapName then
-        tmpStr := LeftStr(Battle.Map,Length(Battle.Map)-4) // left to remove the .smf (or whatever the extension is)
-      else if filterType = ModName then
-        tmpStr := Battle.ModName
-      else if filterType = Description then
-        tmpStr := Battle.Description
-      else
-        raise Exception.Create('Filter type not handled.');
+      if enabled then
+      begin
+        if filterType = HostName then
+          tmpStr := TClient(Battle.Clients[0]).Name
+        else if filterType = MapName then
+          tmpStr := LeftStr(Battle.Map,Length(Battle.Map)-4) // left to remove the .smf (or whatever the extension is)
+        else if filterType = ModName then
+          tmpStr := Battle.ModName
+        else if filterType = Description then
+          tmpStr := Battle.Description
+        else
+          raise Exception.Create('Filter type not handled.');
 
-      j := Pos(LowerCase(value),LowerCase(tmpStr));
-      if (contains and (j = 0)) or ((not contains) and (j &gt; 0)) then
-      begin
-        Result := False;
-        Exit;
-      end;
+        j := Pos(LowerCase(value),LowerCase(tmpStr));
+        if (contains and (j = 0)) or ((not contains) and (j &gt; 0)) then
+        begin
+          Result := False;
+          Exit;
+        end;
+      end; // if
     end; // with
   end; // for
 
@@ -8332,6 +8338,9 @@
   f^.value := FilterValueTextBox.Text;
   Filters.TextFilters.Add(f);
   f^.Node := FilterList.AddChild(FilterList.RootNode);
+  f^.Node.CheckType := ctCheckBox;
+  f^.Node.CheckState := csCheckedNormal;
+  f^.enabled := True;
   FilterList.Invalidate;
   FilterValueTextBox.Text := '';
   RefreshBattleList;
@@ -8637,6 +8646,7 @@
         
         Ini.WriteBool('TextFilter'+IntToStr(i), 'Contains', contains);
         Ini.WriteString('TextFilter'+IntToStr(i), 'Value', value);
+        Ini.WriteBool('TextFilter'+IntToStr(i), 'Enabled', enabled);
       end;
     end;
     Ini.Free;
@@ -8704,6 +8714,7 @@
 
     TFilterText(f^).value := Ini.ReadString('TextFilter'+IntToStr(i),'Value','');
     TFilterText(f^).contains := Ini.ReadBool('TextFilter'+IntToStr(i),'Contains',True);
+    TFilterText(f^).enabled := Ini.ReadBool('TextFilter'+IntToStr(i),'Enabled',True);
     TFilterText(f^).node := nil;
     Filters.TextFilters.Add(f);
 
@@ -8747,7 +8758,14 @@
   MaxPlayersValueTextBox.Value := Filters.MaxPlayers.value;
 
   for i:=0 to Filters.TextFilters.Count -1 do
+  begin
     TFilterText(Filters.TextFilters[i]^).Node := FilterList.AddChild(FilterList.RootNode);
+    TFilterText(Filters.TextFilters[i]^).Node.CheckType := ctCheckBox;
+    if TFilterText(Filters.TextFilters[i]^).enabled then
+      TFilterText(Filters.TextFilters[i]^).Node.CheckState := csCheckedNormal
+    else
+      TFilterText(Filters.TextFilters[i]^).Node.CheckState := csUncheckedNormal;
+  end;
 end;
 
 
@@ -9005,4 +9023,11 @@
     t := TLadderTopPlayersThread.Create(false);
 end;
 
+procedure TMainForm.FilterListChecking(Sender: TBaseVirtualTree;
+  Node: PVirtualNode; var NewState: TCheckState; var Allowed: Boolean);
+begin
+  TFilterText(Filters.TextFilters[GetFilterIndexFromNode(Node)]^).enabled := NewState = csCheckedNormal;
+  RefreshBattleList;
+end;
+
 end.

Modified: trunk/Lobby/TASClient/TASClient.dof
===================================================================
--- trunk/Lobby/TASClient/TASClient.dof	2008-02-10 04:48:16 UTC (rev 5474)
+++ trunk/Lobby/TASClient/TASClient.dof	2008-02-10 19:06:30 UTC (rev 5475)
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=3
 Release=0
-Build=218
+Build=219
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=TA Spring lobby client
-FileVersion=0.3.0.218
+FileVersion=0.3.0.219
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: trunk/Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000281.html">[Taspring-linux-commit] r5474 - in trunk/tools/springie/Springie: .	autohost utils
</A></li>
	<LI>Next message: <A HREF="000283.html">[Taspring-linux-commit] r5476 - in trunk/tools/springie/Springie: .	autohost doc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#282">[ date ]</a>
              <a href="thread.html#282">[ thread ]</a>
              <a href="subject.html#282">[ subject ]</a>
              <a href="author.html#282">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
