<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7236 - in Lobby/TASClient: .	Python/scripts/subf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7236%20-%20in%20Lobby/TASClient%3A%20.%0A%09Python/scripts/subf&In-Reply-To=%3C20090203172230.5E95748A6%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002004.html">
   <LINK REL="Next"  HREF="002006.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7236 - in Lobby/TASClient: .	Python/scripts/subf</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7236%20-%20in%20Lobby/TASClient%3A%20.%0A%09Python/scripts/subf&In-Reply-To=%3C20090203172230.5E95748A6%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r7236 - in Lobby/TASClient: .	Python/scripts/subf">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Tue Feb  3 18:22:24 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002004.html">[Taspring-linux-commit] r7235 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="002006.html">[Taspring-linux-commit] r7237 - in Lobby/TASClient: . ScrollingNews
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2005">[ date ]</a>
              <a href="thread.html#2005">[ thread ]</a>
              <a href="subject.html#2005">[ subject ]</a>
              <a href="author.html#2005">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2009-02-03 18:22:21 +0100 (Tue, 03 Feb 2009)
New Revision: 7236

Modified:
   Lobby/TASClient/AutoTeamsUnit.dfm
   Lobby/TASClient/AutoTeamsUnit.pas
   Lobby/TASClient/BattleFormUnit.dfm
   Lobby/TASClient/BattleFormUnit.pas
   Lobby/TASClient/MainUnit.dfm
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/MenuFormUnit.dfm
   Lobby/TASClient/Python/scripts/subf/testHideAutoHosts.py
   Lobby/TASClient/SpringDownloaderFormUnit.pas
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.res
   Lobby/TASClient/Utility.pas
Log:
* autobalance now support 1team balance (for coop games ?)
* clicking on a box will change your team
* PYTHON : testHideAutoHosts now also hides the games hosted by bots
* springdownloader launched with ShellExecute now instead of CreateProcess (it might fix some SD crash)
* duplicate checksum error msg now show the filename of the duplicated map
* player search button removed
* you can now filter the player list using simple keyword list or regular expression ex: &quot;re=^\[.*\]&quot;


Modified: Lobby/TASClient/AutoTeamsUnit.dfm
===================================================================
--- Lobby/TASClient/AutoTeamsUnit.dfm	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/AutoTeamsUnit.dfm	2009-02-03 17:22:21 UTC (rev 7236)
@@ -72,9 +72,9 @@
       object SpTBXLabel1: TSpTBXLabel
         Left = 8
         Top = 56
-        Width = 78
+        Width = 83
         Height = 13
-        Caption = 'Number of allies:'
+        Caption = 'Number of teams:'
         LinkFont.Charset = DEFAULT_CHARSET
         LinkFont.Color = clBlue
         LinkFont.Height = -11
@@ -82,7 +82,7 @@
         LinkFont.Style = [fsUnderline]
       end
       object NumOfAlliesButton: TTBXButton
-        Left = 96
+        Left = 128
         Top = 54
         Width = 41
         Height = 20

Modified: Lobby/TASClient/AutoTeamsUnit.pas
===================================================================
--- Lobby/TASClient/AutoTeamsUnit.pas	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/AutoTeamsUnit.pas	2009-02-03 17:22:21 UTC (rev 7236)
@@ -412,7 +412,7 @@
   Index := BattleForm.ChooseNumberDialog(Sender as TControl, StrToInt(NumOfAlliesButton.Caption)-1);
   if Index = -1 then Exit;
 
-  Index := Max(1, Index); // at least 2 allies!
+  //Index := Max(1, Index); // at least 2 allies!
 
   if StrToInt(NumOfAlliesButton.Caption)-1 = Index then Exit; // no change
   NumOfAlliesButton.Caption := IntToStr(Index+1);

Modified: Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/BattleFormUnit.dfm	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/BattleFormUnit.dfm	2009-02-03 17:22:21 UTC (rev 7236)
@@ -1,6 +1,6 @@
 object BattleForm: TBattleForm
-  Left = 448
-  Top = 94
+  Left = 867
+  Top = 383
   Width = 827
   Height = 589
   Caption = 'Battle window'
@@ -4861,7 +4861,7 @@
             Height = 222
             Align = alClient
             Color = clBtnFace
-            ActiveTabIndex = 2
+            ActiveTabIndex = 0
             OnActiveTabChange = MapsTabsActiveTabChange
             HiddenItems = &lt;
               item
@@ -4872,53 +4872,14 @@
               end&gt;
             object MinimapTab: TSpTBXTabItem
               Caption = 'Minimap'
+              Checked = True
             end
             object RessourcesMapTab: TSpTBXTabItem
               Caption = 'RessourcesMap'
             end
             object HeightMapTab: TSpTBXTabItem
               Caption = 'HeightMap'
-              Checked = True
             end
-            object SpTBXTabSheet3: TSpTBXTabSheet
-              Left = 0
-              Top = 23
-              Width = 260
-              Height = 199
-              Caption = 'Minimap'
-              ImageIndex = -1
-              TabItem = 'MinimapTab'
-              object MinimapPanel: TSpTBXPanel
-                Left = 2
-                Top = 0
-                Width = 256
-                Height = 197
-                Align = alClient
-                TabOrder = 0
-                OnResize = MinimapPanelResize
-                Borders = False
-                TBXStyleBackground = True
-                DesignSize = (
-                  256
-                  197)
-                object MapImage: TImageEx
-                  Left = 0
-                  Top = 0
-                  Width = 124
-                  Height = 80
-                  Cursor = crHandPoint
-                  Hint = 'No map'
-                  Anchors = [akLeft, akTop, akRight, akBottom]
-                  ParentShowHint = False
-                  PopupMenu = AutoStartRectsPopupMenu
-                  ShowHint = True
-                  Stretch = True
-                  OnMouseDown = MapImageMouseDown
-                  OnMouseMove = MapImageMouseMove
-                  OnMouseUp = MapImageMouseUp
-                end
-              end
-            end
             object SpTBXTabSheet4: TSpTBXTabSheet
               Left = 0
               Top = 23
@@ -12489,6 +12450,45 @@
                 end
               end
             end
+            object SpTBXTabSheet3: TSpTBXTabSheet
+              Left = 0
+              Top = 23
+              Width = 260
+              Height = 199
+              Caption = 'Minimap'
+              ImageIndex = -1
+              TabItem = 'MinimapTab'
+              object MinimapPanel: TSpTBXPanel
+                Left = 2
+                Top = 0
+                Width = 256
+                Height = 197
+                Align = alClient
+                TabOrder = 0
+                OnResize = MinimapPanelResize
+                Borders = False
+                TBXStyleBackground = True
+                DesignSize = (
+                  256
+                  197)
+                object MapImage: TImageEx
+                  Left = 0
+                  Top = 0
+                  Width = 124
+                  Height = 80
+                  Cursor = crHandPoint
+                  Hint = 'No map'
+                  Anchors = [akLeft, akTop, akRight, akBottom]
+                  ParentShowHint = False
+                  PopupMenu = AutoStartRectsPopupMenu
+                  ShowHint = True
+                  Stretch = True
+                  OnMouseDown = MapImageMouseDown
+                  OnMouseMove = MapImageMouseMove
+                  OnMouseUp = MapImageMouseUp
+                end
+              end
+            end
           end
         end
       end
@@ -12751,8 +12751,8 @@
     Top = 428
   end
   object ColorPopupMenu: TSpTBXPopupMenu
-    Left = 688
-    Top = 376
+    Left = 752
+    Top = 384
     object TBXColorPalette1: TTBXColorPalette
       ColorSet = TBXTeamColorSet
       PaletteOptions = [tpoCustomImages]
@@ -12772,12 +12772,12 @@
     ColCount = 5
     RowCount = 4
     OnGetColorInfo = TBXTeamColorSetGetColorInfo
-    Left = 656
-    Top = 376
+    Left = 720
+    Top = 384
   end
   object ChooseNumberPopupMenu: TSpTBXPopupMenu
-    Left = 512
-    Top = 328
+    Left = 552
+    Top = 344
     object TBXToolPalette1: TTBXToolPalette
       ColCount = 4
       Images = MainForm.NumbersImageList
@@ -12790,7 +12790,7 @@
     end
   end
   object ChooseSidePopupMenu: TSpTBXPopupMenu
-    Left = 672
+    Left = 728
     Top = 300
   end
   object PlayerControlPopupMenu: TSpTBXPopupMenu

Modified: Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- Lobby/TASClient/BattleFormUnit.pas	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/BattleFormUnit.pas	2009-02-03 17:22:21 UTC (rev 7236)
@@ -2757,6 +2757,14 @@
     end;
   end;
 
+  if (BattleState.SelectedStartRect &gt; -1) and IsBattleActive then
+  begin
+    MyAllyNoButton.Caption := IntToStr(BattleState.SelectedStartRect+1);
+    if not IsBattleActive then Exit;
+    SendMyBattleStatusToServer;
+    Exit;
+  end;
+
   MinimapZoomedForm.Image1.Width := MinimapZoomedForm.ClientWidth ;
   MinimapZoomedForm.Image1.Height := MinimapZoomedForm.ClientHeight;
   MinimapZoomedForm.Image1.Picture.Bitmap.Width := MinimapZoomedForm.ClientWidth;
@@ -2798,16 +2806,16 @@
       if (BattleState.ResizingStartRect = -1) and (BattleState.Status = Hosting) then
       if (BattleState.SelectedStartRect &lt;&gt; -1) then begin
         BattleState.ResizingDirection := 0;
-        if (X &gt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Left) and (X &lt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Left + 6) then begin
+        if (X &gt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Left-2) and (X &lt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Left + 2) then begin
           BattleState.ResizingDirection := BattleState.ResizingDirection + 1;
         end;
-        if (X &gt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Right-6) and (X &lt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Right) then begin
+        if (X &gt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Right-2) and (X &lt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Right+2) then begin
           BattleState.ResizingDirection := BattleState.ResizingDirection + 4;
         end;
-        if (Y &gt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Top) and (Y &lt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Top + 6) then begin
+        if (Y &gt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Top-2) and (Y &lt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Top + 2) then begin
           BattleState.ResizingDirection := BattleState.ResizingDirection + 2;
         end;
-        if (Y &gt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Bottom-6) and (Y &lt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Bottom) then begin
+        if (Y &gt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Bottom-2) and (Y &lt;= BattleState.StartRects[BattleState.SelectedStartRect].Rect.Bottom+2) then begin
           BattleState.ResizingDirection := BattleState.ResizingDirection + 8;
         end;
         if (BattleState.ResizingDirection = 1) or (BattleState.ResizingDirection = 4) then
@@ -4981,6 +4989,8 @@
 
 procedure TBattleForm.MapsButtonClick(Sender: TObject);
 begin
+  if MapListForm.Visible then
+    MapListForm.Close;
   MapListForm.ShowModal;
 end;
 

Modified: Lobby/TASClient/MainUnit.dfm
===================================================================
--- Lobby/TASClient/MainUnit.dfm	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/MainUnit.dfm	2009-02-03 17:22:21 UTC (rev 7236)
@@ -1,8 +1,8 @@
 object MainForm: TMainForm
-  Left = 635
-  Top = 318
+  Left = 427
+  Top = 265
   Width = 776
-  Height = 548
+  Height = 549
   Caption = '.'
   Color = clBtnFace
   Constraints.MaxHeight = 1000
@@ -25,7 +25,7 @@
     Left = 0
     Top = 0
     Width = 768
-    Height = 521
+    Height = 522
     Caption = 'TASClient'
     TBXStyleBackground = True
     object DefaultSideImage: TImage
@@ -205,9 +205,9 @@
     end
     object Panel1: TSpTBXPanel
       Left = 4
-      Top = 71
+      Top = 112
       Width = 760
-      Height = 446
+      Height = 406
       Caption = 'Panel1'
       Align = alClient
       TabOrder = 1
@@ -215,7 +215,7 @@
       TBXStyleBackground = True
       object Panel3: TPanel
         Left = 2
-        Top = 174
+        Top = 134
         Width = 756
         Height = 270
         Align = alBottom
@@ -937,7 +937,7 @@
       end
       object Splitter2: TSpTBXSplitter
         Left = 2
-        Top = 168
+        Top = 128
         Width = 756
         Height = 6
         Cursor = crSizeNS
@@ -952,7 +952,7 @@
         Left = 2
         Top = 2
         Width = 756
-        Height = 166
+        Height = 126
         Align = alClient
         TabOrder = 2
         Borders = False
@@ -960,7 +960,7 @@
           Left = 2
           Top = 2
           Width = 589
-          Height = 162
+          Height = 122
           Align = alClient
           Constraints.MinHeight = 1
           MultiLine = True
@@ -975,7 +975,7 @@
           Left = 601
           Top = 2
           Width = 153
-          Height = 162
+          Height = 122
           Align = alRight
           Color = clNone
           Constraints.MinWidth = 1
@@ -986,9 +986,9 @@
           object ClientsListBox: TTntListBox
             Tag = -1
             Left = 2
-            Top = 30
+            Top = 52
             Width = 149
-            Height = 130
+            Height = 68
             Style = lbOwnerDrawFixed
             Align = alClient
             Font.Charset = DEFAULT_CHARSET
@@ -1043,43 +1043,69 @@
               Transparent = True
               OnClick = SortLabelClick
             end
-            object btSearchPlayer: TSpTBXSpeedButton
-              Left = 4
-              Top = 4
-              Width = 22
-              Height = 20
-              Hint = 'Search for a player in the list. Hit F3 to get the next result.'
-              ParentShowHint = False
-              ShowHint = True
-              DropDownArrow = False
-              DropDownMenu = SearchPlayerFormPopupMenu
-              Images = BattleStatusImageList
-              ImageIndex = 6
+            object PlayersLabel: TSpTBXLabel
+              Left = 2
+              Top = 8
+              Width = 37
+              Height = 13
+              Caption = 'Players:'
               LinkFont.Charset = DEFAULT_CHARSET
               LinkFont.Color = clBlue
               LinkFont.Height = -11
               LinkFont.Name = 'MS Sans Serif'
               LinkFont.Style = [fsUnderline]
             end
-            object PlayersLabel: TSpTBXLabel
-              Left = 28
-              Top = 8
-              Width = 37
+          end
+          object PlayerFiltersPanel: TSpTBXPanel
+            Left = 2
+            Top = 30
+            Width = 149
+            Height = 22
+            Align = alTop
+            TabOrder = 2
+            Borders = False
+            DesignSize = (
+              149
+              22)
+            object SpTBXLabel4: TSpTBXLabel
+              Left = 2
+              Top = 2
+              Width = 145
               Height = 13
-              Caption = 'Players:'
+              Hint = 
+                'Simple filtering : separate keywords by a space. Regular express' +
+                'ion filtering : re=my_regular_expression'
+              Caption = 'Filter :'
+              Align = alTop
+              ParentShowHint = False
+              ShowHint = True
               LinkFont.Charset = DEFAULT_CHARSET
               LinkFont.Color = clBlue
               LinkFont.Height = -11
               LinkFont.Name = 'MS Sans Serif'
               LinkFont.Style = [fsUnderline]
             end
+            object PlayerFiltersTextbox: TSpTBXEdit
+              Left = 40
+              Top = 0
+              Width = 108
+              Height = 21
+              Hint = 
+                'Simple filtering : separate keywords by a space. Regular express' +
+                'ion filtering : re=my_regular_expression'
+              Anchors = [akLeft, akTop, akRight]
+              ParentShowHint = False
+              ShowHint = True
+              TabOrder = 1
+              OnChange = PlayerFiltersTextboxChange
+            end
           end
         end
         object Splitter1: TSpTBXSplitter
           Left = 591
           Top = 2
           Width = 10
-          Height = 162
+          Height = 122
           Cursor = crSizeWE
           Caption = 'Splitter1'
           Align = alRight
@@ -1209,6 +1235,7 @@
       Width = 760
       Height = 41
       Caption = 'NewsMainPanel'
+      Align = alTop
       TabOrder = 3
       Visible = False
       Borders = False

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/MainUnit.pas	2009-02-03 17:22:21 UTC (rev 7236)
@@ -524,7 +524,7 @@
   );
 
 const
-  VERSION_NUMBER = '0.45'; // Must be float value! (with a period as a decimal seperator)
+  VERSION_NUMBER = '0.46'; // Must be float value! (with a period as a decimal seperator)
   CHECK_BETA_LOBBY_URL = '<A HREF="http://tasclient.no-ip.org/TASClient_update_v3.txt">http://tasclient.no-ip.org/TASClient_update_v3.txt</A>';
   PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER;
   KEEP_ALIVE_INTERVAL = 10000; // in milliseconds. Tells us what should be the maximum &quot;silence&quot; time before we send a ping to the server.
@@ -683,6 +683,8 @@
     AutoKickMsgSent : integer;
     AutoSpecMsgSent : integer;
 
+    Visible: boolean;
+
     ScriptIcons: TIntegerList;
 
     constructor Create(Name: WideString; Status: Integer; Country: string; CPU: Integer);
@@ -1177,7 +1179,6 @@
     ClientsListBox: TTntListBox;
     PlayersInfoPanel: TSpTBXPanel;
     SortLabel: TLabel;
-    btSearchPlayer: TSpTBXSpeedButton;
     PlayersLabel: TSpTBXLabel;
     Splitter1: TSpTBXSplitter;
     Panel4: TSpTBXPanel;
@@ -1188,11 +1189,14 @@
     SearchButton: TSpTBXSpeedButton;
     ConnectButton: TTBXButton;
     SinglePlayerButton: TSpTBXButton;
+    ScrollingNewsImter: TTimer;
     NewsMainPanel: TSpTBXPanel;
     ExpandNewsButton: TSpTBXButton;
-    ScrollingNewsImter: TTimer;
     ScrollingNewsPanel: TSpTBXPanel;
     NewsPanel: TSpTBXPanel;
+    PlayerFiltersPanel: TSpTBXPanel;
+    SpTBXLabel4: TSpTBXLabel;
+    PlayerFiltersTextbox: TSpTBXEdit;
     procedure mnuOpenPrivateChatClick(Sender: TObject);
     procedure mnuSelectBattleClick(Sender: TObject);
     procedure SpTBXItem1Click(Sender: TObject);
@@ -1333,6 +1337,7 @@
       var Cancel: WordBool);
     procedure OnNewsBrowserDocumentComplete(Sender: TObject;
       const pDisp: IDispatch; var URL: OleVariant);
+    procedure PlayerFiltersTextboxChange(Sender: TObject);
   published
     MainTitleBar: TSpTBXTitleBar;
     ButtonImageList: TImageList;
@@ -2475,6 +2480,7 @@
   Self.CupLadderList := TStringList.Create;
   Self.AutoKickMsgSent := 0;
   Self.AutoSpecMsgSent := 0;
+  Self.Visible := True;
   if not Preferences.ScriptsDisabled then
   begin
     Self.ScriptIcons := TIntegerList.Create;
@@ -4242,37 +4248,62 @@
   LastIndex: Integer;
   TempItemIndex: Integer;
   TempCount: Integer;
+  words: TStringList;
+  regExp: TRegExpr;
+  i,j: integer;
+  cList: TList;
 begin
-  LastIndex := ClientsListBox.TopIndex;
-  TempItemIndex := ClientsListBox.ItemIndex;
-  TempCount := ClientsListBox.Items.Count;
+  words := TStringList.Create;
+  regExp := TRegExpr.Create;
+  c := 0;
 
-  ClientsListBox.Items.BeginUpdate;
+  if PageControl1.ActivePage.Caption = LOCAL_TAB then
+    cList := AllClients
+  else
+    cList := (PageControl1.ActivePage as TMyTabSheet).Clients;
 
-  if PageControl1.ActivePage.Caption = LOCAL_TAB then
+  if LowerCase(LeftStr(PlayerFiltersTextbox.Text,3)) = 're=' then
   begin
-    c := AllClients.count;
-    if c = 0 then PlayersLabel.Caption := 'Players:' else
-      PlayersLabel.Caption := 'Players (' + IntToStr(c) + '):';
-    ClientsListBox.Items.SetTextW(PWideChar(WideString(CreateStrings(c))));
+    regExp.Expression := MidStr(PlayerFiltersTextbox.Text,4,90000);
+    for i:=0 to cList.Count-1 do
+    begin
+      try
+        TClient(cList[i]).Visible := RegExpr.ExecRegExpr(regExp.Expression,TClient(cList[i]).Name);
+      except
+        TClient(cList[i]).Visible := True;
+      end;
+      if TClient(cList[i]).Visible then Inc(c);
+    end;
   end
   else
-  if PageControl1.ActivePage.Caption[1] = '#' then // a channel tab
   begin
-    c := (PageControl1.ActivePage as TMyTabSheet).Clients.Count;
-    if c = 0 then PlayersLabel.Caption := 'Players:' else
-      PlayersLabel.Caption := 'Players (' + IntToStr(c) + '):';
-    ClientsListBox.Items.SetTextW(PWideChar(WideString(CreateStrings(c))));
-  end
-  else
-  begin // a private chat tab
-    c := (PageControl1.ActivePage as TMyTabSheet).Clients.Count;
-    if c = 0 then PlayersLabel.Caption := 'Players:' else
-      PlayersLabel.Caption := 'Players (' + IntToStr(c) + '):';
-    ClientsListBox.Items.SetTextW(PWideChar(WideString(CreateStrings(c))));
+    ParseDelimited(words,LowerCase(PlayerFiltersTextbox.Text),' ','');
+    for i:=0 to cList.Count-1 do
+    begin
+      TClient(cList[i]).Visible := True;
+      for j:=0 to words.Count-1 do
+      begin
+        TClient(cList[i]).Visible := (words[j] = '') or (Pos(words[j],LowerCase(TClient(cList[i]).Name)) &gt; 0);
+        if not TClient(cList[i]).Visible then break;
+      end;
+      if TClient(cList[i]).Visible then Inc(c);
+    end;
   end;
 
 
+  LastIndex := ClientsListBox.TopIndex;
+  TempItemIndex := ClientsListBox.ItemIndex;
+  TempCount := ClientsListBox.Items.Count;
+
+  ClientsListBox.Items.BeginUpdate;
+
+  if c = 0 then
+    PlayersLabel.Caption := 'Players:'
+  else
+    PlayersLabel.Caption := 'Players (' + IntToStr(c) + '):';
+  ClientsListBox.Items.SetTextW(PWideChar(WideString(CreateStrings(c))));
+
+
   // next line is important because if there are many players online, their statuses
   // will get updated more often and sometimes you won't be able to double click
   // on a player since clients list will get updated so fast it will reset your
@@ -7259,111 +7290,92 @@
   group: Integer;
   i: integer;
   tmp: integer;
+  cList: TList;
+  realIndex: integer;
 begin
   if PageControl1.ActivePage.Caption = LOCAL_TAB then
+    cList := AllClients
+  else
+    cList := (PageControl1.ActivePage as TMyTabSheet).Clients;
+
+  if (Index = 0) and (cList.Count = 0) then
   begin
-    if Index &gt; AllClients.Count-1 then Exit; // we just ignore it. It seems ClientsListBox hasn't been yet updated. This can happen when we remove items from it and we don't call UpdateClientsListBox right away, since we want to do some more things before that. Anyway, this should not happen, since ClientsListBox is changed only within the main VCL thread.
-
-    group := TClient(AllClients[Index]).GetGroup;
-    if (group &gt; -1) and (ClientsListBox.ItemIndex &lt;&gt; Index) then
-      (Control as TTntListBox).Canvas.Brush.Color := TClientGroup(ClientGroups[group]).Color;
-      
-    // this ensures the correct highlite color is used
     (Control as TTntListBox).Canvas.FillRect(Rect);
+    Exit;
+  end
+  else
+    if Index &gt; cList.Count-1 then Exit; // we just ignore it. It seems ClientsListBox hasn't been yet updated. This can happen when we remove items from it and we don't call UpdateClientsListBox right away, since we want to do some more things before that. Anyway, this should not happen, since ClientsListBox is changed only within the main VCL thread.
 
-    xpos := Rect.Left;
-    if odSelected in State then (Control as TTntListBox).Canvas.Font.Color := clWhite
-    else (Control as TTntListBox).Canvas.Font.Color := clBlack;
+  tmp := Index;
+  for i:=0 to cList.Count-1 do
+  begin
+    if TClient(cList[i]).Visible then Dec(tmp);
+    if tmp = -1 then break;
+  end;
+  realIndex := i;
 
-    PlayerStateImageList.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, TClient(AllClients[Index]).GetStateImageIndex);
-    Inc(xpos,PlayerStateImageList.Width+5);
+  group := TClient(cList[realIndex]).GetGroup;
+  if (group &gt; -1) and (ClientsListBox.ItemIndex &lt;&gt; Index) then
+    (Control as TTntListBox).Canvas.Brush.Color := TClientGroup(ClientGroups[group]).Color;
 
-    if Preferences.ShowFlags then
-    begin
-      FlagBitmap := GetFlagBitmap(TClient(AllClients[Index]).Country);
-      (Control as TTntListBox).Canvas.Draw(xpos, Rect.Top + 16 div 2 - FlagBitmap.Height div 2, FlagBitmap);
-      Inc(xpos, FlagBitmap.Width + 5);
-    end;
+  // this ensures the correct highlite color is used
+  (Control as TTntListBox).Canvas.FillRect(Rect);
 
-    WideCanvasTextOut((Control as TTntListBox).Canvas, xpos, Rect.Top, TClient(AllClients[Index]).Name);
-    Inc(xpos, WideCanvasTextWidth((Control as TTntListBox).Canvas,TClient(AllClients[Index]).Name));
+  xpos := Rect.Left;
+  PlayerStateImageList.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, TClient(cList[realIndex]).GetStateImageIndex);
+  Inc(xpos, PlayerStateImageList.Width + 5);
 
-    if TClient(AllClients[Index]).GetAccess then
-      PlayerStateImageList.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, 4);
-  end
-  else
+  if Preferences.ShowFlags then
   begin
-    if (Index = 0) and ((PageControl1.ActivePage as TMyTabSheet).Clients.Count = 0) then
-    begin // a special case when we must paint first &quot;item&quot; in empty list box:
-      // this ensures the correct highlite color is used
-      (Control as TTntListBox).Canvas.FillRect(Rect);
-      Exit;
-    end
-    else
-      if Index &gt; (PageControl1.ActivePage as TMyTabSheet).Clients.Count-1 then Exit; // we just ignore it. It seems ClientsListBox hasn't been yet updated. This can happen when we remove items from it and we don't call UpdateClientsListBox right away, since we want to do some more things before that. Anyway, this should not happen, since ClientsListBox is changed only within the main VCL thread.
+    FlagBitmap := GetFlagBitmap(TClient(cList[realIndex]).Country);
+    (Control as TTntListBox).Canvas.Draw(xpos, Rect.Top + 16 div 2 - FlagBitmap.Height div 2, FlagBitmap);
+    Inc(xpos, FlagBitmap.Width + 5);
+  end;
 
-    group := TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).GetGroup;
-    if (group &gt; -1) and (ClientsListBox.ItemIndex &lt;&gt; Index) then
-      (Control as TTntListBox).Canvas.Brush.Color := TClientGroup(ClientGroups[group]).Color;
+  if TClient(cList[realIndex]).GetAwayStatus and not TClient(cList[realIndex]).GetInGameStatus then
+    (Control as TTntListBox).Canvas.Font.Color := Colors.ClientAway
+  else
+    (Control as TTntListBox).Canvas.Font.Color := clWindowText;
 
-    // this ensures the correct highlite color is used
-    (Control as TTntListBox).Canvas.FillRect(Rect);
+  if odSelected in State then (Control as TTntListBox).Canvas.Font.Color := clWhite;
 
-    xpos := Rect.Left;
-    PlayerStateImageList.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).GetStateImageIndex);
-    Inc(xpos, PlayerStateImageList.Width + 5);
+  if TClient(cList[realIndex]).GetBotMode then
+  begin
+    (Control as TTntListBox).Canvas.Draw(xpos, Rect.Top, BotImage.Picture.Bitmap);
+    Inc(xpos, BotImage.Picture.Bitmap.Width + 4{leave some space between username and the icon});
+  end;
 
-    if Preferences.ShowFlags then
+  // ladder cup
+  with TClient(cList[realIndex]) do
+  begin
+    for i:=0 to CupList.Count-1 do
     begin
-      FlagBitmap := GetFlagBitmap(TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).Country);
-      (Control as TTntListBox).Canvas.Draw(xpos, Rect.Top + 16 div 2 - FlagBitmap.Height div 2, FlagBitmap);
-      Inc(xpos, FlagBitmap.Width + 5);
+      LadderCups.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, Integer(CupList[i]^));
+      Inc(xpos, LadderCups.Width + 1);
     end;
+  end;
 
-    if TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).GetAwayStatus and not TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).GetInGameStatus then
-      (Control as TTntListBox).Canvas.Font.Color := Colors.ClientAway
-    else (Control as TTntListBox).Canvas.Font.Color := clWindowText;
-    if odSelected in State then (Control as TTntListBox).Canvas.Font.Color := clWhite;
+  WideCanvasTextOut((Control as TTntListBox).Canvas, xpos, Rect.Top, TClient(cList[realIndex]).Name);
+  Inc(xpos, WideCanvasTextWidth((Control as TTntListBox).Canvas,TClient(cList[realIndex]).Name));
 
-    if TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).GetBotMode then
-    begin
-      (Control as TTntListBox).Canvas.Draw(xpos, Rect.Top, BotImage.Picture.Bitmap);
-      Inc(xpos, BotImage.Picture.Bitmap.Width + 4{leave some space between username and the icon});
-    end;
+  RanksImageList.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, TClient(cList[realIndex]).GetRank);
+  Inc(xpos, RanksImageList.Width + 1);
 
-    // ladder cup
-    with TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]) do
+  // custom icons
+  if not Preferences.ScriptsDisabled then
+    for i:=0 to lobbyScriptUnit.PlayerIconTypeNames.Count-1 do
     begin
-      for i:=0 to CupList.Count-1 do
+      tmp := TClient(cList[realIndex]).GetCustomIconId(i);
+      if (tmp &gt;= 0) and (TImageList(lobbyScriptUnit.PlayerIconTypeIcons[i]).Count &gt; tmp) then
       begin
-        LadderCups.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, Integer(CupList[i]^));
-        Inc(xpos, LadderCups.Width + 1);
+        TImageList(lobbyScriptUnit.PlayerIconTypeIcons[i]).Draw((Control as TTntListBox).Canvas, xpos, Rect.Top,tmp);
+        Inc(xpos, TImageList(lobbyScriptUnit.PlayerIconTypeIcons[i]).Width + 1);
       end;
     end;
 
-    WideCanvasTextOut((Control as TTntListBox).Canvas, xpos, Rect.Top, TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).Name);
-    Inc(xpos, WideCanvasTextWidth((Control as TTntListBox).Canvas,TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).Name));
 
-    RanksImageList.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).GetRank);
-    Inc(xpos, RanksImageList.Width + 1);
-
-    // custom icons
-    if not Preferences.ScriptsDisabled then
-      for i:=0 to lobbyScriptUnit.PlayerIconTypeNames.Count-1 do
-      begin
-        tmp := TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).GetCustomIconId(i);
-        if (tmp &gt;= 0) and (TImageList(lobbyScriptUnit.PlayerIconTypeIcons[i]).Count &gt; tmp) then
-        begin
-          TImageList(lobbyScriptUnit.PlayerIconTypeIcons[i]).Draw((Control as TTntListBox).Canvas, xpos, Rect.Top,tmp);
-          Inc(xpos, TImageList(lobbyScriptUnit.PlayerIconTypeIcons[i]).Width + 1);
-        end;
-      end;
-        
-
-    if TClient((PageControl1.ActivePage as TMyTabSheet).Clients[Index]).GetAccess then
-      PlayerStateImageList.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, 4);
-
-  end;
+  if TClient(cList[realIndex]).GetAccess then
+    PlayerStateImageList.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, 4);
 end;
 
 procedure TMainForm.TryToDisconnect;
@@ -7960,11 +7972,27 @@
 procedure TMainForm.ClientsListBoxDblClick(Sender: TObject);
 var
   ClientName: WideString;
+  tmp,realIndex: integer;
+  cList: TList;
+  i:integer;
 begin
   if ClientsListBox.ItemIndex = -1 then Exit; // I don't think this can actually happen, since we must click in ListBox and so select an item
-  if PageControl1.ActivePage.Caption = LOCAL_TAB then ClientName := TClient(AllClients[ClientsListBox.ItemIndex]).Name
-  else ClientName := TClient((PageControl1.ActivePage as TMyTabSheet).Clients[ClientsListBox.ItemIndex]).Name;
 
+  if PageControl1.ActivePage.Caption = LOCAL_TAB then
+    cList := AllClients
+  else
+    cList := (PageControl1.ActivePage as TMyTabSheet).Clients;
+
+  tmp := ClientsListBox.ItemIndex;
+  for i:=0 to cList.Count-1 do
+  begin
+    if TClient(cList[i]).Visible then Dec(tmp);
+    if tmp = -1 then break;
+  end;
+  realIndex := i;
+
+  ClientName := TClient(cList[realIndex]).Name;
+
   OpenPrivateChat(ClientName);
 end;
 
@@ -8964,7 +8992,13 @@
   tmp,tmp2: Integer;
   groupStr: String;
   i: integer;
+  realIndex: integer;
+  cList: TList;
 begin
+  if PageControl1.ActivePage.Caption = LOCAL_TAB then
+    cList := AllClients
+  else
+    cList := (PageControl1.ActivePage as TMyTabSheet).Clients;
 
   tmp := (Sender as TTntListBox).ItemAtPos(Point(X, Y), True);
   if tmp = -1 then
@@ -8973,34 +9007,31 @@
     Exit;
   end;
 
+  for i:=0 to cList.Count-1 do
+  begin
+    if TClient(cList[i]).Visible then Dec(tmp);
+    if tmp = -1 then break;
+  end;
+  realIndex := i;
+
   try
-    if PageControl1.ActivePage.Caption = LOCAL_TAB then
-    begin
-      groupStr := '';
-      if TClient(AllClients[tmp]).GetGroup &gt; -1 then
-        groupStr := ', '+TClientGroup(ClientGroups[TClient(AllClients[tmp]).GetGroup]).Name;
-      (Sender as TTntListBox).Hint := TClient(AllClients[tmp]).Name + ', ' + GetCountryName(TClient(AllClients[tmp]).Country)+groupStr;
-    end
-    else
-    begin
-      groupStr := '';
-      if TClient((PageControl1.ActivePage as TMyTabSheet).Clients[tmp]).GetGroup &gt; -1 then
-        groupStr := ', '+TClientGroup(ClientGroups[TClient((PageControl1.ActivePage as TMyTabSheet).Clients[tmp]).GetGroup]).Name;
-      (Sender as TTntListBox).Hint := TClient((PageControl1.ActivePage as TMyTabSheet).Clients[tmp]).Name + ', ' + GetCountryName(TClient((PageControl1.ActivePage as TMyTabSheet).Clients[tmp]).Country)+groupStr;
+    groupStr := '';
+    if TClient(cList[realIndex]).GetGroup &gt; -1 then
+      groupStr := ', '+TClientGroup(ClientGroups[TClient(cList[realIndex]).GetGroup]).Name;
+    (Sender as TTntListBox).Hint := TClient(cList[realIndex]).Name + ', ' + GetCountryName(TClient(cList[realIndex]).Country)+groupStr;
 
-      // cups
-      if TClient((PageControl1.ActivePage as TMyTabSheet).Clients[tmp]).CupLadderList.Count &gt; 0 then
-        (Sender as TTntListBox).Hint := (Sender as TTntListBox).Hint + ', '+Misc.JoinStringList(TClient((PageControl1.ActivePage as TMyTabSheet).Clients[tmp]).CupLadderList,', ');
+    // cups
+    if TClient(cList[realIndex]).CupLadderList.Count &gt; 0 then
+      (Sender as TTntListBox).Hint := (Sender as TTntListBox).Hint + ', '+Misc.JoinStringList(TClient(cList[realIndex]).CupLadderList,', ');
 
-      // custom icons
-      if not Preferences.ScriptsDisabled then
-      for i:=0 to lobbyScriptUnit.PlayerIconTypeNames.Count-1 do
+    // custom icons
+    if not Preferences.ScriptsDisabled then
+    for i:=0 to lobbyScriptUnit.PlayerIconTypeNames.Count-1 do
+    begin
+      tmp2 := TClient(cList[realIndex]).GetCustomIconId(i);
+      if (tmp2 &gt;= 0) and (TImageList(lobbyScriptUnit.PlayerIconTypeIcons[i]).Count &gt; tmp2) then
       begin
-        tmp2 := TClient((PageControl1.ActivePage as TMyTabSheet).Clients[tmp]).GetCustomIconId(i);
-        if (tmp2 &gt;= 0) and (TImageList(lobbyScriptUnit.PlayerIconTypeIcons[i]).Count &gt; tmp2) then
-        begin
-          (Sender as TTntListBox).Hint := (Sender as TTntListBox).Hint + ', ' + lobbyScriptUnit.PlayerIconTypeNames[i] + '=' + TStringList(lobbyScriptUnit.PlayerIconTypeIconsNames[i]).Strings[tmp2]
-        end;
+        (Sender as TTntListBox).Hint := (Sender as TTntListBox).Hint + ', ' + lobbyScriptUnit.PlayerIconTypeNames[i] + '=' + TStringList(lobbyScriptUnit.PlayerIconTypeIconsNames[i]).Strings[tmp2]
       end;
     end;
   except
@@ -10619,12 +10650,27 @@
   Client: TClient;
   ClientGroup : Integer;
   i : Integer;
+  tmp,realIndex: integer;
+  cList: TList;
 begin
+
   if RichEditSelectedClient = nil then // showing player context menu from the richedit
   begin
     if ClientsListBox.ItemIndex = -1 then Exit; // I don't think this can actually happen, since we must click in ListBox and so select an item
-    if PageControl1.ActivePage.Caption = LOCAL_TAB then Client := TClient(AllClients[ClientsListBox.ItemIndex])
-    else Client := TClient((PageControl1.ActivePage as TMyTabSheet).Clients[ClientsListBox.ItemIndex]);
+      if PageControl1.ActivePage.Caption = LOCAL_TAB then
+        cList := AllClients
+      else
+        cList := (PageControl1.ActivePage as TMyTabSheet).Clients;
+
+      tmp := ClientsListBox.ItemIndex;
+      for i:=0 to cList.Count-1 do
+      begin
+        if TClient(cList[i]).Visible then Dec(tmp);
+        if tmp = -1 then break;
+      end;
+      realIndex := i;
+
+      Client := TClient(cList[realIndex]);
   end
   else
     Client := RichEditSelectedClient;
@@ -11307,4 +11353,9 @@
   mainLogBufferColor.Clear;
 end;
 
+procedure TMainForm.PlayerFiltersTextboxChange(Sender: TObject);
+begin
+  UpdateClientsListBox;
+end;
+
 end.

Modified: Lobby/TASClient/MenuFormUnit.dfm
===================================================================
--- Lobby/TASClient/MenuFormUnit.dfm	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/MenuFormUnit.dfm	2009-02-03 17:22:21 UTC (rev 7236)
@@ -2,7 +2,7 @@
   Left = 609
   Top = 224
   BorderStyle = bsNone
-  Caption = 'MenuForm'
+  Caption = 'TASClient SP'
   ClientHeight = 671
   ClientWidth = 907
   Color = clBlack

Modified: Lobby/TASClient/Python/scripts/subf/testHideAutoHosts.py
===================================================================
--- Lobby/TASClient/Python/scripts/subf/testHideAutoHosts.py	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/Python/scripts/subf/testHideAutoHosts.py	2009-02-03 17:22:21 UTC (rev 7236)
@@ -7,6 +7,9 @@
 
 autoHostKeyWords = ['host','dedicated','spads','springie']
 
+def isUserBot(user):
+	return ((int(user['Status']) &amp; 0x40) &gt;&gt; 6) or isNameAutoHost(user['Name'])	
+
 def isNameAutoHost(name):
 	global autoHostKeyWords
 	for keyWord in autoHostKeyWords:
@@ -19,8 +22,7 @@
 
 	battles = api.GetBattles()
 	for id in battles:
-		print str((sEnabled == False) or (not isNameAutoHost(battles[id]['Hoster']['Name'])))
-		gui.SetBattleVisible(id,(sEnabled == False) or (not isNameAutoHost(battles[id]['Hoster']['Name'])))
+		gui.SetBattleVisible(id,(sEnabled == False) or (not isUserBot(battles[id]['Hoster'])))
 	
 def cmd_hideautohosts(data):
 	global sEnabled
@@ -39,6 +41,6 @@
 	if sEnabled: 
 		battles = api.GetBattles()
 		id = int(idStr)
-		if isNameAutoHost(battles[id]['Hoster']['Name']):
+		if isUserBot(battles[id]['Hoster']):
 			gui.SetBattleVisible(id,False)
 	
\ No newline at end of file

Modified: Lobby/TASClient/SpringDownloaderFormUnit.pas
===================================================================
--- Lobby/TASClient/SpringDownloaderFormUnit.pas	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/SpringDownloaderFormUnit.pas	2009-02-03 17:22:21 UTC (rev 7236)
@@ -4,7 +4,7 @@
 
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
-  Dialogs, SpTBXItem, SpTBXControls, TBXDkPanels, JclRegistry, ExtCtrls;
+  Dialogs, SpTBXItem, SpTBXControls, TBXDkPanels, JclRegistry, ExtCtrls,ShellAPI;
 
 type
   TSpringDownloaderForm = class(TForm)
@@ -251,6 +251,7 @@
 procedure StartSpringDownloader;
 var
   path : string;
+  tmp: integer;
 begin
   if not RegKeyExists(HKLM,'Software\Microsoft\NET Framework Setup\NDP\v2.0.50727') or not RegReadBool(HKLM,'Software\Microsoft\NET Framework Setup\NDP\v2.0.50727','Install') then
   begin
@@ -267,16 +268,9 @@
   path := LeftStr(path,Length(path)-1);
   try DeleteRegKey('Software\SpringDownloader\'+path+'\request\ExitRequest',HKCU); except end;
 
-  FillChar(SpringDownloaderProcess.proc_info, sizeof(TProcessInformation), 0);
-  FillChar(SpringDownloaderProcess.startinfo, sizeof(TStartupInfo), 0);
-  SpringDownloaderProcess.startinfo.cb := sizeof(TStartupInfo);
+  tmp := ShellExecute(0,'open',PChar(ExtractFilePath(Application.ExeName) + 'SpringDownloader.exe'),PChar('-silentstart'),PChar(ExtractFilePath(Application.ExeName)),SW_SHOWNORMAL);
 
-  if not CreateProcess(nil, PChar(ExtractFilePath(Application.ExeName) + 'SpringDownloader.exe -silentstart'), nil, nil, false, CREATE_DEFAULT_ERROR_MODE + NORMAL_PRIORITY_CLASS + SYNCHRONIZE,
-    nil, PChar(ExtractFilePath(Application.ExeName)), SpringDownloaderProcess.startinfo, SpringDownloaderProcess.proc_info) then
-  begin
-    CloseHandle(SpringDownloaderProcess.proc_info.hProcess);
-    Application.MessageBox('Couldn''t execute SpringDownloader', 'Error', MB_ICONEXCLAMATION);
-  end;
+  if (tmp &gt; 0) and (tmp &lt; 32) then MessageDlg('Couldn''t execute SpringDownloader', mtWarning, [mbOK], 0);
 end;
 procedure CloseSpringDownloader;
 var
@@ -290,7 +284,6 @@
   path := LeftStr(path,Length(path)-1);
 
   RegWriteMultiSz(HKCU,'\Software\SpringDownloader\'+path+'\request\','ExitRequest',sl);
-  try CloseHandle(SpringDownloaderProcess.proc_info.hProcess);except end;
 end;
 
 end.

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/TASClient.dof	2009-02-03 17:22:21 UTC (rev 7236)
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=3
 Release=0
-Build=570
+Build=571
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=TA Spring lobby client
-FileVersion=0.3.0.570
+FileVersion=0.3.0.571
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)

Modified: Lobby/TASClient/Utility.pas
===================================================================
--- Lobby/TASClient/Utility.pas	2009-02-01 14:22:44 UTC (rev 7235)
+++ Lobby/TASClient/Utility.pas	2009-02-03 17:22:21 UTC (rev 7236)
@@ -229,6 +229,7 @@
 
   MapList: TStringList;
   MapChecksums: TStringList;
+  MapMainArchive: TStringList;
 
   LastInitSuccess: Boolean = True; // check this var to see if last call to InitLib/ReInitLib was successful!
 
@@ -333,6 +334,7 @@
 
   MapList.Clear;
   MapCheckSums.Clear;
+  MapMainArchive.Clear;
   MapListForm.ClearMapList;
 
   time := GetTickCount;
@@ -366,7 +368,7 @@
      end;
      if MapCheckSums.IndexOf(IntToHex(CheckSum, 8)) &lt;&gt; -1 then
      begin
-       MainForm.AddMainLog('Skipping map file: ' + MapName + ' (duplicate checksum)', Colors.Error);
+       MainForm.AddMainLog('Skipping map file: &quot;' + MapName + '&quot;, duplicate checksum of file &quot;'+ExtractFileName(MapMainArchive[MapCheckSums.IndexOf(IntToHex(CheckSum, 8))])+'&quot;', Colors.Error);
        Continue;
      end;
 
@@ -374,6 +376,7 @@
      if UpdateSplashScreen then SplashScreenForm.UpdateText('loading map (' + MapName + ')');
      MapList.Add(MapName);
      MapCheckSums.Add(IntToHex(CheckSum, 8));
+     MapMainArchive.Add(GetMapArchiveName(0));
      MapListForm.AddMap;
      TMapItem(MapListForm.Maps[MapListForm.Maps.Count-1]).LoadMapInfo;
      TMapItem(MapListForm.Maps[MapListForm.Maps.Count-1]).LoadMinimap(True);
@@ -1122,6 +1125,7 @@
   SideImageList := TImageList.CreateSize(16, 16);
   MapList := TStringList.Create;
   MapChecksums := TStringList.Create;
+  MapMainArchive := TStringList.Create;
 
 finalization
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002004.html">[Taspring-linux-commit] r7235 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="002006.html">[Taspring-linux-commit] r7237 - in Lobby/TASClient: . ScrollingNews
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2005">[ date ]</a>
              <a href="thread.html#2005">[ thread ]</a>
              <a href="subject.html#2005">[ subject ]</a>
              <a href="author.html#2005">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
