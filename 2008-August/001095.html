<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6325 - in trunk/Lobby/TASClient: . Python	Python/scripts/subf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-August/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6325%20-%20in%20trunk/Lobby/TASClient%3A%20.%20Python%0A%09Python/scripts/subf&In-Reply-To=%3C20080828144207.BF11649AF%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001094.html">
   <LINK REL="Next"  HREF="001096.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6325 - in trunk/Lobby/TASClient: . Python	Python/scripts/subf</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6325%20-%20in%20trunk/Lobby/TASClient%3A%20.%20Python%0A%09Python/scripts/subf&In-Reply-To=%3C20080828144207.BF11649AF%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6325 - in trunk/Lobby/TASClient: . Python	Python/scripts/subf">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Thu Aug 28 16:42:07 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001094.html">[Taspring-linux-commit] r6324 - in trunk: . rts/Game	tools/DemoAnalyser tools/DemoDumper
</A></li>
        <LI>Next message: <A HREF="001096.html">[Taspring-linux-commit] r6326 - in trunk/installer: . sections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1095">[ date ]</a>
              <a href="thread.html#1095">[ thread ]</a>
              <a href="subject.html#1095">[ subject ]</a>
              <a href="author.html#1095">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2008-08-28 16:42:06 +0200 (Thu, 28 Aug 2008)
New Revision: 6325

Added:
   trunk/Lobby/TASClient/Python/scripts/subf/layoutTest.py
Modified:
   trunk/Lobby/TASClient/BattleFormUnit.dfm
   trunk/Lobby/TASClient/BattleFormUnit.pas
   trunk/Lobby/TASClient/LobbyScriptUnit.pas
   trunk/Lobby/TASClient/LogonFormUnit.dfm
   trunk/Lobby/TASClient/LogonFormUnit.pas
   trunk/Lobby/TASClient/MainUnit.dfm
   trunk/Lobby/TASClient/MainUnit.pas
   trunk/Lobby/TASClient/Python/api.txt
   trunk/Lobby/TASClient/TASClient.dof
   trunk/Lobby/TASClient/TASClient.res
Log:
* logon form : Enter on port, password or login textboxes log you in
* automaticaly login at start bug fixed
* python : new (useless ?) functions to change the layout : GetControlProperties, SetControlProperties (to change the pos, size, alignment, parent, anchors and visibility), AddPanel, AddSplitter, AddTabsPanel, AddTab + a layoutTest.py to show how it works

Modified: trunk/Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/BattleFormUnit.dfm	2008-08-28 11:14:55 UTC (rev 6324)
+++ trunk/Lobby/TASClient/BattleFormUnit.dfm	2008-08-28 14:42:06 UTC (rev 6325)
@@ -4068,16 +4068,6 @@
       Height = 275
       Align = alTop
       TabOrder = 3
-      object Splitter3: TSplitter
-        Left = 346
-        Top = 1
-        Width = 5
-        Height = 273
-        Align = alRight
-        AutoSnap = False
-        ResizeStyle = rsUpdate
-        Visible = False
-      end
       object Panel5: TPanel
         Left = 351
         Top = 1
@@ -4123,75 +4113,6 @@
             CustomWidth = 103
             ThemeType = tttNone
           end
-          object SpTBXTabSheet1: TSpTBXTabSheet
-            Left = 0
-            Top = 34
-            Width = 419
-            Height = 239
-            Caption = 'Disabled Units (0)'
-            ImageIndex = -1
-            DesignSize = (
-              419
-              239)
-            TabItem = 'DisabledUnitsTab'
-            object UnitsGroupBox: TSpTBXGroupBox
-              Left = 8
-              Top = 4
-              Width = 401
-              Height = 226
-              Caption = 'Disabled units'
-              Anchors = [akLeft, akTop, akBottom]
-              Color = clNone
-              ParentColor = False
-              TabOrder = 0
-              DesignSize = (
-                401
-                226)
-              object AddUnitsSpeedButton: TSpeedButton
-                Left = 264
-                Top = 10
-                Width = 121
-                Height = 22
-                Caption = 'Add more units'
-                OnClick = AddUnitsSpeedButtonClick
-              end
-              object VDTDisabledUnits: TVirtualDrawTree
-                Left = 16
-                Top = 32
-                Width = 369
-                Height = 182
-                Anchors = [akLeft, akTop, akRight, akBottom]
-                DefaultNodeHeight = 64
-                Header.AutoSizeIndex = 1
-                Header.Font.Charset = DEFAULT_CHARSET
-                Header.Font.Color = clWindowText
-                Header.Font.Height = -11
-                Header.Font.Name = 'MS Sans Serif'
-                Header.Font.Style = []
-                Header.Options = [hoAutoResize, hoColumnResize, hoDrag]
-                TabOrder = 0
-                TreeOptions.PaintOptions = [toHideFocusRect, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
-                TreeOptions.SelectionOptions = [toFullRowSelect]
-                OnDrawNode = VDTDisabledUnitsDrawNode
-                Columns = &lt;
-                  item
-                    Position = 0
-                    Width = 64
-                    WideText = 'Icon'
-                  end
-                  item
-                    Position = 1
-                    Width = 201
-                    WideText = 'FullName'
-                  end
-                  item
-                    Position = 2
-                    Width = 100
-                    WideText = 'Code name'
-                  end&gt;
-              end
-            end
-          end
           object MapTabSheet: TSpTBXTabSheet
             Left = 0
             Top = 34
@@ -4272,6 +4193,75 @@
               end
             end
           end
+          object SpTBXTabSheet1: TSpTBXTabSheet
+            Left = 0
+            Top = 34
+            Width = 419
+            Height = 239
+            Caption = 'Disabled Units (0)'
+            ImageIndex = -1
+            DesignSize = (
+              419
+              239)
+            TabItem = 'DisabledUnitsTab'
+            object UnitsGroupBox: TSpTBXGroupBox
+              Left = 8
+              Top = 4
+              Width = 401
+              Height = 226
+              Caption = 'Disabled units'
+              Anchors = [akLeft, akTop, akBottom]
+              Color = clNone
+              ParentColor = False
+              TabOrder = 0
+              DesignSize = (
+                401
+                226)
+              object AddUnitsSpeedButton: TSpeedButton
+                Left = 264
+                Top = 10
+                Width = 121
+                Height = 22
+                Caption = 'Add more units'
+                OnClick = AddUnitsSpeedButtonClick
+              end
+              object VDTDisabledUnits: TVirtualDrawTree
+                Left = 16
+                Top = 32
+                Width = 369
+                Height = 182
+                Anchors = [akLeft, akTop, akRight, akBottom]
+                DefaultNodeHeight = 64
+                Header.AutoSizeIndex = 1
+                Header.Font.Charset = DEFAULT_CHARSET
+                Header.Font.Color = clWindowText
+                Header.Font.Height = -11
+                Header.Font.Name = 'MS Sans Serif'
+                Header.Font.Style = []
+                Header.Options = [hoAutoResize, hoColumnResize, hoDrag]
+                TabOrder = 0
+                TreeOptions.PaintOptions = [toHideFocusRect, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
+                TreeOptions.SelectionOptions = [toFullRowSelect]
+                OnDrawNode = VDTDisabledUnitsDrawNode
+                Columns = &lt;
+                  item
+                    Position = 0
+                    Width = 64
+                    WideText = 'Icon'
+                  end
+                  item
+                    Position = 1
+                    Width = 201
+                    WideText = 'FullName'
+                  end
+                  item
+                    Position = 2
+                    Width = 100
+                    WideText = 'Code name'
+                  end&gt;
+              end
+            end
+          end
           object ModTabSheet: TSpTBXTabSheet
             Left = 0
             Top = 34
@@ -4627,7 +4617,7 @@
       object Panel6: TPanel
         Left = 1
         Top = 1
-        Width = 345
+        Width = 350
         Height = 273
         Align = alClient
         BevelOuter = bvNone
@@ -4636,7 +4626,7 @@
         object MapPanel: TSpTBXPanel
           Left = 0
           Top = 0
-          Width = 345
+          Width = 350
           Height = 273
           Align = alClient
           Color = clNone
@@ -4646,12 +4636,12 @@
           OnResize = MapPanelResize
           TBXStyleBackground = True
           DesignSize = (
-            345
+            350
             273)
           object Bevel2: TBevel
             Left = 0
             Top = 219
-            Width = 345
+            Width = 350
             Height = 46
             Anchors = [akLeft, akRight, akBottom]
             Shape = bsTopLine
@@ -4659,7 +4649,7 @@
           object MapImage: TImageEx
             Left = 5
             Top = 5
-            Width = 216
+            Width = 221
             Height = 216
             Cursor = crHandPoint
             Hint = 'No map'
@@ -4675,7 +4665,7 @@
           object MapDescLabel: TSpTBXLabel
             Left = 8
             Top = 224
-            Width = 329
+            Width = 334
             Height = 41
             Caption = 'MapDescLabel'
             Anchors = [akLeft, akRight, akBottom]
@@ -4691,7 +4681,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object TidalStrengthLabel: TSpTBXLabel
-            Left = 232
+            Left = 237
             Top = 143
             Width = 76
             Height = 13
@@ -4704,7 +4694,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object GravityLabel: TSpTBXLabel
-            Left = 232
+            Left = 237
             Top = 158
             Width = 45
             Height = 13
@@ -4717,7 +4707,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object MaxMetalLabel: TSpTBXLabel
-            Left = 232
+            Left = 237
             Top = 173
             Width = 63
             Height = 13
@@ -4730,7 +4720,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object ExtRadiusLabel: TSpTBXLabel
-            Left = 232
+            Left = 237
             Top = 188
             Width = 85
             Height = 13
@@ -4743,7 +4733,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object WindLabel: TSpTBXLabel
-            Left = 232
+            Left = 237
             Top = 203
             Width = 86
             Height = 13
@@ -4756,7 +4746,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object SpTBXPanel1: TSpTBXPanel
-            Left = 224
+            Left = 229
             Top = 4
             Width = 113
             Height = 122
@@ -4827,7 +4817,7 @@
             end
           end
           object MapSizeLabel: TSpTBXLabel
-            Left = 232
+            Left = 237
             Top = 128
             Width = 54
             Height = 13

Modified: trunk/Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/BattleFormUnit.pas	2008-08-28 11:14:55 UTC (rev 6324)
+++ trunk/Lobby/TASClient/BattleFormUnit.pas	2008-08-28 14:42:06 UTC (rev 6325)
@@ -300,7 +300,6 @@
     TBXButton1: TTBXButton;
     TBXButton2: TTBXButton;
     MapSizeLabel: TSpTBXLabel;
-    Splitter3: TSplitter;
     KeepRatioItem: TSpTBXItem;
     SpTBXSeparatorItem7: TSpTBXSeparatorItem;
     SpTBXItem12: TSpTBXItem;

Modified: trunk/Lobby/TASClient/LobbyScriptUnit.pas
===================================================================
--- trunk/Lobby/TASClient/LobbyScriptUnit.pas	2008-08-28 11:14:55 UTC (rev 6324)
+++ trunk/Lobby/TASClient/LobbyScriptUnit.pas	2008-08-28 14:42:06 UTC (rev 6325)
@@ -6,7 +6,8 @@
   Misc,ExtCtrls, WrapDelphi, WrapDelphiClasses,PythonEngine,
   PythonGUIInputOutput, Forms, StrUtils,Classes, JclDebug,
   WSocket,MainUnit, class_TIntegerList, RichEdit2, ExRichEdit,
-  SyncObjs,SpTBXItem, TB2Item, JvDesktopAlert;
+  SyncObjs,SpTBXItem, TB2Item, JvDesktopAlert, Controls,
+  SpTBXControls, SpTBXTabs;
 
 type
   TScriptNotificationCallback = record
@@ -36,12 +37,17 @@
     protected
       menuIdInc : integer;
       MenuItemList: TList;
+      CS: TCriticalSection;
 
+      pyProperties: PPyObject;
+
       function GetMenu(name: string): TTBCustomItem;
       function GetMenuSelectedId(menu: TTBCustomItem): string;
       procedure MenuItemClick(Sender: TObject);
       function GetFreeMenuId: integer;
       procedure NotificationClick(Sender: TObject);
+      procedure LockGUI;
+      procedure UnlockGUI;
 
     public
       constructor Create;
@@ -53,6 +59,13 @@
       procedure DisplaySimpleNotification(title: string; msg: string; displayTime: integer);
       procedure DisplayNotification(title: string; msg: string; callInArgs: Variant; callbackModuleName: string; callbackFunctionName: string; displayTime: integer);
 
+      function GetControlProperties(component: string): Variant;
+      function SetControlProperties(component: string; propertiesV : Variant): boolean;
+      function AddPanel(name: string;parent : string):boolean;
+      function AddSplitter(name: string;parent : string):boolean;
+      function AddTabsPanel(name: string;parent : string):boolean;
+      function AddTab(caption: string;name: string;tabsPanel : string):boolean;
+
       procedure RemoveFromMenu(id: integer);
   end;
 
@@ -177,6 +190,9 @@
   procedure SafeDecRef(o : PPyObject);
   procedure PostMsgs;
   procedure JoinBattle;
+  function GetComponentFromString(component: string): TComponent;
+  function GetStringFromComponent(component : TComponent): string;
+
 var
   MainThreadState: PPyThreadState;
   MainInterpreterState: PPyInterpreterState;
@@ -772,7 +788,7 @@
     pyGroups := PyDict_New();
 
     RefreshPythonLists;
-    
+
     for i:=0 to pyGroupList.Count-1 do
       PyDict_SetItemString(pyGroups,PChar(TClientGroup(ClientGroups[i]).Name),PPyObject(pyGroupList[i]));
 
@@ -1218,6 +1234,9 @@
 begin
   menuIdInc :=1;
   MenuItemList := TList.Create;
+  CS := TCriticalSection.Create;
+
+  pyProperties := GetPythonEngine.Py_None;
 end;
 
 function TGUI.GetFreeMenuId: integer;
@@ -1493,6 +1512,194 @@
   ReleaseMainThread;
 end;
 
+function TGUI.GetControlProperties(component: string): Variant;
+var
+  c : TWinControl;
+begin
+  Result := GetPythonEngine.PyObjectAsVariant(GetPythonEngine.Py_None);
+  try
+    c := GetComponentFromString(component) as TWinControl;
+  except
+    Exit;
+  end;
+
+  LockGUI;
+  with GetPythonEngine do
+  begin
+    SafeDecRef(pyProperties);
+    pyProperties := PyDict_New();
+
+    PyDict_SetItemStringDecRef(pyProperties,'x',c.Left);
+    PyDict_SetItemStringDecRef(pyProperties,'y',c.Top);
+    PyDict_SetItemStringDecRef(pyProperties,'width',c.Width);
+    PyDict_SetItemStringDecRef(pyProperties,'height',c.Height);
+
+    if c.Align = alNone then
+      PyDict_SetItemStringDecRef(pyProperties,'align',0)
+    else if c.Align = alTop then
+      PyDict_SetItemStringDecRef(pyProperties,'align',1)
+    else if c.Align = alBottom then
+      PyDict_SetItemStringDecRef(pyProperties,'align',2)
+    else if c.Align = alLeft then
+      PyDict_SetItemStringDecRef(pyProperties,'align',3)
+    else if c.Align = alRight then
+      PyDict_SetItemStringDecRef(pyProperties,'align',4)
+    else if c.Align = alClient then
+      PyDict_SetItemStringDecRef(pyProperties,'align',5)
+    else
+      PyDict_SetItemStringDecRef(pyProperties,'align',6);
+
+    PyDict_SetItemStringDecRef(pyProperties,'leftAnchor',akLeft in c.Anchors);
+    PyDict_SetItemStringDecRef(pyProperties,'rightAnchor',akRight in c.Anchors);
+    PyDict_SetItemStringDecRef(pyProperties,'topAnchor',akTop in c.Anchors);
+    PyDict_SetItemStringDecRef(pyProperties,'bottomAnchor',akBottom in c.Anchors);
+
+    PyDict_SetItemStringDecRef(pyProperties,'visible',c.Visible);
+
+    PyDict_SetItemStringDecRef(pyProperties,'parent',GetStringFromComponent(c.GetParentComponent));
+
+    Result := PyObjectAsVariant(pyProperties);
+  end;
+  UnlockGUI;
+end;
+
+function TGUI.SetControlProperties(component: string; propertiesV : Variant): boolean;
+var
+  c : TWinControl;
+  properties: PPyObject;
+  x,y,width,height,align : integer;
+  leftAnchor,rightAnchor,topAnchor,bottomAnchor,visible : boolean;
+  parent: string;
+begin
+  Result := False;
+
+  try
+    with GetPythonEngine do
+    begin
+      properties := VariantAsPyObject(propertiesV);
+
+      if not PyDict_Check(properties) then Exit;
+
+      x := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('x')));
+      y := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('y')));
+      width := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('width')));
+      height := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('height')));
+      align := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('align')));
+
+      leftAnchor := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('leftAnchor'))) &lt;&gt; 0;
+      rightAnchor := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('rightAnchor'))) &lt;&gt; 0;
+      topAnchor := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('topAnchor'))) &lt;&gt; 0;
+      bottomAnchor := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('bottomAnchor'))) &lt;&gt; 0;
+
+      visible := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('visible'))) &lt;&gt; 0;
+
+      parent := PyString_AsString(PyDict_GetItem(properties,PyString_FromString('parent')));
+    end;
+
+    c := GetComponentFromString(component) as TWinControl;
+
+    c.Parent := GetComponentFromString(parent) as TWinControl;
+    case align of
+      0:c.Align := alNone;
+      1:c.Align := alTop;
+      2:c.Align := alBottom;
+      3:c.Align := alLeft;
+      4:c.Align := alRight;
+      5:c.Align := alClient;
+      6:c.Align := alCustom;
+    end;
+    c.Anchors := [];
+    c.Width := width;
+    c.Height := height;
+    c.Top := y;
+    c.Left := x;
+    if leftAnchor then
+      c.Anchors := c.Anchors + [akLeft];
+    if rightAnchor then
+      c.Anchors := c.Anchors + [akRight];
+    if topAnchor then
+      c.Anchors := c.Anchors + [akTop];
+    if bottomAnchor then
+      c.Anchors := c.Anchors + [akBottom];
+
+    c.Visible := visible;
+
+    Result := True;
+  except
+    Result := False;
+  end;
+end;
+
+function TGUI.AddPanel(name: string;parent : string):boolean;
+var
+  p: TPanel;
+begin
+  try
+    p := TPanel.Create(GetComponentFromString(parent));
+    p.Parent := GetComponentFromString(parent) as TWinControl;
+    p.Name := name;
+    p.BevelInner := bvNone;
+    p.BevelOuter := bvNone;
+    p.Caption := '';
+    Result := True;
+  except
+    Result := False;
+  end;
+end;
+
+function TGUI.AddSplitter(name: string;parent : string):boolean;
+var
+  p: TSpTBXSplitter;
+begin
+  try
+    p := TSpTBXSplitter.Create(GetComponentFromString(parent));
+    p.Parent := GetComponentFromString(parent) as TWinControl;
+    p.Name := name;
+    p.ResizeStyle := rsUpdate;
+    p.Align := alTop;
+    Result := True;
+  except
+    Result := False;
+  end;
+end;
+
+function TGUI.AddTabsPanel(name: string;parent : string):boolean;
+var
+  p: TSpTBXTabControl;
+begin
+  try
+    p := TSpTBXTabControl.Create(GetComponentFromString(parent));
+    p.Parent := GetComponentFromString(parent) as TWinControl;
+    p.Name := name;
+    Result := True;
+  except
+    Result := False;
+  end;
+end;
+
+function TGUI.AddTab(caption: string;name: string;tabsPanel : string):boolean;
+var
+  p: TSpTBXTabControl;
+begin
+  try
+    p := GetComponentFromString(tabsPanel) as TSpTBXTabControl;
+    p.Add(caption);
+    p.Pages[p.PagesCount-1].Name := name;
+    Result := True;
+  except
+    Result := False;
+  end;
+end;
+
+procedure TGUI.LockGUI;
+begin
+  CS.Enter;
+end;
+procedure TGUI.UnlockGUI;
+begin
+  CS.Leave;
+end;
+
 // We override the constructors
 
 constructor TPyCallback.Create( APythonType : TPythonType );
@@ -1680,5 +1887,44 @@
   try if o &lt;&gt; GetPythonEngine.Py_None then GetPythonEngine.Py_XDECREF(o); except end;
 end;
 
+function GetComponentFromString(component: string): TComponent;
+var
+  c: TComponent;
+  componentList: TStringList;
+  i: integer;
+begin
+  Result := nil;
+  componentList := TStringList.Create;
 
+  ParseDelimited(componentList,component,'.','');
+
+  if componentList.Count = 0 then
+    Exit;
+
+  c := Application;
+  for i:=0 to componentList.Count-1 do
+    c := c.FindComponent(componentList[i]);
+
+  Result := c;
+end;
+
+function GetStringFromComponent(component : TComponent): string;
+var
+  c : TComponent;
+  sl: TStringList;
+begin
+  sl := TStringList.Create;
+  c := component;
+
+  sl.Add(c.Name);
+  while c.Owner.ClassType &lt;&gt; TApplication do
+  begin
+    sl.Insert(0,c.Owner.Name);
+    c := c.Owner;
+  end;
+
+  Result := JoinStringList(sl,'.');
+end;
+
+
 end.

Modified: trunk/Lobby/TASClient/LogonFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/LogonFormUnit.dfm	2008-08-28 11:14:55 UTC (rev 6324)
+++ trunk/Lobby/TASClient/LogonFormUnit.dfm	2008-08-28 14:42:06 UTC (rev 6325)
@@ -52,6 +52,7 @@
         Height = 21
         TabOrder = 1
         Text = '8200'
+        OnKeyPress = txtPortKeyPress
       end
       object lblPort: TSpTBXLabel
         Left = 16
@@ -111,6 +112,7 @@
         Width = 137
         Height = 21
         TabOrder = 1
+        OnKeyPress = txtLoginKeyPress
       end
       object txtPassword: TSpTBXEdit
         Left = 136
@@ -119,6 +121,7 @@
         Height = 21
         TabOrder = 2
         OnChange = txtPasswordChange
+        OnKeyPress = txtPasswordKeyPress
         PasswordCharW = '*'
       end
       object lblPassword: TSpTBXLabel

Modified: trunk/Lobby/TASClient/LogonFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/LogonFormUnit.pas	2008-08-28 11:14:55 UTC (rev 6324)
+++ trunk/Lobby/TASClient/LogonFormUnit.pas	2008-08-28 14:42:06 UTC (rev 6325)
@@ -34,6 +34,9 @@
     procedure beLadderPasswordSubEditButton0Click(Sender: TObject);
     procedure btRegisterClick(Sender: TObject);
     procedure btRegisterLadderClick(Sender: TObject);
+    procedure txtLoginKeyPress(Sender: TObject; var Key: Char);
+    procedure txtPasswordKeyPress(Sender: TObject; var Key: Char);
+    procedure txtPortKeyPress(Sender: TObject; var Key: Char);
   private
     { Private declarations }
   public
@@ -143,4 +146,22 @@
   PreferencesForm.RegisterLadderAccountButtonClick(nil);
 end;
 
+procedure TLogonForm.txtLoginKeyPress(Sender: TObject; var Key: Char);
+begin
+  if Key = #13 then
+    btLoginClick(nil);
+end;
+
+procedure TLogonForm.txtPasswordKeyPress(Sender: TObject; var Key: Char);
+begin
+  if Key = #13 then
+    btLoginClick(nil);
+end;
+
+procedure TLogonForm.txtPortKeyPress(Sender: TObject; var Key: Char);
+begin
+  if Key = #13 then
+    btLoginClick(nil);
+end;
+
 end.

Modified: trunk/Lobby/TASClient/MainUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/MainUnit.dfm	2008-08-28 11:14:55 UTC (rev 6324)
+++ trunk/Lobby/TASClient/MainUnit.dfm	2008-08-28 14:42:06 UTC (rev 6325)
@@ -1,8 +1,8 @@
 object MainForm: TMainForm
-  Left = 777
-  Top = 349
-  Width = 808
-  Height = 549
+  Left = 627
+  Top = 343
+  Width = 729
+  Height = 543
   Caption = '.'
   Color = clBtnFace
   Constraints.MaxHeight = 1000
@@ -24,14 +24,14 @@
   object MainTitleBar: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 800
-    Height = 522
+    Width = 721
+    Height = 516
     Caption = 'TASClient'
     object Panel2: TSpTBXPanel
-      Left = 643
+      Left = 564
       Top = 30
       Width = 153
-      Height = 488
+      Height = 482
       Align = alRight
       Color = clNone
       Constraints.MinWidth = 1
@@ -41,7 +41,7 @@
       BorderType = pbrFramed
       DesignSize = (
         153
-        488)
+        482)
       object Bevel1: TBevel
         Left = 2
         Top = 2
@@ -87,7 +87,7 @@
         Left = 2
         Top = 26
         Width = 149
-        Height = 460
+        Height = 454
         Style = lbOwnerDrawFixed
         Align = alClient
         Font.Charset = DEFAULT_CHARSET
@@ -131,8 +131,8 @@
     object Panel1: TSpTBXPanel
       Left = 4
       Top = 30
-      Width = 629
-      Height = 488
+      Width = 550
+      Height = 482
       Caption = 'Panel1'
       Align = alClient
       TabOrder = 2
@@ -141,7 +141,7 @@
       object Bevel2: TBevel
         Left = 2
         Top = 43
-        Width = 625
+        Width = 546
         Height = 4
         Align = alTop
         Shape = bsSpacer
@@ -265,24 +265,24 @@
       end
       object Panel3: TPanel
         Left = 2
-        Top = 211
-        Width = 625
-        Height = 275
-        Align = alClient
+        Top = 210
+        Width = 546
+        Height = 270
+        Align = alBottom
         BevelOuter = bvNone
         TabOrder = 0
         object BattlesPanel: TSpTBXPanel
           Left = 0
           Top = 0
-          Width = 625
-          Height = 275
+          Width = 546
+          Height = 270
           Align = alClient
           TabOrder = 0
           Borders = False
           object QuickJoinPanel: TSpTBXPanel
             Left = 2
             Top = 2
-            Width = 621
+            Width = 542
             Height = 25
             Hint = 'Quick join panel'
             Caption = 'QuickJoinPanel'
@@ -290,7 +290,7 @@
             TabOrder = 1
             Borders = False
             DesignSize = (
-              621
+              542
               25)
             object SpTBXLabel1: TSpTBXLabel
               Left = 0
@@ -314,7 +314,7 @@
               LinkFont.Style = [fsUnderline]
             end
             object btSpecatateNow: TSpTBXButton
-              Left = 524
+              Left = 445
               Top = 0
               Width = 97
               Height = 22
@@ -340,7 +340,7 @@
               LinkFont.Style = [fsUnderline]
             end
             object btPlayNow: TSpTBXButton
-              Left = 418
+              Left = 339
               Top = 0
               Width = 97
               Height = 22
@@ -381,8 +381,8 @@
           object VDTBattles: TVirtualDrawTree
             Left = 2
             Top = 27
-            Width = 621
-            Height = 61
+            Width = 542
+            Height = 56
             Align = alClient
             BevelInner = bvNone
             BevelOuter = bvNone
@@ -493,8 +493,8 @@
           end
           object FilterGroup: TSpTBXPanel
             Left = 2
-            Top = 100
-            Width = 621
+            Top = 95
+            Width = 542
             Height = 173
             Caption = 'FilterGroup'
             Align = alBottom
@@ -502,12 +502,12 @@
             OnResize = FilterGroupResize
             Borders = False
             DesignSize = (
-              621
+              542
               173)
             object FiltersTabs: TSpTBXTabControl
               Left = 2
               Top = 2
-              Width = 617
+              Width = 538
               Height = 169
               Align = alClient
               Color = clBtnFace
@@ -529,18 +529,18 @@
               object SpTBXTabSheet1: TSpTBXTabSheet
                 Left = 0
                 Top = 0
-                Width = 617
+                Width = 538
                 Height = 146
                 Caption = 'Filters'
                 ImageIndex = -1
                 DesignSize = (
-                  617
+                  538
                   146)
                 TabItem = 'SpTBXTabItem1'
                 object FilterList: TVirtualStringTree
                   Left = 424
                   Top = 8
-                  Width = 177
+                  Width = 98
                   Height = 129
                   Anchors = [akLeft, akTop, akRight]
                   CheckImageKind = ckSystem
@@ -849,18 +849,18 @@
               object SpTBXTabSheet2: TSpTBXTabSheet
                 Left = 0
                 Top = 0
-                Width = 617
+                Width = 538
                 Height = 146
                 Caption = 'Presets'
                 ImageIndex = -1
                 DesignSize = (
-                  617
+                  538
                   146)
                 TabItem = 'SpTBXTabItem2'
                 object PresetListbox: TSpTBXListBox
                   Left = 152
                   Top = 26
-                  Width = 457
+                  Width = 378
                   Height = 113
                   Anchors = [akLeft, akTop, akRight]
                   ItemHeight = 16
@@ -948,7 +948,7 @@
               end
             end
             object EnableFilters: TSpTBXCheckBox
-              Left = 509
+              Left = 430
               Top = 154
               Width = 110
               Height = 18
@@ -966,8 +966,8 @@
           end
           object FiltersButton: TSpTBXButton
             Left = 2
-            Top = 88
-            Width = 621
+            Top = 83
+            Width = 542
             Height = 12
             Align = alBottom
             TabOrder = 3
@@ -985,7 +985,7 @@
       object Panel4: TSpTBXPanel
         Left = 2
         Top = 2
-        Width = 625
+        Width = 546
         Height = 41
         Align = alTop
         Color = clNone
@@ -1102,9 +1102,9 @@
       object PageControl1: TPageControl
         Left = 2
         Top = 47
-        Width = 625
-        Height = 154
-        Align = alTop
+        Width = 546
+        Height = 153
+        Align = alClient
         Constraints.MinHeight = 1
         Style = tsButtons
         TabOrder = 2
@@ -1114,12 +1114,12 @@
       end
       object Splitter2: TSpTBXSplitter
         Left = 2
-        Top = 201
-        Width = 625
+        Top = 200
+        Width = 546
         Height = 10
         Cursor = crSizeNS
         Caption = 'Splitter2'
-        Align = alTop
+        Align = alBottom
         Color = clBtnFace
         ParentColor = False
         GripSize = 100
@@ -1127,10 +1127,10 @@
       end
     end
     object Splitter1: TSpTBXSplitter
-      Left = 633
+      Left = 554
       Top = 30
       Width = 10
-      Height = 488
+      Height = 482
       Cursor = crSizeWE
       Caption = 'Splitter1'
       Align = alRight
@@ -7066,6 +7066,7 @@
     Top = 166
   end
   object PyEngine: TAtomPythonEngine
+    AutoLoad = False
     FatalAbort = False
     FatalMsgDlg = False
     IO = PyInOut

Modified: trunk/Lobby/TASClient/MainUnit.pas
===================================================================
--- trunk/Lobby/TASClient/MainUnit.pas	2008-08-28 11:14:55 UTC (rev 6324)
+++ trunk/Lobby/TASClient/MainUnit.pas	2008-08-28 14:42:06 UTC (rev 6325)
@@ -522,7 +522,7 @@
 const
   VERSION_NUMBER = '0.38'; // Must be float value! (with a period as a decimal seperator)
   CHECK_BETA_LOBBY_URL = '<A HREF="http://tasclient.no-ip.org/TASClient_update_v2.txt">http://tasclient.no-ip.org/TASClient_update_v2.txt</A>';
-  PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER + ' RC8';
+  PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER + ' RC9';
   KEEP_ALIVE_INTERVAL = 10000; // in milliseconds. Tells us what should be the maximum &quot;silence&quot; time before we send a ping to the server.
   ASSUME_TIMEOUT_INTERVAL = 30000; // in milliseconds. Must be greater than KEEP_ALIVE_INTERVAL! If server hasn't send any data to us within this interval, then we assume timeout occured. It's us who must make sure we get constant replies from server by pinging it.
   LOCAL_TAB = '$Local'; // caption of main (command) tab window. Must be special so that is different from channel names or user names, that is why there is a &quot;$&quot; in front of it.
@@ -1798,7 +1798,13 @@
 procedure TMainForm.OnConnectMessage(var Msg: TMessage); // responds to WM_CONNECT message
 begin
   if Status.ConnectionState = Disconnected then
-    ConnectButton.OnClick(nil);
+    if Preferences.UseLogonForm then
+    begin
+      LogonForm.Show;
+      LogonForm.btLoginClick(nil);
+    end
+    else
+      ConnectButton.OnClick(nil);
 end;
 
 procedure TMainForm.OnForceReconnectMessage(var Msg: TMessage); // responds to WM_FORCERECONNECT message
@@ -3703,7 +3709,11 @@
     SearchFormPopupMenu.PopupForm := SearchForm;
     SearchPlayerFormPopupMenu.PopupForm := SearchPlayerForm;
 
-    if Preferences.ConnectOnStartup and  not RunningWithMainMenu then PostMessage(MainForm.Handle, WM_CONNECT, 0, 0);
+    if Preferences.ConnectOnStartup and  not RunningWithMainMenu then
+    begin
+      LogonForm.Hide;
+      PostMessage(MainForm.Handle, WM_CONNECT, 0, 0);
+    end;
 
     OnlineMapsUnit.TReadCacheThrd.Create(False); // start reading online maps from cache
     ReplaysUnit.TReadReplaysThrd.Create(False); // start reading replays from disk
@@ -9252,13 +9262,13 @@
   if FiltersButton.ImageIndex = 0 then
   begin
     FilterGroup.Height := 173;
-    PageControl1.Height := PageControl1.Height - 173;
+    Panel3.Height := Panel3.Height + 173;
     FiltersButton.ImageIndex := 1;
   end
   else
   begin
     FilterGroup.Height := 0;
-    PageControl1.Height := PageControl1.Height + 173;
+    Panel3.Height := Panel3.Height - 173;
     FiltersButton.ImageIndex := 0;
   end;
 end;
@@ -10631,11 +10641,12 @@
 procedure TMainForm.initLobbyScript;
 begin
   if Preferences.DisableScripts then Exit;
-  SysModule.path := NewPythonList;
-  SysModule.path.append('.\'+SCRIPTS_FOLDER);
-
+  PyEngine.LoadDll;
   with GetPythonEngine do
   begin
+    SysModule.path := NewPythonList;
+    SysModule.path.append('.\'+SCRIPTS_FOLDER);
+
     try
       handlers := Import('handlers');
 
@@ -10699,7 +10710,9 @@
 
 procedure TMainForm.Button1Click(Sender: TObject);
 begin
-  MakePath('c:\test1\test2\test3');
+  AddMainLog(GetComponentFromString('MainForm').Owner.ClassName,Colors.Normal);
+  //(GetComponentFromString('MainForm.Panel2') as TWinControl).Parent := Panel1;
+
 end;
 
 procedure TMainForm.RichEditURLClick(Sender: TObject; URL: String);

Modified: trunk/Lobby/TASClient/Python/api.txt
===================================================================
--- trunk/Lobby/TASClient/Python/api.txt	2008-08-28 11:14:55 UTC (rev 6324)
+++ trunk/Lobby/TASClient/Python/api.txt	2008-08-28 14:42:06 UTC (rev 6325)
@@ -68,11 +68,18 @@
 	The selected item id is returned as first argument added to the argsTuple.
 - AddSubmenuToMenu(menuName/SubmenuId,caption) return SubmenuId
 - AddSeparatorToMenu(menuName/SubmenuId) return SeparatorId
+- SetMenuItemState(id,checked,enabled)
 - RemoveFromMenu(id)
 	Id can be an itemId or a SubmenuId or a SeparatorId.
 - DisplayNotification(title, msg, argsTuple, onClickModuleName, onClickFunctionName, displayTime)
 - DisplaySimpleNotification(title, msg, displayTime)
 	displayTime in ms
+- GetControlProperties(controlName)
+- SetControlProperties(controlName, properties)
+- AddPanel(name, parent)
+- AddSplitter(name, parent)
+- AddTabsPanel(name, parent)
+- AddTab(caption, name, TabsPanelName)
 
 
 

Added: trunk/Lobby/TASClient/Python/scripts/subf/layoutTest.py
===================================================================
--- trunk/Lobby/TASClient/Python/scripts/subf/layoutTest.py	                        (rev 0)
+++ trunk/Lobby/TASClient/Python/scripts/subf/layoutTest.py	2008-08-28 14:42:06 UTC (rev 6325)
@@ -0,0 +1,36 @@
+import lobbyscript
+
+api = lobbyscript.Callback()
+gui = lobbyscript.GUI()
+
+
+def changeComponentProp(comp,prop,value):
+  p = gui.GetControlProperties(comp)
+  p[prop] = value
+  gui.SetControlProperties(comp,p)
+
+def _init():
+  # move the player list to the right of the chat with battle list under
+  gui.AddPanel('testPanel','MainForm.Panel1')
+   
+  changeComponentProp('MainForm.Panel2','align',4)
+  changeComponentProp('MainForm.Panel2','parent','MainForm.Panel1.testPanel')
+  
+  changeComponentProp('MainForm.Splitter1','align',3)
+  changeComponentProp('MainForm.Splitter1','parent','MainForm.Panel1.testPanel')
+  changeComponentProp('MainForm.Splitter1','align',4)
+  
+  changeComponentProp('MainForm.PageControl1','align',5)
+  changeComponentProp('MainForm.PageControl1','parent','MainForm.Panel1.testPanel')
+  
+  changeComponentProp('MainForm.Panel4','align',1) 
+
+  changeComponentProp('MainForm.Panel1.testPanel','align',5)
+  
+  #move minimap to a new tab
+  gui.AddTab('Map','MapTabTest','BattleForm.SpTBXTabControl1')
+  
+  changeComponentProp('BattleForm.Panel6','parent','BattleForm.MapTabTest')
+  changeComponentProp('BattleForm.Panel6','align',5)
+  
+  changeComponentProp('BattleForm.Panel5','align',1)
\ No newline at end of file

Modified: trunk/Lobby/TASClient/TASClient.dof
===================================================================
--- trunk/Lobby/TASClient/TASClient.dof	2008-08-28 11:14:55 UTC (rev 6324)
+++ trunk/Lobby/TASClient/TASClient.dof	2008-08-28 14:42:06 UTC (rev 6325)
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=3
 Release=0
-Build=424
+Build=428
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=TA Spring lobby client
-FileVersion=0.3.0.424
+FileVersion=0.3.0.428
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: trunk/Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001094.html">[Taspring-linux-commit] r6324 - in trunk: . rts/Game	tools/DemoAnalyser tools/DemoDumper
</A></li>
	<LI>Next message: <A HREF="001096.html">[Taspring-linux-commit] r6326 - in trunk/installer: . sections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1095">[ date ]</a>
              <a href="thread.html#1095">[ thread ]</a>
              <a href="subject.html#1095">[ subject ]</a>
              <a href="author.html#1095">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
