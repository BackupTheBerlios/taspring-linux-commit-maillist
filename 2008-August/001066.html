<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6296 - in trunk/rts: System	System/FileSystem System/Net System/creg lib/lua/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-August/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6296%20-%20in%20trunk/rts%3A%20System%0A%09System/FileSystem%20System/Net%20System/creg%20lib/lua/src&In-Reply-To=%3C20080821223827.1950D48A4%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001065.html">
   <LINK REL="Next"  HREF="001067.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6296 - in trunk/rts: System	System/FileSystem System/Net System/creg lib/lua/src</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6296%20-%20in%20trunk/rts%3A%20System%0A%09System/FileSystem%20System/Net%20System/creg%20lib/lua/src&In-Reply-To=%3C20080821223827.1950D48A4%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6296 - in trunk/rts: System	System/FileSystem System/Net System/creg lib/lua/src">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Fri Aug 22 00:38:27 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001065.html">[Taspring-linux-commit] r6295 - in trunk/rts: Game Game/Camera	Game/StartScripts Game/UI Lua Map Rendering Rendering/Env	Rendering/GL Rendering/Textures Rendering/UnitModels Sim	Sim/Features Sim/Misc Sim/MoveTypes Sim/Objects Sim/Path	Sim/Projectiles Sim/Projectiles/Unsynced	Sim/Projectiles/WeaponProjectiles Sim/Units Sim/Units/COB	Sim/Units/CommandAI System
</A></li>
        <LI>Next message: <A HREF="001067.html">[Taspring-linux-commit] r6297 - trunk/rts/Game
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1066">[ date ]</a>
              <a href="thread.html#1066">[ thread ]</a>
              <a href="subject.html#1066">[ subject ]</a>
              <a href="author.html#1066">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: imbaczek
Date: 2008-08-22 00:38:26 +0200 (Fri, 22 Aug 2008)
New Revision: 6296

Modified:
   trunk/rts/System/AutohostInterface.cpp
   trunk/rts/System/BaseNetProtocol.cpp
   trunk/rts/System/DemoReader.cpp
   trunk/rts/System/DemoRecorder.cpp
   trunk/rts/System/FileSystem/Archive7Zip.cpp
   trunk/rts/System/FileSystem/ArchiveBuffered.cpp
   trunk/rts/System/FileSystem/ArchiveDir.cpp
   trunk/rts/System/FileSystem/ArchiveFactory.cpp
   trunk/rts/System/FileSystem/ArchiveHPI.cpp
   trunk/rts/System/FileSystem/ArchiveScanner.cpp
   trunk/rts/System/FileSystem/ArchiveZip.cpp
   trunk/rts/System/FileSystem/FileFilter.cpp
   trunk/rts/System/FileSystem/FileHandler.cpp
   trunk/rts/System/FileSystem/SimpleParser.cpp
   trunk/rts/System/FileSystem/VFSHandler.cpp
   trunk/rts/System/GlobalStuff.cpp
   trunk/rts/System/LoadInterface.cpp
   trunk/rts/System/LoadSaveHandler.cpp
   trunk/rts/System/LogOutput.cpp
   trunk/rts/System/Messages.cpp
   trunk/rts/System/MouseInput.cpp
   trunk/rts/System/Net/RawPacket.cpp
   trunk/rts/System/Net/UDPConnection.cpp
   trunk/rts/System/Net/UDPListener.cpp
   trunk/rts/System/NetProtocol.cpp
   trunk/rts/System/Object.cpp
   trunk/rts/System/Sound.cpp
   trunk/rts/System/SpringApp.cpp
   trunk/rts/System/TdfParser.cpp
   trunk/rts/System/TimeProfiler.cpp
   trunk/rts/System/creg/VarTypes.cpp
   trunk/rts/System/creg/creg.cpp
   trunk/rts/System/mmgr.cpp
   trunk/rts/System/mmgr.h
   trunk/rts/lib/lua/src/lmem.cpp
Log:
sweeping update of #includes part 2



Modified: trunk/rts/System/AutohostInterface.cpp
===================================================================
--- trunk/rts/System/AutohostInterface.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/AutohostInterface.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,6 +1,8 @@
+#include &quot;StdAfx.h&quot;
+#include &lt;string.h&gt;
+#include &quot;mmgr.h&quot;
+
 #include &quot;AutohostInterface.h&quot;
-
-#include &lt;string.h&gt;
 #include &quot;Net/UDPConnectedSocket.h&quot; 
 
 namespace {

Modified: trunk/rts/System/BaseNetProtocol.cpp
===================================================================
--- trunk/rts/System/BaseNetProtocol.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/BaseNetProtocol.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,5 +1,7 @@
 #include &quot;BaseNetProtocol.h&quot;
 
+#include &quot;mmgr.h&quot;
+
 #include &quot;Net/RawPacket.h&quot;
 #include &quot;Rendering/InMapDraw.h&quot;
 #include &quot;Net/PackPacket.h&quot;

Modified: trunk/rts/System/DemoReader.cpp
===================================================================
--- trunk/rts/System/DemoReader.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/DemoReader.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,9 +1,11 @@
 #include &quot;StdAfx.h&quot;
-#include &quot;DemoReader.h&quot;
 
 #include &lt;limits.h&gt;
 #include &lt;stdexcept&gt;
+#include &quot;mmgr.h&quot;
 
+#include &quot;DemoReader.h&quot;
+
 #ifndef DEDICATED
 #include &quot;Sync/Syncify.h&quot;
 #endif

Modified: trunk/rts/System/DemoRecorder.cpp
===================================================================
--- trunk/rts/System/DemoRecorder.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/DemoRecorder.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -5,6 +5,8 @@
 #include &lt;time.h&gt;
 #include &lt;errno.h&gt;
 
+#include &quot;mmgr.h&quot;
+
 #include &quot;Sync/Syncify.h&quot;
 #include &quot;Platform/FileSystem.h&quot;
 #include &quot;FileSystem/FileHandler.h&quot;

Modified: trunk/rts/System/FileSystem/Archive7Zip.cpp
===================================================================
--- trunk/rts/System/FileSystem/Archive7Zip.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/Archive7Zip.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,8 +1,8 @@
 #include &quot;StdAfx.h&quot;
-#include &quot;Archive7Zip.h&quot;
 #include &lt;algorithm&gt;
 #include &lt;string.h&gt;
 #include &quot;mmgr.h&quot;
+#include &quot;Archive7Zip.h&quot;
 
 // Most of this code is taken from 7zMain.c
 

Modified: trunk/rts/System/FileSystem/ArchiveBuffered.cpp
===================================================================
--- trunk/rts/System/FileSystem/ArchiveBuffered.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/ArchiveBuffered.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,8 +1,9 @@
 #include &quot;StdAfx.h&quot;
 #include &lt;string.h&gt;
-#include &quot;ArchiveBuffered.h&quot;
 #include &quot;mmgr.h&quot;
 
+#include &quot;ArchiveBuffered.h&quot;
+
 CArchiveBuffered::CArchiveBuffered(const std::string&amp; name):
 	CArchiveBase(name),
 	curFileHandle(1)

Modified: trunk/rts/System/FileSystem/ArchiveDir.cpp
===================================================================
--- trunk/rts/System/FileSystem/ArchiveDir.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/ArchiveDir.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,7 +1,9 @@
 /* Author: Tobi Vollebregt */
 
+#include &quot;StdAfx.h&quot;
 #include &lt;assert.h&gt;
-#include &quot;StdAfx.h&quot;
+#include &quot;mmgr.h&quot;
+
 #include &quot;ArchiveDir.h&quot;
 #include &quot;Platform/FileSystem.h&quot;
 

Modified: trunk/rts/System/FileSystem/ArchiveFactory.cpp
===================================================================
--- trunk/rts/System/FileSystem/ArchiveFactory.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/ArchiveFactory.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,12 +1,13 @@
 #include &quot;StdAfx.h&quot;
+#include &lt;algorithm&gt;
+#include &quot;mmgr.h&quot;
+
 #include &quot;ArchiveFactory.h&quot;
 #include &quot;ArchiveDir.h&quot;
 #include &quot;ArchiveHPI.h&quot;
 #include &quot;ArchiveZip.h&quot;
 #include &quot;Archive7Zip.h&quot;
 #include &quot;Platform/FileSystem.h&quot;
-#include &lt;algorithm&gt;
-#include &quot;mmgr.h&quot;
 
 
 // Returns true if the indicated file is in fact an archive

Modified: trunk/rts/System/FileSystem/ArchiveHPI.cpp
===================================================================
--- trunk/rts/System/FileSystem/ArchiveHPI.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/ArchiveHPI.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,8 +1,9 @@
 #include &quot;StdAfx.h&quot;
-#include &quot;ArchiveHPI.h&quot;
 #include &lt;algorithm&gt;
 #include &quot;mmgr.h&quot;
 
+#include &quot;ArchiveHPI.h&quot;
+
 using namespace hpiutil;
 
 CArchiveHPI::CArchiveHPI(const std::string&amp; name):

Modified: trunk/rts/System/FileSystem/ArchiveScanner.cpp
===================================================================
--- trunk/rts/System/FileSystem/ArchiveScanner.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/ArchiveScanner.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,4 +1,4 @@
-#include &quot;ArchiveScanner.h&quot;
+#include &quot;StdAfx.h&quot;
 
 #include &lt;list&gt;
 #include &lt;algorithm&gt;
@@ -6,7 +6,10 @@
 #include &lt;sys/types.h&gt;
 #include &lt;sys/stat.h&gt;
 
-#include &quot;StdAfx.h&quot;
+#include &quot;mmgr.h&quot;
+
+#include &quot;ArchiveScanner.h&quot;
+
 #include &quot;Lua/LuaParser.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &quot;System/FileSystem/ArchiveFactory.h&quot;
@@ -15,7 +18,6 @@
 #include &quot;System/FileSystem/FileFilter.h&quot;
 #include &quot;System/FileSystem/FileHandler.h&quot;
 #include &quot;System/Platform/FileSystem.h&quot;
-#include &quot;mmgr.h&quot;
 
 using std::string;
 using std::vector;

Modified: trunk/rts/System/FileSystem/ArchiveZip.cpp
===================================================================
--- trunk/rts/System/FileSystem/ArchiveZip.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/ArchiveZip.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,8 +1,9 @@
 #include &quot;StdAfx.h&quot;
-#include &quot;ArchiveZip.h&quot;
 #include &lt;algorithm&gt;
 #include &quot;mmgr.h&quot;
 
+#include &quot;ArchiveZip.h&quot;
+
 CArchiveZip::CArchiveZip(const std::string&amp; name):
 	CArchiveBuffered(name),
 	curSearchHandle(1)

Modified: trunk/rts/System/FileSystem/FileFilter.cpp
===================================================================
--- trunk/rts/System/FileSystem/FileFilter.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/FileFilter.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,11 +1,14 @@
-#include &quot;FileFilter.h&quot;
+#include &quot;StdAfx.h&quot;
 #include &lt;limits.h&gt;
 #include &lt;boost/regex.hpp&gt;
 #include &lt;ctype.h&gt;
 #include &lt;sstream&gt;
 #include &lt;vector&gt;
+#include &quot;mmgr.h&quot;
 
+#include &quot;FileFilter.h&quot;
 
+
 using std::string;
 using std::vector;
 

Modified: trunk/rts/System/FileSystem/FileHandler.cpp
===================================================================
--- trunk/rts/System/FileSystem/FileHandler.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/FileHandler.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,13 +1,14 @@
 #include &quot;StdAfx.h&quot;
-#include &quot;FileHandler.h&quot;
 #include &lt;fstream&gt;
 #include &lt;algorithm&gt;
 #include &lt;cctype&gt;
 #include &lt;limits.h&gt;
 #include &lt;boost/regex.hpp&gt;
+#include &quot;mmgr.h&quot;
+
+#include &quot;FileHandler.h&quot;
 #include &quot;VFSHandler.h&quot;
 #include &quot;Platform/FileSystem.h&quot;
-#include &quot;mmgr.h&quot;
 
 using namespace std;
 

Modified: trunk/rts/System/FileSystem/SimpleParser.cpp
===================================================================
--- trunk/rts/System/FileSystem/SimpleParser.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/SimpleParser.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -2,9 +2,11 @@
 // SimpleParser.cpp: implementation of the SimpleParser class.
 //
 //////////////////////////////////////////////////////////////////////
-#include &quot;SimpleParser.h&quot;
 #include &lt;sstream&gt;
+#include &quot;mmgr.h&quot;
 
+#include &quot;SimpleParser.h&quot;
+
 using namespace std;
 
 

Modified: trunk/rts/System/FileSystem/VFSHandler.cpp
===================================================================
--- trunk/rts/System/FileSystem/VFSHandler.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/FileSystem/VFSHandler.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,12 +1,13 @@
 #include &quot;StdAfx.h&quot;
+#include &lt;algorithm&gt;
+#include &lt;set&gt;
+#include &quot;mmgr.h&quot;
+
 #include &quot;VFSHandler.h&quot;
 #include &quot;ArchiveFactory.h&quot;
 #include &quot;ArchiveBase.h&quot;
 #include &quot;ArchiveDir.h&quot; // for FileData::dynamic
-#include &lt;algorithm&gt;
-#include &lt;set&gt;
 #include &quot;Platform/FileSystem.h&quot;
-#include &quot;mmgr.h&quot;
 
 
 CVFSHandler* vfsHandler = NULL;

Modified: trunk/rts/System/GlobalStuff.cpp
===================================================================
--- trunk/rts/System/GlobalStuff.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/GlobalStuff.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -7,6 +7,7 @@
  */
 #include &quot;StdAfx.h&quot;
 #include &lt;cstring&gt;
+#include &quot;mmgr.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Game/GameHelper.h&quot;
 #include &quot;Game/GameSetup.h&quot;
@@ -18,7 +19,6 @@
 #include &quot;Lua/LuaRules.h&quot;
 #include &quot;SDL_types.h&quot;
 #include &quot;SDL_timer.h&quot;
-#include &quot;mmgr.h&quot;
 
 /**
  * @brief global synced

Modified: trunk/rts/System/LoadInterface.cpp
===================================================================
--- trunk/rts/System/LoadInterface.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/LoadInterface.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,4 +1,6 @@
 #include &quot;StdAfx.h&quot;
+#include &quot;mmgr.h&quot;
+
 #include &quot;LoadInterface.h&quot;
 
 CLoadInterface::CLoadInterface(std::ifstream* ifs)

Modified: trunk/rts/System/LoadSaveHandler.cpp
===================================================================
--- trunk/rts/System/LoadSaveHandler.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/LoadSaveHandler.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,5 +1,7 @@
 #include &quot;StdAfx.h&quot;
 #include &lt;fstream&gt;
+#include &quot;mmgr.h&quot;
+
 #include &quot;ExternalAI/GlobalAI.h&quot;
 #include &quot;ExternalAI/GlobalAIHandler.h&quot;
 #include &quot;ExternalAI/GroupHandler.h&quot;
@@ -28,7 +30,6 @@
 #include &quot;Sim/Units/CommandAI/BuilderCAI.h&quot;
 #include &quot;Game/GameServer.h&quot;
 #include &quot;Rendering/InMapDraw.h&quot;
-#include &quot;mmgr.h&quot;
 
 extern std::string stupidGlobalMapname;
 

Modified: trunk/rts/System/LogOutput.cpp
===================================================================
--- trunk/rts/System/LogOutput.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/LogOutput.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,17 +1,19 @@
 
 #include &quot;StdAfx.h&quot;
 #include &lt;assert.h&gt;
-#include &quot;LogOutput.h&quot;
 #include &lt;cstdarg&gt;
 #include &lt;fstream&gt;
 #include &lt;string.h&gt;
 #include &lt;boost/thread/recursive_mutex.hpp&gt;
 
-
 #ifdef _MSC_VER
 #include &lt;windows.h&gt;
 #endif
 
+#include &quot;mmgr.h&quot;
+
+#include &quot;LogOutput.h&quot;
+
 static std::ofstream* filelog = 0;
 static bool initialized = false;
 static bool stdoutDebug = false;

Modified: trunk/rts/System/Messages.cpp
===================================================================
--- trunk/rts/System/Messages.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/Messages.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -8,11 +8,12 @@
 #include &lt;string&gt;
 #include &lt;vector&gt;
 #include &lt;map&gt;
+#include &quot;mmgr.h&quot;
+
 #include &quot;GlobalStuff.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Messages.h&quot;
 #include &quot;Lua/LuaParser.h&quot;
-#include &quot;mmgr.h&quot;
 
 using std::string;
 using std::vector;

Modified: trunk/rts/System/MouseInput.cpp
===================================================================
--- trunk/rts/System/MouseInput.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/MouseInput.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -10,13 +10,15 @@
 */
 
 #include &quot;StdAfx.h&quot;
+#include &lt;SDL_events.h&gt;
+#include &lt;SDL_syswm.h&gt;
+#include &quot;mmgr.h&quot;
+
 #include &quot;Platform/Win/win32.h&quot;
 #include &quot;MouseInput.h&quot;
 #include &quot;Game/UI/MouseHandler.h&quot;
 #include &quot;LogOutput.h&quot;
 
-#include &lt;SDL_events.h&gt;
-#include &lt;SDL_syswm.h&gt;
 
 
 IMouseInput* mouseInput = NULL;

Modified: trunk/rts/System/Net/RawPacket.cpp
===================================================================
--- trunk/rts/System/Net/RawPacket.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/Net/RawPacket.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,8 +1,9 @@
-#include &quot;RawPacket.h&quot;
-
 #include &lt;string.h&gt;
 #include &lt;stdexcept&gt;
+#include &quot;mmgr.h&quot;
 
+#include &quot;RawPacket.h&quot;
+
 namespace netcode
 {
 

Modified: trunk/rts/System/Net/UDPConnection.cpp
===================================================================
--- trunk/rts/System/Net/UDPConnection.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/Net/UDPConnection.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,4 +1,3 @@
-#include &quot;UDPConnection.h&quot;
 
 #include &lt;SDL_timer.h&gt;
 #include &lt;boost/version.hpp&gt;
@@ -11,6 +10,10 @@
  #include &lt;sys/socket.h&gt;
 #endif
 
+#include &quot;mmgr.h&quot;
+
+#include &quot;UDPConnection.h&quot;
+
 #include &quot;ProtocolDef.h&quot;
 #include &quot;Exception.h&quot;
 

Modified: trunk/rts/System/Net/UDPListener.cpp
===================================================================
--- trunk/rts/System/Net/UDPListener.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/Net/UDPListener.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,7 +1,9 @@
+#include &lt;boost/weak_ptr.hpp&gt;
+
+#include &quot;mmgr.h&quot;
+
 #include &quot;UDPListener.h&quot;
 
-#include &lt;boost/weak_ptr.hpp&gt;
-
 #include &quot;ProtocolDef.h&quot;
 #include &quot;UDPConnection.h&quot;
 #include &quot;UDPSocket.h&quot;

Modified: trunk/rts/System/NetProtocol.cpp
===================================================================
--- trunk/rts/System/NetProtocol.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/NetProtocol.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,7 +1,9 @@
+#include &quot;StdAfx.h&quot;
+#include &lt;SDL_timer.h&gt;
+#include &quot;mmgr.h&quot;
+
 #include &quot;NetProtocol.h&quot;
 
-#include &lt;SDL_timer.h&gt;
-
 #include &quot;Game/GameSetup.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;DemoRecorder.h&quot;

Modified: trunk/rts/System/Object.cpp
===================================================================
--- trunk/rts/System/Object.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/Object.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -29,12 +29,24 @@
 {
 	std::list&lt;CObject*&gt;::iterator di;
 	for(di=listeners.begin();di!=listeners.end();++di){
+#ifdef USE_MMGR
+ 		m_setOwner(__FILE__, __LINE__, __FUNCTION__);
+#endif
 		(*di)-&gt;DependentDied(this);
+#ifdef USE_MMGR
+		m_setOwner(__FILE__, __LINE__, __FUNCTION__);
+#endif
 		ListErase&lt;CObject*&gt;((*di)-&gt;listening, this);
 	}
 	for(di=listening.begin();di!=listening.end();++di){
+#ifdef USE_MMGR
+		m_setOwner(__FILE__, __LINE__, __FUNCTION__);
+#endif
 		ListErase&lt;CObject*&gt;((*di)-&gt;listeners, this);
 	}
+#ifdef USE_MMGR
+	m_resetGlobals();
+#endif
 }
 
 void CObject::Serialize(creg::ISerializer *s)
@@ -64,9 +76,16 @@
 
 void CObject::PostLoad()
 {
-	for (std::list&lt;CObject*&gt;::iterator i=listening.begin();i!=listening.end();i++)
+	for (std::list&lt;CObject*&gt;::iterator i=listening.begin();i!=listening.end();i++) {
+#ifdef USE_MMGR
+		m_setOwner(__FILE__, __LINE__, __FUNCTION__);
+#endif
 		(*i)-&gt;listeners.insert((*i)-&gt;listeners.end(),this);
 }
+#ifdef USE_MMGR
+	m_resetGlobals();
+#endif
+}
 
 void CObject::DependentDied(CObject* o)
 {
@@ -75,13 +94,31 @@
 
 void CObject::AddDeathDependence(CObject *o)
 {
+#ifdef USE_MMGR
+	m_setOwner(__FILE__, __LINE__, __FUNCTION__);
+#endif
 	o-&gt;listeners.insert(o-&gt;listeners.end(),this);
+#ifdef USE_MMGR
+	m_setOwner(__FILE__, __LINE__, __FUNCTION__);
+#endif
 	listening.insert(listening.end(),o);
+#ifdef USE_MMGR
+	m_resetGlobals();
+#endif
 }
 
 void CObject::DeleteDeathDependence(CObject *o)
 {
 	//note that we can be listening to a single object from several different places (like curreclaim in CBuilder and lastAttacker in CUnit, grr) so we should only remove one of them
+#ifdef USE_MMGR
+	m_setOwner(__FILE__, __LINE__, __FUNCTION__);
+#endif
 	ListErase&lt;CObject*&gt;(listening, o);
+#ifdef USE_MMGR
+	m_setOwner(__FILE__, __LINE__, __FUNCTION__);
+#endif
 	ListErase&lt;CObject*&gt;(o-&gt;listeners, this);
+#ifdef USE_MMGR
+	m_resetGlobals();
+#endif
 }

Modified: trunk/rts/System/Sound.cpp
===================================================================
--- trunk/rts/System/Sound.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/Sound.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,4 +1,5 @@
 #include &quot;StdAfx.h&quot;
+#include &quot;mmgr.h&quot;
 #include &quot;Sound.h&quot;
 #include &quot;GlobalStuff.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;

Modified: trunk/rts/System/SpringApp.cpp
===================================================================
--- trunk/rts/System/SpringApp.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/SpringApp.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -1,5 +1,4 @@
 #include &quot;StdAfx.h&quot;
-#include &quot;SpringApp.h&quot;
 
 #include &lt;iostream&gt;
 
@@ -7,6 +6,10 @@
 #include &lt;SDL.h&gt;
 #include &lt;SDL_syswm.h&gt;
 
+#include &quot;mmgr.h&quot;
+
+#include &quot;SpringApp.h&quot;
+
 #undef KeyPress
 #undef KeyRelease
 

Modified: trunk/rts/System/TdfParser.cpp
===================================================================
--- trunk/rts/System/TdfParser.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/TdfParser.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -11,6 +11,20 @@
 #include &lt;boost/lexical_cast.hpp&gt;
 #include &lt;boost/algorithm/string/trim.hpp&gt;
 #include &lt;boost/spirit/utility/confix.hpp&gt;
+#include &lt;boost/spirit/core.hpp&gt;
+#include &lt;boost/spirit/symbols.hpp&gt;
+#include &lt;boost/spirit/attribute.hpp&gt;
+#include &lt;boost/spirit/dynamic.hpp&gt;
+#include &lt;boost/spirit/phoenix.hpp&gt;
+#include &lt;boost/spirit/utility/chset.hpp&gt;
+#include &lt;boost/spirit/utility/lists.hpp&gt;
+#include &lt;boost/spirit/iterator/file_iterator.hpp&gt;
+#include &lt;boost/spirit/utility/grammar_def.hpp&gt;
+#include &lt;boost/spirit/iterator/position_iterator.hpp&gt;
+#include &lt;boost/spirit/phoenix/binders.hpp&gt;
+#include &lt;boost/spirit/error_handling/exceptions.hpp&gt;
+#include &quot;mmgr.h&quot;
+
 #include &quot;TdfParser.h&quot;
 #include &quot;tdf_grammar.hpp&quot;
 #include &quot;FileSystem/FileHandler.h&quot;

Modified: trunk/rts/System/TimeProfiler.cpp
===================================================================
--- trunk/rts/System/TimeProfiler.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/TimeProfiler.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -6,6 +6,8 @@
 #include &lt;SDL_timer.h&gt;
 #include &lt;cstring&gt;
 
+#include &quot;mmgr.h&quot;
+
 #include &quot;UnsyncedRNG.h&quot;
 
 

Modified: trunk/rts/System/creg/VarTypes.cpp
===================================================================
--- trunk/rts/System/creg/VarTypes.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/creg/VarTypes.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -3,9 +3,11 @@
 Copyright 2005 Jelmer Cnossen
 */
 #include &quot;StdAfx.h&quot;
-#include &quot;VarTypes.h&quot;
 #include &lt;assert.h&gt;
+#include &quot;mmgr.h&quot;
 
+#include &quot;VarTypes.h&quot;
+
 using namespace std;
 using namespace creg;
 

Modified: trunk/rts/System/creg/creg.cpp
===================================================================
--- trunk/rts/System/creg/creg.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/creg/creg.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -3,10 +3,11 @@
 Copyright 2005 Jelmer Cnossen 
 */
 #include &quot;StdAfx.h&quot;
-#include &quot;creg.h&quot;
 #include &lt;map&gt;
 #include &lt;string.h&gt;
 
+#include &quot;creg.h&quot;
+
 using namespace creg;
 using namespace std;
 

Modified: trunk/rts/System/mmgr.cpp
===================================================================
--- trunk/rts/System/mmgr.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/mmgr.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -148,7 +148,7 @@
 static	const	unsigned int	hashBits               = 16;
 static __thread		bool		randomWipe             = true;
 static __thread		bool		alwaysValidateAll      = false;
-static __thread		bool		alwaysLogAll           = true;
+static __thread		bool		alwaysLogAll           = false;
 static __thread		bool		alwaysWipeAll          = true;
 static		bool		cleanupLogOnFirstRun   = true;
 static	const	unsigned int	paddingSize            = 32;
@@ -434,6 +434,9 @@
 	sourceFunc = &quot;??&quot;;
 }
 
+void m_resetGlobals() { resetGlobals(); }
+ 
+
 // ---------------------------------------------------------------------------------------------------------------------------------
 static FILE *fp_log;
 

Modified: trunk/rts/System/mmgr.h
===================================================================
--- trunk/rts/System/mmgr.h	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/System/mmgr.h	2008-08-21 22:38:26 UTC (rev 6296)
@@ -74,6 +74,7 @@
 // ---------------------------------------------------------------------------------------------------------------------------------
 
 void		m_setOwner(const char *file, const unsigned int line, const char *func);
+void		m_resetGlobals();
 
 // ---------------------------------------------------------------------------------------------------------------------------------
 // Allocation breakpoints
@@ -137,7 +138,7 @@
 #define	malloc(sz)	m_allocator  (__FILE__,__LINE__,__FUNCTION__,m_alloc_malloc,sz)
 #define	calloc(sz)	m_allocator  (__FILE__,__LINE__,__FUNCTION__,m_alloc_calloc,sz)
 #define	realloc(ptr,sz)	m_reallocator(__FILE__,__LINE__,__FUNCTION__,m_alloc_realloc,sz,ptr)
-#define	free(ptr)	m_deallocator(__FILE__,__LINE__,__FUNCTION__,m_alloc_free,ptr)
+#define	free(ptr)	if (ptr != NULL) m_deallocator(__FILE__,__LINE__,__FUNCTION__,m_alloc_free,ptr)
 
 // ---------------------------------------------------------------------------------------------------------------------------------
 // mmgr.h - End of file

Modified: trunk/rts/lib/lua/src/lmem.cpp
===================================================================
--- trunk/rts/lib/lua/src/lmem.cpp	2008-08-21 22:35:06 UTC (rev 6295)
+++ trunk/rts/lib/lua/src/lmem.cpp	2008-08-21 22:38:26 UTC (rev 6296)
@@ -7,6 +7,8 @@
 
 #include &lt;stddef.h&gt;
 
+#include &quot;mmgr.h&quot;
+
 #define lmem_c
 #define LUA_CORE
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001065.html">[Taspring-linux-commit] r6295 - in trunk/rts: Game Game/Camera	Game/StartScripts Game/UI Lua Map Rendering Rendering/Env	Rendering/GL Rendering/Textures Rendering/UnitModels Sim	Sim/Features Sim/Misc Sim/MoveTypes Sim/Objects Sim/Path	Sim/Projectiles Sim/Projectiles/Unsynced	Sim/Projectiles/WeaponProjectiles Sim/Units Sim/Units/COB	Sim/Units/CommandAI System
</A></li>
	<LI>Next message: <A HREF="001067.html">[Taspring-linux-commit] r6297 - trunk/rts/Game
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1066">[ date ]</a>
              <a href="thread.html#1066">[ thread ]</a>
              <a href="subject.html#1066">[ subject ]</a>
              <a href="author.html#1066">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
