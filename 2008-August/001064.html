<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6294 - trunk/Lobby/TASClient
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-August/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6294%20-%20trunk/Lobby/TASClient&In-Reply-To=%3C20080821220222.ADB0D48A4%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001063.html">
   <LINK REL="Next"  HREF="001065.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6294 - trunk/Lobby/TASClient</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6294%20-%20trunk/Lobby/TASClient&In-Reply-To=%3C20080821220222.ADB0D48A4%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6294 - trunk/Lobby/TASClient">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Fri Aug 22 00:02:22 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001063.html">[Taspring-linux-commit] r6293 - trunk/tools/unitsync
</A></li>
        <LI>Next message: <A HREF="001065.html">[Taspring-linux-commit] r6295 - in trunk/rts: Game Game/Camera	Game/StartScripts Game/UI Lua Map Rendering Rendering/Env	Rendering/GL Rendering/Textures Rendering/UnitModels Sim	Sim/Features Sim/Misc Sim/MoveTypes Sim/Objects Sim/Path	Sim/Projectiles Sim/Projectiles/Unsynced	Sim/Projectiles/WeaponProjectiles Sim/Units Sim/Units/COB	Sim/Units/CommandAI System
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1064">[ date ]</a>
              <a href="thread.html#1064">[ thread ]</a>
              <a href="subject.html#1064">[ subject ]</a>
              <a href="author.html#1064">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2008-08-22 00:02:20 +0200 (Fri, 22 Aug 2008)
New Revision: 6294

Modified:
   trunk/Lobby/TASClient/BattleFormUnit.dfm
   trunk/Lobby/TASClient/BattleFormUnit.pas
   trunk/Lobby/TASClient/MainUnit.pas
   trunk/Lobby/TASClient/TASClient.cfg
   trunk/Lobby/TASClient/TASClient.dof
   trunk/Lobby/TASClient/TASClient.res
   trunk/Lobby/TASClient/Utility.pas
Log:
* luaoption section added

Modified: trunk/Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/BattleFormUnit.dfm	2008-08-21 20:05:45 UTC (rev 6293)
+++ trunk/Lobby/TASClient/BattleFormUnit.dfm	2008-08-21 22:02:20 UTC (rev 6294)
@@ -4093,14 +4093,13 @@
           Height = 273
           Align = alClient
           Color = clBtnFace
-          ActiveTabIndex = 0
+          ActiveTabIndex = 3
           TabAutofit = True
           ThemeType = tttNone
           OnActiveTabChange = SpTBXTabControl1ActiveTabChange
           HiddenItems = &lt;&gt;
           object GameOptionsTab: TSpTBXTabItem
             Caption = 'Game options'
-            Checked = True
             CustomWidth = 103
             CustomHeight = 30
             ThemeType = tttNone
@@ -4120,169 +4119,10 @@
           object ModTab: TSpTBXTabItem
             Caption = 'Mod options'
             Wrapping = twWrap
+            Checked = True
             CustomWidth = 103
             ThemeType = tttNone
           end
-          object MapTabSheet: TSpTBXTabSheet
-            Left = 0
-            Top = 34
-            Width = 419
-            Height = 239
-            Caption = 'Map options'
-            ImageIndex = -1
-            DesignSize = (
-              419
-              239)
-            TabItem = 'MapTab'
-            object MapOptionsScrollBox: TTntScrollBox
-              Left = 2
-              Top = 48
-              Width = 414
-              Height = 189
-              VertScrollBar.Smooth = True
-              VertScrollBar.Tracking = True
-              Anchors = [akLeft, akTop, akRight, akBottom]
-              BiDiMode = bdLeftToRight
-              BorderStyle = bsNone
-              Color = clBtnFace
-              Ctl3D = False
-              ParentBiDiMode = False
-              ParentBackground = True
-              ParentColor = False
-              ParentCtl3D = False
-              TabOrder = 0
-            end
-            object panelMapOptionsDefault: TSpTBXPanel
-              Left = 5
-              Top = 4
-              Width = 382
-              Height = 41
-              Align = alCustom
-              TabOrder = 1
-              object btLoadDefaultMPO: TSpTBXButton
-                Left = 136
-                Top = 8
-                Width = 113
-                Height = 25
-                Caption = 'Load default'
-                TabOrder = 0
-                OnClick = btLoadDefaultMPOClick
-                LinkFont.Charset = DEFAULT_CHARSET
-                LinkFont.Color = clBlue
-                LinkFont.Height = -11
-                LinkFont.Name = 'MS Sans Serif'
-                LinkFont.Style = [fsUnderline]
-              end
-              object btSetAsDefaultMPO: TSpTBXButton
-                Left = 256
-                Top = 8
-                Width = 113
-                Height = 25
-                Caption = 'Set as default'
-                TabOrder = 1
-                OnClick = btSetAsDefaultMPOClick
-                LinkFont.Charset = DEFAULT_CHARSET
-                LinkFont.Color = clBlue
-                LinkFont.Height = -11
-                LinkFont.Name = 'MS Sans Serif'
-                LinkFont.Style = [fsUnderline]
-              end
-              object btLoadMapsDefaultMPO: TSpTBXButton
-                Left = 16
-                Top = 8
-                Width = 113
-                Height = 25
-                Caption = 'Load map'#39's default'
-                TabOrder = 2
-                OnClick = btLoadMapsDefaultMPOClick
-                LinkFont.Charset = DEFAULT_CHARSET
-                LinkFont.Color = clBlue
-                LinkFont.Height = -11
-                LinkFont.Name = 'MS Sans Serif'
-                LinkFont.Style = [fsUnderline]
-              end
-            end
-          end
-          object ModTabSheet: TSpTBXTabSheet
-            Left = 0
-            Top = 34
-            Width = 419
-            Height = 239
-            Caption = 'Mod options'
-            ImageIndex = -1
-            DesignSize = (
-              419
-              239)
-            TabItem = 'ModTab'
-            object ModOptionsScrollBox: TTntScrollBox
-              Left = 2
-              Top = 48
-              Width = 414
-              Height = 189
-              VertScrollBar.Smooth = True
-              VertScrollBar.Tracking = True
-              Anchors = [akLeft, akTop, akRight, akBottom]
-              BiDiMode = bdLeftToRight
-              BorderStyle = bsNone
-              Color = clBtnFace
-              Ctl3D = False
-              ParentBiDiMode = False
-              ParentBackground = True
-              ParentColor = False
-              ParentCtl3D = False
-              TabOrder = 0
-            end
-            object panelModOptionsDefault: TSpTBXPanel
-              Left = 5
-              Top = 4
-              Width = 381
-              Height = 41
-              Align = alCustom
-              TabOrder = 1
-              object btLoadDefaultMDO: TSpTBXButton
-                Left = 136
-                Top = 8
-                Width = 113
-                Height = 25
-                Caption = 'Load default'
-                TabOrder = 0
-                OnClick = btLoadDefaultMDOClick
-                LinkFont.Charset = DEFAULT_CHARSET
-                LinkFont.Color = clBlue
-                LinkFont.Height = -11
-                LinkFont.Name = 'MS Sans Serif'
-                LinkFont.Style = [fsUnderline]
-              end
-              object btSetAsDefaultMDO: TSpTBXButton
-                Left = 256
-                Top = 8
-                Width = 113
-                Height = 25
-                Caption = 'Set as default'
-                TabOrder = 1
-                OnClick = btSetAsDefaultMDOClick
-                LinkFont.Charset = DEFAULT_CHARSET
-                LinkFont.Color = clBlue
-                LinkFont.Height = -11
-                LinkFont.Name = 'MS Sans Serif'
-                LinkFont.Style = [fsUnderline]
-              end
-              object btLoadModsDefaultMDO: TSpTBXButton
-                Left = 16
-                Top = 8
-                Width = 113
-                Height = 25
-                Caption = 'Load mod'#39's default'
-                TabOrder = 2
-                OnClick = btLoadModsDefaultMDOClick
-                LinkFont.Charset = DEFAULT_CHARSET
-                LinkFont.Color = clBlue
-                LinkFont.Height = -11
-                LinkFont.Name = 'MS Sans Serif'
-                LinkFont.Style = [fsUnderline]
-              end
-            end
-          end
           object SpTBXTabSheet1: TSpTBXTabSheet
             Left = 0
             Top = 34
@@ -4622,6 +4462,166 @@
               LinkFont.Style = [fsUnderline]
             end
           end
+          object MapTabSheet: TSpTBXTabSheet
+            Left = 0
+            Top = 34
+            Width = 419
+            Height = 239
+            Caption = 'Map options'
+            ImageIndex = -1
+            DesignSize = (
+              419
+              239)
+            TabItem = 'MapTab'
+            object MapOptionsScrollBox: TTntScrollBox
+              Left = 8
+              Top = 48
+              Width = 402
+              Height = 189
+              VertScrollBar.Smooth = True
+              VertScrollBar.Tracking = True
+              Anchors = [akLeft, akTop, akRight, akBottom]
+              BiDiMode = bdLeftToRight
+              BorderStyle = bsNone
+              Color = clBtnFace
+              Ctl3D = False
+              ParentBiDiMode = False
+              ParentBackground = True
+              ParentColor = False
+              ParentCtl3D = False
+              TabOrder = 0
+            end
+            object panelMapOptionsDefault: TSpTBXPanel
+              Left = 8
+              Top = 4
+              Width = 402
+              Height = 41
+              Align = alCustom
+              TabOrder = 1
+              object btLoadDefaultMPO: TSpTBXButton
+                Left = 149
+                Top = 8
+                Width = 113
+                Height = 25
+                Caption = 'Load default'
+                TabOrder = 0
+                OnClick = btLoadDefaultMPOClick
+                LinkFont.Charset = DEFAULT_CHARSET
+                LinkFont.Color = clBlue
+                LinkFont.Height = -11
+                LinkFont.Name = 'MS Sans Serif'
+                LinkFont.Style = [fsUnderline]
+              end
+              object btSetAsDefaultMPO: TSpTBXButton
+                Left = 269
+                Top = 8
+                Width = 113
+                Height = 25
+                Caption = 'Set as default'
+                TabOrder = 1
+                OnClick = btSetAsDefaultMPOClick
+                LinkFont.Charset = DEFAULT_CHARSET
+                LinkFont.Color = clBlue
+                LinkFont.Height = -11
+                LinkFont.Name = 'MS Sans Serif'
+                LinkFont.Style = [fsUnderline]
+              end
+              object btLoadMapsDefaultMPO: TSpTBXButton
+                Left = 29
+                Top = 8
+                Width = 113
+                Height = 25
+                Caption = 'Load map'#39's default'
+                TabOrder = 2
+                OnClick = btLoadMapsDefaultMPOClick
+                LinkFont.Charset = DEFAULT_CHARSET
+                LinkFont.Color = clBlue
+                LinkFont.Height = -11
+                LinkFont.Name = 'MS Sans Serif'
+                LinkFont.Style = [fsUnderline]
+              end
+            end
+          end
+          object ModTabSheet: TSpTBXTabSheet
+            Left = 0
+            Top = 34
+            Width = 419
+            Height = 239
+            Caption = 'Mod options'
+            ImageIndex = -1
+            DesignSize = (
+              419
+              239)
+            TabItem = 'ModTab'
+            object ModOptionsScrollBox: TTntScrollBox
+              Left = 8
+              Top = 48
+              Width = 402
+              Height = 189
+              VertScrollBar.Smooth = True
+              VertScrollBar.Tracking = True
+              Anchors = [akLeft, akTop, akRight, akBottom]
+              BiDiMode = bdLeftToRight
+              BorderStyle = bsNone
+              Color = clBtnFace
+              Ctl3D = False
+              ParentBiDiMode = False
+              ParentBackground = True
+              ParentColor = False
+              ParentCtl3D = False
+              TabOrder = 0
+            end
+            object panelModOptionsDefault: TSpTBXPanel
+              Left = 8
+              Top = 4
+              Width = 402
+              Height = 41
+              Align = alCustom
+              TabOrder = 1
+              object btLoadDefaultMDO: TSpTBXButton
+                Left = 149
+                Top = 8
+                Width = 113
+                Height = 25
+                Caption = 'Load default'
+                TabOrder = 0
+                OnClick = btLoadDefaultMDOClick
+                LinkFont.Charset = DEFAULT_CHARSET
+                LinkFont.Color = clBlue
+                LinkFont.Height = -11
+                LinkFont.Name = 'MS Sans Serif'
+                LinkFont.Style = [fsUnderline]
+              end
+              object btSetAsDefaultMDO: TSpTBXButton
+                Left = 269
+                Top = 8
+                Width = 113
+                Height = 25
+                Caption = 'Set as default'
+                TabOrder = 1
+                OnClick = btSetAsDefaultMDOClick
+                LinkFont.Charset = DEFAULT_CHARSET
+                LinkFont.Color = clBlue
+                LinkFont.Height = -11
+                LinkFont.Name = 'MS Sans Serif'
+                LinkFont.Style = [fsUnderline]
+              end
+              object btLoadModsDefaultMDO: TSpTBXButton
+                Left = 29
+                Top = 8
+                Width = 113
+                Height = 25
+                Caption = 'Load mod'#39's default'
+                TabOrder = 2
+                OnClick = btLoadModsDefaultMDOClick
+                LinkFont.Charset = DEFAULT_CHARSET
+                LinkFont.Color = clBlue
+                LinkFont.Height = -11
+                LinkFont.Name = 'MS Sans Serif'
+                LinkFont.Style = [fsUnderline]
+              end
+            end
+          end
         end
       end
       object Panel6: TPanel

Modified: trunk/Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/BattleFormUnit.pas	2008-08-21 20:05:45 UTC (rev 6293)
+++ trunk/Lobby/TASClient/BattleFormUnit.pas	2008-08-21 22:02:20 UTC (rev 6294)
@@ -44,6 +44,7 @@
     DescriptionButton: TSpTBXButton;
     procedure MakeDescriptionButton(AOwner: TWinControl);
     procedure OnDescriptionButtonClick(Sender: TObject);virtual;
+    function GetSectionPanel(luaOptionList: TList): TSpTBXGroupBox;
 
   public
     DefaultValue: String;
@@ -51,7 +52,8 @@
     Key: String;
     Name: String;
     Description: String;
-    function GetComponent(AOwner: TWinControl):TWinControl;virtual;
+    Section: String;
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;virtual;
     procedure SetValue(v: String);virtual;
     procedure OnChange(Sender: TObject);virtual;
     procedure Enable;virtual;
@@ -61,6 +63,21 @@
     destructor Destroy; override;
   end;
 
+  TLuaOptionSection = class(TLuaOption)
+  private
+
+  protected
+    Panel: TSpTBXGroupBox;
+  public
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
+    procedure SetValue(v: String);override;
+    procedure Enable;override;
+    procedure Disable;override;
+    procedure setToDefault();override;
+    function toString:String;override;
+    destructor Destroy; override;
+  end;
+
   TLuaOptionBool = class(TLuaOption)
   private
 
@@ -68,7 +85,7 @@
     Panel: TPanel;
     CheckBox: TSpTBXCheckBox;
   public
-    function GetComponent(AOwner: TWinControl):TWinControl;override;
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
     procedure SetValue(v: String);override;
     procedure Enable;override;
     procedure Disable;override;
@@ -85,7 +102,7 @@
     InputEdit: TSpTBXEdit;
   public
     MaxStringLength: Integer;
-    function GetComponent(AOwner: TWinControl):TWinControl;override;
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
     procedure SetValue(v: String);override;
     procedure Enable;override;
     procedure Disable;override;
@@ -104,7 +121,7 @@
     MinValue: Double;
     MaxValue: Double;
     StepValue: Double;
-    function GetComponent(AOwner: TWinControl):TWinControl;override;
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
     procedure SetValue(v: String);override;
     procedure Enable;override;
     procedure Disable;override;
@@ -126,7 +143,7 @@
     KeyList: TStringList;
     DescriptionList: TStringList;
     constructor Create;
-    function GetComponent(AOwner: TWinControl):TWinControl;override;
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
     procedure SetValue(v: String);override;
     procedure Enable;override;
     procedure Disable;override;
@@ -5853,7 +5870,7 @@
 begin
   for i:=0 to luaOptionList.Count -1 do
   begin
-    c := TLuaOption(luaOptionList[i]).GetComponent(tabSheet);
+    c := TLuaOption(luaOptionList[i]).GetComponent(tabSheet,luaOptionList);
     c.Align := alBottom;
     c.Align := alTop;
     if (BattleState.Status = Joined) then
@@ -5878,6 +5895,21 @@
     DescriptionButton.OnClick := OnDescriptionButtonClick;
   end;
 end;
+function TLuaOption.GetSectionPanel(luaOptionList: TList): TSpTBXGroupBox;
+var
+  i : integer;
+begin
+  Result := nil;
+  if Section = '' then Exit;
+
+  for i:=0 to luaOptionList.Count-1 do
+    if TLuaOption(luaOptionList[i]).ClassType = TLuaOptionSection then
+      if LowerCase(TLuaOptionSection(luaOptionList[i]).Key) = LowerCase(Section) then
+      begin
+        Result := TLuaOptionSection(luaOptionList[i]).Panel;
+        Exit;
+      end;
+end;
 procedure TLuaOption.OnDescriptionButtonClick(Sender: TObject);
 begin
   MessageBox(BattleForm.Handle,PAnsiChar(Self.Name + ' : ' + Self.Description),PAnsiChar('Mod option description'),MB_OK);
@@ -5892,23 +5924,44 @@
   MessageBox(BattleForm.Handle,PAnsiChar(Self.Name + ' : ' + Self.Description+EOL+msg),PAnsiChar('Mod option description'),MB_OK);
 end;
 
-function TLuaOption.GetComponent(AOwner: TWinControl): TWinControl;
+function TLuaOption.GetComponent(AOwner: TWinControl;luaOptionList: TList): TWinControl;
+var
+  sec: TSpTBXGroupBox;
 begin
   if LabelName = nil then
   begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+      sec.Height := sec.Height + 18;
+    end;
+
     LabelName := TSpTBXLabel.Create(AOwner);
     LabelName.Parent := AOwner;
     LabelName.Caption := Name + ' : Unknown option type';
     LabelName.Font.Color := Colors.Error;
     LabelName.AutoSize := True;
+    LabelName.Font.Style := [];
   end;
   Result := LabelName;
 end;
 
-function TLuaOptionString.GetComponent(AOwner: TWinControl):TWinControl;
+function TLuaOptionString.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
+var
+  sec: TSpTBXGroupBox;
 begin
   if Panel = nil then
   begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+      sec.Height := sec.Height + 23;
+    end;
+
     Panel := TPanel.Create(AOwner);
     Panel.Parent := AOwner;
     Panel.BevelOuter := bvNone;
@@ -5924,6 +5977,8 @@
     LabelName.Width := 180;
     LabelName.Hint := Description;
     LabelName.ShowHint := True;
+    LabelName.ParentFont := False;
+    LabelName.Font.Style := [];
 
     InputEdit := TSpTBXEdit.Create(Panel);
     InputEdit.Parent := Panel;
@@ -5941,10 +5996,20 @@
   Result := Panel;
 end;
 
-function TLuaOptionNumber.GetComponent(AOwner: TWinControl):TWinControl;
+function TLuaOptionNumber.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
+var
+  sec: TSpTBXGroupBox;
 begin
   if Panel = nil then
   begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+      sec.Height := sec.Height + 23;
+    end;
+
     Panel := TPanel.Create(AOwner);
     Panel.Parent := AOwner;
     Panel.BevelOuter := bvNone;
@@ -5960,6 +6025,8 @@
     LabelName.Width := 180;
     LabelName.Hint := Description;
     LabelName.ShowHint := True;
+    LabelName.ParentFont := False;
+    LabelName.Font.Style := [];
 
     InputEdit := TJvSpinEdit.Create(Panel);
     InputEdit.Parent := Panel;
@@ -5995,10 +6062,20 @@
   Result := Panel;
 end;
 
-function TLuaOptionBool.GetComponent(AOwner: TWinControl):TWinControl;
+function TLuaOptionBool.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
+var
+  sec: TSpTBXGroupBox;
 begin
   if Panel = nil then
   begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+      sec.Height := sec.Height + 18;
+    end;
+
     Panel := TPanel.Create(AOwner);
     Panel.Parent := AOwner;
     Panel.BevelOuter := bvNone;
@@ -6013,6 +6090,8 @@
     LabelName.Width := 180;
     LabelName.Hint := Description;
     LabelName.ShowHint := True;
+    LabelName.ParentFont := False;
+    LabelName.Font.Style := [];
   
     CheckBox := TSpTBXCheckBox.Create(Panel);
     CheckBox.Parent := Panel;
@@ -6031,12 +6110,37 @@
   Result := Panel;
 end;
 
-function TLuaOptionList.GetComponent(AOwner: TWinControl):TWinControl;
+function TLuaOptionSection.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
+begin
+  if Panel = nil then
+  begin
+    Panel := TSpTBXGroupBox.Create(AOwner);
+    Panel.Parent := AOwner;
+    Panel.Height := 18;
+    Panel.Caption := Name;
+    Panel.ShowHint := True;
+    Panel.Hint := Description;
+    Panel.Font.Style := [fsBold];
+    //MakeDescriptionButton(Panel);
+  end;
+  Result := Panel;
+end;
+
+function TLuaOptionList.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
 var
   i: integer;
+  sec: TSpTBXGroupBox;
 begin
   if Panel = nil then
   begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+      sec.Height := sec.Height + 23;
+    end;
+
     Panel := TPanel.Create(AOwner);
     Panel.Parent := AOwner;
     Panel.BevelOuter := bvNone;
@@ -6053,6 +6157,8 @@
     LabelName.Width := 180;
     LabelName.Hint := Description;
     LabelName.ShowHint := True;
+    LabelName.ParentFont := False;
+    LabelName.Font.Style := [];
 
     ComboBox := TSpTBXComboBox.Create(Panel);
     ComboBox.Parent := Panel;
@@ -6097,6 +6203,11 @@
   Result := IntToStr(BoolToInt(CheckBox.Checked));
 end;
 
+function TLuaOptionSection.toString:String;
+begin
+  Result := '';
+end;
+
 procedure TLuaOption.OnChange(Sender: TObject);
 begin
   if (BattleState.Status = Hosting) and AllowBattleDetailsUpdate then
@@ -6153,6 +6264,14 @@
     CheckBox.Checked := StrToBool(v);
 end;
 
+procedure TLuaOptionSection.setToDefault;
+begin
+end;
+
+procedure TLuaOptionSection.SetValue(v: String);
+begin
+end;
+
 procedure TLuaOptionBool.setToDefault;
 begin
     CheckBox.Checked := StrToBool(DefaultValue);
@@ -6210,6 +6329,15 @@
   CheckBox.Enabled := False;
 end;
 
+procedure TLuaOptionSection.Enable;
+begin
+  Panel.Enabled := True;
+end;
+procedure TLuaOptionSection.Disable;
+begin
+  Panel.Enabled := False;
+end;
+
 procedure TLuaOptionNumber.Enable;
 begin
   LabelName.Enabled := True;
@@ -6223,7 +6351,6 @@
 
 destructor TLuaOption.Destroy;
 begin
-  LabelName.Destroy;
   inherited Destroy;
 end;
 
@@ -6253,6 +6380,12 @@
   Panel.Destroy;
 end;
 
+destructor TLuaOptionSection.Destroy;
+begin
+  inherited Destroy;
+  Panel.Destroy;
+end;
+
 function TBattleForm.GetLuaOption(optList: TList;key: string): TLuaOption;
 var
   i: Integer;

Modified: trunk/Lobby/TASClient/MainUnit.pas
===================================================================
--- trunk/Lobby/TASClient/MainUnit.pas	2008-08-21 20:05:45 UTC (rev 6293)
+++ trunk/Lobby/TASClient/MainUnit.pas	2008-08-21 22:02:20 UTC (rev 6294)
@@ -522,7 +522,7 @@
 const
   VERSION_NUMBER = '0.38'; // Must be float value! (with a period as a decimal seperator)
   CHECK_BETA_LOBBY_URL = '<A HREF="http://tasclient.no-ip.org/TASClient_update_v2.txt">http://tasclient.no-ip.org/TASClient_update_v2.txt</A>';
-  PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER + ' RC3';
+  PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER + ' RC4';
   KEEP_ALIVE_INTERVAL = 10000; // in milliseconds. Tells us what should be the maximum &quot;silence&quot; time before we send a ping to the server.
   ASSUME_TIMEOUT_INTERVAL = 30000; // in milliseconds. Must be greater than KEEP_ALIVE_INTERVAL! If server hasn't send any data to us within this interval, then we assume timeout occured. It's us who must make sure we get constant replies from server by pinging it.
   LOCAL_TAB = '$Local'; // caption of main (command) tab window. Must be special so that is different from channel names or user names, that is why there is a &quot;$&quot; in front of it.
@@ -5315,7 +5315,7 @@
         Client.AwayMessageSent := True;
       end;
 
-      if not Application.Active then FlashWindow(MainForm.Handle, true);
+      if not MainForm.Active then FlashWindow(MainForm.Handle, true);
 
       // add notification if private message and if application isn't focused:
       if (not Application.Active) and (NotificationsForm.CheckBox1.Checked) then AddNotification('Private message', '&lt;' + sl[1] + '&gt; ' + MakeSentenceWS(sl, 2), 2500);
@@ -9806,9 +9806,12 @@
 begin
   while true do
   begin
-    if Status.LoggedIn then
-    begin
-      MainForm.TryToSendCommand('PING');
+    try
+      if Status.LoggedIn then
+      begin
+        MainForm.TryToSendCommand('PING');
+      end;
+    except
     end;
     Sleep(8000);
   end;

Modified: trunk/Lobby/TASClient/TASClient.cfg
===================================================================
--- trunk/Lobby/TASClient/TASClient.cfg	2008-08-21 20:05:45 UTC (rev 6293)
+++ trunk/Lobby/TASClient/TASClient.cfg	2008-08-21 22:02:20 UTC (rev 6294)
@@ -31,7 +31,7 @@
 -M
 -$M16384,1048576
 -K$00400000
--E&quot;C:\Program Files\Spring&quot;
+-E&quot;C:\Program Files\SpringSVN&quot;
 -LE&quot;c:\program files\borland\delphi7\Projects\Bpl&quot;
 -LN&quot;c:\program files\borland\delphi7\Projects\Bpl&quot;
 -U&quot;E:\Tools\Developpement\spring_0.74b3_src\SVN\LobbyComponents\graphics32-1_5_1&quot;

Modified: trunk/Lobby/TASClient/TASClient.dof
===================================================================
--- trunk/Lobby/TASClient/TASClient.dof	2008-08-21 20:05:45 UTC (rev 6293)
+++ trunk/Lobby/TASClient/TASClient.dof	2008-08-21 22:02:20 UTC (rev 6294)
@@ -90,7 +90,7 @@
 ImageBase=4194304
 ExeDescription=
 [Directories]
-OutputDir=C:\Program Files\Spring
+OutputDir=C:\Program Files\SpringSVN
 UnitOutputDir=
 PackageDLLOutputDir=
 PackageDCPOutputDir=
@@ -101,10 +101,10 @@
 UsePackages=0
 [Parameters]
 RunParams=
-HostApplication=C:\Program Files\Spring\TASClient.exe
+HostApplication=C:\Program Files\SpringSVN\TASClient.exe
 Launcher=
 UseLauncher=0
-DebugCWD=C:\Program Files\Spring
+DebugCWD=C:\Program Files\SpringSVN
 [Language]
 ActiveLang=
 ProjectLang=
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=3
 Release=0
-Build=409
+Build=415
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=TA Spring lobby client
-FileVersion=0.3.0.409
+FileVersion=0.3.0.415
 InternalName=
 LegalCopyright=
 LegalTrademarks=
@@ -137,10 +137,14 @@
 [HistoryLists\hlUnitAliases]
 Count=1
 Item0=WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;
+[HistoryLists\hlSearchPath]
+Count=1
+Item0=E:\Tools\Developpement\spring_0.74b3_src\SVN\LobbyComponents\graphics32-1_5_1
 [HistoryLists\hlUnitOutputDirectory]
 Count=1
 Item0=C:\Program Files\TASpring
 [HistoryLists\hlOutputDirectorry]
-Count=2
-Item0=C:\Program Files\Spring
-Item1=C:\Program Files\TASpring
+Count=3
+Item0=C:\Program Files\SpringSVN
+Item1=C:\Program Files\Spring
+Item2=C:\Program Files\TASpring

Modified: trunk/Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)

Modified: trunk/Lobby/TASClient/Utility.pas
===================================================================
--- trunk/Lobby/TASClient/Utility.pas	2008-08-21 20:05:45 UTC (rev 6293)
+++ trunk/Lobby/TASClient/Utility.pas	2008-08-21 22:02:20 UTC (rev 6294)
@@ -162,6 +162,7 @@
 {since 0.76}function GetModOptionCount: Integer; stdcall; external 'UnitSync.dll' name 'GetModOptionCount';
 {since 0.76}function GetOptionKey(optIndex: Integer): PChar; stdcall; external 'UnitSync.dll' name 'GetOptionKey';
 {since 0.76}function GetOptionName(optIndex: Integer): PChar; stdcall; external 'UnitSync.dll' name 'GetOptionName';
+{since 0.77}function GetOptionSection(optIndex: Integer): PChar; stdcall; external 'UnitSync.dll' name 'GetOptionSection';
 {since 0.76}function GetOptionDesc(optIndex: Integer): PChar; stdcall; external 'UnitSync.dll' name 'GetOptionDesc';
 {since 0.76}function GetOptionType(optIndex: Integer): Integer; stdcall; external 'UnitSync.dll' name 'GetOptionType';
 {since 0.76}function GetOptionBoolDef(optIndex: Integer): Boolean; stdcall; external 'UnitSync.dll' name 'GetOptionBoolDef';
@@ -721,6 +722,11 @@
           MaxStringLength := GetOptionStringMaxLen(i);
         end;
       end;
+      5: // section
+      begin
+        New(o);
+        o^ := TLuaOptionSection.Create;
+      end;
     else
     begin
         New(o);
@@ -730,6 +736,7 @@
     o^.Key := StrNew(GetOptionKey(i));
     o^.Name := StrNew(GetOptionName(i));
     o^.Description := StrNew(GetOptionDesc(i));
+    o^.Section := StrNew(GetOptionSection(i));
     if modOptions then
     begin
       o^.KeyPrefix := 'GAME/MODOPTIONS/';
@@ -747,7 +754,11 @@
   i: Integer;
 begin
   for i:=0 to luaOptionList.Count-1 do
+    if TLuaOption(luaOptionList[i]).ClassType &lt;&gt; TLuaOptionSection then
       TLuaOption(luaOptionList[i]).Destroy;
+  for i:=0 to luaOptionList.Count-1 do
+    if TLuaOption(luaOptionList[i]).ClassType = TLuaOptionSection then
+      TLuaOption(luaOptionList[i]).Destroy;
   luaOptionList.Clear;
 end;
 function GetLuaAIList:TStrings;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001063.html">[Taspring-linux-commit] r6293 - trunk/tools/unitsync
</A></li>
	<LI>Next message: <A HREF="001065.html">[Taspring-linux-commit] r6295 - in trunk/rts: Game Game/Camera	Game/StartScripts Game/UI Lua Map Rendering Rendering/Env	Rendering/GL Rendering/Textures Rendering/UnitModels Sim	Sim/Features Sim/Misc Sim/MoveTypes Sim/Objects Sim/Path	Sim/Projectiles Sim/Projectiles/Unsynced	Sim/Projectiles/WeaponProjectiles Sim/Units Sim/Units/COB	Sim/Units/CommandAI System
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1064">[ date ]</a>
              <a href="thread.html#1064">[ thread ]</a>
              <a href="subject.html#1064">[ subject ]</a>
              <a href="author.html#1064">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
