<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6754 - in Lobby/springie: . ModInfoBuilder	ModInfoBuilder/Properties Springie Springie/Properties	Springie/UnitSync Springie/autohost Springie/client	Springie/doc Springie/spring Springie/utils
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6754%20-%20in%20Lobby/springie%3A%20.%20ModInfoBuilder%0A%09ModInfoBuilder/Properties%20Springie%20Springie/Properties%0A%09Springie/UnitSync%20Springie/autohost%20Springie/client%0A%09Springie/doc%20Springie/spring%20Springie/utils&In-Reply-To=%3C20081016020155.283434731%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001522.html">
   <LINK REL="Next"  HREF="001524.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6754 - in Lobby/springie: . ModInfoBuilder	ModInfoBuilder/Properties Springie Springie/Properties	Springie/UnitSync Springie/autohost Springie/client	Springie/doc Springie/spring Springie/utils</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6754%20-%20in%20Lobby/springie%3A%20.%20ModInfoBuilder%0A%09ModInfoBuilder/Properties%20Springie%20Springie/Properties%0A%09Springie/UnitSync%20Springie/autohost%20Springie/client%0A%09Springie/doc%20Springie/spring%20Springie/utils&In-Reply-To=%3C20081016020155.283434731%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6754 - in Lobby/springie: . ModInfoBuilder	ModInfoBuilder/Properties Springie Springie/Properties	Springie/UnitSync Springie/autohost Springie/client	Springie/doc Springie/spring Springie/utils">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Thu Oct 16 04:01:55 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001522.html">[Taspring-linux-commit] r6753 - trunk/rts/Sim/Units/CommandAI
</A></li>
        <LI>Next message: <A HREF="001524.html">[Taspring-linux-commit] r6755 - in Lobby/springie: ModInfoBuilder	Springie Springie/client Springie/spring Springie/utils
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1523">[ date ]</a>
              <a href="thread.html#1523">[ thread ]</a>
              <a href="subject.html#1523">[ subject ]</a>
              <a href="author.html#1523">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: Licho
Date: 2008-10-16 04:01:54 +0200 (Thu, 16 Oct 2008)
New Revision: 6754

Added:
   Lobby/springie/ModInfoBuilder/
   Lobby/springie/ModInfoBuilder/ModInfoBuilder.csproj
   Lobby/springie/ModInfoBuilder/ModInfoBuilder.csproj.user
   Lobby/springie/ModInfoBuilder/Program.cs
   Lobby/springie/ModInfoBuilder/Properties/
   Lobby/springie/ModInfoBuilder/Properties/AssemblyInfo.cs
   Lobby/springie/ModInfoBuilder/UnitSync.cs
   Lobby/springie/ModInfoBuilder/app.config
   Lobby/springie/Springie/UnitSync/
   Lobby/springie/Springie/UnitSync/ListOption.cs
   Lobby/springie/Springie/UnitSync/MapInfo.cs
   Lobby/springie/Springie/UnitSync/ModInfo.cs
   Lobby/springie/Springie/UnitSync/Option.cs
   Lobby/springie/Springie/UnitSync/UnitConverter.cs
   Lobby/springie/Springie/UnitSync/UnitInfo.cs
   Lobby/springie/Springie/UnitSync/UnitSyncWrapper.cs
Removed:
   Lobby/springie/Springie/Properties/app.manifest
   Lobby/springie/Springie/spring/UnitSync.cs
Modified:
   Lobby/springie/Springie.sln
   Lobby/springie/Springie/FormCurrentBattle.cs
   Lobby/springie/Springie/FormMain.Designer.cs
   Lobby/springie/Springie/FormMain.cs
   Lobby/springie/Springie/MainConfig.cs
   Lobby/springie/Springie/Properties/AssemblyInfo.cs
   Lobby/springie/Springie/Springie.csproj
   Lobby/springie/Springie/autohost/AutoHost.cs
   Lobby/springie/Springie/autohost/AutoHostConfig.cs
   Lobby/springie/Springie/autohost/AutoHost_commands.cs
   Lobby/springie/Springie/autohost/Polls.cs
   Lobby/springie/Springie/client/TasClient.cs
   Lobby/springie/Springie/doc/readme.txt
   Lobby/springie/Springie/spring/Spring.cs
   Lobby/springie/Springie/utils/AutoUpdater.cs
   Lobby/springie/Springie/utils/FileDownloader.cs
   Lobby/springie/Springie/utils/UnknownFilesLinker.cs
Log:
springie independent from unitsync. ModInfoBuilder used to pregenerate moddata

Added: Lobby/springie/ModInfoBuilder/ModInfoBuilder.csproj
===================================================================
--- Lobby/springie/ModInfoBuilder/ModInfoBuilder.csproj	                        (rev 0)
+++ Lobby/springie/ModInfoBuilder/ModInfoBuilder.csproj	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,69 @@
+&#65279;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+&lt;Project ToolsVersion=&quot;3.5&quot; DefaultTargets=&quot;Build&quot; xmlns=&quot;<A HREF="http://schemas.microsoft.com/developer/msbuild/2003">http://schemas.microsoft.com/developer/msbuild/2003</A>&quot;&gt;
+  &lt;PropertyGroup&gt;
+    &lt;Configuration Condition=&quot; '$(Configuration)' == '' &quot;&gt;Debug&lt;/Configuration&gt;
+    &lt;Platform Condition=&quot; '$(Platform)' == '' &quot;&gt;AnyCPU&lt;/Platform&gt;
+    &lt;ProductVersion&gt;9.0.30729&lt;/ProductVersion&gt;
+    &lt;SchemaVersion&gt;2.0&lt;/SchemaVersion&gt;
+    &lt;ProjectGuid&gt;{0E671B78-447F-40DF-A9C6-D9BD2CF7D137}&lt;/ProjectGuid&gt;
+    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
+    &lt;AppDesignerFolder&gt;Properties&lt;/AppDesignerFolder&gt;
+    &lt;RootNamespace&gt;ModInfoBuilder&lt;/RootNamespace&gt;
+    &lt;AssemblyName&gt;ModInfoBuilder&lt;/AssemblyName&gt;
+    &lt;TargetFrameworkVersion&gt;v2.0&lt;/TargetFrameworkVersion&gt;
+    &lt;FileAlignment&gt;512&lt;/FileAlignment&gt;
+    &lt;TargetFrameworkSubset&gt;
+    &lt;/TargetFrameworkSubset&gt;
+  &lt;/PropertyGroup&gt;
+  &lt;PropertyGroup Condition=&quot; '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' &quot;&gt;
+    &lt;DebugSymbols&gt;true&lt;/DebugSymbols&gt;
+    &lt;DebugType&gt;full&lt;/DebugType&gt;
+    &lt;Optimize&gt;false&lt;/Optimize&gt;
+    &lt;OutputPath&gt;..\bin\&lt;/OutputPath&gt;
+    &lt;DefineConstants&gt;DEBUG;TRACE&lt;/DefineConstants&gt;
+    &lt;ErrorReport&gt;prompt&lt;/ErrorReport&gt;
+    &lt;WarningLevel&gt;4&lt;/WarningLevel&gt;
+    &lt;PlatformTarget&gt;x86&lt;/PlatformTarget&gt;
+  &lt;/PropertyGroup&gt;
+  &lt;PropertyGroup Condition=&quot; '$(Configuration)|$(Platform)' == 'Release|AnyCPU' &quot;&gt;
+    &lt;DebugType&gt;pdbonly&lt;/DebugType&gt;
+    &lt;Optimize&gt;true&lt;/Optimize&gt;
+    &lt;OutputPath&gt;bin\Release\&lt;/OutputPath&gt;
+    &lt;DefineConstants&gt;TRACE&lt;/DefineConstants&gt;
+    &lt;ErrorReport&gt;prompt&lt;/ErrorReport&gt;
+    &lt;WarningLevel&gt;4&lt;/WarningLevel&gt;
+  &lt;/PropertyGroup&gt;
+  &lt;ItemGroup&gt;
+    &lt;Reference Include=&quot;System&quot; /&gt;
+    &lt;Reference Include=&quot;System.Xml.Linq&quot;&gt;
+      &lt;RequiredTargetFramework&gt;3.5&lt;/RequiredTargetFramework&gt;
+    &lt;/Reference&gt;
+    &lt;Reference Include=&quot;System.Data.DataSetExtensions&quot;&gt;
+      &lt;RequiredTargetFramework&gt;3.5&lt;/RequiredTargetFramework&gt;
+    &lt;/Reference&gt;
+    &lt;Reference Include=&quot;System.Data&quot; /&gt;
+    &lt;Reference Include=&quot;System.Xml&quot; /&gt;
+  &lt;/ItemGroup&gt;
+  &lt;ItemGroup&gt;
+    &lt;Compile Include=&quot;Program.cs&quot; /&gt;
+    &lt;Compile Include=&quot;Properties\AssemblyInfo.cs&quot; /&gt;
+    &lt;Compile Include=&quot;UnitSync.cs&quot; /&gt;
+  &lt;/ItemGroup&gt;
+  &lt;ItemGroup&gt;
+    &lt;ProjectReference Include=&quot;..\Springie\Springie.csproj&quot;&gt;
+      &lt;Project&gt;{DD5A4F64-6C82-4F75-9EED-992378EC65FC}&lt;/Project&gt;
+      &lt;Name&gt;Springie&lt;/Name&gt;
+    &lt;/ProjectReference&gt;
+  &lt;/ItemGroup&gt;
+  &lt;ItemGroup&gt;
+    &lt;None Include=&quot;app.config&quot; /&gt;
+  &lt;/ItemGroup&gt;
+  &lt;Import Project=&quot;$(MSBuildToolsPath)\Microsoft.CSharp.targets&quot; /&gt;
+  &lt;!-- To modify your build process, add your task inside one of the targets below and uncomment it. 
+       Other similar extension points exist, see Microsoft.Common.targets.
+  &lt;Target Name=&quot;BeforeBuild&quot;&gt;
+  &lt;/Target&gt;
+  &lt;Target Name=&quot;AfterBuild&quot;&gt;
+  &lt;/Target&gt;
+  --&gt;
+&lt;/Project&gt;
\ No newline at end of file

Added: Lobby/springie/ModInfoBuilder/ModInfoBuilder.csproj.user
===================================================================
--- Lobby/springie/ModInfoBuilder/ModInfoBuilder.csproj.user	                        (rev 0)
+++ Lobby/springie/ModInfoBuilder/ModInfoBuilder.csproj.user	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,5 @@
+&#65279;&lt;Project xmlns=&quot;<A HREF="http://schemas.microsoft.com/developer/msbuild/2003">http://schemas.microsoft.com/developer/msbuild/2003</A>&quot;&gt;
+  &lt;PropertyGroup Condition=&quot; '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' &quot;&gt;
+    &lt;StartArguments&gt;c:\programy\hry\spring&lt;/StartArguments&gt;
+  &lt;/PropertyGroup&gt;
+&lt;/Project&gt;
\ No newline at end of file

Added: Lobby/springie/ModInfoBuilder/Program.cs
===================================================================
--- Lobby/springie/ModInfoBuilder/Program.cs	                        (rev 0)
+++ Lobby/springie/ModInfoBuilder/Program.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,25 @@
+&#65279;using System;
+using System.Collections.Generic;
+using System.IO;
+using System.Runtime.Serialization.Formatters.Binary;
+using System.Text;
+using Springie.SpringNamespace;
+
+namespace ModInfoBuilder
+{
+	class Program
+	{
+		static void Main(string[] args)
+		{
+			if (args.Length ==0) {
+				Console.WriteLine(&quot;Needs path to spring&quot;);
+				return;
+			}
+			var us = new UnitSync(args[0]);
+			BinaryFormatter bf = new BinaryFormatter();
+			using (var fs = new FileStream(&quot;mapinfo.dat&quot;, FileMode.Create)) bf.Serialize(fs, us.MapList);
+			using (var fs = new FileStream(&quot;modinfo.dat&quot;, FileMode.Create)) bf.Serialize(fs, us.ModList);
+
+		}
+	}
+}

Added: Lobby/springie/ModInfoBuilder/Properties/AssemblyInfo.cs
===================================================================
--- Lobby/springie/ModInfoBuilder/Properties/AssemblyInfo.cs	                        (rev 0)
+++ Lobby/springie/ModInfoBuilder/Properties/AssemblyInfo.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,36 @@
+&#65279;using System.Reflection;
+using System.Runtime.CompilerServices;
+using System.Runtime.InteropServices;
+
+// General Information about an assembly is controlled through the following 
+// set of attributes. Change these attribute values to modify the information
+// associated with an assembly.
+[assembly: AssemblyTitle(&quot;ModInfoBuilder&quot;)]
+[assembly: AssemblyDescription(&quot;&quot;)]
+[assembly: AssemblyConfiguration(&quot;&quot;)]
+[assembly: AssemblyCompany(&quot;Microsoft&quot;)]
+[assembly: AssemblyProduct(&quot;ModInfoBuilder&quot;)]
+[assembly: AssemblyCopyright(&quot;Copyright &#169; Microsoft 2008&quot;)]
+[assembly: AssemblyTrademark(&quot;&quot;)]
+[assembly: AssemblyCulture(&quot;&quot;)]
+
+// Setting ComVisible to false makes the types in this assembly not visible 
+// to COM components.  If you need to access a type in this assembly from 
+// COM, set the ComVisible attribute to true on that type.
+[assembly: ComVisible(false)]
+
+// The following GUID is for the ID of the typelib if this project is exposed to COM
+[assembly: Guid(&quot;25733ca5-6df0-45ca-8220-44ef05b795e7&quot;)]
+
+// Version information for an assembly consists of the following four values:
+//
+//      Major Version
+//      Minor Version 
+//      Build Number
+//      Revision
+//
+// You can specify all the values or you can default the Build and Revision Numbers 
+// by using the '*' as shown below:
+// [assembly: AssemblyVersion(&quot;1.0.*&quot;)]
+[assembly: AssemblyVersion(&quot;1.0.0.0&quot;)]
+[assembly: AssemblyFileVersion(&quot;1.0.0.0&quot;)]

Added: Lobby/springie/ModInfoBuilder/UnitSync.cs
===================================================================
--- Lobby/springie/ModInfoBuilder/UnitSync.cs	                        (rev 0)
+++ Lobby/springie/ModInfoBuilder/UnitSync.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,391 @@
+using System;
+using System.Collections.Generic;
+using System.Globalization;
+using System.IO;
+using System.Runtime.InteropServices;
+using System.Threading;
+
+namespace Springie.SpringNamespace
+{
+	public class UnitSync : IDisposable
+	{
+		#region Fields
+
+		private Dictionary&lt;string, MapInfo&gt; mapList = new Dictionary&lt;string, MapInfo&gt;();
+		private Dictionary&lt;string, ModInfo&gt; modList = new Dictionary&lt;string, ModInfo&gt;();
+		private string path;
+
+		#endregion
+
+		#region Properties
+
+		public Dictionary&lt;string, MapInfo&gt; MapList
+		{
+			get { return mapList; }
+		}
+
+		public Dictionary&lt;string, ModInfo&gt; ModList
+		{
+			get { return modList; }
+		}
+
+		#endregion
+
+		#region Constructors
+
+		public UnitSync() : this(Directory.GetCurrentDirectory()) {}
+
+		public UnitSync(string path)
+		{
+			this.path = path;
+			string opath = Directory.GetCurrentDirectory();
+			Directory.SetCurrentDirectory(path);
+			if (Init(false, 0) != 1) throw new Exception(&quot;unitsync.dll init failed&quot;);
+			//if (InitArchiveScanner() != 1) throw new Exception(&quot;unitsync.dll:InitArchiveScanner() failed&quot;);
+			LoadModList();
+			LoadMapList();
+			Directory.SetCurrentDirectory(opath);
+		}
+
+		public void Dispose()
+		{
+			UnInit();
+		}
+
+		#endregion
+
+		#region Public methods
+
+		public MapInfo GetMapInfo(string name)
+		{
+			return mapList[name];
+		}
+
+		public ModInfo GetModInfo(string name)
+		{
+			if (modList.ContainsKey(name)) return modList[name];
+			else {
+				foreach (var p in modList) if (p.Value.ArchiveName == name) return p.Value;
+				return null;
+			}
+		}
+
+		public bool HasMap(string name)
+		{
+			return mapList.ContainsKey(name);
+		}
+
+
+		public bool HasMod(string modName)
+		{
+			if (!modList.ContainsKey(modName)) {
+				foreach (var p in modList) if (p.Value.ArchiveName == modName) return true;
+				return false;
+			} else return true;
+		}
+
+		/// &lt;summary&gt;
+		/// Loads new map information
+		/// &lt;/summary&gt;
+
+		internal  void LoadMapInfo(MapInfo mi, int mapId)
+		{
+			string opath = Directory.GetCurrentDirectory();
+			Directory.SetCurrentDirectory(path);
+			ReInit(true);
+      
+			mi.Checksum = (int)GetMapChecksum(mapId);
+
+			Directory.SetCurrentDirectory(opath);
+		}
+
+		internal void LoadModInfo(ModInfo mi, int ModId)
+		{
+			Thread.CurrentThread.CurrentCulture = CultureInfo.InvariantCulture;
+			string opath = Directory.GetCurrentDirectory();
+			Directory.SetCurrentDirectory(path);
+			ReInit(true);
+
+			//GetPrimaryModCount();
+			if (mi.Name != GetPrimaryModName(ModId)) throw new Exception(&quot;Mod &quot; + mi.Name + &quot; modified without reload&quot;);
+
+			//uint result = 0;
+			mi.ArchiveName = GetPrimaryModArchive(ModId);
+
+			mi.Checksum = (int)GetPrimaryModChecksum(ModId);
+
+			AddAllArchives(mi.ArchiveName);
+			mi.Sides = new String[GetSideCount()];
+			for (int x = 0; x &lt; mi.Sides.Length; ++x) mi.Sides[x] = GetSideName(x);
+
+			// weirdest stuff of all...
+			while (ProcessUnitsNoChecksum() != 0) {}
+			
+			mi.Units = new UnitInfo[GetUnitCount()];
+			for (int x = 0; x &lt; mi.Units.Length; ++x) mi.Units[x] = new UnitInfo(GetUnitName(x), GetFullUnitName(x));
+
+			int opts = GetModOptionCount();
+			for (int x = 0; x &lt; opts; x++) {
+				var o = LoadOption(x);
+				mi.Options.Add(o);
+			}
+
+			Directory.SetCurrentDirectory(opath);
+		}
+
+		internal void Reload(bool reloadMods, bool reloadMaps)
+		{
+			if (reloadMods || reloadMaps) ReInit(true);
+			if (reloadMaps) LoadMapList();
+			if (reloadMods) LoadModList();
+		}
+
+		#endregion
+
+		#region Other methods
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern void AddAllArchives(string root);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern uint GetArchiveChecksum(string archive);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetFullUnitName(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetMapArchiveCount(string mapName);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetMapArchiveName(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetMapCount();
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetMapName(int index);
+
+		/************************************************************************/
+		/*     OPTIONS                                                          */
+		/************************************************************************/
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetMapOptionCount(string mapName);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetModOptionCount();
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetOptionBoolDef(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetOptionDesc(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetOptionKey(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetOptionListCount(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetOptionListDef(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetOptionListItemDesc(int index, int itemIndex);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetOptionListItemKey(int index, int itemIndex);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetOptionListItemName(int index, int itemIndex);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetOptionName(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern float GetOptionNumberDef(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern float GetOptionNumberMax(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern float GetOptionNumberMin(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern float GetOptionNumberStep(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetOptionStringDef(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetOptionStringMaxLen(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetOptionType(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetPrimaryModArchive(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetPrimaryModArchiveCount(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetPrimaryModArchiveList(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern uint GetMapChecksumFromName(string mapName);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern uint GetMapChecksum(int mapIndex);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern uint GetPrimaryModChecksum(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetPrimaryModCount();
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetPrimaryModName(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetSideCount();
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetSideName(int index);
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int GetUnitCount();
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern string GetUnitName(int index);
+
+		/*
+    //     INIT
+    */
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int Init(bool isServer, int id);
+
+		/// &lt;summary&gt;
+		/// Gets map list from unit sync, does not make full reinit by default
+		/// &lt;/summary&gt;
+		/// &lt;returns&gt;&lt;/returns&gt;
+		private void LoadMapList()
+		{
+			string opath = Directory.GetCurrentDirectory();
+			Directory.SetCurrentDirectory(path);
+
+			int mapCount = GetMapCount();
+			mapList.Clear();
+			for (int i = 0; i &lt; mapCount; ++i) {
+				var mi = new MapInfo(GetMapName(i));
+				LoadMapInfo(mi, i);
+				mapList[mi.Name] = mi;
+			}
+			Directory.SetCurrentDirectory(opath);
+		}
+
+
+		/// &lt;summary&gt;
+		/// Gets mod list - does not make full reinit by default
+		/// &lt;/summary&gt;
+		/// &lt;returns&gt;&lt;/returns&gt;
+		private void LoadModList()
+		{
+			string opath = Directory.GetCurrentDirectory();
+			Directory.SetCurrentDirectory(path);
+
+			int modCount = GetPrimaryModCount();
+
+			modList.Clear();
+			for (int i = 0; i &lt; modCount; ++i) {
+				var mi = new ModInfo(GetPrimaryModName(i));
+				LoadModInfo(mi, i);
+				modList[mi.Name] = mi;
+			}
+		}
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern int ProcessUnitsNoChecksum();
+
+		/// &lt;summary&gt;
+		/// ReInits unitsync
+		/// &lt;/summary&gt;
+		/// &lt;param name=&quot;full&quot;&gt;if true does complete reinit (neccesary to find new map or mod), if false does just archivescannerinit&lt;/param&gt;
+		private void ReInit(bool full)
+		{
+			string opath = Directory.GetCurrentDirectory();
+			Directory.SetCurrentDirectory(path);
+
+			if (full) {
+				UnInit();
+				if (Init(false, 0) != 1) throw new Exception(&quot;unitsync.dll init failed&quot;);
+			}
+			//if (InitArchiveScanner() != 1) throw new Exception(&quot;unitsync.dll:InitArchiveScanner() failed&quot;);
+
+			Directory.SetCurrentDirectory(opath);
+		}
+
+		private string RequestMapArchive(string mapname)
+		{
+			int i = GetMapArchiveCount(mapname);
+			if (i &gt; 0) {
+				string arch = GetMapArchiveName(0);
+				int lastslash = arch.LastIndexOfAny(new[] {'/', '\\'});
+				return arch.Substring(lastslash + 1);
+			} else return &quot;&quot;;
+		}
+
+
+		[DllImport(&quot;unitsync.dll&quot;)]
+		private static extern void UnInit();
+
+		#endregion
+
+	
+
+		public Option LoadOption(int idx)
+		{
+			var o = new Option();
+
+				o.Name = GetOptionName(idx);
+				o.Key = GetOptionKey(idx);
+				o.Description = GetOptionDesc(idx);
+				o.OptionType = (Option.Type)GetOptionType(idx);
+				o.strMaxLen = GetOptionStringMaxLen(idx);
+				o.min = GetOptionNumberMin(idx);
+				o.max = GetOptionNumberMax(idx);
+				int listCount = GetOptionListCount(idx);
+				for (int i = 0; i &lt; listCount; i++) {
+					var optl = LoadListOption(idx, i);
+					o.ListOptions.Add(optl);
+				}
+				switch (o.OptionType)
+				{
+					case Option.Type.Bool:
+						o.Default = GetOptionBoolDef(idx).ToString();
+						break;
+					case Option.Type.Number:
+						o.Default = GetOptionNumberDef(idx).ToString();
+						break;
+					case Option.Type.String:
+						o.Default = GetOptionStringDef(idx);
+						break;
+					case Option.Type.List:
+						o.Default = GetOptionListDef(idx);
+						break;
+				}
+			return o;	
+		}
+
+		public ListOption LoadListOption(int optionIndex, int itemIndex)
+		{
+			var lo = new ListOption();
+			lo.Name = GetOptionListItemName(optionIndex, itemIndex);
+			lo.Description = GetOptionListItemDesc(optionIndex, itemIndex);
+			lo.Key = GetOptionListItemKey(optionIndex, itemIndex);
+			return lo;
+		}
+
+	}
+}
\ No newline at end of file

Added: Lobby/springie/ModInfoBuilder/app.config
===================================================================
--- Lobby/springie/ModInfoBuilder/app.config	                        (rev 0)
+++ Lobby/springie/ModInfoBuilder/app.config	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,3 @@
+&#65279;&lt;?xml version=&quot;1.0&quot;?&gt;
+&lt;configuration&gt;
+&lt;startup&gt;&lt;supportedRuntime version=&quot;v2.0.50727&quot;/&gt;&lt;/startup&gt;&lt;/configuration&gt;

Modified: Lobby/springie/Springie/FormCurrentBattle.cs
===================================================================
--- Lobby/springie/Springie/FormCurrentBattle.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/FormCurrentBattle.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -48,7 +48,7 @@
 			if (b != null) {
 				Program.main.Tas.UpdateBattleDetails(bat.BattleDetails);
 				Program.main.Tas.ChangeLock(bat.Locked);
-				Program.main.Tas.ChangeMap(Program.main.Spring.UnitSync.GetMapInfo(bat.Map));
+				Program.main.Tas.ChangeMap(Program.main.Spring.UnitSyncWrapper.GetMapInfo(bat.Map));
 				Program.main.Tas.EnableAllUnits();
 
 				Program.main.Tas.DisableUnits(UnitInfo.ToStringList(bat.DisabledUnits));

Modified: Lobby/springie/Springie/FormMain.Designer.cs
===================================================================
--- Lobby/springie/Springie/FormMain.Designer.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/FormMain.Designer.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -40,7 +40,6 @@
 			this.currentBattleToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
 			this.actionsToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
 			this.rehostToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
-			this.reloadModsMapsToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
 			this.springToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
 			this.tabControl = new System.Windows.Forms.TabControl();
 			this.tabPage1 = new System.Windows.Forms.TabPage();
@@ -155,8 +154,7 @@
 			// actionsToolStripMenuItem
 			// 
 			this.actionsToolStripMenuItem.DropDownItems.AddRange(new System.Windows.Forms.ToolStripItem[] {
-            this.rehostToolStripMenuItem,
-            this.reloadModsMapsToolStripMenuItem});
+            this.rehostToolStripMenuItem});
 			this.actionsToolStripMenuItem.Name = &quot;actionsToolStripMenuItem&quot;;
 			this.actionsToolStripMenuItem.Size = new System.Drawing.Size(59, 20);
 			this.actionsToolStripMenuItem.Text = &quot;Actions&quot;;
@@ -165,17 +163,10 @@
 			// 
 			this.rehostToolStripMenuItem.Enabled = false;
 			this.rehostToolStripMenuItem.Name = &quot;rehostToolStripMenuItem&quot;;
-			this.rehostToolStripMenuItem.Size = new System.Drawing.Size(177, 22);
+			this.rehostToolStripMenuItem.Size = new System.Drawing.Size(152, 22);
 			this.rehostToolStripMenuItem.Text = &quot;Rehost&quot;;
 			this.rehostToolStripMenuItem.Click += new System.EventHandler(this.rehostToolStripMenuItem_Click);
 			// 
-			// reloadModsMapsToolStripMenuItem
-			// 
-			this.reloadModsMapsToolStripMenuItem.Name = &quot;reloadModsMapsToolStripMenuItem&quot;;
-			this.reloadModsMapsToolStripMenuItem.Size = new System.Drawing.Size(177, 22);
-			this.reloadModsMapsToolStripMenuItem.Text = &quot;Reload Mods/Maps&quot;;
-			this.reloadModsMapsToolStripMenuItem.Click += new System.EventHandler(this.reloadModsMapsToolStripMenuItem_Click);
-			// 
 			// springToolStripMenuItem
 			// 
 			this.springToolStripMenuItem.Name = &quot;springToolStripMenuItem&quot;;
@@ -219,7 +210,7 @@
 			this.tabPage2.Location = new System.Drawing.Point(4, 22);
 			this.tabPage2.Name = &quot;tabPage2&quot;;
 			this.tabPage2.Padding = new System.Windows.Forms.Padding(3);
-			this.tabPage2.Size = new System.Drawing.Size(514, 525);
+			this.tabPage2.Size = new System.Drawing.Size(514, 523);
 			this.tabPage2.TabIndex = 1;
 			this.tabPage2.Text = &quot;tabPage2&quot;;
 			this.tabPage2.UseVisualStyleBackColor = true;
@@ -387,8 +378,7 @@
     private System.Windows.Forms.SplitContainer splitContainer2;
     private System.Windows.Forms.ToolStripMenuItem actionsToolStripMenuItem;
     private System.Windows.Forms.ToolStripMenuItem rehostToolStripMenuItem;
-    private System.Windows.Forms.ToolStripMenuItem springToolStripMenuItem;
-		private System.Windows.Forms.ToolStripMenuItem reloadModsMapsToolStripMenuItem;
+		private System.Windows.Forms.ToolStripMenuItem springToolStripMenuItem;
     private System.Windows.Forms.StatusStrip statusStrip1;
     private System.Windows.Forms.ToolStripStatusLabel toolStripStatusLabel1;
     private System.Windows.Forms.ToolStripStatusLabel toolStripStatusLabel2;

Modified: Lobby/springie/Springie/FormMain.cs
===================================================================
--- Lobby/springie/Springie/FormMain.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/FormMain.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -263,12 +263,7 @@
 			else main.AutoHost.ComRehost(TasSayEventArgs.Default, new string[] {});
 		}
 
-		private void reloadModsMapsToolStripMenuItem_Click(object sender, EventArgs e)
-		{
-			main.Spring.Reload(true, true);
-		}
 
-
 		private void rt_TextChanged(object sender, EventArgs e)
 		{
 			var rt = (RichTextBox) sender;

Modified: Lobby/springie/Springie/MainConfig.cs
===================================================================
--- Lobby/springie/Springie/MainConfig.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/MainConfig.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -11,10 +11,12 @@
 	{
 		#region Constants
 
-		public const string SpringieVersion = &quot;Springie 1.19&quot;;
+		public const string SpringieVersion = &quot;Springie 1.20&quot;;
 
 		#endregion
 
+		private string executableName = &quot;spring-dedicated.exe&quot;;
+
 		#region CaUpdateMode enum
 
 		public enum CaUpdateMode
@@ -49,16 +51,12 @@
 		private bool gargamelMode = true;
 		private ProcessPriorityClass hostingProcessPriority = ProcessPriorityClass.AboveNormal;
 		private string[] joinChannels = new[] {&quot;main&quot;};
-		private string planetWarsServer = &quot;<A HREF="tcp://licho.eu:1666/IServer">tcp://licho.eu:1666/IServer</A>&quot;;
+		private string planetWarsServer = &quot;licho.eu&quot;;
 		private bool redirectGameChat = true;
 		private string serverHost = &quot;taspringmaster.clan-sy.com&quot;;
 		private int serverPort = 8200;
 		private int springCoreAffinity = 1;
 		private string springPath = &quot;./&quot;;
-		private int springResolutionX = 40;
-		private int springResolutionY = 40;
-		private bool springStartsHidden = true;
-		private bool springStartsMinimized = true;
 		private bool statsEnabledReal = true;
 		private string statsUrlAddressReal = &quot;<A HREF="http://springie.licho.eu/">http://springie.licho.eu/</A>&quot;;
 
@@ -201,53 +199,14 @@
 			set { springCoreAffinity = value; }
 		}
 
+		[Description(&quot;Path to your dedicated server folder&quot;)]
 		[Category(&quot;Spring&quot;)]
-		[Description(&quot;Should hosting spring start as fullscreen&quot;)]
-		public bool SpringFullscreen { get; set; }
-
-
-		[Description(&quot;Path to your spring directory folder&quot;)]
-		[Category(&quot;Spring&quot;)]
 		public string SpringPath
 		{
 			get { return springPath; }
 			set { springPath = value; }
 		}
 
-
-		[Category(&quot;Spring&quot;)]
-		[Description(&quot;Default hosting spring window width&quot;)]
-		public int SpringResolutionX
-		{
-			get { return springResolutionX; }
-			set { springResolutionX = value; }
-		}
-
-		[Category(&quot;Spring&quot;)]
-		[Description(&quot;Default hosting spring window height&quot;)]
-		public int SpringResolutionY
-		{
-			get { return springResolutionY; }
-			set { springResolutionY = value; }
-		}
-
-
-		[Category(&quot;Spring&quot;)]
-		[Description(&quot;Should hosting spring start hidden by default&quot;)]
-		public bool SpringStartsHidden
-		{
-			get { return springStartsHidden; }
-			set { springStartsHidden = value; }
-		}
-
-		[Category(&quot;Spring&quot;)]
-		[Description(&quot;Should hosting spring start minimized by default&quot;)]
-		public bool SpringStartsMinimized
-		{
-			get { return springStartsMinimized; }
-			set { springStartsMinimized = value; }
-		}
-
 		[Description(&quot;Should this server report data to stats server?&quot;)]
 		[Category(&quot;Server connection&quot;)]
 		public bool StatsEnabledReal
@@ -268,6 +227,14 @@
 			}
 		}
 
+		[Category(&quot;Spring&quot;)]
+		[Description(&quot;Executable to run&quot;)]
+		public string ExecutableName
+		{
+			get { return executableName; }
+			set { executableName = value; }
+		}
+
 		#endregion
 	} ;
 }
\ No newline at end of file

Modified: Lobby/springie/Springie/Properties/AssemblyInfo.cs
===================================================================
--- Lobby/springie/Springie/Properties/AssemblyInfo.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/Properties/AssemblyInfo.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -37,7 +37,6 @@
 //      Revision
 //
 
-[assembly: AssemblyVersion(&quot;0.99.*&quot;)]
-//[assembly: AssemblyFileVersion(&quot;0.97.0.0&quot;)]
+[assembly: AssemblyVersion(&quot;1.0.0.0&quot;)]
 
 [assembly: NeutralResourcesLanguage(&quot;en&quot;)]
\ No newline at end of file

Deleted: Lobby/springie/Springie/Properties/app.manifest
===================================================================
--- Lobby/springie/Springie/Properties/app.manifest	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/Properties/app.manifest	2008-10-16 02:01:54 UTC (rev 6754)
@@ -1,11 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
-&lt;asmv1:assembly manifestVersion=&quot;1.0&quot; xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot; xmlns:asmv1=&quot;urn:schemas-microsoft-com:asm.v1&quot; xmlns:asmv2=&quot;urn:schemas-microsoft-com:asm.v2&quot; xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;&gt;
-  &lt;trustInfo xmlns=&quot;urn:schemas-microsoft-com:asm.v2&quot;&gt;
-    &lt;security&gt;
-      &lt;applicationRequestMinimum&gt;
-        &lt;defaultAssemblyRequest permissionSetReference=&quot;Custom&quot; /&gt;
-        &lt;PermissionSet class=&quot;System.Security.PermissionSet&quot; version=&quot;1&quot; Unrestricted=&quot;true&quot; ID=&quot;Custom&quot; SameSite=&quot;site&quot; /&gt;
-      &lt;/applicationRequestMinimum&gt;
-    &lt;/security&gt;
-  &lt;/trustInfo&gt;
-&lt;/asmv1:assembly&gt;
\ No newline at end of file

Modified: Lobby/springie/Springie/Springie.csproj
===================================================================
--- Lobby/springie/Springie/Springie.csproj	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/Springie.csproj	2008-10-16 02:01:54 UTC (rev 6754)
@@ -131,6 +131,12 @@
       &lt;DependentUpon&gt;FormCurrentBattle.cs&lt;/DependentUpon&gt;
     &lt;/Compile&gt;
     &lt;Compile Include=&quot;MainConfig.cs&quot; /&gt;
+    &lt;Compile Include=&quot;UnitSync\ListOption.cs&quot; /&gt;
+    &lt;Compile Include=&quot;UnitSync\MapInfo.cs&quot; /&gt;
+    &lt;Compile Include=&quot;UnitSync\ModInfo.cs&quot; /&gt;
+    &lt;Compile Include=&quot;UnitSync\Option.cs&quot; /&gt;
+    &lt;Compile Include=&quot;UnitSync\UnitConverter.cs&quot; /&gt;
+    &lt;Compile Include=&quot;UnitSync\UnitInfo.cs&quot; /&gt;
     &lt;Compile Include=&quot;utils\AutoUpdater.cs&quot; /&gt;
     &lt;Compile Include=&quot;utils\FileDownloader.cs&quot; /&gt;
     &lt;Compile Include=&quot;utils\UnknownFilesLinker.cs&quot; /&gt;
@@ -198,7 +204,7 @@
     &lt;Compile Include=&quot;spring\ConfigMaker.cs&quot; /&gt;
     &lt;Compile Include=&quot;spring\Spring.cs&quot; /&gt;
     &lt;Compile Include=&quot;spring\Talker.cs&quot; /&gt;
-    &lt;Compile Include=&quot;spring\UnitSync.cs&quot; /&gt;
+    &lt;Compile Include=&quot;UnitSync\UnitSyncWrapper.cs&quot; /&gt;
     &lt;Compile Include=&quot;utils\MyCol.cs&quot; /&gt;
     &lt;Compile Include=&quot;utils\Stats.cs&quot; /&gt;
     &lt;Compile Include=&quot;utils\Utils.cs&quot; /&gt;
@@ -209,7 +215,6 @@
     &lt;None Include=&quot;Resources\joined.ico&quot; /&gt;
   &lt;/ItemGroup&gt;
   &lt;ItemGroup&gt;
-    &lt;BaseApplicationManifest Include=&quot;Properties\app.manifest&quot; /&gt;
     &lt;BootstrapperPackage Include=&quot;Microsoft.Net.Framework.2.0&quot;&gt;
       &lt;Visible&gt;False&lt;/Visible&gt;
       &lt;ProductName&gt;.NET Framework 2.0&lt;/ProductName&gt;

Added: Lobby/springie/Springie/UnitSync/ListOption.cs
===================================================================
--- Lobby/springie/Springie/UnitSync/ListOption.cs	                        (rev 0)
+++ Lobby/springie/Springie/UnitSync/ListOption.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,16 @@
+using System;
+
+namespace Springie.SpringNamespace
+{
+	[Serializable]
+	public struct ListOption
+	{
+		#region Properties
+
+		public string Description;
+		public string Key;
+		public string Name;
+
+		#endregion
+	}
+}
\ No newline at end of file

Added: Lobby/springie/Springie/UnitSync/MapInfo.cs
===================================================================
--- Lobby/springie/Springie/UnitSync/MapInfo.cs	                        (rev 0)
+++ Lobby/springie/Springie/UnitSync/MapInfo.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,41 @@
+using System;
+
+namespace Springie.SpringNamespace
+{
+	[Serializable]
+	public class MapInfo
+	{
+		#region Fields
+
+		protected string archiveName;
+
+		#endregion
+
+		#region Properties
+
+		public int Checksum { get; set; }
+
+
+		public string Name { get; private set; }
+
+		#endregion
+
+		#region Constructors
+
+		public MapInfo(string name)
+		{
+			Name = name;
+		}
+
+		#endregion
+
+		#region Overrides
+
+		public override string ToString()
+		{
+			return Name;
+		}
+
+		#endregion
+	} ;
+}
\ No newline at end of file

Added: Lobby/springie/Springie/UnitSync/ModInfo.cs
===================================================================
--- Lobby/springie/Springie/UnitSync/ModInfo.cs	                        (rev 0)
+++ Lobby/springie/Springie/UnitSync/ModInfo.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,66 @@
+#region using
+
+using System;
+using System.Collections.Generic;
+
+#endregion
+
+namespace Springie.SpringNamespace
+{
+	/// &lt;summary&gt;
+	/// Represents one mod. Detailed information are loaded on demand for given mod.
+	/// &lt;/summary&gt;
+	[Serializable]
+	public class ModInfo
+	{
+		#region Properties
+
+		public string ArchiveName { get; set; }
+
+		public int Checksum { get; set; }
+
+		public string Name { get; private set; }
+
+		public List&lt;Option&gt; Options = new List&lt;Option&gt;();
+
+		public string[] Sides { get; set; }
+
+		public UnitInfo[] Units { get; set; }
+
+		#endregion
+
+		#region Constructors
+
+		public ModInfo(string name)
+		{
+			Name = name;
+		}
+
+		#endregion
+
+		#region Public methods
+
+		public bool GetUnitInfo(string name, out UnitInfo res)
+		{
+			for (int i = 0; i &lt; Units.Length; ++i) {
+				if (Units[i].Name == name) {
+					res = Units[i];
+					return true;
+				}
+			}
+			res = new UnitInfo();
+			return false;
+		}
+
+		#endregion
+
+		#region Overrides
+
+		public override string ToString()
+		{
+			return Name;
+		}
+
+		#endregion
+	} ;
+}
\ No newline at end of file

Added: Lobby/springie/Springie/UnitSync/Option.cs
===================================================================
--- Lobby/springie/Springie/UnitSync/Option.cs	                        (rev 0)
+++ Lobby/springie/Springie/UnitSync/Option.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,122 @@
+using System;
+using System.Collections.Generic;
+
+namespace Springie.SpringNamespace
+{
+	[Serializable]
+	public class Option
+	{
+		#region Type enum
+
+		public enum Type
+		{
+			Error = 0,
+			Bool = 1,
+			List = 2,
+			Number = 3,
+			String = 4
+		} ;
+
+		#endregion
+
+		#region Fields
+
+		public float max = float.MinValue;
+		public float min = float.MinValue;
+		public float strMaxLen = 65535;
+		private const string Table = &quot;GAME/MODOPTIONS/&quot;;
+
+		#endregion
+
+		#region Properties
+
+		public string Default;
+		public string Description;
+		public string Key;
+		public List&lt;ListOption&gt; ListOptions = new List&lt;ListOption&gt;();
+
+		public string Name;
+		public Type OptionType;
+
+		#endregion
+
+		#region Constructors
+
+
+		#endregion
+
+		#region Public methods
+
+		public bool GetPair(string Value, out string result)
+		{
+			result = &quot;&quot;;
+			switch (OptionType) {
+				case Type.Bool:
+					if (Value != &quot;0&quot; &amp;&amp; Value != &quot;1&quot;) return false;
+					result = ConstructLine(Value);
+					return true;
+
+				case Type.Number:
+					double d;
+					if (!double.TryParse(Value, out d)) return false;
+					if (d &lt; min || d &gt; max) return false;
+					result = ConstructLine(Value);
+					return true;
+
+				case Type.String:
+					if (strMaxLen != 0 &amp;&amp; Value.Length &gt; strMaxLen) return false;
+					result = ConstructLine(Value);
+					return true;
+
+				case Type.List:
+					foreach (var lop in ListOptions) {
+						if (lop.Key == Value) {
+							result = ConstructLine(lop.Key);
+							return true;
+						}
+					}
+					return false;
+			}
+
+			return false;
+		}
+
+		#endregion
+
+		#region Overrides
+
+		public override string ToString()
+		{
+			string pom = &quot;&quot;;
+			string typs = &quot;&quot;;
+			if (OptionType == Type.Number) {
+				typs = &quot;x&quot;;
+				pom += &quot; = &quot;;
+				if (min != float.MinValue) pom += &quot; &gt;=&quot; + min;
+				if (max != float.MaxValue) pom += &quot; &lt;=&quot; + max;
+			}
+			if (OptionType == Type.List) {
+				pom += &quot; = &quot;;
+				foreach (var lop in ListOptions) {
+					pom += lop.Key + &quot;-&quot; + lop.Description + &quot; | &quot;;
+					typs += lop.Key + &quot;|&quot;;
+				}
+			}
+			if (OptionType == Type.Bool) typs += &quot;0|1&quot;;
+			if (OptionType == Type.String) typs += &quot;s&quot;;
+
+			return string.Format(&quot;{0}={1}  ({2}{3})&quot;, Key, typs, Description, pom);
+		}
+
+		#endregion
+
+		#region Other methods
+
+		private string ConstructLine(string val)
+		{
+			return Table + Key + &quot;=&quot; + val;
+		}
+
+		#endregion
+	}
+}
\ No newline at end of file

Added: Lobby/springie/Springie/UnitSync/UnitConverter.cs
===================================================================
--- Lobby/springie/Springie/UnitSync/UnitConverter.cs	                        (rev 0)
+++ Lobby/springie/Springie/UnitSync/UnitConverter.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,54 @@
+using System;
+using System.ComponentModel;
+using System.Globalization;
+
+namespace Springie.SpringNamespace
+{
+	internal class UnitConverter : StringConverter
+	{
+		#region Overrides
+
+		public override object ConvertFrom(ITypeDescriptorContext context, CultureInfo culture, object value)
+		{
+			string tofind = value.ToString().Split(' ')[0];
+			foreach (var u in GetMod().Units) if (u.Name == tofind) return u;
+			return null;
+		}
+
+		public override object ConvertTo(ITypeDescriptorContext context, CultureInfo culture, object value, Type destinationType)
+		{
+			if (destinationType == typeof (String)) {
+				if (value == null) return null;
+				var u = (UnitInfo) value;
+				if (u.Name != null) return u.Name + &quot; (&quot; + u.FullName + &quot;)&quot;;
+				else return null;
+			} else return base.ConvertTo(context, culture, value, destinationType);
+		}
+
+
+		public override StandardValuesCollection GetStandardValues(ITypeDescriptorContext context)
+		{
+			return new StandardValuesCollection(GetMod().Units);
+		}
+
+		public override bool GetStandardValuesSupported(ITypeDescriptorContext context)
+		{
+			return true;
+		}
+
+		#endregion
+
+		#region Other methods
+
+		private ModInfo GetMod()
+		{
+			if (Program.main.Tas != null) {
+				var b = Program.main.Tas.GetBattle();
+				if (b != null) return b.Mod;
+			}
+			return Program.main.Spring.UnitSyncWrapper.GetModInfo(Program.main.AutoHost.config.DefaultMod);
+		}
+
+		#endregion
+	}
+}
\ No newline at end of file

Added: Lobby/springie/Springie/UnitSync/UnitInfo.cs
===================================================================
--- Lobby/springie/Springie/UnitSync/UnitInfo.cs	                        (rev 0)
+++ Lobby/springie/Springie/UnitSync/UnitInfo.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,49 @@
+using System;
+using System.Collections.Generic;
+using System.ComponentModel;
+
+namespace Springie.SpringNamespace
+{
+	[TypeConverter(typeof (UnitConverter))]
+	[Serializable]
+	public struct UnitInfo
+	{
+		#region Properties
+
+		public string FullName;
+		public string Name;
+
+		#endregion
+
+		#region Constructors
+
+		public UnitInfo(string name, string fullName)
+		{
+			Name = name;
+			FullName = fullName;
+		}
+
+		#endregion
+
+		#region Public methods
+
+		public static UnitInfo[] FromStringList(string[] src, ModInfo mod)
+		{
+			var result = new List&lt;UnitInfo&gt;();
+			for (int i = 0; i &lt; src.Length; ++i) {
+				UnitInfo u;
+				if (mod.GetUnitInfo(src[i], out u)) result.Add(u);
+			}
+			return result.ToArray();
+		}
+
+		public static string[] ToStringList(UnitInfo[] src)
+		{
+			var result = new string[src.Length];
+			for (int i = 0; i &lt; src.Length; ++i) result[i] = src[i].Name;
+			return result;
+		}
+
+		#endregion
+	}
+}
\ No newline at end of file

Copied: Lobby/springie/Springie/UnitSync/UnitSyncWrapper.cs (from rev 6717, Lobby/springie/Springie/spring/UnitSync.cs)
===================================================================
--- Lobby/springie/Springie/UnitSync/UnitSyncWrapper.cs	                        (rev 0)
+++ Lobby/springie/Springie/UnitSync/UnitSyncWrapper.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -0,0 +1,92 @@
+#region using
+
+#region using
+
+using System;
+using System.Collections.Generic;
+using System.IO;
+using System.Runtime.Serialization.Formatters.Binary;
+
+#endregion
+
+namespace Springie.SpringNamespace
+{
+	public class UnitSyncWrapper
+	{
+		#region Fields
+
+		private Dictionary&lt;string, MapInfo&gt; mapList = new Dictionary&lt;string, MapInfo&gt;();
+		private Dictionary&lt;string, ModInfo&gt; modList = new Dictionary&lt;string, ModInfo&gt;();
+
+		#endregion
+
+		#region Properties
+
+		public Dictionary&lt;string, MapInfo&gt; MapList
+		{
+			get { return mapList; }
+		}
+
+		public Dictionary&lt;string, ModInfo&gt; ModList
+		{
+			get { return modList; }
+		}
+
+		#endregion
+
+		#region Constructors
+
+		public UnitSyncWrapper() : this(Directory.GetCurrentDirectory()) {}
+
+		public UnitSyncWrapper(string path)
+		{
+			var bf = new BinaryFormatter();
+			try {
+				using (var fs = new FileStream(Path.Combine(path, &quot;mapinfo.dat&quot;), FileMode.Open)) mapList = (Dictionary&lt;string, MapInfo&gt;) bf.Deserialize(fs);
+			} catch (Exception ex) {
+				ErrorHandling.HandleException(ex, &quot;While loading mapinfo.dat&quot;);
+			}
+			try {
+				using (var fs = new FileStream(Path.Combine(path, &quot;modinfo.dat&quot;), FileMode.Open)) modList = (Dictionary&lt;string, ModInfo&gt;) bf.Deserialize(fs);
+			} catch (Exception ex) {
+				ErrorHandling.HandleException(ex, &quot;While loading modinfo.dat&quot;);
+			}
+		}
+
+		#endregion
+
+		#region Public methods
+
+		public MapInfo GetMapInfo(string name)
+		{
+			return mapList[name];
+		}
+
+		public ModInfo GetModInfo(string name)
+		{
+			if (modList.ContainsKey(name)) return modList[name];
+			else {
+				foreach (var p in modList) if (p.Value.ArchiveName == name) return p.Value;
+				return null;
+			}
+		}
+
+		public bool HasMap(string name)
+		{
+			return mapList.ContainsKey(name);
+		}
+
+
+		public bool HasMod(string modName)
+		{
+			if (!modList.ContainsKey(modName)) {
+				foreach (var p in modList) if (p.Value.ArchiveName == modName) return true;
+				return false;
+			} else return true;
+		}
+
+		#endregion
+	}
+}
+
+#endregion
\ No newline at end of file


Property changes on: Lobby/springie/Springie/UnitSync/UnitSyncWrapper.cs
___________________________________________________________________
Name: svn:mergeinfo
   + 

Modified: Lobby/springie/Springie/autohost/AutoHost.cs
===================================================================
--- Lobby/springie/Springie/autohost/AutoHost.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/autohost/AutoHost.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -316,19 +316,19 @@
 			if (String.IsNullOrEmpty(modname)) modname = config.DefaultMod;
 			if (String.IsNullOrEmpty(mapname)) mapname = config.DefaultMap;
 
-			if (!spring.UnitSync.HasMap(mapname)) {
-				IEnumerator&lt;MapInfo&gt; enu = spring.UnitSync.MapList.Values.GetEnumerator();
+			if (!spring.UnitSyncWrapper.HasMap(mapname)) {
+				IEnumerator&lt;MapInfo&gt; enu = spring.UnitSyncWrapper.MapList.Values.GetEnumerator();
 				enu.MoveNext();
 				mapname = enu.Current.Name;
 			}
-			if (!spring.UnitSync.HasMod(modname)) {
-				IEnumerator&lt;ModInfo&gt; enu = spring.UnitSync.ModList.Values.GetEnumerator();
+			if (!spring.UnitSyncWrapper.HasMod(modname)) {
+				IEnumerator&lt;ModInfo&gt; enu = spring.UnitSyncWrapper.ModList.Values.GetEnumerator();
 				enu.MoveNext();
 				modname = enu.Current.Name;
 			}
 
 			int mint, maxt;
-			var b = new Battle((ladder == null ? config.Password : &quot;ladderlock2&quot;), config.HostingPort, config.MaxPlayers, config.MinRank, spring.UnitSync.GetMapInfo(mapname), (ladder != null ? &quot;(ladder &quot; + ladder.Id + &quot;) &quot; : &quot;&quot;) + config.GameTitle.Replace(&quot;%1&quot;, MainConfig.SpringieVersion), spring.UnitSync.GetModInfo(modname), (ladder != null ? ladder.CheckBattleDetails(config.BattleDetails, out mint, out maxt) : config.BattleDetails));
+			var b = new Battle((ladder == null ? config.Password : &quot;ladderlock2&quot;), config.HostingPort, config.MaxPlayers, config.MinRank, spring.UnitSyncWrapper.GetMapInfo(mapname), (ladder != null ? &quot;(ladder &quot; + ladder.Id + &quot;) &quot; : &quot;&quot;) + config.GameTitle.Replace(&quot;%1&quot;, MainConfig.SpringieVersion), spring.UnitSyncWrapper.GetModInfo(modname), (ladder != null ? ladder.CheckBattleDetails(config.BattleDetails, out mint, out maxt) : config.BattleDetails));
 			// if hole punching enabled then we use it
 			if (config.UseHolePunching) b.Nat = Battle.NatMode.HolePunching;
 			else if (Program.main.config.GargamelMode &amp;&amp; Program.main.Stats != null) b.Nat = Battle.NatMode.FixedPorts;
@@ -453,7 +453,6 @@
 			if (e.Status == FileDownloader.Status.Failed) mes = e.DownloadItem.fileName + &quot; download failed: &quot; + e.Message;
 			else {
 				mes = e.DownloadItem.fileName + &quot; download finished!&quot;;
-				spring.Reload(true, true);
 			}
 			if (tas.IsConnected) SayBattle(mes);
 			if (e.DownloadItem.fileType == FileDownloader.FileType.Mod &amp;&amp; !spring.IsRunning) Start(e.DownloadItem.fileName, null);
@@ -493,7 +492,7 @@
 		private void tas_BattleFound(object sender, TasEventArgs e)
 		{
 			string map = Utils.Glue(e.ServerParams.ToArray(), 10).Split('\t')[0];
-			if (config.AutoDownloadNewMaps &amp;&amp; !spring.IsRunning &amp;&amp; !spring.UnitSync.MapList.ContainsKey(map)) fileDownloader.DownloadMap(map);
+			if (config.AutoDownloadNewMaps &amp;&amp; !spring.IsRunning &amp;&amp; !spring.UnitSyncWrapper.MapList.ContainsKey(map)) fileDownloader.DownloadMap(map);
 		}
 
 		private void tas_BattleLockChanged(object sender, TasEventArgs e)
@@ -503,10 +502,8 @@
 
 		private void tas_BattleMapChanged(object sender, TasEventArgs e)
 		{
-			if (config.DisplayMapLink) SayBattle(&quot;maplink: &quot; + linker.GetMapBounceLink(tas.GetBattle().Map.Name));
-
 			var b = tas.GetBattle();
-			string mapName = b.Map.ArchiveName.ToLower();
+			string mapName = b.Map.Name.ToLower();
 			if (MapBoxes.ContainsKey(mapName)) {
 				for (int i = 0; i &lt; b.Rectangles.Count; ++i) tas.RemoveBattleRectangle(i);
 				var dict = MapBoxes[mapName];
@@ -562,7 +559,6 @@
 				SayBattle(string.Format(&quot;GAME IS CURRENTLY IN PROGRESS, PLEASE WAIT TILL IT ENDS! Running for {0}&quot;, started), false);
 				SayBattle(&quot;If you say !notify, I will PM you when game ends.&quot;, false);
 			}
-			if (config.DisplayMapLink) SayBattle(&quot;maplink: &quot; + linker.GetMapBounceLink(tas.GetBattle().Map.Name), false);
 
 			HandleKickSpecServerLocking();
 			HandleAutoLocking();
@@ -808,11 +804,6 @@
 						ComDlMod(e, words);
 						break;
 
-					case &quot;reload&quot;:
-						Respond(e, &quot;reloading mod and map list&quot;);
-						spring.Reload(true, true);
-						Respond(e, &quot;reload finished&quot;);
-						break;
 
 					case &quot;id&quot;:
 						ComTeam(e, words);

Modified: Lobby/springie/Springie/autohost/AutoHostConfig.cs
===================================================================
--- Lobby/springie/Springie/autohost/AutoHostConfig.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/autohost/AutoHostConfig.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -103,13 +103,6 @@
 			set { disabledUnits = value; }
 		}
 
-		[Category(&quot;Texts&quot;)]
-		[Description(&quot;Should Springie advertise a maplink to new joiners and after map change?&quot;)]
-		public bool DisplayMapLink
-		{
-			get { return displayMapLink; }
-			set { displayMapLink = value; }
-		}
 
 		[Category(&quot;Texts&quot;)]
 		[Description(&quot;Game title - appears in open game list, %1 = springie version&quot;)]
@@ -285,8 +278,6 @@
 
 			AddMissing(new CommandConfig(&quot;dlmod&quot;, 1, &quot;[&lt;modname/dllid/url&gt;..] - downloads mod to server. You must specify mod file id (from unknown files) or mod URL&quot;, 10), addedCommands);
 
-			AddMissing(new CommandConfig(&quot;reload&quot;, 2, &quot; - reloads mod and map list (can take long time)&quot;, 30), addedCommands);
-
 			AddMissing(new CommandConfig(&quot;id&quot;, 2, &quot;&lt;idnumber&gt; [&lt;playername&gt;..] - forces given player to an id&quot;), addedCommands);
 
 			AddMissing(new CommandConfig(&quot;team&quot;, 2, &quot;&lt;teamnumber&gt; [&lt;playername&gt;..] - forces given player to a team&quot;), addedCommands);
@@ -423,7 +414,7 @@
 			public override StandardValuesCollection GetStandardValues(ITypeDescriptorContext context)
 			{
 				var maps = new List&lt;string&gt;();
-				foreach (var p in Program.main.Spring.UnitSync.MapList) maps.Add(p.Value.Name);
+				foreach (var p in Program.main.Spring.UnitSyncWrapper.MapList) maps.Add(p.Value.Name);
 				return new StandardValuesCollection(maps);
 			}
 
@@ -446,7 +437,7 @@
 			public override StandardValuesCollection GetStandardValues(ITypeDescriptorContext context)
 			{
 				var mods = new List&lt;string&gt;();
-				foreach (var p in Program.main.Spring.UnitSync.ModList) mods.Add(p.Value.Name);
+				foreach (var p in Program.main.Spring.UnitSyncWrapper.ModList) mods.Add(p.Value.Name);
 				return new StandardValuesCollection(mods);
 			}
 

Modified: Lobby/springie/Springie/autohost/AutoHost_commands.cs
===================================================================
--- Lobby/springie/Springie/autohost/AutoHost_commands.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/autohost/AutoHost_commands.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -776,7 +776,7 @@
 
 				var b = tas.GetBattle();
 				if (b != null) {
-					string curMap = b.Map.ArchiveName.ToLower();
+					string curMap = b.Map.Name.ToLower();
 
 					var nd = new Dictionary&lt;int, BattleRect&gt;();
 					foreach (var v in b.Rectangles) nd.Add(v.Key, v.Value);
@@ -868,9 +868,9 @@
 
 		internal static int FilterMods(string[] words, TasClient tas, Spring spring, out string[] vals, out int[] indexes)
 		{
-			var temp = new string[spring.UnitSync.ModList.Keys.Count];
+			var temp = new string[spring.UnitSyncWrapper.ModList.Keys.Count];
 			int cnt = 0;
-			foreach (var s in spring.UnitSync.ModList.Keys) {
+			foreach (var s in spring.UnitSyncWrapper.ModList.Keys) {
 				var limit = Program.main.AutoHost.config.LimitMods;
 				if (limit != null &amp;&amp; limit.Length &gt; 0) {
 					bool allowed = false;
@@ -1116,7 +1116,7 @@
 			int[] indexes;
 			if (FilterMaps(words, out vals, out indexes) &gt; 0) {
 				SayBattle(&quot;changing map to &quot; + vals[0]);
-				tas.ChangeMap(spring.UnitSync.MapList[vals[0]]);
+				tas.ChangeMap(spring.UnitSyncWrapper.MapList[vals[0]]);
 			} else Respond(e, &quot;Cannot find such map.&quot;);
 		}
 
@@ -1148,7 +1148,7 @@
 					if (info.FactionName == fact.Name) {
 						SayBattle(string.Format(&quot;changing planet to {0} by {1}&quot;, vals[0], e.UserName));
 						var planet = pw.GetAttackOptions().Find((m) =&gt; m.Name == vals[0]);
-						tas.ChangeMap(spring.UnitSync.MapList[planet.MapName]);
+						tas.ChangeMap(spring.UnitSyncWrapper.MapList[planet.MapName]);
 					} else Respond(e, string.Format(&quot;It's currently {0} turn&quot;, fact.Name));
 				} else Respond(e, &quot;You are not a commander-in-chief&quot;);
 			} else Respond(e, &quot;Cannot find such planet.&quot;);
@@ -1260,9 +1260,9 @@
 
 		private static int FilterMaps(string[] words, TasClient tas, Spring spring, Ladder ladder, out string[] vals, out int[] indexes)
 		{
-			var temp = new string[spring.UnitSync.MapList.Keys.Count];
+			var temp = new string[spring.UnitSyncWrapper.MapList.Keys.Count];
 			int cnt = 0;
-			foreach (var s in spring.UnitSync.MapList.Keys) {
+			foreach (var s in spring.UnitSyncWrapper.MapList.Keys) {
 				if (ladder != null) {
 					if (ladder.Maps.Contains(s.ToLower())) temp[cnt++] = s;
 				} else {

Modified: Lobby/springie/Springie/autohost/Polls.cs
===================================================================
--- Lobby/springie/Springie/autohost/Polls.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/autohost/Polls.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -192,7 +192,7 @@
 			if (CheckEnd(out winVote)) {
 				if (winVote == 1) {
 					ah.SayBattle(&quot;vote successful - changing map to &quot; + map);
-					tas.ChangeMap(spring.UnitSync.MapList[map]);
+					tas.ChangeMap(spring.UnitSyncWrapper.MapList[map]);
 				} else ah.SayBattle(&quot;not enough votes, map stays&quot;);
 				return true;
 			} else return false;
@@ -776,7 +776,7 @@
 				if (winVote == 1) {
 					ah.SayBattle(&quot;vote successful - changing planet to &quot; + planet);
 					var sel = pw.GetAttackOptions().Find((p) =&gt; p.Name == planet);
-					tas.ChangeMap(spring.UnitSync.MapList[sel.MapName]);
+					tas.ChangeMap(spring.UnitSyncWrapper.MapList[sel.MapName]);
 				} else ah.SayBattle(&quot;not enough votes, planet stays&quot;);
 				return true;
 			} else return false;

Modified: Lobby/springie/Springie/client/TasClient.cs
===================================================================
--- Lobby/springie/Springie/client/TasClient.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/client/TasClient.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -736,7 +736,7 @@
 								if (mapToChangeTo != null &amp;&amp; mapToChangeTo.Name == mapname) {
 									// if we changed to known requested map, use it
 									battle.Map = mapToChangeTo;
-								} else battle.Map = Program.main.Spring.UnitSync.MapList[mapname]; //otherwise find this map using unitsync
+								} else battle.Map = Program.main.Spring.UnitSyncWrapper.MapList[mapname]; //otherwise find this map using unitsync
 								if (BattleMapChanged != null) BattleMapChanged(this, new TasEventArgs(mapname));
 							}
 

Modified: Lobby/springie/Springie/doc/readme.txt
===================================================================
--- Lobby/springie/Springie/doc/readme.txt	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/doc/readme.txt	2008-10-16 02:01:54 UTC (rev 6754)
@@ -133,8 +133,6 @@
 
 !listbans - lists currently banned users
 
-!reload - reloads mod and map list
-
 !kickspec [0|1] - enables or disables automatic spectator kicking
 
 !mincpuspeed &lt;GHz&gt; - sets minimum CPU for this host - players with CPU speed below this value are auto-kicked, 0 = no limit

Modified: Lobby/springie/Springie/spring/Spring.cs
===================================================================
--- Lobby/springie/Springie/spring/Spring.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/spring/Spring.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -77,7 +77,7 @@
 		private Talker talker;
 
 
-		private UnitSync unitSync;
+		private UnitSyncWrapper unitSyncWrapper;
 
 		#endregion
 
@@ -108,9 +108,9 @@
 			set { if (IsRunning) process.PriorityClass = value; }
 		}
 
-		public UnitSync UnitSync
+		public UnitSyncWrapper UnitSyncWrapper
 		{
-			get { return unitSync; }
+			get { return unitSyncWrapper; }
 		}
 
 		#endregion
@@ -140,7 +140,7 @@
 			if (!File.Exists(path + ExecutableName)) throw new Exception(ExecutableName + &quot; not found in &quot; + path);
 
 			// init unitsync and load basic info
-			unitSync = new UnitSync(path);
+			unitSyncWrapper = new UnitSyncWrapper();
 		}
 
 		public void Dispose() {}
@@ -167,25 +167,12 @@
 			if (IsRunning) talker.SendText(&quot;/forcestart&quot;);
 		}
 
-		public string GetMapArchiveName(string mapname)
-		{
-			return unitSync.GetMapArchiveName(mapname);
-		}
 
 		public void Kick(string name)
 		{
 			SayGame(&quot;/kick &quot; + name);
 		}
 
-		/// &lt;summary&gt;
-		/// Reloads map and or mod list
-		/// &lt;/summary&gt;
-		/// &lt;param name=&quot;reloadMods&quot;&gt;should reload mods&lt;/param&gt;
-		/// &lt;param name=&quot;reloadMaps&quot;&gt;should reload maps&lt;/param&gt;
-		public void Reload(bool reloadMods, bool reloadMaps)
-		{
-			unitSync.Reload(reloadMods, reloadMaps);
-		}
 
 		public void SayGame(string text)
 		{

Deleted: Lobby/springie/Springie/spring/UnitSync.cs
===================================================================
--- Lobby/springie/Springie/spring/UnitSync.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/spring/UnitSync.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -1,835 +0,0 @@
-#region using
-
-using System;
-using System.Collections.Generic;
-using System.ComponentModel;
-using System.Globalization;
-using System.IO;
-using System.Runtime.InteropServices;
-using System.Threading;
-
-#endregion
-
-namespace Springie.SpringNamespace
-{
-	internal class UnitConverter : StringConverter
-	{
-		#region Overrides
-
-		public override object ConvertFrom(ITypeDescriptorContext context, CultureInfo culture, object value)
-		{
-			string tofind = value.ToString().Split(' ')[0];
-			foreach (var u in GetMod().Units) if (u.Name == tofind) return u;
-			return null;
-		}
-
-		public override object ConvertTo(ITypeDescriptorContext context, CultureInfo culture, object value, Type destinationType)
-		{
-			if (destinationType == typeof (String)) {
-				if (value == null) return null;
-				var u = (UnitInfo) value;
-				if (u.Name != null) return u.Name + &quot; (&quot; + u.FullName + &quot;)&quot;;
-				else return null;
-			} else return base.ConvertTo(context, culture, value, destinationType);
-		}
-
-
-		public override StandardValuesCollection GetStandardValues(ITypeDescriptorContext context)
-		{
-			return new StandardValuesCollection(GetMod().Units);
-		}
-
-		public override bool GetStandardValuesSupported(ITypeDescriptorContext context)
-		{
-			return true;
-		}
-
-		#endregion
-
-		#region Other methods
-
-		private ModInfo GetMod()
-		{
-			if (Program.main.Tas != null) {
-				var b = Program.main.Tas.GetBattle();
-				if (b != null) return b.Mod;
-			}
-			return Program.main.Spring.UnitSync.GetModInfo(Program.main.AutoHost.config.DefaultMod);
-		}
-
-		#endregion
-	}
-
-
-	[TypeConverter(typeof (UnitConverter))]
-	public struct UnitInfo
-	{
-		#region Properties
-
-		public string FullName;
-		public string Name;
-
-		#endregion
-
-		#region Constructors
-
-		public UnitInfo(string name, string fullName)
-		{
-			Name = name;
-			FullName = fullName;
-		}
-
-		#endregion
-
-		#region Public methods
-
-		public static UnitInfo[] FromStringList(string[] src, ModInfo mod)
-		{
-			var result = new List&lt;UnitInfo&gt;();
-			for (int i = 0; i &lt; src.Length; ++i) {
-				UnitInfo u;
-				if (mod.GetUnitInfo(src[i], out u)) result.Add(u);
-			}
-			return result.ToArray();
-		}
-
-		public static string[] ToStringList(UnitInfo[] src)
-		{
-			var result = new string[src.Length];
-			for (int i = 0; i &lt; src.Length; ++i) result[i] = src[i].Name;
-			return result;
-		}
-
-		#endregion
-	}
-
-
-	/// &lt;summary&gt;
-	/// Represents one mod. Detailed information are loaded on demand for given mod.
-	/// &lt;/summary&gt;
-	public class ModInfo
-	{
-		#region Fields
-
-		protected string archiveName;
-		private int checksum;
-		private bool loaded;
-		private int modId = -1;
-		private object myLock = new object();
-		private string name;
-		private string[] sides;
-		private UnitInfo[] units;
-		private UnitSync unitSync;
-
-		#endregion
-
-		#region Properties
-
-		public string ArchiveName
-		{
-			get
-			{
-				CheckLoaded();
-				return archiveName;
-			}
-			set { archiveName = value; }
-		}
-
-		public int Checksum
-		{
-			get
-			{
-				CheckLoaded();
-				return checksum;
-			}
-			set { checksum = value; }
-		}
-
-		public int ModId
-		{
-			get { return modId; }
-		}
-
-		public string Name
-		{
-			get { return name; }
-		}
-
-		public List&lt;UnitSync.Option&gt; Options = new List&lt;UnitSync.Option&gt;();
-
-		public string[] Sides
-		{
-			get
-			{
-				CheckLoaded();
-				return sides;
-			}
-			set { sides = value; }
-		}
-
-		public UnitInfo[] Units
-		{
-			get
-			{
-				CheckLoaded();
-				return units;
-			}
-			set { units = value; }
-		}
-
-		#endregion
-
-		#region Constructors
-
-		public ModInfo(UnitSync owner, string name, int modId)
-		{
-			unitSync = owner;
-			this.name = name;
-			this.modId = modId;
-		}
-
-		#endregion
-
-		#region Public methods
-
-		public bool GetUnitInfo(string name, out UnitInfo res)
-		{
-			for (int i = 0; i &lt; Units.Length; ++i) {
-				if (Units[i].Name == name) {
-					res = Units[i];
-					return true;
-				}
-			}
-			res = new UnitInfo();
-			return false;
-		}
-
-		#endregion
-
-		#region Overrides
-
-		public override string ToString()
-		{
-			return name;
-		}
-
-		#endregion
-
-		#region Other methods
-
-		private void CheckLoaded()
-		{
-			if (!loaded &amp;&amp; unitSync != null) {
-				lock (myLock) {
-					loaded = true;
-					unitSync.LoadModInfo(this);
-				}
-			}
-		}
-
-		#endregion
-	} ;
-
-
-	public class MapInfo
-	{
-		#region Fields
-
-		protected string archiveName;
-
-		private int checksum;
-		private bool loaded;
-		private int mapId = -1;
-		private object myLock = new object();
-		private string name;
-		private UnitSync unitSync;
-
-		#endregion
-
-		#region Properties
-
-		public string ArchiveName
-		{
-			get
-			{
-				CheckLoaded();
-				return archiveName;
-			}
-			set { archiveName = value; }
-		}
-
-		public int Checksum
-		{
-			get
-			{
-				CheckLoaded();
-				return checksum;
-			}
-			set { checksum = value; }
-		}
-
-		public int MapId
-		{
-			get { return mapId; }
-		}
-
-		public string Name
-		{
-			get { return name; }
-		}
-
-		#endregion
-
-		#region Constructors
-
-		public MapInfo(UnitSync owner, string name, int mapId)
-		{
-			unitSync = owner;
-			this.name = name;
-			this.mapId = mapId;
-		}
-
-		#endregion
-
-		#region Overrides
-
-		public override string ToString()
-		{
-			return name;
-		}
-
-		#endregion
-
-		#region Other methods
-
-		private void CheckLoaded()
-		{
-			if (!loaded &amp;&amp; unitSync != null) {
-				lock (myLock) {
-					loaded = true;
-					unitSync.LoadMapInfo(this);
-				}
-			}
-		}
-
-		#endregion
-	} ;
-
-
-	public class UnitSync : IDisposable
-	{
-		#region Fields
-
-		private Dictionary&lt;string, MapInfo&gt; mapList = new Dictionary&lt;string, MapInfo&gt;();
-		private Dictionary&lt;string, ModInfo&gt; modList = new Dictionary&lt;string, ModInfo&gt;();
-		private string path;
-
-		#endregion
-
-		#region Properties
-
-		public Dictionary&lt;string, MapInfo&gt; MapList
-		{
-			get { return mapList; }
-		}
-
-		public Dictionary&lt;string, ModInfo&gt; ModList
-		{
-			get { return modList; }
-		}
-
-		#endregion
-
-		#region Constructors
-
-		public UnitSync() : this(Directory.GetCurrentDirectory()) {}
-
-		public UnitSync(string path)
-		{
-			this.path = path;
-			string opath = Directory.GetCurrentDirectory();
-			Directory.SetCurrentDirectory(path);
-			if (Init(false, 0) != 1) throw new Exception(&quot;unitsync.dll init failed&quot;);
-			//if (InitArchiveScanner() != 1) throw new Exception(&quot;unitsync.dll:InitArchiveScanner() failed&quot;);
-			LoadModList();
-			LoadMapList();
-			Directory.SetCurrentDirectory(opath);
-		}
-
-		public void Dispose()
-		{
-			UnInit();
-		}
-
-		#endregion
-
-		#region Public methods
-
-		public string GetMapArchiveName(string mapname)
-		{
-			if (mapList.ContainsKey(mapname)) return mapList[mapname].ArchiveName;
-			else return &quot;&quot;;
-		}
-
-		public MapInfo GetMapInfo(string name)
-		{
-			return mapList[name];
-		}
-
-		public ModInfo GetModInfo(string name)
-		{
-			if (modList.ContainsKey(name)) return modList[name];
-			else {
-				foreach (var p in modList) if (p.Value.ArchiveName == name) return p.Value;
-				return null;
-			}
-		}
-
-		public bool HasMap(string name)
-		{
-			return mapList.ContainsKey(name);
-		}
-
-
-		public bool HasMod(string modName)
-		{
-			if (!modList.ContainsKey(modName)) {
-				foreach (var p in modList) if (p.Value.ArchiveName == modName) return true;
-				return false;
-			} else return true;
-		}
-
-		/// &lt;summary&gt;
-		/// Loads new map information
-		/// &lt;/summary&gt;
-		/// &lt;param name=&quot;mi&quot;&gt;&lt;/param&gt;
-		internal void LoadMapInfo(MapInfo mi)
-		{
-			string opath = Directory.GetCurrentDirectory();
-			Directory.SetCurrentDirectory(path);
-			ReInit(true);
-
-			mi.Checksum = (int)GetMapChecksum(mi.MapId);
-
-			Directory.SetCurrentDirectory(opath);
-		}
-
-		internal void LoadModInfo(ModInfo mi)
-		{
-			Thread.CurrentThread.CurrentCulture = CultureInfo.InvariantCulture;
-			string opath = Directory.GetCurrentDirectory();
-			Directory.SetCurrentDirectory(path);
-			ReInit(true);
-
-			//GetPrimaryModCount();
-			if (mi.Name != GetPrimaryModName(mi.ModId)) throw new Exception(&quot;Mod &quot; + mi.Name + &quot; modified without reload&quot;);
-
-			//uint result = 0;
-			mi.ArchiveName = GetPrimaryModArchive(mi.ModId);
-
-			mi.Checksum = (int)GetPrimaryModChecksum(mi.ModId);
-
-			AddAllArchives(mi.ArchiveName);
-			mi.Sides = new String[GetSideCount()];
-			for (int x = 0; x &lt; mi.Sides.Length; ++x) mi.Sides[x] = GetSideName(x);
-
-			// weirdest stuff of all...
-			while (ProcessUnitsNoChecksum() != 0) {}
-			;
-			mi.Units = new UnitInfo[GetUnitCount()];
-			for (int x = 0; x &lt; mi.Units.Length; ++x) mi.Units[x] = new UnitInfo(GetUnitName(x), GetFullUnitName(x));
-
-			int opts = GetModOptionCount();
-			for (int x = 0; x &lt; opts; x++) {
-				var o = new Option(x);
-				mi.Options.Add(o);
-			}
-
-			Directory.SetCurrentDirectory(opath);
-		}
-
-		internal void Reload(bool reloadMods, bool reloadMaps)
-		{
-			if (reloadMods || reloadMaps) ReInit(true);
-			if (reloadMaps) LoadMapList();
-			if (reloadMods) LoadModList();
-		}
-
-		#endregion
-
-		#region Other methods
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern void AddAllArchives(string root);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern uint GetArchiveChecksum(string archive);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetFullUnitName(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetMapArchiveCount(string mapName);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetMapArchiveName(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetMapCount();
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetMapName(int index);
-
-		/************************************************************************/
-		/*     OPTIONS                                                          */
-		/************************************************************************/
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetMapOptionCount(string mapName);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetModOptionCount();
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetOptionBoolDef(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetOptionDesc(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetOptionKey(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetOptionListCount(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetOptionListDef(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetOptionListItemDesc(int index, int itemIndex);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetOptionListItemKey(int index, int itemIndex);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetOptionListItemName(int index, int itemIndex);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetOptionName(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern float GetOptionNumberDef(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern float GetOptionNumberMax(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern float GetOptionNumberMin(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern float GetOptionNumberStep(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetOptionStringDef(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetOptionStringMaxLen(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetOptionType(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetPrimaryModArchive(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetPrimaryModArchiveCount(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetPrimaryModArchiveList(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern uint GetMapChecksumFromName(string mapName);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern uint GetMapChecksum(int mapIndex);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern uint GetPrimaryModChecksum(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetPrimaryModCount();
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetPrimaryModName(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetSideCount();
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetSideName(int index);
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int GetUnitCount();
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern string GetUnitName(int index);
-
-		/*
-    //     INIT
-    */
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int Init(bool isServer, int id);
-
-		/// &lt;summary&gt;
-		/// Gets map list from unit sync, does not make full reinit by default
-		/// &lt;/summary&gt;
-		/// &lt;returns&gt;&lt;/returns&gt;
-		private void LoadMapList()
-		{
-			string opath = Directory.GetCurrentDirectory();
-			Directory.SetCurrentDirectory(path);
-
-			int mapCount = GetMapCount();
-			mapList.Clear();
-			for (int i = 0; i &lt; mapCount; ++i) {
-				var mi = new MapInfo(this, GetMapName(i), i);
-				mapList[mi.Name] = mi;
-				mi.ArchiveName = RequestMapArchive(mi.Name);
-			}
-			Directory.SetCurrentDirectory(opath);
-		}
-
-
-		/// &lt;summary&gt;
-		/// Gets mod list - does not make full reinit by default
-		/// &lt;/summary&gt;
-		/// &lt;returns&gt;&lt;/returns&gt;
-		private void LoadModList()
-		{
-			string opath = Directory.GetCurrentDirectory();
-			Directory.SetCurrentDirectory(path);
-
-			int modCount = GetPrimaryModCount();
-
-			modList.Clear();
-			for (int i = 0; i &lt; modCount; ++i) {
-				var mi = new ModInfo(this, GetPrimaryModName(i), i);
-				modList[mi.Name] = mi;
-			}
-		}
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern int ProcessUnitsNoChecksum();
-
-		/// &lt;summary&gt;
-		/// ReInits unitsync
-		/// &lt;/summary&gt;
-		/// &lt;param name=&quot;full&quot;&gt;if true does complete reinit (neccesary to find new map or mod), if false does just archivescannerinit&lt;/param&gt;
-		private void ReInit(bool full)
-		{
-			string opath = Directory.GetCurrentDirectory();
-			Directory.SetCurrentDirectory(path);
-
-			if (full) {
-				UnInit();
-				if (Init(false, 0) != 1) throw new Exception(&quot;unitsync.dll init failed&quot;);
-			}
-			//if (InitArchiveScanner() != 1) throw new Exception(&quot;unitsync.dll:InitArchiveScanner() failed&quot;);
-
-			Directory.SetCurrentDirectory(opath);
-		}
-
-		private string RequestMapArchive(string mapname)
-		{
-			int i = GetMapArchiveCount(mapname);
-			if (i &gt; 0) {
-				string arch = GetMapArchiveName(0);
-				int lastslash = arch.LastIndexOfAny(new[] {'/', '\\'});
-				return arch.Substring(lastslash + 1);
-			} else return &quot;&quot;;
-		}
-
-
-		[DllImport(&quot;unitsync.dll&quot;)]
-		private static extern void UnInit();
-
-		#endregion
-
-		#region Nested type: ListOption
-
-		public struct ListOption
-		{
-			#region Properties
-
-			public string Description;
-			public string Key;
-			public string Name;
-
-			#endregion
-
-			#region Constructors
-
-			public ListOption(int optionIndex, int itemIndex)
-			{
-				Name = GetOptionListItemName(optionIndex, itemIndex);
-				Description = GetOptionListItemDesc(optionIndex, itemIndex);
-				Key = GetOptionListItemKey(optionIndex, itemIndex);
-			}
-
-			#endregion
-		}
-
-		#endregion
-
-		#region Nested type: Option
-
-		public class Option
-		{
-			#region Type enum
-
-			public enum Type
-			{
-				Error = 0,
-				Bool = 1,
-				List = 2,
-				Number = 3,
-				String = 4
-			} ;
-
-			#endregion
-
-			#region Fields
-
-			private float max = float.MinValue;
-			private float min = float.MinValue;
-			private float step, strMaxLen = 65535;
-			private string Table = &quot;GAME/MODOPTIONS/&quot;;
-
-			#endregion
-
-			#region Properties
-
-			public string Default;
-			public string Description;
-			public string Key;
-			public List&lt;ListOption&gt; ListOptions = new List&lt;ListOption&gt;();
-
-			public string Name;
-			public Type OptionType;
-
-			#endregion
-
-			#region Constructors
-
-			public Option(int idx)
-			{
-				Name = GetOptionName(idx);
-				Key = GetOptionKey(idx);
-				Description = GetOptionDesc(idx);
-				OptionType = (Type) GetOptionType(idx);
-				strMaxLen = GetOptionStringMaxLen(idx);
-				min = GetOptionNumberMin(idx);
-				max = GetOptionNumberMax(idx);
-				step = GetOptionNumberStep(idx);
-				int listCount = GetOptionListCount(idx);
-				for (int i = 0; i &lt; listCount; i++) {
-					var optl = new ListOption(idx, i);
-					ListOptions.Add(optl);
-				}
-				switch (OptionType) {
-					case Type.Bool:
-						Default = GetOptionBoolDef(idx).ToString();
-						break;
-					case Type.Number:
-						Default = GetOptionNumberDef(idx).ToString();
-						break;
-					case Type.String:
-						Default = GetOptionStringDef(idx);
-						break;
-					case Type.List:
-						Default = GetOptionListDef(idx);
-						break;
-				}
-			}
-
-			#endregion
-
-			#region Public methods
-
-			public bool GetPair(string Value, out string result)
-			{
-				result = &quot;&quot;;
-				switch (OptionType) {
-					case Type.Bool:
-						if (Value != &quot;0&quot; &amp;&amp; Value != &quot;1&quot;) return false;
-						result = ConstructLine(Value);
-						return true;
-
-					case Type.Number:
-						double d;
-						if (!double.TryParse(Value, out d)) return false;
-						if (d &lt; min || d &gt; max) return false;
-						result = ConstructLine(Value);
-						return true;
-
-					case Type.String:
-						if (strMaxLen != 0 &amp;&amp; Value.Length &gt; strMaxLen) return false;
-						result = ConstructLine(Value);
-						return true;
-
-					case Type.List:
-						foreach (var lop in ListOptions) {
-							if (lop.Key == Value) {
-								result = ConstructLine(lop.Key);
-								return true;
-							}
-						}
-						return false;
-				}
-
-				return false;
-			}
-
-			#endregion
-
-			#region Overrides
-
-			public override string ToString()
-			{
-				string pom = &quot;&quot;;
-				string typs = &quot;&quot;;
-				if (OptionType == Type.Number) {
-					typs = &quot;x&quot;;
-					pom += &quot; = &quot;;
-					if (min != float.MinValue) pom += &quot; &gt;=&quot; + min;
-					if (max != float.MaxValue) pom += &quot; &lt;=&quot; + max;
-				}
-				if (OptionType == Type.List) {
-					pom += &quot; = &quot;;
-					foreach (var lop in ListOptions) {
-						pom += lop.Key + &quot;-&quot; + lop.Description + &quot; | &quot;;
-						typs += lop.Key + &quot;|&quot;;
-					}
-				}
-				if (OptionType == Type.Bool) typs += &quot;0|1&quot;;
-				if (OptionType == Type.String) typs += &quot;s&quot;;
-
-				return string.Format(&quot;{0}={1}  ({2}{3})&quot;, Key, typs, Description, pom);
-			}
-
-			#endregion
-
-			#region Other methods
-
-			private string ConstructLine(string val)
-			{
-				return Table + Key + &quot;=&quot; + val;
-			}
-
-			#endregion
-		}
-
-		#endregion
-	}
-}
\ No newline at end of file

Modified: Lobby/springie/Springie/utils/AutoUpdater.cs
===================================================================
--- Lobby/springie/Springie/utils/AutoUpdater.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/utils/AutoUpdater.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -82,10 +82,9 @@
 
 			var b = tas.GetBattle();
 			if (b != null) {
-				spring.Reload(true, false);
 				string selMod = b.Mod.Name;
 				int vers = int.MinValue;
-				foreach (var s in spring.UnitSync.ModList.Keys) {
+				foreach (var s in spring.UnitSyncWrapper.ModList.Keys) {
 					if (s.Contains(&quot;Complete Annihilation&quot;)) {
 						if ((Program.main.config.CaUpdating == MainConfig.CaUpdateMode.Stable &amp;&amp; s.Contains(&quot;stable&quot;)) || Program.main.config.CaUpdating == MainConfig.CaUpdateMode.Latest) {
 							int nv = ExtractVersionNumber(s);

Modified: Lobby/springie/Springie/utils/FileDownloader.cs
===================================================================
--- Lobby/springie/Springie/utils/FileDownloader.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/utils/FileDownloader.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -146,7 +146,7 @@
 				}
 
 				string mapSmf = realFileName.Substring(0, realFileName.LastIndexOf('.')) + &quot;.smf&quot;;
-				if (spring.UnitSync.HasMap(mapSmf)) {
+				if (spring.UnitSyncWrapper.HasMap(mapSmf)) {
 					// we have this map already let's fuck this
 					if (DownloadCompleted != null) DownloadCompleted(this, new DownloadEventArgs(new DownloadItem(FileType.Map, mapNameUrlOrId), Status.Failed, &quot;We already have this map&quot;));
 					return;

Modified: Lobby/springie/Springie/utils/UnknownFilesLinker.cs
===================================================================
--- Lobby/springie/Springie/utils/UnknownFilesLinker.cs	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie/utils/UnknownFilesLinker.cs	2008-10-16 02:01:54 UTC (rev 6754)
@@ -62,16 +62,7 @@
 
 		#region Public methods
 
-		/// &lt;summary&gt;
-		/// Gets map link from .smf map name
-		/// &lt;/summary&gt;
-		/// &lt;param name=&quot;name&quot;&gt;.smf based map name&lt;/param&gt;
-		/// &lt;returns&gt;maplink to download corresponding map archive&lt;/returns&gt;
-		public string GetMapBounceLink(string name)
-		{
-			name = spring.GetMapArchiveName(name);
-			return &quot;<A HREF="http://spring.jobjol.nl/search_result.php?select_select=select_file_name&amp;search=">http://spring.jobjol.nl/search_result.php?select_select=select_file_name&amp;search=</A>&quot; + Uri.EscapeDataString(name) + &quot;  Or use CaDownloader to auto get maps for game: <A HREF="http://caspring.org/wiki/CaUpdater">http://caspring.org/wiki/CaUpdater</A>&quot;;
-		}
+	
 
 		/// &lt;summary&gt;
 		/// Gets search results for full text map search

Modified: Lobby/springie/Springie.sln
===================================================================
--- Lobby/springie/Springie.sln	2008-10-15 15:28:27 UTC (rev 6753)
+++ Lobby/springie/Springie.sln	2008-10-16 02:01:54 UTC (rev 6754)
@@ -3,6 +3,8 @@
 # Visual Studio 2008
 Project(&quot;{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}&quot;) = &quot;Springie&quot;, &quot;Springie\Springie.csproj&quot;, &quot;{DD5A4F64-6C82-4F75-9EED-992378EC65FC}&quot;
 EndProject
+Project(&quot;{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}&quot;) = &quot;ModInfoBuilder&quot;, &quot;ModInfoBuilder\ModInfoBuilder.csproj&quot;, &quot;{0E671B78-447F-40DF-A9C6-D9BD2CF7D137}&quot;
+EndProject
 Global
 	GlobalSection(SolutionConfigurationPlatforms) = preSolution
 		Debug|Any cpu = Debug|Any cpu
@@ -13,6 +15,10 @@
 		{DD5A4F64-6C82-4F75-9EED-992378EC65FC}.Debug|Any cpu.Build.0 = Debug|x86
 		{DD5A4F64-6C82-4F75-9EED-992378EC65FC}.Release|Any cpu.ActiveCfg = Release|x86
 		{DD5A4F64-6C82-4F75-9EED-992378EC65FC}.Release|Any cpu.Build.0 = Release|x86
+		{0E671B78-447F-40DF-A9C6-D9BD2CF7D137}.Debug|Any cpu.ActiveCfg = Debug|Any CPU
+		{0E671B78-447F-40DF-A9C6-D9BD2CF7D137}.Debug|Any cpu.Build.0 = Debug|Any CPU
+		{0E671B78-447F-40DF-A9C6-D9BD2CF7D137}.Release|Any cpu.ActiveCfg = Release|Any CPU
+		{0E671B78-447F-40DF-A9C6-D9BD2CF7D137}.Release|Any cpu.Build.0 = Release|Any CPU
 	EndGlobalSection
 	GlobalSection(SolutionProperties) = preSolution
 		HideSolutionNode = FALSE


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001522.html">[Taspring-linux-commit] r6753 - trunk/rts/Sim/Units/CommandAI
</A></li>
	<LI>Next message: <A HREF="001524.html">[Taspring-linux-commit] r6755 - in Lobby/springie: ModInfoBuilder	Springie Springie/client Springie/spring Springie/utils
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1523">[ date ]</a>
              <a href="thread.html#1523">[ thread ]</a>
              <a href="subject.html#1523">[ subject ]</a>
              <a href="author.html#1523">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
