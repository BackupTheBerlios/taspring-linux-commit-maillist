<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6853 - in Lobby/TASClient: . Interface	Python Python/scripts/subf
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6853%20-%20in%20Lobby/TASClient%3A%20.%20Interface%0A%09Python%20Python/scripts/subf&In-Reply-To=%3C20081022184433.BECA94730%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001621.html">
   <LINK REL="Next"  HREF="001623.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6853 - in Lobby/TASClient: . Interface	Python Python/scripts/subf</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6853%20-%20in%20Lobby/TASClient%3A%20.%20Interface%0A%09Python%20Python/scripts/subf&In-Reply-To=%3C20081022184433.BECA94730%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6853 - in Lobby/TASClient: . Interface	Python Python/scripts/subf">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Wed Oct 22 20:44:33 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001621.html">[Taspring-linux-commit] r6852 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="001623.html">[Taspring-linux-commit] r6854 - in trunk/rts: Game Game/UI	Rendering System lib/hpiutil2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1622">[ date ]</a>
              <a href="thread.html#1622">[ thread ]</a>
              <a href="subject.html#1622">[ subject ]</a>
              <a href="author.html#1622">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2008-10-22 20:44:31 +0200 (Wed, 22 Oct 2008)
New Revision: 6853

Added:
   Lobby/TASClient/CustomizeGUIFormUnit.ddp
   Lobby/TASClient/CustomizeGUIFormUnit.dfm
   Lobby/TASClient/CustomizeGUIFormUnit.pas
   Lobby/TASClient/Interface/gameEndCondItem.html
   Lobby/TASClient/SetValuesFormUnit.dfm
   Lobby/TASClient/SetValuesFormUnit.pas
Modified:
   Lobby/TASClient/BattleFormUnit.dfm
   Lobby/TASClient/BattleFormUnit.pas
   Lobby/TASClient/HelpUnit.dfm
   Lobby/TASClient/Interface/default.js
   Lobby/TASClient/Interface/defaultMissionSkin.html
   Lobby/TASClient/Interface/luaListItem.html
   Lobby/TASClient/Interface/selectmod.html
   Lobby/TASClient/Interface/skirmish.html
   Lobby/TASClient/LobbyScriptUnit.pas
   Lobby/TASClient/MainUnit.dfm
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/MenuFormUnit.dfm
   Lobby/TASClient/MenuFormUnit.pas
   Lobby/TASClient/Misc.pas
   Lobby/TASClient/PreferencesFormUnit.pas
   Lobby/TASClient/Python/api.txt
   Lobby/TASClient/Python/scripts/subf/dropDownButtonTest.py
   Lobby/TASClient/Python/scripts/subf/frenchTranslationTest.py
   Lobby/TASClient/Python/scripts/subf/stick.py
   Lobby/TASClient/Python/scripts/subf/windowedTASClient.py
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.dpr
   Lobby/TASClient/TASClient.res
   Lobby/TASClient/Utility.pas
Log:
* SP updated to handle the game options changes
* SP updated to handle the new campaigns/missions protocol (not finished yet)
* SP can get its skin from the mod itself now
* you now have 2menus, the first one only has Single Player, Multiplayer, Settings and Quit. Single Player leads to the mod selection, then you get the mod's menu with campaigns missions etc
* some control updated with better ones
* first official python script : layoutManager, it adds a button next to the search one, and you can pick a new gui layout (for now there are only three layouts)
* new customize form (it's a bit hidden for now since it's not easy to use it)
* python : adddropdownbutton function added
* python getricheditlist addtorichedit moved to gui class
* python setcontrolproperties and getcontrolproperties have now a new parameter to get subproperties values
* python StackLayoutChanges added to the gui class for the customizeform
* python scripts updated with python api changes

Modified: Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/BattleFormUnit.dfm	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/BattleFormUnit.dfm	2008-10-22 18:44:31 UTC (rev 6853)
@@ -1,7 +1,7 @@
 object BattleForm: TBattleForm
-  Left = 774
-  Top = 240
-  Width = 830
+  Left = 858
+  Top = 179
+  Width = 829
   Height = 586
   Caption = 'Battle window'
   Color = clBtnFace
@@ -24,13 +24,13 @@
   object SpTBXTitleBar1: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 822
+    Width = 821
     Height = 559
     Caption = 'Battle window'
     object Panel3: TSpTBXPanel
       Left = 4
       Top = 514
-      Width = 814
+      Width = 813
       Height = 41
       Align = alBottom
       Color = clNone
@@ -39,7 +39,7 @@
       BorderType = pbrRaised
       TBXStyleBackground = True
       DesignSize = (
-        814
+        813
         41)
       object StartButton: TSpTBXButton
         Left = 104
@@ -133,7 +133,7 @@
         LinkFont.Style = [fsUnderline]
       end
       object LadderRulesButton: TSpTBXButton
-        Left = 728
+        Left = 727
         Top = 8
         Width = 75
         Height = 25
@@ -168,7 +168,7 @@
     object Panel2: TPanel
       Left = 4
       Top = 426
-      Width = 814
+      Width = 813
       Height = 88
       Align = alClient
       TabOrder = 2
@@ -4047,12 +4047,12 @@
     object Panel1: TPanel
       Left = 4
       Top = 30
-      Width = 814
+      Width = 813
       Height = 275
       Align = alTop
       TabOrder = 3
       object Panel5: TPanel
-        Left = 394
+        Left = 393
         Top = 1
         Width = 419
         Height = 273
@@ -4342,14 +4342,13 @@
               Color = clNone
               ParentColor = False
               TabOrder = 1
-              Visible = False
-              object lblMetal: TSpTBXLabel
-                Left = 8
-                Top = 176
+              object lblEnergy: TSpTBXLabel
+                Left = 56
+                Top = 184
                 Width = 41
-                Height = 41
+                Height = 33
                 Cursor = crHandPoint
-                Caption = 'Metal'
+                Caption = 'Energy'
                 AutoSize = False
                 Font.Charset = DEFAULT_CHARSET
                 Font.Color = clHotLight
@@ -4357,11 +4356,8 @@
                 Font.Name = 'MS Sans Serif'
                 Font.Style = [fsUnderline]
                 ParentFont = False
-                ParentShowHint = False
-                ShowHint = True
-                Visible = False
                 Wrapping = twWrap
-                OnClick = lblMetalClick
+                OnClick = lblEnergyClick
                 Alignment = taCenter
                 LinkFont.Charset = DEFAULT_CHARSET
                 LinkFont.Color = clBlue
@@ -4369,13 +4365,13 @@
                 LinkFont.Name = 'MS Sans Serif'
                 LinkFont.Style = [fsUnderline]
               end
-              object lblEnergy: TSpTBXLabel
-                Left = 56
-                Top = 176
-                Width = 57
-                Height = 41
+              object lblMetal: TSpTBXLabel
+                Left = 8
+                Top = 184
+                Width = 41
+                Height = 33
                 Cursor = crHandPoint
-                Caption = 'Energy'
+                Caption = 'Metal'
                 AutoSize = False
                 Font.Charset = DEFAULT_CHARSET
                 Font.Color = clHotLight
@@ -4383,11 +4379,8 @@
                 Font.Name = 'MS Sans Serif'
                 Font.Style = [fsUnderline]
                 ParentFont = False
-                ParentShowHint = False
-                ShowHint = True
-                Visible = False
                 Wrapping = twWrap
-                OnClick = lblEnergyClick
+                OnClick = lblMetalClick
                 Alignment = taCenter
                 LinkFont.Charset = DEFAULT_CHARSET
                 LinkFont.Color = clBlue
@@ -4396,10 +4389,10 @@
                 LinkFont.Style = [fsUnderline]
               end
               object lblUnits: TSpTBXLabel
-                Left = 112
-                Top = 176
-                Width = 46
-                Height = 41
+                Left = 104
+                Top = 184
+                Width = 49
+                Height = 33
                 Cursor = crHandPoint
                 Caption = 'Units'
                 AutoSize = False
@@ -4409,9 +4402,7 @@
                 Font.Name = 'MS Sans Serif'
                 Font.Style = [fsUnderline]
                 ParentFont = False
-                ParentShowHint = False
-                ShowHint = True
-                Visible = False
+                Wrapping = twWrap
                 OnClick = lblUnitsClick
                 Alignment = taCenter
                 LinkFont.Charset = DEFAULT_CHARSET
@@ -4447,7 +4438,7 @@
                 OnMouseUpAfterChange = MetalTrackerMouseUpAfterChange
               end
               object EnergyTracker: TSpTBXjanTracker
-                Left = 66
+                Left = 58
                 Top = 16
                 Width = 39
                 Height = 171
@@ -4473,7 +4464,7 @@
                 OnMouseUpAfterChange = EnergyTrackerMouseUpAfterChange
               end
               object UnitsTracker: TSpTBXjanTracker
-                Left = 114
+                Left = 106
                 Top = 16
                 Width = 39
                 Height = 171
@@ -4504,13 +4495,16 @@
               Top = 80
               Width = 225
               Height = 65
+              Hint = 
+                'Lineage mode = Every units or building you made will explode if ' +
+                'your commander dies (You can'#39't share your units just before your' +
+                ' commander dies)'
               Caption = 'Game end condition'
               Color = clNone
               ParentColor = False
               ParentShowHint = False
               ShowHint = True
               TabOrder = 2
-              Visible = False
               OnClick = GameEndRadioGroupClick
             end
             object StartPosRadioGroup: TSpTBXRadioGroup
@@ -4563,7 +4557,7 @@
       object Panel6: TPanel
         Left = 1
         Top = 1
-        Width = 393
+        Width = 392
         Height = 273
         Align = alClient
         BevelOuter = bvNone
@@ -4572,7 +4566,7 @@
         object MapPanel: TSpTBXPanel
           Left = 0
           Top = 0
-          Width = 393
+          Width = 392
           Height = 273
           Align = alClient
           Color = clNone
@@ -4582,12 +4576,12 @@
           OnResize = MapPanelResize
           TBXStyleBackground = True
           DesignSize = (
-            393
+            392
             273)
           object Bevel2: TBevel
             Left = 0
             Top = 219
-            Width = 393
+            Width = 392
             Height = 46
             Anchors = [akLeft, akRight, akBottom]
             Shape = bsTopLine
@@ -4595,7 +4589,7 @@
           object MapImage: TImageEx
             Left = 5
             Top = 5
-            Width = 264
+            Width = 263
             Height = 216
             Cursor = crHandPoint
             Hint = 'No map'
@@ -4611,7 +4605,7 @@
           object MapDescLabel: TSpTBXLabel
             Left = 8
             Top = 224
-            Width = 377
+            Width = 376
             Height = 41
             Caption = 'MapDescLabel'
             Anchors = [akLeft, akRight, akBottom]
@@ -4627,7 +4621,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object TidalStrengthLabel: TSpTBXLabel
-            Left = 280
+            Left = 279
             Top = 143
             Width = 76
             Height = 13
@@ -4640,7 +4634,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object GravityLabel: TSpTBXLabel
-            Left = 280
+            Left = 279
             Top = 158
             Width = 45
             Height = 13
@@ -4653,7 +4647,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object MaxMetalLabel: TSpTBXLabel
-            Left = 280
+            Left = 279
             Top = 173
             Width = 63
             Height = 13
@@ -4666,7 +4660,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object ExtRadiusLabel: TSpTBXLabel
-            Left = 280
+            Left = 279
             Top = 188
             Width = 85
             Height = 13
@@ -4679,7 +4673,7 @@
             LinkFont.Style = [fsUnderline]
           end
           object WindLabel: TSpTBXLabel
-            Left = 280
+            Left = 279
             Top = 203
             Width = 86
             Height = 13
@@ -4692,10 +4686,10 @@
             LinkFont.Style = [fsUnderline]
           end
           object SpTBXPanel1: TSpTBXPanel
-            Left = 272
+            Left = 271
             Top = 4
             Width = 113
-            Height = 122
+            Height = 117
             Caption = 'SpTBXPanel1'
             Anchors = [akTop, akRight]
             Color = clNone
@@ -4709,74 +4703,93 @@
               Height = 33
               Shape = bsTopLine
             end
-            object MapsButton: TTBXButton
+            object MapsButton: TSpTBXButton
               Left = 8
-              Top = 7
+              Top = 8
               Width = 81
               Height = 17
-              BorderSize = 2
               Caption = 'Map list ...'
-              SmartFocus = False
-              TabOrder = 0
+              TabOrder = 1
               OnClick = MapsButtonClick
+              LinkFont.Charset = DEFAULT_CHARSET
+              LinkFont.Color = clBlue
+              LinkFont.Height = -11
+              LinkFont.Name = 'MS Sans Serif'
+              LinkFont.Style = [fsUnderline]
             end
-            object ReloadMapListButton: TTBXButton
-              Left = 8
-              Top = 27
-              Width = 97
+            object DropDownMapSelectionButton: TSpTBXButton
+              Left = 88
+              Top = 8
+              Width = 17
               Height = 17
-              BorderSize = 2
-              Caption = 'Reload map list'
-              TabOrder = 1
-              OnClick = ReloadMapListButtonClick
+              TabOrder = 0
+              DropDownMenu = MapsPopupMenu
+              LinkFont.Charset = DEFAULT_CHARSET
+              LinkFont.Color = clBlue
+              LinkFont.Height = -11
+              LinkFont.Name = 'MS Sans Serif'
+              LinkFont.Style = [fsUnderline]
+              ThemeType = thtTBX
             end
-            object TBXButton1: TTBXButton
+            object ReloadMapListButton: TSpTBXButton
               Left = 8
-              Top = 76
+              Top = 24
               Width = 97
               Height = 17
-              BorderSize = 2
-              Caption = 'Online maps ...'
+              Caption = 'Reload map list'
               TabOrder = 2
-              OnClick = TBXButton1Click
+              OnClick = ReloadMapListButtonClick
+              LinkFont.Charset = DEFAULT_CHARSET
+              LinkFont.Color = clBlue
+              LinkFont.Height = -11
+              LinkFont.Name = 'MS Sans Serif'
+              LinkFont.Style = [fsUnderline]
             end
-            object TBXButton2: TTBXButton
+            object DownloadMapButton: TSpTBXButton
               Left = 8
-              Top = 96
+              Top = 56
               Width = 97
               Height = 17
-              BorderSize = 2
-              Caption = 'Online mods ...'
+              Caption = 'Download map ...'
               TabOrder = 3
-              OnClick = TBXButton2Click
+              OnClick = DownloadMapButtonClick
+              LinkFont.Charset = DEFAULT_CHARSET
+              LinkFont.Color = clBlue
+              LinkFont.Height = -11
+              LinkFont.Name = 'MS Sans Serif'
+              LinkFont.Style = [fsUnderline]
             end
-            object DownloadMapButton: TTBXButton
+            object OnlineMapsButton: TSpTBXButton
               Left = 8
-              Top = 56
+              Top = 72
               Width = 97
               Height = 17
-              BorderSize = 2
-              Caption = 'Download map ...'
+              Caption = 'Online maps ...'
               TabOrder = 4
-              OnClick = DownloadMapButtonClick
+              OnClick = OnlineMapsButtonClick
+              LinkFont.Charset = DEFAULT_CHARSET
+              LinkFont.Color = clBlue
+              LinkFont.Height = -11
+              LinkFont.Name = 'MS Sans Serif'
+              LinkFont.Style = [fsUnderline]
             end
-            object DropDownMapSelectionButton: TSpTBXButton
-              Left = 88
-              Top = 7
-              Width = 17
+            object OnlineModsButton: TSpTBXButton
+              Left = 8
+              Top = 88
+              Width = 97
               Height = 17
+              Caption = 'Online mods ...'
               TabOrder = 5
-              DropDownMenu = MapsPopupMenu
+              OnClick = OnlineModsButtonClick
               LinkFont.Charset = DEFAULT_CHARSET
               LinkFont.Color = clBlue
               LinkFont.Height = -11
               LinkFont.Name = 'MS Sans Serif'
               LinkFont.Style = [fsUnderline]
-              ThemeType = thtTBX
             end
           end
           object MapSizeLabel: TSpTBXLabel
-            Left = 280
+            Left = 279
             Top = 128
             Width = 54
             Height = 13
@@ -4794,7 +4807,7 @@
     object Panel4: TSpTBXPanel
       Left = 4
       Top = 311
-      Width = 814
+      Width = 813
       Height = 109
       Caption = 'Panel4'
       Align = alTop
@@ -4802,12 +4815,12 @@
       BorderType = pbrRaised
       TBXStyleBackground = True
       DesignSize = (
-        814
+        813
         109)
       object VDTBattleClients: TVirtualDrawTree
         Left = 8
         Top = 8
-        Width = 504
+        Width = 503
         Height = 94
         Anchors = [akLeft, akTop, akRight, akBottom]
         Font.Charset = DEFAULT_CHARSET
@@ -4872,7 +4885,7 @@
           end
           item
             Position = 6
-            Width = 35
+            Width = 34
             WideText = 'Player Bonus'
           end
           item
@@ -4894,7 +4907,7 @@
           end&gt;
       end
       object lblTeamNbr: TSpTBXLabel
-        Left = 517
+        Left = 516
         Top = 8
         Width = 44
         Height = 13
@@ -4911,7 +4924,7 @@
         LinkFont.Style = [fsUnderline]
       end
       object MyOptionsGroupBox: TSpTBXGroupBox
-        Left = 564
+        Left = 563
         Top = 5
         Width = 242
         Height = 92
@@ -5025,7 +5038,7 @@
     object Splitter2: TSpTBXSplitter
       Left = 4
       Top = 305
-      Width = 814
+      Width = 813
       Height = 6
       Cursor = crSizeNS
       Caption = 'Splitter1'
@@ -5034,7 +5047,7 @@
     object SpTBXSplitter2: TSpTBXSplitter
       Left = 4
       Top = 420
-      Width = 814
+      Width = 813
       Height = 6
       Cursor = crSizeNS
       Caption = 'SpTBXSplitter2'

Modified: Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- Lobby/TASClient/BattleFormUnit.pas	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/BattleFormUnit.pas	2008-10-22 18:44:31 UTC (rev 6853)
@@ -253,9 +253,6 @@
     AddUnitsSpeedButton: TSpeedButton;
     SpTBXTabSheet2: TSpTBXTabSheet;
     ResourcesGroupBox: TSpTBXGroupBox;
-    lblEnergy: TSpTBXLabel;
-    lblMetal: TSpTBXLabel;
-    lblUnits: TSpTBXLabel;
     MetalTracker: TSpTBXjanTracker;
     EnergyTracker: TSpTBXjanTracker;
     UnitsTracker: TSpTBXjanTracker;
@@ -275,10 +272,6 @@
     WindLabel: TSpTBXLabel;
     SpTBXPanel1: TSpTBXPanel;
     Bevel1: TBevel;
-    MapsButton: TTBXButton;
-    ReloadMapListButton: TTBXButton;
-    TBXButton1: TTBXButton;
-    TBXButton2: TTBXButton;
     MapSizeLabel: TSpTBXLabel;
     KeepRatioItem: TSpTBXItem;
     SpTBXSeparatorItem7: TSpTBXSeparatorItem;
@@ -290,7 +283,6 @@
     SpTBXSeparatorItem10: TSpTBXSeparatorItem;
     SpTBXSeparatorItem11: TSpTBXSeparatorItem;
     SpTBXSeparatorItem12: TSpTBXSeparatorItem;
-    DownloadMapButton: TTBXButton;
     MapsPopupMenu: TSpTBXFormPopupMenu;
     DropDownMapSelectionButton: TSpTBXButton;
     InputEdit: TTntMemo;
@@ -307,6 +299,14 @@
     MySideButton: TSpTBXSpeedButton;
     Splitter2: TSpTBXSplitter;
     SpTBXSplitter2: TSpTBXSplitter;
+    MapsButton: TSpTBXButton;
+    ReloadMapListButton: TSpTBXButton;
+    DownloadMapButton: TSpTBXButton;
+    OnlineMapsButton: TSpTBXButton;
+    OnlineModsButton: TSpTBXButton;
+    lblMetal: TSpTBXLabel;
+    lblEnergy: TSpTBXLabel;
+    lblUnits: TSpTBXLabel;
 
     procedure CreateParams(var Params: TCreateParams); override;
 
@@ -438,8 +438,6 @@
     procedure SpTBXItem4Click(Sender: TObject);
     procedure SpTBXItem7Click(Sender: TObject);
     procedure MapsButtonClick(Sender: TObject);
-    procedure TBXButton1Click(Sender: TObject);
-    procedure TBXButton2Click(Sender: TObject);
     procedure ReloadMapListButtonClick(Sender: TObject);
     procedure VDTBattleClientsDblClick(Sender: TObject);
     procedure ForceSpectatorModeItemClick(Sender: TObject);
@@ -516,6 +514,8 @@
       const Text: WideString);
     procedure MapsPopupMenuPopup(Sender: TObject);
     procedure InputEditChange(Sender: TObject);
+    procedure OnlineMapsButtonClick(Sender: TObject);
+    procedure OnlineModsButtonClick(Sender: TObject);
   private
     History: TWideStringList;
     HistoryIndex: Integer;
@@ -2029,7 +2029,6 @@
   index: Integer;
   MyPlayerNum: Integer;
   Script: TScript;
-  sl: TStrings;
   tryToRewriteScript: Boolean;
 
   PurgedClients: array of // without spectators and with shifted team and ally numbers. Bots are included too.
@@ -2262,17 +2261,12 @@
 
   //MainForm.AddMainLog(Script.GetBruteScript,Colors.Info);
 
-  sl := TStringList.Create;
-  sl.Text := Script.Script;
-
-
   // write down the script
   repeat
   try
     AssignFile(f, FileName);
     Rewrite(f);
-    for i := 0 to sl.Count-1 do Writeln(f, sl[i]);
-    sl.Free;
+    Write(f, Script.Script);
     CloseFile(f);
     tryToRewriteScript := False;
     Result := True;
@@ -2283,10 +2277,10 @@
     except
       //
     end;
-    tryToRewriteScript := MessageDlg('Could''nt write the start script file ''script.txt'', try again ?',mtError,[mbYes,mbNo],0) = mrYes;
+    tryToRewriteScript := MessageDlg(CANT_WRITE_SCRIPT_MSG,mtError,[mbYes,mbNo],0) = mrYes;
   end;
   until not tryToRewriteScript;
-
+  Script.Free;
   Finalize(PurgedClients);
 end;
 
@@ -2295,7 +2289,6 @@
   f: TextFile;
   i: Integer;
   Script: TScript;
-  sl: TStringList;
   tryToRewriteScript:boolean;
 begin
   Script := TScript.Create(BattleReplayInfo.Script.Text);
@@ -2339,16 +2332,12 @@
     Script.AddOrChangeKeyValue('GAME/PLAYER'+IntToStr(BattleReplayInfo.OriginalClients.Count+i)+'/Spectator','1');
   end;
 
-  sl := TStringList.Create;
-  sl.Text := Script.Script;
-
   // write down the script
   repeat
   try
     AssignFile(f, FileName);
     Rewrite(f);
-    for i := 0 to sl.Count-1 do Writeln(f, sl[i]);
-    sl.Free;
+    Write(f,  Script.Script);
     CloseFile(f);
     tryToRewriteScript := False;
     Result := True;
@@ -2359,9 +2348,10 @@
     except
       //
     end;
-    tryToRewriteScript := MessageDlg('Could''nt write the start script file ''script.txt'', try again ?',mtError,[mbYes,mbNo],0) = mrYes;
+    tryToRewriteScript := MessageDlg(CANT_WRITE_SCRIPT_MSG,mtError,[mbYes,mbNo],0) = mrYes;
   end;
   until not tryToRewriteScript;
+  Script.Free;
 end;
 
 procedure TBattleForm.FormCreate(Sender: TObject);
@@ -3036,6 +3026,8 @@
     MainForm.TryToSendCommand('LEAVEBATTLE');
     ResetBattleScreen;
   end;
+  
+  Utility.ReInitLib;
 end;
 
 procedure TBattleForm.MetalTrackerMouseUpAfterChange(Sender: TObject);
@@ -3471,7 +3463,10 @@
 
 procedure TBattleForm.FormShow(Sender: TObject);
 begin
-  InputEdit.SetFocus;
+  try
+    InputEdit.SetFocus;
+  except
+  end;
   MapPanelResize(nil);
 end;
 
@@ -4769,19 +4764,6 @@
   MapListForm.ShowModal;
 end;
 
-procedure TBattleForm.TBXButton1Click(Sender: TObject);
-begin
-  if MAP_DOWNLOADER_ENABLED then
-    OnlineMapsForm.Show
-  else
-    Misc.OpenURLInDefaultBrowser(MAPS_PAGE_LINK);
-end;
-
-procedure TBattleForm.TBXButton2Click(Sender: TObject);
-begin
-  Misc.OpenURLInDefaultBrowser(MODS_PAGE_LINK);
-end;
-
 procedure TBattleForm.ReloadMapListButtonClick(Sender: TObject);
 var
   i:integer;
@@ -6661,4 +6643,17 @@
   MainForm.InputEditChange(Sender);
 end;
 
+procedure TBattleForm.OnlineMapsButtonClick(Sender: TObject);
+begin
+  if MAP_DOWNLOADER_ENABLED then
+    OnlineMapsForm.Show
+  else
+    Misc.OpenURLInDefaultBrowser(MAPS_PAGE_LINK);
+end;
+
+procedure TBattleForm.OnlineModsButtonClick(Sender: TObject);
+begin
+  Misc.OpenURLInDefaultBrowser(MODS_PAGE_LINK);
+end;
+
 end.

Added: Lobby/TASClient/CustomizeGUIFormUnit.ddp
===================================================================
--- Lobby/TASClient/CustomizeGUIFormUnit.ddp	                        (rev 0)
+++ Lobby/TASClient/CustomizeGUIFormUnit.ddp	2008-10-22 18:44:31 UTC (rev 6853)
@@ -0,0 +1 @@
+DELPHI.DIAGRAM.PORTFOLIO  &#224;@		Untitled1   
\ No newline at end of file

Added: Lobby/TASClient/CustomizeGUIFormUnit.dfm
===================================================================
--- Lobby/TASClient/CustomizeGUIFormUnit.dfm	                        (rev 0)
+++ Lobby/TASClient/CustomizeGUIFormUnit.dfm	2008-10-22 18:44:31 UTC (rev 6853)
@@ -0,0 +1,325 @@
+object CustomizeGUIForm: TCustomizeGUIForm
+  Left = 829
+  Top = 102
+  Width = 712
+  Height = 520
+  Caption = 'Poweruser window'
+  Color = clBtnFace
+  Font.Charset = DEFAULT_CHARSET
+  Font.Color = clWindowText
+  Font.Height = -11
+  Font.Name = 'MS Sans Serif'
+  Font.Style = []
+  Menu = TopMenu
+  OldCreateOrder = False
+  OnCreate = FormCreate
+  PixelsPerInch = 96
+  TextHeight = 13
+  object ControlsPanel: TSpTBXPanel
+    Left = 0
+    Top = 0
+    Width = 272
+    Height = 474
+    Align = alLeft
+    TabOrder = 0
+    BorderType = pbrFramed
+    object VDTControls: TVirtualStringTree
+      Left = 2
+      Top = 25
+      Width = 268
+      Height = 414
+      Align = alClient
+      Header.AutoSizeIndex = 0
+      Header.Font.Charset = DEFAULT_CHARSET
+      Header.Font.Color = clWindowText
+      Header.Font.Height = -11
+      Header.Font.Name = 'MS Sans Serif'
+      Header.Font.Style = []
+      Header.Options = [hoAutoResize, hoColumnResize, hoDrag]
+      TabOrder = 0
+      OnClick = VDTControlsClick
+      OnGetText = VDTControlsGetText
+      Columns = &lt;
+        item
+          Position = 0
+          Width = 264
+        end&gt;
+    end
+    object FormsPanel: TSpTBXPanel
+      Left = 2
+      Top = 2
+      Width = 268
+      Height = 23
+      Align = alTop
+      TabOrder = 1
+      BorderType = pbrFramed
+      object FormSelectionComboBox: TSpTBXComboBox
+        Left = 2
+        Top = 2
+        Width = 167
+        Height = 21
+        Align = alClient
+        Style = csDropDownList
+        ItemHeight = 13
+        TabOrder = 0
+        OnChange = FormSelectionComboBoxChange
+      end
+      object RefreshFormListButton: TSpTBXButton
+        Left = 169
+        Top = 2
+        Width = 97
+        Height = 19
+        Caption = 'Refresh'
+        Align = alRight
+        TabOrder = 1
+        OnClick = RefreshFormListButtonClick
+        LinkFont.Charset = DEFAULT_CHARSET
+        LinkFont.Color = clBlue
+        LinkFont.Height = -11
+        LinkFont.Name = 'MS Sans Serif'
+        LinkFont.Style = [fsUnderline]
+      end
+    end
+    object PickButton: TSpTBXButton
+      Left = 2
+      Top = 439
+      Width = 268
+      Height = 33
+      Hint = 
+        'Push that button then mouve your mouse cursor to one control in ' +
+        'the current form then release the mouse button to select that co' +
+        'ntrol in the list automaticaly.'
+      Caption = 'Pick'
+      Align = alBottom
+      ParentShowHint = False
+      ShowHint = True
+      TabOrder = 2
+      OnMouseUp = PickButtonMouseUp
+      LinkFont.Charset = DEFAULT_CHARSET
+      LinkFont.Color = clBlue
+      LinkFont.Height = -11
+      LinkFont.Name = 'MS Sans Serif'
+      LinkFont.Style = [fsUnderline]
+    end
+  end
+  object VerticalSplitter: TSpTBXSplitter
+    Left = 272
+    Top = 0
+    Width = 9
+    Height = 474
+    Cursor = crSizeWE
+    Caption = 'VerticalSplitter'
+  end
+  object PropertiesScrollBox: TTntScrollBox
+    Left = 281
+    Top = 0
+    Width = 423
+    Height = 474
+    Align = alClient
+    BevelInner = bvNone
+    BorderStyle = bsNone
+    TabOrder = 2
+    object PropertiesListEditor: TValueListEditor
+      Left = 0
+      Top = 0
+      Width = 423
+      Height = 474
+      Align = alClient
+      BorderStyle = bsNone
+      Color = clBtnFace
+      DisplayOptions = [doAutoColResize, doKeyColFixed]
+      Options = [goFixedVertLine, goFixedHorzLine, goVertLine, goHorzLine, goColSizing, goEditing, goThumbTracking]
+      ScrollBars = ssVertical
+      Strings.Strings = (
+        '=')
+      TabOrder = 0
+      OnEditButtonClick = PropertiesListEditorEditButtonClick
+      OnStringsChange = PropertiesListEditorStringsChange
+      ColWidths = (
+        150
+        271)
+    end
+    object ProfileTemplate: TMemo
+      Left = 24
+      Top = 80
+      Width = 321
+      Height = 353
+      Lines.Strings = (
+        'import lobbyscript'
+        ''
+        'api = lobbyscript.Callback()'
+        'gui = lobbyscript.GUI()'
+        ''
+        'opList = []'
+        'newControlList = []'
+        ''
+        'def addOperationToList(control,property,subprop,oldValue):'
+        #9'op = dict()'
+        #9'op['#39'Control'#39'] = control'
+        #9'op['#39'Property'#39'] = property'
+        #9'op['#39'SubProperty'#39'] = subprop'
+        #9'op['#39'OldValue'#39'] = oldValue'
+        #9'opList.append(op)'
+        ''
+        'def changeControlProp(control,prop,subProp,value, undo = True):'
+        #9'p = gui.GetControlProperties(control,prop)'
+        ''
+        #9'if undo:'
+        #9#9'if subProp == '#39'Align'#39':'
+        
+          #9#9#9'#  if the align changes we must save the previous pos and siz' +
+          'e'
+        #9#9#9'addOperationToList(control,prop,'#39'Top'#39',p['#39'Top'#39'])'
+        #9#9#9'addOperationToList(control,prop,'#39'Left'#39',p['#39'Left'#39'])'
+        #9#9#9'addOperationToList(control,prop,'#39'Width'#39',p['#39'Width'#39'])'
+        #9#9#9'addOperationToList(control,prop,'#39'Height'#39',p['#39'Height'#39'])'
+        #9#9
+        #9#9'addOperationToList(control,prop,subProp,p[subProp])'
+        ''
+        #9'p[subProp] = value'
+        #9'return gui.SetControlProperties(control,prop,p)'
+        ''
+        'def loadLayout():'
+        #9'gui.StackLayoutChanges(True)'
+        '${loadProfileContent}'
+        #9'gui.StackLayoutChanges(False)'
+        #9
+        'def unloadLayout():'
+        #9'global opList'
+        #9'global newControlList'
+        #9
+        #9'for i in range(len(opList)):'
+        #9#9'op = opList.pop()'
+        
+          #9#9'changeControlProp(op['#39'Control'#39'],op['#39'Property'#39'],op['#39'SubProperty' +
+          #39'],op['#39'OldValue'#39'],False)'
+        #9
+        #9'for controlName in newControlList:'
+        #9#9'gui.DeleteControl(controlName)'
+        ''
+        '${unloadProfileContent}'
+        #9
+        #9'opList = []'
+        #9'newControlList = []')
+      ScrollBars = ssHorizontal
+      TabOrder = 1
+      Visible = False
+      WordWrap = False
+    end
+  end
+  object SetValuesPopupMenu: TSpTBXFormPopupMenu
+    BorderStyle = pbsSizeableBottom
+    PopupFocus = True
+    OnClosePopup = SetValuesPopupMenuClosePopup
+    Left = 49
+    Top = 152
+  end
+  object TopMenu: TMainMenu
+    Left = 81
+    Top = 152
+    object File1: TMenuItem
+      Caption = 'File'
+      object Save1: TMenuItem
+        Caption = 'Save'
+        Enabled = False
+        OnClick = Save1Click
+      end
+      object Saveprofile1: TMenuItem
+        Caption = 'Save profile'
+        OnClick = Saveprofile1Click
+      end
+      object Resetchanges1: TMenuItem
+        Caption = 'Reset changes'
+        OnClick = Resetchanges1Click
+      end
+    end
+    object Control1: TMenuItem
+      Caption = 'Control'
+      object Add1: TMenuItem
+        Caption = 'Add'
+        object Form1: TMenuItem
+          Caption = 'Form'
+          OnClick = Form1Click
+        end
+        object Control2: TMenuItem
+          Caption = 'Control'
+          OnClick = Control2Click
+        end
+        object Panel1: TMenuItem
+          Caption = 'Panel'
+          OnClick = Panel1Click
+        end
+        object abs1: TMenuItem
+          Caption = 'Tabs'
+          OnClick = abs1Click
+        end
+        object ab1: TMenuItem
+          Caption = 'Tab'
+          OnClick = ab1Click
+        end
+        object InputBox1: TMenuItem
+          Caption = 'InputBox'
+          OnClick = InputBox1Click
+        end
+        object Label1: TMenuItem
+          Caption = 'Label'
+          OnClick = Label1Click
+        end
+        object CheckBox1: TMenuItem
+          Caption = 'CheckBox'
+          OnClick = CheckBox1Click
+        end
+        object Radio1: TMenuItem
+          Caption = 'RadioButton'
+          OnClick = Radio1Click
+        end
+        object Button1: TMenuItem
+          Caption = 'Button'
+          OnClick = Button1Click
+        end
+        object ProgressBar1: TMenuItem
+          Caption = 'ProgressBar'
+          OnClick = ProgressBar1Click
+        end
+        object rackBar1: TMenuItem
+          Caption = 'TrackBar'
+          OnClick = rackBar1Click
+        end
+        object Splitter1: TMenuItem
+          Caption = 'Splitter'
+          OnClick = Splitter1Click
+        end
+        object GroupBox1: TMenuItem
+          Caption = 'GroupBox'
+          OnClick = GroupBox1Click
+        end
+        object SpinEdit1: TMenuItem
+          Caption = 'SpinEdit'
+          OnClick = SpinEdit1Click
+        end
+        object ComboBox1: TMenuItem
+          Caption = 'ComboBox'
+          OnClick = ComboBox1Click
+        end
+        object ListBox1: TMenuItem
+          Caption = 'ListBox'
+          OnClick = ListBox1Click
+        end
+        object CheckListBox1: TMenuItem
+          Caption = 'CheckListBox'
+          OnClick = CheckListBox1Click
+        end
+      end
+      object Move1: TMenuItem
+        Caption = 'Move'
+        ShortCut = 16463
+        OnClick = Move1Click
+      end
+      object Delete1: TMenuItem
+        Caption = 'Delete'
+        ShortCut = 16452
+        OnClick = Delete1Click
+      end
+    end
+  end
+end

Added: Lobby/TASClient/CustomizeGUIFormUnit.pas
===================================================================
--- Lobby/TASClient/CustomizeGUIFormUnit.pas	                        (rev 0)
+++ Lobby/TASClient/CustomizeGUIFormUnit.pas	2008-10-22 18:44:31 UTC (rev 6853)
@@ -0,0 +1,1082 @@
+unit CustomizeGUIFormUnit;
+
+interface
+
+uses
+  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
+  Dialogs, VirtualTrees, StdCtrls, TntStdCtrls, SpTBXEditors, SpTBXControls,
+  TBXDkPanels, TntForms, Buttons, Grids, ValEdit, Menus, SpTBXFormPopupMenu,
+  LobbyScriptUnit, ComCtrls, SpTBXTabs;
+
+type
+  TProperty = class
+    protected
+      FValue: Variant;
+      FName: string;
+      FObject: TObject;
+
+      procedure ValueChanged(v: Variant);
+
+    public
+      constructor Create(name: string;value: Variant; obj: TObject);
+
+      property Value:Variant read FValue write ValueChanged;
+      property Name:string read FName;
+      property Obj: TObject read FObject;
+
+      procedure AddToList(l: TValueListEditor);
+  end;
+
+  TEnumerationProperty = class(TProperty)
+    public
+      procedure AddToList(l: TValueListEditor);
+  end;
+
+  TSetProperty = class(TProperty)
+    public
+      procedure AddToList(l: TValueListEditor);
+      procedure ShowSetForm;
+      procedure ChangeValue(v: string);
+  end;
+
+  TClassProperty = class(TProperty)
+    protected
+      FValueObj: TObject;
+    public
+      constructor Create(name: string;value: TObject; obj: TObject);
+      procedure AddToList(l: TValueListEditor);
+      procedure ListProperties;
+  end;
+
+  TColorProperty = class(TProperty)
+    public
+      procedure AddToList(l: TValueListEditor);
+      procedure ShowColorForm;
+  end;
+
+  THistoryItem = class
+    public
+      function getPythonCode: string; virtual; abstract;
+      procedure Revert; virtual; abstract;
+  end;
+  THistoryItemProperty = class(THistoryItem)
+    public
+      FPropName: string;
+      FPropOldValue: Variant;
+      FPropNewValue: Variant;
+      FObject : TObject;
+      FControl: TControl;
+      FSubProp: string;
+
+      constructor Create(p: TProperty; newValue: Variant; subP: string; c: TControl);
+      function getPythonCode: string; override;
+      procedure Revert; override;
+  end;
+  THistoryItemControl = class(THistoryItem)
+    protected
+      FControl: TControl;
+    public
+      constructor Create(control: TControl);
+      function getPythonCode: string; override;
+      procedure Revert; override;
+  end;
+  THistoryItemForm = class(THistoryItem)
+    protected
+      FForm: TForm;
+    public
+      constructor Create(form: TForm);
+      function getPythonCode: string; override;
+      procedure Revert; override;
+  end;
+  THistoryItemTab = class(THistoryItem)
+    protected
+      FTabSheet: TSpTBXTabSheet;
+      FTabControl: TSpTBXTabControl;
+    public
+      constructor Create(tabSheet: TSpTBXTabSheet; tabControl: TSpTBXTabControl);
+      function getPythonCode: string; override;
+      procedure Revert; override;
+  end;
+
+  TCustomizeGUIForm = class(TForm)
+    ControlsPanel: TSpTBXPanel;
+    VDTControls: TVirtualStringTree;
+    VerticalSplitter: TSpTBXSplitter;
+    FormsPanel: TSpTBXPanel;
+    FormSelectionComboBox: TSpTBXComboBox;
+    RefreshFormListButton: TSpTBXButton;
+    PropertiesScrollBox: TTntScrollBox;
+    PropertiesListEditor: TValueListEditor;
+    SetValuesPopupMenu: TSpTBXFormPopupMenu;
+    TopMenu: TMainMenu;
+    File1: TMenuItem;
+    PickButton: TSpTBXButton;
+    Add1: TMenuItem;
+    Form1: TMenuItem;
+    abs1: TMenuItem;
+    ab1: TMenuItem;
+    Panel1: TMenuItem;
+    Control1: TMenuItem;
+    Move1: TMenuItem;
+    Delete1: TMenuItem;
+    Control2: TMenuItem;
+    InputBox1: TMenuItem;
+    Label1: TMenuItem;
+    CheckBox1: TMenuItem;
+    Radio1: TMenuItem;
+    Button1: TMenuItem;
+    ProgressBar1: TMenuItem;
+    rackBar1: TMenuItem;
+    Splitter1: TMenuItem;
+    GroupBox1: TMenuItem;
+    SpinEdit1: TMenuItem;
+    ComboBox1: TMenuItem;
+    ListBox1: TMenuItem;
+    CheckListBox1: TMenuItem;
+    Saveprofile1: TMenuItem;
+    Resetchanges1: TMenuItem;
+    ProfileTemplate: TMemo;
+    Save1: TMenuItem;
+    procedure Button1Click(Sender: TObject);
+    procedure VDTControlsGetText(Sender: TBaseVirtualTree;
+      Node: PVirtualNode; Column: TColumnIndex; TextType: TVSTTextType;
+      var CellText: WideString);
+    procedure FormCreate(Sender: TObject);
+    procedure RefreshFormListButtonClick(Sender: TObject);
+    procedure FormSelectionComboBoxChange(Sender: TObject);
+    procedure PropertiesListEditorEditButtonClick(Sender: TObject);
+    procedure VDTControlsClick(Sender: TObject);
+    procedure PropertiesListEditorStringsChange(Sender: TObject);
+    procedure CreateParams(var Params: TCreateParams); override;
+    procedure SetValuesPopupMenuClosePopup(Sender: TObject;
+      Selected: Boolean);
+    procedure PickButtonMouseUp(Sender: TObject; Button: TMouseButton;
+      Shift: TShiftState; X, Y: Integer);
+    procedure Form1Click(Sender: TObject);
+    procedure Move1Click(Sender: TObject);
+    procedure PageControl1Click(Sender: TObject);
+    procedure Panel1Click(Sender: TObject);
+    procedure Control2Click(Sender: TObject);
+    procedure abs1Click(Sender: TObject);
+    procedure ab1Click(Sender: TObject);
+    procedure Delete1Click(Sender: TObject);
+    procedure InputBox1Click(Sender: TObject);
+    procedure Label1Click(Sender: TObject);
+    procedure CheckBox1Click(Sender: TObject);
+    procedure Radio1Click(Sender: TObject);
+    procedure ProgressBar1Click(Sender: TObject);
+    procedure rackBar1Click(Sender: TObject);
+    procedure Splitter1Click(Sender: TObject);
+    procedure GroupBox1Click(Sender: TObject);
+    procedure SpinEdit1Click(Sender: TObject);
+    procedure ComboBox1Click(Sender: TObject);
+    procedure ListBox1Click(Sender: TObject);
+    procedure CheckListBox1Click(Sender: TObject);
+    procedure Saveprofile1Click(Sender: TObject);
+    procedure Resetchanges1Click(Sender: TObject);
+    procedure Save1Click(Sender: TObject);
+  protected
+    NodeList: TList;
+    NodeText: TStringList;
+    NodeControl: TList;
+    FormList: TList;
+    Properties: TList;
+    MovingControl: TControl;
+
+    subProp: string;
+    CurrentControl: TControl;
+  private
+    procedure AddControlAndSubControls(node: PVirtualNode; c: TWinControl);
+  public
+    history: TList;
+    newProfileCode: string;
+    
+    procedure ListAllFormControls(f: TForm);
+    procedure ListAllForms;
+    procedure ListObjectProperties(c: TObject);
+    procedure StartMoveControl;
+    procedure EndMoveControl;
+    procedure AddControl(className: string);
+    procedure AddToHistory(p: TProperty; newValue: Variant; subP: string; c: TControl; forceSave: boolean = false);
+  end;
+
+var
+  CustomizeGUIForm: TCustomizeGUIForm;
+
+implementation
+
+uses MainUnit, HelpUnit, Misc, SetValuesFormUnit;
+
+{$R *.dfm}
+
+procedure TCustomizeGUIForm.CreateParams(var Params: TCreateParams);
+begin
+  inherited CreateParams(Params);
+
+  with Params do
+  begin
+    ExStyle := ExStyle or WS_EX_APPWINDOW;
+    WndParent := GetDesktopWindow;
+  end;
+end;
+
+procedure TClassProperty.ListProperties;
+begin
+  if CustomizeGUIForm.subProp = '' then
+    CustomizeGUIForm.subProp := FName
+  else
+    CustomizeGUIForm.subProp := CustomizeGUIForm.subProp + '.' + FName;
+  CustomizeGUIForm.ListObjectProperties(FValueObj);
+end;
+
+constructor TClassProperty.Create(name: string;value: TObject; obj: TObject);
+begin
+  FName := name;
+  FObject := obj;
+  FValueObj := value;
+end;
+procedure TClassProperty.AddToList(l: TValueListEditor);
+begin
+  l.InsertRow(FName,FValueObj.ClassName,True);
+  with l.ItemProps[FName] do
+  begin
+    EditStyle := esEllipsis;
+    ReadOnly := True;
+  end;
+
+end;
+
+constructor TProperty.Create(name: string;value: Variant; obj: TObject);
+begin
+  FName := name;
+  FObject := obj;
+  FValue := value;
+end;
+
+procedure TProperty.AddToList(l: TValueListEditor);
+begin
+  l.InsertRow(FName,FValue,True);
+end;
+
+procedure TEnumerationProperty.AddToList(l: TValueListEditor);
+var
+  enumList: TStringList;
+begin
+  enumList := TStringList.Create;
+
+  Misc.GetEnumPropertyList(FObject,FName,enumList);
+
+  l.InsertRow(FName,FValue,True);
+  with l.ItemProps[FName] do
+  begin
+    EditStyle := esPickList;
+    ReadOnly := True;
+    PickList.Assign(enumList);
+  end;
+end;
+
+procedure TSetProperty.AddToList(l: TValueListEditor);
+var
+  enumList: TStringList;
+begin
+  enumList := TStringList.Create;
+
+  Misc.GetEnumPropertyList(FObject,FName,enumList);
+
+  l.InsertRow(FName,FValue,True);
+  with l.ItemProps[FName] do
+  begin
+    EditStyle := esEllipsis;
+    ReadOnly := True;
+  end;
+end;
+
+procedure TSetProperty.ShowSetForm;
+var
+  p: TPoint;
+  enumList: TStringList;
+  valuesList: TStringList;
+  i: integer;
+  s: TGridRect;
+begin
+  enumList := TStringList.Create;
+  valuesList := TStringList.Create;
+
+  Misc.GetEnumPropertyList(FObject,FName,enumList);
+  Misc.ParseDelimited(valuesList,FValue,',','');
+
+  if SetValuesForm.SetValues.Cells[0,0] &lt;&gt; '' then
+    for i:=SetValuesForm.SetValues.RowCount-1 downto 0 do
+      SetValuesForm.SetValues.DeleteRow(i);
+
+  for i:=0 to enumList.Count-1 do
+  begin
+    if valuesList.IndexOf(enumList[i]) &gt; -1 then
+      SetValuesForm.SetValues.InsertRow(enumList[i],'True',True)
+    else
+      SetValuesForm.SetValues.InsertRow(enumList[i],'False',True);
+
+    with SetValuesForm.SetValues.ItemProps[enumList[i]] do
+    begin
+      EditStyle := esPickList;
+      PickList.Add('True');
+      PickList.Add('False');
+      ReadOnly := True;
+    end;
+  end;
+
+  s.Left := 1;
+  s.Right := 1;
+  s.Top := 0;
+  s.Bottom := 0;
+  SetValuesForm.SetValues.Selection := s;
+  SetValuesForm.SetValues.Refresh;
+
+  SetValuesForm.SetValues.Row := 1;
+
+  SetValuesForm.DisplayedProperty := Self;
+  GetCursorPos(p);
+  CustomizeGUIForm.SetValuesPopupMenu.Popup(p.X,p.Y);
+end;
+
+procedure TSetProperty.ChangeValue(v: string);
+begin
+  CustomizeGUIForm.PropertiesListEditor.Values[FName] := v;
+end;
+
+procedure TColorProperty.AddToList(l: TValueListEditor);
+var
+  enumList: TStringList;
+begin
+  enumList := TStringList.Create;
+
+  Misc.GetEnumPropertyList(FObject,FName,enumList);
+
+  l.InsertRow(FName,FValue,True);
+  with l.ItemProps[FName] do
+  begin
+    EditStyle := esEllipsis;
+    ReadOnly := False;
+  end;
+end;
+
+procedure TColorProperty.ShowColorForm;
+begin
+  CustomizeGUIForm.PropertiesListEditor.Values[FName] := IntToStr(Misc.InputColor(FName,FValue));
+end;
+
+procedure TProperty.ValueChanged(v: Variant);
+begin
+  CustomizeGUIForm.AddToHistory(Self,v,CustomizeGUIForm.subProp,CustomizeGUIForm.CurrentControl);
+  FValue := v;
+  try
+    Misc.SetProperty(FObject,FName,FValue);
+  except
+  end;
+end;
+
+procedure TCustomizeGUIForm.ListObjectProperties(c: TObject);
+var
+  propNames: TStringList;
+  propValue: TList;
+  propTypes: TStringList;
+  enumTest: TStringList;
+  i: integer;
+  p: TProperty;
+  s: TGridRect;
+begin
+  Properties.Clear;
+  if PropertiesListEditor.Cells[0,0] &lt;&gt; '' then
+    for i:=PropertiesListEditor.RowCount-1 downto 0 do
+      PropertiesListEditor.DeleteRow(i);
+
+  propNames := TStringList.Create;
+  propValue := TList.Create;
+  propTypes := TStringList.Create;
+  enumTest := TStringList.Create;
+
+  Misc.GetProperties(c,propNames,propValue,propTypes);
+
+  for i:=0 to propNames.Count-1 do
+  begin
+    if propTypes[i] = 'tkEnumeration' then
+    begin
+      p := TEnumerationProperty.Create(propNames[i],Variant(propValue[i]^),c);
+      TEnumerationProperty(p).AddToList(PropertiesListEditor);
+    end
+    else if propTypes[i] = 'tkClass' then
+    begin
+      p := TClassProperty.Create(propNames[i],TObject(propValue[i]),c);
+      TClassProperty(p).AddToList(PropertiesListEditor);
+    end
+    else if propTypes[i] = 'tkSet' then
+    begin
+      p := TSetProperty.Create(propNames[i],Variant(propValue[i]^),c);
+      TSetProperty(p).AddToList(PropertiesListEditor);
+    end
+    else if propTypes[i] = 'TColor' then
+    begin
+      p := TColorProperty.Create(propNames[i],Variant(propValue[i]^),c);
+      TColorProperty(p).AddToList(PropertiesListEditor);
+    end
+    else
+    begin
+      p := TProperty.Create(propNames[i],Variant(propValue[i]^),c);
+      p.AddToList(PropertiesListEditor);
+    end;
+    Properties.Add(p);
+  end;
+
+  s.Left := 1;
+  s.Right := 1;
+  s.Top := 0;
+  s.Bottom := 0;
+  PropertiesListEditor.Selection := s;
+  PropertiesListEditor.Refresh;
+
+  if propNames.Count &gt; 1 then
+    PropertiesListEditor.Row := 1;
+end;
+
+procedure TCustomizeGUIForm.StartMoveControl;
+var
+  i: integer;
+begin
+  VDTControls.SetFocus;
+  if VDTControls.FocusedNode &lt;&gt; nil then
+  begin
+    i := NodeList.IndexOf(VDTControls.FocusedNode);
+    MovingControl := TControl(NodeControl[i]);
+
+    Move1.Checked := True;
+    File1.Enabled := False;
+    Control1.Enabled := False;
+    PropertiesScrollBox.Enabled := False;
+  end;
+end;
+
+procedure TCustomizeGUIForm.EndMoveControl;
+begin
+  Move1.Checked := False;
+  File1.Enabled := True;
+  Control1.Enabled := True;
+  PropertiesScrollBox.Enabled := True;
+end;
+
+procedure TCustomizeGUIForm.ListAllForms;
+var
+  i:integer;
+begin
+  FormList.Clear;
+  FormSelectionComboBox.Clear;
+  for i:=0 to Screen.FormCount-1 do
+  begin
+    FormSelectionComboBox.Items.Add(Screen.Forms[i].Name);
+    FormList.Add(Screen.Forms[i]);
+  end;
+end;
+
+procedure TCustomizeGUIForm.ListAllFormControls(f: TForm);
+begin
+  VDTControls.Clear;
+  NodeList.Clear;
+  NodeText.Clear;
+  NodeControl.Clear;
+  VDTControls.Expanded[VDTControls.RootNode] := True;
+  AddControlAndSubControls(VDTControls.RootNode,f);
+  VDTControls.Repaint;
+end;
+
+procedure TCustomizeGUIForm.AddControlAndSubControls(node: PVirtualNode; c: TWinControl);
+var
+  i: integer;
+  controlNode: PVirtualNode;
+  childNode: PVirtualNode;
+  gc : TGraphicControl;
+begin
+  if c.Name = '' then
+    Exit;
+  controlNode := VDTControls.AddChild(node);
+  NodeList.Add(controlNode);
+  NodeText.Add(c.Name);
+  NodeControl.Add(c);
+  controlNode.States := controlNode.States+[vsExpanded];
+
+  // add child controls
+  for i:=0 to c.ControlCount-1 do
+  begin
+    try
+      gc := c.Controls[i] as TGraphicControl;
+      childNode := VDTControls.AddChild(controlNode);
+      NodeList.Add(childNode);
+      childNode.States := childNode.States+[vsExpanded];
+      NodeText.Add(gc.Name);
+      NodeControl.Add(gc);
+    except
+    end;
+    try
+      AddControlAndSubControls(controlNode,c.Controls[i] as TWinControl);
+    except
+    end;
+  end;
+end;
+
+
+procedure TCustomizeGUIForm.Button1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXButton');
+end;
+
+procedure TCustomizeGUIForm.VDTControlsGetText(Sender: TBaseVirtualTree;
+  Node: PVirtualNode; Column: TColumnIndex; TextType: TVSTTextType;
+  var CellText: WideString);
+var
+  i: integer;
+begin
+  i := NodeList.IndexOf(Node);
+  CellText := NodeText[i];
+end;
+
+procedure TCustomizeGUIForm.FormCreate(Sender: TObject);
+begin
+  NodeList := TList.Create;
+  NodeText := TStringList.Create;
+  FormList := TList.Create;
+  Properties := TList.Create;
+  NodeControl := TList.Create;
+
+  history := TList.Create;
+end;
+
+procedure TCustomizeGUIForm.RefreshFormListButtonClick(Sender: TObject);
+begin
+  ListAllForms;
+  FormSelectionComboBox.ItemIndex := 0;
+  FormSelectionComboBoxChange(nil);
+end;
+
+procedure TCustomizeGUIForm.FormSelectionComboBoxChange(Sender: TObject);
+begin
+  ListAllFormControls(TForm(FormList[FormSelectionComboBox.ItemIndex]));
+end;
+
+procedure TCustomizeGUIForm.PropertiesListEditorEditButtonClick(
+  Sender: TObject);
+var
+  i:integer;
+begin
+  for i:=0 to Properties.Count-1 do
+    if (TProperty(Properties[i]).Name = PropertiesListEditor.Keys[PropertiesListEditor.Row]) then
+      if(TProperty(Properties[i]).ClassType = TClassProperty) then
+      begin
+        TClassProperty(Properties[i]).ListProperties;
+        Exit;
+      end
+      else if(TProperty(Properties[i]).ClassType = TSetProperty) then
+      begin
+        TSetProperty(Properties[i]).ShowSetForm;
+        Exit;
+      end
+      else if(TProperty(Properties[i]).ClassType = TColorProperty) then
+      begin
+        TColorProperty(Properties[i]).ShowColorForm;
+        Exit;
+      end;
+end;
+
+procedure TCustomizeGUIForm.VDTControlsClick(Sender: TObject);
+var
+  i,j:integer;
+  oldParent: TWinControl;
+
+  ts: TTabSheet;
+begin
+  if VDTControls.FocusedNode &lt;&gt; nil then
+  begin
+    i := NodeList.IndexOf(VDTControls.FocusedNode);
+    if Move1.Checked then
+    begin
+      oldParent := MovingControl.Parent;
+      try
+        MovingControl.Parent := TWinControl(NodeControl[i]);
+      except
+        EndMoveControl;
+      end;
+      ListAllFormControls(TForm(FormList[FormSelectionComboBox.ItemIndex]));
+      i := NodeControl.IndexOf(MovingControl);
+      VDTControls.Selected[NodeList[i]] := True;
+      VDTControls.FocusedNode := NodeList[i];
+      VDTControls.ScrollIntoView(PVirtualNode(NodeList[i]),False);
+      oldParent.Refresh;
+
+      // special case for pagecontrol
+      if oldParent.ClassType = TPageControl then
+      begin
+        ts := TPageControl(oldParent).ActivePage;
+        try
+          TPageControl(oldParent).ActivePage := TTabSheet(MovingControl);
+        except
+        end;
+        TTabSheet(MovingControl).TabVisible := False;
+        TPageControl(oldParent).ActivePage := ts;
+      end;
+
+      MovingControl.Refresh;
+      EndMoveControl;
+
+      for j:=0 to Properties.Count-1 do
+        if TProperty(Properties[j]).Name = 'Parent' then
+        begin
+          AddToHistory(TProperty(Properties[j]),GetStringFromComponent(MovingControl.Parent),'',CurrentControl);
+          TProperty(Properties[j]).FValue := GetStringFromComponent(MovingControl.Parent);
+        end;
+    end
+    else
+    begin
+      ListObjectProperties(TControl(NodeControl[i]));
+      Properties.Add(TProperty.Create('Parent',GetStringFromComponent(TControl(NodeControl[i]).Parent),TControl(NodeControl[i])));
+      subProp := '';
+      CurrentControl := TControl(NodeControl[i]);
+    end;
+  end;
+end;
+
+procedure TCustomizeGUIForm.PropertiesListEditorStringsChange(
+  Sender: TObject);
+var
+  i: integer;
+begin
+  for i:=0 to Properties.Count-1 do
+    if TProperty(Properties[i]).Name = PropertiesListEditor.Keys[PropertiesListEditor.Row] then
+    begin
+      if TProperty(Properties[i]).ClassType &lt;&gt; TClassProperty then
+        TProperty(Properties[i]).Value := PropertiesListEditor.Values[TProperty(Properties[i]).Name];
+    end;
+end;
+
+procedure TCustomizeGUIForm.SetValuesPopupMenuClosePopup(Sender: TObject;
+  Selected: Boolean);
+begin
+  SetValuesForm.DisplayedProperty := nil;
+end;
+
+procedure TCustomizeGUIForm.PickButtonMouseUp(Sender: TObject;
+  Button: TMouseButton; Shift: TShiftState; X, Y: Integer);
+var
+  i: integer;
+  p: TPoint;
+  pScreen: TPoint;
+  c,cTmp: TWinControl;
+begin
+  p.X := X;
+  p.Y := Y;
+  pScreen := (Sender as TSpTBXButton).ClientToScreen(p);
+  p := TForm(FormList[FormSelectionComboBox.ItemIndex]).ScreenToClient(pScreen);
+  try
+    cTmp := TForm(FormList[FormSelectionComboBox.ItemIndex]).ControlAtPos(p,True,True) as TWinControl;
+  except
+    cTmp := nil;
+  end;
+  while cTmp &lt;&gt; nil do
+  begin
+    c := cTmp;
+    try
+      cTmp := c.ControlAtPos(c.ScreenToClient(pScreen),True,True) as TWinControl;
+    except
+      cTmp := nil;
+    end;
+  end;
+
+  i := NodeControl.IndexOf(c);
+  if i &gt; -1 then
+  begin
+    VDTControls.SetFocus;
+    VDTControls.Selected[NodeList[i]] := True;
+    VDTControls.FocusedNode := NodeList[i];
+    VDTControls.ScrollIntoView(NodeList[i],False);
+    VDTControlsClick(nil);
+  end;
+end;
+
+procedure TCustomizeGUIForm.Form1Click(Sender: TObject);
+var
+  p: TScriptForm;
+begin
+  p := TScriptForm.CreateNew(Application);
+  p.Name := InputBox('Add form','Control name:','');
+  p.Caption := 'Empty form';
+  p.BorderStyle := bsSizeable;
+  p.Show;
+  ListAllForms;
+  FormSelectionComboBox.ItemIndex := FormSelectionComboBox.Items.IndexOf(p.Name);
+  FormSelectionComboBoxChange(nil);
+  history.Add(THistoryItemForm.Create(p));
+end;
+
+procedure TCustomizeGUIForm.Move1Click(Sender: TObject);
+begin
+  StartMoveControl;
+end;
+
+procedure TCustomizeGUIForm.PageControl1Click(Sender: TObject);
+var
+  p: TPageControl;
+  i: integer;
+begin
+  i := NodeList.IndexOf(VDTControls.FocusedNode);
+  if i &gt; -1 then
+  begin
+    p := TPageControl.Create(TControl(NodeControl[i]));
+    p.Parent := TWinControl(NodeControl[i]);
+    p.Name := InputBox('Add PageControl','Control name:','');
+
+    ListAllFormControls(TForm(FormList[FormSelectionComboBox.ItemIndex]));
+    i := NodeControl.IndexOf(p);
+    VDTControls.Selected[NodeList[i]] := True;
+    VDTControls.FocusedNode := NodeList[i];
+    VDTControls.ScrollIntoView(PVirtualNode(NodeList[i]),False);
+  end;
+end;
+
+procedure TCustomizeGUIForm.Panel1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXPanel');
+end;
+
+procedure TCustomizeGUIForm.Control2Click(Sender: TObject);
+begin
+  AddControl(InputBox('Add control','Control class name :',''));
+end;
+
+procedure TCustomizeGUIForm.AddControl(className: string);
+var
+  classV: TPersistentClass;
+  p: TWinControl;
+  i: integer;
+  n: string;
+begin
+
+  i := NodeList.IndexOf(VDTControls.FocusedNode);
+  if i &gt; -1 then
+  begin
+    try
+      n := InputBox('Add Panel','Control name:','');
+      if n = '' then Exit;
+      classV := GetClass(className);
+      p := TWinControlClass(classV).Create(TControl(NodeControl[i]));
+      p.Parent := TWinControl(NodeControl[i]);
+      p.Name := n;
+
+      ListAllFormControls(TForm(FormList[FormSelectionComboBox.ItemIndex]));
+      i := NodeControl.IndexOf(p);
+      VDTControls.Selected[NodeList[i]] := True;
+      VDTControls.FocusedNode := NodeList[i];
+      VDTControls.ScrollIntoView(PVirtualNode(NodeList[i]),False);
+      VDTControlsClick(nil);
+
+      history.Add(THistoryItemControl.Create(p));
+    except
+      MessageDlg('Incorrect class name!',mtError,[mbOk],0);
+    end;
+  end;
+end;
+
+procedure TCustomizeGUIForm.abs1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXTabControl');
+end;
+
+procedure TCustomizeGUIForm.ab1Click(Sender: TObject);
+var
+  classV: TPersistentClass;
+  p: TWinControl;
+  i,j: integer;
+  cname: string;
+  control: TControl;
+begin
+  i := NodeList.IndexOf(VDTControls.FocusedNode);
+  if i &gt; -1 then
+  begin
+    control := TControl(NodeControl[i]);
+    if control.ClassType &lt;&gt; TSpTBXTabControl then
+    begin
+      MessageDlg('You must select a TSpTBXTabControl first!',mtError,[mbOk],0);
+      Exit;
+    end;
+    TSpTBXTabControl(control).Add('Empty tab');
+    cname := InputBox('Add tab','Tab name :','');
+    if cname = '' then Exit;
+    TSpTBXTabControl(control).Pages[TSpTBXTabControl(control).PagesCount-1].Name := cname;
+
+    ListAllFormControls(TForm(FormList[FormSelectionComboBox.ItemIndex]));
+    j := NodeControl.IndexOf(TSpTBXTabControl(control).Pages[TSpTBXTabControl(control).PagesCount-1]);
+    VDTControls.Selected[NodeList[j]] := True;
+    VDTControls.FocusedNode := NodeList[j];
+    VDTControls.ScrollIntoView(PVirtualNode(NodeList[j]),False);
+    VDTControlsClick(nil);
+    history.Add(THistoryItemTab.Create(TSpTBXTabControl(control).Pages[TSpTBXTabControl(control).PagesCount-1],TSpTBXTabControl(control)));
+  end;
+end;
+
+procedure TCustomizeGUIForm.Delete1Click(Sender: TObject);
+var
+  i: integer;
+begin
+  if VDTControls.FocusedNode &lt;&gt; nil then
+  begin
+    i := NodeList.IndexOf(VDTControls.FocusedNode);
+    if TControl(NodeControl[i]).ClassType = TSpTBXTabSheet then
+      TSpTBXTabSheet(NodeControl[i]).Item.Destroy;
+    TControl(NodeControl[i]).Destroy;
+
+    ListAllFormControls(TForm(FormList[FormSelectionComboBox.ItemIndex]));
+  end;
+end;
+
+procedure TCustomizeGUIForm.InputBox1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXEdit');
+end;
+
+procedure TCustomizeGUIForm.Label1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXLabel');
+end;
+
+procedure TCustomizeGUIForm.CheckBox1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXCheckBox');
+end;
+
+procedure TCustomizeGUIForm.Radio1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXRadioButton');
+end;
+
+procedure TCustomizeGUIForm.ProgressBar1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXProgressBar');
+end;
+
+procedure TCustomizeGUIForm.rackBar1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXTrackBar');
+end;
+
+procedure TCustomizeGUIForm.Splitter1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXSplitter');
+end;
+
+procedure TCustomizeGUIForm.GroupBox1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXGroupBox');
+end;
+
+procedure TCustomizeGUIForm.SpinEdit1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXSpinEdit');
+end;
+
+procedure TCustomizeGUIForm.ComboBox1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXComboBox');
+end;
+
+procedure TCustomizeGUIForm.ListBox1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXListBox');
+end;
+
+procedure TCustomizeGUIForm.CheckListBox1Click(Sender: TObject);
+begin
+  AddControl('TSpTBXCheckListBox'); 
+end;
+
+procedure TCustomizeGUIForm.Saveprofile1Click(Sender: TObject);
+var
+  i: integer;
+begin
+  newProfileCode := '';
+  for i:=0 to history.Count-1 do
+    newProfileCode := newProfileCode + THistoryItem(history[i]).getPythonCode + EOL;
+
+  for i:=history.Count-1 downto 0 do
+  begin
+    THistoryItem(history[i]).Revert;
+    THistoryItem(history[i]).Free;
+  end;
+  history.Clear;
+
+  if CurrentControl &lt;&gt; nil then
+    ListObjectProperties(CurrentControl);
+
+  Save1.Enabled := True;
+  Saveprofile1.Enabled := False;
+
+  MessageDlg('Layout has been unloaded, save the profile when you will have restored de default layout properly.',mtInformation,[mbOk],0);
+end;
+
+procedure TCustomizeGUIForm.AddToHistory(p: TProperty; newValue: Variant; subP: string; c: TControl; forceSave: boolean = false);
+var
+  i: integer;
+  prop: TProperty;
+begin
+  try
+    if (p.FValue &lt;&gt; newValue) or forceSave then
+    begin
+      if p.FName &lt;&gt; 'Align' then
+          for i:=0 to history.Count-1 do // to avoid saving multiple changes for properties (except for the align, because align order matters)
+            if (THistoryItemProperty(history[i]).FObject = p.FObject) and (THistoryItemProperty(history[i]).FPropName = p.FName) then
+            begin
+              history.Delete(i);
+              break;
+            end;
+      if p.FName = 'Align' then
+      begin
+        for i:=0 to Properties.Count-1 do
+        begin
+          prop := TProperty(Properties[i]);
+          if TProperty(Properties[i]).FName = 'Top' then
+            AddToHistory(prop,prop.FValue,subP,c,True);
+          if TProperty(Properties[i]).FName = 'Left' then
+            AddToHistory(prop,prop.FValue,subP,c,True);
+          if TProperty(Properties[i]).FName = 'Width' then
+            AddToHistory(prop,prop.FValue,subP,c,True);
+          if TProperty(Properties[i]).FName = 'Height' then
+            AddToHistory(prop,prop.FValue,subP,c,True);
+        end;
+      end;
+      history.Add(THistoryItemProperty.Create(p,newValue,subP,c));
+    end;
+  except
+  end;
+end;
+
+constructor THistoryItemProperty.Create(p: TProperty; newValue: Variant; subP: string; c: TControl);
+begin
+  Self.FPropName := p.Name;
+  Self.FPropOldValue := p.Value;
+  Self.FPropNewValue := newValue;
+  Self.FControl := c;
+  Self.FObject := p.FObject;
+  Self.FSubProp := subP;
+end;
+
+function THistoryItemProperty.getPythonCode: string;
+begin
+  Result := #9+'changeControlProp(&quot;'+GetStringFromComponent(TControl(Self.FControl))+'&quot;,&quot;'+Self.FSubProp+'&quot;,&quot;'+Self.FPropName+'&quot;,&quot;'+String(Self.FPropNewValue)+'&quot;)';
+end;
+
+constructor THistoryItemControl.Create(control: TControl);
+begin
+  FControl := control;
+end;
+
+function THistoryItemControl.getPythonCode: string;
+var
+  ownerPath: string;
+  controlPath: string;
+begin
+  ownerPath := GetStringFromComponent(Self.FControl.Owner);
+  controlPath := GetStringFromComponent(FControl);
+  Result := #9+'gui.AddControl(&quot;'+Self.FControl.Name+'&quot;,&quot;'+ownerPath+'&quot;,&quot;'+Self.FControl.ClassName+'&quot;)';
+  Result := Result + EOL + #9 + 'newControlList.append(&quot;'+controlPath+'&quot;)';
+end;
+
+constructor THistoryItemForm.Create(form: TForm);
+begin
+  FForm := form;
+end;
+
+function THistoryItemForm.getPythonCode: string;
+begin
+  Result := #9+'gui.AddForm(&quot;'+Self.FForm.Name+'&quot;,&quot;EmptyForm&quot;,2)';
+  Result := Result + EOL + #9 + 'newControlList.append(&quot;'+Self.FForm.Name+'&quot;)';
+end;
+
+constructor THistoryItemTab.Create(tabSheet: TSpTBXTabSheet; tabControl: TSpTBXTabControl);
+begin
+  FTabSheet := tabSheet;
+  FTabControl := tabControl;
+end;
+
+function THistoryItemTab.getPythonCode: string;
+begin
+  Result := #9+'gui.AddTab(&quot;New tab&quot;,&quot;'+Self.FTabSheet.Name+'&quot;,&quot;'+GetStringFromComponent(Self.FTabControl)+'&quot;)';
+  Result := Result + EOL + #9 + 'newControlList.append(&quot;'+GetStringFromComponent(Self.FTabSheet)+'&quot;)';
+end;
+
+procedure THistoryItemProperty.Revert;
+begin
+  if FPropName = 'Parent' then
+    TControl(Self.FObject).Parent :=  GetComponentFromString(Self.FPropOldValue) as TWinControl
+  else
+    try
+      Misc.SetProperty(Self.FObject,Self.FPropName,Self.FPropOldValue);
+    except
+    end;
+end;
+
+procedure THistoryItemTab.Revert;
+begin
+  try
+    FTabSheet.Item.Destroy;
+  except
+  end;
+end;
+
+procedure THistoryItemForm.Revert;
+begin
+  FForm.Destroy;
+end;
+
+procedure THistoryItemControl.Revert;
+begin
+  FControl.Destroy;
+end;
+
+procedure TCustomizeGUIForm.Resetchanges1Click(Sender: TObject);
+var
+  i: integer;
+begin
+  for i:=history.Count-1 downto 0 do
+  begin
+    THistoryItem(history[i]).Revert;
+    THistoryItem(history[i]).Free;
+  end;
+  history.Clear;
+  if CurrentControl &lt;&gt; nil then
+    ListObjectProperties(CurrentControl);
+end;
+
+procedure TCustomizeGUIForm.Save1Click(Sender: TObject);
+var
+  fileName: string;
+  f: TextFile;
+  loadProfileCode,profileCode: String;
+  i: integer;
+begin
+  fileName := InputBox('Save profile','Profile name :','');
+  if filename = '' then
+    Exit;
+
+  profileCode := StringReplace(ProfileTemplate.Text,'${loadProfileContent}',newProfileCode,[]);
+
+  loadProfileCode := '';
+  for i:=0 to history.Count-1 do
+    loadProfileCode := loadProfileCode + THistoryItem(history[i]).getPythonCode + EOL;
+
+  profileCode := StringReplace(profileCode,'${unloadProfileContent}',loadProfileCode,[]);
+
+  AssignFile(f, ExtractFilePath(Application.ExeName) + SCRIPTS_PROFILES_FOLDER + '\' + fileName + '.py');
+  Rewrite(f);
+  Write(f, profileCode);
+  CloseFile(f);
+
+  Save1.Enabled := False;
+  Saveprofile1.Enabled := True;
+  history.Clear;
+end;
+
+end.

Modified: Lobby/TASClient/HelpUnit.dfm
===================================================================
--- Lobby/TASClient/HelpUnit.dfm	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/HelpUnit.dfm	2008-10-22 18:44:31 UTC (rev 6853)
@@ -1,6 +1,6 @@
 object HelpForm: THelpForm
-  Left = 902
-  Top = 193
+  Left = 959
+  Top = 409
   BorderStyle = bsDialog
   Caption = 'Help'
   ClientHeight = 474
@@ -35,17 +35,17 @@
       Width = 601
       Height = 401
       Color = clBtnFace
-      ActiveTabIndex = 2
+      ActiveTabIndex = 0
       HiddenItems = &lt;&gt;
       object SpTBXTabItem3: TSpTBXTabItem
         Caption = 'Page 1'
+        Checked = True
       end
       object SpTBXTabItem2: TSpTBXTabItem
         Caption = 'Page 2'
       end
       object SpTBXTabItem1: TSpTBXTabItem
         Caption = 'Page 3'
-        Checked = True
       end
       object SpTBXTabItem4: TSpTBXTabItem
         Caption = 'Page 4'
@@ -293,6 +293,872 @@
           LinkFont.Style = [fsUnderline]
         end
       end
+      object SpTBXTabSheet2: TSpTBXTabSheet
+        Left = 0
+        Top = 23
+        Width = 601
+        Height = 378
+        Caption = 'Page 2'
+        ImageIndex = -1
+        TabItem = 'SpTBXTabItem2'
+        object Image5: TImage
+          Left = 32
+          Top = 144
+          Width = 23
+          Height = 112
+          AutoSize = True
+          Picture.Data = {
+            07544269746D6170B61F0000424DB61F00000000000036000000280000001700
+            0000700000000100180000000000801F0000120B0000120B0000000000000000
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFF959595FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFF0F0F0585858FFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFF8080808C8C8CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFF8181814242
+            42A8A8A8FFFFFFFFFFFFFFFFFF656565606060FFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFB1B1B1616161575757757575FFFFFF7070708F8F8F868686FFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFF7676766868683A3A3A575757878787969696
+            868686FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF8F8F8F6C6C6C60606065
+            6565A5A5A58B8B8B8E8E8EFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF6C6C
+            6C8E8E8E6C6C6C8A8A8A8B8B8B7171718A8A8AFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            8B8B8B5151516666669A9A9A9D9D9D9D9D9D646464737373646464808080FFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFACACAC8A8A8AB6B6B6E6E6E6E7E7E7BBBBBBD1D1D1DCDCDCA7A7A7
+            7474746C6C6C7A7A7AFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFF8F8F8F3F3F3CFCFCFA6A6A6C8
+            C8C8F5F5F5F8F8F8F8F8F8D6D6D6A9A9A98E8E8EFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFEEEEEEC7C7C7979797818181FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFD7D7D79E9E9E9D9D9DFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDCDCDC999999FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1F1F1B1
+            B1B1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFC6C6C6FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFF02A8DE008BD806B1E105B5E3029EDD01A6DE009EDB
+            0081D50076D272CEE9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFF31C6E719C3E96CE6F543DEF360E3F467
+            E5F551DFF342DCF251E2F3008DDAFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF61CEE953DFF27CEA
+            F86EE5F542D8EFABF2FA8CEAF769E7F6BFF5FC025EC500A2DDFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            09B5E364E5F508A3E009B3E20FBAE862E5F513BAE70CB3E204AFE30FBEE8029F
+            DBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFF05B1E269E6F50CBBE3FFFFFF72D0E90BB7E358CAE8FFFFFF
+            FFFFFF0073D203A3DEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFF72CCE969E9F63FC6E6FFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFF72CDE81DC9EB05AAE0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF72D0E913BFE8039F
+            DEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF05B1E2008ED88CD0EAFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFF8CD2E909AEE30069CFFFFFFFFFFFFFFFFFFF005DCB04A5DDFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFF22C7E80262C80083D503AAE0003CAE004AC7
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0069CE20CCEA16
+            CAE81BC5E696C2E6FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF01A7
+            DE0053AC10BEE436D9F164E3F33FAFE0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            0BC0E5004DCB0265CC24CEEC57E0F270EBF75CE3F4089FDD0693D831BBE3FFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFF0CBAE40FBEE408B2E10EB6E207A2DE57E3F342C3E805A0DB
+            04A2DD06A5DD0EBEE5FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF03ACE109
+            A3DF96CFE9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFF0EC2E6008FD8FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFF87D2EA0DBEE5FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFD9CCCBCEB4B4E3D5D2E3DBDFDA
+            C4C4D6CBCBD4C2BFC7ACA9C1A5A2FCF8F8FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFF3ECECD9C6CCD2B5
+            B7BDA0A5CDAEADD0B2B5C5A5A7BC9C9EC5ABAACDAAAEFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            F9F7F7C6A3A0D9C2C7D3B4B6BC9390E9D7DEDFC1C3D1B8BBEFE1EA845B57CFBE
+            BDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFE5D5D8CFB4B2BD9EA0E5D2D2D0BABFCEB2B2D4BABBEAD2D0
+            DACED5D1BEC0D6BCB7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFDCCFD3D1B6B5EBDBD8FFFFFFFBF9FAE8
+            D7D8F8F0F0FFFFFFFFFFFFBC9794D7C0BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFBF3F5D1BEBEF5EA
+            E9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBF5F2DCCFD2DDC8C5FFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FBFAFBD4BFC2D7BCBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDCCFD2C8ABA7FEFA
+            FEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFEFCFCC2ABA9B2908CFFFFFFFFFFFFFFFFFFAD8981
+            DBC1BDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFF1EDF08B615CC1A29ED8
+            C8C68B5A51B48179FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFB1908BA0797694756E9B6B65FFE6E5FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFD0C4C46D3D35895F5DB4969ACFADA8F5CEC9FFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFE8E2E1A58283906763A47D7EC8A6A4D4C4C2CBADABBD9995
+            DFB0AAF3DBD9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFEAD9DBEEE0DEE3D0CDECD6D1B99D99C8
+            AEAAECC6C1DCBDB7DBBEBADFC1BAECE0DFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFD7CACCC39E9CFFF8FAFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFEDE6E6CEADA9FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDFBFBE3D5D5FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF9D87
+            873D3434073232073A3A3432328A7070FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFAFA00000000B3B300FFFF03D6D602D4D400FFFF00D1D1000000FCF3F3FFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFF37333300FFFF047B7B000000000000000000000000065858
+            00FFFF1D2424FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFF1F8080005C5C00000000000000000000
+            00000000000000000362621D8584FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF274F5000FFFF033F
+            3F00000000000000000000000006666700FFFF1C3838FFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            253A3A021A1A02FAFA06AAA901000000000004D1D104F3F40119191B4949FFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFF23565600FFFF021B1B02B5B501D1D103D0D004B5B5062828
+            00FFFF183434FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFF2F4646000C0C01FFFF055455068C8C05
+            8989044E4E04FFFF0213131A5757FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF37626300FFFF040D
+            0E03FFFF04656604343402FFFF04000000FFFF205151FFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FEEEEE003A3A00FFFF04101003FFFF02FFFF04090800FFFF1D3E3EFFFCFCFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFF5F501383900FFFF04181806181800FFFF033839
+            FFF3F3FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFEE7E7006A6A01D3D301
+            A0A0008181FFE7E7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFBC9B9B00C7C800E8E8977878FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFF1F3B3B134040FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC6C1C1B0A9A9FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            4C4242F8E8E8FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8E7E7514949FFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFF005D5D008181886B6BFFFFFFFFFFFFFFFFFFFFFFFF876C6C
+            008A8A116666FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFF00000003C0C100EBEB372E2EFFFFFFFF
+            FFFF32323200F2F201AFAF140000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF035D5D026B6B0341
+            4100FFFF272F2F253D3D00FFFF023737037778086464FFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            02000005C8C806BDBD000F0F00FFFF00FFFF020A0A02CACA05C3C3010000FFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFF005A5A05444401929203BABA02202003171704E7E7008383
+            075656005758FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFF48474700FAFA065D5D008C8C07AEAE01
+            BDBC02818102636300F8F84B4747FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFF543A3A00FD
+            FD043C3B02AFAF02ADAD034A4A00F3F3675151FFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFF3C323200FFFF03040503141400FFFF4C3636FFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF08414100F5F500F6F60C3A3BFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD7BABA00ADAD00
+            9292DEC3C3FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFF3853533D4C4CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFCDC9C9D3D0D0FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFF443D3DD7CDCDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            E3D9D9312727FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFF1D6666003637886E6EFFFFFFFFFFFFFF
+            FFFFFFFFFF8C7373003131177171FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF19161600F7F70083
+            83482B2BFFFFFFFFFFFF4C2D2D007A7A00FFFF111111FFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            20656600191A00C5C5008989583A3A6A4A4A009A9A02D5D5001D1D0B6162FFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFF394C4C00FFFF04282800C5C5007C7C00737300D3D3031818
+            00FFFF223B3BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFF21222200FFFF03141400DADA00
+            F0F0040B0B00FFFF233535FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF1D31
+            3100FFFF01000002010100FFFF142929FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFF4F400545400D8D800C9C9005F5FFFEDECFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB9999900C5C500CCCCA88787FFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF23545418
+            4444FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFBAB4B4AFA9A9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFECEBEBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF0000009B8C8CFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF928282000000FFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            066868007878664545FFFFFFFFFFFFFFFFFFFFFFFF5F4040008787005454FFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFF84737300C0C000A2A2604343FFFFFFFFFFFF52333300A3A3
+            00C4C4827070FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFF97757500C0C000808081676793
+            7777008A8B00BABAA08181FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF8464
+            6400EBEB003839003E3E00ECEC856262FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFF3C3E3E00FFFF00FFFF3F3C3CFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2F2007171005C5DFFFAFAFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF736E6E76
+            7171FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFF8F7F7F7F7F7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
+            0000}
+          Transparent = True
+        end
+        object Label30: TSpTBXLabel
+          Left = 32
+          Top = 32
+          Width = 130
+          Height = 13
+          Caption = 'Battle player count: &quot;x+y/z&quot;'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label31: TSpTBXLabel
+          Left = 40
+          Top = 56
+          Width = 143
+          Height = 13
+          Caption = 'x = non-spectator player count'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label32: TSpTBXLabel
+          Left = 40
+          Top = 72
+          Width = 91
+          Height = 13
+          Caption = 'y = spectator count'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label33: TSpTBXLabel
+          Left = 40
+          Top = 88
+          Width = 168
+          Height = 13
+          Caption = 'z = max. non-spectator player count'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label40: TSpTBXLabel
+          Left = 32
+          Top = 120
+          Width = 69
+          Height = 13
+          Caption = 'Rank symbols:'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label35: TSpTBXLabel
+          Left = 56
+          Top = 144
+          Width = 36
+          Height = 13
+          Caption = 'Newbie'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label36: TSpTBXLabel
+          Left = 56
+          Top = 160
+          Width = 42
+          Height = 13
+          Caption = 'Beginner'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label37: TSpTBXLabel
+          Left = 56
+          Top = 176
+          Width = 40
+          Height = 13
+          Caption = 'Average'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label38: TSpTBXLabel
+          Left = 56
+          Top = 209
+          Width = 59
+          Height = 13
+          Caption = 'Experienced'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label39: TSpTBXLabel
+          Left = 56
+          Top = 226
+          Width = 90
+          Height = 13
+          Caption = 'Highly experienced'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label58: TSpTBXLabel
+          Left = 32
+          Top = 264
+          Width = 241
+          Height = 97
+          Caption = 
+            'Tip: Hold down SHIFT while dragging over the small minimap when ' +
+            'hosting a game to set start rectangles. Press 0...9 to change hi' +
+            'ghlighted rectangle'#39's ally number, and DELETE to remove it. To s' +
+            'et the starting rectangles automatically, right-click on the min' +
+            'imap and select this option. To move a box hold down CTRL and dr' +
+            'ag it.'
+          AutoSize = False
+          Wrapping = twWrap
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label50: TSpTBXLabel
+          Left = 288
+          Top = 216
+          Width = 281
+          Height = 89
+          Caption = 
+            'Rank does not tell how &quot;good&quot; a player is, but rather how experi' +
+            'enced he is (more time you spent playing spring, more experience' +
+            'd you are). Its function is to give you an estimate of how exper' +
+            'ienced the player is, so that you can choose to play against pla' +
+            'yers that are at the same level as you.'
+          AutoSize = False
+          Wrapping = twWrap
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label45: TSpTBXLabel
+          Left = 288
+          Top = 104
+          Width = 70
+          Height = 13
+          Caption = '&lt; 5 h = newbie'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label46: TSpTBXLabel
+          Left = 288
+          Top = 120
+          Width = 89
+          Height = 13
+          Caption = '5 - 15 h = beginner'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label47: TSpTBXLabel
+          Left = 288
+          Top = 136
+          Width = 93
+          Height = 13
+          Caption = '15 - 30 h = average'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label48: TSpTBXLabel
+          Left = 288
+          Top = 152
+          Width = 132
+          Height = 13
+          Caption = '30 - 100 h = above average'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label49: TSpTBXLabel
+          Left = 288
+          Top = 168
+          Width = 124
+          Height = 13
+          Caption = '100 - 300 h = experienced'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label42: TSpTBXLabel
+          Left = 288
+          Top = 56
+          Width = 281
+          Height = 41
+          Caption = 
+            'The server remembers how much time a player has spent in-game. B' +
+            'ased on that time it determines the player'#39's rank:'
+          AutoSize = False
+          Wrapping = twWrap
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object Label41: TSpTBXLabel
+          Left = 288
+          Top = 32
+          Width = 160
+          Height = 13
+          Caption = 'This is how ranking system works:'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object SpTBXLabel6: TSpTBXLabel
+          Left = 56
+          Top = 193
+          Width = 73
+          Height = 13
+          Caption = 'Above average'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object SpTBXLabel7: TSpTBXLabel
+          Left = 56
+          Top = 242
+          Width = 37
+          Height = 13
+          Caption = 'Veteran'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object SpTBXLabel8: TSpTBXLabel
+          Left = 288
+          Top = 184
+          Width = 157
+          Height = 13
+          Caption = '300- 1000 h = highly experienced'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object SpTBXLabel9: TSpTBXLabel
+          Left = 288
+          Top = 200
+          Width = 90
+          Height = 13
+          Caption = '&gt; 1000 h = veteran'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+      end
+      object SpTBXTabSheet1: TSpTBXTabSheet
+        Left = 0
+        Top = 23
+        Width = 601
+        Height = 378
+        Caption = 'Page 3'
+        ImageIndex = -1
+        TabItem = 'SpTBXTabItem1'
+        object TntScrollBox1: TTntScrollBox
+          Left = 8
+          Top = 6
+          Width = 585
+          Height = 363
+          VertScrollBar.Smooth = True
+          BorderStyle = bsNone
+          TabOrder = 0
+          object Label52: TLabel
+            Left = 0
+            Top = 341
+            Width = 408
+            Height = 13
+            Caption = 
+              '* /forceupdate /forcebetaupdate will force the lobby update even' +
+              ' if it seems up to date'
+          end
+          object Label53: TLabel
+            Left = 0
+            Top = 360
+            Width = 122
+            Height = 13
+            Caption = '* /help  will show this help'
+          end
+          object Label54: TLabel
+            Left = 0
+            Top = 376
+            Width = 180
+            Height = 13
+            Caption = '* /uptime will tell you the server uptime'
+          end
+          object Label55: TLabel
+            Left = 0
+            Top = 392
+            Width = 292
+            Height = 13
+            Caption = 
+              '* /version will tell you the TASClient lobby version and revisio' +
+              'n'
+          end
+          object Label18: TSpTBXLabel
+            Left = 0
+            Top = 0
+            Width = 52
+            Height = 13
+            Caption = 'Useful tips:'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label19: TSpTBXLabel
+            Left = 0
+            Top = 16
+            Width = 259
+            Height = 13
+            Caption = '* Right-click on a channel or private chat tab to close it'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label20: TSpTBXLabel
+            Left = 0
+            Top = 32
+            Width = 318
+            Height = 13
+            Caption = 
+              '* Double on the player to open private chat (in the list or in t' +
+              'he chat)'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label21: TSpTBXLabel
+            Left = 0
+            Top = 48
+            Width = 233
+            Height = 13
+            Caption = '* Double-click or click on Join button to join battle'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label34: TSpTBXLabel
+            Left = 0
+            Top = 64
+            Width = 203
+            Height = 13
+            Caption = '* Double-click on bot to change his options'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label22: TSpTBXLabel
+            Left = 0
+            Top = 80
+            Width = 215
+            Height = 13
+            Caption = '* Click on minimap to view fixed start positions'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label23: TSpTBXLabel
+            Left = 0
+            Top = 96
+            Width = 334
+            Height = 13
+            Caption = 
+              '* Right click on the minimap to get options like auto boxes or k' +
+              'eep ratio'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label24: TSpTBXLabel
+            Left = 0
+            Top = 128
+            Width = 87
+            Height = 13
+            Caption = 'Useful commands:'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label25: TSpTBXLabel
+            Left = 0
+            Top = 152
+            Width = 154
+            Height = 13
+            Caption = '* /me to talk in &quot;/me&quot; mIRC style'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label26: TSpTBXLabel
+            Left = 0
+            Top = 168
+            Width = 211
+            Height = 13
+            Caption = '* /join or /j (+channel'#39's name) to join channel'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label27: TSpTBXLabel
+            Left = 0
+            Top = 184
+            Width = 283
+            Height = 13
+            Caption = '* /part or /p to close current channel or private chat window'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label28: TSpTBXLabel
+            Left = 0
+            Top = 200
+            Width = 246
+            Height = 13
+            Caption = '* /channels or /list to receive a list of open channels'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label67: TSpTBXLabel
+            Left = 0
+            Top = 216
+            Width = 283
+            Height = 13
+            Caption = '* /rename &lt;new name&gt; to change your account'#39's username'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object SpTBXLabel1: TSpTBXLabel
+            Left = 0
+            Top = 232
+            Width = 334
+            Height = 13
+            Caption = 
+              '* /password &lt;oldpass&gt; &lt;newpass&gt; will change your account passwor' +
+              'd'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label68: TSpTBXLabel
+            Left = 0
+            Top = 248
+            Width = 202
+            Height = 13
+            Caption = '* /ring while hosting a battle to call a player'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label44: TSpTBXLabel
+            Left = 0
+            Top = 264
+            Width = 283
+            Height = 13
+            Caption = '* /ping will tell you the lag between you and the lobby server'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label69: TSpTBXLabel
+            Left = 0
+            Top = 280
+            Width = 242
+            Height = 13
+            Caption = '* /msg &lt;user&gt; {message} will send message to user'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label70: TSpTBXLabel
+            Left = 0
+            Top = 296
+            Width = 295
+            Height = 13
+            Caption = 
+              '* /ignore [&lt;user&gt;] will add &lt;user&gt; to ignore list and open the l' +
+              'ist'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label72: TSpTBXLabel
+            Left = 0
+            Top = 312
+            Width = 236
+            Height = 13
+            Caption = '* /mutelist &lt;channel&gt; will return channel'#39's mute list'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object SpTBXLabel4: TSpTBXLabel
+            Left = 0
+            Top = 325
+            Width = 265
+            Height = 13
+            Caption = '* /ingame will return your total amount of ingame minutes'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+        end
+      end
       object SpTBXTabSheet3: TSpTBXTabSheet
         Left = 0
         Top = 23
@@ -2011,872 +2877,6 @@
           LinkFont.Style = [fsUnderline]
         end
       end
-      object SpTBXTabSheet2: TSpTBXTabSheet
-        Left = 0
-        Top = 23
-        Width = 601
-        Height = 378
-        Caption = 'Page 2'
-        ImageIndex = -1
-        TabItem = 'SpTBXTabItem2'
-        object Image5: TImage
-          Left = 32
-          Top = 144
-          Width = 23
-          Height = 112
-          AutoSize = True
-          Picture.Data = {
-            07544269746D6170B61F0000424DB61F00000000000036000000280000001700
-            0000700000000100180000000000801F0000120B0000120B0000000000000000
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFF959595FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFF0F0F0585858FFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFF8080808C8C8CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFF8181814242
-            42A8A8A8FFFFFFFFFFFFFFFFFF656565606060FFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFB1B1B1616161575757757575FFFFFF7070708F8F8F868686FFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFF7676766868683A3A3A575757878787969696
-            868686FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF8F8F8F6C6C6C60606065
-            6565A5A5A58B8B8B8E8E8EFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF6C6C
-            6C8E8E8E6C6C6C8A8A8A8B8B8B7171718A8A8AFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            8B8B8B5151516666669A9A9A9D9D9D9D9D9D646464737373646464808080FFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFACACAC8A8A8AB6B6B6E6E6E6E7E7E7BBBBBBD1D1D1DCDCDCA7A7A7
-            7474746C6C6C7A7A7AFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFF8F8F8F3F3F3CFCFCFA6A6A6C8
-            C8C8F5F5F5F8F8F8F8F8F8D6D6D6A9A9A98E8E8EFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFEEEEEEC7C7C7979797818181FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFD7D7D79E9E9E9D9D9DFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDCDCDC999999FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1F1F1B1
-            B1B1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFC6C6C6FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFF02A8DE008BD806B1E105B5E3029EDD01A6DE009EDB
-            0081D50076D272CEE9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFF31C6E719C3E96CE6F543DEF360E3F467
-            E5F551DFF342DCF251E2F3008DDAFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF61CEE953DFF27CEA
-            F86EE5F542D8EFABF2FA8CEAF769E7F6BFF5FC025EC500A2DDFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            09B5E364E5F508A3E009B3E20FBAE862E5F513BAE70CB3E204AFE30FBEE8029F
-            DBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFF05B1E269E6F50CBBE3FFFFFF72D0E90BB7E358CAE8FFFFFF
-            FFFFFF0073D203A3DEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFF72CCE969E9F63FC6E6FFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFF72CDE81DC9EB05AAE0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF72D0E913BFE8039F
-            DEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF05B1E2008ED88CD0EAFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFF8CD2E909AEE30069CFFFFFFFFFFFFFFFFFFF005DCB04A5DDFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFF22C7E80262C80083D503AAE0003CAE004AC7
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0069CE20CCEA16
-            CAE81BC5E696C2E6FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF01A7
-            DE0053AC10BEE436D9F164E3F33FAFE0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            0BC0E5004DCB0265CC24CEEC57E0F270EBF75CE3F4089FDD0693D831BBE3FFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFF0CBAE40FBEE408B2E10EB6E207A2DE57E3F342C3E805A0DB
-            04A2DD06A5DD0EBEE5FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF03ACE109
-            A3DF96CFE9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFF0EC2E6008FD8FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFF87D2EA0DBEE5FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFD9CCCBCEB4B4E3D5D2E3DBDFDA
-            C4C4D6CBCBD4C2BFC7ACA9C1A5A2FCF8F8FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFF3ECECD9C6CCD2B5
-            B7BDA0A5CDAEADD0B2B5C5A5A7BC9C9EC5ABAACDAAAEFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            F9F7F7C6A3A0D9C2C7D3B4B6BC9390E9D7DEDFC1C3D1B8BBEFE1EA845B57CFBE
-            BDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFE5D5D8CFB4B2BD9EA0E5D2D2D0BABFCEB2B2D4BABBEAD2D0
-            DACED5D1BEC0D6BCB7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFDCCFD3D1B6B5EBDBD8FFFFFFFBF9FAE8
-            D7D8F8F0F0FFFFFFFFFFFFBC9794D7C0BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFBF3F5D1BEBEF5EA
-            E9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBF5F2DCCFD2DDC8C5FFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FBFAFBD4BFC2D7BCBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDCCFD2C8ABA7FEFA
-            FEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFEFCFCC2ABA9B2908CFFFFFFFFFFFFFFFFFFAD8981
-            DBC1BDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFF1EDF08B615CC1A29ED8
-            C8C68B5A51B48179FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFB1908BA0797694756E9B6B65FFE6E5FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFD0C4C46D3D35895F5DB4969ACFADA8F5CEC9FFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFE8E2E1A58283906763A47D7EC8A6A4D4C4C2CBADABBD9995
-            DFB0AAF3DBD9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFEAD9DBEEE0DEE3D0CDECD6D1B99D99C8
-            AEAAECC6C1DCBDB7DBBEBADFC1BAECE0DFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFD7CACCC39E9CFFF8FAFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFEDE6E6CEADA9FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDFBFBE3D5D5FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF9D87
-            873D3434073232073A3A3432328A7070FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFAFA00000000B3B300FFFF03D6D602D4D400FFFF00D1D1000000FCF3F3FFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFF37333300FFFF047B7B000000000000000000000000065858
-            00FFFF1D2424FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFF1F8080005C5C00000000000000000000
-            00000000000000000362621D8584FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF274F5000FFFF033F
-            3F00000000000000000000000006666700FFFF1C3838FFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            253A3A021A1A02FAFA06AAA901000000000004D1D104F3F40119191B4949FFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFF23565600FFFF021B1B02B5B501D1D103D0D004B5B5062828
-            00FFFF183434FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFF2F4646000C0C01FFFF055455068C8C05
-            8989044E4E04FFFF0213131A5757FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF37626300FFFF040D
-            0E03FFFF04656604343402FFFF04000000FFFF205151FFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FEEEEE003A3A00FFFF04101003FFFF02FFFF04090800FFFF1D3E3EFFFCFCFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFF5F501383900FFFF04181806181800FFFF033839
-            FFF3F3FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFEE7E7006A6A01D3D301
-            A0A0008181FFE7E7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFBC9B9B00C7C800E8E8977878FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFF1F3B3B134040FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC6C1C1B0A9A9FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            4C4242F8E8E8FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8E7E7514949FFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFF005D5D008181886B6BFFFFFFFFFFFFFFFFFFFFFFFF876C6C
-            008A8A116666FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFF00000003C0C100EBEB372E2EFFFFFFFF
-            FFFF32323200F2F201AFAF140000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF035D5D026B6B0341
-            4100FFFF272F2F253D3D00FFFF023737037778086464FFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            02000005C8C806BDBD000F0F00FFFF00FFFF020A0A02CACA05C3C3010000FFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFF005A5A05444401929203BABA02202003171704E7E7008383
-            075656005758FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFF48474700FAFA065D5D008C8C07AEAE01
-            BDBC02818102636300F8F84B4747FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFF543A3A00FD
-            FD043C3B02AFAF02ADAD034A4A00F3F3675151FFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFF3C323200FFFF03040503141400FFFF4C3636FFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF08414100F5F500F6F60C3A3BFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD7BABA00ADAD00
-            9292DEC3C3FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFF3853533D4C4CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFCDC9C9D3D0D0FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFF443D3DD7CDCDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            E3D9D9312727FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFF1D6666003637886E6EFFFFFFFFFFFFFF
-            FFFFFFFFFF8C7373003131177171FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF19161600F7F70083
-            83482B2BFFFFFFFFFFFF4C2D2D007A7A00FFFF111111FFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            20656600191A00C5C5008989583A3A6A4A4A009A9A02D5D5001D1D0B6162FFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFF394C4C00FFFF04282800C5C5007C7C00737300D3D3031818
-            00FFFF223B3BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFF21222200FFFF03141400DADA00
-            F0F0040B0B00FFFF233535FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF1D31
-            3100FFFF01000002010100FFFF142929FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFF4F400545400D8D800C9C9005F5FFFEDECFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB9999900C5C500CCCCA88787FFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF23545418
-            4444FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFBAB4B4AFA9A9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFECEBEBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF0000009B8C8CFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF928282000000FFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            066868007878664545FFFFFFFFFFFFFFFFFFFFFFFF5F4040008787005454FFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFF84737300C0C000A2A2604343FFFFFFFFFFFF52333300A3A3
-            00C4C4827070FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFF97757500C0C000808081676793
-            7777008A8B00BABAA08181FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFF8464
-            6400EBEB003839003E3E00ECEC856262FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFF3C3E3E00FFFF00FFFF3F3C3CFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2F2007171005C5DFFFAFAFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF736E6E76
-            7171FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFF8F7F7F7F7F7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000FFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-            FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00
-            0000}
-          Transparent = True
-        end
-        object Label30: TSpTBXLabel
-          Left = 32
-          Top = 32
-          Width = 130
-          Height = 13
-          Caption = 'Battle player count: &quot;x+y/z&quot;'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label31: TSpTBXLabel
-          Left = 40
-          Top = 56
-          Width = 143
-          Height = 13
-          Caption = 'x = non-spectator player count'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label32: TSpTBXLabel
-          Left = 40
-          Top = 72
-          Width = 91
-          Height = 13
-          Caption = 'y = spectator count'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label33: TSpTBXLabel
-          Left = 40
-          Top = 88
-          Width = 168
-          Height = 13
-          Caption = 'z = max. non-spectator player count'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label40: TSpTBXLabel
-          Left = 32
-          Top = 120
-          Width = 69
-          Height = 13
-          Caption = 'Rank symbols:'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label35: TSpTBXLabel
-          Left = 56
-          Top = 144
-          Width = 36
-          Height = 13
-          Caption = 'Newbie'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label36: TSpTBXLabel
-          Left = 56
-          Top = 160
-          Width = 42
-          Height = 13
-          Caption = 'Beginner'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label37: TSpTBXLabel
-          Left = 56
-          Top = 176
-          Width = 40
-          Height = 13
-          Caption = 'Average'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label38: TSpTBXLabel
-          Left = 56
-          Top = 209
-          Width = 59
-          Height = 13
-          Caption = 'Experienced'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label39: TSpTBXLabel
-          Left = 56
-          Top = 226
-          Width = 90
-          Height = 13
-          Caption = 'Highly experienced'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label58: TSpTBXLabel
-          Left = 32
-          Top = 264
-          Width = 241
-          Height = 97
-          Caption = 
-            'Tip: Hold down SHIFT while dragging over the small minimap when ' +
-            'hosting a game to set start rectangles. Press 0...9 to change hi' +
-            'ghlighted rectangle'#39's ally number, and DELETE to remove it. To s' +
-            'et the starting rectangles automatically, right-click on the min' +
-            'imap and select this option. To move a box hold down CTRL and dr' +
-            'ag it.'
-          AutoSize = False
-          Wrapping = twWrap
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label50: TSpTBXLabel
-          Left = 288
-          Top = 216
-          Width = 281
-          Height = 89
-          Caption = 
-            'Rank does not tell how &quot;good&quot; a player is, but rather how experi' +
-            'enced he is (more time you spent playing spring, more experience' +
-            'd you are). Its function is to give you an estimate of how exper' +
-            'ienced the player is, so that you can choose to play against pla' +
-            'yers that are at the same level as you.'
-          AutoSize = False
-          Wrapping = twWrap
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label45: TSpTBXLabel
-          Left = 288
-          Top = 104
-          Width = 70
-          Height = 13
-          Caption = '&lt; 5 h = newbie'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label46: TSpTBXLabel
-          Left = 288
-          Top = 120
-          Width = 89
-          Height = 13
-          Caption = '5 - 15 h = beginner'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label47: TSpTBXLabel
-          Left = 288
-          Top = 136
-          Width = 93
-          Height = 13
-          Caption = '15 - 30 h = average'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label48: TSpTBXLabel
-          Left = 288
-          Top = 152
-          Width = 132
-          Height = 13
-          Caption = '30 - 100 h = above average'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label49: TSpTBXLabel
-          Left = 288
-          Top = 168
-          Width = 124
-          Height = 13
-          Caption = '100 - 300 h = experienced'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label42: TSpTBXLabel
-          Left = 288
-          Top = 56
-          Width = 281
-          Height = 41
-          Caption = 
-            'The server remembers how much time a player has spent in-game. B' +
-            'ased on that time it determines the player'#39's rank:'
-          AutoSize = False
-          Wrapping = twWrap
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object Label41: TSpTBXLabel
-          Left = 288
-          Top = 32
-          Width = 160
-          Height = 13
-          Caption = 'This is how ranking system works:'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object SpTBXLabel6: TSpTBXLabel
-          Left = 56
-          Top = 193
-          Width = 73
-          Height = 13
-          Caption = 'Above average'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object SpTBXLabel7: TSpTBXLabel
-          Left = 56
-          Top = 242
-          Width = 37
-          Height = 13
-          Caption = 'Veteran'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object SpTBXLabel8: TSpTBXLabel
-          Left = 288
-          Top = 184
-          Width = 157
-          Height = 13
-          Caption = '300- 1000 h = highly experienced'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-        object SpTBXLabel9: TSpTBXLabel
-          Left = 288
-          Top = 200
-          Width = 90
-          Height = 13
-          Caption = '&gt; 1000 h = veteran'
-          LinkFont.Charset = DEFAULT_CHARSET
-          LinkFont.Color = clBlue
-          LinkFont.Height = -11
-          LinkFont.Name = 'MS Sans Serif'
-          LinkFont.Style = [fsUnderline]
-        end
-      end
-      object SpTBXTabSheet1: TSpTBXTabSheet
-        Left = 0
-        Top = 23
-        Width = 601
-        Height = 378
-        Caption = 'Page 3'
-        ImageIndex = -1
-        TabItem = 'SpTBXTabItem1'
-        object TntScrollBox1: TTntScrollBox
-          Left = 8
-          Top = 6
-          Width = 585
-          Height = 363
-          VertScrollBar.Smooth = True
-          BorderStyle = bsNone
-          TabOrder = 0
-          object Label52: TLabel
-            Left = 0
-            Top = 341
-            Width = 408
-            Height = 13
-            Caption = 
-              '* /forceupdate /forcebetaupdate will force the lobby update even' +
-              ' if it seems up to date'
-          end
-          object Label53: TLabel
-            Left = 0
-            Top = 360
-            Width = 122
-            Height = 13
-            Caption = '* /help  will show this help'
-          end
-          object Label54: TLabel
-            Left = 0
-            Top = 376
-            Width = 180
-            Height = 13
-            Caption = '* /uptime will tell you the server uptime'
-          end
-          object Label55: TLabel
-            Left = 0
-            Top = 392
-            Width = 292
-            Height = 13
-            Caption = 
-              '* /version will tell you the TASClient lobby version and revisio' +
-              'n'
-          end
-          object Label18: TSpTBXLabel
-            Left = 0
-            Top = 0
-            Width = 52
-            Height = 13
-            Caption = 'Useful tips:'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label19: TSpTBXLabel
-            Left = 0
-            Top = 16
-            Width = 259
-            Height = 13
-            Caption = '* Right-click on a channel or private chat tab to close it'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label20: TSpTBXLabel
-            Left = 0
-            Top = 32
-            Width = 318
-            Height = 13
-            Caption = 
-              '* Double on the player to open private chat (in the list or in t' +
-              'he chat)'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label21: TSpTBXLabel
-            Left = 0
-            Top = 48
-            Width = 233
-            Height = 13
-            Caption = '* Double-click or click on Join button to join battle'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label34: TSpTBXLabel
-            Left = 0
-            Top = 64
-            Width = 203
-            Height = 13
-            Caption = '* Double-click on bot to change his options'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label22: TSpTBXLabel
-            Left = 0
-            Top = 80
-            Width = 215
-            Height = 13
-            Caption = '* Click on minimap to view fixed start positions'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label23: TSpTBXLabel
-            Left = 0
-            Top = 96
-            Width = 334
-            Height = 13
-            Caption = 
-              '* Right click on the minimap to get options like auto boxes or k' +
-              'eep ratio'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label24: TSpTBXLabel
-            Left = 0
-            Top = 128
-            Width = 87
-            Height = 13
-            Caption = 'Useful commands:'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label25: TSpTBXLabel
-            Left = 0
-            Top = 152
-            Width = 154
-            Height = 13
-            Caption = '* /me to talk in &quot;/me&quot; mIRC style'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label26: TSpTBXLabel
-            Left = 0
-            Top = 168
-            Width = 211
-            Height = 13
-            Caption = '* /join or /j (+channel'#39's name) to join channel'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label27: TSpTBXLabel
-            Left = 0
-            Top = 184
-            Width = 283
-            Height = 13
-            Caption = '* /part or /p to close current channel or private chat window'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label28: TSpTBXLabel
-            Left = 0
-            Top = 200
-            Width = 246
-            Height = 13
-            Caption = '* /channels or /list to receive a list of open channels'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label67: TSpTBXLabel
-            Left = 0
-            Top = 216
-            Width = 283
-            Height = 13
-            Caption = '* /rename &lt;new name&gt; to change your account'#39's username'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object SpTBXLabel1: TSpTBXLabel
-            Left = 0
-            Top = 232
-            Width = 334
-            Height = 13
-            Caption = 
-              '* /password &lt;oldpass&gt; &lt;newpass&gt; will change your account passwor' +
-              'd'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label68: TSpTBXLabel
-            Left = 0
-            Top = 248
-            Width = 202
-            Height = 13
-            Caption = '* /ring while hosting a battle to call a player'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label44: TSpTBXLabel
-            Left = 0
-            Top = 264
-            Width = 283
-            Height = 13
-            Caption = '* /ping will tell you the lag between you and the lobby server'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label69: TSpTBXLabel
-            Left = 0
-            Top = 280
-            Width = 242
-            Height = 13
-            Caption = '* /msg &lt;user&gt; {message} will send message to user'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label70: TSpTBXLabel
-            Left = 0
-            Top = 296
-            Width = 295
-            Height = 13
-            Caption = 
-              '* /ignore [&lt;user&gt;] will add &lt;user&gt; to ignore list and open the l' +
-              'ist'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label72: TSpTBXLabel
-            Left = 0
-            Top = 312
-            Width = 236
-            Height = 13
-            Caption = '* /mutelist &lt;channel&gt; will return channel'#39's mute list'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object SpTBXLabel4: TSpTBXLabel
-            Left = 0
-            Top = 325
-            Width = 265
-            Height = 13
-            Caption = '* /ingame will return your total amount of ingame minutes'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-        end
-      end
     end
     object Button3: TSpTBXButton
       Left = 360

Modified: Lobby/TASClient/Interface/default.js
===================================================================
--- Lobby/TASClient/Interface/default.js	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Interface/default.js	2008-10-22 18:44:31 UTC (rev 6853)
@@ -6,6 +6,10 @@
 {
 	sendData(&quot;saveParam:&quot;+str);
 }
+function saveParamByIndex(str)
+{
+	sendData(&quot;saveParamByIndex:&quot;+str);
+}
 function saveSettings(str)
 {
 	sendData(&quot;saveSettings:&quot;+str);

Modified: Lobby/TASClient/Interface/defaultMissionSkin.html
===================================================================
--- Lobby/TASClient/Interface/defaultMissionSkin.html	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Interface/defaultMissionSkin.html	2008-10-22 18:44:31 UTC (rev 6853)
@@ -18,7 +18,7 @@
 		&lt;/div&gt;
 		&lt;div class=&quot;footer&quot;&gt;
 			&lt;a href=&quot;lobby:back&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:..\button.wav');&quot;&gt;Back&lt;/a&gt;
-			&lt;a href=&quot;lobby:startmission&quot; class=&quot;button&quot; style=&quot;float: right;margin-right:20px;&quot; onmouseover=&quot;sendData('playsound:..\button.wav');&quot;&gt;START&lt;/a&gt;
+			&lt;a href=&quot;lobby:startmission:&quot; class=&quot;button&quot; style=&quot;float: right;margin-right:20px;&quot; onmouseover=&quot;sendData('playsound:..\button.wav');&quot;&gt;START&lt;/a&gt;
 		&lt;/div&gt;
 	&lt;/div&gt;
 &lt;/body&gt;

Added: Lobby/TASClient/Interface/gameEndCondItem.html
===================================================================
--- Lobby/TASClient/Interface/gameEndCondItem.html	                        (rev 0)
+++ Lobby/TASClient/Interface/gameEndCondItem.html	2008-10-22 18:44:31 UTC (rev 6853)
@@ -0,0 +1 @@
+&lt;input type=&quot;radio&quot; name=&quot;gametype&quot; value=&quot;0&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gametype:');saveParamByIndex('gametype:[GameEndCondId]:checked');&quot; [LOBBY:LOADPARAM:gametype:[GameEndCondId]:checked] /&gt;[GameEndCondName]&lt;br/&gt;
\ No newline at end of file

Modified: Lobby/TASClient/Interface/luaListItem.html
===================================================================
--- Lobby/TASClient/Interface/luaListItem.html	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Interface/luaListItem.html	2008-10-22 18:44:31 UTC (rev 6853)
@@ -1 +1 @@
-&lt;option value =&quot;[luaOptionItemKey]&quot; title=&quot;[luaOptionItemDescription]&quot; &gt;[luaOptionItemName]&lt;/option&gt;
\ No newline at end of file
+&lt;option value =&quot;[luaOptionItemKey]&quot; title=&quot;[luaOptionItemDescription]&quot;&gt;[luaOptionItemName]&lt;/option&gt;
\ No newline at end of file

Modified: Lobby/TASClient/Interface/selectmod.html
===================================================================
--- Lobby/TASClient/Interface/selectmod.html	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Interface/selectmod.html	2008-10-22 18:44:31 UTC (rev 6853)
@@ -12,13 +12,19 @@
 &lt;body style=&quot;background-color: #[clBtnFace]&quot;&gt;
 	&lt;img src=&quot;images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
 	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
-	&lt;div style=&quot;border: 0;position:absolute;left:10%;top:0;width:80%;height: 50px;margin:0;padding:2em;&quot;&gt;
-		&lt;div style=&quot;height: 40px;&quot;&gt;
-			&lt;h1&gt;Select a game please&lt;/h1&gt;
-		&lt;/div&gt;
-		&lt;div style=&quot;width:100%;height:100%;margin:0;padding:0;overflow: auto&quot;&gt;
-			[ModList]
-		&lt;/div&gt;
+	&lt;div style=&quot;border: 0;position:absolute;left:10%;top:0;width:80%;height:100%;margin:0;padding:0;&quot;&gt;
+		&lt;table cellspacing=&quot;5&quot; cellpadding=&quot;0&quot; style=&quot;height:100%;width: 100%&quot;&gt;
+			&lt;tr&gt;
+				&lt;td style=&quot;height; 40px&quot;&gt;&lt;h1&gt;Select a game please&lt;/h1&gt;&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td style=&quot;height:100%;&quot;&gt;
+					&lt;div style=&quot;height:100%;width:100%;overflow: auto;&quot;&gt;
+					[ModList]
+					&lt;/div&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/table&gt;
 	&lt;/div&gt;
 &lt;/body&gt;
 &lt;/html&gt;

Modified: Lobby/TASClient/Interface/skirmish.html
===================================================================
--- Lobby/TASClient/Interface/skirmish.html	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Interface/skirmish.html	2008-10-22 18:44:31 UTC (rev 6853)
@@ -202,10 +202,6 @@
 		}
 	}
 
-	function selectMod(id){
-		document.getElementById('modList').selectedIndex = id+1;
-	}
-
 	var idList = new Array();
 	var selectedSideList = new Array();
 	var selectedIdList = new Array();
@@ -274,7 +270,6 @@
 
 	function afterLoading(){
 		checkBoxes();
-		selectMod([SelectedModId]);
 		selectSides();
 		//selectIds();
 		selectTeams();
@@ -323,8 +318,8 @@
 &lt;/head&gt;
 &lt;body style=&quot;background-color: #4f3526;height:100%&quot; onmouseup=&quot;endMovingBox();boxOut();&quot; onload=&quot;afterLoading();&quot;&gt;
 	&lt;img src=&quot;images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;span style=&quot;font-size;40px; color:red;background-color:black;&quot; id=&quot;debugspan&quot; style=&quot;position: absolute; top:0;left:0;z-index:2000&quot;&gt;&lt;/span&gt;
 	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
-		&lt;span style=&quot;font-size;40px; color:red;background-color:black;&quot; id=&quot;debugspan&quot;&gt;&lt;/span&gt;
 		&lt;!--[if IE 7]&gt;
 		&lt;div style=&quot;position:absolute;left:0;top:0;width:100%;height:100%;&quot;&gt;
 		&lt;![endif]--&gt;
@@ -351,38 +346,32 @@
 								&lt;td&gt;
 									&lt;div style=&quot;float:left;&quot;&gt;
 										&lt;form method=&quot;POST&quot; action=&quot;&quot;&gt;
-											Game type : &lt;br/&gt;
-											&lt;input type=&quot;radio&quot; name=&quot;gametype&quot; value=&quot;0&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gametype0:checked');saveParam('gametype1:');saveParam('gametype2:');sendData('changegametype:0');&quot; [LOBBY:LOADPARAM:gametype0:0:checked] /&gt; Game continues if commander dies &lt;br/&gt;
-											&lt;input type=&quot;radio&quot; name=&quot;gametype&quot; value=&quot;1&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gametype0:');saveParam('gametype1:checked');saveParam('gametype2:');sendData('changegametype:1');&quot; [LOBBY:LOADPARAM:gametype1:0] /&gt; Game ends if commander dies &lt;br/&gt;
-											&lt;input type=&quot;radio&quot; name=&quot;gametype&quot; value=&quot;2&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gametype0:');saveParam('gametype1:');saveParam('gametype2:checked');sendData('changegametype:2');&quot; [LOBBY:LOADPARAM:gametype2:0] /&gt; Lineage mode &lt;br/&gt;
 											Start pos : &lt;br/&gt;
 											&lt;input type=&quot;radio&quot; name=&quot;gamemode&quot; value=&quot;0&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gamemode0:checked');saveParam('gamemode1:');saveParam('gamemode2:');sendData('changegamemode:0');showBoxes();&quot; [LOBBY:LOADPARAM:gamemode0:0:checked] /&gt; Choose &lt;br/&gt;
 											&lt;input type=&quot;radio&quot; name=&quot;gamemode&quot; value=&quot;1&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gamemode0:');saveParam('gamemode1:checked');saveParam('gamemode2:');sendData('changegamemode:1');hideBoxes();&quot; [LOBBY:LOADPARAM:gamemode1:0] /&gt; Random &lt;br/&gt;
 											&lt;input type=&quot;radio&quot; name=&quot;gamemode&quot; value=&quot;2&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gamemode0:');saveParam('gamemode1:');saveParam('gamemode2:checked');sendData('changegamemode:2');hideBoxes();&quot; [LOBBY:LOADPARAM:gamemode2:0] /&gt; Fixed &lt;br/&gt;
-
-											&lt;input type=&quot;checkbox&quot; id=&quot;LimitDGun&quot; style=&quot;border: 0&quot; onclick=&quot;if ( document.getElementById('LimitDGun').checked ) { saveParam('LimitDGun:checked');sendData('changelimitdgun:1');}else{ saveParam('LimitDGun:');sendData('changelimitdgun:0'); }&quot; [LOBBY:LOADPARAM:LimitDGun:0] /&gt; Limit D-Gun &lt;br/&gt;
-											&lt;input type=&quot;checkbox&quot; id=&quot;GhostedB&quot; style=&quot;border: 0&quot; onclick=&quot;if ( document.getElementById('GhostedB').checked ) { saveParam('GhostedB:checked');sendData('changeGhostedB:1');}else{ saveParam('GhostedB:');sendData('changeGhostedB:0'); }&quot; [LOBBY:LOADPARAM:GhostedB:0:checked] /&gt; Ghosted buildings &lt;br/&gt;
-											&lt;input type=&quot;checkbox&quot; id=&quot;DiminishMM&quot; style=&quot;border: 0&quot; onclick=&quot;if ( document.getElementById('DiminishMM').checked ) { saveParam('DiminishMM:checked');sendData('changeDiminishMM:1');}else{ saveParam('DiminishMM:');sendData('changeDiminishMM:0'); }&quot; [LOBBY:LOADPARAM:DiminishMM:0] /&gt; Diminishing metal makers &lt;br/&gt;
+											Game type : &lt;br/&gt;
+											[GameEndCond]
 										&lt;/form&gt;
 									&lt;/div&gt;
 									&lt;div style=&quot;float:left;margin-left: 30px;&quot;&gt;
-										&lt;div style=&quot;float:left;width: 100px;&quot;&gt;
-											Start Metal :
-											&lt;div class=&quot;slider&quot; id=&quot;metal-slider&quot; style=&quot;height: 170px&quot;&gt;
+										&lt;div style=&quot;float:left;width: 100px;display:[MetalVisible]&quot;&gt;
+											&lt;div style=&quot;height: 40px;&quot;&gt;[MetalCaption] :&lt;/div&gt;
+											&lt;div class=&quot;slider&quot; id=&quot;metal-slider&quot; style=&quot;height: 150px&quot;&gt;
 												&lt;input class=&quot;slider-input&quot; id=&quot;metal-slider-input&quot; /&gt;
 											&lt;/div&gt;
 											&lt;input id=&quot;metal-input&quot; maxlength=&quot;5&quot; style=&quot;width: 40px;&quot; /&gt;
 										&lt;/div&gt;
-										&lt;div style=&quot;float:left;width: 100px;&quot;&gt;
-											Start Energy :
-											&lt;div class=&quot;slider&quot; id=&quot;energy-slider&quot; style=&quot;height: 170px&quot;&gt;
+										&lt;div style=&quot;float:left;width: 100px;display:[EnergyVisible]&quot;&gt;
+											&lt;div style=&quot;height: 40px;&quot;&gt;[EnergyCaption] :&lt;/div&gt;
+											&lt;div class=&quot;slider&quot; id=&quot;energy-slider&quot; style=&quot;height: 150px&quot;&gt;
 												&lt;input class=&quot;slider-input&quot; id=&quot;energy-slider-input&quot; /&gt;
 											&lt;/div&gt;
 											&lt;input id=&quot;energy-input&quot; maxlength=&quot;5&quot; style=&quot;width: 40px;&quot; /&gt;
 										&lt;/div&gt;
-										&lt;div style=&quot;float:left;width: 80px;&quot;&gt;
-											Max Units:
-											&lt;div class=&quot;slider&quot; id=&quot;units-slider&quot; style=&quot;height: 170px&quot;&gt;
+										&lt;div style=&quot;float:left;width: 80px;display:[UnitsVisible]&quot;&gt;
+											&lt;div style=&quot;height: 40px;&quot;&gt;[UnitsCaption] :&lt;/div&gt;
+											&lt;div class=&quot;slider&quot; id=&quot;units-slider&quot; style=&quot;height: 150px&quot;&gt;
 												&lt;input class=&quot;slider-input&quot; id=&quot;units-slider-input&quot; /&gt;
 											&lt;/div&gt;
 											&lt;input id=&quot;units-input&quot; maxlength=&quot;4&quot; style=&quot;width: 40px;&quot; /&gt;
@@ -502,9 +491,13 @@
 		var m = new Slider(document.getElementById(&quot;metal-slider&quot;), document.getElementById(&quot;metal-slider-input&quot;), &quot;vertical&quot;);
 		var e = new Slider(document.getElementById(&quot;energy-slider&quot;), document.getElementById(&quot;energy-slider-input&quot;), &quot;vertical&quot;);
 		var u = new Slider(document.getElementById(&quot;units-slider&quot;), document.getElementById(&quot;units-slider-input&quot;), &quot;vertical&quot;);
-		m.setMaximum(10000);
-		e.setMaximum(10000);
-		u.setMaximum(5000);
+		m.setMaximum([MaxMetal]);
+		e.setMaximum([MaxEnergy]);
+		u.setMaximum([MaxUnits]);
+		
+		m.setMinimum([MinMetal]);
+		e.setMinimum([MinEnergy]);
+		u.setMinimum([MinUnits]);
 
 		var mi = document.getElementById(&quot;metal-input&quot;);
 		mi.onchange = function () {

Modified: Lobby/TASClient/LobbyScriptUnit.pas
===================================================================
--- Lobby/TASClient/LobbyScriptUnit.pas	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/LobbyScriptUnit.pas	2008-10-22 18:44:31 UTC (rev 6853)
@@ -7,7 +7,7 @@
   PythonGUIInputOutput, StrUtils, JclDebug,
   WSocket,MainUnit, class_TIntegerList, RichEdit2, ExRichEdit,
   SyncObjs,SpTBXItem, TB2Item, JvDesktopAlert,
-  SpTBXControls, SpTBXTabs,Forms;
+  SpTBXControls, SpTBXTabs,Forms, TBXDkPanels;
 
 type
   TScriptForm = class(TForm)
@@ -57,6 +57,8 @@
       pyTextBoxes: PPyObject;
       pyColors: PPyObject;
 
+      FStackLayoutChanges: boolean;
+
       function GetMenu(name: string): TTBCustomItem;
       function GetMenuSelectedId(menu: TTBCustomItem): string;
       procedure MenuItemClick(Sender: TObject);
@@ -79,8 +81,8 @@
       procedure DisplaySimpleNotification(title: string; msg: string; displayTime: integer);
       procedure DisplayNotification(title: string; msg: string; callInArgs: Variant; callbackModuleName: string; callbackFunctionName: string; displayTime: integer);
 
-      function GetControlProperties(component: string): Variant;
-      function SetControlProperties(component: string; propertiesV : Variant): boolean;
+      function GetControlProperties(component: string; prop: string): Variant;
+      function SetControlProperties(component: string; prop : string; propertiesV : Variant): boolean;
       function AddTab(caption: string;name: string;tabsPanel : string):boolean;
       function AddForm(name: string;caption: string; style: integer):boolean;
       function AddControl(name: string;parent: string; className: string):boolean;
@@ -88,7 +90,10 @@
       function GetRichEditList: Variant;
       function GetColors: Variant;
       function AddDropDownButton(caption: string; buttonName: string;menuName: string; parent: string): boolean;
+      procedure DeleteControl(name: string);
 
+      procedure StackLayoutChanges(b: boolean);
+
       procedure RemoveFromMenu(id: integer);
   end;
 
@@ -232,7 +237,7 @@
 implementation
 
 uses PythonScriptDebugFormUnit, Utility, MapListFormUnit, HostBattleFormUnit,
-BattleFormUnit, ReplaysUnit, PreferencesFormUnit;
+BattleFormUnit, ReplaysUnit, PreferencesFormUnit, CustomizeGUIFormUnit;
 
 constructor TCallback.Create;
 begin
@@ -1246,16 +1251,26 @@
 function TGUI.AddToRichEdit(richedit : string; msg : string; color : integer): boolean;
 var
   i: integer;
+  r: TExRichEdit;
 begin
   RefreshRichEditLists;
 
   i := textBoxStringList.IndexOf(richedit);
 
-  Result := i &gt; -1;
+  if i = -1 then
+    try
+      r := GetComponentFromString(richedit) as TExRichEdit;
+    except
+      r := nil;
+    end
+  else
+    r := textBoxList[i];
+
+  Result := (i &gt; -1) or (r &lt;&gt; nil);
   if Result then
   begin
     MsgList.BeginUpdate;
-    RichEditList.Add(textBoxList[i]);
+    RichEditList.Add(r);
     MsgList.Add(msg);
     MsgColor.Add(color);
     MsgList.EndUpdate;
@@ -1267,6 +1282,7 @@
 constructor TGUI.Create;
 begin
   menuIdInc :=1;
+  FStackLayoutChanges := False;
   MenuItemList := TList.Create;
   CS := TCriticalSection.Create;
   textBoxStringList := TStringList.Create;
@@ -1535,6 +1551,11 @@
     end;
 end;
 
+procedure TGUI.StackLayoutChanges(b: boolean);
+begin
+  Self.FStackLayoutChanges := b;
+end;
+
 procedure TGUI.RemoveFromMenu(id: integer);
 var
   i: integer;
@@ -1596,16 +1617,19 @@
   ReleaseMainThread;
 end;
 
-function TGUI.GetControlProperties(component: string): Variant;
+function TGUI.GetControlProperties(component: string; prop: string): Variant;
 var
-  c : TWinControl;
+  c : TControl;
+  o: TObject;
   i : integer;
   propNames : TStringList;
   propValues : TList;
+  propTypes: TStringList;
+  propSl: TStringList;
 begin
   Result := GetPythonEngine.PyObjectAsVariant(GetPythonEngine.Py_None);
   try
-    c := GetComponentFromString(component) as TWinControl;
+    c := GetComponentFromString(component) as TControl;
   except
     Exit;
   end;
@@ -1619,16 +1643,38 @@
 
     propNames := TStringList.Create;
     propValues := TList.Create;
-    GetProperties(c,propNames,propValues);
+    propTypes := TStringList.Create;
+    propSl := TStringList.Create;
 
+    Misc.ParseDelimited(propSl,prop,'.','');
+
+    o := c;
+    while (propSl.Count &gt; 0) and (prop &lt;&gt; '') do
+    begin
+      Misc.GetProperties(o,propNames,propValues,propTypes);
+      if (propSl.Count &gt; 0) and (prop &lt;&gt; '') then
+      begin
+        for i := 0 to propNames.Count-1 do
+          if propNames[i] = propSl[0] then
+            break;
+        if (i &gt;= propNames.Count) and (propNames[i] &lt;&gt; propSl[0]) then
+        begin
+          UnlockGUI;
+          Exit;
+        end;
+
+        o := TObject(propValues[i]);
+      end;
+      propSl.Delete(0);
+    end;
+    Misc.GetProperties(o,propNames,propValues,propTypes);
+
     for i := 0 to propNames.Count-1 do
-      PyDict_SetItemStringDecRef(pyProperties,PChar(propNames[i]),Variant(propValues[i]^));
+      if propTypes[i] = 'tkClass' then
+        PyDict_SetItemStringDecRef(pyProperties,PChar(propNames[i]),TObject(propValues[i]).ClassName)
+      else
+        PyDict_SetItemStringDecRef(pyProperties,PChar(propNames[i]),Variant(propValues[i]^));
 
-    PyDict_SetItemStringDecRef(pyProperties,'leftAnchor',akLeft in c.Anchors);
-    PyDict_SetItemStringDecRef(pyProperties,'rightAnchor',akRight in c.Anchors);
-    PyDict_SetItemStringDecRef(pyProperties,'topAnchor',akTop in c.Anchors);
-    PyDict_SetItemStringDecRef(pyProperties,'bottomAnchor',akBottom in c.Anchors);
-
     PyDict_SetItemStringDecRef(pyProperties,'Parent',GetStringFromComponent(c.GetParentComponent));
 
     Result := PyObjectAsVariant(pyProperties);
@@ -1636,17 +1682,23 @@
   UnlockGUI;
 end;
 
-function TGUI.SetControlProperties(component: string; propertiesV : Variant): boolean;
+function TGUI.SetControlProperties(component: string; prop : string; propertiesV : Variant): boolean;
 var
-  c : TWinControl;
+  c : TControl;
+  o: TObject;
   properties: PPyObject;
-  x,y,width,height,align : integer;
-  leftAnchor,rightAnchor,topAnchor,bottomAnchor,visible : boolean;
   keys,values : PPyObject;
   key: string;
   value : Variant;
   parent: string;
-  i: integer;
+  i,j: integer;
+
+  propNames : TStringList;
+  propValues : TList;
+  propTypes: TStringList;
+  propSl: TStringList;
+
+  p: TProperty;
 begin
   Result := False;
 
@@ -1660,38 +1712,64 @@
       keys := PyDict_Keys(properties);
       values := PyDict_Values(properties);
 
-      c := GetComponentFromString(component) as TWinControl;
+      c := GetComponentFromString(component) as TControl;
 
+      propNames := TStringList.Create;
+      propValues := TList.Create;
+      propTypes := TStringList.Create;
+      propSl := TStringList.Create;
+
+      Misc.ParseDelimited(propSl,prop,'.','');
+
+      o := c;
+      while (propSl.Count &gt; 0) and (prop &lt;&gt; '') do
+      begin
+        Misc.GetProperties(o,propNames,propValues,propTypes);
+        if (propSl.Count &gt; 0) and (prop &lt;&gt; '') then
+        begin
+          for i := 0 to propNames.Count-1 do
+            if propNames[i] = propSl[0] then
+              break;
+          if (i &gt;= propNames.Count) and (propNames[i] &lt;&gt; propSl[0]) then
+          begin
+            UnlockGUI;
+            Exit;
+          end;
+
+          o := TObject(propValues[i]);
+        end;
+        propSl.Delete(0);
+      end;
+      Misc.GetProperties(o,propNames,propValues,propTypes);
+
       for i:=0 to PyList_Size(keys)-1 do
       begin
         key := PyString_AsString(PyList_GetItem(keys,i));
         value := PyObjectAsVariant(PyList_GetItem(values,i));
-        if LowerCase(key) &lt;&gt; 'parent' then
-          SetProperty(c,key,value);
+        j := propNames.IndexOf(key);
+        if (LowerCase(key) &lt;&gt; 'parent') and (propTypes[j] &lt;&gt; 'tkClass') then
+        begin
+          p := TProperty.Create(key,Variant(propValues[j]^),o);
+          if Self.FStackLayoutChanges then
+            CustomizeGUIForm.AddToHistory(p,value,prop,c);
+          SetProperty(o,key,value);
+          p.Free;
+        end;
       end;
+      parent := PyString_AsString(PyDict_GetItem(properties,PyString_FromString('Parent')));
+    end;
 
-      parent := PyString_AsString(PyDict_GetItem(properties,PyString_FromString('parent')));
-
-      leftAnchor := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('leftAnchor'))) &lt;&gt; 0;
-      rightAnchor := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('rightAnchor'))) &lt;&gt; 0;
-      topAnchor := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('topAnchor'))) &lt;&gt; 0;
-      bottomAnchor := PyLong_AsLong(PyDict_GetItem(properties,PyString_FromString('bottomAnchor'))) &lt;&gt; 0;
-
+    if prop = '' then
+    begin
+      p := TProperty.Create('Parent',GetStringFromComponent(c.Parent),o);
+      if Self.FStackLayoutChanges then
+        CustomizeGUIForm.AddToHistory(p,parent,prop,c);
+      p.Free;
+      c.Parent := GetComponentFromString(parent) as TWinControl;
     end;
 
-    c.Parent := GetComponentFromString(parent) as TWinControl;
+    c.Refresh;
 
-
-    c.Anchors := [];
-    if leftAnchor then
-      c.Anchors := c.Anchors + [akLeft];
-    if rightAnchor then
-      c.Anchors := c.Anchors + [akRight];
-    if topAnchor then
-      c.Anchors := c.Anchors + [akTop];
-    if bottomAnchor then
-      c.Anchors := c.Anchors + [akBottom];
-
     Result := True;
   except
     Result := False;
@@ -1712,11 +1790,26 @@
     control.Parent := parentC;
     control.Name := name;
     Result := True;
+    if Self.FStackLayoutChanges then
+      CustomizeGUIForm.history.Add(THistoryItemControl.Create(control));
   except
     Result := False;
   end;
 end;
 
+procedure TGUI.DeleteControl(name: string);
+var
+  c : TWinControl;
+begin
+  try
+    c := GetComponentFromString(name) as TWinControl;
+    if c.ClassType = TSpTBXTabSheet then
+      TSpTBXTabSheet(c).Item.Destroy;
+    c.Destroy;
+  except
+  end;
+end;
+
 function TGUI.AddTab(caption: string;name: string;tabsPanel : string):boolean;
 var
   p: TSpTBXTabControl;
@@ -1726,6 +1819,8 @@
     p.Add(caption);
     p.Pages[p.PagesCount-1].Name := name;
     Result := True;
+    if Self.FStackLayoutChanges then
+      CustomizeGUIForm.history.Add(THistoryItemTab.Create( p.Pages[p.PagesCount-1],p));
   except
     Result := False;
   end;
@@ -1750,6 +1845,8 @@
     end;
     p.Show;
     Result := True;
+    if Self.FStackLayoutChanges then
+      CustomizeGUIForm.history.Add(THistoryItemForm.Create(p));
   except
     Result := False;
   end;
@@ -1904,10 +2001,13 @@
 begin
   for i:=0 to MsgList.Count -1 do
   begin
-    if RichEditList[i] = nil then // battleform
-      BattleForm.AddTextToChat(MsgList[i],MsgColor.Items[i],0)
+    if TObject(RichEditList[i]).ClassType = TExRichEdit then
+      Misc.AddTextToRichEdit(TExRichEdit(RichEditList[i]),MsgList[i],MsgColor.Items[i],True,0)
     else
-      MainForm.AddTextToChatWindow(TMyTabSheet(RichEditList[i]),MsgList[i],MsgColor.Items[i] );
+      if RichEditList[i] = nil then // battleform
+        BattleForm.AddTextToChat(MsgList[i],MsgColor.Items[i],0)
+      else
+        MainForm.AddTextToChatWindow(TMyTabSheet(RichEditList[i]),MsgList[i],MsgColor.Items[i] );
   end;
   MsgList.BeginUpdate;
   MsgList.Clear;

Modified: Lobby/TASClient/MainUnit.dfm
===================================================================
--- Lobby/TASClient/MainUnit.dfm	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/MainUnit.dfm	2008-10-22 18:44:31 UTC (rev 6853)
@@ -1,8 +1,8 @@
 object MainForm: TMainForm
-  Left = 483
-  Top = 108
-  Width = 773
-  Height = 535
+  Left = 465
+  Top = 178
+  Width = 781
+  Height = 550
   Caption = '.'
   Color = clBtnFace
   Constraints.MaxHeight = 1000
@@ -24,15 +24,132 @@
   object MainTitleBar: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 765
-    Height = 508
+    Width = 773
+    Height = 523
     Caption = 'TASClient'
     TBXStyleBackground = True
+    object DefaultSideImage: TImage
+      Left = 240
+      Top = 72
+      Width = 25
+      Height = 25
+      Picture.Data = {
+        07544269746D617036030000424D360300000000000036000000280000001000
+        0000100000000100180000000000000300000000000000000000000000000000
+        0000C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
+        C0C0}
+      Transparent = True
+      Visible = False
+    end
+    object DefaultCoreImage: TImage
+      Left = 264
+      Top = 72
+      Width = 25
+      Height = 25
+      Picture.Data = {
+        07544269746D617036030000424D360300000000000036000000280000001000
+        000010000000010018000000000000030000120B0000120B0000000000000000
+        0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFF02EDFDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFF02EDFDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2A00D902ED
+        FDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF02EDFD2A00D9FFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFF2A00D91081F0FFFFFF117CEF2206E02206E0117CEF
+        FFFFFF1081F02A00D9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF02EDFD2C00D70BA1
+        F5117CEF1B44E62206E02206E01B44E6117CEF0BA1F52C00D702EDFDFFFFFFFF
+        FFFFFFFFFFFFFFFF02EDFD2A00D90D97F305DAFB2110E12400DE2400DE2110E1
+        05DAFB0D97F32A00D902EDFDFFFFFFFFFFFFFFFFFFFFFFFF02EDFD2701DC240B
+        DE09B1F702EDFD2017E22017E202EDFD09B1F7240BDE2702DC02EDFDFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFF208DF22502DD2601DD09B3F700F4FF00F4FF09B3F7
+        2601DD2503DD1A87F1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1087
+        F12502DD2600DD09B1F709B1F72600DD2502DD0F8BF2FFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFF05C9FA01F2FE1087F02500DD2600DC2600DC2500DD
+        1087F001F2FE05CAFAFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1560EC1E3B
+        E300FEFF0F8BF12600DD2600DD0F8BF100FEFF1E3BE31560ECFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFF0EE6FE2416DF1E2FE401F2FF0F8BF20F8BF201F2FF
+        1E2FE42416DF0EE6FEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0CE7
+        FE1189F003D9FDFFFFFFFFFFFF03D9FD1189F00CE7FEFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFF}
+      Transparent = True
+      Visible = False
+    end
+    object DefaultArmImage: TImage
+      Left = 216
+      Top = 72
+      Width = 25
+      Height = 25
+      Picture.Data = {
+        07544269746D617036030000424D360300000000000036000000280000001000
+        000010000000010018000000000000030000120B0000120B0000000000000000
+        0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFA8460CFFFFFFA8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CFFFFFFA8460CFFFFFF
+        A8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CA846
+        0CA8460CFFFFFFA8460CA8460CA8460CFFFFFFA8460CA8460CA8460CFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CA8460CA8460CA8460C
+        A8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CA846
+        0CA8460CFFFFFFA8460CA8460CA8460CFFFFFFA8460CA8460CA8460CFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CFFFFFFA8460CFFFFFF
+        A8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFA8460CFFFFFFA8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
+        FFFF}
+      Transparent = True
+      Visible = False
+    end
+    object BotImage: TImage
+      Left = 160
+      Top = 72
+      Width = 36
+      Height = 16
+      AutoSize = True
+      Transparent = True
+      Visible = False
+    end
     object Panel2: TSpTBXPanel
-      Left = 608
+      Left = 616
       Top = 30
       Width = 153
-      Height = 474
+      Height = 489
       Align = alRight
       Color = clNone
       Constraints.MinWidth = 1
@@ -40,73 +157,12 @@
       TabOrder = 1
       Borders = False
       BorderType = pbrFramed
-      DesignSize = (
-        153
-        474)
-      object Bevel1: TBevel
-        Left = 2
-        Top = 2
-        Width = 149
-        Height = 24
-        Align = alTop
-        Style = bsRaised
-      end
-      object SortLabel: TLabel
-        Left = 119
-        Top = 8
-        Width = 24
-        Height = 13
-        Cursor = crHandPoint
-        Alignment = taRightJustify
-        Anchors = [akTop, akRight]
-        Caption = 'Sort'
-        Color = clNone
-        Font.Charset = DEFAULT_CHARSET
-        Font.Color = clBlue
-        Font.Height = -11
-        Font.Name = 'MS Sans Serif'
-        Font.Style = [fsBold, fsUnderline]
-        ParentColor = False
-        ParentFont = False
-        Transparent = True
-        OnClick = SortLabelClick
-      end
-      object PlayersLabel: TSpTBXLabel
-        Left = 28
-        Top = 8
-        Width = 37
-        Height = 13
-        Caption = 'Players:'
-        LinkFont.Charset = DEFAULT_CHARSET
-        LinkFont.Color = clBlue
-        LinkFont.Height = -11
-        LinkFont.Name = 'MS Sans Serif'
-        LinkFont.Style = [fsUnderline]
-      end
-      object btSearchPlayer: TSpTBXSpeedButton
-        Left = 4
-        Top = 4
-        Width = 22
-        Height = 20
-        Hint = 'Search for a player in the list. Hit F3 to get the next result.'
-        ParentShowHint = False
-        ShowHint = True
-        DropDownArrow = False
-        DropDownMenu = SearchPlayerFormPopupMenu
-        Images = BattleStatusImageList
-        ImageIndex = 6
-        LinkFont.Charset = DEFAULT_CHARSET
-        LinkFont.Color = clBlue
-        LinkFont.Height = -11
-        LinkFont.Name = 'MS Sans Serif'
-        LinkFont.Style = [fsUnderline]
-      end
       object ClientsListBox: TTntListBox
         Tag = -1
         Left = 2
-        Top = 26
+        Top = 30
         Width = 149
-        Height = 446
+        Height = 457
         Style = lbOwnerDrawFixed
         Align = alClient
         Font.Charset = DEFAULT_CHARSET
@@ -118,7 +174,7 @@
         ParentFont = False
         ParentShowHint = False
         ShowHint = True
-        TabOrder = 2
+        TabOrder = 0
         OnClick = ClientsListBoxClick
         OnDblClick = ClientsListBoxDblClick
         OnDrawItem = ClientsListBoxDrawItem
@@ -128,12 +184,75 @@
         OnMouseMove = ClientsListBoxMouseMove
         OnMouseUp = ClientsListBoxMouseUp
       end
+      object PlayersInfoPanel: TSpTBXPanel
+        Left = 2
+        Top = 2
+        Width = 149
+        Height = 28
+        Caption = 'PlayersInfoPanel'
+        Align = alTop
+        TabOrder = 1
+        BorderType = pbrFramed
+        DesignSize = (
+          149
+          28)
+        object SortLabel: TLabel
+          Left = 119
+          Top = 8
+          Width = 24
+          Height = 13
+          Cursor = crHandPoint
+          Alignment = taRightJustify
+          Anchors = [akTop, akRight]
+          Caption = 'Sort'
+          Color = clNone
+          Font.Charset = DEFAULT_CHARSET
+          Font.Color = clBlue
+          Font.Height = -11
+          Font.Name = 'MS Sans Serif'
+          Font.Style = [fsBold, fsUnderline]
+          ParentColor = False
+          ParentFont = False
+          Transparent = True
+          OnClick = SortLabelClick
+        end
+        object btSearchPlayer: TSpTBXSpeedButton
+          Left = 4
+          Top = 4
+          Width = 22
+          Height = 20
+          Hint = 'Search for a player in the list. Hit F3 to get the next result.'
+          ParentShowHint = False
+          ShowHint = True
+          DropDownArrow = False
+          DropDownMenu = SearchPlayerFormPopupMenu
+          Images = BattleStatusImageList
+          ImageIndex = 6
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+        object PlayersLabel: TSpTBXLabel
+          Left = 28
+          Top = 8
+          Width = 37
+          Height = 13
+          Caption = 'Players:'
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
+      end
     end
     object Splitter1: TSpTBXSplitter
-      Left = 598
+      Left = 606
       Top = 30
       Width = 10
-      Height = 474
+      Height = 489
       Cursor = crSizeWE
       Caption = 'Splitter1'
       Align = alRight
@@ -142,8 +261,8 @@
     object Panel1: TSpTBXPanel
       Left = 4
       Top = 30
-      Width = 594
-      Height = 474
+      Width = 602
+      Height = 489
       Caption = 'Panel1'
       Align = alClient
       TabOrder = 3
@@ -152,132 +271,15 @@
       object Bevel2: TBevel
         Left = 2
         Top = 43
-        Width = 590
+        Width = 598
         Height = 4
         Align = alTop
         Shape = bsSpacer
       end
-      object BotImage: TImage
-        Left = 160
-        Top = 72
-        Width = 36
-        Height = 16
-        AutoSize = True
-        Transparent = True
-        Visible = False
-      end
-      object DefaultArmImage: TImage
-        Left = 216
-        Top = 72
-        Width = 25
-        Height = 25
-        Picture.Data = {
-          07544269746D617036030000424D360300000000000036000000280000001000
-          000010000000010018000000000000030000120B0000120B0000000000000000
-          0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFA8460CFFFFFFA8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CFFFFFFA8460CFFFFFF
-          A8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CA846
-          0CA8460CFFFFFFA8460CA8460CA8460CFFFFFFA8460CA8460CA8460CFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CA8460CA8460CA8460C
-          A8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CA846
-          0CA8460CFFFFFFA8460CA8460CA8460CFFFFFFA8460CA8460CA8460CFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA8460CFFFFFFA8460CFFFFFF
-          A8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFA8460CFFFFFFA8460CFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFF}
-        Transparent = True
-        Visible = False
-      end
-      object DefaultSideImage: TImage
-        Left = 240
-        Top = 72
-        Width = 25
-        Height = 25
-        Picture.Data = {
-          07544269746D617036030000424D360300000000000036000000280000001000
-          0000100000000100180000000000000300000000000000000000000000000000
-          0000C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
-          C0C0}
-        Transparent = True
-        Visible = False
-      end
-      object DefaultCoreImage: TImage
-        Left = 264
-        Top = 72
-        Width = 25
-        Height = 25
-        Picture.Data = {
-          07544269746D617036030000424D360300000000000036000000280000001000
-          000010000000010018000000000000030000120B0000120B0000000000000000
-          0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFF02EDFDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFF02EDFDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2A00D902ED
-          FDFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF02EDFD2A00D9FFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFF2A00D91081F0FFFFFF117CEF2206E02206E0117CEF
-          FFFFFF1081F02A00D9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF02EDFD2C00D70BA1
-          F5117CEF1B44E62206E02206E01B44E6117CEF0BA1F52C00D702EDFDFFFFFFFF
-          FFFFFFFFFFFFFFFF02EDFD2A00D90D97F305DAFB2110E12400DE2400DE2110E1
-          05DAFB0D97F32A00D902EDFDFFFFFFFFFFFFFFFFFFFFFFFF02EDFD2701DC240B
-          DE09B1F702EDFD2017E22017E202EDFD09B1F7240BDE2702DC02EDFDFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFF208DF22502DD2601DD09B3F700F4FF00F4FF09B3F7
-          2601DD2503DD1A87F1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1087
-          F12502DD2600DD09B1F709B1F72600DD2502DD0F8BF2FFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFF05C9FA01F2FE1087F02500DD2600DC2600DC2500DD
-          1087F001F2FE05CAFAFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1560EC1E3B
-          E300FEFF0F8BF12600DD2600DD0F8BF100FEFF1E3BE31560ECFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFF0EE6FE2416DF1E2FE401F2FF0F8BF20F8BF201F2FF
-          1E2FE42416DF0EE6FEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0CE7
-          FE1189F003D9FDFFFFFFFFFFFF03D9FD1189F00CE7FEFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
-          FFFF}
-        Transparent = True
-        Visible = False
-      end
       object Panel3: TPanel
         Left = 2
-        Top = 202
-        Width = 590
+        Top = 217
+        Width = 598
         Height = 270
         Align = alBottom
         BevelOuter = bvNone
@@ -285,7 +287,7 @@
         object BattlesPanel: TSpTBXPanel
           Left = 0
           Top = 0
-          Width = 590
+          Width = 598
           Height = 270
           Align = alClient
           TabOrder = 0
@@ -294,7 +296,7 @@
           object QuickJoinPanel: TSpTBXPanel
             Left = 2
             Top = 2
-            Width = 586
+            Width = 594
             Height = 25
             Hint = 'Quick join panel'
             Caption = 'QuickJoinPanel'
@@ -302,7 +304,7 @@
             TabOrder = 1
             Borders = False
             DesignSize = (
-              586
+              594
               25)
             object SpTBXLabel1: TSpTBXLabel
               Left = 0
@@ -326,7 +328,7 @@
               LinkFont.Style = [fsUnderline]
             end
             object btSpecatateNow: TSpTBXButton
-              Left = 487
+              Left = 495
               Top = 0
               Width = 97
               Height = 22
@@ -352,7 +354,7 @@
               LinkFont.Style = [fsUnderline]
             end
             object btPlayNow: TSpTBXButton
-              Left = 381
+              Left = 389
               Top = 0
               Width = 97
               Height = 22
@@ -393,7 +395,7 @@
           object VDTBattles: TVirtualDrawTree
             Left = 2
             Top = 27
-            Width = 586
+            Width = 594
             Height = 56
             Align = alClient
             BevelInner = bvNone
@@ -506,7 +508,7 @@
           object FilterGroup: TSpTBXPanel
             Left = 2
             Top = 95
-            Width = 586
+            Width = 594
             Height = 173
             Caption = 'FilterGroup'
             Align = alBottom
@@ -514,45 +516,146 @@
             OnResize = FilterGroupResize
             Borders = False
             DesignSize = (
-              586
+              594
               173)
             object FiltersTabs: TSpTBXTabControl
               Left = 2
               Top = 2
-              Width = 582
+              Width = 590
               Height = 169
               Align = alClient
               Color = clBtnFace
-              ActiveTabIndex = 1
+              ActiveTabIndex = 0
               TabPosition = ttpBottom
               ThemeType = tttNone
               HiddenItems = &lt;&gt;
               object SpTBXTabItem1: TSpTBXTabItem
                 Caption = 'Filters'
+                Checked = True
                 TabPosition = ttpBottom
                 ThemeType = tttNone
               end
               object SpTBXTabItem2: TSpTBXTabItem
                 Caption = 'Presets'
-                Checked = True
                 TabPosition = ttpBottom
                 ThemeType = tttNone
               end
+              object SpTBXTabSheet2: TSpTBXTabSheet
+                Left = 0
+                Top = 0
+                Width = 590
+                Height = 146
+                Caption = 'Presets'
+                ImageIndex = -1
+                DesignSize = (
+                  590
+                  146)
+                TabItem = 'SpTBXTabItem2'
+                object PresetListbox: TSpTBXListBox
+                  Left = 152
+                  Top = 26
+                  Width = 425
+                  Height = 113
+                  Anchors = [akLeft, akTop, akRight]
+                  ItemHeight = 16
+                  Items.Strings = (
+                    'default')
+                  TabOrder = 0
+                  OnClick = PresetListboxClick
+                end
+                object SpTBXLabel3: TSpTBXLabel
+                  Left = 152
+                  Top = 8
+                  Width = 64
+                  Height = 16
+                  Caption = 'Preset list :'
+                  Font.Charset = DEFAULT_CHARSET
+                  Font.Color = clWindowText
+                  Font.Height = -13
+                  Font.Name = 'MS Sans Serif'
+                  Font.Style = []
+                  ParentFont = False
+                  LinkFont.Charset = DEFAULT_CHARSET
+                  LinkFont.Color = clBlue
+                  LinkFont.Height = -11
+                  LinkFont.Name = 'MS Sans Serif'
+                  LinkFont.Style = [fsUnderline]
+                end
+                object SpTBXGroupBox1: TSpTBXGroupBox
+                  Left = 8
+                  Top = 8
+                  Width = 137
+                  Height = 129
+                  Caption = 'Options'
+                  TabOrder = 2
+                  TBXStyleBackground = True
+                  object btDeletePreset: TSpTBXButton
+                    Left = 8
+                    Top = 72
+                    Width = 121
+                    Height = 25
+                    Caption = 'Delete'
+                    TabOrder = 1
+                    OnClick = btDeletePresetClick
+                    LinkFont.Charset = DEFAULT_CHARSET
+                    LinkFont.Color = clBlue
+                    LinkFont.Height = -11
+                    LinkFont.Name = 'MS Sans Serif'
+                    LinkFont.Style = [fsUnderline]
+                  end
+                  object btSavePreset: TSpTBXButton
+                    Left = 8
+                    Top = 40
+                    Width = 121
+                    Height = 25
+                    Caption = 'Save'
+                    TabOrder = 2
+                    OnClick = btSavePresetClick
+                    LinkFont.Charset = DEFAULT_CHARSET
+                    LinkFont.Color = clBlue
+                    LinkFont.Height = -11
+                    LinkFont.Name = 'MS Sans Serif'
+                    LinkFont.Style = [fsUnderline]
+                  end
+                  object PresetNameTextbox: TSpTBXEdit
+                    Left = 8
+                    Top = 18
+                    Width = 121
+                    Height = 21
+                    TabOrder = 3
+                    Text = 'Preset name'
+                  end
+                  object btClearPreset: TSpTBXButton
+                    Left = 8
+                    Top = 96
+                    Width = 121
+                    Height = 25
+                    Caption = 'Clear'
+                    TabOrder = 0
+                    OnClick = btClearPresetClick
+                    LinkFont.Charset = DEFAULT_CHARSET
+                    LinkFont.Color = clBlue
+                    LinkFont.Height = -11
+                    LinkFont.Name = 'MS Sans Serif'
+                    LinkFont.Style = [fsUnderline]
+                  end
+                end
+              end
               object SpTBXTabSheet1: TSpTBXTabSheet
                 Left = 0
                 Top = 0
-                Width = 582
+                Width = 590
                 Height = 146
                 Caption = 'Filters'
                 ImageIndex = -1
                 DesignSize = (
-                  582
+                  590
                   146)
                 TabItem = 'SpTBXTabItem1'
                 object FilterList: TVirtualStringTree
                   Left = 424
                   Top = 8
-                  Width = 145
+                  Width = 153
                   Height = 129
                   Anchors = [akLeft, akTop, akRight]
                   CheckImageKind = ckSystem
@@ -859,110 +962,9 @@
                   end
                 end
               end
-              object SpTBXTabSheet2: TSpTBXTabSheet
-                Left = 0
-                Top = 0
-                Width = 582
-                Height = 146
-                Caption = 'Presets'
-                ImageIndex = -1
-                DesignSize = (
-                  582
-                  146)
-                TabItem = 'SpTBXTabItem2'
-                object PresetListbox: TSpTBXListBox
-                  Left = 152
-                  Top = 26
-                  Width = 417
-                  Height = 113
-                  Anchors = [akLeft, akTop, akRight]
-                  ItemHeight = 16
-                  Items.Strings = (
-                    'default')
-                  TabOrder = 0
-                  OnClick = PresetListboxClick
-                end
-                object SpTBXLabel3: TSpTBXLabel
-                  Left = 152
-                  Top = 8
-                  Width = 64
-                  Height = 16
-                  Caption = 'Preset list :'
-                  Font.Charset = DEFAULT_CHARSET
-                  Font.Color = clWindowText
-                  Font.Height = -13
-                  Font.Name = 'MS Sans Serif'
-                  Font.Style = []
-                  ParentFont = False
-                  LinkFont.Charset = DEFAULT_CHARSET
-                  LinkFont.Color = clBlue
-                  LinkFont.Height = -11
-                  LinkFont.Name = 'MS Sans Serif'
-                  LinkFont.Style = [fsUnderline]
-                end
-                object SpTBXGroupBox1: TSpTBXGroupBox
-                  Left = 8
-                  Top = 8
-                  Width = 137
-                  Height = 129
-                  Caption = 'Options'
-                  TabOrder = 2
-                  TBXStyleBackground = True
-                  object btDeletePreset: TSpTBXButton
-                    Left = 8
-                    Top = 72
-                    Width = 121
-                    Height = 25
-                    Caption = 'Delete'
-                    TabOrder = 1
-                    OnClick = btDeletePresetClick
-                    LinkFont.Charset = DEFAULT_CHARSET
-                    LinkFont.Color = clBlue
-                    LinkFont.Height = -11
-                    LinkFont.Name = 'MS Sans Serif'
-                    LinkFont.Style = [fsUnderline]
-                  end
-                  object btSavePreset: TSpTBXButton
-                    Left = 8
-                    Top = 40
-                    Width = 121
-                    Height = 25
-                    Caption = 'Save'
-                    TabOrder = 2
-                    OnClick = btSavePresetClick
-                    LinkFont.Charset = DEFAULT_CHARSET
-                    LinkFont.Color = clBlue
-                    LinkFont.Height = -11
-                    LinkFont.Name = 'MS Sans Serif'
-                    LinkFont.Style = [fsUnderline]
-                  end
-                  object PresetNameTextbox: TSpTBXEdit
-                    Left = 8
-                    Top = 18
-                    Width = 121
-                    Height = 21
-                    TabOrder = 3
-                    Text = 'Preset name'
-                  end
-                  object btClearPreset: TSpTBXButton
-                    Left = 8
-                    Top = 96
-                    Width = 121
-                    Height = 25
-                    Caption = 'Clear'
-                    TabOrder = 0
-                    OnClick = btClearPresetClick
-                    LinkFont.Charset = DEFAULT_CHARSET
-                    LinkFont.Color = clBlue
-                    LinkFont.Height = -11
-                    LinkFont.Name = 'MS Sans Serif'
-                    LinkFont.Style = [fsUnderline]
-                  end
-                end
-              end
             end
             object EnableFilters: TSpTBXCheckBox
-              Left = 360
+              Left = 480
               Top = 154
               Width = 110
               Height = 18
@@ -981,7 +983,7 @@
           object FiltersButton: TSpTBXButton
             Left = 2
             Top = 83
-            Width = 586
+            Width = 594
             Height = 12
             Align = alBottom
             TabOrder = 3
@@ -998,8 +1000,8 @@
       end
       object Splitter2: TSpTBXSplitter
         Left = 2
-        Top = 196
-        Width = 590
+        Top = 211
+        Width = 598
         Height = 6
         Cursor = crSizeNS
         Caption = 'Splitter2'
@@ -1012,8 +1014,8 @@
       object PageControl1: TPageControl
         Left = 2
         Top = 47
-        Width = 590
-        Height = 149
+        Width = 598
+        Height = 164
         Align = alClient
         Constraints.MinHeight = 1
         Style = tsButtons
@@ -1025,7 +1027,7 @@
       object Panel4: TSpTBXPanel
         Left = 2
         Top = 2
-        Width = 590
+        Width = 598
         Height = 41
         Align = alTop
         Color = clNone
@@ -1034,7 +1036,7 @@
         BorderType = pbrRaised
         TBXStyleBackground = True
         object OptionsSpeedButton: TSpTBXSpeedButton
-          Left = 240
+          Left = 328
           Top = 8
           Width = 81
           Height = 25
@@ -1061,7 +1063,7 @@
           ThemeType = thtTBX
         end
         object HelpButton: TSpTBXSpeedButton
-          Left = 328
+          Left = 416
           Top = 8
           Width = 81
           Height = 25
@@ -1074,7 +1076,7 @@
           LinkFont.Style = [fsUnderline]
         end
         object ReplaysButton: TSpTBXSpeedButton
-          Left = 152
+          Left = 240
           Top = 8
           Width = 81
           Height = 25
@@ -1092,7 +1094,7 @@
           LinkFont.Style = [fsUnderline]
         end
         object SearchButton: TSpTBXSpeedButton
-          Left = 416
+          Left = 504
           Top = 8
           Width = 81
           Height = 25
@@ -1125,12 +1127,11 @@
         end
         object SinglePlayerButton: TSpTBXButton
           Left = 152
-          Top = 32
+          Top = 8
           Width = 81
           Height = 25
           Caption = 'Single Player'
           TabOrder = 6
-          Visible = False
           OnClick = SinglePlayerButtonClick
           LinkFont.Charset = DEFAULT_CHARSET
           LinkFont.Color = clBlue
@@ -4573,7 +4574,7 @@
       000000000000}
   end
   object SortPopupMenu: TPopupMenu
-    Left = 728
+    Left = 688
     Top = 40
     object Nosorting1: TMenuItem
       Caption = 'Don'#39't sort'

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/MainUnit.pas	2008-10-22 18:44:31 UTC (rev 6853)
@@ -522,9 +522,9 @@
   );
 
 const
-  VERSION_NUMBER = '0.39'; // Must be float value! (with a period as a decimal seperator)
+  VERSION_NUMBER = '0.40'; // Must be float value! (with a period as a decimal seperator)
   CHECK_BETA_LOBBY_URL = '<A HREF="http://tasclient.no-ip.org/TASClient_update_v2.txt">http://tasclient.no-ip.org/TASClient_update_v2.txt</A>';
-  PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER;
+  PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER + ' beta';
   KEEP_ALIVE_INTERVAL = 10000; // in milliseconds. Tells us what should be the maximum &quot;silence&quot; time before we send a ping to the server.
   ASSUME_TIMEOUT_INTERVAL = 30000; // in milliseconds. Must be greater than KEEP_ALIVE_INTERVAL! If server hasn't send any data to us within this interval, then we assume timeout occured. It's us who must make sure we get constant replies from server by pinging it.
   LOCAL_TAB = '$Local'; // caption of main (command) tab window. Must be special so that is different from channel names or user names, that is why there is a &quot;$&quot; in front of it.
@@ -550,11 +550,13 @@
   VAR_FOLDER = LOBBY_FOLDER + '\' + 'var';
   FILTERS_FOLDER = VAR_FOLDER + '\filters';
   REPLAY_FILTERS_FOLDER = VAR_FOLDER + '\replayFilters';
-  SPSKIN_FOLDER = LOBBY_FOLDER + '\SPSkins';
+  SPSKIN_FOLDER = LOBBY_FOLDER + '\SPThemes';
   SCRIPTS_FOLDER = LOBBY_FOLDER + '\Python\engine';
+  SCRIPTS_PROFILES_FOLDER = LOBBY_FOLDER + '\Python\scripts\layoutProfiles';
   FIRST_UDP_SOURCEPORT = 8300; // udp source port (used with &quot;fixed source ports&quot; NAT traversal technique) of the second (first one is host) client in clients list of the battle. Third client uses this+1 port, fourth one this+2, etc.
   AIDLL_FOLDER = 'AI/Bot-libs'; // searching for *.dll in this folder will return all bots that you can use to play with
   MAP_DOWNLOADER_ENABLED = False; // integrated map downloader is currently disabled as FileUniverse.com is no longer hosting spring content
+  CANT_WRITE_SCRIPT_MSG = 'Could''nt write the start script file ''script.txt'', try again ?';
 
   MAX_PLAYERS = 32; // max. players supported by Spring in a game
   MAX_TEAMS = 16; // max. teams supported by Spring in a game (MAX_ALLIES would be same as MAX_TEAMS, so no need for it)
@@ -578,6 +580,7 @@
   WM_AFTERCREATE = WM_USER + 12; // we send this signal once we've finished creating all forms. We will do some post-initialization here
   WM_REFRESHOUTPUT = WM_USER + 13; // used to refresh script debug output
   WM_SCRIPT = WM_USER + 14; // used to add a msg from a script to a textbox (tab RichEdit or battleform)
+  WM_UNLOCK_WINDOW = WM_USER +15; // used to unlock the menu form display to avoid white flashes
 
   QUEUE_LENGTH = 4096;
 
@@ -907,6 +910,7 @@
     constructor Create(Script: string);
     destructor Destroy; override;
     function ReadMapName: string;
+    function ReadMaphash: string;
     function ReadModName: string;
     function ReadStartMetal: Integer;
     function ReadStartEnergy: Integer;
@@ -1074,7 +1078,6 @@
     mnuDarkStars: TSpTBXItem;
     SubMenuEvolutionRTS: TSpTBXSubmenuItem;
     mnuEvolutionRTSMods: TSpTBXItem;
-    btSearchPlayer: TSpTBXSpeedButton;
     SearchPlayerFormPopupMenu: TSpTBXFormPopupMenu;
     mnuQuickJoinPanel: TSpTBXItem;
     Splitter1: TSpTBXSplitter;
@@ -1154,11 +1157,15 @@
     ConnectButton: TTBXButton;
     SinglePlayerButton: TSpTBXButton;
     Bevel2: TBevel;
-    BotImage: TImage;
-    DefaultArmImage: TImage;
+    OpenLogs1: TSpTBXItem;
+    PlayersInfoPanel: TSpTBXPanel;
+    btSearchPlayer: TSpTBXSpeedButton;
+    PlayersLabel: TSpTBXLabel;
+    SortLabel: TLabel;
     DefaultSideImage: TImage;
     DefaultCoreImage: TImage;
-    OpenLogs1: TSpTBXItem;
+    DefaultArmImage: TImage;
+    BotImage: TImage;
     procedure mnuOpenPrivateChatClick(Sender: TObject);
     procedure mnuSelectBattleClick(Sender: TObject);
     procedure SpTBXItem1Click(Sender: TObject);
@@ -1290,12 +1297,10 @@
     procedure RichEditURLClick(Sender: TObject; URL: String);
     procedure mnuTipsClick(Sender: TObject);
     procedure OpenLogs1Click(Sender: TObject);
+    procedure Button10Click(Sender: TObject);
   published
     MainTitleBar: TSpTBXTitleBar;
     Panel2: TSpTBXPanel;
-    Bevel1: TBevel;
-    PlayersLabel: TSpTBXLabel;
-    SortLabel: TLabel;
     ButtonImageList: TImageList;
     PlayerStateImageList: TImageList;
     ConnectionStateImageList: TImageList;
@@ -1677,7 +1682,7 @@
   AwayMessageFormUnit,JclStrings, SearchPlayerFormUnit, MenuFormUnit, Utility,
   PythonScriptDebugFormUnit,LobbyScriptUnit, SpringDownloaderFormUnit,
   SyncObjs, LogonFormUnit, MapSelectionFormUnit, TipsFormUnit,
-  ColorsPreferenceUnit;
+  ColorsPreferenceUnit, CustomizeGUIFormUnit, SetValuesFormUnit;
 
 {$R *.dfm}
 
@@ -1877,6 +1882,13 @@
     Exit;
   end;
 
+  // Shift+Ctrl+F8 to show the CustomizeGUI form:
+  if (Msg.CharCode = VK_F8) and (GetKeyState(VK_SHIFT) &lt; 0) and (GetKeyState(VK_CONTROL) &lt; 0) then
+  begin
+    CustomizeGUIForm.Show;
+    Exit;
+  end;
+
   // F1 to show the help
   if (Msg.CharCode = VK_F1) then
   begin
@@ -2997,17 +3009,27 @@
   if Result = '' then
   begin
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
 end;
 
+function TScript.ReadMaphash: string;
+begin
+  Result := ReadKeyValue('GAME/MAPHASH');
+  if Result = '' then
+  begin
+    self.Corrupted := true;
+    raise Exception.Create('Corrupted script file!');
+  end;
+end;
+
 function TScript.ReadModName: string;
 begin
   Result := ReadKeyValue('GAME/GAMETYPE');
   if Result = '' then
   begin
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
 end;
 
@@ -3019,13 +3041,13 @@
   if tmp = '' then
   begin
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
   try
     Result := StrToInt(tmp);
   except
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
 end;
 
@@ -3037,13 +3059,13 @@
   if tmp = '' then
   begin
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
   try
     Result := StrToInt(tmp);
   except
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
 end;
 
@@ -3055,13 +3077,13 @@
   if tmp = '' then
   begin
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
   try
     Result := StrToInt(tmp);
   except
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
 end;
 
@@ -3073,13 +3095,13 @@
   if tmp = '' then
   begin
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
   try
     Result := StrToInt(tmp);
   except
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
 end;
 
@@ -3091,7 +3113,7 @@
   if tmp = '' then
   begin
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
   try
     Result := StrToInt(tmp);
@@ -3109,13 +3131,13 @@
   if tmp = '' then
   begin
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
   try
     Result := StrToBool(tmp);
   except
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
 end;
 
@@ -3127,13 +3149,13 @@
   if tmp = '' then
   begin
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
   try
     Result := StrToBool(tmp);
   except
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
 end;
 
@@ -3151,7 +3173,7 @@
     Result := StrToBool(tmp);
   except
     self.Corrupted := true;
-    raise Exception.Create('Corrupt script file!');
+    raise Exception.Create('Corrupted script file!');
   end;
 end;
 
@@ -3176,7 +3198,7 @@
   i: Integer;
 begin
   i := CompleteKeyList.IndexOf(LowerCase('GAME/HOSTIP'));
-  if i = -1 then raise Exception.Create('Corrupt script file!');
+  if i = -1 then raise Exception.Create('Corrupted script file!');
   KeyValueList[i] := NewIP;
 end;
 
@@ -3185,7 +3207,7 @@
   i: Integer;
 begin
   i := CompleteKeyList.IndexOf(LowerCase('GAME/HOSTPORT'));
-  if i = -1 then raise Exception.Create('Corrupt script file!');
+  if i = -1 then raise Exception.Create('Corrupted script file!');
   KeyValueList[i] := NewPort;
 end;
 
@@ -3194,7 +3216,7 @@
   i: Integer;
 begin
   i := CompleteKeyList.IndexOf(LowerCase('GAME/MYPLAYERNUM'));
-  if i = -1 then raise Exception.Create('Corrupt script file!');
+  if i = -1 then raise Exception.Create('Corrupted script file!');
   KeyValueList[i] := IntToStr(NewNum);
 end;
 
@@ -3203,7 +3225,7 @@
   i: Integer;
 begin
   i := CompleteKeyList.IndexOf(LowerCase('GAME/NUMPLAYERS'));
-  if i = -1 then raise Exception.Create('Corrupt script file!');
+  if i = -1 then raise Exception.Create('Corrupted script file!');
   KeyValueList[i] := IntToStr(NewNum);
 end;
 
@@ -3329,7 +3351,7 @@
   ScriptLines := TStringList.Create;
   writtenKeys := TStringList.Create;
   WriteScriptKeys(ScriptLines,'',writtenKeys,False);
-  Result := Misc.JoinStringList(ScriptLines,EOL);
+  Result := Misc.JoinStringList(ScriptLines,EOL)+EOL;
   ScriptLines.Free;
   writtenKeys.Free;
 end;
@@ -3692,11 +3714,11 @@
     // finally apply post-initialization preferences:
     PreferencesForm.ApplyPostInitializationPreferences;
 
-    {if not RunningUnderWine then
+    if not RunningUnderWine then
     begin
       SplashScreenForm.UpdateText('loading menu ...');
       MenuForm.LoadSkin(Preferences.SPSkin);
-    end;}
+    end;
 
     // hide splash screen:
     SplashScreenForm.Close;
@@ -3710,7 +3732,9 @@
     SearchFormPopupMenu.PopupForm := SearchForm;
     SearchPlayerFormPopupMenu.PopupForm := SearchPlayerForm;
     BattleForm.MapsPopupMenu.PopupForm := MapSelectionForm;
+    CustomizeGUIForm.SetValuesPopupMenu.PopupForm := SetValuesForm;
 
+
     if Preferences.ConnectOnStartup and  not RunningWithMainMenu then
     begin
       LogonForm.Hide;
@@ -3846,12 +3870,19 @@
   mask: Word;
   FileName: string;
   logsLastLines : string;
+  tabName: string;
 begin
   Result := -1;
 
   tmpts := TMyTabSheet.Create(PageControl1);
 
   tmpts.Caption := Caption;
+  tabName := 'TabSheet_'+Caption;
+  tabName := StringReplace(tabName,'$','Internal_',[rfReplaceAll]);
+  tabName := StringReplace(tabName,'#','Channel_',[rfReplaceAll]);
+  tabName := StringReplace(tabName,'[','_OB_',[rfReplaceAll]);
+  tabName := StringReplace(tabName,']','_EB_',[rfReplaceAll]);
+  tmpts.Name := tabName;
 
   tmped := TTntMemo.Create(tmpts);
   tmped.Parent := tmpts;
@@ -3889,6 +3920,7 @@
   tmpre.AutoURLDetect := adDefault;
   tmpre.OnDblClick := RichEditDblClick;
   tmpre.OnURLClick := RichEditURLClick;
+  tmpre.Name := 'RichEdit';
 
   // enable auto URL detection:
   mask := SendMessage(tmpre.Handle, EM_GETEVENTMASK, 0, 0);
@@ -10768,8 +10800,8 @@
 
 procedure TMainForm.initLobbyScript;
 begin
+  RegisterClasses([TSpTBXDock, TSpTBXMultiDock, TSpTBXToolbar, TSpTBXDockablePanel, TSpTBXTabSet, TSpTBXTabControl, TSpTBXStatusBar, TSpTBXLabel, TSpTBXCheckBox, TSpTBXRadioButton, TSpTBXProgressBar, TSpTBXTrackBar, TSpTBXSplitter, TSpTBXPanel, TSpTBXGroupBox, TSpTBXRadioGroup, TSpTBXEdit,TSpTBXSpinEdit, TSpTBXComboBox,TSpTBXListBox, TSpTBXCheckListBox, TExRichEdit, TImage32, TSpTBXButton]);
   if Preferences.DisableScripts then Exit;
-  RegisterClasses([TSpTBXDock, TSpTBXMultiDock, TSpTBXToolbar, TSpTBXDockablePanel, TSpTBXTabSet, TSpTBXTabControl, TSpTBXStatusBar, TSpTBXLabel, TSpTBXCheckBox, TSpTBXRadioButton, TSpTBXProgressBar, TSpTBXTrackBar, TSpTBXSplitter, TSpTBXPanel, TSpTBXGroupBox, TSpTBXRadioGroup, TSpTBXEdit,TSpTBXSpinEdit, TSpTBXComboBox,TSpTBXListBox, TSpTBXCheckListBox, TExRichEdit, TImage32]);
   PyEngine.LoadDll;
   with GetPythonEngine do
   begin
@@ -10858,4 +10890,12 @@
   ShellExecute(0,'open',PChar((PageControl1.ActivePage as TMyTabSheet).LogFileName),nil,nil,SW_SHOWNORMAL);
 end;
 
+procedure TMainForm.Button10Click(Sender: TObject);
+begin
+  try
+    raise Exception.Create('test');
+  except
+  end;
+end;
+
 end.

Modified: Lobby/TASClient/MenuFormUnit.dfm
===================================================================
--- Lobby/TASClient/MenuFormUnit.dfm	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/MenuFormUnit.dfm	2008-10-22 18:44:31 UTC (rev 6853)
@@ -1,6 +1,6 @@
 object MenuForm: TMenuForm
-  Left = 765
-  Top = 302
+  Left = 642
+  Top = 70
   BorderStyle = bsNone
   Caption = 'MenuForm'
   ClientHeight = 671

Modified: Lobby/TASClient/MenuFormUnit.pas
===================================================================
--- Lobby/TASClient/MenuFormUnit.pas	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/MenuFormUnit.pas	2008-10-22 18:44:31 UTC (rev 6853)
@@ -33,6 +33,7 @@
 
     procedure GetCurrentLuaFile;
     procedure LoadReturnFile;
+    procedure StartMission(missionName: string);
     //procedure ResetCampaign;
 
     property CampaignName: string read FName;
@@ -163,13 +164,13 @@
     function replaceParams(code: string;fileName: string;htmlTag: string;names: TStrings; values: TStrings):string;
     procedure SaveMinimapToFile;
     procedure StartSkirmish;
-    procedure StartMission;
     function GenerateScript(FileName: string):boolean;
     function playerHasWon(scriptFileName: string): boolean;
     procedure SaveSettings;
     procedure LoadSettings;
     procedure ListSkins;
     procedure LoadSkin(skinFile: string);
+    procedure OnUnlockMessage(var Msg: TMessage); message WM_UNLOCK_WINDOW;
   end;
 
 var
@@ -289,7 +290,7 @@
   end;
 
   if missionsAccomplishedList.Count &gt; 0 then
-    FCurrentReturnLua := FCampaignProgressDir + '/' + missionsAccomplishedList[missionsAccomplishedList.Count-1]
+    FCurrentReturnLua := FCampaignProgressDir + '/' + missionsAccomplishedList[missionsAccomplishedList.Count-1] + '/return.lua'
   else
     FCurrentReturnLua := FLuaFileName;
 end;
@@ -363,7 +364,94 @@
   Utility.lpClose;
 end;
 
+procedure TCampaign.StartMission(missionName: string);
+var
+  missionId: integer;
+  s: TScript;
+  tryToRewriteScript: boolean;
+  f: TextFile;
+  scriptWritten: boolean;
+begin
+  // get the mission information
+  if (missionName = '') and not FIsCampaign then
+    missionId := 0
+  else
+  begin
+    missionId := FNextMissionsName.IndexOf(missionName);
+    if missionId = -1 then
+      Raise Exception.Create('Mission name incorrect.');
+  end;
 
+  s := TScript.Create(ReadVFSFile(FNextMissionsScriptPath[missionId]));
+
+  // check the map and maphash
+  if Utility.MapList.IndexOf(s.ReadMapName) = -1 then
+  begin
+    MessageDlg('You need the map &quot;'+s.ReadMapName+'&quot; to play this mission.',mtWarning,[mbOk],0);
+    s.Destroy;
+    Exit;
+  end;
+  if Utility.MapChecksums.IndexOf(s.ReadMaphash) = -1 then
+  begin
+    MessageDlg('Your map differs with the one needed by the mission. Please redownload the map to play this mission.',mtWarning,[mbOk],0);
+    s.Destroy;
+    Exit;
+  end;
+
+
+  // make the directory of mission return file and add the path to the script
+  MakePath(StringReplace(ExtractFilePath(Application.ExeName) + FCampaignProgressDir,'/','\',[rfReplaceAll])+'\'+missionName);
+  s.AddOrChangeKeyValue('GAME/ReturnPath',FCampaignProgressDir+'/'+missionName);
+
+  // write down the script
+  repeat
+  try
+    AssignFile(f, ExtractFilePath(Application.ExeName)+'script.txt');
+    Rewrite(f);
+    Write(f, s.Script);
+    CloseFile(f);
+    tryToRewriteScript := False;
+    scriptWritten := True;
+  except
+    scriptWritten := False;
+    try
+      CloseFile(f);
+    except
+      //
+    end;
+    tryToRewriteScript := MessageDlg(CANT_WRITE_SCRIPT_MSG,mtError,[mbYes,mbNo],0) = mrYes;
+  end;
+  until not tryToRewriteScript;
+  s.Free;
+
+  if not scriptWritten then
+    Exit;
+
+  // launch spring
+  FillChar(MenuForm.Process.proc_info, sizeof(TProcessInformation), 0);
+  FillChar(MenuForm.Process.startinfo, sizeof(TStartupInfo), 0);
+  MenuForm.Process.startinfo.cb := sizeof(TStartupInfo);
+
+  try
+    if CreateProcess(nil, PChar(ExtractFilePath(Application.ExeName) + 'spring.exe script.txt'), nil, nil, false, CREATE_DEFAULT_ERROR_MODE + NORMAL_PRIORITY_CLASS,
+                   nil, PChar(ExtractFilePath(Application.ExeName)), MenuForm.Process.startinfo, MenuForm.Process.proc_info) then
+    begin
+      MenuForm.tmrMusic.Enabled := false;
+      if MenuForm.MP1.Mode = mpPlaying then
+        MenuForm.MP1.Pause;
+      MenuForm.GameTimer.Enabled := True;
+    end
+    else
+    begin
+      CloseHandle(MenuForm.Process.proc_info.hProcess);
+      Application.MessageBox('Couldn''t execute the application', 'Error', MB_ICONEXCLAMATION);
+    end;
+  except
+    Application.MessageBox('An error occured while starting the mission.', 'Error', MB_ICONEXCLAMATION);
+  end;
+end;
+
+
 procedure TMenuForm.CreateParams(var Params: TCreateParams);
 begin
   inherited CreateParams(Params);
@@ -385,6 +473,8 @@
 var
   i: integer;
 begin
+  LockWindowUpdate(MenuForm.Handle);
+
   paramNames := TStringList.Create;
   paramValues := TStringList.Create;
   settingsNames := TStringList.Create;
@@ -519,9 +609,6 @@
       if tmpStr = 'TLuaOptionList' then
       begin
         tmp := ReadFile2(MenuCurrentPath+'luaListOption.html');
-        tmp := StringReplace(tmp,'[luaOptionId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
-        tmp := StringReplace(tmp,'[luaOptionName]',TLuaOptionList(options[i]).Name,[rfReplaceAll,rfIgnoreCase]);
-        tmp := StringReplace(tmp,'[luaOptionDescription]',TLuaOptionList(options[i]).Description,[rfReplaceAll,rfIgnoreCase]);
         varHtmlCode3 := '';
         for j := 0 to TLuaOptionList(options[i]).NameList.Count-1 do
         begin
@@ -533,6 +620,10 @@
           varHtmlCode3 := varHtmlCode3 + tmp2;
         end;
         tmp := StringReplace(tmp,'[luaOptionList]',varHtmlCode3,[rfReplaceAll,rfIgnoreCase]);
+
+        tmp := StringReplace(tmp,'[luaOptionId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionName]',TLuaOptionList(options[i]).Name,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionDescription]',TLuaOptionList(options[i]).Description,[rfReplaceAll,rfIgnoreCase]);
         tmp := StringReplace(tmp,'[luaOptionValue]',TLuaOptionList(options[i]).toString,[rfReplaceAll,rfIgnoreCase]);
       end;
       Result := Result + tmp;
@@ -630,6 +721,53 @@
     htmlCode := StringReplace(htmlCode,'[MissionList]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
   end;
 
+  if (pageType = Skirmish) then // [GameEndCond] [MetalVisible] [MaxMetal] [EnergyVisible] [MaxEnergy] [UnitsVisible] [MaxUnits] [MinMetal] [MinEnergy] [MinUnits]
+  begin
+    // metal
+    htmlCode := StringReplace(htmlCode,'[MetalCaption]',BattleForm.lblMetal.Caption,[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MaxMetal]',IntToStr(BattleForm.MetalTracker.Maximum),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MinMetal]',IntToStr(BattleForm.MetalTracker.Minimum),[rfIgnoreCase,rfReplaceAll]);
+    if BattleForm.MetalTracker.Visible then
+      htmlCode := StringReplace(htmlCode,'[MetalVisible]','block',[rfIgnoreCase,rfReplaceAll])
+    else
+      htmlCode := StringReplace(htmlCode,'[MetalVisible]','none',[rfIgnoreCase,rfReplaceAll]);
+
+    // energy
+    htmlCode := StringReplace(htmlCode,'[EnergyCaption]',BattleForm.lblEnergy.Caption,[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MaxEnergy]',IntToStr(BattleForm.EnergyTracker.Maximum),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MinEnergy]',IntToStr(BattleForm.EnergyTracker.Minimum),[rfIgnoreCase,rfReplaceAll]);
+    if BattleForm.EnergyTracker.Visible then
+      htmlCode := StringReplace(htmlCode,'[EnergyVisible]','block',[rfIgnoreCase,rfReplaceAll])
+    else
+      htmlCode := StringReplace(htmlCode,'[EnergyVisible]','none',[rfIgnoreCase,rfReplaceAll]);
+
+    // maxunits
+    htmlCode := StringReplace(htmlCode,'[UnitsCaption]',BattleForm.lblUnits.Caption,[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MaxUnits]',IntToStr(BattleForm.UnitsTracker.Maximum),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MinUnits]',IntToStr(BattleForm.UnitsTracker.Minimum),[rfIgnoreCase,rfReplaceAll]);
+    if BattleForm.UnitsTracker.Visible then
+      htmlCode := StringReplace(htmlCode,'[UnitsVisible]','block',[rfIgnoreCase,rfReplaceAll])
+    else
+      htmlCode := StringReplace(htmlCode,'[UnitsVisible]','none',[rfIgnoreCase,rfReplaceAll]);
+
+    // game end condition
+    if BattleForm.GameEndRadioGroup.Visible then
+    begin
+      templateStr := ReadFile2(CurrentPath+'gameEndCondItem.html');
+      varHtmlCode := '';
+      for i:=0 to BattleForm.GameEndRadioGroup.Items.Count-1 do
+      begin
+        tmp := templateStr;
+        tmp := StringReplace(tmp,'[GameEndCondId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[GameEndCondName]',BattleForm.GameEndRadioGroup.Items[i],[rfReplaceAll,rfIgnoreCase]);
+        varHtmlCode := varHtmlCode + tmp;
+      end;
+      htmlCode := StringReplace(htmlCode,'[GameEndCond]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+    end
+    else
+      htmlCode := StringReplace(htmlCode,'[GameEndCond]','',[rfIgnoreCase,rfReplaceAll]);
+  end;
+
   if (pageType = Skirmish) then // [MAPLIST]
   begin
     // map html code is cached and refreshed only when needed to save cpu time
@@ -872,7 +1010,7 @@
 
       if pos3 = -1 then
       begin
-        MessageDlg('En error occured while parsing ''' + fileName + ''' at char ' + IntToStr(pos1)+EOL+'Usage : ['+htmlTag+':paramName:index:default(Optional)]',mtError,[mbOk],0);
+        MessageDlg('(1) En error occured while parsing ''' + fileName + ''' at char ' + IntToStr(pos1)+EOL+'Usage : ['+htmlTag+':paramName:index:default(Optional)]',mtError,[mbOk],0);
         Break;
       end;
 
@@ -893,7 +1031,7 @@
           arrayId := StrToInt(MidStr(tmpStr,pos3+1,999999));
         end;
       except
-        MessageDlg('En error occured while parsing ''' + fileName + ''' at char ' + IntToStr(pos1)+EOL+'Usage : [Lobby:LoadParam:paramName:index:default(Optional)]',mtError,[mbOk],0);
+        MessageDlg('(2) En error occured while parsing ''' + fileName + ''' at char ' + IntToStr(pos1)+EOL+'Usage : [Lobby:LoadParam:paramName:index:default(Optional)]',mtError,[mbOk],0);
         Break;
       end;
 
@@ -905,10 +1043,12 @@
         Misc.ParseDelimited(sl,values[tmpInt],':','');
         if sl.Count-1 &lt; arrayId then
         begin
-          MessageDlg('En error occured while parsing ''' + fileName + ''' at char ' + IntToStr(pos1)+EOL+'Array id incorrect: '+IntToStr(arrayId),mtError,[mbOk],0);
-          Break;
-        end;
-        Result := Result + LeftStr(varHtmlCode,pos1-1)+sl[arrayId];
+          Result := Result + LeftStr(varHtmlCode,pos1-1)+'';
+          //MessageDlg('(3) En error occured while parsing ''' + fileName + ''' at char ' + IntToStr(pos1)+EOL+'Array id incorrect: '+IntToStr(arrayId),mtError,[mbOk],0);
+          //Break;
+        end
+        else
+          Result := Result + LeftStr(varHtmlCode,pos1-1)+sl[arrayId];
       end;
       varHtmlCode := MidStr(varHtmlCode,pos2+1,MaxInt);
 
@@ -1004,81 +1144,17 @@
   end;
 end;
 
-procedure TMenuForm.StartMission;
-var
-  mapIndex: integer;
-  tmp: string;
-  //tmpMission: TMission;
-begin
-{
-  if TBrowsePage(BrowseHistory.Peek^).PageType = CampaignMission then
-    tmpMission := CurrentCampaignMission
-  else
-    tmpMission := TMission(MissionList[CurrentMissionIndex]^);
-  with tmpMission do
-  begin
-    mapIndex := Utility.MapList.IndexOf(descriptor.ReadKeyValue('mission/MapFile'));
-    if mapIndex = -1 then
-    begin
-      MessageDlg('To play this mission, you need that map : '+descriptor.ReadKeyValue('mission/MapFile'),mtWarning,[mbOk],0);
-      Exit;
-    end
-    else if Utility.ModArchiveList.IndexOf(descriptor.ReadKeyValue('mission/ModFile')) = -1 then
-    begin
-      MessageDlg('To play this mission, you need that mod : '+descriptor.ReadKeyValue('mission/ModFile'),mtWarning,[mbOk],0);
-      Exit;
-    end
-    else if Utility.GetModHash2(descriptor.ReadKeyValue('mission/ModFile')) &lt;&gt; StrToInt(descriptor.ReadKeyValue('mission/ModHash')) then
-    begin
-      MessageDlg('Your mod files differ from the required one.',mtWarning,[mbOk],0);
-      Exit;
-    end
-    else if Utility.MapChecksums[mapIndex] &lt;&gt; descriptor.ReadKeyValue('mission/MapHash') then
-    begin
-      MessageDlg('Your map file differs from the required one.',mtWarning,[mbOk],0);
-      Exit;
-    end;
-  end;
-
-  FillChar(Process.proc_info, sizeof(TProcessInformation), 0);
-  FillChar(Process.startinfo, sizeof(TStartupInfo), 0);
-  Process.startinfo.cb := sizeof(TStartupInfo);
-
-  try
-    CopyFile(PChar(MissionCurrentPath+'script.txt'),PChar(ExtractFilePath(Application.ExeName)+'script.txt'),true);
-    CopyFile(Pchar(MissionCurrentPath+'MissionMutator.sd7'),PChar(ExtractFilePath(Application.ExeName)+'mods\MissionMutator.sd7'),true);
-
-    if CreateProcess(nil, PChar(ExtractFilePath(Application.ExeName) + 'spring.exe &quot;'+MissionCurrentPath+'script.txt&quot;'), nil, nil, false, CREATE_DEFAULT_ERROR_MODE + NORMAL_PRIORITY_CLASS,
-                   nil, PChar(ExtractFilePath(Application.ExeName)), Process.startinfo, Process.proc_info) then
-    begin
-      tmrMusic.Enabled := false;
-      if MP1.Mode = mpPlaying then
-        MP1.Pause;
-      GameTimer.Enabled := True;
-    end
-    else
-    begin
-      CloseHandle(Process.proc_info.hProcess);
-      Application.MessageBox('Couldn''t execute the application', 'Error', MB_ICONEXCLAMATION);
-    end;
-  except
-    Application.MessageBox('An error occured while starting the mission.', 'Error', MB_ICONEXCLAMATION);
-  end;}
-end;
-
 function TMenuForm.GenerateScript(FileName: string):boolean;
 var
   script: TScript;
   i: integer;
   tmpInt: integer;
   il: TIntegerList;
-  sl: TStringList;
   TeamAllyCounter: TIntegerList;
   Colors: TStringList;
   tryToRewriteScript: boolean;
   f: TextFile;
 begin
-  sl := TStringList.Create;
   il := TIntegerList.Create;
   TeamAllyCounter := TIntegerList.Create;
   Colors := TStringList.Create;
@@ -1094,17 +1170,18 @@
   end;
   script.AddOrChangeKeyValue('GAME/GameType',Utility.ModArchiveList[Utility.ModList.IndexOf(BattleForm.CurrentModName)]);
   script.AddOrChangeKeyValue('GAME/ModHash',IntToStr(Utility.GetModHash(BattleForm.CurrentModName)));
-  script.AddOrChangeKeyValue('GAME/diminishingmms',IntToStr(BoolToInt(DiminishMM)));
-  script.AddOrChangeKeyValue('GAME/ghostedbuildings',IntToStr(BoolToInt(GhostedB)));
-  script.AddOrChangeKeyValue('GAME/limitdgun',IntToStr(BoolToInt(LimitDGun)));
-  script.AddOrChangeKeyValue('GAME/gamemode',IntToStr(GameType));
+  if BattleForm.GameEndRadioGroup.Visible then
+    script.AddOrChangeKeyValue('GAME/modoptions/gamemode',IntToStr(GameType));
   if GameMode = 0 then
     script.AddOrChangeKeyValue('GAME/startpostype','3')
   else
     script.AddOrChangeKeyValue('GAME/startpostype',IntToStr(GameMode));
-  script.AddOrChangeKeyValue('GAME/maxunits',IntToStr(MaxUnits));
-  script.AddOrChangeKeyValue('GAME/startenergy',IntToStr(StartEnergy));
-  script.AddOrChangeKeyValue('GAME/startmetal',IntToStr(StartMetal));
+  if BattleForm.UnitsTracker.Visible then
+    script.AddOrChangeKeyValue('GAME/modoptions/maxunits',IntToStr(MaxUnits));
+  if BattleForm.EnergyTracker.Visible then
+    script.AddOrChangeKeyValue('GAME/modoptions/startenergy',IntToStr(StartEnergy));
+  if BattleForm.MetalTracker.Visible then
+    script.AddOrChangeKeyValue('GAME/modoptions/startmetal',IntToStr(StartMetal));
   script.AddOrChangeKeyValue('GAME/HostIP','localhost');
   script.AddOrChangeKeyValue('GAME/HostPort','8452');
   script.AddOrChangeKeyValue('GAME/MyPlayerNum','0');
@@ -1222,8 +1299,6 @@
       script.AddOrChangeKeyValue(TLuaOption(MapOptionsList[i]).KeyPrefix + TLuaOption(MapOptionsList[i]).Key,TLuaOption(MapOptionsList[i]).toString);
   end;
 
-  sl.Text := script.Script;
-  script.Free;
   il.Free;
 
   // write down the script
@@ -1231,8 +1306,7 @@
   try
     AssignFile(f, FileName);
     Rewrite(f);
-    for i := 0 to sl.Count-1 do Writeln(f, sl[i]);
-    sl.Free;
+    Write(f, script.Script);
     CloseFile(f);
     tryToRewriteScript := False;
     Result := True;
@@ -1243,9 +1317,11 @@
     except
       //
     end;
-    tryToRewriteScript := MessageDlg('Could''nt write the start script file ''script.txt'', try again ?',mtError,[mbYes,mbNo],0) = mrYes;
+    tryToRewriteScript := MessageDlg(CANT_WRITE_SCRIPT_MSG,mtError,[mbYes,mbNo],0) = mrYes;
   end;
   until not tryToRewriteScript;
+
+  script.Free;
 end;
 
 function TMenuForm.getBotIndex(id: integer): integer;
@@ -1271,6 +1347,7 @@
   tmp: integer;
   tmpStr: string;
   sl: TStringList;
+  sl2: TStringList;
   bot: ^TAIItem;
   browsePage: ^TBrowsePage;
 begin
@@ -1282,6 +1359,7 @@
   end;
 
   sl := TStringList.Create;
+  sl2 := TStringList.Create;
 
   Cancel := true;
   // disable the click sound
@@ -1432,39 +1510,13 @@
       end;
       Exit;
     end;
-    if LeftStr(LowerCase(command),12) = 'pickmission:' then
+    if LeftStr(LowerCase(command),13) = 'startmission:' then
     begin
-      {tmpStr := MidStr(command,13,99999);
+      tmpStr := MidStr(command,14,99999);
 
-      Misc.ParseDelimited(sl,tmpStr,':','');
+      TCampaign(CampaignList[CurrentCampaignIndex]).StartMission(tmpStr);
 
-      if (sl.Count &lt;&gt; 2) and (sl.Count &lt;&gt; 3) then
-      begin
-        MessageDlg('Invalid pickmission usage : '+command,mtError,[mbOk],0);
-        Exit;
-      end;
-
-      CurrentWinStep := sl[1];
-      if (sl.Count = 3) then
-        CurrentLostStep := sl[2]
-      else
-        CurrentLostStep := '';
-
-      CurrentCampaignMission.FileName := CampaignCurrentPath+sl[0];
-      CurrentCampaignMission.descriptor.Script :=  Utility.GetArchiveDescriptor(CurrentCampaignMission.FileName);
-      CurrentCampaignMission.UseHTML := CurrentCampaignMission.descriptor.ReadKeyValue('mission/htmlbriefing') &lt;&gt; '';
-
-      with CurrentCampaignMission do
-      begin
-        ExtractMissionFiles(FileName);
-        if UseHTML then
-          LoadMenu(descriptor.ReadKeyValue('mission/htmlbriefing'),CampaignMission)
-        else
-          LoadMenu('defaultMissionBriefing.html',CampaignMission);
-      end;
-
-      sl.Free;
-      Exit;}
+      Exit;
     end;
     if LeftStr(LowerCase(command),10) = 'selectmap:' then
     begin
@@ -1535,6 +1587,34 @@
       LoadMenu('modMain.html',ModMain);
       Exit;
     end;
+    if LeftStr(LowerCase(command),17) = 'saveparambyindex:' then
+    begin
+      tmpStr := MidStr(command,18,99999);
+      Misc.ParseDelimited(sl,tmpStr,':','');
+      if sl.Count &lt;&gt; 3 then
+      begin
+        MessageDlg('Invalid saveparambyindex usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+      tmp := paramNames.IndexOf(sl[0]);
+      if tmp = -1 then
+      begin
+        paramNames.Add(sl[0]);
+        paramValues.Add(StringNChar(':',StrToInt(sl[1]))+sl[2]);
+      end
+      else
+      begin
+        Misc.ParseDelimited(sl2,paramValues[tmp],':','');
+        if sl2.Count &lt;= StrToInt(sl[1]) then
+          for i:=0 to StrToInt(sl[1])-sl2.Count do
+            sl2.Add('');
+        sl2[StrToInt(sl[1])] := sl[2];
+        paramValues[tmp] := Misc.JoinStringList(sl2,':');
+      end;
+      sl.Free;
+      Exit;
+    end;
     if LeftStr(LowerCase(command),10) = 'saveparam:' then
     begin
       tmpStr := MidStr(command,11,99999);
@@ -1613,24 +1693,6 @@
       GameMode := StrToInt(tmpStr);
       Exit;
     end;
-    if LeftStr(LowerCase(command),16) = 'changelimitdgun:' then
-    begin
-      tmpStr := MidStr(command,17,99999);
-      LimitDGun := StrToBool(tmpStr);
-      Exit;
-    end;
-    if LeftStr(LowerCase(command),15) = 'changeghostedb:' then
-    begin
-      tmpStr := MidStr(command,16,99999);
-      GhostedB := StrToBool(tmpStr);
-      Exit;
-    end;
-    if LeftStr(LowerCase(command),17) = 'changediminishmm:' then
-    begin
-      tmpStr := MidStr(command,18,99999);
-      DiminishMM := StrToBool(tmpStr);
-      Exit;
-    end;
     if LeftStr(LowerCase(command),26) = 'changeminimapstartpossize:' then
     begin
       tmpStr := MidStr(command,27,99999);
@@ -1890,12 +1952,6 @@
       //Misc.VariantToString(PostData)
       Exit;
     end;
-    if LowerCase(command) = 'startmission' then
-    begin
-      StartMission;
-      //Misc.VariantToString(PostData)
-      Exit;
-    end;
 
     if LeftStr(LowerCase(command),10) = 'localfile:' then
     begin
@@ -1957,11 +2013,16 @@
       if MP1.Mode = mpPaused then
         MP1.Resume;
       browsePage := BrowseHistory.Peek;
-      if (browsePage^.PageType = CampaignMission) then
+      if (browsePage^.PageType = Campaign) or (browsePage^.PageType = Mission) then
+      begin
+        TCampaign(CampaignList[CurrentCampaignIndex]).GetCurrentLuaFile;
+        TCampaign(CampaignList[CurrentCampaignIndex]).LoadReturnFile;
+      end;
+      {*
         if playerHasWon(ExtractFilePath(Application.ExeName)+'infolog.txt') then
           LoadMenu(CurrentWinStep,Campaign)
         else if CurrentLostStep &lt;&gt; '' then
-          LoadMenu(CurrentLostStep,Campaign);
+          LoadMenu(CurrentLostStep,Campaign);*}
     end
   else
   begin
@@ -1971,11 +2032,11 @@
     if MP1.Mode = mpPaused then
         MP1.Resume;
     browsePage := BrowseHistory.Peek;
-    if (browsePage^.PageType = CampaignMission) then
-      if playerHasWon(ExtractFilePath(Application.ExeName)+'infolog.txt') then
-        LoadMenu(CurrentWinStep,Campaign)
-      else if CurrentLostStep &lt;&gt; '' then
-        LoadMenu(CurrentLostStep,Campaign);
+    if (browsePage^.PageType = Campaign) or (browsePage^.PageType = Mission) then
+    begin
+      TCampaign(CampaignList[CurrentCampaignIndex]).GetCurrentLuaFile;
+      TCampaign(CampaignList[CurrentCampaignIndex]).LoadReturnFile;
+    end;
   end;
 end;
 
@@ -1999,10 +2060,14 @@
   const pDisp: IDispatch; var URL: OleVariant);
 begin
     // to avoid white flashes
-    LockWindowUpdate(0);
-    htmlBrowser.WebBrowser.Repaint;
+    PostMessage(MenuForm.Handle,WM_UNLOCK_WINDOW,0,0);
 end;
 
+procedure TMenuForm.OnUnlockMessage(var Msg: TMessage);
+begin
+  LockWindowUpdate(0);
+end;
+
 function TMenuForm.playerHasWon(scriptFileName: string): boolean;
 var
   sl: TStringList;

Modified: Lobby/TASClient/Misc.pas
===================================================================
--- Lobby/TASClient/Misc.pas	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Misc.pas	2008-10-22 18:44:31 UTC (rev 6853)
@@ -143,7 +143,9 @@
 function URLDecode(const S: string): string;
 function URLEncode(const S: string; const InQueryString: Boolean): string;
 procedure SetProperty(Obj:TObject; propName: string; value: Variant);
-procedure GetProperties(Obj:TObject; nameList : TStrings; valueList : TList);
+procedure GetProperties(Obj:TObject; nameList : TStrings; valueList : TList; typeList: TStringList);
+procedure GetEnumPropertyList(Obj:TObject; name : string; enumList : TStringList);
+function StringNChar(c: char; n: integer): string;
 
 implementation
 
@@ -2302,10 +2304,11 @@
     begin
       case Proplist[i].PropType^.Kind of
         tkInteger :   SetOrdProp(Obj,Proplist[i].Name,Integer(value));
-        tkString :    SetStrProp(Obj,Proplist[i].Name,String(value));
+        tkString,tkLString :    SetStrProp(Obj,Proplist[i].Name,String(value));
         tkWString :   SetStrProp(Obj,Proplist[i].Name,WideString(value));
         tkFloat :     SetFloatProp(Obj,Proplist[i].Name,Extended(value));
-        tkEnumeration:
+        tkSet : SetSetProp(Obj,Proplist[i].Name,String(value));
+        tkEnumeration :
           if (GetEnumName(Proplist[i].PropType^,0) = 'False') and (GetEnumName(Proplist[i].PropType^,1) = 'True') then
             if Boolean(value) then
               SetEnumProp(Obj,Proplist[i].Name,'True')
@@ -2318,16 +2321,52 @@
     end;
 end;
 
-procedure GetProperties(Obj:TObject; nameList : TStrings; valueList : TList);
+procedure GetEnumPropertyList(Obj:TObject; name : string; enumList : TStringList);
 var
   PropList:PPropList;
+  count,i,j,count2 : Integer;
+  PT : PTypeData;
+  v: ^Variant;
+  canAdd: boolean;
+  typeStr: string;
+  s: string;
+  bp: PPTypeInfo;
+begin
+  enumList.Clear;
+
+  PT:=GetTypeData(Obj.ClassInfo);
+  Count := PT.PropCount;
+  GetMem(PropList,Count * SizeOf(PPropInfo));
+  count2 := GetPropList(Obj.ClassInfo, tkAny, PropList);
+  for i:=0 to count2 -1 do
+  begin
+    if (Proplist[i].Name = name) and (Proplist[i].PropType^.Kind = tkEnumeration) then
+    begin
+      for j:=GetTypeData(Proplist[i].PropType^).MinValue to GetTypeData(Proplist[i].PropType^).MaxValue do
+        enumList.Add(GetEnumName(Proplist[i].PropType^,j));
+    end;
+    if (Proplist[i].Name = name) and (Proplist[i].PropType^.Kind = tkSet) then
+    begin
+      bp := GetTypeData(Proplist[i].PropType^).CompType;
+      for j:=GetTypeData(bp^).MinValue to GetTypeData(bp^).MaxValue do
+        enumList.Add(GetEnumName(bp^,j));
+    end;
+  end;
+end;
+
+procedure GetProperties(Obj:TObject; nameList : TStrings; valueList : TList; typeList: TStringList);
+var
+  PropList:PPropList;
   count,i,count2 : Integer;
   PT : PTypeData;
   v: ^Variant;
+  o: TObject;
   canAdd: boolean;
+  typeStr: string;
 begin
   nameList.Clear;
   valueList.Clear;
+  typeList.Clear;
   canAdd := True;
 
   PT:=GetTypeData(Obj.ClassInfo);
@@ -2340,20 +2379,66 @@
       New(v);
     canAdd := True;
     case Proplist[i].PropType^.Kind of
-      tkInteger :     v^ := Variant(GetOrdProp(Obj,Proplist[i].Name));
-      tkString :      v^ := Variant(GetStrProp(Obj,Proplist[i].Name));
-      tkWString :     v^ := Variant(GetWideStrProp(Obj,Proplist[i].Name));
-      tkFloat :       v^ := Variant(GetFloatProp(Obj,Proplist[i].Name));
-      tkEnumeration:  v^ := Variant(GetEnumProp(Obj,Proplist[i].Name));
+      tkInteger :
+      begin
+        v^ := Variant(GetOrdProp(Obj,Proplist[i].Name));
+        typeStr := Proplist[i].PropType^.Name;
+      end;
+      tkString,tkLString :
+      begin
+        v^ := Variant(GetStrProp(Obj,Proplist[i].Name));
+        typeStr := 'tkString';
+      end;
+      tkWString :
+      begin
+        v^ := Variant(GetWideStrProp(Obj,Proplist[i].Name));
+        typeStr := 'tkWString';
+      end;
+      tkFloat :
+      begin
+        v^ := Variant(GetFloatProp(Obj,Proplist[i].Name));
+        typeStr := 'tkFloat';
+      end;
+      tkEnumeration:
+      begin
+        v^ := Variant(GetEnumProp(Obj,Proplist[i].Name));
+        typeStr := 'tkEnumeration'
+      end;
+      tkInterface,tkRecord,tkClass:
+      begin
+        o := GetObjectProp(Obj,Proplist[i].Name,TObject);
+        if o = nil then
+          canAdd := False;
+        typeStr := 'tkClass';
+      end;
+      tkSet:
+      begin
+        v^ := Variant(GetSetProp(Obj,Proplist[i].Name));
+        typeStr := 'tkSet';
+      end;
     else
       canAdd := False;
     end;
     if canAdd then
     begin
       nameList.Add(Proplist[i].Name);
-      valueList.Add(v);
+      if Proplist[i].PropType^.Kind = tkClass then
+        valueList.Add(o)
+      else
+        valueList.Add(v);
+      typeList.Add(typeStr);
     end;
   end;
 end;
 
+function StringNChar(c: char; n: integer): string;
+begin
+  Result := '';
+  while n &gt; 0 do
+  begin
+    Result := Result + c;
+    Dec(n);
+  end;
+end;
+
 end.

Modified: Lobby/TASClient/PreferencesFormUnit.pas
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.pas	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/PreferencesFormUnit.pas	2008-10-22 18:44:31 UTC (rev 6853)
@@ -292,8 +292,8 @@
                                         UseSoundNotifications: True;AutoCompletionFromCurrentChannel: False; AutoUpdateToBeta: False;DisplayUnitsIconsAndNames: False;
                                         UseProxy: False; HighlightColor: 'Green'; UseNotificationsForHighlights: True; UseIgnoreList: False; WarnIfUsingNATTraversing: True;
                                         AutoFocusOnPM: True; MapSortStyle: 1; ThemeType: thtTBX; Theme: 'Miranda'; DisableAllSounds: False; SortLocal: False;
-                                        DisplayQuickJoinPanel : True; LimitChatLogs: False; ChatLogsLimit: 800; SPSkin: 'default.ssk'; DisableScripts : True;
-                                        EnableScripts : False; EnableSpringDownloader : True; UseLogonForm : True);
+                                        DisplayQuickJoinPanel : True; LimitChatLogs: False; ChatLogsLimit: 800; SPSkin: 'default.ssk'; DisableScripts : False;
+                                        EnableScripts : True; EnableSpringDownloader : True; UseLogonForm : True);
 
 var
   PreferencesForm: TPreferencesForm;
@@ -382,7 +382,7 @@
     try Preferences.UploadReplay := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Preferences', 'AskUploadReplay'); except end;
     try Preferences.DisplayQuickJoinPanel := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Preferences', 'DisplayQuickJoinPanel'); except end;
     try
-      Preferences.EnableScripts := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Preferences', 'EnableScripts');
+      Preferences.EnableScripts := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Preferences', 'ScriptsEnabled');
       Preferences.DisableScripts := not Preferences.EnableScripts;
     except end;
     try Preferences.LimitChatLogs := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Preferences', 'LimitChatLogs'); except end;
@@ -390,7 +390,7 @@
       Preferences.ChatLogsLimit := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Preferences', 'ChatLogsLimit');
       Preferences.ChatLogsLimit := max(ChatLogsLimitTracker.Min,min(ChatLogsLimitTracker.Max,Preferences.ChatLogsLimit));
     except end;
-    try Preferences.SPSkin := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Preferences', 'SPSkin'); except end;
+    try Preferences.SPSkin := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Preferences', 'SPTheme'); except end;
 
 
     try CommonFont.Name := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Preferences', 'FontName'); except end;
@@ -442,7 +442,7 @@
       end;
     FixFormBounds(MainForm);
 
-    try BattleForm.Left := GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\BattleForm', 'Left'); except end;
+    try BattleForm.Left := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\BattleForm', 'Left'); except end;
     try BattleForm.Top := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\BattleForm', 'Top'); except end;
     try BattleForm.Width := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\BattleForm', 'Width'); except end;
     try BattleForm.Height := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\BattleForm', 'Height'); except end;
@@ -471,7 +471,7 @@
       end;
     FixFormBounds(BattleForm);
 
-    try OnlineMapsForm.Left := GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\OnlineMapsForm', 'Left'); except end;
+    try OnlineMapsForm.Left := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\OnlineMapsForm', 'Left'); except end;
     try OnlineMapsForm.Top := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\OnlineMapsForm', 'Top'); except end;
     try OnlineMapsForm.Width := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\OnlineMapsForm', 'Width'); except end;
     try OnlineMapsForm.Height := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\OnlineMapsForm', 'Height'); except end;
@@ -488,7 +488,7 @@
     try HostBattleForm.NATRadioGroup.ItemIndex := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\HostBattleForm', 'NATTechnique'); except end;
     try HostBattleForm.PlayersTracker.Value := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\HostBattleForm', 'NbPlayer'); except end;
 
-    try MapListForm.Left := GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\MapListForm', 'Left'); except end;
+    try MapListForm.Left := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\MapListForm', 'Left'); except end;
     try MapListForm.Top := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\MapListForm', 'Top'); except end;
     try MapListForm.Width := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\MapListForm', 'Width'); except end;
     try MapListForm.Height := Misc.GetRegistryData(HKEY_CURRENT_USER, '\Software\TASClient\Forms\MapListForm', 'Height'); except end;

Modified: Lobby/TASClient/Python/api.txt
===================================================================
--- Lobby/TASClient/Python/api.txt	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Python/api.txt	2008-10-22 18:44:31 UTC (rev 6853)
@@ -71,8 +71,8 @@
 - DisplayNotification(title, msg, argsTuple, onClickModuleName, onClickFunctionName, displayTime)
 - DisplaySimpleNotification(title, msg, displayTime)
 	displayTime in ms
-- GetControlProperties(controlName)
-- SetControlProperties(controlName, properties)
+- GetControlProperties(controlName,controlClassTypePropertyPath)
+- SetControlProperties(controlName,controlClassTypePropertyPath, properties)
 - AddControl(name, parent, className)
 	classname = [TSpTBXDock, TSpTBXMultiDock, TSpTBXToolbar, TSpTBXDockablePanel, TSpTBXTabSet, TSpTBXTabControl, TSpTBXStatusBar, TSpTBXLabel, TSpTBXCheckBox, TSpTBXRadioButton, TSpTBXProgressBar, TSpTBXTrackBar, TSpTBXSplitter, TSpTBXPanel, TSpTBXGroupBox, TSpTBXRadioGroup, TSpTBXEdit,TSpTBXSpinEdit, TSpTBXComboBox,TSpTBXListBox, TSpTBXCheckListBox, TExRichEdit, TImage32]
 	
@@ -83,6 +83,8 @@
 - AddToRichEdit(textbox, msg, color)
 - AddDropDownButton(caption, buttonName, menuName, parent)
 	Adds a button with a drop down menu. You can handle the menu with the AddItemToMenu etc functions with 'Parent.menuName' for menu id. If the drop down menu contains only one item, then clicking on the button will execute that item and no menu will be displayed.
+- StackLayoutChanges(True/False)
+	Save layout changes (add control, change control properties) in the CustomizeGUI editor stack. (So saving new profiles will include theses changes)
 
 
 

Modified: Lobby/TASClient/Python/scripts/subf/dropDownButtonTest.py
===================================================================
--- Lobby/TASClient/Python/scripts/subf/dropDownButtonTest.py	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Python/scripts/subf/dropDownButtonTest.py	2008-10-22 18:44:31 UTC (rev 6853)
@@ -4,9 +4,9 @@
 gui = lobbyscript.GUI()
 
 def changeComponentProp(comp,prop,value):
-  p = gui.GetControlProperties(comp)
+  p = gui.GetControlProperties(comp,'')
   p[prop] = value
-  return gui.SetControlProperties(comp,p)
+  return gui.SetControlProperties(comp,'',p)
 
 def _init():
   gui.AddDropDownButton('Quick host','OptsBt','OptsMenu','MainForm.Panel4')

Modified: Lobby/TASClient/Python/scripts/subf/frenchTranslationTest.py
===================================================================
--- Lobby/TASClient/Python/scripts/subf/frenchTranslationTest.py	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Python/scripts/subf/frenchTranslationTest.py	2008-10-22 18:44:31 UTC (rev 6853)
@@ -6,10 +6,10 @@
 api = lobbyscript.Callback()
 gui = lobbyscript.GUI()
 
-def changeControlProp(cont,prop,value):
-  p = gui.GetControlProperties(cont)
+def changeComponentProp(comp,prop,value):
+  p = gui.GetControlProperties(comp,'')
   p[prop] = value
-  return gui.SetControlProperties(cont,p)
+  return gui.SetControlProperties(comp,'',p)
   
 def translate(cont,value):
   return changeControlProp(cont,'Caption',value)

Modified: Lobby/TASClient/Python/scripts/subf/stick.py
===================================================================
--- Lobby/TASClient/Python/scripts/subf/stick.py	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Python/scripts/subf/stick.py	2008-10-22 18:44:31 UTC (rev 6853)
@@ -16,7 +16,7 @@
 menuUnstickId = 0
 
 
-colors = gui.GetColors()
+colors = api.GetColors()
 
 def onUnStickClick(id):
   global menuUnstickId
@@ -55,7 +55,7 @@
   global menuUnstickId
   if nick == stickingNick:
     stickingNick = ''
-    gui.AddToRichEdit('$current','Exiting stick mode ('+nick+' left).',colors['Info'])
+    api.AddToTextBox('$current','Exiting stick mode ('+nick+' left).',colors['Info'])
     gui.RemoveFromMenu(menuUnstickId)
 
 
@@ -72,7 +72,7 @@
   global stickingNick
   if stickingNick  != '':
     stickingNick = ''
-    gui.AddToTextBox('$current','Exiting stick mode (You were kicked from the battle).',colors['Info'])
+    api.AddToTextBox('$current','Exiting stick mode (You were kicked from the battle).',colors['Info'])
 
 # when joining a battle we wait for the two CLIENTBATTLESTATUS from server 
 # and then we set us to spectator if the option is checked 
@@ -113,14 +113,14 @@
 def cmd_unstick():
   global stickingNick
   stickingNick = ''
-  gui.AddToRichEdit('$current','Exiting stick mode.',colors['Info'])
+  api.AddToTextBox('$current','Exiting stick mode.',colors['Info'])
   return True
 
 def cmd_stick(data):
   args = data.split(' ')
 
   if len(args) != 2:
-      gui.AddToRichEdit('$current',&quot;Stick usage : /stick user joinAsSpec={0/1} (Ex : '/stick haxor465 1' will join as spectator every battle the player haxor465 joins.&quot;,colors['Error'])
+      api.AddToTextBox('$current',&quot;Stick usage : /stick user joinAsSpec={0/1} (Ex : '/stick haxor465 1' will join as spectator every battle the player haxor465 joins.&quot;,colors['Error'])
       return 1
   nick = args[0]
   spec = args[1]
@@ -128,22 +128,21 @@
   global specMode
   
   if stickingNick != '':
-    gui.AddToRichEdit('$current','Exiting stick mode.',colors['Info'])
+    api.AddToTextBox('$current','Exiting stick mode.',colors['Info'])
  
   users = api.GetUsers()
-  print users
   if nick in users:
     stickingNick = nick
     specMode = spec
     if specMode == '1':
-      gui.AddToRichEdit('$current','Entering spectator sticking mode on : '+nick,colors['Info'])
+      api.AddToTextBox('$current','Entering spectator sticking mode on : '+nick,colors['Info'])
     else:
-      gui.AddToRichEdit('$current','Entering sticking mode on : '+nick,colors['Info'])
-    gui.AddToRichEdit('$current','Type /unstick to leave that mode.',colors['Info'])
+      api.AddToTextBox('$current','Entering sticking mode on : '+nick,colors['Info'])
+    api.AddToTextBox('$current','Type /unstick to leave that mode.',colors['Info'])
     
   else:
     stickingNick = ''
-    gui.AddToRichEdit('$current',&quot;User '&quot;+nick+&quot;' does not exist.&quot;,colors['Error'])
+    api.AddToTextBox('$current',&quot;User '&quot;+nick+&quot;' does not exist.&quot;,colors['Error'])
 
   # the command won't be processed by the lobby
   return True
\ No newline at end of file

Modified: Lobby/TASClient/Python/scripts/subf/windowedTASClient.py
===================================================================
--- Lobby/TASClient/Python/scripts/subf/windowedTASClient.py	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Python/scripts/subf/windowedTASClient.py	2008-10-22 18:44:31 UTC (rev 6853)
@@ -5,19 +5,19 @@
 
 
 def changeComponentProp(comp,prop,value):
-  p = gui.GetControlProperties(comp)
+  p = gui.GetControlProperties(comp,'')
   p[prop] = value
-  return gui.SetControlProperties(comp,p)
+  return gui.SetControlProperties(comp,'',p)
 
 def _init():
   gui.AddForm('PlayerListForm','Player List',2)
-  changeComponentProp('MainForm.Panel2','parent','PlayerListForm')
-  changeComponentProp('MainForm.Panel2','align','alClient')
+  changeComponentProp('MainForm.Panel2','Parent','PlayerListForm')
+  changeComponentProp('MainForm.Panel2','Align','alClient')
   
   gui.AddForm('BattleListForm','Battle List',2)
-  changeComponentProp('MainForm.Panel3','parent','BattleListForm')
-  changeComponentProp('MainForm.Panel3','align','alClient')
+  changeComponentProp('MainForm.Panel3','Parent','BattleListForm')
+  changeComponentProp('MainForm.Panel3','Align','alClient')
   
-  gui.AddForm('ToolBarForm','TASClient Toolbar','alBottom')
-  changeComponentProp('MainForm.Panel4','parent','ToolBarForm')
-  changeComponentProp('MainForm.Panel4','align','alClient')
\ No newline at end of file
+  gui.AddForm('ToolBarForm','TASClient Toolbar',2)
+  changeComponentProp('MainForm.Panel4','Parent','ToolBarForm')
+  changeComponentProp('MainForm.Panel4','Align','alClient')
\ No newline at end of file

Added: Lobby/TASClient/SetValuesFormUnit.dfm
===================================================================
--- Lobby/TASClient/SetValuesFormUnit.dfm	                        (rev 0)
+++ Lobby/TASClient/SetValuesFormUnit.dfm	2008-10-22 18:44:31 UTC (rev 6853)
@@ -0,0 +1,36 @@
+object SetValuesForm: TSetValuesForm
+  Left = 1059
+  Top = 480
+  Width = 228
+  Height = 239
+  Caption = 'SetValuesForm'
+  Color = clBtnFace
+  Font.Charset = DEFAULT_CHARSET
+  Font.Color = clWindowText
+  Font.Height = -11
+  Font.Name = 'MS Sans Serif'
+  Font.Style = []
+  OldCreateOrder = False
+  Scaled = False
+  OnCreate = FormCreate
+  DesignSize = (
+    220
+    212)
+  PixelsPerInch = 96
+  TextHeight = 13
+  object SetValues: TValueListEditor
+    Left = 8
+    Top = 8
+    Width = 199
+    Height = 191
+    Anchors = [akLeft, akTop, akBottom]
+    Color = clBtnFace
+    DefaultColWidth = 110
+    DisplayOptions = [doAutoColResize, doKeyColFixed]
+    TabOrder = 0
+    OnStringsChange = SetValuesStringsChange
+    ColWidths = (
+      110
+      83)
+  end
+end

Added: Lobby/TASClient/SetValuesFormUnit.pas
===================================================================
--- Lobby/TASClient/SetValuesFormUnit.pas	                        (rev 0)
+++ Lobby/TASClient/SetValuesFormUnit.pas	2008-10-22 18:44:31 UTC (rev 6853)
@@ -0,0 +1,50 @@
+unit SetValuesFormUnit;
+
+interface
+
+uses
+  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
+  Dialogs, TBXDkPanels, SpTBXControls, Grids, ValEdit, CustomizeGUIFormUnit;
+
+type
+  TSetValuesForm = class(TForm)
+    SetValues: TValueListEditor;
+    procedure SetValuesStringsChange(Sender: TObject);
+    procedure FormCreate(Sender: TObject);
+  private
+    { Private declarations }
+  public
+    DisplayedProperty: TSetProperty;
+  end;
+
+var
+  SetValuesForm: TSetValuesForm;
+
+implementation
+
+{$R *.dfm}
+
+procedure TSetValuesForm.SetValuesStringsChange(Sender: TObject);
+var
+  i: integer;
+  s: string;
+begin
+  if DisplayedProperty = nil then
+    Exit;
+  
+  for i:=0 to SetValues.RowCount-1 do
+    if SetValues.Cells[1,i] = 'True' then
+      if s = '' then
+        s := SetValues.Cells[0,i]
+      else
+        s := s + ','+SetValues.Cells[0,i];
+
+   DisplayedProperty.ChangeValue(s);
+end;
+
+procedure TSetValuesForm.FormCreate(Sender: TObject);
+begin
+  DisplayedProperty := nil;
+end;
+
+end.

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/TASClient.dof	2008-10-22 18:44:31 UTC (rev 6853)
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=3
 Release=0
-Build=483
+Build=487
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=TA Spring lobby client
-FileVersion=0.3.0.483
+FileVersion=0.3.0.487
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.dpr
===================================================================
--- Lobby/TASClient/TASClient.dpr	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/TASClient.dpr	2008-10-22 18:44:31 UTC (rev 6853)
@@ -114,7 +114,9 @@
   LogonFormUnit in 'LogonFormUnit.pas' {LogonForm},
   MapSelectionFormUnit in 'MapSelectionFormUnit.pas' {MapSelectionForm},
   OKCANCL1 in 'C:\Program Files\Borland\Delphi7\ObjRepos\OKCANCL1.pas' {OKBottomDlg},
-  TipsFormUnit in 'TipsFormUnit.pas' {TipsForm};
+  TipsFormUnit in 'TipsFormUnit.pas' {TipsForm},
+  CustomizeGUIFormUnit in 'CustomizeGUIFormUnit.pas' {CustomizeGUIForm},
+  SetValuesFormUnit in 'SetValuesFormUnit.pas' {SetValuesForm};
 
 var
   i: Integer;
@@ -132,8 +134,8 @@
   for i := 1 to ParamCount do
   begin
     MainUnit.RunningUnderWine := MainUnit.RunningUnderWine or (UpperCase(ParamStr(i)) = '-WINE');
-    //MainUnit.RunningWithMainMenu := MainUnit.RunningWithMainMenu or (UpperCase(ParamStr(i)) = '-MENU');
-    //MainUnit.RunningWithMainMenuDev := MainUnit.RunningWithMainMenuDev or (UpperCase(ParamStr(i)) = '-MENUDEV');
+    MainUnit.RunningWithMainMenu := MainUnit.RunningWithMainMenu or (UpperCase(ParamStr(i)) = '-MENU');
+    MainUnit.RunningWithMainMenuDev := MainUnit.RunningWithMainMenuDev or (UpperCase(ParamStr(i)) = '-MENUDEV');
 
     if UpperCase(ParamStr(i)) = '-SERVER' then
       if (ParamCount = i) or (Pos(':',ParamStr(i+1)) = 0) then
@@ -226,6 +228,8 @@
   Application.CreateForm(TSearchPlayerForm, SearchPlayerForm);
   Application.CreateForm(TPythonScriptDebugForm, PythonScriptDebugForm);
   Application.CreateForm(TTipsForm, TipsForm);
+  Application.CreateForm(TCustomizeGUIForm, CustomizeGUIForm);
+  Application.CreateForm(TSetValuesForm, SetValuesForm);
   //Application.CreateForm(TSpringDownloaderForm, SpringDownloaderForm);
   if not MainUnit.RunningUnderWine then
     Application.CreateForm(TMenuForm, MenuForm);

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)

Modified: Lobby/TASClient/Utility.pas
===================================================================
--- Lobby/TASClient/Utility.pas	2008-10-22 18:14:13 UTC (rev 6852)
+++ Lobby/TASClient/Utility.pas	2008-10-22 18:44:31 UTC (rev 6853)
@@ -65,6 +65,7 @@
 function GetModValidMapList: TStringList;
 function GetMapArchive(mapName: String):String;
 function GetModShortName: String;
+function ReadVFSFile(fileName: string): string;
 function ExtractVFSDir(Dir: string;ExtractTo: string): boolean;
 
 { I assume bools are 1 byte in size (not 4) in unitsync.dll (from MSDN: &quot;In Visual C++ 4.2,
@@ -941,10 +942,28 @@
     ReadFileVFS(fileHwd,PChar(fileContent),size);
     CloseFileVFS(fileHwd);
     s := TTDFParser.Create(fileContent);
-    Result := s.ReadKeyValue('mod/shortname')
+    Result := s.ReadKeyValue('mod/shortname');
+    s.Destroy;
   end;
 end;
 
+function ReadVFSFile(fileName: string): string;
+var
+  fileHwd,size: integer;
+  fileContent: string;
+begin
+  Result := '';
+  fileHwd := OpenFileVFS(PChar(fileName));
+  if fileHwd &lt;&gt; 0 then
+  begin
+    size := FileSizeVFS(fileHwd);
+    SetLength(fileContent,size);
+    ReadFileVFS(fileHwd,PChar(fileContent),size);
+    CloseFileVFS(fileHwd);
+    Result := fileContent;
+  end;
+end;
+
 function ExtractVFSDir(Dir: string;ExtractTo: string): boolean;
 var
   archiveHwd,fileHwd,size: integer;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001621.html">[Taspring-linux-commit] r6852 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="001623.html">[Taspring-linux-commit] r6854 - in trunk/rts: Game Game/UI	Rendering System lib/hpiutil2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1622">[ date ]</a>
              <a href="thread.html#1622">[ thread ]</a>
              <a href="subject.html#1622">[ subject ]</a>
              <a href="author.html#1622">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
