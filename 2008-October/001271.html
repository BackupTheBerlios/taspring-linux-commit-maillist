<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6501 - in trunk/rts: Game Map/SMF	Rendering/Env Rendering/GL Rendering/UnitModels Sim/Features	Sim/Path System build/vstudio8 lib/gml
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6501%20-%20in%20trunk/rts%3A%20Game%20Map/SMF%0A%09Rendering/Env%20Rendering/GL%20Rendering/UnitModels%20Sim/Features%0A%09Sim/Path%20System%20build/vstudio8%20lib/gml&In-Reply-To=%3C20081002212056.8BB2F4656%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001270.html">
   <LINK REL="Next"  HREF="001272.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6501 - in trunk/rts: Game Map/SMF	Rendering/Env Rendering/GL Rendering/UnitModels Sim/Features	Sim/Path System build/vstudio8 lib/gml</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6501%20-%20in%20trunk/rts%3A%20Game%20Map/SMF%0A%09Rendering/Env%20Rendering/GL%20Rendering/UnitModels%20Sim/Features%0A%09Sim/Path%20System%20build/vstudio8%20lib/gml&In-Reply-To=%3C20081002212056.8BB2F4656%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6501 - in trunk/rts: Game Map/SMF	Rendering/Env Rendering/GL Rendering/UnitModels Sim/Features	Sim/Path System build/vstudio8 lib/gml">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Thu Oct  2 23:20:54 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001270.html">[Taspring-linux-commit] r6500 - trunk/rts/System
</A></li>
        <LI>Next message: <A HREF="001272.html">[Taspring-linux-commit] r6502 - trunk/tools/SpringInstaller
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1271">[ date ]</a>
              <a href="thread.html#1271">[ thread ]</a>
              <a href="subject.html#1271">[ subject ]</a>
              <a href="author.html#1271">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: zerver
Date: 2008-10-02 23:20:53 +0200 (Thu, 02 Oct 2008)
New Revision: 6501

Modified:
   trunk/rts/Game/Action.cpp
   trunk/rts/Game/Game.cpp
   trunk/rts/Game/GameVersion.cpp
   trunk/rts/Game/PlayerBase.cpp
   trunk/rts/Map/SMF/BFGroundDrawer.cpp
   trunk/rts/Map/SMF/BFGroundDrawer.h
   trunk/rts/Map/SMF/SmfMapFile.cpp
   trunk/rts/Rendering/Env/AdvSky.cpp
   trunk/rts/Rendering/Env/AdvSky.h
   trunk/rts/Rendering/Env/AdvTreeDrawer.cpp
   trunk/rts/Rendering/Env/AdvWater.cpp
   trunk/rts/Rendering/Env/BasicSky.cpp
   trunk/rts/Rendering/Env/BasicSky.h
   trunk/rts/Rendering/Env/BasicTreeDrawer.cpp
   trunk/rts/Rendering/Env/BumpWater.cpp
   trunk/rts/Rendering/Env/DynWater.cpp
   trunk/rts/Rendering/Env/GrassDrawer.cpp
   trunk/rts/Rendering/GL/VertexArray.cpp
   trunk/rts/Rendering/GL/VertexArray.h
   trunk/rts/Rendering/UnitModels/UnitDrawer.cpp
   trunk/rts/Rendering/UnitModels/UnitDrawer.h
   trunk/rts/Sim/Features/FeatureHandler.cpp
   trunk/rts/Sim/Path/PathManager.h
   trunk/rts/System/Matrix44f.h
   trunk/rts/System/SpringApp.cpp
   trunk/rts/build/vstudio8/rts.sln
   trunk/rts/build/vstudio8/rts.vcproj
   trunk/rts/lib/gml/gmlcls.h
   trunk/rts/lib/gml/gmlsrv.h
Log:
Misc improvements to rendering code

Modified: trunk/rts/Game/Action.cpp
===================================================================
--- trunk/rts/Game/Action.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Game/Action.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -1,3 +1,4 @@
+#include &quot;StdAfx.h&quot;
 #include &lt;vector&gt;
 #include &lt;algorithm&gt;
 

Modified: trunk/rts/Game/Game.cpp
===================================================================
--- trunk/rts/Game/Game.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Game/Game.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -2636,7 +2636,7 @@
 	return true;
 }
 
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAWALL
+#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAW
 bool CGame::Draw() {
 	gmlProcessor.Work(&amp;CGame::DrawMTcb,NULL,NULL,this,gmlThreadCount,TRUE,NULL,1,2,2,FALSE);
 #else
@@ -2644,7 +2644,7 @@
 #endif
 	return true;
 }
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAWALL
+#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAW
 bool CGame::DrawMT() {
 #else
 bool CGame::Draw() {
@@ -3042,28 +3042,44 @@
 }
 
 
+#if defined(USE_GML) &amp;&amp; GML_MT_TEST
+int oldgsframe;
+#endif
 // This will be run by a separate thread in parallel with the Sim
 // ONLY 100% THREAD SAFE UNSYNCED STUFF HERE PLEASE
 void CGame::UnsyncedStuff() {
 	if (!skipping) {
 		infoConsole-&gt;Update();
 	}
+#if defined(USE_GML) &amp;&amp; GML_MT_TEST
+	while(oldgsframe==*(volatile int *)&amp;(gs-&gt;frameNum)) {
+		gmlProcessor.Pump(1);
+		boost::thread::yield();
+	}
+	gu-&gt;drawFrame++;
+	if (gu-&gt;drawFrame == 0) {
+		gu-&gt;drawFrame++;
+	}
+	Draw();
+#endif
 }
 
 
-#  if defined(USE_GML) &amp;&amp; GML_ENABLE_SIM
+#if defined(USE_GML) &amp;&amp; GML_ENABLE_SIM
 void CGame::SimFrame() {
+#		if defined(USE_GML) &amp;&amp; GML_MT_TEST
+	oldgsframe=gs-&gt;frameNum;
+#		endif
 	gmlProcessor.Work(&amp;CGame::SimFrameMTcb,NULL,NULL,this,2,FALSE,NULL,1,2,2,FALSE,&amp;CGame::UnsyncedStuffcb);
-#  else
+#else
 void CGame::SimFrameMT() {
-#  endif
+#endif
 }
-#  if defined(USE_GML) &amp;&amp; GML_ENABLE_SIM
+#if defined(USE_GML) &amp;&amp; GML_ENABLE_SIM
 void CGame::SimFrameMT() {
-#  else
+#else
 void CGame::SimFrame() {
-#  endif
-
+#endif
 	good_fpu_control_registers(&quot;CGame::SimFrame&quot;);
 	lastFrameTime = SDL_GetTicks();
 	ASSERT_SYNCED_MODE;
@@ -3084,6 +3100,9 @@
 	if (luaGaia)  { luaGaia-&gt;GameFrame(gs-&gt;frameNum); }
 	if (luaRules) { luaRules-&gt;GameFrame(gs-&gt;frameNum); }
 
+#if defined(USE_GML) &amp;&amp; GML_MT_TEST
+	gmlProcessor.GetQueue();
+#endif
 	gs-&gt;frameNum++;
 
 	ENTER_UNSYNCED;

Modified: trunk/rts/Game/GameVersion.cpp
===================================================================
--- trunk/rts/Game/GameVersion.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Game/GameVersion.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -3,6 +3,7 @@
 	Take special care when moving this file, the Spring buildbot refers to this
 	file to append the version string with the SVN revision number.
 */
+#include &quot;StdAfx.h&quot;
 
 #include &quot;GameVersion.h&quot;
 

Modified: trunk/rts/Game/PlayerBase.cpp
===================================================================
--- trunk/rts/Game/PlayerBase.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Game/PlayerBase.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -1,11 +1,12 @@
-#include &quot;PlayerBase.h&quot;
-
-
-PlayerBase::PlayerBase() :
-team(0),
-rank(-1),
-name(&quot;no name&quot;),
-spectator(false),
-isFromDemo(false)
-{
-}
+#include &quot;StdAfx.h&quot;
+#include &quot;PlayerBase.h&quot;
+
+
+PlayerBase::PlayerBase() :
+team(0),
+rank(-1),
+name(&quot;no name&quot;),
+spectator(false),
+isFromDemo(false)
+{
+}

Modified: trunk/rts/Map/SMF/BFGroundDrawer.cpp
===================================================================
--- trunk/rts/Map/SMF/BFGroundDrawer.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Map/SMF/BFGroundDrawer.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -67,6 +67,11 @@
 		CreateWaterPlanes(true);
 		glEndList();
 	}
+
+#ifdef USE_GML
+	multiThreadDrawGround=configHandler.GetInt(&quot;MultiThreadDrawGround&quot;, 1);
+	multiThreadDrawGroundShadow=configHandler.GetInt(&quot;MultiThreadDrawGroundShadow&quot;, 0);
+#endif
 }
 
 CBFGroundDrawer::~CBFGroundDrawer(void)
@@ -88,6 +93,11 @@
 		glDeleteLists(waterPlaneCamInDispList,1);
 		glDeleteLists(waterPlaneCamOutDispList,1);
 	}
+
+#ifdef USE_GML
+	configHandler.SetInt(&quot;MultiThreadDrawGround&quot;, multiThreadDrawGround);
+	configHandler.SetInt(&quot;MultiThreadDrawGroundShadow&quot;, multiThreadDrawGroundShadow);
+#endif
 }
 
 void CBFGroundDrawer::CreateWaterPlanes(const bool &amp;camOufOfMap) {
@@ -704,14 +714,19 @@
 		glAlphaFunc(GL_GREATER, 0.9f);
 	}
 
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAWGROUND
-	mt_overrideVP=overrideVP;
-	gmlProcessor.Work(NULL,&amp;CBFGroundDrawer::DoDrawGroundRowMT,NULL,this,gmlThreadCount,FALSE,NULL,numBigTexY,50,100,TRUE,NULL);
-#else
-	for (int bty = 0; bty &lt; numBigTexY; ++bty) {
-		DoDrawGroundRow(bty,overrideVP);
+#ifdef USE_GML
+	if(multiThreadDrawGround) {
+		mt_overrideVP=overrideVP;
+		gmlProcessor.Work(NULL,&amp;CBFGroundDrawer::DoDrawGroundRowMT,NULL,this,gmlThreadCount,FALSE,NULL,numBigTexY,50,100,TRUE,NULL);
 	}
+	else {
 #endif
+		for (int bty = 0; bty &lt; numBigTexY; ++bty) {
+			DoDrawGroundRow(bty,overrideVP);
+		}
+#ifdef USE_GML
+	}
+#endif
 
 	ResetTextureUnits(drawWaterReflection, overrideVP);
 	glDisable(GL_CULL_FACE);
@@ -1123,13 +1138,18 @@
 	glBindProgramARB(GL_VERTEX_PROGRAM_ARB, groundShadowVP);
 	glEnable(GL_VERTEX_PROGRAM_ARB);
 
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAWGROUNDSHADOW
-	gmlProcessor.Work(NULL,&amp;CBFGroundDrawer::DoDrawGroundShadowLODMT,NULL,this,gmlThreadCount,FALSE,NULL,NUM_LODS+1,50,100,TRUE,NULL);
-#else
-	for (int nlod = 0; nlod &lt; NUM_LODS+1; ++nlod) {
-		DoDrawGroundShadowLOD(nlod);
+#ifdef USE_GML
+	if(multiThreadDrawGroundShadow) {
+		gmlProcessor.Work(NULL,&amp;CBFGroundDrawer::DoDrawGroundShadowLODMT,NULL,this,gmlThreadCount,FALSE,NULL,NUM_LODS+1,50,100,TRUE,NULL);
 	}
+	else {
 #endif
+		for (int nlod = 0; nlod &lt; NUM_LODS+1; ++nlod) {
+			DoDrawGroundShadowLOD(nlod);
+		}
+#ifdef USE_GML
+	}
+#endif
 
 	glDisable(GL_POLYGON_OFFSET_FILL);
 	glDisable(GL_CULL_FACE);

Modified: trunk/rts/Map/SMF/BFGroundDrawer.h
===================================================================
--- trunk/rts/Map/SMF/BFGroundDrawer.h	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Map/SMF/BFGroundDrawer.h	2008-10-02 21:20:53 UTC (rev 6501)
@@ -59,7 +59,14 @@
 	unsigned int groundFPShadow;
 	bool waterDrawn;
 
+#ifdef USE_GML
+	int multiThreadDrawGround;
+	int multiThreadDrawGroundShadow;
+
 	volatile unsigned int mt_overrideVP;
+	static void DoDrawGroundRowMT(void *c,int bty) {((CBFGroundDrawer *)c)-&gt;DoDrawGroundRow(bty,((CBFGroundDrawer *)c)-&gt;mt_overrideVP);}
+	static void DoDrawGroundShadowLODMT(void *c,int nlod) {((CBFGroundDrawer *)c)-&gt;DoDrawGroundShadowLOD(nlod);}
+#endif
 
 	GLuint waterPlaneCamOutDispList;
 	GLuint waterPlaneCamInDispList;
@@ -70,13 +77,11 @@
 
 	void FindRange(int &amp;xs, int &amp;xe, std::vector&lt;fline&gt; &amp;left, std::vector&lt;fline&gt; &amp;right, int y, int lod);
 	void DoDrawGroundRow(int bty, unsigned int overrideVP);
-	static void DoDrawGroundRowMT(void *c,int bty) {((CBFGroundDrawer *)c)-&gt;DoDrawGroundRow(bty,((CBFGroundDrawer *)c)-&gt;mt_overrideVP);}
 	void DrawVertexAQ(CVertexArray *ma, int x, int y);
 	void DrawVertexAQ(CVertexArray *ma, int x, int y, float height);
 	void EndStripQ(CVertexArray *ma);
 	void DrawGroundVertexArrayQ(CVertexArray * &amp;ma);
 	void DoDrawGroundShadowLOD(int nlod);
-	static void DoDrawGroundShadowLODMT(void *c,int nlod) {((CBFGroundDrawer *)c)-&gt;DoDrawGroundShadowLOD(nlod);}
 
 	inline bool BigTexSquareRowVisible(int);
 	void SetupTextureUnits(bool drawReflection, unsigned int overrideVP);

Modified: trunk/rts/Map/SMF/SmfMapFile.cpp
===================================================================
--- trunk/rts/Map/SMF/SmfMapFile.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Map/SMF/SmfMapFile.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -5,6 +5,7 @@
 #include &quot;SmfMapFile.h&quot;
 #include &quot;mapfile.h&quot;
 #include &quot;mmgr.h&quot;
+#include &lt;assert.h&gt;
 
 using std::string;
 

Modified: trunk/rts/Rendering/Env/AdvSky.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvSky.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/AdvSky.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -21,7 +21,6 @@
 #define X_PART 10.0
 
 #define CLOUD_DETAIL 6
-#define CLOUD_SIZE 256
 #define CLOUD_MASK (CLOUD_SIZE-1)
 
 //static unsigned int cdtex;
@@ -32,6 +31,11 @@
 CAdvSky::CAdvSky()
 {
 	PrintLoadMsg(&quot;Creating sky&quot;);
+
+	randMatrix=newmat3&lt;int&gt;(16,32,32);
+	rawClouds=newmat2&lt;int&gt;(CLOUD_SIZE,CLOUD_SIZE);
+	blendMatrix=newmat3&lt;int&gt;(CLOUD_DETAIL,32,32);
+
 	domeheight=cos(PI/16)*1.01f;
 	domeWidth=sin(2*PI/32)*400*1.7f;
 
@@ -158,10 +162,14 @@
 	glDeleteTextures(1, &amp;sunFlareTex);
 	glDeleteLists(sunFlareList,1);
 
-	delete[] cloudThickness2;
+	delete[] cloudThickness;
 	delete[] cloudTexMem;
 
 	glSafeDeleteProgram( cloudFP );
+
+	delmat3&lt;int&gt;(randMatrix);
+	delmat2&lt;int&gt;(rawClouds);
+	delmat3&lt;int&gt;(blendMatrix);
 }
 
 void CAdvSky::Draw()
@@ -227,14 +235,14 @@
 
 void CAdvSky::CreateClouds()
 {
-	cloudThickness2=SAFE_NEW unsigned char[CLOUD_SIZE*CLOUD_SIZE+1];
+	cloudThickness=SAFE_NEW unsigned char[CLOUD_SIZE*CLOUD_SIZE+1];
 	cloudTexMem=SAFE_NEW unsigned char[CLOUD_SIZE*CLOUD_SIZE*4];
 
 	glGenTextures(1, &amp;skyTex);
 	glGenTextures(1, &amp;skyDot3Tex);
 	glGenTextures(1, &amp;cloudDot3Tex);
 
-	unsigned char (* skytex)[512][4]=SAFE_NEW unsigned char[512][512][4];
+	unsigned char (* skytex)[512][4]=SAFE_NEW unsigned char[512][512][4]; // this is too big for the stack
 
 	glGenTextures(1, &amp;cdtex);
 //	CBitmap pic(&quot;bitmaps/clouddetail.bmp&quot;);
@@ -290,9 +298,9 @@
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_NEAREST);
 	glBuildMipmaps(GL_TEXTURE_2D,GL_RGBA8 ,512, 512, GL_RGBA, GL_UNSIGNED_BYTE, skytex[0][0]);
-	delete[] skytex;
+	delete [] skytex;
 
-	unsigned char skytex2[256][256][4];
+	unsigned char (* skytex2)[256][4]=SAFE_NEW unsigned char[256][256][4];
 	for(int y=0;y&lt;256;y++){
 		for(int x=0;x&lt;256;x++){
 			float3 dir=GetDirFromTexCoord(x/256.0f,y/256.0f);
@@ -311,18 +319,19 @@
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_NEAREST);
 	glBuildMipmaps(GL_TEXTURE_2D,GL_RGBA8 ,256, 256, GL_RGBA, GL_UNSIGNED_BYTE, skytex2[0][0]);
+	delete [] skytex2;
 
 	for(int a=0;a&lt;CLOUD_DETAIL;a++){
 		CreateRandMatrix(randMatrix[a],1-a*0.03f);
 		CreateRandMatrix(randMatrix[a+8],1-a*0.03f);
 	}
 
-	char* scrap=SAFE_NEW char[CLOUD_SIZE*CLOUD_SIZE*4];
+	char *scrap=SAFE_NEW char[CLOUD_SIZE*CLOUD_SIZE*4];
 	glBindTexture(GL_TEXTURE_2D, cloudDot3Tex);
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
 	glTexImage2D(GL_TEXTURE_2D,0,GL_RGBA8, CLOUD_SIZE, CLOUD_SIZE,0,GL_RGBA, GL_UNSIGNED_BYTE, scrap);
-	delete[] scrap;
+  delete [] scrap;
 
 	dynamicSky=true;
 	CreateTransformVectors();
@@ -330,214 +339,188 @@
 	dynamicSky=false;
 }
 
+inline void CAdvSky::UpdatePart(int ast, int aed, int a3cstart, int a4cstart) {
+	int *rc=*rawClouds+ast;
+	unsigned char *ct=cloudTexMem+4*ast;
+
+	int am2=(ast-2)&amp;CLOUD_MASK, am1=(ast-1)&amp;CLOUD_MASK, aa=(ast)&amp;CLOUD_MASK, ap1=(ast+1)&amp;CLOUD_MASK;
+	int a3c=ast+a3cstart, a4c=ast+a4cstart;
+	for(int a=ast; a&lt;aed; ++rc, ++ct){
+		ydif[ap1]+=(int)cloudThickness[++a3c] - cloudThickness[++a] * 2 + cloudThickness[++a4c];
+		ydif2[ap1]=(ydif1[ap1]=ydif[ap1]&gt;&gt;1)&gt;&gt;1;
+		int dif=(ydif2[am2] + ydif1[am2=am1] + ydif[am1=aa] + ydif1[aa=ap1] + ydif2[++ap1]) / 16;
+		if(ap1&gt;=CLOUD_SIZE)
+			ap1=0;
+		*ct++=128+dif;
+		*ct++=thicknessTransform[(*rc)&gt;&gt;7];
+		*ct++=255;
+	}
+}
+
 void CAdvSky::Update()
 {
 	if(!dynamicSky)
 		return;
 
-
 	SCOPED_TIMER(&quot;Updating sky&quot;);
 
 	CreateDetailTex();
 
-	if(lastCloudUpdate&lt;=gs-&gt;frameNum-3){
-		lastCloudUpdate=gs-&gt;frameNum;
+	if(lastCloudUpdate&gt;gs-&gt;frameNum-3)
+		return;
 
-	//perlin noise matrices for the clouds
-		int blendMatrix[8][32][32];
-		for(int a=0;a&lt;CLOUD_DETAIL;a++){
-			float fade=(gs-&gt;frameNum/(70.0f*(2&lt;&lt;(CLOUD_DETAIL-1-a))));
-			fade-=floor(fade/2)*2;
-			if(fade&gt;1){
-				fade=2-fade;
-				if(!cloudDown[a]){
-					cloudDown[a]=true;
-					CreateRandMatrix(randMatrix[a+8],1-a*0.03f);
-				}
-			} else {
-				if(cloudDown[a]){
-					cloudDown[a]=false;
-					CreateRandMatrix(randMatrix[a],1-a*0.03f);
-				}
-			}
-			int ifade=(int) ((3*fade*fade-2*fade*fade*fade)*256);
+	lastCloudUpdate=gs-&gt;frameNum;
 
-			for(int y=0;y&lt;32;y++){
-				for(int x=0;x&lt;32;x++){
-					blendMatrix[a][y][x]=(randMatrix[a][y][x]*ifade+randMatrix[a+8][y][x]*(256-ifade))&gt;&gt;8;
-				}
+	for(int a=0; a&lt;CLOUD_DETAIL; a++) {
+		float fade=(gs-&gt;frameNum/(70.0f*(2&lt;&lt;(CLOUD_DETAIL-1-a))));
+		fade-=floor(fade/2)*2;
+		if(fade&gt;1) {
+			fade=2-fade;
+			if(!cloudDown[a]) {
+				cloudDown[a]=true;
+				CreateRandMatrix(randMatrix[a+8],1-a*0.03f);
 			}
+		} else {
+			if(cloudDown[a]) {
+				cloudDown[a]=false;
+				CreateRandMatrix(randMatrix[a],1-a*0.03f);
+			}
 		}
+		int ifade=(int)(fade*fade*(3-2*fade)*256);
+		int ifade2=256-ifade;
 
-		//create the raw clouds from the perlin noice octaves
-		int (*rawClouds)[CLOUD_SIZE]=SAFE_NEW int[CLOUD_SIZE][CLOUD_SIZE];
+		int **bm=blendMatrix[a], **rm=randMatrix[a], **rm8=randMatrix[a+8];
 
-		for(int a=0;a&lt;CLOUD_SIZE*CLOUD_SIZE;a++){
-			rawClouds[0][a]=0;
+		for(int y=0; y&lt;32; ++y, ++bm, ++rm, ++rm8) {
+			int *bmx=*bm, *rmx=*rm, *rm8x=*rm8;
+			for(int x=0; x&lt;32; ++x) {
+				(*bmx++)=((*rmx++)*ifade+(*rm8x++)*ifade2)&gt;&gt;8;
+			}
 		}
+	}
 
-		int kernel[CLOUD_SIZE/4*CLOUD_SIZE/4];
-		for(int a=0;a&lt;CLOUD_DETAIL;a++){
-			for(int y=0;y&lt;(CLOUD_SIZE/4)&gt;&gt;a;++y){
-				float ydist=fabs((float)1+y-((CLOUD_SIZE/8)&gt;&gt;a))/((CLOUD_SIZE/8)&gt;&gt;a);
-				ydist=3*ydist*ydist-2*ydist*ydist*ydist;
-				for(int x=0;x&lt;(CLOUD_SIZE/4)&gt;&gt;a;++x){
-					float xdist=fabs((float)1+x-((CLOUD_SIZE/8)&gt;&gt;a))/((CLOUD_SIZE/8)&gt;&gt;a);
-					xdist=3*xdist*xdist-2*xdist*xdist*xdist;
+	for(int *rc=*rawClouds, *ec=rc+CLOUD_SIZE*CLOUD_SIZE; rc&lt;ec; ++rc)
+		(*rc)=0;
 
-					float contrib=(1-xdist)*(1-ydist);
-					kernel[y*CLOUD_SIZE/4+x]=(int) (contrib*((4&lt;&lt;CLOUD_DETAIL)&gt;&gt;a));
-				}
+	static int kernel[CLOUD_SIZE/4*CLOUD_SIZE/4];
+	for(int a=0; a&lt;CLOUD_DETAIL; ++a) {
+		int cs4a=(CLOUD_SIZE/4)&gt;&gt;a;
+		int cs8a=(CLOUD_SIZE/8)&gt;&gt;a;
+		int cmcs8a=CLOUD_SIZE-cs8a;
+		int qcda=(4&lt;&lt;CLOUD_DETAIL)&gt;&gt;a;
+		int *pkernel=kernel;
+		for(int y=0; y&lt;cs4a; ++y, pkernel+=CLOUD_SIZE/4) {
+			float ydist=fabs(1.0f+y-cs8a)/cs8a;
+			ydist=ydist*ydist*(3-2*ydist);
+			int *pkrn=pkernel;
+			for(int x=0; x&lt;cs4a; ++x) {
+				float xdist=fabs(1.0f+x-cs8a)/cs8a;
+				xdist=xdist*xdist*(3-2*xdist);
+
+				float contrib=(1-xdist)*(1-ydist);
+				(*pkrn++)=(int)(contrib*qcda);
 			}
-			unsigned int by=0,bx=0;
-			for(int y=0;y&lt;CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);y+=(CLOUD_SIZE/8)&gt;&gt;a){
-				for(int x=0;x&lt;CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);x+=(CLOUD_SIZE/8)&gt;&gt;a){
-					int blend=blendMatrix[a][by&amp;31][bx&amp;31];
-					for(int y2=0;y2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++y2){
-						for(int x2=0;x2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++x2){
-							rawClouds[y+y2][x+x2]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
-						}
+		}
+		--cs4a; //!
+		int **bm=blendMatrix[a];
+		int **prc=rawClouds;
+		unsigned int by=0,bx=0;
+		for(int y=0; y&lt;cmcs8a; y+=cs8a, ++by, prc+=cs8a) {
+			for(int x=0; x&lt;cmcs8a; x+=cs8a, ++bx) {
+				int blend=bm[by&amp;31][bx&amp;31];
+				int **prcy=prc;
+				int *pkernel=kernel;
+				for(int y2=0; y2&lt;cs4a; ++y2, ++prcy, pkernel+=CLOUD_SIZE/4) {
+					int *prcx=(*prcy)+x;
+					int *pkrn=pkernel;
+					for(int x2=0; x2&lt;cs4a; ++x2) {
+						(*prcx++)+=blend*(*pkrn++);
 					}
-					bx++;
 				}
-				by++;
 			}
-			by=0;
-			bx=31;
-			for(int y=0;y&lt;CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);y+=(CLOUD_SIZE/8)&gt;&gt;a){
-				int x=CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);
-				int blend=blendMatrix[a][by&amp;31][bx&amp;31];
-				for(int y2=0;y2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++y2){
-					for(int x2=0;x2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++x2){
-						if(x+x2&lt;CLOUD_SIZE)
-							rawClouds[y+y2][x+x2]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
-						else
-							rawClouds[y+y2][x+x2-CLOUD_SIZE]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
-					}
+		}
+		by=0;
+		bx=31;
+		prc=rawClouds;
+		for(int y=0; y&lt;cmcs8a; y+=cs8a, ++by, prc+=cs8a) {
+			int blend=bm[by&amp;31][bx&amp;31];
+			int **prcy=prc;
+			int *pkernel=kernel;
+			for(int y2=0; y2&lt;cs4a; ++y2, ++prcy, pkernel+=CLOUD_SIZE/4) {
+				int *prcx=(*prcy)+cmcs8a;
+				int *prcx2=prcx-CLOUD_SIZE;
+				int *pkrn=pkernel;
+				for(int x2=cmcs8a; x2&lt;cs4a+cmcs8a; ++x2, ++prcx, ++prcx2, ++pkrn) {
+					if(x2&lt;CLOUD_SIZE)
+						(*prcx)+=blend*(*pkrn);
+					else
+						(*prcx2)+=blend*(*pkrn);
 				}
-				by++;
 			}
-			bx=0;
-			by=31;
-			for(int x=0;x&lt;CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);x+=(CLOUD_SIZE/8)&gt;&gt;a){
-				int y=CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);
-				int blend=blendMatrix[a][by&amp;31][bx&amp;31];
-				for(int y2=0;y2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++y2){
-					for(int x2=0;x2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++x2){
-						if(y+y2&lt;CLOUD_SIZE)
-							rawClouds[y+y2][x+x2]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
-						else
-							rawClouds[y+y2-CLOUD_SIZE][x+x2]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
-					}
+		}
+		bx=0;
+		by=31;
+		prc=rawClouds+cmcs8a;
+		for(int x=0; x&lt;cmcs8a; x+=cs8a, ++bx) {
+			int blend=bm[by&amp;31][bx&amp;31];
+			int **prcy=prc;
+			int *pkernel=kernel;
+			for(int y2=cmcs8a; y2&lt;cs4a+cmcs8a; ++y2, ++prcy, pkernel+=CLOUD_SIZE/4) {
+				int *pkrn=pkernel;
+				int *prcx=(y2&lt;CLOUD_SIZE)?(*prcy)+x:(*(prcy-CLOUD_SIZE))+x;
+				for(int x2=0; x2&lt;cs4a; ++x2, ++prcx, ++pkrn) {
+					(*prcx)+=blend*(*pkrn);
 				}
-				bx++;
 			}
 		}
+	}
 
-		for(int a=0;a&lt;CLOUD_SIZE*CLOUD_SIZE;a++){
-			cloudThickness2[a]=alphaTransform[rawClouds[0][a]&gt;&gt;7];
-		}
-		cloudThickness2[CLOUD_SIZE*CLOUD_SIZE]=cloudThickness2[CLOUD_SIZE*CLOUD_SIZE-1];	//this one is read in one place, so to avoid reading uninitialized mem ...
+	unsigned char *ct=cloudThickness;
+	for(int *rc=*rawClouds, *ec=rc+CLOUD_SIZE*CLOUD_SIZE; rc&lt;ec; ++ct, ++rc)
+		(*ct)=alphaTransform[(*rc)&gt;&gt;7];
 
-		//create the cloud shading
-		int ydif[CLOUD_SIZE];
-		for(int a=0;a&lt;CLOUD_SIZE;++a){
-			ydif[a]=0;
-			ydif[a]+=cloudThickness2[(a+3*CLOUD_SIZE)];
-			ydif[a]+=cloudThickness2[(a+2*CLOUD_SIZE)];
-			ydif[a]+=cloudThickness2[(a+1*CLOUD_SIZE)];
-			ydif[a]+=cloudThickness2[(a+0*CLOUD_SIZE)];
-			ydif[a]-=cloudThickness2[(a-1*CLOUD_SIZE+CLOUD_SIZE*CLOUD_SIZE)];
-			ydif[a]-=cloudThickness2[(a-2*CLOUD_SIZE+CLOUD_SIZE*CLOUD_SIZE)];
-			ydif[a]-=cloudThickness2[(a-3*CLOUD_SIZE+CLOUD_SIZE*CLOUD_SIZE)];
-		}
+	cloudThickness[CLOUD_SIZE*CLOUD_SIZE]=cloudThickness[CLOUD_SIZE*CLOUD_SIZE-1];	//this one is read in one place, so to avoid reading uninitialized mem ...
 
-		int b=0;
-		ydif[(b)&amp;255]+=cloudThickness2[(b-3*CLOUD_SIZE+CLOUD_SIZE*CLOUD_SIZE)];
-		ydif[(b)&amp;255]-=cloudThickness2[(b)]*2;
-		ydif[(b)&amp;255]+=cloudThickness2[(b+4*CLOUD_SIZE)];
+	//create the cloud shading
+	for(int a=0;a&lt;CLOUD_SIZE;++a){
+		ydif[a]=(int)cloudThickness[(a+3*CLOUD_SIZE)] + cloudThickness[(a+2*CLOUD_SIZE)] + cloudThickness[(a+1*CLOUD_SIZE)] + 
+			cloudThickness[(a+0*CLOUD_SIZE)] - cloudThickness[(a+(CLOUD_SIZE-1)*CLOUD_SIZE)] - 
+			cloudThickness[(a+(CLOUD_SIZE-2)*CLOUD_SIZE)] - cloudThickness[(a+(CLOUD_SIZE-3)*CLOUD_SIZE)];
+		ydif2[a]=(ydif1[a]=ydif[a]&gt;&gt;1)&gt;&gt;1;
+	}
 
-		for(int a=0;a&lt;CLOUD_SIZE*3-1;a++){
-			ydif[(a+1)&amp;255]+=cloudThickness2[(a-3*CLOUD_SIZE+1+CLOUD_SIZE*CLOUD_SIZE)];
-			ydif[(a+1)&amp;255]-=cloudThickness2[(a+1)]*2;
-			ydif[(a+1)&amp;255]+=cloudThickness2[(a+4*CLOUD_SIZE+1)];
+	int b=0;
+	ydif[(b)&amp;CLOUD_MASK]+=cloudThickness[(b+CLOUD_SIZE*(CLOUD_SIZE-3))];
+	ydif[(b)&amp;CLOUD_MASK]-=cloudThickness[(b)]*2;
+	ydif[(b)&amp;CLOUD_MASK]+=cloudThickness[(b+4*CLOUD_SIZE)];
+	ydif2[(b)&amp;CLOUD_MASK]=(ydif1[(b)&amp;CLOUD_MASK]=ydif[(b)&amp;CLOUD_MASK]&gt;&gt;1)&gt;&gt;1;
 
-			int dif=0;
+	UpdatePart(0, CLOUD_SIZE*3-1, CLOUD_SIZE*(CLOUD_SIZE-3), 4*CLOUD_SIZE);
+	UpdatePart(CLOUD_SIZE*3-1, CLOUD_SIZE*(CLOUD_SIZE-4)-1, -3*CLOUD_SIZE, 4*CLOUD_SIZE);
+	UpdatePart(CLOUD_SIZE*(CLOUD_SIZE-4)-1, CLOUD_SIZE*CLOUD_SIZE, -3*CLOUD_SIZE, (4-CLOUD_SIZE)*CLOUD_SIZE);
 
-			dif+=ydif[(a)&amp;255];
-			dif+=ydif[(a+1)&amp;255]&gt;&gt;1;
-			dif+=ydif[(a-1)&amp;255]&gt;&gt;1;
-			dif+=ydif[(a+2)&amp;255]&gt;&gt;2;
-			dif+=ydif[(a-2)&amp;255]&gt;&gt;2;
-			dif/=16;
-
-			cloudTexMem[a*4+0]=128+dif;
-			cloudTexMem[a*4+1]=thicknessTransform[rawClouds[0][a]&gt;&gt;7];
-			cloudTexMem[a*4+2]=255;
-		}
-
-		for(int a=CLOUD_SIZE*3-1;a&lt;CLOUD_SIZE*CLOUD_SIZE-CLOUD_SIZE*4-1;a++){
-			ydif[(a+1)&amp;255]+=cloudThickness2[(a-3*CLOUD_SIZE+1)];
-			ydif[(a+1)&amp;255]-=cloudThickness2[(a+1)]*2;
-			ydif[(a+1)&amp;255]+=cloudThickness2[(a+4*CLOUD_SIZE+1)];
-
-			int dif=0;
-
-			dif+=ydif[(a)&amp;255];
-			dif+=ydif[(a+1)&amp;255]&gt;&gt;1;
-			dif+=ydif[(a-1)&amp;255]&gt;&gt;1;
-			dif+=ydif[(a+2)&amp;255]&gt;&gt;2;
-			dif+=ydif[(a-2)&amp;255]&gt;&gt;2;
-			dif/=16;
-
-			cloudTexMem[a*4+0]=128+dif;
-			cloudTexMem[a*4+1]=thicknessTransform[rawClouds[0][a]&gt;&gt;7];
-			cloudTexMem[a*4+2]=255;
-		}
-
-		for(int a=CLOUD_SIZE*CLOUD_SIZE-CLOUD_SIZE*4-1;a&lt;CLOUD_SIZE*CLOUD_SIZE;a++){
-			ydif[(a+1)&amp;255]+=cloudThickness2[(a-3*CLOUD_SIZE+1)];
-			ydif[(a+1)&amp;255]-=cloudThickness2[(a+1)]*2;
-			ydif[(a+1)&amp;255]+=cloudThickness2[(a+4*CLOUD_SIZE+1-CLOUD_SIZE*CLOUD_SIZE)];
-
-			int dif=0;
-
-			dif+=ydif[(a)&amp;255];
-			dif+=ydif[(a+1)&amp;255]&gt;&gt;1;
-			dif+=ydif[(a-1)&amp;255]&gt;&gt;1;
-			dif+=ydif[(a+2)&amp;255]&gt;&gt;2;
-			dif+=ydif[(a-2)&amp;255]&gt;&gt;2;
-			dif/=16;
-
-			cloudTexMem[a*4+0]=128+dif;
-			cloudTexMem[a*4+1]=thicknessTransform[rawClouds[0][a]&gt;&gt;7];
-			cloudTexMem[a*4+2]=255;
-		}
-
-		int modDensity=(int) ((1-cloudDensity)*256);
-		for(int a=0;a&lt;CLOUD_SIZE*CLOUD_SIZE;a++){
-			int f=(rawClouds[0][a]&gt;&gt;8)-modDensity;
-			if(f&lt;0)
-				f=0;
-			if(f&gt;255)
-				f=255;
-			cloudTexMem[a*4+3]=f;
-		}
-
-		delete[] rawClouds;
-
-		glBindTexture(GL_TEXTURE_2D, cloudDot3Tex);
-		glTexSubImage2D(GL_TEXTURE_2D,0, 0,0,CLOUD_SIZE, CLOUD_SIZE,GL_RGBA, GL_UNSIGNED_BYTE, cloudTexMem);
+	int modDensity=(int) ((1-cloudDensity)*256);
+	int *rc=*rawClouds;
+	ct=cloudTexMem+3;
+	for(int a=0;a&lt;CLOUD_SIZE*CLOUD_SIZE; ++a, ++rc, ct+=4){
+		int f=((*rc)&gt;&gt;8)-modDensity;
+		if(f&lt;0)
+			f=0;
+		if(f&gt;255)
+			f=255;
+		(*ct)=f;
 	}
+
+	glBindTexture(GL_TEXTURE_2D, cloudDot3Tex);
+	glTexSubImage2D(GL_TEXTURE_2D,0, 0,0,CLOUD_SIZE, CLOUD_SIZE,GL_RGBA, GL_UNSIGNED_BYTE, cloudTexMem);
 }
 
-void CAdvSky::CreateRandMatrix(int matrix[32][32],float mod)
+void CAdvSky::CreateRandMatrix(int **matrix,float mod)
 {
-	for(int y=0;y&lt;32;y++){
-		for(int x=0;x&lt;32;x++){
-			float r = ((float)( rand() )) / (float)RAND_MAX;
-			matrix[y][x]=((int)(r * 255.0f));
-		}
+	int *pmat=*matrix;
+	for(int a=0; a&lt;32*32; ++a) {
+		float r = ((float)( rand() )) / (float)RAND_MAX;
+		*pmat++=((int)(r * 255.0f));
 	}
 }
 
@@ -545,23 +528,25 @@
 {
 	for(int a=0;a&lt;size*size;a++){
 		float  r = ((float)( rand() )) / (float)RAND_MAX;
-		matrix[a]=((int)(r * 255.0f));
+		*matrix++=((int)(r * 255.0f));
 	}
 }
 
 void CAdvSky::CreateTransformVectors()
 {
+	unsigned char *at=alphaTransform;
+	unsigned char *tt=thicknessTransform;
 	for(int a=0;a&lt;1024;++a){
 		float f=(1023.0f-(a+cloudDensity*1024-512))/1023.0f;
 		float alpha=pow(f*2,3);
 		if(alpha&gt;1)
 			alpha=1;
-		alphaTransform[a]=(int) (alpha*255);
+		*at=(int) (alpha*255);
 
 		float d=f*2;
 		if(d&gt;1)
 			d=1;
-		thicknessTransform[a]=(unsigned char) (128+d*64+alphaTransform[a]*255/(4*255));
+		*tt++=(unsigned char) (128+d*64+(*at++)*255/(4*255));
 	}
 }
 
@@ -573,7 +558,7 @@
 
 	glDisable(GL_DEPTH_TEST);
 	glDisable(GL_ALPHA_TEST);
-	unsigned char buf[128];
+	static unsigned char buf[128];
 	glEnable(GL_TEXTURE_2D);
 
 	float3 modCamera=sundir1*camera-&gt;pos.x+sundir2*camera-&gt;pos.z;
@@ -586,27 +571,29 @@
 	int baseX=int(floor(fx))&amp;CLOUD_MASK;
 	fx-=floor(fx);
 
+	float *cvs=(float *)covers[0], *cvs1=(float *)covers[1], *cvs2=(float *)covers[2], *cvs3=(float *)covers[3];
 	if(baseX!=oldCoverBaseX || baseY!=oldCoverBaseY){
 		oldCoverBaseX=baseX;
 		oldCoverBaseY=baseY;
-		CreateCover(baseX,baseY,covers[0]);
-		CreateCover(baseX+1,baseY,covers[1]);
-		CreateCover(baseX,baseY+1,covers[2]);
-		CreateCover(baseX+1,baseY+1,covers[3]);
+		CreateCover(baseX,baseY,cvs);
+		CreateCover(baseX+1,baseY,cvs1);
+		CreateCover(baseX,baseY+1,cvs2);
+		CreateCover(baseX+1,baseY+1,cvs3);
 	}
 
 	float mid=0;
+	unsigned char *bf=buf+32, *bf2=buf+64;
 	for(int x=0;x&lt;32;++x){
-		float cx1=covers[0][x]*(1-fx)+covers[1][x]*fx;
-		float cx2=covers[2][x]*(1-fx)+covers[3][x]*fx;
+		float cx1=(*cvs++)*(1-fx)+(*cvs1++)*fx;
+		float cx2=(*cvs2++)*(1-fx)+(*cvs3++)*fx;
 
 		float cover=cx1*(1-fy)+cx2*fy;
 		if(cover&gt;127.5f)
 			cover=127.5f;
 		mid+=cover;
 
-		buf[x+32]=(unsigned char)(255-cover*2);
-		buf[x+64]=(unsigned char)(128-cover);
+		(*bf++)=(unsigned char)(255-cover*2);
+		(*bf2++)=(unsigned char)(128-cover);
 	}
 	mid*=1.0f/32;
 	for(int x=0;x&lt;32;++x){
@@ -678,7 +665,7 @@
 //	gluBuild2DMipmaps(GL_TEXTURE_2D,1 ,32, 2, GL_ALPHA, GL_UNSIGNED_BYTE, mem);
 	glTexImage2D(GL_TEXTURE_2D,0,GL_LUMINANCE ,32, 4,0, GL_LUMINANCE, GL_UNSIGNED_BYTE, mem);
 
-	delete[] mem;
+	delete [] mem;
 
 	float3 ldir=modSunDir.cross(UpVector);
 	ldir.Normalize();
@@ -706,7 +693,7 @@
 
 void CAdvSky::CreateCover(int baseX, int baseY, float *buf)
 {
-	static const int line[]={
+	static int line[]={
 		5, 0, 1, 0, 2, 0, 3, 0, 4, 0, 5,
 		5, 0, 1, 0, 2, 1, 3, 1, 4, 1, 5,
 		5, 0, 1, 1, 2, 1, 3, 2, 4, 2, 5,
@@ -716,27 +703,28 @@
 		5, 1, 0, 2, 1, 3, 1, 4, 2, 5, 2,
 		5, 1, 0, 2, 0, 3, 1, 4, 1, 5, 1
 	};
-	int i=0;
 
+	int *pline=line;
+
 	for(int l=0;l&lt;8;++l){
-		int num=line[i++];
+		int num=*pline++;
 		int cover1=0;
 		int cover2=0;
 		int cover3=0;
 		int cover4=0;
 		float total=0;
 		for(int x=0;x&lt;num;++x){
-			int dx=line[i++];
-			int dy=line[i++];
+			int dx=*pline++;
+			int dy=*pline++;
 			int incy = ((baseY+dy) &amp; CLOUD_MASK) * CLOUD_SIZE;
 			int decy = ((baseY-dy) &amp; CLOUD_MASK) * CLOUD_SIZE;
 			int incx = (baseX+dx) &amp; CLOUD_MASK;
 			int decx = (baseX-dx) &amp; CLOUD_MASK;
 
-			cover1+=255-cloudThickness2[incy+decx];//*(num-x);
-			cover2+=255-cloudThickness2[decy+decx];//*(num-x);
-			cover3+=255-cloudThickness2[decy+incx];//*(num-x);
-			cover4+=255-cloudThickness2[incy+incx];//*(num-x);
+			cover1+=255-cloudThickness[incy+decx];//*(num-x);
+			cover2+=255-cloudThickness[decy+decx];//*(num-x);
+			cover3+=255-cloudThickness[decy+incx];//*(num-x);
+			cover4+=255-cloudThickness[incy+incx];//*(num-x);
 			total+=1;//(num-x);
 		}
 
@@ -764,7 +752,7 @@
 	glBlendFunc(GL_SRC_ALPHA,GL_ONE);
 	glDisable(GL_DEPTH_TEST);
 
-	unsigned char randDetailMatrix[32*32];
+	static unsigned char randDetailMatrix[32*32];
 
 	for(int a=0;a&lt;5;++a){
 		float fade=(gs-&gt;frameNum/float(30&lt;&lt;a));
@@ -793,14 +781,16 @@
 //		logOutput.Print(&quot;%f&quot;,c);
 		CVertexArray* va=GetVertexArray();
 		va-&gt;Initialize();
+#if VA_INIT_VERTEXES &lt; 4*VA_SIZE_T
+#error &quot;Vertex array too small&quot;
+#endif
+		va-&gt;AddVertexQT(ZeroVector,0,0);
+		va-&gt;AddVertexQT(float3(1,0,0),tSize,0);
+		va-&gt;AddVertexQT(float3(1,1,0),tSize,tSize);
+		va-&gt;AddVertexQT(UpVector,0,tSize);
 
-		va-&gt;AddVertexT(ZeroVector,0,0);
-		va-&gt;AddVertexT(float3(1,0,0),tSize,0);
-		va-&gt;AddVertexT(float3(1,1,0),tSize,tSize);
-		va-&gt;AddVertexT(UpVector,0,tSize);
+		float ifade=fade*fade*(3-2*fade);
 
-		float ifade=(3*fade*fade-2*fade*fade*fade);
-
 		glBindTexture(GL_TEXTURE_2D, detailTextures[a+6]);
 		glColor4f(c,c,c,1-ifade);
 		va-&gt;DrawArrayT(GL_QUADS);

Modified: trunk/rts/Rendering/Env/AdvSky.h
===================================================================
--- trunk/rts/Rendering/Env/AdvSky.h	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/AdvSky.h	2008-10-02 21:20:53 UTC (rev 6501)
@@ -8,6 +8,8 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;BaseSky.h&quot;
 
+#define CLOUD_SIZE 256 // must be divisible by 4 and 8
+
 class CAdvSky : public CBaseSky
 {
 public:
@@ -16,12 +18,13 @@
 	void CreateCover(int baseX,int baseY,float* buf);
 	void InitSun();
 	void CreateTransformVectors();
-	void CreateRandMatrix(int matrix[32][32],float mod);
+	void CreateRandMatrix(int **matrix,float mod);
 	void CreateRandDetailMatrix(unsigned char* matrix,int size);
 	void DrawShafts();
 	void ResetCloudShadow(int texunit);
 	void SetCloudShadow(int texunit);
 	void CreateClouds();
+	void UpdatePart(int ast, int aed, int a3cstart, int a4cstart);
 	void Update();
 	void DrawSun();
 	void Draw();
@@ -40,8 +43,14 @@
 
 	unsigned int cloudFP;
 
-	int randMatrix[16][32][32];
+	int ***randMatrix;
+	int **rawClouds;
+	int ***blendMatrix;
 
+	int ydif[CLOUD_SIZE];
+	int ydif1[CLOUD_SIZE]; // ydif &gt;&gt; 1
+	int ydif2[CLOUD_SIZE]; // ydif &gt;&gt; 2
+
 	unsigned char alphaTransform[1024];
 	unsigned char thicknessTransform[1024];
 
@@ -52,7 +61,7 @@
 	GLuint detailTextures[12];
 	bool cloudDetailDown[5];
 
-	unsigned char *cloudThickness2;
+	unsigned char *cloudThickness;
 	unsigned char *cloudTexMem;
 
 	float covers[4][32];

Modified: trunk/rts/Rendering/Env/AdvTreeDrawer.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvTreeDrawer.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/AdvTreeDrawer.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -121,8 +121,9 @@
 	ftpos.y+=PART_MAX_TREE_HEIGHT;
 }
 
-inline void DrawTreeVertex(float3 pos, float dx, float dy) {
-	va-&gt;EnlargeArrays(12,0,5);
+inline void DrawTreeVertex(float3 pos, float dx, float dy, bool enlarge=true) {
+	if(enlarge)
+		va-&gt;EnlargeArrays(12,0,VA_SIZE_T);
 	float3 ftpos=pos;
 	ftpos.x+=HALF_MAX_TREE_HEIGHT;
 	DrawTreeVertexA(ftpos, dx, dy);
@@ -136,8 +137,9 @@
 	SetArrayQ(TEX_LEAF_END_X3+dx,TEX_LEAF_START_Y3+dy,ftpos);
 }
 
-inline void DrawTreeVertexMid(const float3 pos, float dx, float dy) {
-	va-&gt;EnlargeArrays(12,0,5);
+inline void DrawTreeVertexMid(const float3 pos, float dx, float dy, bool enlarge=true) {
+	if(enlarge)
+		va-&gt;EnlargeArrays(12,0,VA_SIZE_T);
 	float3 ftpos=pos;
 	ftpos.x+=HALF_MAX_TREE_HEIGHT;
 	DrawTreeVertexA(ftpos, dx, dy);
@@ -154,8 +156,9 @@
 	SetArrayQ(TEX_LEAF_END_X3+dx,TEX_LEAF_START_Y3+dy,ftpos);
 }
 
-inline void DrawTreeVertexFar(float3 pos, float3 swd, float dx, float dy) {
-	va-&gt;EnlargeArrays(4,0,5);
+inline void DrawTreeVertexFar(float3 pos, float3 swd, float dx, float dy, bool enlarge=true) {
+	if(enlarge)
+		va-&gt;EnlargeArrays(4,0,VA_SIZE_T);
 	float3 base=pos+swd;
 	SetArrayQ(TEX_LEAF_START_X1+dx,TEX_LEAF_START_Y4+dy,base);
 	base.y+=MAX_TREE_HEIGHT;
@@ -198,6 +201,7 @@
 		if(!tss-&gt;farDisplist || dif.dot(tss-&gt;viewVector)&lt;0.97f){
 			va=GetVertexArray();
 			va-&gt;Initialize();
+			va-&gt;EnlargeArrays(4*tss-&gt;trees.size(),0,VA_SIZE_T); //!alloc room for all tree vertexes
 			tss-&gt;viewVector=dif;
 			if(!tss-&gt;farDisplist)
 				tss-&gt;farDisplist=glGenLists(1);
@@ -208,9 +212,9 @@
 				CAdvTreeDrawer::TreeStruct* ts=&amp;ti-&gt;second;
 
 				if(ts-&gt;type&lt;8)
-					DrawTreeVertexFar(ts-&gt;pos, side*HALF_MAX_TREE_HEIGHT, ts-&gt;type*0.125f, 0.5f);
+					DrawTreeVertexFar(ts-&gt;pos, side*HALF_MAX_TREE_HEIGHT, ts-&gt;type*0.125f, 0.5f, false);
 				else
-					DrawTreeVertexFar(ts-&gt;pos, side*HALF_MAX_TREE_HEIGHT, (ts-&gt;type-8)*0.125f, 0);
+					DrawTreeVertexFar(ts-&gt;pos, side*HALF_MAX_TREE_HEIGHT, (ts-&gt;type-8)*0.125f, 0, false);
 			}
 			glNewList(tss-&gt;farDisplist,GL_COMPILE);
 			va-&gt;DrawArrayT(GL_QUADS);
@@ -234,15 +238,17 @@
 		if(!tss-&gt;displist){
 			va=GetVertexArray();
 			va-&gt;Initialize();
+			va-&gt;EnlargeArrays(12*tss-&gt;trees.size(),0,VA_SIZE_T); //!alloc room for all tree vertexes
+
 			tss-&gt;displist=glGenLists(1);
 
 			for(std::map&lt;int,CAdvTreeDrawer::TreeStruct&gt;::iterator ti=tss-&gt;trees.begin();ti!=tss-&gt;trees.end();++ti){
 				CAdvTreeDrawer::TreeStruct* ts=&amp;ti-&gt;second;
 
 				if(ts-&gt;type&lt;8)
-					DrawTreeVertexMid(ts-&gt;pos, ts-&gt;type*0.125f, 0.5f);
+					DrawTreeVertexMid(ts-&gt;pos, ts-&gt;type*0.125f, 0.5f, false);
 				else
-					DrawTreeVertexMid(ts-&gt;pos, (ts-&gt;type-8)*0.125f, 0);
+					DrawTreeVertexMid(ts-&gt;pos, (ts-&gt;type-8)*0.125f, 0, false);
 			}
 			glNewList(tss-&gt;displist,GL_COMPILE);
 			va-&gt;DrawArrayT(GL_QUADS);
@@ -375,6 +381,7 @@
 		for(TreeSquareStruct* pTSS=trees+ystart*treesX; pTSS&lt;=trees+yend*treesX; pTSS+=treesX) {
 			for(TreeSquareStruct* tss=pTSS+xstart; tss&lt;=pTSS+xend; ++tss) {
 				tss-&gt;lastSeen=gs-&gt;frameNum;
+				va-&gt;EnlargeArrays(12*tss-&gt;trees.size(),0,VA_SIZE_T); //!alloc room for all tree vertexes
 				for(std::map&lt;int,TreeStruct&gt;::iterator ti=tss-&gt;trees.begin();ti!=tss-&gt;trees.end();++ti){
 					TreeStruct* ts=&amp;ti-&gt;second;
 					float3 pos(ts-&gt;pos);
@@ -406,7 +413,7 @@
 							pFT-&gt;relDist=relDist;
 							++pFT;
 						} else {																//draw undetailed tree
-							DrawTreeVertex(pos, type*0.125f, dy);
+							DrawTreeVertex(pos, type*0.125f, dy, false);
 						}
 					}
 				}
@@ -460,9 +467,11 @@
 		for(FadeTree *pFTree=fadeTrees; pFTree&lt;pFT; ++pFTree) { //faded close trees
 			va=GetVertexArray();
 			va-&gt;Initialize();
+#if VA_INIT_VERTEXES &lt; 12*VA_SIZE_T
+#error &quot;Vertex array too small&quot;
+#endif
+			DrawTreeVertex(pFTree-&gt;pos, pFTree-&gt;type*0.125f, pFTree-&gt;deltaY, false);
 
-			DrawTreeVertex(pFTree-&gt;pos, pFTree-&gt;type*0.125f, pFTree-&gt;deltaY);
-
 			glAlphaFunc(GL_GREATER,1-pFTree-&gt;relDist*0.5f);
 			va-&gt;DrawArrayT(GL_QUADS);
 		}
@@ -550,6 +559,7 @@
 		if(!tss-&gt;farDisplist || dif.dot(tss-&gt;viewVector)&lt;0.97f){
 			va=GetVertexArray();
 			va-&gt;Initialize();
+			va-&gt;EnlargeArrays(4*tss-&gt;trees.size(),0,VA_SIZE_T); //!alloc room for all tree vertexes
 			tss-&gt;viewVector=dif;
 			if(!tss-&gt;farDisplist)
 				tss-&gt;farDisplist=glGenLists(1);
@@ -560,9 +570,9 @@
 				CAdvTreeDrawer::TreeStruct* ts=&amp;ti-&gt;second;
 
 				if(ts-&gt;type&lt;8)
-					DrawTreeVertexFar(ts-&gt;pos, side*HALF_MAX_TREE_HEIGHT, ts-&gt;type*0.125f, 0.5f);
+					DrawTreeVertexFar(ts-&gt;pos, side*HALF_MAX_TREE_HEIGHT, ts-&gt;type*0.125f, 0.5f, false);
 				else
-					DrawTreeVertexFar(ts-&gt;pos, side*HALF_MAX_TREE_HEIGHT, (ts-&gt;type-8)*0.125f, 0);
+					DrawTreeVertexFar(ts-&gt;pos, side*HALF_MAX_TREE_HEIGHT, (ts-&gt;type-8)*0.125f, 0, false);
 			}
 			glNewList(tss-&gt;farDisplist,GL_COMPILE);
 			va-&gt;DrawArrayT(GL_QUADS);
@@ -584,15 +594,16 @@
 		if(!tss-&gt;displist){
 			va=GetVertexArray();
 			va-&gt;Initialize();
+			va-&gt;EnlargeArrays(12*tss-&gt;trees.size(),0,VA_SIZE_T); //!alloc room for all tree vertexes
 			tss-&gt;displist=glGenLists(1);
 
 			for(std::map&lt;int,CAdvTreeDrawer::TreeStruct&gt;::iterator ti=tss-&gt;trees.begin();ti!=tss-&gt;trees.end();++ti){
 				CAdvTreeDrawer::TreeStruct* ts=&amp;ti-&gt;second;
 
 				if(ts-&gt;type&lt;8)
-					DrawTreeVertexMid(ts-&gt;pos, ts-&gt;type*0.125f, 0.5f);
+					DrawTreeVertexMid(ts-&gt;pos, ts-&gt;type*0.125f, 0.5f, false);
 				else
-					DrawTreeVertexMid(ts-&gt;pos, (ts-&gt;type-8)*0.125f, 0);
+					DrawTreeVertexMid(ts-&gt;pos, (ts-&gt;type-8)*0.125f, 0, false);
 			}
 			glNewList(tss-&gt;displist,GL_COMPILE);
 			va-&gt;DrawArrayT(GL_QUADS);
@@ -665,6 +676,7 @@
 		for(TreeSquareStruct* pTSS=trees+ystart*treesX; pTSS&lt;=trees+yend*treesX; pTSS+=treesX) {
 			for(TreeSquareStruct* tss=pTSS+xstart; tss&lt;=pTSS+xend; ++tss) {
 				tss-&gt;lastSeen=gs-&gt;frameNum;
+				va-&gt;EnlargeArrays(12*tss-&gt;trees.size(),0,VA_SIZE_T); //!alloc room for all tree vertexes
 				for(std::map&lt;int,TreeStruct&gt;::iterator ti=tss-&gt;trees.begin();ti!=tss-&gt;trees.end();++ti){
 					TreeStruct* ts=&amp;ti-&gt;second;
 					float3 pos(ts-&gt;pos);
@@ -696,7 +708,7 @@
 							pFT-&gt;relDist=relDist;
 							++pFT;
 						} else {																//draw undetailed tree
-							DrawTreeVertex(pos, type*0.125f, dy);
+							DrawTreeVertex(pos, type*0.125f, dy, false);
 						}
 					}
 				}
@@ -737,9 +749,11 @@
 		for(FadeTree *pFTree=fadeTrees; pFTree&lt;pFT; ++pFTree) { //faded close trees
 			va=GetVertexArray();
 			va-&gt;Initialize();
+#if VA_INIT_VERTEXES &lt; 12*VA_SIZE_T
+#error &quot;Vertex array too small&quot;
+#endif
+			DrawTreeVertex(pFTree-&gt;pos, pFTree-&gt;type*0.125f, pFTree-&gt;deltaY, false);
 
-			DrawTreeVertex(pFTree-&gt;pos, pFTree-&gt;type*0.125f, pFTree-&gt;deltaY);
-
 			glAlphaFunc(GL_GREATER,1-pFTree-&gt;relDist*0.5f);
 			va-&gt;DrawArrayT(GL_QUADS);
 		}

Modified: trunk/rts/Rendering/Env/AdvWater.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvWater.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/AdvWater.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -174,6 +174,7 @@
 
 	CVertexArray* va=GetVertexArray();
 	va-&gt;Initialize();
+	va-&gt;EnlargeArrays(5*numDivs*(numDivs+1)*2,5*numDivs,VA_SIZE_TC); //!alloc room for all vertexes and strips
 	for(int a=0;a&lt;5;++a){
 		bool maxReached=false;
 		for(int y=0;y&lt;numDivs;++y){
@@ -192,18 +193,18 @@
 				zpos=camera-&gt;pos+dir*(camera-&gt;pos.y/-dir.y);
 				zpos.y=sin(zpos.z*0.1f+gs-&gt;frameNum*0.06f)*0.06f+0.05f;
 				col[3]=(unsigned char)((0.8f+0.7f*(dir.y))*255);
-				va-&gt;AddVertexTC(zpos,x*(1.0f/numDivs),screenY-yInc,col);
+				va-&gt;AddVertexQTC(zpos,x*(1.0f/numDivs),screenY-yInc,col);
 
 				dir=xbase;
 				dir.Normalize();
 				zpos=camera-&gt;pos+dir*(camera-&gt;pos.y/-dir.y);
 				zpos.y=sin(zpos.z*0.1f+gs-&gt;frameNum*0.06f)*0.06f+0.05f;
 				col[3]=(unsigned char)((0.8f+0.7f*(dir.y))*255);
-				va-&gt;AddVertexTC(zpos,x*(1.0f/numDivs),screenY,col);
+				va-&gt;AddVertexQTC(zpos,x*(1.0f/numDivs),screenY,col);
 
 				xbase+=dh;
 			}
-			va-&gt;EndStrip();
+			va-&gt;EndStripQ();
 			base+=dv;
 			screenY-=yInc;
 		}

Modified: trunk/rts/Rendering/Env/BasicSky.cpp
===================================================================
--- trunk/rts/Rendering/Env/BasicSky.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/BasicSky.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -30,11 +30,16 @@
 #define X_PART 10.0
 
 #define CLOUD_DETAIL 6
-#define CLOUD_SIZE 256
+#define CLOUD_MASK (CLOUD_SIZE-1)
 
 CBasicSky::CBasicSky()
 {
 	PrintLoadMsg(&quot;Creating sky&quot;);
+
+	randMatrix=newmat3&lt;int&gt;(16,32,32);
+	rawClouds=newmat2&lt;int&gt;(CLOUD_SIZE,CLOUD_SIZE);
+	blendMatrix=newmat3&lt;int&gt;(CLOUD_DETAIL,32,32);
+
 	domeheight=cos(PI/16)*1.01f;
 	domeWidth=sin(2*PI/32)*400*1.7f;
 
@@ -236,6 +241,10 @@
 	glDeleteLists(sunFlareList,1);
 
 	delete[] cloudThickness;
+
+	delmat3&lt;int&gt;(randMatrix);
+	delmat2&lt;int&gt;(rawClouds);
+	delmat3&lt;int&gt;(blendMatrix);
 }
 
 void CBasicSky::Draw()
@@ -310,8 +319,7 @@
 	glGenTextures(1, &amp;cloudDot3Tex);
 	int y;
 
-	static unsigned char skytex[512][512][4];//=SAFE_NEW unsigned char[512][512][4];
-	static unsigned char skytex2[256][256][4];
+	unsigned char (* skytex)[512][4]=SAFE_NEW unsigned char[512][512][4]; // this is too big for the stack
 
 	for(y=0;y&lt;512;y++){
 		for(int x=0;x&lt;512;x++){
@@ -339,8 +347,9 @@
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_NEAREST);
 	glBuildMipmaps(GL_TEXTURE_2D,GL_RGBA8 ,512, 512, GL_RGBA, GL_UNSIGNED_BYTE, skytex[0][0]);
-//	delete[] skytex;
+	delete [] skytex;
 
+	unsigned char (* skytex2)[256][4]=SAFE_NEW unsigned char[256][256][4];
 	for(y=0;y&lt;256;y++){
 		for(int x=0;x&lt;256;x++){
 			float3 dir=GetDirFromTexCoord(x/256.0f,y/256.0f);
@@ -360,6 +369,7 @@
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_NEAREST);
 	glBuildMipmaps(GL_TEXTURE_2D,GL_RGBA8 ,256, 256, GL_RGBA, GL_UNSIGNED_BYTE, skytex2[0][0]);
+	delete [] skytex2;
 
 	for(int a=0;a&lt;CLOUD_DETAIL;a++){
 		CreateRandMatrix(randMatrix[a],1-a*0.03f);
@@ -371,7 +381,7 @@
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
 	glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
 	glTexImage2D(GL_TEXTURE_2D,0,GL_RGBA8, CLOUD_SIZE, CLOUD_SIZE,0,GL_RGBA, GL_UNSIGNED_BYTE, scrap);
-	delete[] scrap;
+  delete [] scrap;
 
 	dynamicSky=true;
 	CreateTransformVectors();
@@ -379,192 +389,169 @@
 	dynamicSky=false;
 }
 
+inline void CBasicSky::UpdatePart(int ast, int aed, int a3cstart, int a4cstart) {
+	int *rc=*rawClouds+ast;
+	unsigned char *ct=cloudThickness+4*ast;
+
+	int am2=(ast-2)&amp;CLOUD_MASK, am1=(ast-1)&amp;CLOUD_MASK, aa=(ast)&amp;CLOUD_MASK, ap1=(ast+1)&amp;CLOUD_MASK;
+	aed=aed*4+3;
+	ast=ast*4+3;
+	int a3c=ast+a3cstart*4, a4c=ast+a4cstart*4;
+	for(int a=ast; a&lt;aed; ++rc, ++ct){
+		ydif[ap1]+=(int)cloudThickness[a3c+=4] - cloudThickness[a+=4] * 2 + cloudThickness[a4c+=4];
+		ydif2[ap1]=(ydif1[ap1]=ydif[ap1]&gt;&gt;1)&gt;&gt;1;
+		int dif=(ydif2[am2] + ydif1[am2=am1] + ydif[am1=aa] + ydif1[aa=ap1] + ydif2[++ap1]) / 16;
+		if(ap1&gt;=CLOUD_SIZE)
+			ap1=0;
+		*ct++=128+dif;
+		*ct++=thicknessTransform[(*rc)&gt;&gt;7];
+		*ct++=255;
+	}
+}
+
 void CBasicSky::Update()
 {
 	if(lastCloudUpdate&gt;gs-&gt;frameNum-10 || !dynamicSky)
 		return;
 
-	SCOPED_TIMER(&quot;Drawing sky&quot;);
+	SCOPED_TIMER(&quot;Updating sky&quot;);
 
 	lastCloudUpdate=gs-&gt;frameNum;
 
-	int blendMatrix[CLOUD_DETAIL][32][32];
-	for(int a=0;a&lt;CLOUD_DETAIL;a++){
+	for(int a=0; a&lt;CLOUD_DETAIL; a++) {
 		float fade=(gs-&gt;frameNum/(70.0f*(2&lt;&lt;(CLOUD_DETAIL-1-a))));
 		fade-=floor(fade/2)*2;
-		if(fade&gt;1){
+		if(fade&gt;1) {
 			fade=2-fade;
-			if(!cloudDown[a]){
+			if(!cloudDown[a]) {
 				cloudDown[a]=true;
 				CreateRandMatrix(randMatrix[a+8],1-a*0.03f);
 			}
 		} else {
-			if(cloudDown[a]){
+			if(cloudDown[a]) {
 				cloudDown[a]=false;
 				CreateRandMatrix(randMatrix[a],1-a*0.03f);
 			}
-
 		}
-		int ifade=(int)((3*fade*fade-2*fade*fade*fade)*256);
+		int ifade=(int)(fade*fade*(3-2*fade)*256);
+		int ifade2=256-ifade;
 
-		for(int y=0;y&lt;32;y++){
-			for(int x=0;x&lt;32;x++){
-				blendMatrix[a][y][x]=(randMatrix[a][y][x]*ifade+randMatrix[a+8][y][x]*(256-ifade))&gt;&gt;8;
+		int **bm=blendMatrix[a], **rm=randMatrix[a], **rm8=randMatrix[a+8];
+
+		for(int y=0; y&lt;32; ++y, ++bm, ++rm, ++rm8) {
+			int *bmx=*bm, *rmx=*rm, *rm8x=*rm8;
+			for(int x=0; x&lt;32; ++x) {
+				(*bmx++)=((*rmx++)*ifade+(*rm8x++)*ifade2)&gt;&gt;8;
 			}
 		}
 	}
-	int rawClouds[CLOUD_SIZE][CLOUD_SIZE];//=SAFE_NEW int[CLOUD_SIZE][CLOUD_SIZE];
 
-	for(int a=0;a&lt;CLOUD_SIZE*CLOUD_SIZE;a++){
-		rawClouds[0][a]=0;
-	}
+	for(int *rc=*rawClouds, *ec=rc+CLOUD_SIZE*CLOUD_SIZE; rc&lt;ec; ++rc)
+		(*rc)=0;
 
-	int kernel[CLOUD_SIZE/4*CLOUD_SIZE/4];
-	for(int a=0;a&lt;CLOUD_DETAIL;a++){
-		for(int y=0;y&lt;(CLOUD_SIZE/4)&gt;&gt;a;++y){
-			float ydist=fabs((float)1+y-((CLOUD_SIZE/8)&gt;&gt;a))/((CLOUD_SIZE/8)&gt;&gt;a);
-			ydist=3*ydist*ydist-2*ydist*ydist*ydist;
-			for(int x=0;x&lt;(CLOUD_SIZE/4)&gt;&gt;a;++x){
-				float xdist=fabs((float)1+x-((CLOUD_SIZE/8)&gt;&gt;a))/((CLOUD_SIZE/8)&gt;&gt;a);
-				xdist=3*xdist*xdist-2*xdist*xdist*xdist;
+	static int kernel[CLOUD_SIZE/4*CLOUD_SIZE/4];
+	for(int a=0; a&lt;CLOUD_DETAIL; ++a) {
+		int cs4a=(CLOUD_SIZE/4)&gt;&gt;a;
+		int cs8a=(CLOUD_SIZE/8)&gt;&gt;a;
+		int cmcs8a=CLOUD_SIZE-cs8a;
+		int qcda=(4&lt;&lt;CLOUD_DETAIL)&gt;&gt;a;
+		int *pkernel=kernel;
+		for(int y=0; y&lt;cs4a; ++y, pkernel+=CLOUD_SIZE/4) {
+			float ydist=fabs(1.0f+y-cs8a)/cs8a;
+			ydist=ydist*ydist*(3-2*ydist);
+			int *pkrn=pkernel;
+			for(int x=0; x&lt;cs4a; ++x) {
+				float xdist=fabs(1.0f+x-cs8a)/cs8a;
+				xdist=xdist*xdist*(3-2*xdist);
 
 				float contrib=(1-xdist)*(1-ydist);
-				kernel[y*CLOUD_SIZE/4+x]=(int)( contrib*((4&lt;&lt;CLOUD_DETAIL)&gt;&gt;a));
+				(*pkrn++)=(int)(contrib*qcda);
 			}
 		}
+		--cs4a; //!
+		int **bm=blendMatrix[a];
+		int **prc=rawClouds;
 		unsigned int by=0,bx=0;
-		for(int y=0;y&lt;CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);y+=(CLOUD_SIZE/8)&gt;&gt;a){
-			for(int x=0;x&lt;CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);x+=(CLOUD_SIZE/8)&gt;&gt;a){
-				int blend=blendMatrix[a][by&amp;31][bx&amp;31];
-				for(int y2=0;y2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++y2){
-					for(int x2=0;x2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++x2){
-						rawClouds[y+y2][x+x2]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
+		for(int y=0; y&lt;cmcs8a; y+=cs8a, ++by, prc+=cs8a) {
+			for(int x=0; x&lt;cmcs8a; x+=cs8a, ++bx) {
+				int blend=bm[by&amp;31][bx&amp;31];
+				int **prcy=prc;
+				int *pkernel=kernel;
+				for(int y2=0; y2&lt;cs4a; ++y2, ++prcy, pkernel+=CLOUD_SIZE/4) {
+					int *prcx=(*prcy)+x;
+					int *pkrn=pkernel;
+					for(int x2=0; x2&lt;cs4a; ++x2) {
+						(*prcx++)+=blend*(*pkrn++);
 					}
 				}
-				bx++;
 			}
-			by++;
 		}
 		by=0;
 		bx=31;
-		for(int y=0;y&lt;CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);y+=(CLOUD_SIZE/8)&gt;&gt;a){
-			int x=CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);
-			int blend=blendMatrix[a][by&amp;31][bx&amp;31];
-			for(int y2=0;y2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++y2){
-				for(int x2=0;x2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++x2){
-					if(x+x2&lt;CLOUD_SIZE)
-						rawClouds[y+y2][x+x2]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
+		prc=rawClouds;
+		for(int y=0; y&lt;cmcs8a; y+=cs8a, ++by, prc+=cs8a) {
+			int blend=bm[by&amp;31][bx&amp;31];
+			int **prcy=prc;
+			int *pkernel=kernel;
+			for(int y2=0; y2&lt;cs4a; ++y2, ++prcy, pkernel+=CLOUD_SIZE/4) {
+				int *prcx=(*prcy)+cmcs8a;
+				int *prcx2=prcx-CLOUD_SIZE;
+				int *pkrn=pkernel;
+				for(int x2=cmcs8a; x2&lt;cs4a+cmcs8a; ++x2, ++prcx, ++prcx2, ++pkrn) {
+					if(x2&lt;CLOUD_SIZE)
+						(*prcx)+=blend*(*pkrn);
 					else
-						rawClouds[y+y2][x+x2-CLOUD_SIZE]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
+						(*prcx2)+=blend*(*pkrn);
 				}
 			}
-			by++;
 		}
 		bx=0;
 		by=31;
-		for(int x=0;x&lt;CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);x+=(CLOUD_SIZE/8)&gt;&gt;a){
-			int y=CLOUD_SIZE-((CLOUD_SIZE/8)&gt;&gt;a);
-			int blend=blendMatrix[a][by&amp;31][bx&amp;31];
-			for(int y2=0;y2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++y2){
-				for(int x2=0;x2&lt;((CLOUD_SIZE/4)&gt;&gt;a)-1;++x2){
-					if(y+y2&lt;CLOUD_SIZE)
-						rawClouds[y+y2][x+x2]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
-					else
-						rawClouds[y+y2-CLOUD_SIZE][x+x2]+=blend*kernel[y2*CLOUD_SIZE/4+x2];
+		prc=rawClouds+cmcs8a;
+		for(int x=0; x&lt;cmcs8a; x+=cs8a, ++bx) {
+			int blend=bm[by&amp;31][bx&amp;31];
+			int **prcy=prc;
+			int *pkernel=kernel;
+			for(int y2=cmcs8a; y2&lt;cs4a+cmcs8a; ++y2, ++prcy, pkernel+=CLOUD_SIZE/4) {
+				int *pkrn=pkernel;
+				int *prcx=(y2&lt;CLOUD_SIZE)?(*prcy)+x:(*(prcy-CLOUD_SIZE))+x;
+				for(int x2=0; x2&lt;cs4a; ++x2, ++prcx, ++pkrn) {
+					(*prcx)+=blend*(*pkrn);
 				}
 			}
-			bx++;
 		}
 	}
 
-	for(int a=0;a&lt;CLOUD_SIZE*CLOUD_SIZE;a++){
-		cloudThickness[a*4+3]=alphaTransform[rawClouds[0][a]&gt;&gt;7];
-	}
+	unsigned char *ct=cloudThickness+3;
+	for(int *rc=*rawClouds, *ec=rc+CLOUD_SIZE*CLOUD_SIZE; rc&lt;ec; ct+=4, ++rc)
+		(*ct)=alphaTransform[(*rc)&gt;&gt;7];
+
 	cloudThickness[CLOUD_SIZE*CLOUD_SIZE*4+3]=alphaTransform[rawClouds[0][0]&gt;&gt;7];
-        // next line unused
+	// next line unused
 	cloudThickness[CLOUD_SIZE*CLOUD_SIZE*4+0]=cloudThickness[CLOUD_SIZE*CLOUD_SIZE*4+1]=cloudThickness[CLOUD_SIZE*CLOUD_SIZE*4+2]=0;
 
 	//create the cloud shading
-	int ydif[CLOUD_SIZE];
-	for(int a=0;a&lt;CLOUD_SIZE;++a){
-		ydif[a]=0;
-		ydif[a]+=cloudThickness[(a+3*CLOUD_SIZE)*4+3];
-		ydif[a]+=cloudThickness[(a+2*CLOUD_SIZE)*4+3];
-		ydif[a]+=cloudThickness[(a+1*CLOUD_SIZE)*4+3];
-		ydif[a]+=cloudThickness[(a+0*CLOUD_SIZE)*4+3];
-		ydif[a]-=cloudThickness[(a-1*CLOUD_SIZE+CLOUD_SIZE*CLOUD_SIZE)*4+3];
-		ydif[a]-=cloudThickness[(a-2*CLOUD_SIZE+CLOUD_SIZE*CLOUD_SIZE)*4+3];
-		ydif[a]-=cloudThickness[(a-3*CLOUD_SIZE+CLOUD_SIZE*CLOUD_SIZE)*4+3];
+	for(int a=0, a4=3; a&lt;CLOUD_SIZE; ++a, a4+=4) {
+		ydif[a]=(int)cloudThickness[(a4+3*CLOUD_SIZE*4)] + cloudThickness[(a4+2*CLOUD_SIZE*4)] + cloudThickness[(a4+1*CLOUD_SIZE*4)] + 
+			cloudThickness[(a4+0*CLOUD_SIZE*4)] - cloudThickness[(a4+(CLOUD_SIZE-1)*CLOUD_SIZE*4)] - 
+			cloudThickness[(a4+(CLOUD_SIZE-2)*CLOUD_SIZE*4)] - cloudThickness[(a4+(CLOUD_SIZE-3)*CLOUD_SIZE*4)];
+		ydif2[a]=(ydif1[a]=ydif[a]&gt;&gt;1)&gt;&gt;1;
 	}
 
 	int b=0;
-	ydif[(b)&amp;255]+=cloudThickness[(b-3*CLOUD_SIZE+CLOUD_SIZE*CLOUD_SIZE)*4+3];
-	ydif[(b)&amp;255]-=cloudThickness[(b)*4+3]*2;
-	ydif[(b)&amp;255]+=cloudThickness[(b+4*CLOUD_SIZE)*4+3];
+	ydif[(b)&amp;CLOUD_MASK]+=cloudThickness[(b-3*CLOUD_SIZE+CLOUD_SIZE*CLOUD_SIZE)*4+3];
+	ydif[(b)&amp;CLOUD_MASK]-=cloudThickness[(b)*4+3]*2;
+	ydif[(b)&amp;CLOUD_MASK]+=cloudThickness[(b+4*CLOUD_SIZE)*4+3];
+	ydif2[(b)&amp;CLOUD_MASK]=(ydif1[(b)&amp;CLOUD_MASK]=ydif[(b)&amp;CLOUD_MASK]&gt;&gt;1)&gt;&gt;1;
 
-	for(int a=0;a&lt;CLOUD_SIZE*3-1;a++){
-		ydif[(a+1)&amp;255]+=cloudThickness[(a-3*CLOUD_SIZE+1+CLOUD_SIZE*CLOUD_SIZE)*4+3];
-		ydif[(a+1)&amp;255]-=cloudThickness[(a+1)*4+3]*2;
-		ydif[(a+1)&amp;255]+=cloudThickness[(a+4*CLOUD_SIZE+1)*4+3];
-
-		int dif=0;
-
-		dif+=ydif[(a)&amp;255];
-		dif+=ydif[(a+1)&amp;255]&gt;&gt;1;
-		dif+=ydif[(a-1)&amp;255]&gt;&gt;1;
-		dif+=ydif[(a+2)&amp;255]&gt;&gt;2;
-		dif+=ydif[(a-2)&amp;255]&gt;&gt;2;
-		dif/=16;
-
-		cloudThickness[a*4+0]=128+dif;
-		cloudThickness[a*4+1]=thicknessTransform[rawClouds[0][a]&gt;&gt;7];
-		cloudThickness[a*4+2]=255;
-	}
-
-	for(int a=CLOUD_SIZE*3-1;a&lt;CLOUD_SIZE*CLOUD_SIZE-CLOUD_SIZE*4-1;a++){
-		ydif[(a+1)&amp;255]+=cloudThickness[(a-3*CLOUD_SIZE+1)*4+3];
-		ydif[(a+1)&amp;255]-=cloudThickness[(a+1)*4+3]*2;
-		ydif[(a+1)&amp;255]+=cloudThickness[(a+4*CLOUD_SIZE+1)*4+3];
-
-		int dif=0;
-
-		dif+=ydif[(a)&amp;255];
-		dif+=ydif[(a+1)&amp;255]&gt;&gt;1;
-		dif+=ydif[(a-1)&amp;255]&gt;&gt;1;
-		dif+=ydif[(a+2)&amp;255]&gt;&gt;2;
-		dif+=ydif[(a-2)&amp;255]&gt;&gt;2;
-		dif/=16;
-
-		cloudThickness[a*4+0]=128+dif;
-		cloudThickness[a*4+1]=thicknessTransform[rawClouds[0][a]&gt;&gt;7];
-		cloudThickness[a*4+2]=255;
-	}
-
-	for(int a=CLOUD_SIZE*CLOUD_SIZE-CLOUD_SIZE*4-1;a&lt;CLOUD_SIZE*CLOUD_SIZE;a++){
-		ydif[(a+1)&amp;255]+=cloudThickness[(a-3*CLOUD_SIZE+1)*4+3];
-		ydif[(a+1)&amp;255]-=cloudThickness[(a+1)*4+3]*2;
-		ydif[(a+1)&amp;255]+=cloudThickness[(a+4*CLOUD_SIZE+1-CLOUD_SIZE*CLOUD_SIZE)*4+3];
-
-		int dif=0;
-
-		dif+=ydif[(a)&amp;255];
-		dif+=ydif[(a+1)&amp;255]&gt;&gt;1;
-		dif+=ydif[(a-1)&amp;255]&gt;&gt;1;
-		dif+=ydif[(a+2)&amp;255]&gt;&gt;2;
-		dif+=ydif[(a-2)&amp;255]&gt;&gt;2;
-		dif/=16;
-
-		cloudThickness[a*4+0]=128+dif;
-		cloudThickness[a*4+1]=thicknessTransform[rawClouds[0][a]&gt;&gt;7];
-		cloudThickness[a*4+2]=255;
-	}
-
-//	delete[] rawClouds;
+	UpdatePart(0, CLOUD_SIZE*3-1, CLOUD_SIZE*(CLOUD_SIZE-3), 4*CLOUD_SIZE);
+	UpdatePart(CLOUD_SIZE*3-1, CLOUD_SIZE*(CLOUD_SIZE-4)-1, -3*CLOUD_SIZE, 4*CLOUD_SIZE);
+	UpdatePart(CLOUD_SIZE*(CLOUD_SIZE-4)-1, CLOUD_SIZE*CLOUD_SIZE, -3*CLOUD_SIZE, (4-CLOUD_SIZE)*CLOUD_SIZE);
 /*
-	for(int a=0;a&lt;CLOUD_SIZE;++a){
+	for(int a=0; a&lt;CLOUD_SIZE; ++a) {
 		cloudThickness[((int(48+camera-&gt;pos.z*CLOUD_SIZE*0.000025f)%256)*CLOUD_SIZE+a)*4+3]=0;
 	}
-	for(int a=0;a&lt;CLOUD_SIZE;++a){
+	for(int a=0; a&lt;CLOUD_SIZE; ++a) {
 		cloudThickness[(a*CLOUD_SIZE+int(gs-&gt;frameNum*0.00009f*256+camera-&gt;pos.x*CLOUD_SIZE*0.000025f))*4+3]=0;
 	}
 /**/
@@ -572,29 +559,30 @@
 	glTexSubImage2D(GL_TEXTURE_2D,0, 0,0,CLOUD_SIZE, CLOUD_SIZE,GL_RGBA, GL_UNSIGNED_BYTE, cloudThickness);
 }
 
-void CBasicSky::CreateRandMatrix(int matrix[32][32],float mod)
+void CBasicSky::CreateRandMatrix(int **matrix,float mod)
 {
-	for(int y=0;y&lt;32;y++){
-		for(int x=0;x&lt;32;x++){
-			float r = ((float)( rand() )) / (float)RAND_MAX;
-			matrix[y][x]=((int)( r * 255.0f ));
-		}
+	int *pmat=*matrix;
+	for(int a=0; a&lt;32*32; ++a) {
+		float r = ((float)( rand() )) / (float)RAND_MAX;
+		*pmat++=((int)( r * 255.0f ));
 	}
 }
 
 void CBasicSky::CreateTransformVectors()
 {
+	unsigned char *at=alphaTransform;
+	unsigned char *tt=thicknessTransform;
 	for(int a=0;a&lt;1024;++a){
 		float f=(1023.0f-(a+cloudDensity*1024-512))/1023.0f;
 		float alpha=pow(f*2,3);
 		if(alpha&gt;1)
 			alpha=1;
-		alphaTransform[a]=(unsigned char)(alpha*255);
+		*at=(unsigned char)(alpha*255);
 
 		float d=f*2;
 		if(d&gt;1)
 			d=1;
-		thicknessTransform[a]=(unsigned char)(128+d*64+alphaTransform[a]*255/(4*255));
+		*tt++=(unsigned char)(128+d*64+(*at++)*255/(4*255));
 	}
 }
 
@@ -606,7 +594,7 @@
 	glMultMatrixf(m.m);
 	glDisable(GL_DEPTH_TEST);
 
-	unsigned char buf[32];
+	static unsigned char buf[32];
 	glEnable(GL_TEXTURE_2D);
 
 	float3 modCamera=sundir1*camera-&gt;pos.x+sundir2*camera-&gt;pos.z;
@@ -619,25 +607,27 @@
 	int baseX=int(floor(fx))%256;
 	fx-=floor(fx);
 
+	float *cvs=covers[0], *cvs1=covers[1], *cvs2=covers[2], *cvs3=covers[3];
 	if(baseX!=oldCoverBaseX || baseY!=oldCoverBaseY){
 		oldCoverBaseX=baseX;
 		oldCoverBaseY=baseY;
-		CreateCover(baseX,baseY,covers[0]);
-		CreateCover(baseX+1,baseY,covers[1]);
-		CreateCover(baseX,baseY+1,covers[2]);
-		CreateCover(baseX+1,baseY+1,covers[3]);
+		CreateCover(baseX,baseY,cvs);
+		CreateCover(baseX+1,baseY,cvs1);
+		CreateCover(baseX,baseY+1,cvs2);
+		CreateCover(baseX+1,baseY+1,cvs3);
 	}
 
-	for(int x=0;x&lt;32;++x){
-		float cx1=covers[0][x]*(1-fx)+covers[1][x]*fx;
-		float cx2=covers[2][x]*(1-fx)+covers[3][x]*fx;
+	unsigned char *bf=buf;
+	for(int x=0;x&lt;32; ++x){
+		float cx1=(*cvs++)*(1-fx)+(*cvs1++)*fx;
+		float cx2=(*cvs2++)*(1-fx)+(*cvs3++)*fx;
 
 		float cover=cx1*(1-fy)+cx2*fy;
 
 		if(cover&gt;127.5f)
 			cover=127.5f;
 
-		buf[x]=(unsigned char)(255-cover*2);
+		(*bf++)=(unsigned char)(255-cover*2);
 	}
 	glBindTexture(GL_TEXTURE_2D, sunFlareTex);
 	glTexSubImage2D(GL_TEXTURE_2D,0,0,0,32,1,GL_LUMINANCE,GL_UNSIGNED_BYTE,buf);
@@ -704,7 +694,7 @@
 //	gluBuild2DMipmaps(GL_TEXTURE_2D,1 ,32, 2, GL_ALPHA, GL_UNSIGNED_BYTE, mem);
 	glTexImage2D(GL_TEXTURE_2D,0,1 ,32, 2,0, GL_LUMINANCE, GL_UNSIGNED_BYTE, mem);
 
-	delete[] mem;
+	delete [] mem;
 
 	float3 ldir=modSunDir.cross(UpVector);
 	float3 udir=modSunDir.cross(ldir);
@@ -744,18 +734,18 @@
 void CBasicSky::CreateCover(int baseX, int baseY, float *buf)
 {
 	static int line[]={ 5, 0, 1, 0, 2, 0, 3, 0, 4, 0, 5, 5, 0, 1, 0, 2, 1, 3, 1, 4, 1, 5, 5, 0, 1, 1, 2, 1, 3, 2, 4, 2, 5, 4, 1, 1, 2, 2, 2, 3, 3, 4, 4, 1, 1, 2, 2, 3, 3, 4, 4, 4, 1, 1, 2, 2, 3, 2, 4, 3, 5, 1, 0, 2, 1, 3, 1, 4, 2, 5, 2, 5, 1, 0, 2, 0, 3, 1, 4, 1, 5, 1};
-	int i=0;
+	int *pline=line;
 
 	for(int l=0;l&lt;8;++l){
-		int num=line[i++];
+		int num=*pline++;
 		int cover1=0;
 		int cover2=0;
 		int cover3=0;
 		int cover4=0;
 		float total=0;
 		for(int x=0;x&lt;num;++x){
-			int dx=line[i++];
-			int dy=line[i++];
+			int dx=*pline++;
+			int dy=*pline++;
 			cover1+=255-GetCloudThickness(baseX-dx,baseY+dy);
 			cover2+=255-GetCloudThickness(baseX-dy,baseY-dx);//*(num-x);
 			cover3+=255-GetCloudThickness(baseX+dx,baseY-dy);//*(num-x);

Modified: trunk/rts/Rendering/Env/BasicSky.h
===================================================================
--- trunk/rts/Rendering/Env/BasicSky.h	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/BasicSky.h	2008-10-02 21:20:53 UTC (rev 6501)
@@ -8,17 +8,20 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;BaseSky.h&quot;
 
+#define CLOUD_SIZE 256 // must be divisible by 4 and 8
+
 class CBasicSky : public CBaseSky
 {
 public:
 	void CreateCover(int baseX,int baseY,float* buf);
 	void InitSun();
 	void CreateTransformVectors();
-	void CreateRandMatrix(int matrix[32][32],float mod);
+	void CreateRandMatrix(int **matrix,float mod);
 	void DrawShafts();
 	void ResetCloudShadow(int texunit);
 	void SetCloudShadow(int texunit);
 	void CreateClouds();
+	void UpdatePart(int ast, int aed, int a3cstart, int a4cstart);
 	void Update();
 	void DrawSun();
 	void Draw();
@@ -36,8 +39,14 @@
 	GLuint sunFlareTex;
 	unsigned int sunFlareList;
 
-	int randMatrix[16][32][32];
+	int ***randMatrix;
+	int **rawClouds;
+	int ***blendMatrix;
 
+	int ydif[CLOUD_SIZE];
+	int ydif1[CLOUD_SIZE]; // ydif &gt;&gt; 1
+	int ydif2[CLOUD_SIZE]; // ydif &gt;&gt; 2
+
 	unsigned char alphaTransform[1024];
 	unsigned char thicknessTransform[1024];
 

Modified: trunk/rts/Rendering/Env/BasicTreeDrawer.cpp
===================================================================
--- trunk/rts/Rendering/Env/BasicTreeDrawer.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/BasicTreeDrawer.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -194,8 +194,9 @@
 	float treeDistance;
 };
 
-inline void DrawTreeVertexFar1(float3 pos, float3 swd) { 
-	va-&gt;EnlargeArrays(4,0,5);
+inline void DrawTreeVertexFar1(float3 pos, float3 swd, bool enlarge=true) { 
+	if(enlarge)
+		va-&gt;EnlargeArrays(4,0,VA_SIZE_T);
 	float3 base=pos+swd;
 	SetArrayQ(0,0,base);
 	base.y+=MAX_TREE_HEIGHT;
@@ -207,8 +208,9 @@
 	SetArrayQ(0.5f,0,base);
 }
 
-inline void DrawTreeVertexFar2(float3 pos, float3 swd) { 
-	va-&gt;EnlargeArrays(4,0,5);
+inline void DrawTreeVertexFar2(float3 pos, float3 swd, bool enlarge=true) { 
+	if(enlarge)
+		va-&gt;EnlargeArrays(4,0,VA_SIZE_T);
 	float3 base=pos+swd;
 	SetArrayQ(0,0.25f,base);
 	base.y+=MAX_TREE_HEIGHT;
@@ -220,8 +222,9 @@
 	SetArrayQ(0.25f,0.25f,base);
 }
 
-inline void DrawTreeVertexMid1(float3 pos) {
-	va-&gt;EnlargeArrays(12,0,5);
+inline void DrawTreeVertexMid1(float3 pos, bool enlarge=true) {
+	if(enlarge)
+		va-&gt;EnlargeArrays(12,0,VA_SIZE_T);
 	float3 base=pos;
 	base.x+=MAX_TREE_HEIGHT_3;
 
@@ -258,8 +261,9 @@
 	SetArrayQ(1,0,base);
 }
 
-inline void DrawTreeVertexMid2(float3 pos) {
-	va-&gt;EnlargeArrays(12,0,5);
+inline void DrawTreeVertexMid2(float3 pos, bool enlarge=true) {
+	if(enlarge)
+		va-&gt;EnlargeArrays(12,0,VA_SIZE_T);
 	float3 base=pos;
 	base.x+=MAX_TREE_HEIGHT_3;
 
@@ -313,6 +317,7 @@
 		if(!tss-&gt;farDisplist || dif.dot(tss-&gt;viewVector)&lt;0.97f){
 			va=GetVertexArray();
 			va-&gt;Initialize();
+			va-&gt;EnlargeArrays(4*tss-&gt;trees.size(),0,VA_SIZE_T); //!alloc room for all tree vertexes
 			tss-&gt;viewVector=dif;
 			if(!tss-&gt;farDisplist)
 				tss-&gt;farDisplist=glGenLists(1);
@@ -322,9 +327,9 @@
 			for(std::map&lt;int,CBasicTreeDrawer::TreeStruct&gt;::iterator ti=tss-&gt;trees.begin();ti!=tss-&gt;trees.end();++ti){
 				CBasicTreeDrawer::TreeStruct* ts=&amp;ti-&gt;second;
 				if(ts-&gt;type&lt;8){
-					DrawTreeVertexFar1(ts-&gt;pos, side*MAX_TREE_HEIGHT_3);
+					DrawTreeVertexFar1(ts-&gt;pos, side*MAX_TREE_HEIGHT_3, false);
 				} else {
-					DrawTreeVertexFar2(ts-&gt;pos, side*MAX_TREE_HEIGHT_3);
+					DrawTreeVertexFar2(ts-&gt;pos, side*MAX_TREE_HEIGHT_3, false);
 				}
 			}
 			glNewList(tss-&gt;farDisplist,GL_COMPILE);
@@ -349,14 +354,15 @@
 		if(!tss-&gt;displist){
 			va=GetVertexArray();
 			va-&gt;Initialize();
+			va-&gt;EnlargeArrays(12*tss-&gt;trees.size(),0,VA_SIZE_T); //!alloc room for all tree vertexes
 			tss-&gt;displist=glGenLists(1);
 
 			for(std::map&lt;int,CBasicTreeDrawer::TreeStruct&gt;::iterator ti=tss-&gt;trees.begin();ti!=tss-&gt;trees.end();++ti){
 				CBasicTreeDrawer::TreeStruct* ts=&amp;ti-&gt;second;
 				if(ts-&gt;type&lt;8)
-					DrawTreeVertexMid1(ts-&gt;pos);
+					DrawTreeVertexMid1(ts-&gt;pos, false);
 				else
-					DrawTreeVertexMid2(ts-&gt;pos);
+					DrawTreeVertexMid2(ts-&gt;pos, false);
 			}
 			glNewList(tss-&gt;displist,GL_COMPILE);
 			va-&gt;DrawArrayT(GL_QUADS);

Modified: trunk/rts/Rendering/Env/BumpWater.cpp
===================================================================
--- trunk/rts/Rendering/Env/BumpWater.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/BumpWater.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -189,8 +189,12 @@
 
 	CVertexArray *va = GetVertexArray();
 	va-&gt;Initialize();
+#if VA_INIT_VERTEXES &lt; 4*34*2*VA_SIZE_0
+#error &quot;Vertex array too small&quot;
+#endif
 
 	const float alphainc = fastmath::PI2 / 32;
+	const float alphaincpi2 = alphainc + fastmath::PI2;	
 	float alpha,r1,r2;
 	float3 p(0.0f,0.0f,0.0f);
 	const float size = std::min(xsize,ysize);
@@ -201,13 +205,13 @@
 		}else{
 			r2 = (n+1)*(n+1) * size;
 		}
-		for (alpha = 0.0f; (alpha - fastmath::PI2) &lt; alphainc ; alpha+=alphainc) {
+		for (alpha = 0.0f; alpha &lt; alphaincpi2 ; alpha+=alphainc) {
 			p.x = r1 * fastmath::sin(alpha) + 2 * xsize;
 			p.z = r1 * fastmath::cos(alpha) + 2 * ysize;
-			va-&gt;AddVertex0(p);
+			va-&gt;AddVertexQ0(p.x,p.y,p.z);
 			p.x = r2 * fastmath::sin(alpha) + 2 * xsize;
 			p.z = r2 * fastmath::cos(alpha) + 2 * ysize;
-			va-&gt;AddVertex0(p);
+			va-&gt;AddVertexQ0(p.x,p.y,p.z);
 		}
 	}
 

Modified: trunk/rts/Rendering/Env/DynWater.cpp
===================================================================
--- trunk/rts/Rendering/Env/DynWater.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/DynWater.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -1114,42 +1114,49 @@
 	CVertexArray* va2=GetVertexArray();		//never try to get more than 2 at once
 	va2-&gt;Initialize();
 
+	int nadd=uh-&gt;activeUnits.size()*4;
+	va-&gt;EnlargeArrays(nadd,0,VA_SIZE_TN);
+	va2-&gt;EnlargeArrays(nadd,0,VA_SIZE_TN);
+
 	for(std::list&lt;CUnit*&gt;::iterator ui=uh-&gt;activeUnits.begin(); ui!=uh-&gt;activeUnits.end();++ui){
 		CUnit* unit=*ui;
-		if(unit-&gt;moveType &amp;&amp; unit-&gt;floatOnWater &amp;&amp; unit-&gt;mobility &amp;&amp; !unit-&gt;unitDef-&gt;canhover){	//boat
-			float speedf=unit-&gt;speed.Length2D();
-			float3 pos=unit-&gt;pos;
-			if(fabs(pos.x-camPosBig.x)&gt;WH_SIZE-50 || fabs(pos.z-camPosBig.z)&gt;WH_SIZE-50)
-				continue;
-			if(!(unit-&gt;losStatus[gu-&gt;myAllyTeam] &amp; LOS_INLOS) &amp;&amp; !gu-&gt;spectatingFullView)
-				continue;
-			if(pos.y&gt;-4 &amp;&amp; pos.y&lt;1){
-				float3 frontAdd=unit-&gt;frontdir*unit-&gt;radius*0.75f;
-				float3 sideAdd=unit-&gt;rightdir*unit-&gt;radius*0.18f;
-				float depth=sqrt(sqrt(unit-&gt;mass));
-				float3 n(depth, 0.04f*speedf*depth, depth);
+		if(unit-&gt;moveType &amp;&amp; unit-&gt;mobility) {
+			if(unit-&gt;unitDef-&gt;canhover){	//hover
+				float3 pos=unit-&gt;pos;
+				if(fabs(pos.x-camPosBig.x)&gt;WH_SIZE-50 || fabs(pos.z-camPosBig.z)&gt;WH_SIZE-50)
+					continue;
+				if(!(unit-&gt;losStatus[gu-&gt;myAllyTeam] &amp; LOS_INLOS) &amp;&amp; !gu-&gt;spectatingFullView)
+					continue;
+				if(pos.y&gt;-4 &amp;&amp; pos.y&lt;4){
+					float3 frontAdd=unit-&gt;frontdir*unit-&gt;radius*0.75f;
+					float3 sideAdd=unit-&gt;rightdir*unit-&gt;radius*0.75f;
+					float depth=sqrt(sqrt(unit-&gt;mass))*0.4f;
+					float3 n(depth, 0.05f*depth, depth);
 
-				va-&gt;AddVertexTN(pos+frontAdd+sideAdd,0,0,n);
-				va-&gt;AddVertexTN(pos+frontAdd-sideAdd,1,0,n);
-				va-&gt;AddVertexTN(pos-frontAdd-sideAdd,1,1,n);
-				va-&gt;AddVertexTN(pos-frontAdd+sideAdd,0,1,n);
+					va2-&gt;AddVertexQTN(pos+frontAdd+sideAdd,0,0,n);
+					va2-&gt;AddVertexQTN(pos+frontAdd-sideAdd,1,0,n);
+					va2-&gt;AddVertexQTN(pos-frontAdd-sideAdd,1,1,n);
+					va2-&gt;AddVertexQTN(pos-frontAdd+sideAdd,0,1,n);
+				}
 			}
-		} else if(unit-&gt;moveType &amp;&amp; unit-&gt;unitDef-&gt;canhover &amp;&amp; unit-&gt;mobility){		//hover
-			float3 pos=unit-&gt;pos;
-			if(fabs(pos.x-camPosBig.x)&gt;WH_SIZE-50 || fabs(pos.z-camPosBig.z)&gt;WH_SIZE-50)
-				continue;
-			if(!(unit-&gt;losStatus[gu-&gt;myAllyTeam] &amp; LOS_INLOS) &amp;&amp; !gu-&gt;spectatingFullView)
-				continue;
-			if(pos.y&gt;-4 &amp;&amp; pos.y&lt;4){
-				float3 frontAdd=unit-&gt;frontdir*unit-&gt;radius*0.75f;
-				float3 sideAdd=unit-&gt;rightdir*unit-&gt;radius*0.75f;
-				float depth=sqrt(sqrt(unit-&gt;mass))*0.4f;
-				float3 n(depth, 0.05f*depth, depth);
+			else if(unit-&gt;floatOnWater){	//boat
+				float speedf=unit-&gt;speed.Length2D();
+				float3 pos=unit-&gt;pos;
+				if(fabs(pos.x-camPosBig.x)&gt;WH_SIZE-50 || fabs(pos.z-camPosBig.z)&gt;WH_SIZE-50)
+					continue;
+				if(!(unit-&gt;losStatus[gu-&gt;myAllyTeam] &amp; LOS_INLOS) &amp;&amp; !gu-&gt;spectatingFullView)
+					continue;
+				if(pos.y&gt;-4 &amp;&amp; pos.y&lt;1){
+					float3 frontAdd=unit-&gt;frontdir*unit-&gt;radius*0.75f;
+					float3 sideAdd=unit-&gt;rightdir*unit-&gt;radius*0.18f;
+					float depth=sqrt(sqrt(unit-&gt;mass));
+					float3 n(depth, 0.04f*speedf*depth, depth);
 
-				va2-&gt;AddVertexTN(pos+frontAdd+sideAdd,0,0,n);
-				va2-&gt;AddVertexTN(pos+frontAdd-sideAdd,1,0,n);
-				va2-&gt;AddVertexTN(pos-frontAdd-sideAdd,1,1,n);
-				va2-&gt;AddVertexTN(pos-frontAdd+sideAdd,0,1,n);
+					va-&gt;AddVertexQTN(pos+frontAdd+sideAdd,0,0,n);
+					va-&gt;AddVertexQTN(pos+frontAdd-sideAdd,1,0,n);
+					va-&gt;AddVertexQTN(pos-frontAdd-sideAdd,1,1,n);
+					va-&gt;AddVertexQTN(pos-frontAdd+sideAdd,0,1,n);
+				}
 			}
 		}
 	}
@@ -1211,6 +1218,9 @@
 	CVertexArray* va=GetVertexArray();
 	va-&gt;Initialize();
 
+	int nadd=explosions.size()*4;
+	va-&gt;EnlargeArrays(nadd,0,VA_SIZE_TN);
+
 	for(std::vector&lt;Explosion&gt;::iterator ei=explosions.begin(); ei!=explosions.end();++ei){
 		Explosion&amp; explo=*ei;
 		float3 pos=explo.pos;
@@ -1230,10 +1240,10 @@
 
 		float3 n(strength, strength*0.005f, strength*inv);
 
-		va-&gt;AddVertexTN(pos+float3(1,0,1)*size,0,0,n);
-		va-&gt;AddVertexTN(pos+float3(-1,0,1)*size,1,0,n);
-		va-&gt;AddVertexTN(pos+float3(-1,0,-1)*size,1,1,n);
-		va-&gt;AddVertexTN(pos+float3(1,0,-1)*size,0,1,n);
+		va-&gt;AddVertexQTN(pos+float3(1,0,1)*size,0,0,n);
+		va-&gt;AddVertexQTN(pos+float3(-1,0,1)*size,1,0,n);
+		va-&gt;AddVertexQTN(pos+float3(-1,0,-1)*size,1,1,n);
+		va-&gt;AddVertexQTN(pos+float3(1,0,-1)*size,0,1,n);
 	}
 	explosions.clear();
 
@@ -1293,11 +1303,14 @@
 
 	CVertexArray* va=GetVertexArray();
 	va-&gt;Initialize();
+#if VA_INIT_VERTEXES &lt; 4*VA_SIZE_T
+#error &quot;Vertex array too small&quot;
+#endif
 
-	va-&gt;AddVertexT(float3(startx,starty,0),texstart + startx*texdif,texstart + starty*texdif);
-	va-&gt;AddVertexT(float3(startx,endy,0),texstart + startx*texdif,texstart + endy*texdif  );
-	va-&gt;AddVertexT(float3(endx,endy,0),texstart + endx*texdif,texstart + endy*texdif  );
-	va-&gt;AddVertexT(float3(endx,starty,0),texstart + endx*texdif,texstart + starty*texdif);
+	va-&gt;AddVertexQT(float3(startx,starty,0),texstart + startx*texdif,texstart + starty*texdif);
+	va-&gt;AddVertexQT(float3(startx,endy,0),texstart + startx*texdif,texstart + endy*texdif  );
+	va-&gt;AddVertexQT(float3(endx,endy,0),texstart + endx*texdif,texstart + endy*texdif  );
+	va-&gt;AddVertexQT(float3(endx,starty,0),texstart + endx*texdif,texstart + starty*texdif);
 
 	va-&gt;DrawArrayT(GL_QUADS);
 }
@@ -1307,23 +1320,29 @@
 	CVertexArray* va=GetVertexArray();
 	va-&gt;Initialize();
 
-	float size=WF_SIZE;
-	float size2=WF_SIZE/16;
-	float posx=camPosBig2.x-WH_SIZE;
-	float posy=camPosBig2.z-WH_SIZE;
+	va-&gt;EnlargeArrays(3*3*16*16*4,0);
+	float posx=camPosBig2.x-WH_SIZE-WF_SIZE;
+	float posy=camPosBig2.z-WH_SIZE-WF_SIZE;
 
-	for(int y=-1;y&lt;=1;++y){
-		for(int x=-1;x&lt;=1;++x){
+	float ys=posy;
+	for(int y=-1;y&lt;=1;++y,ys+=WF_SIZE){
+		float xs=posx;
+		for(int x=-1;x&lt;=1;++x,xs+=WF_SIZE){
 			if(x==0 &amp;&amp; y==0)
 				continue;
-
+			float pys=ys;
 			for(int y2=0;y2&lt;16;++y2){
+				float pxs=xs;
+				float pys1=pys+WF_SIZE/16;
 				for(int x2=0;x2&lt;16;++x2){
-					va-&gt;AddVertex0(float3(posx+x*size+(x2+0)*size2,0,posy+y*size+(y2+0)*size2));
-					va-&gt;AddVertex0(float3(posx+x*size+(x2+1)*size2,0,posy+y*size+(y2+0)*size2));
-					va-&gt;AddVertex0(float3(posx+x*size+(x2+1)*size2,0,posy+y*size+(y2+1)*size2));
-					va-&gt;AddVertex0(float3(posx+x*size+(x2+0)*size2,0,posy+y*size+(y2+1)*size2));
+					float pxs1=pxs+WF_SIZE/16;
+					va-&gt;AddVertexQ0(pxs, 0,pys);
+					va-&gt;AddVertexQ0(pxs1,0,pys);
+					va-&gt;AddVertexQ0(pxs1,0,pys1);
+					va-&gt;AddVertexQ0(pxs, 0,pys1);
+					pxs=pxs1;
 				}
+				pys=pys1;
 			}
 		}
 	}

Modified: trunk/rts/Rendering/Env/GrassDrawer.cpp
===================================================================
--- trunk/rts/Rendering/Env/GrassDrawer.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/Env/GrassDrawer.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -258,6 +258,8 @@
 			grass-&gt;pos=float3((x+0.5f)*bMSsq,ground-&gt;GetHeight2((x+0.5f)*bMSsq,(y+0.5f)*bMSsq),(y+0.5f)*bMSsq);
 			va=grass-&gt;va;
 			va-&gt;Initialize();
+			int numGrass=gd-&gt;numTurfs;
+			va-&gt;EnlargeArrays(grassBlockSize*grassBlockSize*numGrass*4,0,VA_SIZE_TN);
 			int ygbsy=ygbs;
 			for(int y2=0; y2&lt;grassBlockSize; ++y2){
 				int xgbsx=xgbs;
@@ -267,7 +269,6 @@
 						srand(ygbsy*1025+xgbsx);
 						rand();
 						rand();
-						int numGrass=gd-&gt;numTurfs;
 						for(int a=0;a&lt;numGrass;a++){
 							float dx=(xgbsx+fRand(1))*gSSsq;
 							float dy=(ygbsy+fRand(1))*gSSsq;
@@ -275,10 +276,10 @@
 							float col=1;
 
 							pos.y-=ground-&gt;GetSlope(dx,dy)*10+0.03f;
-							va-&gt;AddVertexTN(pos,0,0,float3(-partTurfSize,-partTurfSize,col));
-							va-&gt;AddVertexTN(pos,1/16.0f,0,float3(partTurfSize,-partTurfSize,col));
-							va-&gt;AddVertexTN(pos,1/16.0f,1,float3(partTurfSize,partTurfSize,col));
-							va-&gt;AddVertexTN(pos,0,1,float3(-partTurfSize,partTurfSize,col));
+							va-&gt;AddVertexQTN(pos,0,0,float3(-partTurfSize,-partTurfSize,col));
+							va-&gt;AddVertexQTN(pos,1/16.0f,0,float3(partTurfSize,-partTurfSize,col));
+							va-&gt;AddVertexQTN(pos,1/16.0f,1,float3(partTurfSize,partTurfSize,col));
+							va-&gt;AddVertexQTN(pos,0,1,float3(-partTurfSize,partTurfSize,col));
 						}
 					}
 					++gm;
@@ -509,6 +510,7 @@
 			int numGrass=numTurfs;
 			va=GetVertexArray();
 			va-&gt;Initialize();
+			va-&gt;EnlargeArrays(numGrass*4,0,VA_SIZE_TN);
 			for(int a=0;a&lt;numGrass;a++){
 				float dx=(x+fRand(1))*gSSsq;
 				float dy=(y+fRand(1))*gSSsq;
@@ -516,10 +518,10 @@
 				pos.y-=ground-&gt;GetSlope(dx,dy)*10+0.03f;
 				float col=1;
 				if(camera-&gt;InView(pos,turfSize*0.7f)){
-					va-&gt;AddVertexTN(pos,0,0,float3(-partTurfSize,-partTurfSize,col));
-					va-&gt;AddVertexTN(pos,1/16.0f,0,float3(partTurfSize,-partTurfSize,col));
-					va-&gt;AddVertexTN(pos,1/16.0f,1,float3(partTurfSize,partTurfSize,col));
-					va-&gt;AddVertexTN(pos,0,1,float3(-partTurfSize,partTurfSize,col));
+					va-&gt;AddVertexQTN(pos,0,0,float3(-partTurfSize,-partTurfSize,col));
+					va-&gt;AddVertexQTN(pos,1/16.0f,0,float3(partTurfSize,-partTurfSize,col));
+					va-&gt;AddVertexQTN(pos,1/16.0f,1,float3(partTurfSize,partTurfSize,col));
+					va-&gt;AddVertexQTN(pos,0,1,float3(-partTurfSize,partTurfSize,col));
 				}
 			}
 			va-&gt;DrawArrayTN(GL_QUADS);

Modified: trunk/rts/Rendering/GL/VertexArray.cpp
===================================================================
--- trunk/rts/Rendering/GL/VertexArray.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/GL/VertexArray.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -13,11 +13,11 @@
 //////////////////////////////////////////////////////////////////////
 
 CVertexArray::CVertexArray() {
-	drawArray=SAFE_NEW float[1000];
-	stripArray=SAFE_NEW int[100];
+	drawArray=SAFE_NEW float[VA_INIT_VERTEXES]; // please don't change this, some files rely on specific initial sizes
+	stripArray=SAFE_NEW int[VA_INIT_STRIPS];
 	Initialize();
-	drawArraySize=drawArray+1000;
-	stripArraySize=stripArray+100;
+	drawArraySize=drawArray+VA_INIT_VERTEXES;
+	stripArraySize=stripArray+VA_INIT_STRIPS;
 }
 
 CVertexArray::~CVertexArray() {
@@ -41,14 +41,6 @@
 	*stripArrayPos++=((char *)drawArrayPos-(char *)drawArray);
 }
 
-void CVertexArray::EnlargeArrays(int vertexes, int strips, int stripsize) {
-	while((char *)drawArrayPos&gt;(char *)drawArraySize-stripsize*sizeof(float)*vertexes)
-		EnlargeDrawArray();
-
-	while((char *)stripArrayPos&gt;(char *)stripArraySize-sizeof(int)*strips)
-		EnlargeStripArray();
-}
-
 void CVertexArray::DrawArray0(int drawType,int stride) {
 	CheckEndStrip();
 	glEnableClientState(GL_VERTEX_ARRAY);

Modified: trunk/rts/Rendering/GL/VertexArray.h
===================================================================
--- trunk/rts/Rendering/GL/VertexArray.h	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/GL/VertexArray.h	2008-10-02 21:20:53 UTC (rev 6501)
@@ -5,6 +5,13 @@
 //
 //////////////////////////////////////////////////////////////////////
 
+#define VA_INIT_VERTEXES 1000 // please don't change this, some files rely on specific initial sizes
+#define VA_INIT_STRIPS 100
+#define VA_SIZE_0 3
+#define VA_SIZE_T 5
+#define VA_SIZE_TN 8
+#define VA_SIZE_TC 6
+
 class CVertexArray  
 {
 public:
@@ -29,6 +36,10 @@
 	inline void AddVertexQ0(float x, float y, float z);
 	//! same as AddVertexT, but without autmated CheckEnlargeDrawArray
 	inline void AddVertexQT(const float3&amp; pos,float tx,float ty);
+	//! same as AddVertexTN, but without autmated CheckEnlargeDrawArray
+	inline void AddVertexQTN(const float3 &amp;pos,float tx,float ty,const float3&amp; norm);
+	//! same as AddVertexTC, but without autmated CheckEnlargeDrawArray
+	inline void AddVertexQTC(const float3 &amp;pos,float tx,float ty,unsigned char* color);
 
 	//! same as EndStrip, but without autmated EnlargeStripArray
 	inline void EndStripQ();
@@ -36,7 +47,7 @@
 	bool IsReady();
 	inline int drawIndex();
 	void EndStrip();
-	void EnlargeArrays(int vertexes, int strips, int stripsize=3);
+	inline void EnlargeArrays(int vertexes, int strips, int stripsize=VA_SIZE_0);
 
 	float* drawArray;
 	float* drawArrayPos;
@@ -69,6 +80,14 @@
 		EnlargeDrawArray();
 }
 
+inline void CVertexArray::EnlargeArrays(int vertexes, int strips, int stripsize) {
+	while((char *)drawArrayPos&gt;(char *)drawArraySize-stripsize*sizeof(float)*vertexes)
+		EnlargeDrawArray();
+
+	while((char *)stripArrayPos&gt;(char *)stripArraySize-sizeof(int)*strips)
+		EnlargeStripArray();
+}
+
 inline void CVertexArray::AddVertexQ0(float x, float y, float z) {
 	*drawArrayPos++=x;
 	*drawArrayPos++=y;
@@ -83,6 +102,26 @@
 	*drawArrayPos++=ty;
 }
 
+inline void CVertexArray::AddVertexQTN(const float3&amp; pos,float tx,float ty,const float3&amp; norm) {
+	*drawArrayPos++=pos.x;
+	*drawArrayPos++=pos.y;
+	*drawArrayPos++=pos.z;
+	*drawArrayPos++=tx;
+	*drawArrayPos++=ty;
+	*drawArrayPos++=norm.x;
+	*drawArrayPos++=norm.y;
+	*drawArrayPos++=norm.z;
+}
+
+inline void CVertexArray::AddVertexQTC(const float3&amp; pos,float tx,float ty,unsigned char* col) {
+	*drawArrayPos++=pos.x;
+	*drawArrayPos++=pos.y;
+	*drawArrayPos++=pos.z;
+	*drawArrayPos++=tx;
+	*drawArrayPos++=ty;
+	*drawArrayPos++=*((float*)(col));
+}
+
 inline void CVertexArray::AddVertex0(const float3&amp; pos) {
 	if(drawArrayPos&gt;drawArraySize-10)
 		EnlargeDrawArray();

Modified: trunk/rts/Rendering/UnitModels/UnitDrawer.cpp
===================================================================
--- trunk/rts/Rendering/UnitModels/UnitDrawer.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/UnitModels/UnitDrawer.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -150,6 +150,10 @@
 		CreateSpecularFace(GL_TEXTURE_CUBE_MAP_POSITIVE_Z_ARB,specTexSize,float3(-1, 1, 1),float3( 2, 0, 0),float3(0,-2, 0),mapInfo-&gt;light.sunDir,100,specularSunColor);
 		CreateSpecularFace(GL_TEXTURE_CUBE_MAP_NEGATIVE_Z_ARB,specTexSize,float3( 1, 1,-1),float3(-2, 0, 0),float3(0,-2, 0),mapInfo-&gt;light.sunDir,100,specularSunColor);
 	}
+#ifdef USE_GML
+	multiThreadDrawUnit=configHandler.GetInt(&quot;MultiThreadDrawUnit&quot;, 1);
+	multiThreadDrawUnitShadow=configHandler.GetInt(&quot;MultiThreadDrawUnitShadow&quot;, 1);
+#endif
 }
 
 
@@ -188,6 +192,10 @@
 		delete *gbi;
 		gbi = ghostBuildingsS3O.erase(gbi);
 	}
+#ifdef USE_GML
+	configHandler.SetInt(&quot;MultiThreadDrawUnit&quot;, multiThreadDrawUnit);
+	configHandler.SetInt(&quot;MultiThreadDrawUnitShadow&quot;, multiThreadDrawUnitShadow);
+#endif
 }
 
 
@@ -398,25 +406,30 @@
 	CUnit* excludeUnit = drawReflection ? NULL : gu-&gt;directControl;
 #endif
 
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAWUNIT
-	mt_drawReflection=drawReflection; // these member vars will be accessed by DoDrawUnitMT
-	mt_drawRefraction=drawRefraction;
-  #ifdef DIRECT_CONTROL_ALLOWED
-	mt_excludeUnit=excludeUnit;
-  #endif
-	gmlProcessor.Work(NULL,NULL,&amp;CUnitDrawer::DoDrawUnitMT,this,gmlThreadCount,FALSE,&amp;uh-&gt;activeUnits,uh-&gt;activeUnits.size(),50,100,TRUE);
-#else
-	for (std::list&lt;CUnit*&gt;::iterator usi = uh-&gt;activeUnits.begin(); usi != uh-&gt;activeUnits.end(); ++usi) {
-		CUnit* unit = *usi;
-		DoDrawUnit(unit,drawReflection,drawRefraction,
-  #ifdef DIRECT_CONTROL_ALLOWED
-								excludeUnit
-  #else
-								NULL
-  #endif
-							);
+#ifdef USE_GML
+	if(multiThreadDrawUnit) {
+		mt_drawReflection=drawReflection; // these member vars will be accessed by DoDrawUnitMT
+		mt_drawRefraction=drawRefraction;
+	#ifdef DIRECT_CONTROL_ALLOWED
+		mt_excludeUnit=excludeUnit;
+	#endif
+		gmlProcessor.Work(NULL,NULL,&amp;CUnitDrawer::DoDrawUnitMT,this,gmlThreadCount,FALSE,&amp;uh-&gt;activeUnits,uh-&gt;activeUnits.size(),50,100,TRUE);
 	}
+	else {
 #endif
+		for (std::list&lt;CUnit*&gt;::iterator usi = uh-&gt;activeUnits.begin(); usi != uh-&gt;activeUnits.end(); ++usi) {
+			CUnit* unit = *usi;
+			DoDrawUnit(unit,drawReflection,drawRefraction,
+		#ifdef DIRECT_CONTROL_ALLOWED
+									excludeUnit
+		#else
+									NULL
+		#endif
+								);
+		}
+#ifdef USE_GML
+	}
+#endif
 
 	std::multimap&lt;int, TempDrawUnit&gt;::iterator ti;
 	for (ti = tempDrawUnits.begin(); ti != tempDrawUnits.end(); ++ti) {
@@ -435,6 +448,7 @@
 
 	va = GetVertexArray();
 	va-&gt;Initialize();
+	va-&gt;EnlargeArrays(drawFar.size()*4,0,VA_SIZE_TN);
 	glAlphaFunc(GL_GREATER, 0.8f);
 	glEnable(GL_ALPHA_TEST);
 	glBindTexture(GL_TEXTURE_2D, fartextureHandler-&gt;GetTextureID());
@@ -665,16 +679,21 @@
 
 	CUnit::SetLODFactor(LODScale * LODScaleShadow);
 
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAWUNITSHADOW
-	gmlProcessor.Work(NULL, NULL, &amp;CUnitDrawer::DoDrawUnitShadowMT, this, gmlThreadCount, FALSE,
-	  &amp;uh-&gt;activeUnits, uh-&gt;activeUnits.size(),50,100,TRUE);
-#else
-	std::list&lt;CUnit*&gt;::iterator usi;
-	for (usi = uh-&gt;activeUnits.begin(); usi != uh-&gt;activeUnits.end(); ++usi) {
-		CUnit* unit = *usi;
-		DoDrawUnitShadow(unit);
+#ifdef USE_GML
+	if(multiThreadDrawUnitShadow) {
+		gmlProcessor.Work(NULL, NULL, &amp;CUnitDrawer::DoDrawUnitShadowMT, this, gmlThreadCount, FALSE,
+		  &amp;uh-&gt;activeUnits, uh-&gt;activeUnits.size(),50,100,TRUE);
 	}
+	else {
 #endif
+		std::list&lt;CUnit*&gt;::iterator usi;
+		for (usi = uh-&gt;activeUnits.begin(); usi != uh-&gt;activeUnits.end(); ++usi) {
+			CUnit* unit = *usi;
+			DoDrawUnitShadow(unit);
+		}
+#ifdef USE_GML
+	}
+#endif
 
 	glDisable(GL_VERTEX_PROGRAM_ARB);
 
@@ -702,10 +721,12 @@
 	float ty = (unit-&gt;model-&gt;farTextureNum / 8) * r;
 	float offset = 0;
 
-	va-&gt;AddVertexTN(interPos - (camera-&gt;up * unit-&gt;radius * 1.4f - offset) + camera-&gt;right * unit-&gt;radius, tx,     ty,     camNorm);
-	va-&gt;AddVertexTN(interPos + (camera-&gt;up * unit-&gt;radius * 1.4f + offset) + camera-&gt;right * unit-&gt;radius, tx,     ty + r, camNorm);
-	va-&gt;AddVertexTN(interPos + (camera-&gt;up * unit-&gt;radius * 1.4f + offset) - camera-&gt;right * unit-&gt;radius, tx + r, ty + r, camNorm);
-	va-&gt;AddVertexTN(interPos - (camera-&gt;up * unit-&gt;radius * 1.4f - offset) - camera-&gt;right * unit-&gt;radius, tx + r, ty,     camNorm);
+	float3 curad=camera-&gt;up * unit-&gt;radius * 1.4f;
+	float3 crrad=camera-&gt;right * unit-&gt;radius;
+	va-&gt;AddVertexQTN(interPos - (curad - offset) + crrad, tx,     ty,     camNorm);
+	va-&gt;AddVertexQTN(interPos + (curad + offset) + crrad, tx,     ty + r, camNorm);
+	va-&gt;AddVertexQTN(interPos + (curad + offset) - crrad, tx + r, ty + r, camNorm);
+	va-&gt;AddVertexQTN(interPos - (curad - offset) - crrad, tx + r, ty,     camNorm);
 }
 
 

Modified: trunk/rts/Rendering/UnitModels/UnitDrawer.h
===================================================================
--- trunk/rts/Rendering/UnitModels/UnitDrawer.h	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Rendering/UnitModels/UnitDrawer.h	2008-10-02 21:20:53 UTC (rev 6501)
@@ -42,8 +42,10 @@
 	void SetupForGhostDrawing();
 	void SetupForGhostDrawingS3O();
 
+#ifdef USE_GML
+	int multiThreadDrawUnit;
+	int multiThreadDrawUnitShadow;
 
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAWUNIT
 	volatile bool mt_drawReflection;
 	volatile bool mt_drawRefraction;
   #ifdef DIRECT_CONTROL_ALLOWED
@@ -58,9 +60,7 @@
 		ud-&gt;DoDrawUnit(unit, ud-&gt;mt_drawReflection, ud-&gt;mt_drawRefraction, NULL);
 		#endif
 	}
-#endif
 
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_DRAWUNITSHADOW
 	static void DoDrawUnitShadowMT(void *c,CUnit *unit) {((CUnitDrawer *)c)-&gt;DoDrawUnitShadow(unit);}
 #endif
 

Modified: trunk/rts/Sim/Features/FeatureHandler.cpp
===================================================================
--- trunk/rts/Sim/Features/FeatureHandler.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Sim/Features/FeatureHandler.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -585,6 +585,7 @@
 	if (drawFar.size()&gt;0) {
 		CVertexArray* va = GetVertexArray();
 		va-&gt;Initialize();
+		va-&gt;EnlargeArrays(drawFar.size()*4,0,VA_SIZE_TN);
 		glAlphaFunc(GL_GREATER, 0.8f);
 		glEnable(GL_ALPHA_TEST);
 		glBindTexture(GL_TEXTURE_2D, fartextureHandler-&gt;GetTextureID());
@@ -707,10 +708,13 @@
 	float tx=(feature-&gt;model-&gt;farTextureNum%8)*(1.0f/8.0f)+snurr*(1.0f/64);
 	float ty=(feature-&gt;model-&gt;farTextureNum/8)*(1.0f/64.0f);
 	float offset=0;
-	va-&gt;AddVertexTN(interPos-(camera-&gt;up*feature-&gt;radius*1.4f-offset)+camera-&gt;right*feature-&gt;radius,tx,ty,unitDrawer-&gt;camNorm);
-	va-&gt;AddVertexTN(interPos+(camera-&gt;up*feature-&gt;radius*1.4f+offset)+camera-&gt;right*feature-&gt;radius,tx,ty+(1.0f/64.0f),unitDrawer-&gt;camNorm);
-	va-&gt;AddVertexTN(interPos+(camera-&gt;up*feature-&gt;radius*1.4f+offset)-camera-&gt;right*feature-&gt;radius,tx+(1.0f/64.0f),ty+(1.0f/64.0f),unitDrawer-&gt;camNorm);
-	va-&gt;AddVertexTN(interPos-(camera-&gt;up*feature-&gt;radius*1.4f-offset)-camera-&gt;right*feature-&gt;radius,tx+(1.0f/64.0f),ty,unitDrawer-&gt;camNorm);
+
+	float3 curad=camera-&gt;up*feature-&gt;radius*1.4f;
+	float3 crrad=camera-&gt;right*feature-&gt;radius;
+	va-&gt;AddVertexQTN(interPos-(curad-offset)+crrad,tx,ty,unitDrawer-&gt;camNorm);
+	va-&gt;AddVertexQTN(interPos+(curad+offset)+crrad,tx,ty+(1.0f/64.0f),unitDrawer-&gt;camNorm);
+	va-&gt;AddVertexQTN(interPos+(curad+offset)-crrad,tx+(1.0f/64.0f),ty+(1.0f/64.0f),unitDrawer-&gt;camNorm);
+	va-&gt;AddVertexQTN(interPos-(curad-offset)-crrad,tx+(1.0f/64.0f),ty,unitDrawer-&gt;camNorm);
 }
 
 

Modified: trunk/rts/Sim/Path/PathManager.h
===================================================================
--- trunk/rts/Sim/Path/PathManager.h	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/Sim/Path/PathManager.h	2008-10-02 21:20:53 UTC (rev 6501)
@@ -3,6 +3,8 @@
 
 #include &lt;map&gt;
 #include &quot;IPath.h&quot;
+#include &lt;boost/cstdint.hpp&gt; /* Replace with &lt;stdint.h&gt; if appropriate */
+using boost::uint32_t;
 
 class CSolidObject;
 class CPathFinder;

Modified: trunk/rts/System/Matrix44f.h
===================================================================
--- trunk/rts/System/Matrix44f.h	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/System/Matrix44f.h	2008-10-02 21:20:53 UTC (rev 6501)
@@ -39,4 +39,40 @@
 	void Translate(const float3&amp; pos);
 };
 
+
+// Templates for simple 2D/3D matrixes that behave
+// pretty much like statically allocated matrixes,
+// but can also be casted to and used as pointers.
+template&lt;class T&gt;
+T **newmat2(int x, int y) {
+	T *mat2=SAFE_NEW T[x*y], **mat=SAFE_NEW T *[x];
+	for(int i=0; i&lt;x; ++i)
+		mat[i]=mat2+i*y;
+	return mat;
+}
+
+template&lt;class T&gt;
+T ***newmat3(int x, int y, int z) {
+	T *mat3=SAFE_NEW T[x*y*z], **mat2=SAFE_NEW T *[x*y], ***mat=SAFE_NEW T **[x];
+	for(int i=0; i&lt;x; ++i) {
+		for(int j=0; j&lt;y; ++j)
+			mat2[i*y+j]=mat3+(i*y+j)*z;
+		mat[i]=mat2+i*y;
+	}
+	return mat;
+}
+
+template&lt;class T&gt;
+void delmat2(T** mat) {
+	delete [] *mat;
+	delete [] mat;
+}
+
+template&lt;class T&gt;
+void delmat3(T*** mat) {
+	delete [] **mat;
+	delete [] *mat;
+	delete [] mat;
+}
+
 #endif /* MATRIX44F_H */

Modified: trunk/rts/System/SpringApp.cpp
===================================================================
--- trunk/rts/System/SpringApp.cpp	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/System/SpringApp.cpp	2008-10-02 21:20:53 UTC (rev 6501)
@@ -53,6 +53,11 @@
 	#include &quot;Platform/Win/WinVersion.h&quot;
 #endif // WIN32
 
+#ifdef USE_GML
+#include &quot;lib/gml/gmlsrv.h&quot;
+extern gmlClientServer&lt;void, int,CUnit*&gt; gmlProcessor;
+#endif
+
 using std::string;
 
 CGameController* activeController = 0;
@@ -857,14 +862,23 @@
 
 	int ret = 1;
 	if (activeController) {
+#if defined(USE_GML) &amp;&amp; GML_MT_TEST
+		int frame=gu-&gt;drawFrame;
+#endif
 		if (!activeController-&gt;Update()) {
 			ret = 0;
 		} else {
-			gu-&gt;drawFrame++;
-			if (gu-&gt;drawFrame == 0) {
+#if defined(USE_GML) &amp;&amp; GML_MT_TEST
+			if(frame==gu-&gt;drawFrame) {
+#endif
 				gu-&gt;drawFrame++;
+				if (gu-&gt;drawFrame == 0) {
+					gu-&gt;drawFrame++;
+				}
+				ret = activeController-&gt;Draw();
+#if defined(USE_GML) &amp;&amp; GML_MT_TEST
 			}
-			ret = activeController-&gt;Draw();
+#endif
 		}
 	}
 

Modified: trunk/rts/build/vstudio8/rts.sln
===================================================================
--- trunk/rts/build/vstudio8/rts.sln	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/build/vstudio8/rts.sln	2008-10-02 21:20:53 UTC (rev 6501)
@@ -5,6 +5,7 @@
 Global
 	GlobalSection(SolutionConfigurationPlatforms) = preSolution
 		Debug|Win32 = Debug|Win32
+		Debug+MT|Win32 = Debug+MT|Win32
 		Final release|Win32 = Final release|Win32
 		No debug|Win32 = No debug|Win32
 		Release with error catching|Win32 = Release with error catching|Win32
@@ -14,6 +15,8 @@
 	GlobalSection(ProjectConfigurationPlatforms) = postSolution
 		{A0F70264-A7B7-4FE7-A5BE-298CD3A0758F}.Debug|Win32.ActiveCfg = Debug|Win32
 		{A0F70264-A7B7-4FE7-A5BE-298CD3A0758F}.Debug|Win32.Build.0 = Debug|Win32
+		{A0F70264-A7B7-4FE7-A5BE-298CD3A0758F}.Debug+MT|Win32.ActiveCfg = Debug+MT|Win32
+		{A0F70264-A7B7-4FE7-A5BE-298CD3A0758F}.Debug+MT|Win32.Build.0 = Debug+MT|Win32
 		{A0F70264-A7B7-4FE7-A5BE-298CD3A0758F}.Final release|Win32.ActiveCfg = No debug|Win32
 		{A0F70264-A7B7-4FE7-A5BE-298CD3A0758F}.Final release|Win32.Build.0 = No debug|Win32
 		{A0F70264-A7B7-4FE7-A5BE-298CD3A0758F}.No debug|Win32.ActiveCfg = No debug|Win32

Modified: trunk/rts/build/vstudio8/rts.vcproj
===================================================================
--- trunk/rts/build/vstudio8/rts.vcproj	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/build/vstudio8/rts.vcproj	2008-10-02 21:20:53 UTC (rev 6501)
@@ -486,6 +486,92 @@
 				Name=&quot;VCPostBuildEventTool&quot;
 			/&gt;
 		&lt;/Configuration&gt;
+		&lt;Configuration
+			Name=&quot;Debug+MT|Win32&quot;
+			OutputDirectory=&quot;$(ConfigurationName)&quot;
+			IntermediateDirectory=&quot;$(ConfigurationName)&quot;
+			ConfigurationType=&quot;1&quot;
+			InheritedPropertySheets=&quot;$(VCInstallDir)VCProjectDefaults\UpgradeFromVC71.vsprops&quot;
+			CharacterSet=&quot;2&quot;
+			&gt;
+			&lt;Tool
+				Name=&quot;VCPreBuildEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCustomBuildTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXMLDataGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebServiceProxyGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCMIDLTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCLCompilerTool&quot;
+				AdditionalOptions=&quot;/vmg&quot;
+				Optimization=&quot;0&quot;
+				AdditionalIncludeDirectories=&quot;../../;../../System;../../lib/streflop;../../lib/crashrpt/include;&quot;../../../vclibs/freetype-2.1.10/include&quot;;../../../vclibs/DevIL/include;../../../vclibs/boost/Include;../../../vclibs/OpenAL/include;../../../vclibs/glew/include;../../../vclibs/zlibwapi/include;&quot;../../../vclibs/SDL-1.2.9/include&quot;;&quot;../../../vclibs/libjpeg/libjpeg-include&quot;;../../lib/lua/include;../../lib/luabind;../../../vclibs/ogg_vorbis/include&quot;
+				PreprocessorDefinitions=&quot;_CMATH_;NO_CATCH_EXCEPTIONS;_WIN32;WIN32;_DEBUG;_WINDOWS;ZLIB_WINAPI;_SZ_ONE_DIRECTORY;DIRECT_CONTROL_ALLOWED;BUILDING_SPRING;STREFLOP_X87;USE_GML&quot;
+				MinimalRebuild=&quot;true&quot;
+				BasicRuntimeChecks=&quot;3&quot;
+				RuntimeLibrary=&quot;3&quot;
+				RuntimeTypeInfo=&quot;true&quot;
+				UsePrecompiledHeader=&quot;2&quot;
+				WarningLevel=&quot;3&quot;
+				Detect64BitPortabilityProblems=&quot;true&quot;
+				DebugInformationFormat=&quot;3&quot;
+				DisableSpecificWarnings=&quot;4018;4244;4267;4288;4305;4996&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManagedResourceCompilerTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCResourceCompilerTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPreLinkEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCLinkerTool&quot;
+				AdditionalDependencies=&quot;dsound.lib freetype2110.lib zlibwapi.lib glew32s.lib opengl32.lib glu32.lib ogg.lib vorbis.lib vorbisfile.lib SDL.lib DevIL.lib winmm.lib wsock32.lib ilu.lib imagehlp.lib advapi32.lib ole32.lib&quot;
+				OutputFile=&quot;../../../game/spring.exe&quot;
+				LinkIncremental=&quot;2&quot;
+				AdditionalLibraryDirectories=&quot;../../../vclibs/DevIL/lib;&quot;../../../vclibs/freetype-2.1.10/objs&quot;;../../../vclibs/OpenAL/libs;../../../vclibs/glew/lib;../../../vclibs/zlibwapi/lib;&quot;../../../vclibs/SDL-1.2.9/lib&quot;;../../../vclibs/boost/lib;../../../vclibs/libjpeg;../../../vclibs/ogg_vorbis/lib&quot;
+				IgnoreDefaultLibraryNames=&quot;libc.lib;msvcrt.lib&quot;
+				GenerateDebugInformation=&quot;true&quot;
+				ProgramDatabaseFile=&quot;$(OutDir)/spring.pdb&quot;
+				SubSystem=&quot;2&quot;
+				StackReserveSize=&quot;0&quot;
+				TargetMachine=&quot;1&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCALinkTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManifestTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXDCMakeTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCBscMakeTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCFxCopTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCAppVerifierTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebDeploymentTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPostBuildEventTool&quot;
+			/&gt;
+		&lt;/Configuration&gt;
 	&lt;/Configurations&gt;
 	&lt;References&gt;
 	&lt;/References&gt;
@@ -855,6 +941,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\UI\GameSetupDrawer.h&quot;
@@ -999,6 +1093,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\UI\ProfileDrawer.h&quot;
@@ -1131,6 +1233,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\StartScripts\GlobalAITestScript.h&quot;
@@ -1223,6 +1333,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\Camera\CameraController.h&quot;
@@ -1271,6 +1389,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\Camera\FPSController.h&quot;
@@ -1319,6 +1445,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\Camera\FreeController.h&quot;
@@ -1367,6 +1501,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\Camera\LuaCameraCtrl.h&quot;
@@ -1415,6 +1557,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\Camera\OverheadController.h&quot;
@@ -1463,6 +1613,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\Camera\OverviewController.h&quot;
@@ -1511,6 +1669,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\Camera\RotOverheadController.h&quot;
@@ -1559,6 +1725,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\Camera\SmoothController.h&quot;
@@ -1607,6 +1781,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Game\Camera\TWController.h&quot;
@@ -1923,6 +2105,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Rendering\Gl\FBO.h&quot;
@@ -2051,6 +2241,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Rendering\Textures\nv_dds.h&quot;
@@ -2991,6 +3189,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Sim\Misc\CollisionHandler.h&quot;
@@ -3067,6 +3273,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\Sim\Misc\GroundBlockingObjectMap.h&quot;
@@ -3192,6 +3406,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\System\AutohostInterface.h&quot;
@@ -3240,6 +3462,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\System\BaseNetProtocol.h&quot;
@@ -3260,6 +3490,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\System\Demo.h&quot;
@@ -3312,6 +3550,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\System\DemoReader.h&quot;
@@ -3360,6 +3606,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\System\DemoRecorder.h&quot;
@@ -3484,6 +3738,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\System\NetProtocol.h&quot;
@@ -3540,6 +3802,14 @@
 						UsePrecompiledHeader=&quot;1&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;1&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\System\StdAfx.h&quot;
@@ -3600,6 +3870,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\System\TimeProfiler.h&quot;
@@ -3648,6 +3926,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\System\UnsyncedRNG.h&quot;
@@ -3707,6 +3993,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\FileSystem\ArchiveBase.h&quot;
@@ -3787,6 +4081,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\FileSystem\ArchiveScanner.h&quot;
@@ -3843,6 +4145,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\FileSystem\CRC.h&quot;
@@ -3891,6 +4201,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\FileSystem\FileFilter.h&quot;
@@ -3952,6 +4270,15 @@
 							XMLDocumentationFileName=&quot;$(IntDir)\$(InputName)1.xdc&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							ObjectFile=&quot;$(IntDir)\$(InputName)1.obj&quot;
+							XMLDocumentationFileName=&quot;$(IntDir)\$(InputName)1.xdc&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\FileSystem\SimpleParser.h&quot;
@@ -4014,6 +4341,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\hpiutil2\hpientry.h&quot;
@@ -4062,6 +4397,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\hpiutil2\hpifile.h&quot;
@@ -4110,6 +4453,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\hpiutil2\hpiutil.h&quot;
@@ -4158,6 +4509,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\hpiutil2\scrambledfile.h&quot;
@@ -4206,6 +4565,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\hpiutil2\sqshstream.h&quot;
@@ -4254,6 +4621,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\hpiutil2\substream.h&quot;
@@ -4306,6 +4681,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\7zAlloc.h&quot;
@@ -4354,6 +4737,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\7zBuffer.h&quot;
@@ -4402,6 +4793,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\7zCrc.h&quot;
@@ -4454,6 +4853,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\7zDecode.h&quot;
@@ -4502,6 +4909,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\7zExtract.h&quot;
@@ -4550,6 +4965,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\7zHeader.h&quot;
@@ -4598,6 +5021,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\7zIn.h&quot;
@@ -4646,6 +5077,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\7zItem.h&quot;
@@ -4694,6 +5133,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\7zMethodID.h&quot;
@@ -4746,6 +5193,14 @@
 									UsePrecompiledHeader=&quot;0&quot;
 								/&gt;
 							&lt;/FileConfiguration&gt;
+							&lt;FileConfiguration
+								Name=&quot;Debug+MT|Win32&quot;
+								&gt;
+								&lt;Tool
+									Name=&quot;VCCLCompilerTool&quot;
+									UsePrecompiledHeader=&quot;0&quot;
+								/&gt;
+							&lt;/FileConfiguration&gt;
 						&lt;/File&gt;
 						&lt;File
 							RelativePath=&quot;..\..\lib\7zip\LzmaDecode.h&quot;
@@ -4923,6 +5378,14 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\System\Platform\Win\OggStream.h&quot;
@@ -5084,6 +5547,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\float3.h&quot;
@@ -5132,6 +5603,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Matrix44f.h&quot;
@@ -5401,6 +5880,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Sync\bget.cpp&quot;
@@ -5453,6 +5940,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Sync\Logger.cpp&quot;
@@ -5571,6 +6066,16 @@
 							XMLDocumentationFileName=&quot;$(IntDir)\$(InputName)1.xdc&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+							ObjectFile=&quot;$(IntDir)\$(InputName)1.obj&quot;
+							XMLDocumentationFileName=&quot;$(IntDir)\$(InputName)1.xdc&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\Connection.h&quot;
@@ -5633,6 +6138,16 @@
 							XMLDocumentationFileName=&quot;$(IntDir)\$(InputName)1.xdc&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+							ObjectFile=&quot;$(IntDir)\$(InputName)1.obj&quot;
+							XMLDocumentationFileName=&quot;$(IntDir)\$(InputName)1.xdc&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\LocalConnection.h&quot;
@@ -5681,6 +6196,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\PackPacket.h&quot;
@@ -5729,6 +6252,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\ProtocolDef.h&quot;
@@ -5777,6 +6308,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\RawPacket.h&quot;
@@ -5825,6 +6364,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\Socket.h&quot;
@@ -5873,6 +6420,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\UDPConnectedSocket.h&quot;
@@ -5921,6 +6476,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\UDPConnection.h&quot;
@@ -5969,6 +6532,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\UDPListener.h&quot;
@@ -6017,6 +6588,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\UDPSocket.h&quot;
@@ -6033,6 +6612,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\System\Net\UnpackPacket.h&quot;
@@ -6110,6 +6697,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\Map\HeightLinePalette.h&quot;
@@ -6174,6 +6769,14 @@
 						UsePrecompiledHeader=&quot;0&quot;
 					/&gt;
 				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug+MT|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						UsePrecompiledHeader=&quot;0&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
 			&lt;/File&gt;
 			&lt;File
 				RelativePath=&quot;..\..\Map\MapInfo.h&quot;
@@ -6749,6 +7352,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\streflop\Random.h&quot;
@@ -6802,6 +7413,15 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\streflop\SMath.h&quot;
@@ -6875,6 +7495,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_acoshf.cpp&quot;
@@ -6929,6 +7559,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_asinf.cpp&quot;
@@ -6983,6 +7623,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_atan2f.cpp&quot;
@@ -7037,6 +7687,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_atanhf.cpp&quot;
@@ -7091,6 +7751,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_coshf.cpp&quot;
@@ -7145,6 +7815,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_exp2f.cpp&quot;
@@ -7199,6 +7879,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_expf.cpp&quot;
@@ -7253,6 +7943,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_fmodf.cpp&quot;
@@ -7307,6 +8007,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_gammaf_r.cpp&quot;
@@ -7361,6 +8071,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_hypotf.cpp&quot;
@@ -7415,6 +8135,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_lgammaf_r.cpp&quot;
@@ -7469,6 +8199,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_log10f.cpp&quot;
@@ -7523,6 +8263,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_log2f.cpp&quot;
@@ -7577,6 +8327,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_logf.cpp&quot;
@@ -7631,6 +8391,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_powf.cpp&quot;
@@ -7685,6 +8455,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_rem_pio2f.cpp&quot;
@@ -7739,6 +8519,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_remainderf.cpp&quot;
@@ -7793,6 +8583,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_sinhf.cpp&quot;
@@ -7847,6 +8647,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\e_sqrtf.cpp&quot;
@@ -7901,6 +8711,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\k_cosf.cpp&quot;
@@ -7955,6 +8775,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\k_rem_pio2f.cpp&quot;
@@ -8009,6 +8839,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\k_sinf.cpp&quot;
@@ -8063,6 +8903,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\k_tanf.cpp&quot;
@@ -8117,6 +8967,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_asinhf.cpp&quot;
@@ -8171,6 +9031,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_atanf.cpp&quot;
@@ -8225,6 +9095,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_cbrtf.cpp&quot;
@@ -8279,6 +9159,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_ceilf.cpp&quot;
@@ -8333,6 +9223,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_copysignf.cpp&quot;
@@ -8387,6 +9287,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_cosf.cpp&quot;
@@ -8441,6 +9351,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_erff.cpp&quot;
@@ -8495,6 +9415,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_expm1f.cpp&quot;
@@ -8549,6 +9479,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_fabsf.cpp&quot;
@@ -8603,6 +9543,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_finitef.cpp&quot;
@@ -8657,6 +9607,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_floorf.cpp&quot;
@@ -8711,6 +9671,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_fpclassifyf.cpp&quot;
@@ -8765,6 +9735,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_frexpf.cpp&quot;
@@ -8819,6 +9799,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_ilogbf.cpp&quot;
@@ -8873,6 +9863,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_isinff.cpp&quot;
@@ -8927,6 +9927,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_isnanf.cpp&quot;
@@ -8981,6 +9991,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_ldexpf.cpp&quot;
@@ -9035,6 +10055,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_llrintf.cpp&quot;
@@ -9089,6 +10119,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_llroundf.cpp&quot;
@@ -9143,6 +10183,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_log1pf.cpp&quot;
@@ -9197,6 +10247,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_logbf.cpp&quot;
@@ -9251,6 +10311,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_lrintf.cpp&quot;
@@ -9305,6 +10375,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_lroundf.cpp&quot;
@@ -9359,6 +10439,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_modff.cpp&quot;
@@ -9413,6 +10503,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_nearbyintf.cpp&quot;
@@ -9467,6 +10567,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_nextafterf.cpp&quot;
@@ -9521,6 +10631,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_remquof.cpp&quot;
@@ -9575,6 +10695,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_rintf.cpp&quot;
@@ -9629,6 +10759,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_roundf.cpp&quot;
@@ -9683,6 +10823,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_scalblnf.cpp&quot;
@@ -9737,6 +10887,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_scalbnf.cpp&quot;
@@ -9791,6 +10951,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_signbitf.cpp&quot;
@@ -9845,6 +11015,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_sincosf.cpp&quot;
@@ -9899,6 +11079,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_sinf.cpp&quot;
@@ -9953,6 +11143,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_tanf.cpp&quot;
@@ -10007,6 +11207,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_tanhf.cpp&quot;
@@ -10061,6 +11271,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\s_truncf.cpp&quot;
@@ -10115,6 +11335,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 					&lt;File
 						RelativePath=&quot;..\..\lib\streflop\libm\flt-32\t_exp2f.h&quot;
@@ -10173,6 +11403,16 @@
 								UsePrecompiledHeader=&quot;0&quot;
 							/&gt;
 						&lt;/FileConfiguration&gt;
+						&lt;FileConfiguration
+							Name=&quot;Debug+MT|Win32&quot;
+							&gt;
+							&lt;Tool
+								Name=&quot;VCCLCompilerTool&quot;
+								AdditionalIncludeDirectories=&quot;../../lib/streflop/libm/headers&quot;
+								PreprocessorDefinitions=&quot;LIBM_COMPILING_FLT32&quot;
+								UsePrecompiledHeader=&quot;0&quot;
+							/&gt;
+						&lt;/FileConfiguration&gt;
 					&lt;/File&gt;
 				&lt;/Filter&gt;
 				&lt;Filter
@@ -10250,6 +11490,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\class_info.cpp&quot;
@@ -10294,6 +11542,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\class_registry.cpp&quot;
@@ -10338,6 +11594,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\class_rep.cpp&quot;
@@ -10382,6 +11646,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\create_class.cpp&quot;
@@ -10426,6 +11698,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\error.cpp&quot;
@@ -10470,6 +11750,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\find_best_match.cpp&quot;
@@ -10514,6 +11802,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\function.cpp&quot;
@@ -10558,6 +11854,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\implicit_cast.cpp&quot;
@@ -10602,6 +11906,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\link_compatibility.cpp&quot;
@@ -10646,6 +11958,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\object_rep.cpp&quot;
@@ -10690,6 +12010,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\open.cpp&quot;
@@ -10734,6 +12062,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\overload_rep.cpp&quot;
@@ -10778,6 +12114,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\pcall.cpp&quot;
@@ -10822,6 +12166,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\ref.cpp&quot;
@@ -10866,6 +12218,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\scope.cpp&quot;
@@ -10910,6 +12270,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\stack_content_by_name.cpp&quot;
@@ -10954,6 +12322,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\weak_ref.cpp&quot;
@@ -10998,6 +12374,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\luabind\src\wrapper_base.cpp&quot;
@@ -11042,6 +12426,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;Filter
 					Name=&quot;headers&quot;
@@ -11214,6 +12606,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lapi.h&quot;
@@ -11262,6 +12662,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\include\lauxlib.h&quot;
@@ -11310,6 +12718,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lcode.cpp&quot;
@@ -11354,6 +12770,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lcode.h&quot;
@@ -11402,6 +12826,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\ldebug.cpp&quot;
@@ -11446,6 +12878,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\ldebug.h&quot;
@@ -11494,6 +12934,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\ldo.h&quot;
@@ -11542,6 +12990,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lfunc.cpp&quot;
@@ -11586,6 +13042,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lfunc.h&quot;
@@ -11634,6 +13098,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lgc.h&quot;
@@ -11682,6 +13154,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\liolib.cpp&quot;
@@ -11726,6 +13206,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\llex.cpp&quot;
@@ -11770,6 +13258,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\llex.h&quot;
@@ -11822,6 +13318,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lmem.cpp&quot;
@@ -11866,6 +13370,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lmem.h&quot;
@@ -11914,6 +13426,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lobject.cpp&quot;
@@ -11958,6 +13478,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lobject.h&quot;
@@ -12006,6 +13534,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lopcodes.h&quot;
@@ -12054,6 +13590,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lparser.cpp&quot;
@@ -12098,6 +13642,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lparser.h&quot;
@@ -12146,6 +13698,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lstate.h&quot;
@@ -12194,6 +13754,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lstring.h&quot;
@@ -12242,6 +13810,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\ltable.cpp&quot;
@@ -12286,6 +13862,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\ltable.h&quot;
@@ -12334,6 +13918,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\ltm.cpp&quot;
@@ -12378,6 +13970,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\ltm.h&quot;
@@ -12442,6 +14042,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lundump.h&quot;
@@ -12490,6 +14098,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lvm.h&quot;
@@ -12538,6 +14154,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 				&lt;File
 					RelativePath=&quot;..\..\lib\lua\src\lzio.h&quot;
@@ -12586,6 +14210,14 @@
 							UsePrecompiledHeader=&quot;0&quot;
 						/&gt;
 					&lt;/FileConfiguration&gt;
+					&lt;FileConfiguration
+						Name=&quot;Debug+MT|Win32&quot;
+						&gt;
+						&lt;Tool
+							Name=&quot;VCCLCompilerTool&quot;
+							UsePrecompiledHeader=&quot;0&quot;
+						/&gt;
+					&lt;/FileConfiguration&gt;
 				&lt;/File&gt;
 			&lt;/Filter&gt;
 			&lt;Filter
@@ -12668,6 +14300,14 @@
 					AdditionalIncludeDirectories=&quot;../../&quot;
 				/&gt;
 			&lt;/FileConfiguration&gt;
+			&lt;FileConfiguration
+				Name=&quot;Debug+MT|Win32&quot;
+				&gt;
+				&lt;Tool
+					Name=&quot;VCResourceCompilerTool&quot;
+					AdditionalIncludeDirectories=&quot;../../&quot;
+				/&gt;
+			&lt;/FileConfiguration&gt;
 		&lt;/File&gt;
 	&lt;/Files&gt;
 	&lt;Globals&gt;

Modified: trunk/rts/lib/gml/gmlcls.h
===================================================================
--- trunk/rts/lib/gml/gmlcls.h	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/lib/gml/gmlcls.h	2008-10-02 21:20:53 UTC (rev 6501)
@@ -34,11 +34,7 @@
 #endif
 
 #define GML_ENABLE_SIM (GML_ENABLE &amp;&amp; 1) // runs the sim in a separate thread
-#define GML_ENABLE_DRAWALL (GML_ENABLE &amp;&amp; 0) // draws everything in a separate thread (for testing only, will degrade performance)
-#define GML_ENABLE_DRAWUNIT (GML_ENABLE &amp;&amp; 1) // draws units using multithreading
-#define GML_ENABLE_DRAWUNITSHADOW (GML_ENABLE &amp;&amp; 1) // draws unit shadows using multithreading
-#define GML_ENABLE_DRAWGROUND (GML_ENABLE &amp;&amp; 1) // draws ground using multithreading
-#define GML_ENABLE_DRAWGROUNDSHADOW (GML_ENABLE &amp;&amp; 1) // draws ground shadows using multithreading
+#define GML_ENABLE_DRAW (GML_ENABLE &amp;&amp; 0) // draws everything in a separate thread (for testing only, will degrade performance)
 #define GML_SERVER_GLCALL 1 // allow the server thread (0) to make direct GL calls
 #define GML_INIT_QUEUE_SIZE 10 // initial queue size, will be reallocated, but must be &gt;= 1
 #define GML_USE_NO_ERROR 1 // glGetError always returns success (to improve performance)

Modified: trunk/rts/lib/gml/gmlsrv.h
===================================================================
--- trunk/rts/lib/gml/gmlsrv.h	2008-10-02 19:48:59 UTC (rev 6500)
+++ trunk/rts/lib/gml/gmlsrv.h	2008-10-02 21:20:53 UTC (rev 6501)
@@ -10,6 +10,7 @@
 #define GMLSRV_H
 
 #ifdef USE_GML
+#define GML_MT_TEST 0
 
 #include &lt;boost/thread/barrier.hpp&gt;
 #include &lt;boost/bind.hpp&gt;
@@ -303,6 +304,57 @@
 			gmlClientSub();
 		}
 	}
+
+	void GetQueue() {
+		int thread=gmlThreadNumber;
+		int processed=1;
+
+		GML_TYPENAME gmlExecState&lt;R,A,U&gt; *ex=ExecState+ExecDepth;
+
+		gmlQueue *qd=&amp;gmlQueues[thread];
+
+		BOOL_ isq1=qd-&gt;Write==qd-&gt;Queue1;
+
+#if GML_ALTERNATE_SYNCMODE
+		if(qd-&gt;WasSynced &amp;&amp; qd-&gt;GetWrite(ex-&gt;syncmode?TRUE:2))
+#else
+		if(qd-&gt;WasSynced &amp;&amp; qd-&gt;GetWrite(TRUE))
+#endif
+			processed=0;
+		if(processed &amp;&amp; qd-&gt;GetWrite(TRUE))
+			processed=0;
+
+		if(isq1) {
+			while(qd-&gt;Locked1)
+				boost::thread::yield();
+		}
+		else {
+			while(qd-&gt;Locked2)
+				boost::thread::yield();
+		}
+	}
+
+	void Pump(int thread) {
+		int updsrv=0;
+		gmlUpdateServers();
+		BOOL_ processed=FALSE;
+
+//		for(int i=1; i&lt;gmlThreadCount; ++i) {
+			gmlQueue *qd=&amp;gmlQueues[thread];
+			if(qd-&gt;Reloc)
+				qd-&gt;Realloc();
+			if(qd-&gt;GetRead()) {
+				qd-&gt;Execute();
+				qd-&gt;ReleaseRead();
+				processed=TRUE;
+			}
+			if(qd-&gt;Sync) {
+				qd-&gt;ExecuteSynced();
+				processed=TRUE;
+			}
+//		}
+	}
+
 };
 
 #endif // USE_GML


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001270.html">[Taspring-linux-commit] r6500 - trunk/rts/System
</A></li>
	<LI>Next message: <A HREF="001272.html">[Taspring-linux-commit] r6502 - trunk/tools/SpringInstaller
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1271">[ date ]</a>
              <a href="thread.html#1271">[ thread ]</a>
              <a href="subject.html#1271">[ subject ]</a>
              <a href="author.html#1271">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
