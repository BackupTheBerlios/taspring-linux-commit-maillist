<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6823 - in trunk/rts: ExternalAI Game	Game/Camera Game/StartScripts Game/UI Map Map/SM3	Map/SM3/terrain Map/SMF Rendering Rendering/Env	Rendering/UnitModels Sim/Misc Sim/Projectiles	Sim/Projectiles/Unsynced Sim/Units
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6823%20-%20in%20trunk/rts%3A%20ExternalAI%20Game%0A%09Game/Camera%20Game/StartScripts%20Game/UI%20Map%20Map/SM3%0A%09Map/SM3/terrain%20Map/SMF%20Rendering%20Rendering/Env%0A%09Rendering/UnitModels%20Sim/Misc%20Sim/Projectiles%0A%09Sim/Projectiles/Unsynced%20Sim/Units&In-Reply-To=%3C20081019132842.18188473F%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001591.html">
   <LINK REL="Next"  HREF="001593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6823 - in trunk/rts: ExternalAI Game	Game/Camera Game/StartScripts Game/UI Map Map/SM3	Map/SM3/terrain Map/SMF Rendering Rendering/Env	Rendering/UnitModels Sim/Misc Sim/Projectiles	Sim/Projectiles/Unsynced Sim/Units</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6823%20-%20in%20trunk/rts%3A%20ExternalAI%20Game%0A%09Game/Camera%20Game/StartScripts%20Game/UI%20Map%20Map/SM3%0A%09Map/SM3/terrain%20Map/SMF%20Rendering%20Rendering/Env%0A%09Rendering/UnitModels%20Sim/Misc%20Sim/Projectiles%0A%09Sim/Projectiles/Unsynced%20Sim/Units&In-Reply-To=%3C20081019132842.18188473F%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6823 - in trunk/rts: ExternalAI Game	Game/Camera Game/StartScripts Game/UI Map Map/SM3	Map/SM3/terrain Map/SMF Rendering Rendering/Env	Rendering/UnitModels Sim/Misc Sim/Projectiles	Sim/Projectiles/Unsynced Sim/Units">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sun Oct 19 15:28:42 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001591.html">[Taspring-linux-commit] r6822 - in branches/caiinterface:	AI/Interfaces AI/Interfaces/Java AI/Skirmish	AI/Skirmish/NullAI rts/ExternalAI rts/ExternalAI/Interface	rts/System
</A></li>
        <LI>Next message: <A HREF="001593.html">[Taspring-linux-commit] r6824 - in trunk: Documentation installer	installer/builddata/springcontent rts/Game tools/unitsync	tools/unitsync/test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1592">[ date ]</a>
              <a href="thread.html#1592">[ thread ]</a>
              <a href="subject.html#1592">[ subject ]</a>
              <a href="author.html#1592">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: imbaczek
Date: 2008-10-19 15:28:40 +0200 (Sun, 19 Oct 2008)
New Revision: 6823

Modified:
   trunk/rts/ExternalAI/GlobalAIHandler.cpp
   trunk/rts/Game/Camera.cpp
   trunk/rts/Game/Camera/FPSController.cpp
   trunk/rts/Game/Camera/FreeController.cpp
   trunk/rts/Game/Camera/OrbitController.cpp
   trunk/rts/Game/Camera/OverheadController.cpp
   trunk/rts/Game/Camera/OverviewController.cpp
   trunk/rts/Game/Camera/RotOverheadController.cpp
   trunk/rts/Game/Camera/SmoothController.cpp
   trunk/rts/Game/Camera/TWController.cpp
   trunk/rts/Game/CameraHandler.cpp
   trunk/rts/Game/Game.cpp
   trunk/rts/Game/SelectedUnitsAI.cpp
   trunk/rts/Game/StartScripts/AirScript.cpp
   trunk/rts/Game/UI/GuiHandler.cpp
   trunk/rts/Game/UI/MouseHandler.cpp
   trunk/rts/Game/UI/SelectionKeyHandler.cpp
   trunk/rts/Map/MapInfo.cpp
   trunk/rts/Map/SM3/Frustum.cpp
   trunk/rts/Map/SM3/Sm3GroundDrawer.cpp
   trunk/rts/Map/SM3/terrain/Lightcalc.cpp
   trunk/rts/Map/SM3/terrain/QuadRenderData.cpp
   trunk/rts/Map/SM3/terrain/Terrain.cpp
   trunk/rts/Map/SM3/terrain/TerrainTexture.cpp
   trunk/rts/Map/SM3/terrain/TerrainUtil.cpp
   trunk/rts/Map/SM3/terrain/Textures.cpp
   trunk/rts/Map/SMF/BFGroundDrawer.cpp
   trunk/rts/Map/SMF/SmfReadMap.cpp
   trunk/rts/Rendering/Env/AdvSky.cpp
   trunk/rts/Rendering/Env/AdvTreeDrawer.cpp
   trunk/rts/Rendering/Env/AdvTreeGenerator.cpp
   trunk/rts/Rendering/Env/AdvWater.cpp
   trunk/rts/Rendering/Env/BasicSky.cpp
   trunk/rts/Rendering/Env/DynWater.cpp
   trunk/rts/Rendering/Env/GrassDrawer.cpp
   trunk/rts/Rendering/GroundFlash.cpp
   trunk/rts/Rendering/InMapDraw.cpp
   trunk/rts/Rendering/ShadowHandler.cpp
   trunk/rts/Rendering/UnitModels/UnitDrawer.cpp
   trunk/rts/Sim/Misc/GeometricObjects.cpp
   trunk/rts/Sim/Projectiles/ProjectileHandler.cpp
   trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp
   trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp
   trunk/rts/Sim/Units/UnitTracker.cpp
Log:
part of a patch by Jonanin: use ANormalize (fast Normalize) in unsynced parts of the code

Modified: trunk/rts/ExternalAI/GlobalAIHandler.cpp
===================================================================
--- trunk/rts/ExternalAI/GlobalAIHandler.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/ExternalAI/GlobalAIHandler.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -304,7 +304,7 @@
 			if(ais[attacked-&gt;team])
 				if(attacker){
 					float3 dir=helper-&gt;GetUnitErrorPos(attacker,attacked-&gt;allyteam)-attacked-&gt;pos;
-					dir.Normalize();
+					dir.ANormalize();
 					ais[attacked-&gt;team]-&gt;ai-&gt;UnitDamaged(attacked-&gt;id,attacker-&gt;id,damage,dir);
 				} else {
 					ais[attacked-&gt;team]-&gt;ai-&gt;UnitDamaged(attacked-&gt;id,-1,damage,ZeroVector);
@@ -314,7 +314,7 @@
 				int a = attacker-&gt;team;
 				if(ais[attacker-&gt;team] &amp;&amp; !gs-&gt;Ally(gs-&gt;AllyTeam(a),attacked-&gt;allyteam) &amp;&amp; (ais[a]-&gt;cheatevents || (attacked-&gt;losStatus[a] &amp; (LOS_INLOS | LOS_INRADAR)))) {
 					float3 dir=attacker-&gt;pos-helper-&gt;GetUnitErrorPos(attacked,attacker-&gt;allyteam);
-					dir.Normalize();
+					dir.ANormalize();
 					ais[a]-&gt;ai-&gt;EnemyDamaged(attacked-&gt;id,attacker-&gt;id,damage,dir);
 				}
 			}

Modified: trunk/rts/Game/Camera/FPSController.cpp
===================================================================
--- trunk/rts/Game/Camera/FPSController.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Camera/FPSController.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -83,7 +83,7 @@
 	dir.x = (float)(cos(camera-&gt;rot.x) * sin(camera-&gt;rot.y));
 	dir.z = (float)(cos(camera-&gt;rot.x) * cos(camera-&gt;rot.y));
 	dir.y = (float)(sin(camera-&gt;rot.x));
-	dir.Normalize();
+	dir.ANormalize();
 	return dir;
 }
 

Modified: trunk/rts/Game/Camera/FreeController.cpp
===================================================================
--- trunk/rts/Game/Camera/FreeController.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Camera/FreeController.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -36,7 +36,7 @@
   gndLock(false)
 {
 	dir = float3(0.0f, -2.0f, -1.0f);
-	dir.Normalize();
+	dir.ANormalize();
 	if (camera) {
 		const float hDist = sqrt((dir.x * dir.x) + (dir.z * dir.z));
 		camera-&gt;rot.y = atan2(dir.x, dir.z);
@@ -144,7 +144,7 @@
 		}
 		else {
 			float3 forwardNoY(camera-&gt;forward.x, 0.0f, camera-&gt;forward.z);
-			forwardNoY.Normalize();
+			forwardNoY.ANormalize();
 			const float3 tmpVel((forwardNoY    * vel.x) +
 			                    (UpVector      * vel.y) +
 			                    (camera-&gt;right * vel.z));
@@ -383,7 +383,7 @@
 	dir.x = (float)(sin(camera-&gt;rot.y) * cos(camera-&gt;rot.x));
 	dir.z = (float)(cos(camera-&gt;rot.y) * cos(camera-&gt;rot.x));
 	dir.y = (float)(sin(camera-&gt;rot.x));
-	dir.Normalize();
+	dir.ANormalize();
 	return dir;
 }
 

Modified: trunk/rts/Game/Camera/OrbitController.cpp
===================================================================
--- trunk/rts/Game/Camera/OrbitController.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Camera/OrbitController.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -152,7 +152,7 @@
 
 	cam-&gt;pos = cen + GetOrbitPos();
 	cam-&gt;pos.y = std::max(cam-&gt;pos.y, ground-&gt;GetHeight2(cam-&gt;pos.x, cam-&gt;pos.z));
-	cam-&gt;forward = (cen - cam-&gt;pos).Normalize();
+	cam-&gt;forward = (cen - cam-&gt;pos).ANormalize();
 	cam-&gt;up = YVEC;
 }
 
@@ -179,7 +179,7 @@
 
 	if (cen.y &lt; cenGH) {
 		cen.y = cenGH;
-		cam-&gt;forward = (cen - cam-&gt;pos).Normalize();
+		cam-&gt;forward = (cen - cam-&gt;pos).ANormalize();
 
 		Init(cam-&gt;pos, cen);
 	}
@@ -237,7 +237,7 @@
 
 float3 COrbitController::GetDir()
 {
-	return (cen - camera-&gt;pos).Normalize();
+	return (cen - camera-&gt;pos).ANormalize();
 }
 
 float3 COrbitController::GetOrbitPos() const

Modified: trunk/rts/Game/Camera/OverheadController.cpp
===================================================================
--- trunk/rts/Game/Camera/OverheadController.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Camera/OverheadController.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -133,7 +133,7 @@
 	}
 
 	pos.y = ground-&gt;GetHeight(pos.x,pos.z);
-	dir = float3(0.0f, -1.0f, flipped ? zscale : -zscale).Normalize();
+	dir = float3(0.0f, -1.0f, flipped ? zscale : -zscale).ANormalize();
 
 	float3 cpos = pos - dir * height;
 

Modified: trunk/rts/Game/Camera/OverviewController.cpp
===================================================================
--- trunk/rts/Game/Camera/OverviewController.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Camera/OverviewController.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -42,7 +42,7 @@
 
 float3 COverviewController::GetDir()
 {
-	return float3(0.0f, -1.0f, -0.001f).Normalize();
+	return float3(0.0f, -1.0f, -0.001f).ANormalize();
 }
 
 void COverviewController::SetPos(const float3&amp; newPos)

Modified: trunk/rts/Game/Camera/RotOverheadController.cpp
===================================================================
--- trunk/rts/Game/Camera/RotOverheadController.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Camera/RotOverheadController.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -27,7 +27,7 @@
 	if(camera-&gt;forward.y&lt;-0.9f)
 		flatForward+=camera-&gt;up;
 	flatForward.y=0;
-	flatForward.Normalize();
+	flatForward.ANormalize();
 
 	pos+=(flatForward*move.y+camera-&gt;right*move.x)*scrollSpeed;
 }
@@ -86,7 +86,7 @@
 	dir.x=(float)(sin(camera-&gt;rot.y)*cos(camera-&gt;rot.x));
 	dir.y=(float)(sin(camera-&gt;rot.x));
 	dir.z=(float)(cos(camera-&gt;rot.y)*cos(camera-&gt;rot.x));
-	dir.Normalize();
+	dir.ANormalize();
 	return dir;
 }
 

Modified: trunk/rts/Game/Camera/SmoothController.cpp
===================================================================
--- trunk/rts/Game/Camera/SmoothController.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Camera/SmoothController.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -184,7 +184,7 @@
 	}
 
 	pos.y = ground-&gt;GetHeight(pos.x,pos.z);
-	dir = float3(0.0f, -1.0f, flipped ? zscale : -zscale).Normalize();
+	dir = float3(0.0f, -1.0f, flipped ? zscale : -zscale).ANormalize();
 
 	float3 cpos = pos - dir * height;
 

Modified: trunk/rts/Game/Camera/TWController.cpp
===================================================================
--- trunk/rts/Game/Camera/TWController.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Camera/TWController.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -29,7 +29,7 @@
 {
 	float3 flatForward=camera-&gt;forward;
 	flatForward.y=0;
-	flatForward.Normalize();
+	flatForward.ANormalize();
 
 	move*=sqrt(move.z)*200;
 	pos+=(flatForward*move.y+camera-&gt;right*move.x)*scrollSpeed;
@@ -43,7 +43,7 @@
 	move*=(1+keys[SDLK_LSHIFT]*3)*pixelsize;
 	float3 flatForward=camera-&gt;forward;
 	flatForward.y=0;
-	flatForward.Normalize();
+	flatForward.ANormalize();
 
 	pos+=-(flatForward*move.y-camera-&gt;right*move.x)*scrollSpeed;
 }
@@ -86,7 +86,7 @@
 	dir.x=(float)(sin(camera-&gt;rot.y)*cos(camera-&gt;rot.x));
 	dir.y=(float)(sin(camera-&gt;rot.x));
 	dir.z=(float)(cos(camera-&gt;rot.y)*cos(camera-&gt;rot.x));
-	dir.Normalize();
+	dir.ANormalize();
 
 	float dist=-camera-&gt;rot.x*1500;
 
@@ -105,7 +105,7 @@
 	dir.x=(float)(sin(camera-&gt;rot.y)*cos(camera-&gt;rot.x));
 	dir.y=(float)(sin(camera-&gt;rot.x));
 	dir.z=(float)(cos(camera-&gt;rot.y)*cos(camera-&gt;rot.x));
-	dir.Normalize();
+	dir.ANormalize();
 	return dir;
 }
 

Modified: trunk/rts/Game/Camera.cpp
===================================================================
--- trunk/rts/Game/Camera.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Camera.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -129,13 +129,13 @@
 void CCamera::Update(bool freeze)
 {
 	pos2 = pos;
-	up.Normalize();
+	up.ANormalize();
 
 	right = forward.cross(up);
-	right.Normalize();
+	right.ANormalize();
 	
 	up = right.cross(forward);
-	up.Normalize();
+	up.ANormalize();
 
 	const float aspect = (float) gu-&gt;viewSizeX / (float) gu-&gt;viewSizeY;
 	const float viewx = tan(aspect * halfFov);
@@ -151,15 +151,15 @@
 
 	const float3 forwardy = (-forward * viewy);
 	top    = forwardy + up;
-	top.Normalize();
+	top.ANormalize();
 	bottom = forwardy - up;
-	bottom.Normalize();
+	bottom.ANormalize();
 	
 	const float3 forwardx = (-forward * viewx);
 	rightside = forwardx + right;
-	rightside.Normalize();
+	rightside.ANormalize();
 	leftside  = forwardx - right;
-	leftside.Normalize();
+	leftside.ANormalize();
 
 	if (!freeze) {
 		cam2-&gt;bottom    = bottom;
@@ -198,7 +198,7 @@
 	                (up      * tiltOffset.y);
 
 	const float3 camPos = pos + posOffset;
-	const float3 center = camPos + fShake.Normalize();
+	const float3 center = camPos + fShake.ANormalize();
 
 	// apply and store the transform, should be faster
 	// than calling glGetDoublev(GL_MODELVIEW_MATRIX)
@@ -282,7 +282,7 @@
 	forward.z = cos(rot.y) * cos(rot.x);
 	forward.x = sin(rot.y) * cos(rot.x);
 	forward.y = sin(rot.x);
-	forward.Normalize();
+	forward.ANormalize();
 }
 
 
@@ -291,7 +291,7 @@
 	float dx = float(x-gu-&gt;viewPosX-gu-&gt;viewSizeX/2)/gu-&gt;viewSizeY * tanHalfFov * 2;
 	float dy = float(y-gu-&gt;viewSizeY/2)/gu-&gt;viewSizeY * tanHalfFov * 2;
 	float3 dir = forward - up * dy + right * dx;
-	dir.Normalize();
+	dir.ANormalize();
 	return dir;
 }
 
@@ -326,7 +326,7 @@
 }
 
 inline void CCamera::myGluLookAt(const float3&amp; eye, const float3&amp; center, const float3&amp; up) {
-	float3 f = (center - eye).Normalize();
+	float3 f = (center - eye).ANormalize();
 	float3 s = f.cross(up);
 	float3 u = s.cross(f);
 

Modified: trunk/rts/Game/CameraHandler.cpp
===================================================================
--- trunk/rts/Game/CameraHandler.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/CameraHandler.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -116,7 +116,7 @@
 		camera-&gt;SetFov(camera-&gt;GetFov() + (deltaFOV * ratio));
 		camera-&gt;pos     += deltaPos * ratio;
 		camera-&gt;forward += deltaDir * ratio;
-		camera-&gt;forward.Normalize();
+		camera-&gt;forward.ANormalize();
 	}
 }
 

Modified: trunk/rts/Game/Game.cpp
===================================================================
--- trunk/rts/Game/Game.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/Game.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -4346,8 +4346,8 @@
 		}
 		if(w-&gt;targetType!=Target_None){
 			float3 pos=w-&gt;targetPos;
-			float3 v1=(pos-camera-&gt;pos).Normalize();
-			float3 v2=(v1.cross(UpVector)).Normalize();
+			float3 v1=(pos-camera-&gt;pos).ANormalize();
+			float3 v2=(v1.cross(UpVector)).ANormalize();
 			float3 v3=(v2.cross(v1)).Normalize();
 			float radius=10;
 			if(w-&gt;targetType==Target_Unit)
@@ -4362,9 +4362,9 @@
 			if(!w-&gt;onlyForward){
 				float dist=std::min(w-&gt;owner-&gt;directControl-&gt;targetDist,w-&gt;range*0.9f);
 				pos=w-&gt;weaponPos+w-&gt;wantedDir*dist;
-				v1=(pos-camera-&gt;pos).Normalize();
-				v2=(v1.cross(UpVector)).Normalize();
-				v3=(v2.cross(v1)).Normalize();
+				v1=(pos-camera-&gt;pos).ANormalize();
+				v2=(v1.cross(UpVector)).ANormalize();
+				v3=(v2.cross(v1)).ANormalize();
 				radius=dist/100;
 
 				glBegin(GL_LINE_STRIP);
@@ -4384,7 +4384,7 @@
 				glVertexf3(pos+(v2*streflop::sin(PI*-0.25f)+v3*streflop::cos(PI*-0.25f))*radius);
 				glVertexf3(pos+(v2*streflop::sin(PI*-1.25f)+v3*streflop::cos(PI*-1.25f))*radius);
 			}
-			if((w-&gt;targetPos-camera-&gt;pos).Normalize().dot(camera-&gt;forward)&lt;0.7f){
+			if((w-&gt;targetPos-camera-&gt;pos).ANormalize().dot(camera-&gt;forward)&lt;0.7f){
 				glVertexf3(w-&gt;targetPos);
 				glVertexf3(camera-&gt;pos+camera-&gt;forward*100);
 			}

Modified: trunk/rts/Game/SelectedUnitsAI.cpp
===================================================================
--- trunk/rts/Game/SelectedUnitsAI.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/SelectedUnitsAI.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -164,7 +164,7 @@
 		const float3 pos(c.params[0], c.params[1], c.params[2]);
 		float3 frontdir = pos - centerCoor;
 		frontdir.y = 0.0f;
-		frontdir.Normalize();
+		frontdir.ANormalize();
 		const float3 sideDir = frontdir.cross(UpVector);
 
 		// calculate so that the units form in an aproximate square
@@ -327,7 +327,7 @@
 	sideDir.y=0;
 	float3 sd = sideDir;
 	sd.y=frontLength/2;
-	sideDir.Normalize();
+	sideDir.ANormalize();
 	frontDir=sideDir.cross(float3(0,1,0));
 
 	numColumns=(int)(frontLength/columnDist);

Modified: trunk/rts/Game/StartScripts/AirScript.cpp
===================================================================
--- trunk/rts/Game/StartScripts/AirScript.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/StartScripts/AirScript.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -164,12 +164,12 @@
 	float3 modPlanePos=u-&gt;pos-u-&gt;frontdir*25+u-&gt;speed*gu-&gt;timeOffset;
 	tcp+=(modPlanePos-tcp)*(1-pow(0.95f,deltaTime));
 	tcf+=(u-&gt;frontdir-tcf)*(1-pow(0.9f,deltaTime));
-	tcf.Normalize();
+	tcf.ANormalize();
 
 	camera-&gt;pos=tcp;
-	//camera-&gt;forward=((u-&gt;pos+u-&gt;speed*gu-&gt;timeOffset-camera-&gt;pos).Normalize()+u-&gt;frontdir).Normalize();
-	camera-&gt;forward=((u-&gt;pos+u-&gt;speed*gu-&gt;timeOffset-camera-&gt;pos).Normalize()+tcf.Normalize());
-	camera-&gt;forward.Normalize();
+	//camera-&gt;forward=((u-&gt;pos+u-&gt;speed*gu-&gt;timeOffset-camera-&gt;pos).Normalize()+u-&gt;frontdir).ANormalize();
+	camera-&gt;forward=((u-&gt;pos+u-&gt;speed*gu-&gt;timeOffset-camera-&gt;pos).ANormalize()+tcf.ANormalize());
+	camera-&gt;forward.ANormalize();
 
 	if(doRoll){
 		oldUp[gs-&gt;frameNum%32]=u-&gt;updir;

Modified: trunk/rts/Game/UI/GuiHandler.cpp
===================================================================
--- trunk/rts/Game/UI/GuiHandler.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/UI/GuiHandler.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -2306,7 +2306,7 @@
 				if (!commands[tempInCommand].params.empty() &amp;&amp;
 				    pos.distance2D(pos2) &gt; atof(commands[tempInCommand].params[0].c_str())) {
 					float3 dif=pos2-pos;
-					dif.Normalize();
+					dif.ANormalize();
 					pos2=pos+dif*atoi(commands[tempInCommand].params[0].c_str());
 				}
 
@@ -4027,7 +4027,7 @@
 	ProcessFrontPositions(pos1, pos2);
 
 	float3 forward=(pos1-pos2).cross(UpVector);
-	forward.Normalize();
+	forward.ANormalize();
 	float3 side=forward.cross(UpVector);
 	if(pos1.distance2D(pos2)&gt;maxSize){
 		pos2=pos1+side*maxSize;

Modified: trunk/rts/Game/UI/MouseHandler.cpp
===================================================================
--- trunk/rts/Game/UI/MouseHandler.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/UI/MouseHandler.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -349,9 +349,9 @@
 			float3 pos2=camera-&gt;pos+dir*dist;
 
 			float3 dir1=pos1-camera-&gt;pos;
-			dir1.Normalize();
+			dir1.ANormalize();
 			float3 dir2=pos2-camera-&gt;pos;
-			dir2.Normalize();
+			dir2.ANormalize();
 
 			float rl1=(dir1.dot(camera-&gt;right))/dir1.dot(camera-&gt;forward);
 			float ul1=(dir1.dot(camera-&gt;up))/dir1.dot(camera-&gt;forward);

Modified: trunk/rts/Game/UI/SelectionKeyHandler.cpp
===================================================================
--- trunk/rts/Game/UI/SelectionKeyHandler.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Game/UI/SelectionKeyHandler.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -522,7 +522,7 @@
 			wantedCamDir.x=(float)(sin(camera-&gt;rot.y)*cos(camera-&gt;rot.x));
 			wantedCamDir.y=(float)(sin(camera-&gt;rot.x));
 			wantedCamDir.z=(float)(cos(camera-&gt;rot.y)*cos(camera-&gt;rot.x));
-			wantedCamDir.Normalize();
+			wantedCamDir.ANormalize();
 
 			camHandler-&gt;GetCurrentController().SetPos(sel-&gt;pos - wantedCamDir*800);
 		}

Modified: trunk/rts/Map/MapInfo.cpp
===================================================================
--- trunk/rts/Map/MapInfo.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/MapInfo.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -139,7 +139,7 @@
 	const LuaTable lightTable = mapRoot-&gt;SubTable(&quot;lighting&quot;);
 
 	light.sunDir = lightTable.GetFloat3(&quot;sunDir&quot;, float3(0.0f, 1.0f, 2.0f));
-	light.sunDir.Normalize();
+	light.sunDir.ANormalize();
 
 	light.groundAmbientColor  = lightTable.GetFloat3(&quot;groundAmbientColor&quot;,
 	                                                float3(0.5f, 0.5f, 0.5f));

Modified: trunk/rts/Map/SM3/Frustum.cpp
===================================================================
--- trunk/rts/Map/SM3/Frustum.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SM3/Frustum.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -55,9 +55,9 @@
 	planes[3].MakePlane (base, pos[0], pos[1]); // right
 	planes[4].MakePlane (base, pos[1], pos[2]);// down
 
-	right.Normalize();
-	up.Normalize();
-	front.Normalize();
+	right.ANormalize();
+	up.ANormalize();
+	front.ANormalize();
 }
 
 void Frustum::Draw ()

Modified: trunk/rts/Map/SM3/Sm3GroundDrawer.cpp
===================================================================
--- trunk/rts/Map/SM3/Sm3GroundDrawer.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SM3/Sm3GroundDrawer.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -54,10 +54,10 @@
 	tc.aspect = gu-&gt;viewSizeX / (float)gu-&gt;viewSizeY;
 
 	tc.right = tc.front.cross(tc.up);
-	tc.right.Normalize();
+	tc.right.ANormalize();
 
 	tc.up=tc.right.cross(tc.front);
-	tc.up.Normalize();
+	tc.up.ANormalize();
 }
 
 void CSm3GroundDrawer::Update()

Modified: trunk/rts/Map/SM3/terrain/Lightcalc.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/Lightcalc.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SM3/terrain/Lightcalc.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -146,7 +146,7 @@
 				uchar* normal = hm-&gt;GetNormal (x,y);
 				Vector3 normv((2 * (int)normal[0] - 256)/255.0f, (2 * (int)normal[1] - 256)/255.0f, (2 * (int)normal[2] - 256)/255.0f);
 
-				wp.Normalize();
+				wp.ANormalize();
 				float dot = wp.dot(normv);
 				if(dot &lt; 0.0f) dot = 0.0f;
 				if(dot &gt; 1.0f) dot = 1.0f;

Modified: trunk/rts/Map/SM3/terrain/QuadRenderData.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/QuadRenderData.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SM3/terrain/QuadRenderData.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -186,15 +186,15 @@
 				Vector3 tangent, binormal;
 				CalculateTangents (hm, x,y, tangent, binormal);
 				Vector3 normal = binormal.cross(tangent);
-				normal.Normalize ();
+				normal.ANormalize ();
 
 				if (vda &amp; VRT_Normal)
 					*(v++) = normal;
 
 				if (vda &amp; VRT_TangentSpaceMatrix)
 				{
-					tangent.Normalize ();
-					binormal.Normalize ();
+					tangent.ANormalize ();
+					binormal.ANormalize ();
 
 					// orthonormal matrix, so inverse=transpose
 					// Take the inverse of the tangent space -&gt; world space transformation

Modified: trunk/rts/Map/SM3/terrain/Terrain.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/Terrain.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SM3/terrain/Terrain.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -571,9 +571,9 @@
 				CalculateTangents(hm, x,y, tangent, binormal);
 
 				Vector3 normal = binormal.cross(tangent);
-				normal.Normalize();
-				binormal.Normalize ();
-				tangent.Normalize ();
+				normal.ANormalize();
+				binormal.ANormalize ();
+				tangent.ANormalize ();
 
 				glColor3f (1,1,0);
 				glVertex3fv(&amp;origin[0]);

Modified: trunk/rts/Map/SM3/terrain/TerrainTexture.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/TerrainTexture.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SM3/terrain/TerrainTexture.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -564,7 +564,7 @@
 	void TerrainTexture::SetShaderParams (const Vector3&amp; lightDir, const Vector3&amp; eyePos)
 	{
 		wsLightDir = lightDir;
-		wsLightDir.Normalize ();
+		wsLightDir.ANormalize ();
 		wsEyePos = eyePos;
 	}
 

Modified: trunk/rts/Map/SM3/terrain/TerrainUtil.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/TerrainUtil.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SM3/terrain/TerrainUtil.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -121,7 +121,7 @@
 				CalculateTangents(this, x,y,tangent,binormal);
 
 				Vector3 normal = binormal.cross(tangent);
-				normal.Normalize ();
+				normal.ANormalize ();
 
 				*(cnorm++) = (uchar)((normal.x * 0.5f + 0.5f) * 255);
 				*(cnorm++) = (uchar)((normal.y * 0.5f + 0.5f) * 255);

Modified: trunk/rts/Map/SM3/terrain/Textures.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/Textures.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SM3/terrain/Textures.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -267,7 +267,7 @@
 					Vector3 tangent, binormal;
 					CalculateTangents(heightmap, x,y,tangent,binormal);
 					Vector3 normal = tangent.cross(binormal);
-					normal.Normalize();
+					normal.ANormalize();
 					norm_y = normal.y;
 				}
 
@@ -333,7 +333,7 @@
 				if (sx*sx + sy*sy &lt; 32*32) {
 					int sz = (int)sqrt(static_cast&lt;float&gt;(32 * 32 - sx*sx - sy*sy));
 					n = Vector3(sx,sy,sz);
-					n.Normalize ();
+					n.ANormalize ();
 				}
 
 				// compress it into a color

Modified: trunk/rts/Map/SMF/BFGroundDrawer.cpp
===================================================================
--- trunk/rts/Map/SMF/BFGroundDrawer.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SMF/BFGroundDrawer.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -1377,7 +1377,7 @@
 	float3 side = cam2-&gt;forward;
 	float3 camHorizontal = cam2-&gt;forward;
 	camHorizontal.y = 0;
-	camHorizontal.Normalize();
+	camHorizontal.ANormalize();
 	// get vector for collision between frustum and horizontal plane
 	float3 b = up.cross(camHorizontal);
 

Modified: trunk/rts/Map/SMF/SmfReadMap.cpp
===================================================================
--- trunk/rts/Map/SMF/SmfReadMap.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Map/SMF/SmfReadMap.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -213,7 +213,7 @@
 {
 	float3 n1 = facenormals[((y * gs-&gt;mapx) + x) * 2] +
 	            facenormals[((y * gs-&gt;mapx) + x) * 2 + 1];
-	n1.Normalize();
+	n1.ANormalize();
 
 	float3 light = mapInfo-&gt;light.groundSunColor*mapInfo-&gt;light.sunDir.dot(n1);
 	for (int a = 0; a &lt; 3; ++a) {

Modified: trunk/rts/Rendering/Env/AdvSky.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvSky.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/Env/AdvSky.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -45,7 +45,7 @@
 	sundir2.y=0;
 	if(sundir2.Length()==0)
 		sundir2.x=1;
-	sundir2.Normalize();
+	sundir2.ANormalize();
 	sundir1=sundir2.cross(UpVector);
 
 	modSunDir.y=mapInfo-&gt;light.sunDir.y;
@@ -660,7 +660,7 @@
 	delete [] mem;
 
 	float3 ldir=modSunDir.cross(UpVector);
-	ldir.Normalize();
+	ldir.ANormalize();
 	float3 udir=modSunDir.cross(ldir);
 
 	sunFlareList=glGenLists(1);
@@ -813,7 +813,7 @@
 	float fy=asin(hdist/400);
 	dir.y=(cos(fy)-domeheight)*400;
 
-	dir.Normalize();
+	dir.ANormalize();
 
 	return dir;
 }

Modified: trunk/rts/Rendering/Env/AdvTreeDrawer.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvTreeDrawer.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/Env/AdvTreeDrawer.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -434,7 +434,7 @@
 				float ang=fti-&gt;fallPos*PI;
 				float3 up(fti-&gt;dir.x*sin(ang),cos(ang),fti-&gt;dir.z*sin(ang));
 				float3 z(up.cross(float3(-1,0,0)));
-				z.Normalize();
+				z.ANormalize();
 				float3 x(up.cross(z));
 				CMatrix44f transMatrix(pos,x,up,z);
 
@@ -728,7 +728,7 @@
 				float ang=fti-&gt;fallPos*PI;
 				float3 up(fti-&gt;dir.x*sin(ang),cos(ang),fti-&gt;dir.z*sin(ang));
 				float3 z(up.cross(float3(1,0,0)));
-				z.Normalize();
+				z.ANormalize();
 				float3 x(z.cross(up));
 				CMatrix44f transMatrix(pos,x,up,z);
 

Modified: trunk/rts/Rendering/Env/AdvTreeGenerator.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvTreeGenerator.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/Env/AdvTreeGenerator.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -189,7 +189,7 @@
 		float angle=baseAngle+a*3.88f+fRand(0.5f);
 		float3 dir=orto1*sin(angle)+orto2*cos(angle);
 		dir.y=0.3f+fRand(0.4f);
-		dir.Normalize();
+		dir.ANormalize();
 		float3 start(0,(a+5)*height/(numBranch+5),0);
 		float length=(height*(0.4f+fRand(0.1f)))*sqrt(float(numBranch-a)/numBranch);
 		TrunkIterator(start,dir,length,length*0.05f,1);
@@ -198,7 +198,7 @@
 		float angle=a*3.88f+fRand(0.5f);
 		float3 dir=orto1*sin(angle)+orto2*cos(angle);
 		dir.y=0.8f;
-		dir.Normalize();
+		dir.ANormalize();
 		float3 start(0,height-0.3f,0);
 		float length=MAX_TREE_HEIGHT*0.1f;
 		TrunkIterator(start,dir,length,length*0.05f,0);
@@ -212,9 +212,9 @@
 		orto1=dir.cross(UpVector);
 	else
 		orto1=dir.cross(float3(1,0,0));
-	orto1.Normalize();
+	orto1.ANormalize();
 	float3 orto2=dir.cross(orto1);
-	orto2.Normalize();
+	orto2.ANormalize();
 
 	DrawTrunk(start,start+dir*length,orto1,orto2,size);
 
@@ -230,7 +230,7 @@
 		float angle=PI+float(a)*PI+fRand(0.3f);
 		float3 newbase=start+dir*length*(float(a+1)/(numTrunks+1));
 		float3 newDir=dir+orto1*cos(angle)*dirDif+orto2*sin(angle)*dirDif;
-		newDir.Normalize();
+		newDir.ANormalize();
 		float newLength=length*(float(numTrunks-a)/(numTrunks+1));
 		TrunkIterator(newbase,newDir,newLength,newLength*0.05f,depth-1);
 	}
@@ -256,7 +256,7 @@
 
 		float3 npos=pos;
 		npos.y=0;
-		npos.Normalize();
+		npos.ANormalize();
 		float col=0.5f+npos.dot(flatSun)*0.3f+fRand(0.1f);
 		va-&gt;AddVertexTN(pos,0.126f+tex+flipTex,0.98f,float3(0.09f*MAX_TREE_HEIGHT,-0.09f*MAX_TREE_HEIGHT,col));
 		va-&gt;AddVertexTN(pos,0.249f+tex-flipTex,0.98f,float3(-0.09f*MAX_TREE_HEIGHT,-0.09f*MAX_TREE_HEIGHT,col));
@@ -270,7 +270,7 @@
 
 	float3 npos=pos;
 	npos.y=0;
-	npos.Normalize();
+	npos.ANormalize();
 	float col=0.5f+npos.dot(flatSun)*0.3f+fRand(0.1f);
 	va-&gt;AddVertexTN(pos,0.126f+tex+flipTex,0.98f,float3(0.09f*MAX_TREE_HEIGHT,-0.09f*MAX_TREE_HEIGHT,col));
 	va-&gt;AddVertexTN(pos,0.249f+tex-flipTex,0.98f,float3(-0.09f*MAX_TREE_HEIGHT,-0.09f*MAX_TREE_HEIGHT,col));
@@ -622,7 +622,7 @@
 {
 	float3 dir=end-start;
 	float length=dir.Length();
-	dir.Normalize();
+	dir.ANormalize();
 	float3 orto=dir.cross(float3(0,0,1));
 
 	glBegin(GL_QUADS);
@@ -645,7 +645,7 @@
 	while(tipDist&lt;length*(0.83f+fRand(0.15f))){
 		float3 bstart=start+dir*(length-tipDist);
 		float3 bdir=dir+orto*side*(1.0f+fRand(0.7f));
-		bdir.Normalize();
+		bdir.ANormalize();
 		float3 bend=bstart+bdir*tipDist*((6-tipDist)*(0.10f+fRand(0.05f)));
 		CreateGranTexBranch(bstart,bend);
 		side*=-1;
@@ -666,7 +666,7 @@
 		float angle=baseAngle+(a*0.618f+fRand(0.1f))*2*PI;
 		float3 dir(orto1*sin(angle)+orto2*cos(angle));
 		dir.y=(a-numBranch)*0.01f-fRand(0.2f)-0.2f;
-		dir.Normalize();
+		dir.ANormalize();
 		float size=sqrt((float)numBranch-a+5)*0.08f*MAX_TREE_HEIGHT;
 		DrawPineBranch(float3(0,h,0),dir,size);
 	}
@@ -711,7 +711,7 @@
 	flatSun.y=0;
 
 	float3 orto1=dir.cross(UpVector);
-	orto1.Normalize();
+	orto1.ANormalize();
 	float3 orto2=dir.cross(orto1);
 
 	float tex=float(int(rand()*3.0f/(float)RAND_MAX))*0.125f;

Modified: trunk/rts/Rendering/Env/AdvWater.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvWater.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/Env/AdvWater.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -168,7 +168,7 @@
 
 	float3 forward=camera-&gt;forward;
 	forward.y=0;
-	forward.Normalize();
+	forward.ANormalize();
 
 	glProgramEnvParameter4fARB(GL_FRAGMENT_PROGRAM_ARB,0, forward.z,forward.x,0,0);
 	glProgramEnvParameter4fARB(GL_FRAGMENT_PROGRAM_ARB,1, -forward.x,forward.z,0,0);
@@ -180,7 +180,7 @@
 		bool maxReached=false;
 		for(int y=0;y&lt;numDivs;++y){
 			dir=base;
-			dir.Normalize();
+			dir.ANormalize();
 
 			if(dir.y&gt;=maxY){
 				maxReached=true;
@@ -190,14 +190,14 @@
 			xbase=base;
 			for(int x=0;x&lt;numDivs+1;++x){ //! CAUTION: loop count must match EnlargeArrays above
 				dir=xbase+dv;
-				dir.Normalize();
+				dir.ANormalize();
 				zpos=camera-&gt;pos+dir*(camera-&gt;pos.y/-dir.y);
 				zpos.y=sin(zpos.z*0.1f+gs-&gt;frameNum*0.06f)*0.06f+0.05f;
 				col[3]=(unsigned char)((0.8f+0.7f*(dir.y))*255);
 				va-&gt;AddVertexQTC(zpos,x*(1.0f/numDivs),screenY-yInc,col);
 
 				dir=xbase;
-				dir.Normalize();
+				dir.ANormalize();
 				zpos=camera-&gt;pos+dir*(camera-&gt;pos.y/-dir.y);
 				zpos.y=sin(zpos.z*0.1f+gs-&gt;frameNum*0.06f)*0.06f+0.05f;
 				col[3]=(unsigned char)((0.8f+0.7f*(dir.y))*255);

Modified: trunk/rts/Rendering/Env/BasicSky.cpp
===================================================================
--- trunk/rts/Rendering/Env/BasicSky.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/Env/BasicSky.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -48,7 +48,7 @@
 	sundir2.y=0;
 	if(sundir2.Length()==0)
 		sundir2.x=1;
-	sundir2.Normalize();
+	sundir2.ANormalize();
 	sundir1=sundir2.cross(UpVector);
 
 	modSunDir.y=mapInfo-&gt;light.sunDir.y;
@@ -140,7 +140,7 @@
 	glEnable(GL_TEXTURE_2D);
 	glBindTexture(GL_TEXTURE_2D,sunTex);
 	float3 sundir(0,0.5f,1);
-	sundir.Normalize();
+	sundir.ANormalize();
 
 	float3 ldir=sundir.cross(UpVector);
 	float3 udir=sundir.cross(ldir);
@@ -768,7 +768,7 @@
 	float fy=asin(hdist/400);
 	dir.y=(cos(fy)-domeheight)*400;
 
-	dir.Normalize();
+	dir.ANormalize();
 
 	return dir;
 }

Modified: trunk/rts/Rendering/Env/DynWater.cpp
===================================================================
--- trunk/rts/Rendering/Env/DynWater.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/Env/DynWater.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -817,7 +817,7 @@
 	float3 side=cam2-&gt;forward;
 	float3 camHorizontal=cam2-&gt;forward;
 	camHorizontal.y=0;
-	camHorizontal.Normalize();
+	camHorizontal.ANormalize();
 	float3 b=up.cross(camHorizontal);			//get vector for collision between frustum and horizontal plane
 	if(fabs(b.z)&gt;0.0001f){
 		temp.dir=b.x/b.z;				//set direction to that

Modified: trunk/rts/Rendering/Env/GrassDrawer.cpp
===================================================================
--- trunk/rts/Rendering/Env/GrassDrawer.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/Env/GrassDrawer.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -477,9 +477,9 @@
 			glColor4f(0.62f,0.62f,0.62f,1-((*gi).dist+128-grassDistance)/128.0f);			
 
 		float3 v=grass[(*gi).num].pos-camera-&gt;pos;
-		v.Normalize();
+		v.ANormalize();
 		float3 side(v.cross(UpVector));
-		side.Normalize();
+		side.ANormalize();
 		glProgramEnvParameter4fARB(GL_VERTEX_PROGRAM_ARB,8,  side.x,side.y,side.z,0);
 		float3 up(side.cross(v));
 		glProgramEnvParameter4fARB(GL_VERTEX_PROGRAM_ARB,9,  up.x,up.y,up.z,0);
@@ -498,9 +498,9 @@
 			float3 squarePos((x+0.5f)*gSSsq, 0, (y+0.5f)*gSSsq);
 			squarePos.y=ground-&gt;GetHeight2(squarePos.x,squarePos.z);
 			float3 v=squarePos-camera-&gt;pos;
-			v.Normalize();
+			v.ANormalize();
 			float3 side(v.cross(UpVector));
-			side.Normalize();
+			side.ANormalize();
 			glProgramEnvParameter4fARB(GL_VERTEX_PROGRAM_ARB,8,  side.x,side.y,side.z,0);
 			float3 up(side.cross(v));
 			glProgramEnvParameter4fARB(GL_VERTEX_PROGRAM_ARB,9,  up.x,up.y,up.z,0);
@@ -618,7 +618,7 @@
 	for(int a=0;a&lt;strawPerTurf;++a){
 		float maxAng=fRand(PI/2);
 		float3 sideVect(fRand(1)-0.5f,0,fRand(1)-0.5f);
-		sideVect.Normalize();
+		sideVect.ANormalize();
 		float3 forwardVect=sideVect.cross(UpVector);
 		sideVect*=0.32f;
 

Modified: trunk/rts/Rendering/GroundFlash.cpp
===================================================================
--- trunk/rts/Rendering/GroundFlash.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/GroundFlash.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -99,14 +99,14 @@
 	p4.y=ground-&gt;GetApproximateHeight(p4.x,p4.z);
 	p4 += fw;
 	float3 n1((p3-p1).cross(p4-p1));
-	n1.Normalize();
+	n1.ANormalize();
 	float3 n2((p4-p2).cross(p3-p2));
-	n2.Normalize();
+	n2.ANormalize();
 
 	float3 normal=n1+n2;
-	normal.Normalize();
+	normal.ANormalize();
 	side1=normal.cross(float3(1,0,0));
-	side1.Normalize();
+	side1.ANormalize();
 	side2=side1.cross(normal);
 	ph-&gt;AddGroundFlash(this);
 }
@@ -206,14 +206,14 @@
 	p4.y=ground-&gt;GetApproximateHeight(p4.x,p4.z);
 	p4 += fw;
 	float3 n1((p3-p1).cross(p4-p1));
-	n1.Normalize();
+	n1.ANormalize();
 	float3 n2((p4-p2).cross(p3-p2));
-	n2.Normalize();
+	n2.ANormalize();
 
 	float3 normal=n1+n2;
-	normal.Normalize();
+	normal.ANormalize();
 	side1=normal.cross(float3(1,0,0));
-	side1.Normalize();
+	side1.ANormalize();
 	side2=side1.cross(normal);
 	ph-&gt;AddGroundFlash(this);
 }
@@ -272,16 +272,16 @@
 	p4.y=ground-&gt;GetApproximateHeight(p4.x,p4.z);
 	p4 += fw;
 	float3 n1((p3-p1).cross(p4-p1));
-	n1.Normalize();
+	n1.ANormalize();
 	float3 n2((p4-p2).cross(p3-p2));
-	n2.Normalize();
+	n2.ANormalize();
 
 	//pos += fw;
 
 	float3 normal=n1+n2;
-	normal.Normalize();
+	normal.ANormalize();
 	side1=normal.cross(float3(1,0,0));
-	side1.Normalize();
+	side1.ANormalize();
 	side2=side1.cross(normal);
 	ph-&gt;AddGroundFlash(this);
 

Modified: trunk/rts/Rendering/InMapDraw.cpp
===================================================================
--- trunk/rts/Rendering/InMapDraw.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/InMapDraw.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -249,7 +249,7 @@
 			float camDist = dif.Length();
 			dif /= camDist;
 			float3 dir1(dif.cross(UpVector));
-			dir1.Normalize();
+			dir1.ANormalize();
 			float3 dir2(dif.cross(dir1));
 
 			unsigned char col[4];

Modified: trunk/rts/Rendering/ShadowHandler.cpp
===================================================================
--- trunk/rts/Rendering/ShadowHandler.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/ShadowHandler.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -203,7 +203,7 @@
 	glLoadIdentity();
 
 	float3 sundir=mapInfo-&gt;light.sunDir;
-	cross1=(sundir.cross(UpVector)).Normalize();
+	cross1=(sundir.cross(UpVector)).ANormalize();
 	cross2=cross1.cross(sundir);
 	centerPos=camera-&gt;pos;
 //	centerPos.x=((int)((centerPos.x+4)/8))*8;
@@ -380,7 +380,7 @@
 	if(fabs(b.z)&gt;0.0001f){
 		temp.dir=b.x/b.z;				//set direction to that
 		float3 c=b.cross(side);			//get vector from camera to collision line
-		c.Normalize();
+		c.ANormalize();
 		float3 colpoint;				//a point on the collision line
 
 		if(side.y&gt;0){

Modified: trunk/rts/Rendering/UnitModels/UnitDrawer.cpp
===================================================================
--- trunk/rts/Rendering/UnitModels/UnitDrawer.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Rendering/UnitModels/UnitDrawer.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -463,7 +463,7 @@
 	glBindTexture(GL_TEXTURE_2D, fartextureHandler-&gt;GetTextureID());
 	camNorm = camera-&gt;forward;
 	camNorm.y = -0.1f;
-	camNorm.Normalize();
+	camNorm.ANormalize();
 	glColor3f(1, 1, 1);
 	glEnable(GL_FOG);
 	glFogfv(GL_FOG_COLOR, mapInfo-&gt;atmosphere.fogColor);
@@ -1458,7 +1458,7 @@
 	for (int y = 0; y &lt; size; ++y) {
 		for (int x = 0; x &lt; size; ++x) {
 			float3 vec = baseDir + (xdif * (x + 0.5f)) / size + (ydif * (y + 0.5f)) / size;
-			vec.Normalize();
+			vec.ANormalize();
 			float dot = vec.dot(sundir);
 
 			if (dot &lt; 0)

Modified: trunk/rts/Sim/Misc/GeometricObjects.cpp
===================================================================
--- trunk/rts/Sim/Misc/GeometricObjects.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Misc/GeometricObjects.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -43,8 +43,8 @@
 	old2=CalcSpline( 0.05f,b1,b2,b3,b4);
 	for(int a=0;a&lt;20;++a){
 		float3 np=CalcSpline(a*0.05f+0.1f,b1,b2,b3,b4);
-		float3 dir1=(old2-old1).Normalize();
-		float3 dir2=(np-old2).Normalize();
+		float3 dir1=(old2-old1).ANormalize();
+		float3 dir2=(np-old2).ANormalize();
 
 		if(arrow==1 &amp;&amp; a==19){
 			CGeoSquareProjectile* gsp=SAFE_NEW CGeoSquareProjectile(old1,old2,dir1,dir2,width,0);
@@ -108,7 +108,7 @@
 	if(group==0)
 		group=firstFreeGroup++;
 
-	float3 dir=(end-start).Normalize();
+	float3 dir=(end-start).ANormalize();
 	if(arrow){
 		CGeoSquareProjectile* gsp=SAFE_NEW CGeoSquareProjectile(start,start*0.2f+end*0.8f,dir,dir,width*0.5f,width*0.5f);
 		geoGroups[group].squares.push_back(gsp);

Modified: trunk/rts/Sim/Projectiles/ProjectileHandler.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/ProjectileHandler.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Projectiles/ProjectileHandler.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -893,7 +893,7 @@
 	fp-&gt;verts=NULL;
 
 	fp-&gt;rotAxis=gu-&gt;usRandVector();
-	fp-&gt;rotAxis.Normalize();
+	fp-&gt;rotAxis.ANormalize();
 	fp-&gt;rotSpeed=gu-&gt;usRandFloat()*0.1f;
 	fp-&gt;rot=0;
 
@@ -929,7 +929,7 @@
 
 	/* Duplicated with AddFlyingPiece. */
 	fp-&gt;rotAxis=gu-&gt;usRandVector();
-	fp-&gt;rotAxis.Normalize();
+	fp-&gt;rotAxis.ANormalize();
 	fp-&gt;rotSpeed=gu-&gt;usRandFloat()*0.1f;
 	fp-&gt;rot=0;
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -52,8 +52,8 @@
 	float isize = size + size * igrowth;
 	float ilength = length + length * igrowth;
 
-	float3 sidedir = dir.cross(float3(0, 1, 0)).Normalize();
-	float3 updir = dir.cross(sidedir).Normalize();
+	float3 sidedir = dir.cross(float3(0, 1, 0)).ANormalize();
+	float3 updir = dir.cross(sidedir).ANormalize();
 
 	va-&gt;AddVertexTC(pos + updir * isize,                 sideTexture-&gt;xstart, sideTexture-&gt;ystart, col);
 	va-&gt;AddVertexTC(pos + updir * isize + dir * ilength, sideTexture-&gt;xend,   sideTexture-&gt;ystart, col);

Modified: trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -66,9 +66,9 @@
 	inArray=true;
 
 	float3 dif(pos-camera-&gt;pos2);
-	dif.Normalize();
+	dif.ANormalize();
 	float3 dir2(dif.cross(dir));
-	dir2.Normalize();
+	dir2.ANormalize();
 
 	unsigned char col[4];
 	float a=std::max(0.f,alpha-alphaDecay*gu-&gt;timeOffset)*255;

Modified: trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -60,7 +60,7 @@
 		float camDist=dif.Length();
 		dif/=camDist;
 		float3 dir1(dif.cross(speed));
-		dir1.Normalize();
+		dir1.ANormalize();
 		float3 dir2(dif.cross(dir1));
 
 		unsigned char color[4];

Modified: trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -55,13 +55,13 @@
 	col[3]=(unsigned char) (a*255);
 
 	float3 dif(p1-camera-&gt;pos);
-	dif.Normalize();
+	dif.ANormalize();
 	float3 dir1(dif.cross(v1));
-	dir1.Normalize();
+	dir1.ANormalize();
 	float3 dif2(p2-camera-&gt;pos);
-	dif2.Normalize();
+	dif2.ANormalize();
 	float3 dir2(dif2.cross(v2));
-	dir2.Normalize();
+	dir2.ANormalize();
 
 
 	float u = (ph-&gt;geosquaretex.xstart + ph-&gt;geosquaretex.xend) / 2;

Modified: trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -34,7 +34,7 @@
 				float speedlen = speed.Length();
 				float3 right(d.z, 0.0f, -d.x);
 				speed = d.cross(right);
-				speed.Normalize();
+				speed.ANormalize();
 				speed *= speedlen;
 			}
 		}

Modified: trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -68,12 +68,12 @@
 		return;
 
 	float3 dir=repulsed-&gt;pos-owner-&gt;pos;
-	dir.Normalize();
+	dir.ANormalize();
 
 	pos=repulsed-&gt;pos-dir*10+repulsed-&gt;speed*gu-&gt;timeOffset;
 
 	float3 dir1=dir.cross(UpVector);
-	dir1.Normalize();
+	dir1.ANormalize();
 	float3 dir2=dir1.cross(dir);
 
 	inArray=true;

Modified: trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -83,7 +83,7 @@
 				float camDist=dif.Length();
 				dif/=camDist;
 				float3 dir1(dif.cross(particles[i].speed));
-				dir1.Normalize();
+				dir1.ANormalize();
 				float3 dir2(dif.cross(dir1));
 
 				unsigned char color[4];

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -81,7 +81,7 @@
 		dirpos2=pos2+dir2*dist*0.33f;
 		float3 mp=(pos1+pos2)/2;
 		midpos=CalcBeizer(0.5f,pos1,dirpos1,dirpos2,pos2);
-		middir=(dir1+dir2).Normalize();
+		middir=(dir1+dir2).ANormalize();
 		drawSegmented=true;
 	}
 	SetRadius(pos1.distance(pos2));
@@ -103,13 +103,13 @@
 
 	if(drawTrail){
 		float3 dif(pos1-camera-&gt;pos2);
-		dif.Normalize();
+		dif.ANormalize();
 		float3 odir1(dif.cross(dir1));
-		odir1.Normalize();
+		odir1.ANormalize();
 		float3 dif2(pos2-camera-&gt;pos2);
-		dif2.Normalize();
+		dif2.ANormalize();
 		float3 odir2(dif2.cross(dir2));
-		odir2.Normalize();
+		odir2.ANormalize();
 
 		unsigned char col[4];
 		float a1=(1-float(age)/(lifeTime))*255;
@@ -138,9 +138,9 @@
 
 		if(drawSegmented){
 			float3 dif3(midpos-camera-&gt;pos2);
-			dif3.Normalize();
+			dif3.ANormalize();
 			float3 odir3(dif3.cross(middir));
-			odir3.Normalize();
+			odir3.ANormalize();
 			float size3=0.2f+((age+4)*(1.0f/lifeTime))*orgSize;
 
 			unsigned char col3[4];

Modified: trunk/rts/Sim/Units/UnitTracker.cpp
===================================================================
--- trunk/rts/Sim/Units/UnitTracker.cpp	2008-10-19 13:23:10 UTC (rev 6822)
+++ trunk/rts/Sim/Units/UnitTracker.cpp	2008-10-19 13:28:40 UTC (rev 6823)
@@ -292,14 +292,14 @@
 
 	trackPos += (modPlanePos - trackPos) * (1 - pow(0.95f, deltaTime));
 	trackDir += (u-&gt;frontdir - trackDir) * (1 - pow(0.90f, deltaTime));
-	trackDir.Normalize();
+	trackDir.ANormalize();
 
 	camera-&gt;pos=trackPos;
 
 	camera-&gt;forward = u-&gt;pos + (u-&gt;speed * gu-&gt;timeOffset) - camera-&gt;pos;
-	camera-&gt;forward.Normalize();
+	camera-&gt;forward.ANormalize();
 	camera-&gt;forward += trackDir;
-	camera-&gt;forward.Normalize();
+	camera-&gt;forward.ANormalize();
 	if (camHandler-&gt;GetCurrentControllerNum() == 0)
 	{
 		CFPSController&amp; fpsCamera = dynamic_cast&lt;CFPSController&amp;&gt;(camHandler-&gt;GetCurrentController());


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001591.html">[Taspring-linux-commit] r6822 - in branches/caiinterface:	AI/Interfaces AI/Interfaces/Java AI/Skirmish	AI/Skirmish/NullAI rts/ExternalAI rts/ExternalAI/Interface	rts/System
</A></li>
	<LI>Next message: <A HREF="001593.html">[Taspring-linux-commit] r6824 - in trunk: Documentation installer	installer/builddata/springcontent rts/Game tools/unitsync	tools/unitsync/test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1592">[ date ]</a>
              <a href="thread.html#1592">[ thread ]</a>
              <a href="subject.html#1592">[ subject ]</a>
              <a href="author.html#1592">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
