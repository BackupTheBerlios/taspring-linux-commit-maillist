<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6798 - in branches/caiinterface: .	AI/Interfaces AI/Interfaces/C AI/Skirmish/AAI	AI/Skirmish/KAIK AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI installer	installer/sections rts/ExternalAI rts/ExternalAI/Interface	rts/Game rts/Game/UI rts/Lua rts/Sim/Features	rts/Sim/MoveTypes rts/Sim/Units rts/Sim/Units/UnitTypes	rts/System tools/unitsync
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6798%20-%20in%20branches/caiinterface%3A%20.%0A%09AI/Interfaces%20AI/Interfaces/C%20AI/Skirmish/AAI%0A%09AI/Skirmish/KAIK%20AI/Skirmish/NullAI%0A%09AI/Skirmish/NullLegacyCppAI%20AI/Skirmish/RAI%20installer%0A%09installer/sections%20rts/ExternalAI%20rts/ExternalAI/Interface%0A%09rts/Game%20rts/Game/UI%20rts/Lua%20rts/Sim/Features%0A%09rts/Sim/MoveTypes%20rts/Sim/Units%20rts/Sim/Units/UnitTypes%0A%09rts/System%20tools/unitsync&In-Reply-To=%3C20081017220956.541D446ED%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001566.html">
   <LINK REL="Next"  HREF="001568.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6798 - in branches/caiinterface: .	AI/Interfaces AI/Interfaces/C AI/Skirmish/AAI	AI/Skirmish/KAIK AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI installer	installer/sections rts/ExternalAI rts/ExternalAI/Interface	rts/Game rts/Game/UI rts/Lua rts/Sim/Features	rts/Sim/MoveTypes rts/Sim/Units rts/Sim/Units/UnitTypes	rts/System tools/unitsync</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6798%20-%20in%20branches/caiinterface%3A%20.%0A%09AI/Interfaces%20AI/Interfaces/C%20AI/Skirmish/AAI%0A%09AI/Skirmish/KAIK%20AI/Skirmish/NullAI%0A%09AI/Skirmish/NullLegacyCppAI%20AI/Skirmish/RAI%20installer%0A%09installer/sections%20rts/ExternalAI%20rts/ExternalAI/Interface%0A%09rts/Game%20rts/Game/UI%20rts/Lua%20rts/Sim/Features%0A%09rts/Sim/MoveTypes%20rts/Sim/Units%20rts/Sim/Units/UnitTypes%0A%09rts/System%20tools/unitsync&In-Reply-To=%3C20081017220956.541D446ED%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6798 - in branches/caiinterface: .	AI/Interfaces AI/Interfaces/C AI/Skirmish/AAI	AI/Skirmish/KAIK AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI installer	installer/sections rts/ExternalAI rts/ExternalAI/Interface	rts/Game rts/Game/UI rts/Lua rts/Sim/Features	rts/Sim/MoveTypes rts/Sim/Units rts/Sim/Units/UnitTypes	rts/System tools/unitsync">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sat Oct 18 00:09:55 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001566.html">[Taspring-linux-commit] r6797 - trunk/rts/lib/gml
</A></li>
        <LI>Next message: <A HREF="001568.html">[Taspring-linux-commit] r6799 -	branches/caiinterface/AI/Skirmish/KAIK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1567">[ date ]</a>
              <a href="thread.html#1567">[ thread ]</a>
              <a href="subject.html#1567">[ subject ]</a>
              <a href="author.html#1567">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-10-18 00:09:54 +0200 (Sat, 18 Oct 2008)
New Revision: 6798

Added:
   branches/caiinterface/AI/Skirmish/NullAI/AIExport.c
Removed:
   branches/caiinterface/AI/Skirmish/NullAI/AIExport.cpp
Modified:
   branches/caiinterface/AI/Interfaces/C/Interface.cpp
   branches/caiinterface/AI/Interfaces/C/Interface.h
   branches/caiinterface/AI/Interfaces/CMakeLists.txt
   branches/caiinterface/AI/Skirmish/AAI/AAIExecute.cpp
   branches/caiinterface/AI/Skirmish/AAI/AAIMap.cpp
   branches/caiinterface/AI/Skirmish/AAI/AAISector.cpp
   branches/caiinterface/AI/Skirmish/KAIK/AIExport.h
   branches/caiinterface/AI/Skirmish/NullAI/AIExport.h
   branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.cpp
   branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h
   branches/caiinterface/AI/Skirmish/RAI/AIExport.cpp
   branches/caiinterface/AI/Skirmish/RAI/AIExport.h
   branches/caiinterface/CMakeLists.txt
   branches/caiinterface/installer/make_source_package.sh
   branches/caiinterface/installer/sections/tasclient.nsh
   branches/caiinterface/installer/springsettings.nsh
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp
   branches/caiinterface/rts/ExternalAI/GroupAILibrary.cpp
   branches/caiinterface/rts/ExternalAI/GroupAILibrary.h
   branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h
   branches/caiinterface/rts/ExternalAI/IGroupAILibrary.h
   branches/caiinterface/rts/ExternalAI/ISkirmishAILibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/AISCommands.h
   branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h
   branches/caiinterface/rts/ExternalAI/Interface/ELevelOfSupport.h
   branches/caiinterface/rts/ExternalAI/Interface/SAICallback.h
   branches/caiinterface/rts/ExternalAI/Interface/SAIFloat3.h
   branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp
   branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.cpp
   branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp
   branches/caiinterface/rts/ExternalAI/Interface/SInfo.h
   branches/caiinterface/rts/ExternalAI/Interface/SOption.h
   branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.cpp
   branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h
   branches/caiinterface/rts/ExternalAI/Interface/aidefines.h
   branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h
   branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h
   branches/caiinterface/rts/Game/Game.cpp
   branches/caiinterface/rts/Game/GameHelper.cpp
   branches/caiinterface/rts/Game/GameHelper.h
   branches/caiinterface/rts/Game/GameServer.cpp
   branches/caiinterface/rts/Game/GameVersion.cpp
   branches/caiinterface/rts/Game/UI/LuaUI.cpp
   branches/caiinterface/rts/Lua/LuaOpenGL.cpp
   branches/caiinterface/rts/Lua/LuaShaders.cpp
   branches/caiinterface/rts/Lua/LuaSyncedRead.cpp
   branches/caiinterface/rts/Lua/LuaUnsyncedRead.cpp
   branches/caiinterface/rts/Sim/Features/Feature.cpp
   branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.cpp
   branches/caiinterface/rts/Sim/MoveTypes/TAAirMoveType.cpp
   branches/caiinterface/rts/Sim/Units/Unit.cpp
   branches/caiinterface/rts/Sim/Units/UnitHandler.cpp
   branches/caiinterface/rts/Sim/Units/UnitLoader.cpp
   branches/caiinterface/rts/Sim/Units/UnitTypes/Builder.cpp
   branches/caiinterface/rts/System/exportdefines.h
   branches/caiinterface/tools/unitsync/CMakeLists.txt
Log:
one files change missing yes!
* reinterated trunk
* made the engine side C interface compileable with a C compiler
* added some things to easy up life for non native AI Interface libraries
* NullAI is notw a real C AI

Modified: branches/caiinterface/AI/Interfaces/C/Interface.cpp
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -254,29 +254,35 @@
 	// initialize the AI library
 	std::string funcName;
 
+/*
 	funcName = &quot;getInfo&quot;;
-	skirmishAILibrary-&gt;getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(struct InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	skirmishAILibrary-&gt;getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(int teamId, struct InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
 	if (skirmishAILibrary-&gt;getInfo == NULL) {
 		// do nothing: this is permitted, if the AI supplies info through an AIInfo.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
+*/
+	skirmishAILibrary-&gt;getInfo = NULL;
 
+/*
 	funcName = &quot;getOptions&quot;;
-	skirmishAILibrary-&gt;getOptions = (unsigned int (CALLING_CONV_FUNC_POINTER *)(Option[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
+	skirmishAILibrary-&gt;getOptions = (unsigned int (CALLING_CONV_FUNC_POINTER *)(int teamId, Option[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
 	if (skirmishAILibrary-&gt;getOptions == NULL) {
 		// do nothing: this is permitted, if the AI supplies options through an AIOptions.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
+*/
+	skirmishAILibrary-&gt;getOptions = NULL;
 
 	funcName = &quot;getLevelOfSupportFor&quot;;
-	skirmishAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
+	skirmishAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(int teamId, const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
 	if (skirmishAILibrary-&gt;getLevelOfSupportFor == NULL) {
 		// do nothing: it is permitted that an AI does not export this function
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
 	
 	funcName = &quot;init&quot;;
-	skirmishAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	skirmishAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int, const struct InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
 	if (skirmishAILibrary-&gt;init == NULL) {
 		// do nothing: it is permitted that an AI does not export this function,
 		// as it can still use EVENT_INIT instead
@@ -317,29 +323,35 @@
 	// initialize the AI library
 	std::string funcName;
 	
+/*
 	funcName = &quot;getInfo&quot;;
 	groupAILibrary-&gt;getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
 	if (groupAILibrary-&gt;getInfo == NULL) {
 		// do nothing: this is permitted, if the AI supplies info through an AIInfo.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
+*/
+	groupAILibrary-&gt;getInfo = NULL;
 	
-	funcName = &quot;getLevelOfSupportFor&quot;;
-	groupAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (groupAILibrary-&gt;getLevelOfSupportFor == NULL) {
-		// do nothing: it is permitted that an AI does not export this function
-		//reportInterfaceFunctionError(libFilePath, funcName);
-	}
-	
+/*
 	funcName = &quot;getOptions&quot;;
 	groupAILibrary-&gt;getOptions = (unsigned int (CALLING_CONV_FUNC_POINTER *)(Option[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
 	if (groupAILibrary-&gt;getOptions == NULL) {
 		// do nothing: this is permitted, if the AI supplies options through an AIOptions.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
+*/
+	groupAILibrary-&gt;getOptions = NULL;
 	
+	funcName = &quot;getLevelOfSupportFor&quot;;
+	groupAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId, const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (groupAILibrary-&gt;getLevelOfSupportFor == NULL) {
+		// do nothing: it is permitted that an AI does not export this function
+		//reportInterfaceFunctionError(libFilePath, funcName);
+	}
+	
 	funcName = &quot;init&quot;;
-	groupAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int, int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	groupAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId, const struct InfoItem info[], unsigned int maxInfoItems)) sharedLib-&gt;FindAddress(funcName.c_str());
 	if (groupAILibrary-&gt;init == NULL) {
 		// do nothing: it is permitted that an AI does not export this function,
 		// as it can still use EVENT_INIT instead
@@ -347,7 +359,7 @@
 	}
 	
 	funcName = &quot;release&quot;;
-	groupAILibrary-&gt;release = (int (CALLING_CONV_FUNC_POINTER *)(int, int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	groupAILibrary-&gt;release = (int (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId)) sharedLib-&gt;FindAddress(funcName.c_str());
 	if (groupAILibrary-&gt;release == NULL) {
 		// do nothing: it is permitted that an AI does not export this function,
 		// as it can still use EVENT_RELEASE instead
@@ -355,7 +367,7 @@
 	}
 	
 	funcName = &quot;handleEvent&quot;;
-	groupAILibrary-&gt;handleEvent = (int (CALLING_CONV_FUNC_POINTER *)(int, int, int, const void*)) sharedLib-&gt;FindAddress(funcName.c_str());
+	groupAILibrary-&gt;handleEvent = (int (CALLING_CONV_FUNC_POINTER *)(int teamId, int groupId, int topic, const void* data)) sharedLib-&gt;FindAddress(funcName.c_str());
 	if (groupAILibrary-&gt;handleEvent == NULL) {
 		reportInterfaceFunctionError(libFilePath, funcName);
 	}
@@ -538,6 +550,7 @@
 	return path;
 }
 
+/*
 SSAISpecifier CInterface::ExtractSpecifier(const SSAILibrary&amp; skirmishAILib) {
 	
 	SSAISpecifier skirmishAISpecifier;
@@ -558,7 +571,9 @@
 	
 	return skirmishAISpecifier;
 }
+*/
 
+/*
 SGAISpecifier CInterface::ExtractSpecifier(const SGAILibrary&amp; groupAILib) {
 	
 	SGAISpecifier groupAISpecifier;
@@ -579,6 +594,7 @@
 	
 	return groupAISpecifier;
 }
+*/
 
 bool CInterface::FitsThisInterface(const std::string&amp; requestedShortName,
 		const std::string&amp; requestedVersion) {

Modified: branches/caiinterface/AI/Interfaces/C/Interface.h
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Interfaces/C/Interface.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -92,8 +92,8 @@
 	 * @return	true if the directory was created or already existed
 	 */
 	static bool MakeDirRecursive(const std::string&amp; dirPath);
-	static SSAISpecifier ExtractSpecifier(const SSAILibrary&amp; skirmishAILib);
-	static SGAISpecifier ExtractSpecifier(const SGAILibrary&amp; groupAILib);
+//	static SSAISpecifier ExtractSpecifier(const SSAILibrary&amp; skirmishAILib);
+//	static SGAISpecifier ExtractSpecifier(const SGAILibrary&amp; groupAILib);
 
 	bool FitsThisInterface(const std::string&amp; requestedShortName,
 			const std::string&amp; requestedVersion);

Modified: branches/caiinterface/AI/Interfaces/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-10-17 22:09:54 UTC (rev 6798)
@@ -32,3 +32,31 @@
 	install (TARGETS ${C_AIINTERFACE_TARGET} DESTINATION ${AI_INTERFACES_LIBS})
 endif (EXISTS ${C_AIINTERFACE_SRC})
 
+
+# Java AI Interface
+IF (MINGW)
+	set (JAVA_FOUND TRUE)
+ELSE (MINGW)
+	FIND_PACKAGE(JNI)
+	if (JAVA_INCLUDE_PATH)
+		include_directories(${JAVA_INCLUDE_PATH} ${JAVA_INCLUDE_PATH2} ${JNI_INCLUDE_DIRS})
+		set (JAVA_FOUND TRUE)
+	else (JAVA_INCLUDE_PATH)
+		message (&quot;No Java includes found -&gt; Java AI Interface will not be built&quot;)
+	endif (JAVA_INCLUDE_PATH)
+ENDIF (MINGW)
+set(Java_AIINTERFACE_SRC &quot;${AI_INTERFACES_SRC}/Java&quot;)
+if (JAVA_FOUND AND EXISTS ${Java_AIINTERFACE_SRC})
+	set(Java_AIINTERFACE_VERS &quot;UNKNOWN_VERSION&quot;)
+	if (EXISTS ${Java_AIINTERFACE_SRC}/VERSION)
+		file(STRINGS &quot;${Java_AIINTERFACE_SRC}/VERSION&quot; Java_AIINTERFACE_VERS LIMIT_COUNT 1)
+	endif (EXISTS ${Java_AIINTERFACE_SRC}/VERSION)
+	set(Java_AIINTERFACE_TARGET &quot;Java-${Java_AIINTERFACE_VERS}&quot;)
+	message(&quot;${Java_AIINTERFACE_VERS}\t(Java AI Interface Version)&quot;)
+
+	aux_source_directory(${Java_AIINTERFACE_SRC} javaAIInterface)
+	add_library(${Java_AIINTERFACE_TARGET} MODULE ${javaAIInterface} ${aienv})
+	install (FILES ${Java_AIINTERFACE_SRC}/InterfaceInfo.lua DESTINATION ${AI_INTERFACES_DATA}/Java/${Java_AIINTERFACE_VERS})
+	install (TARGETS ${Java_AIINTERFACE_TARGET} DESTINATION ${AI_INTERFACES_LIBS})
+endif (JAVA_FOUND AND EEXISTS ${Java_AIINTERFACE_SRC})
+

Modified: branches/caiinterface/AI/Skirmish/AAI/AAIExecute.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/AAIExecute.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/AAI/AAIExecute.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -255,8 +255,10 @@
 	// determine continent if necessary
 	int continent_id = -1;
 
-	if(bt-&gt;units_static[def_id].movement_type &amp; MOVE_TYPE_CONTINENT_BOUND) 
-		continent_id = map-&gt;GetContinentID(&amp;cb-&gt;GetUnitPos(unit_id));
+	if(bt-&gt;units_static[def_id].movement_type &amp; MOVE_TYPE_CONTINENT_BOUND) {
+		float3 unitPos = cb-&gt;GetUnitPos(unit_id);
+		continent_id = map-&gt;GetContinentID(&amp;unitPos);
+	}
 
 	// try to add unit to an existing group 
 	for(list&lt;AAIGroup*&gt;::iterator group = ai-&gt;group_list[category].begin(); group != ai-&gt;group_list[category].end(); ++group)
@@ -272,8 +274,10 @@
 	// -&gt; create new one
 
 	// get continent for ground assault units, even if they are amphibious (otherwise non amphib ground units will be added no matter which continent they are on)
-	if(category == GROUND_ASSAULT  &amp;&amp; continent_id == 1)
-		continent_id = map-&gt;GetContinentID(&amp;cb-&gt;GetUnitPos(unit_id));
+	if(category == GROUND_ASSAULT  &amp;&amp; continent_id == 1) {
+		float3 unitPos = cb-&gt;GetUnitPos(unit_id);
+		continent_id = map-&gt;GetContinentID(&amp;unitPos);
+	}
 
 	AAIGroup *new_group = new AAIGroup(ai, bt-&gt;unitList[def_id-1], unit_type, continent_id);
 
@@ -3786,4 +3790,4 @@
 	//	fprintf(ai-&gt;file, &quot;%i th order has been given by %s in frame %i\n&quot;, issued_orders, owner,  cb-&gt;GetCurrentFrame());
 
 	cb-&gt;GiveOrder(unit, c);
-}
\ No newline at end of file
+}

Modified: branches/caiinterface/AI/Skirmish/AAI/AAIMap.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/AAIMap.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/AAI/AAIMap.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -15,28 +15,28 @@
 // all the static vars
 int AAIMap::aai_instances = 0;
 int AAIMap::xSize;
-int AAIMap::ySize;	
+int AAIMap::ySize;
 int AAIMap::xMapSize;
-int AAIMap::yMapSize;				
+int AAIMap::yMapSize;
 int AAIMap::xDefMapSize;
 int AAIMap::yDefMapSize;
 int AAIMap::xContMapSize;
-int AAIMap::yContMapSize;	
+int AAIMap::yContMapSize;
 int AAIMap::xSectors;
-int AAIMap::ySectors;				
+int AAIMap::ySectors;
 int AAIMap::xSectorSize; 
-int AAIMap::ySectorSize;		
+int AAIMap::ySectorSize;
 int AAIMap::xSectorSizeMap; 
 int AAIMap::ySectorSizeMap;
 
 list&lt;AAIMetalSpot&gt;  AAIMap::metal_spots;
 
 bool AAIMap::metalMap;
-MapType AAIMap::mapType;	
+MapType AAIMap::mapType;
 
 vector&lt; vector&lt;int&gt; &gt; AAIMap::team_sector_map;
-vector&lt;int&gt; AAIMap::buildmap;	
-vector&lt;int&gt; AAIMap::blockmap;	
+vector&lt;int&gt; AAIMap::buildmap;
+vector&lt;int&gt; AAIMap::blockmap;
 vector&lt;float&gt; AAIMap::plateau_map;
 vector&lt;int&gt; AAIMap::continent_map;	
 
@@ -2665,4 +2665,4 @@
 		y = yContMapSize - 1;
 
 	return continent_map[y * xContMapSize + x];
-}
\ No newline at end of file
+}

Modified: branches/caiinterface/AI/Skirmish/AAI/AAISector.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/AAISector.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/AAI/AAISector.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -16,9 +16,9 @@
 }
 
 AAISector::~AAISector(void)
-{	
+{
 	defences.clear();
-	
+
 	attacked_by_this_game.clear(); 
 	attacked_by_learned.clear(); 
 
@@ -52,14 +52,14 @@
 	distance_to_base = -1;
 	last_scout = 1;
 	rally_points = 0;
-	
+
 	// nothing sighted in that sector
 	enemy_structures = 0;
 	own_structures = 0;
 	allied_structures = 0;
 	threat = 0;
 	failed_defences = 0;
-	
+
 	int categories = ai-&gt;bt-&gt;assault_categories.size();
 
 	combats_learned.resize(categories, 0);
@@ -770,4 +770,4 @@
 	}
 
 	*pos = ZeroVector;
-}
\ No newline at end of file
+}

Modified: branches/caiinterface/AI/Skirmish/KAIK/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/KAIK/AIExport.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/KAIK/AIExport.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -39,15 +39,17 @@
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
-Export(enum LevelOfSupport) getLevelOfSupportFor(
+Export(unsigned int) getInfo(int teamId,
+		struct InfoItem info[], unsigned int maxInfoItems);
+Export(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 		const char* engineVersionString, int engineVersionNumber,
 		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-Export(unsigned int) getOptions(struct Option options[],
-		unsigned int maxOptions);
+Export(unsigned int) getOptions(int teamId,
+		struct Option options[], unsigned int maxOptions);
 
 // team instance functions
-Export(int) init(int teamId);
+Export(int) init(int teamId,
+		const struct InfoItem info[], unsigned int numInfoItems);
 Export(int) release(int teamId);
 Export(int) handleEvent(int teamId, int topic, const void* data);
 

Copied: branches/caiinterface/AI/Skirmish/NullAI/AIExport.c (from rev 6697, branches/caiinterface/AI/Skirmish/NullAI/AIExport.cpp)
===================================================================
--- branches/caiinterface/AI/Skirmish/NullAI/AIExport.c	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/NullAI/AIExport.c	2008-10-17 22:09:54 UTC (rev 6798)
@@ -0,0 +1,95 @@
+/*
+    Copyright 2008  Nicolas Wu
+    
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+	
+	@author Nicolas Wu
+	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+*/
+
+/*
+If we do not have an init() method, then we would instead pass
+an event InitEvent to handleEvent. However, we would have to make
+handleEvent have to wait for an InitEvent as a special case, since
+the team in question would not yet exist. 
+
+Therefore, the handleEvent code would look like this:
+[code]
+Export(int) handleEvent(int teamId, int topic, const void* data) {
+    if (topic == INIT_EVENT) {
+        myAIs[teamId] = CAIObject();
+    }
+    if (myAIs.count(teamId) &gt; 0){
+        // allow the AI instance to handle the event.
+        return myAIs[teamId].handleEvent(topic, data);
+    }
+    // no AI for that team, so return error.
+    else return -1;
+}
+[/code]
+Advantages:
+* All events to AI go through handleEvent.
+* People don't get confused and start adding bananaSplitz() functions.
+
+Disadvantages:
+* We need to check for INIT_EVENT before *every message*.
+* These events will happen only once per game -- after that the check becomes a necessary waste of time.
+* Handling events is no longer about getting the right object to deal with an event, it also includes initialising object properly.
+
+I understand that we want to keep the interface simple. In fact,
+I think we should keep it as minimal as possible, and ideally everything
+would go through handleEvent. Practically though, it does not make sense
+to do this: we'll be wasting our own time for no good reason in the
+case of initialisation. 
+
+The (in my opinion much cleaner) alternative is the one I've implemented.
+Advantages:
+* One function that initialises a team before everything is passed to handlEvent
+* No redundant if statements.
+* Simple design.
+
+Disadvantage:
+* People might start adding other functions to the interface.
+
+I don't think that the disadvantage is a real one: it's pretty standard to 
+see initialisation as a special case. It's pretty clear that everything
+else goes through handleEvent. 
+
+The advantage is clear: a more efficient, simpler design. Of course, you could
+argue that the efficiency is nominal, one extra if per event is very little cost,
+and granted, that's true; but this doesn't change the fact that we're checking
+for a special case that we know only happens once at the beginning of the game, before
+every single event after.
+
+Of course, we still need an EVENT_INIT, since initialising the existance of a team
+member is not the same as initialising its state.
+
+You might also argue that we do this check in the handleEvent switch within each
+team. This is true, although the difference there is that a switch is translated
+to address lookups and so there is no increase in cost if there are more switch
+cases.
+
+The same issues and reasonins described here for init() and EVENT_INIT applies
+to release() and EVENT_RELEASE.
+*/
+
+#include &quot;AIExport.h&quot;
+
+Export(int) handleEvent(int teamId, int topic, const void* data) {
+	
+	// TODO: do something
+	
+	// signal: ok
+	return 0;
+}


Property changes on: branches/caiinterface/AI/Skirmish/NullAI/AIExport.c
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Deleted: branches/caiinterface/AI/Skirmish/NullAI/AIExport.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/NullAI/AIExport.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/NullAI/AIExport.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -1,95 +0,0 @@
-/*
-    Copyright 2008  Nicolas Wu
-    
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
-
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-	
-	@author Nicolas Wu
-	@author Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
-*/
-
-/*
-If we do not have an init() method, then we would instead pass
-an event InitEvent to handleEvent. However, we would have to make
-handleEvent have to wait for an InitEvent as a special case, since
-the team in question would not yet exist. 
-
-Therefore, the handleEvent code would look like this:
-[code]
-Export(int) handleEvent(int teamId, int topic, const void* data) {
-    if (topic == INIT_EVENT) {
-        myAIs[teamId] = CAIObject();
-    }
-    if (myAIs.count(teamId) &gt; 0){
-        // allow the AI instance to handle the event.
-        return myAIs[teamId].handleEvent(topic, data);
-    }
-    // no AI for that team, so return error.
-    else return -1;
-}
-[/code]
-Advantages:
-* All events to AI go through handleEvent.
-* People don't get confused and start adding bananaSplitz() functions.
-
-Disadvantages:
-* We need to check for INIT_EVENT before *every message*.
-* These events will happen only once per game -- after that the check becomes a necessary waste of time.
-* Handling events is no longer about getting the right object to deal with an event, it also includes initialising object properly.
-
-I understand that we want to keep the interface simple. In fact,
-I think we should keep it as minimal as possible, and ideally everything
-would go through handleEvent. Practically though, it does not make sense
-to do this: we'll be wasting our own time for no good reason in the
-case of initialisation. 
-
-The (in my opinion much cleaner) alternative is the one I've implemented.
-Advantages:
-* One function that initialises a team before everything is passed to handlEvent
-* No redundant if statements.
-* Simple design.
-
-Disadvantage:
-* People might start adding other functions to the interface.
-
-I don't think that the disadvantage is a real one: it's pretty standard to 
-see initialisation as a special case. It's pretty clear that everything
-else goes through handleEvent. 
-
-The advantage is clear: a more efficient, simpler design. Of course, you could
-argue that the efficiency is nominal, one extra if per event is very little cost,
-and granted, that's true; but this doesn't change the fact that we're checking
-for a special case that we know only happens once at the beginning of the game, before
-every single event after.
-
-Of course, we still need an EVENT_INIT, since initialising the existance of a team
-member is not the same as initialising its state.
-
-You might also argue that we do this check in the handleEvent switch within each
-team. This is true, although the difference there is that a switch is translated
-to address lookups and so there is no increase in cost if there are more switch
-cases.
-
-The same issues and reasonins described here for init() and EVENT_INIT applies
-to release() and EVENT_RELEASE.
-*/
-
-#include &quot;AIExport.h&quot;
-
-Export(int) handleEvent(int teamId, int topic, const void* data) {
-	
-	// TODO: do something
-	
-	// signal: ok
-	return 0;
-}

Modified: branches/caiinterface/AI/Skirmish/NullAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/NullAI/AIExport.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/NullAI/AIExport.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -42,14 +42,17 @@
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-//Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
-//Export(enum LevelOfSupport) getLevelOfSupportFor(
+//Export(unsigned int) getInfo(int teamId,
+//		struct InfoItem info[], unsigned int maxInfoItems);
+//Export(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 //		const char* engineVersionString, int engineVersionNumber,
 //		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-//Export(unsigned int) getOptions(struct Option options[], unsigned int maxOptions);
+//Export(unsigned int) getOptions(int teamId,
+//		struct Option options[], unsigned int maxOptions);
 
 // team instance functions
-//Export(int) init(int teamId);
+//Export(int) init(int teamId,
+//		const struct InfoItem info[], unsigned int numInfoItems);
 //Export(int) release(int teamId);
 Export(int) handleEvent(int teamId, int topic, const void* data);
 

Modified: branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -34,7 +34,8 @@
 std::map&lt;int, CAIGlobalAI*&gt; myAIs; // teamId -&gt; AI map
 
 
-Export(int) init(int teamId) {
+Export(int) init(int teamId,
+		const struct InfoItem info[], unsigned int numInfoItems) {
 	
     if (myAIs.count(teamId) &gt; 0) {
 		// the map already has an AI for this team.

Modified: branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -39,14 +39,17 @@
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-//Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
-//Export(enum LevelOfSupport) getLevelOfSupportFor(
+//Export(unsigned int) getInfo(int teamId,
+//		struct InfoItem info[], unsigned int maxInfoItems);
+//Export(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 //		const char* engineVersionString, int engineVersionNumber,
 //		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-//Export(unsigned int) getOptions(struct Option options[], unsigned int maxOptions);
+//Export(unsigned int) getOptions(int teamId,
+//		struct Option options[], unsigned int maxOptions);
 
 // team instance functions
-Export(int) init(int teamId);
+Export(int) init(int teamId,
+		const struct InfoItem info[], unsigned int numInfoItems);
 Export(int) release(int teamId);
 Export(int) handleEvent(int teamId, int topic, const void* data);
 

Modified: branches/caiinterface/AI/Skirmish/RAI/AIExport.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/RAI/AIExport.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/RAI/AIExport.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -35,7 +35,8 @@
 
 std::map&lt;int, CAIGlobalAI*&gt; myAIs; // teamId -&gt; AI map
 
-Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems) {
+Export(unsigned int) getInfo(int teamId,
+		struct InfoItem info[], unsigned int maxInfoItems) {
 
 	unsigned int i = 0;
 
@@ -74,7 +75,7 @@
 	return i;
 }
 
-Export(enum LevelOfSupport) getLevelOfSupportFor(
+Export(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 		const char* engineVersionString, int engineVersionNumber,
 		const char* aiInterfaceShortName, const char* aiInterfaceVersion) {
 
@@ -86,11 +87,13 @@
 	return LOS_None;
 }
 
-Export(unsigned int) getOptions(struct Option options[], unsigned int max) {
+Export(unsigned int) getOptions(int teamId,
+		struct Option options[], unsigned int maxOptions) {
 	return 0;
 }
 
-Export(int) init(int teamId) {
+Export(int) init(int teamId,
+		const struct InfoItem info[], unsigned int numInfoItems) {
 
 	if (myAIs.count(teamId) &gt; 0) {
 		// the map already has an AI for this team.

Modified: branches/caiinterface/AI/Skirmish/RAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/RAI/AIExport.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/AI/Skirmish/RAI/AIExport.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -39,14 +39,17 @@
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
-Export(enum LevelOfSupport) getLevelOfSupportFor(
+Export(unsigned int) getInfo(int teamId,
+		struct InfoItem info[], unsigned int maxInfoItems);
+Export(enum LevelOfSupport) getLevelOfSupportFor(int teamId,
 		const char* engineVersionString, int engineVersionNumber,
 		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-Export(unsigned int) getOptions(struct Option options[], unsigned int maxOptions);
+Export(unsigned int) getOptions(int teamId,
+		struct Option options[], unsigned int maxOptions);
 
 // team instance functions
-Export(int) init(int teamId);
+Export(int) init(int teamId,
+		const struct InfoItem info[], unsigned int numInfoItems);
 Export(int) release(int teamId);
 Export(int) handleEvent(int teamId, int topic, const void* data);
 

Modified: branches/caiinterface/CMakeLists.txt
===================================================================
--- branches/caiinterface/CMakeLists.txt	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/CMakeLists.txt	2008-10-17 22:09:54 UTC (rev 6798)
@@ -53,8 +53,8 @@
 	set (Boost_REGEX_LIBRARY boost_regex-mt)
 	set (Boost_THREAD_LIBRARY boost_thread-mt)
 	set (Boost_FILESYSTEM_LIBRARY boost_filesystem-mt)
-	set (IL_ILU_LIBRARY ILU)
-	set (DEVIL_LIBRARIES &quot;devil ${IL_ILU_LIBRARY}&quot;)
+	set (DEVIL_ILU_LIBRARY ilu)
+	set (DEVIL_LIBRARIES &quot;devil ${DEVIL_ILU_LIBRARY}&quot;)
 else (MINGW)
 	# AIs need it
 	FIND_PACKAGE(SDL REQUIRED)

Modified: branches/caiinterface/installer/make_source_package.sh
===================================================================
--- branches/caiinterface/installer/make_source_package.sh	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/installer/make_source_package.sh	2008-10-17 22:09:54 UTC (rev 6798)
@@ -23,7 +23,7 @@
 done
 
 # This regex matches regexes in buildbot etc.
-version=`grep -o -E '0\.[0-9]{2,2}[b.][0-9]\+?(svn[0-9]+)?' rts/Game/GameVersion.cpp`
+version=`grep -E 'VERSION_STRING ' rts/Game/GameVersion.cpp | grep -o -E '0\.[0-9]{2,2}[b.][0-9]\+?(svn[0-9]+)?'`
 
 # Each one of these that is set is build when running this script.
 # .tar.bz2 and .tar.gz are built with linux (LF) line endings.

Modified: branches/caiinterface/installer/sections/tasclient.nsh
===================================================================
--- branches/caiinterface/installer/sections/tasclient.nsh	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/installer/sections/tasclient.nsh	2008-10-17 22:09:54 UTC (rev 6798)
@@ -22,6 +22,9 @@
   File &quot;..\external\TASClient\groups.ini&quot;
   File &quot;..\external\TASClient\tips.txt&quot;
 
+  SetOutPath &quot;$INSTDIR\lobby\python&quot;
+  File /r /x .svn &quot;..\external\TASClient\python\*.*&quot;
+
   Call GetDotNETVersion
   Pop $0
   StrCpy $0 $0 &quot;&quot; 1 ; Remove the starting &quot;v&quot; so $0 contains only the version number.

Modified: branches/caiinterface/installer/springsettings.nsh
===================================================================
--- branches/caiinterface/installer/springsettings.nsh	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/installer/springsettings.nsh	2008-10-17 22:09:54 UTC (rev 6798)
@@ -1,10 +1,10 @@
 !ifdef TEST_BUILD
  !define PRODUCT_NAME &quot;Spring - Test Build&quot;
- !define PRODUCT_VERSION &quot;0.77b3+svn${REVISION}&quot;
+ !define PRODUCT_VERSION &quot;0.77b5+svn${REVISION}&quot;
  !define SP_BASENAME &quot;spring_${PRODUCT_VERSION}&quot;
 !else
  !define PRODUCT_NAME &quot;Spring&quot;
- !define PRODUCT_VERSION &quot;0.77b3&quot;
+ !define PRODUCT_VERSION &quot;0.77b5&quot;
  !define SP_BASENAME &quot;spring_${PRODUCT_VERSION}&quot;
 !endif
 

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -181,13 +181,14 @@
 	
 	const unsigned int MAX_INFOS = 128;
 	InfoItem info[MAX_INFOS];
-	unsigned int num = aiInfo-&gt;GetInfoCReference(info, MAX_INFOS);
+	unsigned int numInfoItems = aiInfo-&gt;GetInfoCReference(info, MAX_INFOS);
 	
 	SSAISpecifier sAISpecifier = aiInfo-&gt;GetSpecifier();
 	if (skirmishAILoadCount[sAISpecifier] == 0) {
 		//const SSAILibrary* sLib = sAIInterfaceLibrary.loadSkirmishAILibrary(&amp;sAISpecifier);
-		const SSAILibrary* sLib = sAIInterfaceLibrary.loadSkirmishAILibrary(info, num);
-		ai = new CSkirmishAILibrary(*sLib, sAISpecifier);
+		const SSAILibrary* sLib =
+				sAIInterfaceLibrary.loadSkirmishAILibrary(info, numInfoItems);
+		ai = new CSkirmishAILibrary(*sLib, sAISpecifier, info, numInfoItems);
 		loadedSkirmishAILibraries[sAISpecifier] = ai;
 	} else {
 		ai = loadedSkirmishAILibraries[sAISpecifier];

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibrary.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibrary.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -30,18 +30,20 @@
 	return specifier;
 }
 
-LevelOfSupport CGroupAILibrary::GetLevelOfSupportFor(
+LevelOfSupport CGroupAILibrary::GetLevelOfSupportFor(int teamId, int groupId,
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 		const SAIInterfaceSpecifier&amp; interfaceSpecifier) const {
 	
 	if (sGAI.getLevelOfSupportFor != NULL) {
-		return sGAI.getLevelOfSupportFor(engineVersionString.c_str(), engineVersionNumber,
-			interfaceSpecifier.shortName, interfaceSpecifier.version);
+		return sGAI.getLevelOfSupportFor(teamId, groupId,
+				engineVersionString.c_str(), engineVersionNumber,
+				interfaceSpecifier.shortName, interfaceSpecifier.version);
 	} else {
 		return LOS_Unknown;
 	}
 }
 	
+/*
 std::map&lt;std::string, InfoItem&gt; CGroupAILibrary::GetInfo() const {
 	
 	std::map&lt;std::string, InfoItem&gt; info;
@@ -75,12 +77,14 @@
 
 	return ops;
 }
+*/
 
 
-void CGroupAILibrary::Init(int teamId, int groupId) const {
+void CGroupAILibrary::Init(int teamId, int groupId, const InfoItem info[],
+		unsigned int numInfoItems) const {
 	
 	if (sGAI.init != NULL) {
-		int error = sGAI.init(teamId, groupId);
+		int error = sGAI.init(teamId, groupId, info, numInfoItems);
 		if (error != 0) {
 			// init failed
 			logOutput.Print(&quot;Failed to initialize an AI for team %d and group %d, error: %d&quot;, teamId, groupId, error);

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibrary.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibrary.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -33,15 +33,16 @@
 	 * Level of Support for a specific engine version and ai interface.
 	 * @return see enum LevelOfSupport (higher values could be used optionally)
 	 */
-	virtual LevelOfSupport GetLevelOfSupportFor(
+	virtual LevelOfSupport GetLevelOfSupportFor(int teamId, int groupId,
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 			const SAIInterfaceSpecifier&amp; interfaceSpecifier) const;
 	
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const;
-	virtual std::vector&lt;Option&gt; GetOptions() const;
+//    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const;
+//	virtual std::vector&lt;Option&gt; GetOptions() const;
 	
 	
-    virtual void Init(int teamId, int groupId) const;
+    virtual void Init(int teamId, int groupId, const InfoItem info[],
+			unsigned int numInfoItems) const;
     virtual void Release(int teamId, int groupId) const;
     virtual int HandleEvent(int teamId, int groupId, int topic, const void* data) const;
 	

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -25,6 +25,7 @@
 #include &quot;Platform/errorhandler.h&quot;
 #include &quot;FileSystem/VFSModes.h&quot;
 
+/*
 CGroupAILibraryInfo::CGroupAILibraryInfo(const IGroupAILibrary&amp; ai,
 		const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
 	info = ai.GetInfo();
@@ -32,6 +33,7 @@
 	//levelOfSupport = ai.GetLevelOfSupportFor(std::string(ENGINE_VERSION_STRING),
 	//		ENGINE_VERSION_NUMBER, interfaceSpecifier);
 }
+*/
 
 CGroupAILibraryInfo::CGroupAILibraryInfo(const CGroupAILibraryInfo&amp; aiInfo) {
 	info = std::map&lt;std::string, InfoItem&gt;(

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -33,8 +33,8 @@
 
 class CGroupAILibraryInfo {
 public:
-	CGroupAILibraryInfo(const IGroupAILibrary&amp; ai,
-			const SAIInterfaceSpecifier&amp; interfaceSpecifier);
+//	CGroupAILibraryInfo(const IGroupAILibrary&amp; ai,
+//			const SAIInterfaceSpecifier&amp; interfaceSpecifier);
 	CGroupAILibraryInfo(const CGroupAILibraryInfo&amp; aiInfo);
 	CGroupAILibraryInfo(const std::string&amp; aiInfoFile,
 			const std::string&amp; aiOptionFile);

Modified: branches/caiinterface/rts/ExternalAI/IGroupAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/IGroupAILibrary.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/IGroupAILibrary.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -37,15 +37,16 @@
 	 * Level of Support for a specific engine version and AI interface.
 	 * @return see enum LevelOfSupport (higher values could be used optionally)
 	 */
-	virtual LevelOfSupport GetLevelOfSupportFor(
+	virtual LevelOfSupport GetLevelOfSupportFor(int teamId, int groupId,
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 			const SAIInterfaceSpecifier&amp; interfaceSpecifier) const = 0;
 	
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const = 0;
-	virtual std::vector&lt;Option&gt; GetOptions() const = 0;
+//    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const = 0;
+//	virtual std::vector&lt;Option&gt; GetOptions() const = 0;
 	
 	
-    virtual void Init(int teamId, int groupId) const = 0;
+    virtual void Init(int teamId, int groupId, const InfoItem info[],
+			unsigned int numInfoItems) const = 0;
     virtual void Release(int teamId, int groupId) const = 0;
     virtual int HandleEvent(int teamId, int groupId, int topic, const void* data) const = 0;
 };

Modified: branches/caiinterface/rts/ExternalAI/ISkirmishAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/ISkirmishAILibrary.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/ISkirmishAILibrary.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -37,12 +37,12 @@
 	 * Level of Support for a specific engine version and AI interface.
 	 * @return see enum LevelOfSupport (higher values could be used optionally)
 	 */
-	virtual LevelOfSupport GetLevelOfSupportFor(
+	virtual LevelOfSupport GetLevelOfSupportFor(int teamId,
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 			const SAIInterfaceSpecifier&amp; interfaceSpecifier) const = 0;
 	
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const = 0;
-	virtual std::vector&lt;Option&gt; GetOptions() const = 0;
+//    virtual std::map&lt;std::string, InfoItem&gt; GetInfo(int teamId) const = 0;
+//	virtual std::vector&lt;Option&gt; GetOptions(int teamId) const = 0;
 	
 	
     virtual void Init(int teamId) const = 0;

Modified: branches/caiinterface/rts/ExternalAI/Interface/AISCommands.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/AISCommands.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/AISCommands.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -772,13 +772,17 @@
 	int numParams;
 };
 
-
 /**
  * @brief Sets default values
  */
 void initSUnitCommand(void* sUnitCommand);
 
 #ifdef	__cplusplus
+}	// extern &quot;C&quot;
+#endif
+
+
+#ifdef	__cplusplus
 struct Command;
 
 // legacy support functions
@@ -794,11 +798,8 @@
  * @brief creates - with new - an engine C++ Command struct
  */
 Command* newCommand(void* sUnitCommandData, int sCommandId);
-#endif	/* __cplusplus */
+#endif	// __cplusplus
 
-#ifdef	__cplusplus
-}
-#endif
 
-#endif	/* _AISCOMMANDS_H */
+#endif	// _AISCOMMANDS_H
 

Modified: branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/AISEvents.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -15,9 +15,13 @@
 	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#ifndef AISEVENTS_H
-#define AISEVENTS_H
+#ifndef _AISEVENTS_H
+#define _AISEVENTS_H
 
+#ifdef	__cplusplus
+extern &quot;C&quot; {
+#endif
+
 #include &quot;SAIFloat3.h&quot;
 #include &quot;SAICallback.h&quot;
 
@@ -151,4 +155,8 @@
 	float strength;
 };
 
-#endif /*AISEVENTS_H*/
+#ifdef	__cplusplus
+}	// extern &quot;C&quot;
+#endif
+
+#endif	// _AISEVENTS_H

Modified: branches/caiinterface/rts/ExternalAI/Interface/ELevelOfSupport.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/ELevelOfSupport.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/ELevelOfSupport.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -34,8 +34,8 @@
 };
 
 #ifdef	__cplusplus
-}
+}	// extern &quot;C&quot;
 #endif
 
-#endif	/* _ELEVELOFSUPPORT_H */
+#endif	// _ELEVELOFSUPPORT_H
 

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAICallback.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAICallback.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAICallback.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -657,16 +657,15 @@
 
 };
 
+#ifdef	__cplusplus
+}	// extern &quot;C&quot;
+#endif
 
+
 #ifdef	__cplusplus
 class IGlobalAICallback;
 SAICallback* initSAICallback(int teamId, IGlobalAICallback* aiGlobalCallback);
-#endif /* __cplusplus */
+#endif	// __cplusplus
 
 
-#ifdef	__cplusplus
-}
-#endif
-
-#endif	/* _SAICALLBACK_H */
-
+#endif	// _SAICALLBACK_H

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAIFloat3.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAIFloat3.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAIFloat3.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -27,8 +27,8 @@
 };
 
 #ifdef	__cplusplus
-}
+}	// extern &quot;C&quot;
 #endif
 
-#endif	/* _SAIFLOAT3_H */
+#endif	// _SAIFLOAT3_H
 

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -20,7 +20,7 @@
 #include &lt;string.h&gt;
 #include &lt;stdlib.h&gt;
 
-SAIInterfaceSpecifier copySAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const orig) {
+struct SAIInterfaceSpecifier copySAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const orig) {
 	
 	struct SAIInterfaceSpecifier copy;
 	

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -18,11 +18,8 @@
 #ifndef _SAIINTERFACELIBRARY_H
 #define	_SAIINTERFACELIBRARY_H
 
-#ifdef __cplusplus
 #include &quot;creg/creg_cond.h&quot;
-#endif
 
-
 #ifdef	__cplusplus
 extern &quot;C&quot; {
 #endif
@@ -51,21 +48,9 @@
 	const char* version; // [may not contain: spaces, '_', '#']
 };
 
-SAIInterfaceSpecifier copySAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const orig);
+struct SAIInterfaceSpecifier copySAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const orig);
 void deleteSAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const spec);
 
-#ifdef	__cplusplus
-struct SAIInterfaceSpecifier_Comparator {
-	/**
-	 * The key comparison function, a Strict Weak Ordering;
-	 * it returns true if its first argument is less
-	 * than its second argument, and false otherwise.
-	 * This is also defined as map::key_compare.
-	 */
-	bool operator()(const struct SAIInterfaceSpecifier&amp; a, const struct SAIInterfaceSpecifier&amp; b) const;
-	static bool IsEmpty(const struct SAIInterfaceSpecifier&amp; spec);
-};
-#endif /* __cplusplus */
 
 /**
  * @brief struct Skirmish Artificial Intelligence Key
@@ -77,19 +62,6 @@
 	struct SSAISpecifier ai;
 };
 
-#ifdef	__cplusplus
-struct SSAIKey_Comparator {
-	/**
-	 * The key comparison function, a Strict Weak Ordering;
-	 * it returns true if its first argument is less
-	 * than its second argument, and false otherwise.
-	 * This is also defined as map::key_compare.
-	 */
-	bool operator()(const struct SSAIKey&amp; a, const struct SSAIKey&amp; b) const;
-	static bool IsEmpty(const struct SSAIKey&amp; key);
-};
-#endif /* __cplusplus */
-
 /**
  * @brief struct Group Artificial Intelligence Key
  * Compleetly specifies a group AI together with an interface.
@@ -100,19 +72,6 @@
 	struct SGAISpecifier ai;
 };
 
-#ifdef	__cplusplus
-struct SGAIKey_Comparator {
-	/**
-	 * The key comparison function, a Strict Weak Ordering;
-	 * it returns true if its first argument is less
-	 * than its second argument, and false otherwise.
-	 * This is also defined as map::key_compare.
-	 */
-	bool operator()(const struct SGAIKey&amp; a, const struct SGAIKey&amp; b) const;
-	static bool IsEmpty(const struct SGAIKey&amp; key);
-};
-#endif /* __cplusplus */
-
 /**
  * @brief struct Artificial Intelligence Interface
  */
@@ -195,8 +154,43 @@
 };
 
 #ifdef	__cplusplus
-}
+}	// extern &quot;C&quot;
 #endif
 
-#endif	/* _SAIINTERFACELIBRARY_H */
 
+#ifdef	__cplusplus
+struct SAIInterfaceSpecifier_Comparator {
+	/**
+	 * The key comparison function, a Strict Weak Ordering;
+	 * it returns true if its first argument is less
+	 * than its second argument, and false otherwise.
+	 * This is also defined as map::key_compare.
+	 */
+	bool operator()(const struct SAIInterfaceSpecifier&amp; a, const struct SAIInterfaceSpecifier&amp; b) const;
+	static bool IsEmpty(const struct SAIInterfaceSpecifier&amp; spec);
+};
+
+struct SSAIKey_Comparator {
+	/**
+	 * The key comparison function, a Strict Weak Ordering;
+	 * it returns true if its first argument is less
+	 * than its second argument, and false otherwise.
+	 * This is also defined as map::key_compare.
+	 */
+	bool operator()(const struct SSAIKey&amp; a, const struct SSAIKey&amp; b) const;
+	static bool IsEmpty(const struct SSAIKey&amp; key);
+};
+
+struct SGAIKey_Comparator {
+	/**
+	 * The key comparison function, a Strict Weak Ordering;
+	 * it returns true if its first argument is less
+	 * than its second argument, and false otherwise.
+	 * This is also defined as map::key_compare.
+	 */
+	bool operator()(const struct SGAIKey&amp; a, const struct SGAIKey&amp; b) const;
+	static bool IsEmpty(const struct SGAIKey&amp; key);
+};
+#endif	// __cplusplus
+
+#endif	// _SAIINTERFACELIBRARY_H

Modified: branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -21,7 +21,7 @@
 #include &lt;stdlib.h&gt;
 
 
-SGAISpecifier copySGAISpecifier(const struct SGAISpecifier* const orig) {
+struct SGAISpecifier copySGAISpecifier(const struct SGAISpecifier* const orig) {
 	
 	struct SGAISpecifier copy;
 	

Modified: branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -46,23 +46,9 @@
 	const char* version; // [may not contain: spaces, '_', '#']
 };
 
-SGAISpecifier copySGAISpecifier(const struct SGAISpecifier* const orig);
+struct SGAISpecifier copySGAISpecifier(const struct SGAISpecifier* const orig);
 void deleteSGAISpecifier(const struct SGAISpecifier* const spec);
 
-#ifdef	__cplusplus
-struct SGAISpecifier_Comparator {
-	/**
-	 * The key comparison function, a Strict Weak Ordering;
-	 * it returns true if its first argument is less
-	 * than its second argument, and false otherwise.
-	 * This is also defined as map::key_compare.
-	 */
-	bool operator()(const struct SGAISpecifier&amp; a,
-			const struct SGAISpecifier&amp; b) const;
-	static bool IsEmpty(const struct SGAISpecifier&amp; spec);
-};
-#endif /* __cplusplus */
-
 /**
  * This is the interface between the engine and an implementation of a Group AI.
  *
@@ -82,6 +68,7 @@
 	 *			versions
 	 */
 	enum LevelOfSupport (CALLING_CONV *getLevelOfSupportFor)(
+			int teamId, int groupId,
 			const char* engineVersionString, int engineVersionNumber,
 			const char* aiInterfaceShortName, const char* aiInterfaceVersion);
 	
@@ -95,8 +82,8 @@
 	 * @param	maxInfoItems	the maximum number of elements to store into param info
 	 * @return	number of elements stored into parameter info
 	 */
-	unsigned int (CALLING_CONV *getInfo)(struct InfoItem info[],
-			unsigned int maxInfoItems);
+	unsigned int (CALLING_CONV *getInfo)(int teamId, int groupId,
+			struct InfoItem info[], unsigned int maxInfoItems);
 	
 	/**
 	 * Returns options that can be set on this AI.
@@ -108,8 +95,8 @@
 	 * @param	maxOptions	the maximum number of elements to store into param options
 	 * @return	number of elements stored into parameter options
 	 */
-	unsigned int (CALLING_CONV *getOptions)(struct Option options[],
-			unsigned int maxOptions);
+	unsigned int (CALLING_CONV *getOptions)(int teamId, int groupId,
+			struct Option options[], unsigned int maxOptions);
 
 	// team and group instance functions
 	
@@ -117,7 +104,8 @@
 	 * NOTE: this method is optional. An AI not exporting this function is still
 	 * valid.
 	 */
-	int (CALLING_CONV *init)(int teamId, int groupId);
+	int (CALLING_CONV *init)(int teamId, int groupId,
+			const struct InfoItem info[], unsigned int numInfoItems);
 	/**
 	 * NOTE: this method is optional. An AI not exporting this function is still
 	 * valid.
@@ -128,7 +116,21 @@
 };
 
 #ifdef	__cplusplus
-}
+}	// extern &quot;C&quot;
 #endif
 
-#endif	/* _SGAILIBRARY_H */
+#ifdef	__cplusplus
+struct SGAISpecifier_Comparator {
+	/**
+	 * The key comparison function, a Strict Weak Ordering;
+	 * it returns true if its first argument is less
+	 * than its second argument, and false otherwise.
+	 * This is also defined as map::key_compare.
+	 */
+	bool operator()(const struct SGAISpecifier&amp; a,
+			const struct SGAISpecifier&amp; b) const;
+	static bool IsEmpty(const struct SGAISpecifier&amp; spec);
+};
+#endif	// __cplusplus
+
+#endif	// _SGAILIBRARY_H

Modified: branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -21,7 +21,7 @@
 #include &lt;string.h&gt;
 #include &lt;stdlib.h&gt;
 
-InfoItem copyInfoItem(const struct InfoItem* const orig) {
+struct InfoItem copyInfoItem(const struct InfoItem* const orig) {
 	
 	struct InfoItem copy;
 	

Modified: branches/caiinterface/rts/ExternalAI/Interface/SInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SInfo.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SInfo.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -31,9 +31,10 @@
 	const char* desc;
 };
 
-InfoItem copyInfoItem(const struct InfoItem* const orig);
+struct InfoItem copyInfoItem(const struct InfoItem* const orig);
 void deleteInfoItem(const struct InfoItem* const info);
 
+
 #if	defined(__cplusplus) &amp;&amp; !defined(BUILDING_AI) &amp;&amp; !defined(BUILDING_AI_INTERFACE)
 unsigned int ParseInfo(
 		const char* fileName,
@@ -43,11 +44,11 @@
 unsigned int ParseInfoRawFileSystem(
 		const char* fileName,
 		InfoItem info[], unsigned int max);
-#endif	/* defined(__cplusplus) &amp;&amp; !defined(BUILDING_AI) &amp;&amp; !defined(BUILDING_AI_INTERFACE) */
+#endif	// defined(__cplusplus) &amp;&amp; !defined(BUILDING_AI) &amp;&amp; !defined(BUILDING_AI_INTERFACE)
 
 #ifdef	__cplusplus
-}
+}	// extern &quot;C&quot;
 #endif
 
-#endif	/* _SINFO_H */
+#endif	// _SINFO_H
 

Modified: branches/caiinterface/rts/ExternalAI/Interface/SOption.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SOption.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SOption.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -53,9 +53,10 @@
 
 	const char* type; // &quot;bool&quot;, &quot;number&quot;, &quot;string&quot;, &quot;list&quot;, ... (see enum OptionType)
 
-	OptionType typeCode;
+	enum OptionType typeCode;
 
-	bool   boolDef;
+//	bool   boolDef;
+	int   boolDef; // 0 -&gt; false, 1 -&gt; true
 
 	float  numberDef;
 	float  numberMin;
@@ -67,9 +68,10 @@
 
 	const char* listDef;
 	int numListItems;
-	OptionListItem* list;
+	struct OptionListItem* list;
 };
 
+
 #if	defined(__cplusplus) &amp;&amp; !defined(BUILDING_AI) &amp;&amp; !defined(BUILDING_AI_INTERFACE)
 int ParseOptions(
 		const char* fileName,
@@ -77,11 +79,11 @@
 		const char* accessModes,
 		const char* mapName,
 		Option options[], unsigned int max);
-#endif	/* defined(__cplusplus) &amp;&amp; !defined(BUILDING_AI) &amp;&amp; !defined(BUILDING_AI_INTERFACE) */
+#endif	// defined(__cplusplus) &amp;&amp; !defined(BUILDING_AI) &amp;&amp; !defined(BUILDING_AI_INTERFACE)
 
 #ifdef	__cplusplus
-}
+}	// extern &quot;C&quot;
 #endif
 
-#endif	/* _SOPTION_H */
+#endif	// _SOPTION_H */
 

Modified: branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -21,7 +21,7 @@
 #include &lt;stdlib.h&gt;
 
 
-SSAISpecifier copySSAISpecifier(const struct SSAISpecifier* const orig) {
+struct SSAISpecifier copySSAISpecifier(const struct SSAISpecifier* const orig) {
 	
 	struct SSAISpecifier copy;
 	

Modified: branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -46,7 +46,7 @@
 	const char* version; // [may not contain: spaces, '_', '#']
 };
 
-SSAISpecifier copySSAISpecifier(const struct SSAISpecifier* const orig);
+struct SSAISpecifier copySSAISpecifier(const struct SSAISpecifier* const orig);
 void deleteSSAISpecifier(const struct SSAISpecifier* const spec);
 
 #ifdef	__cplusplus
@@ -82,7 +82,7 @@
 	 * @return	the level of support for the supplied engine and AI interface
 	 *			versions
 	 */
-	enum LevelOfSupport (CALLING_CONV *getLevelOfSupportFor)(
+	enum LevelOfSupport (CALLING_CONV *getLevelOfSupportFor)(int teamId,
 			const char* engineVersionString, int engineVersionNumber,
 			const char* aiInterfaceShortName, const char* aiInterfaceVersion);
 	
@@ -96,7 +96,7 @@
 	 * @param	max	the maximum number of elements to store into param info
 	 * @return	number of elements stored into parameter info
 	 */
-	unsigned int (CALLING_CONV *getInfo)(struct InfoItem info[],
+	unsigned int (CALLING_CONV *getInfo)(int teamId, struct InfoItem info[],
 			unsigned int maxInfoItems);
 	
 	/**
@@ -109,7 +109,7 @@
 	 * @param	max	the maximum number of elements to store into param options
 	 * @return	number of elements stored into parameter options
 	 */
-	unsigned int (CALLING_CONV *getOptions)(struct Option options[],
+	unsigned int (CALLING_CONV *getOptions)(int teamId, struct Option options[],
 			unsigned int maxOptions);
 
 	
@@ -140,9 +140,12 @@
 	 * valid.
 	 *
 	 * @param	teamId	the teamId this library shall create an instance for
+	 * @param	info	info about this AI (a technical nessecity for non C/C++ AIs)
+	 * @param	numInfoItems	now many items are stored in info
 	 * @return	init ok: 0, on error: any other value then 0
 	 */
-	int (CALLING_CONV *init)(int teamId);
+	int (CALLING_CONV *init)(int teamId, const struct InfoItem info[],
+			unsigned int numInfoItems);
 	
 	/**
 	 * This function is called, when an AI instance shall be deleted.

Modified: branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -20,7 +20,7 @@
 
 #ifdef	__cplusplus
 extern &quot;C&quot; {
-#endif	/* __cplusplus */
+#endif	// __cplusplus
 
 // paths/dirs stored in this struct are guaranteed
 // to come with no '/' or '\\' at the end.
@@ -28,6 +28,7 @@
 // NOT like this:		/home/username/.spring/
 struct SStaticGlobalData {
 	unsigned int maxTeams;
+	unsigned int maxGroups; // maximum number of groups per team
 	const char* springVersion;
 	/** The first entry is the writeable data-dir */
 	unsigned int numDataDirs;
@@ -37,18 +38,20 @@
 // define the OS specific path separator
 #ifdef WIN32
 #define PS '\\'
-#else	/* WIN32 */
+#define sPS &quot;\\&quot;
+#else	// WIN32
 #define PS '/'
-#endif	/* WIN32 */
+#define sPS &quot;/&quot;
+#endif	// WIN32
 
 #ifdef	__cplusplus
-}		/* extern &quot;C&quot; */
-#endif	/* __cplusplus */
+}		// extern &quot;C&quot;
+#endif	// __cplusplus
 
 #if defined	__cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
 struct SStaticGlobalData* createStaticGlobalData();
 void freeStaticGlobalData(struct SStaticGlobalData* staticGlobalData);
-#endif	/* defined	__cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
+#endif	// defined	__cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
 
-#endif	/* _SSTATICGLOBALDATA_H */
+#endif	// _SSTATICGLOBALDATA_H
 

Modified: branches/caiinterface/rts/ExternalAI/Interface/aidefines.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/aidefines.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/Interface/aidefines.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -20,7 +20,7 @@
 
 #ifdef	__cplusplus
 extern &quot;C&quot; {
-#endif	/* __cplusplus */
+#endif	// __cplusplus
 
 #include &quot;System/exportdefines.h&quot;
 
@@ -60,7 +60,7 @@
 #define GROUP_AI_DATA_DIR &quot;AI/Group/data&quot;
 
 #ifdef	__cplusplus
-}		/* extern &quot;C&quot; */
-#endif	/* __cplusplus */
+}		// extern &quot;C&quot;
+#endif	// __cplusplus
 
-#endif	/* _AIDEFINES_H */
+#endif	// _AIDEFINES_H

Modified: branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -22,6 +22,7 @@
 
 #if defined	__cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
 #include &quot;System/GlobalStuff.h&quot;			// for MAX_TEAMS
+#define MAX_GROUPS	10	// 0..9
 #include &quot;System/Platform/FileSystem.h&quot;	// for data directories
 #include &quot;Game/GameVersion.h&quot;			// for VERSION_STRING
 
@@ -62,6 +63,7 @@
 	
 	const SStaticGlobalData sgd = {
 		MAX_TEAMS,
+		MAX_GROUPS,
 		VERSION_STRING,	// spring version string
 		numDataDirs,
 		(const char**) dataDirs};

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -22,7 +22,10 @@
 #include &lt;string&gt;
 
 CSkirmishAILibrary::CSkirmishAILibrary(const SSAILibrary&amp; ai,
-		const SSAISpecifier&amp; specifier) : sSAI(ai), specifier(specifier) {}
+		const SSAISpecifier&amp; specifier,
+		const InfoItem info[], unsigned int numInfoItems)
+		: sSAI(ai), specifier(specifier), info(info),
+		numInfoItems(numInfoItems) {}
 
 CSkirmishAILibrary::~CSkirmishAILibrary() {}
 	
@@ -30,25 +33,27 @@
 	return specifier;
 }
 
-LevelOfSupport CSkirmishAILibrary::GetLevelOfSupportFor(
+LevelOfSupport CSkirmishAILibrary::GetLevelOfSupportFor(int teamId,
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 		const SAIInterfaceSpecifier&amp; interfaceSpecifier) const {
 	
 	if (sSAI.getLevelOfSupportFor != NULL) {
-		return sSAI.getLevelOfSupportFor(engineVersionString.c_str(), engineVersionNumber,
-			interfaceSpecifier.shortName, interfaceSpecifier.version);
+		return sSAI.getLevelOfSupportFor(teamId, engineVersionString.c_str(),
+				engineVersionNumber, interfaceSpecifier.shortName,
+				interfaceSpecifier.version);
 	} else {
 		return LOS_Unknown;
 	}
 }
 	
-std::map&lt;std::string, InfoItem&gt; CSkirmishAILibrary::GetInfo() const {
+/*
+std::map&lt;std::string, InfoItem&gt; CSkirmishAILibrary::GetInfo(unsigned int teamId) const {
 	
 	std::map&lt;std::string, InfoItem&gt; info;
 	
 	if (sSAI.getInfo != NULL) {
 		InfoItem infs[MAX_INFOS];
-		int num = sSAI.getInfo(infs, MAX_INFOS);
+		int num = sSAI.getInfo(teamId, infs, MAX_INFOS);
 
 		int i;
 		for (i=0; i &lt; num; ++i) {
@@ -59,13 +64,13 @@
 
 	return info;
 }
-std::vector&lt;Option&gt; CSkirmishAILibrary::GetOptions() const {
+std::vector&lt;Option&gt; CSkirmishAILibrary::GetOptions(unsigned int teamId) const {
 	
 	std::vector&lt;Option&gt; ops;
 	
 	if (sSAI.getOptions != NULL) {
 		Option options[MAX_OPTIONS];
-		int num = sSAI.getOptions(options, MAX_OPTIONS);
+		int num = sSAI.getOptions(teamId, options, MAX_OPTIONS);
 
 		int i;
 		for (i=0; i &lt; num; ++i) {
@@ -75,12 +80,13 @@
 
 	return ops;
 }
+*/
 
 
 void CSkirmishAILibrary::Init(int teamId) const {
 	
 	if (sSAI.init != NULL) {
-		int error = sSAI.init(teamId);
+		int error = sSAI.init(teamId, info, numInfoItems);
 		if (error != 0) {
 			// init failed
 			logOutput.Print(&quot;Failed to initialize an AI for team %d, error: %d&quot;, teamId, error);

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -24,7 +24,8 @@
 
 class CSkirmishAILibrary : public ISkirmishAILibrary {
 public:
-	CSkirmishAILibrary(const SSAILibrary&amp; ai, const SSAISpecifier&amp; specifier);
+	CSkirmishAILibrary(const SSAILibrary&amp; ai, const SSAISpecifier&amp; specifier,
+			const InfoItem info[], unsigned int numInfoItems);
 	virtual ~CSkirmishAILibrary();
 	
 	virtual SSAISpecifier GetSpecifier() const;
@@ -32,12 +33,12 @@
 	 * Level of Support for a specific engine version and ai interface.
 	 * @return see enum LevelOfSupport (higher values could be used optionally)
 	 */
-	virtual LevelOfSupport GetLevelOfSupportFor(
+	virtual LevelOfSupport GetLevelOfSupportFor(int teamId,
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 			const SAIInterfaceSpecifier&amp; interfaceSpecifier) const;
 	
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const;
-	virtual std::vector&lt;Option&gt; GetOptions() const;
+//    virtual std::map&lt;std::string, InfoItem&gt; GetInfo(int teamId) const;
+//	virtual std::vector&lt;Option&gt; GetOptions(int teamId) const;
 	
 	
     virtual void Init(int teamId) const;
@@ -47,6 +48,8 @@
 private:
 	SSAILibrary sSAI;
 	SSAISpecifier specifier;
+	const InfoItem* info;
+	unsigned int numInfoItems;
 	
 private:
 //	void reportInterfaceFunctionError(const std::string* libFileName, const std::string* functionName);

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -25,6 +25,7 @@
 #include &quot;Platform/errorhandler.h&quot;
 #include &quot;FileSystem/VFSModes.h&quot;
 
+/*
 CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(const ISkirmishAILibrary&amp; ai,
 		const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
 	info = ai.GetInfo();
@@ -32,6 +33,7 @@
 	//levelOfSupport = ai.GetLevelOfSupportFor(std::string(ENGINE_VERSION_STRING),
 	//		ENGINE_VERSION_NUMBER, interfaceSpecifier);
 }
+*/
 
 CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(
 		const CSkirmishAILibraryInfo&amp; aiInfo) {

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -32,8 +32,8 @@
 
 class CSkirmishAILibraryInfo {
 public:
-	CSkirmishAILibraryInfo(const ISkirmishAILibrary&amp; ai,
-			const SAIInterfaceSpecifier&amp; interfaceSpecifier);
+//	CSkirmishAILibraryInfo(const ISkirmishAILibrary&amp; ai,
+//			const SAIInterfaceSpecifier&amp; interfaceSpecifier);
 	CSkirmishAILibraryInfo(const CSkirmishAILibraryInfo&amp; aiInfo);
 	CSkirmishAILibraryInfo(const std::string&amp; aiInfoFile,
 			const std::string&amp; aiOptionFile);

Modified: branches/caiinterface/rts/Game/Game.cpp
===================================================================
--- branches/caiinterface/rts/Game/Game.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Game/Game.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -672,7 +672,7 @@
 	const CKeyBindings::ActionList&amp; actionList = keyBindings-&gt;GetActionList(ks);
 
 	if (userWriting) {
-		int actionIndex;
+		unsigned int actionIndex;
 		for (actionIndex = 0; actionIndex &lt; (int)actionList.size(); actionIndex++) {
 			const Action&amp; action = actionList[actionIndex];
 
@@ -724,7 +724,7 @@
 				writingPos = (int)head.length();
 				if (!partials.empty()) {
 					string msg;
-					for (int i = 0; i &lt; partials.size(); i++) {
+					for (unsigned int i = 0; i &lt; partials.size(); i++) {
 						msg += &quot;  &quot;;
 						msg += partials[i];
 					}
@@ -975,7 +975,7 @@
 		SendNetChat(action.extra);
 	}
 	else if (cmd == &quot;w&quot;) {
-		const int pos = action.extra.find_first_of(&quot; &quot;);
+		const std::string::size_type pos = action.extra.find_first_of(&quot; &quot;);
 		if (pos != std::string::npos) {
 			const int playernum = gs-&gt;Player(action.extra.substr(0, pos));
 			if (playernum &gt;= 0) {
@@ -989,21 +989,21 @@
 		logOutput.Print(action.extra);
 	}
 	else if (cmd == &quot;setf&quot;) {
-		const int pos = action.extra.find_first_of(&quot; &quot;);
+		const std::string::size_type pos = action.extra.find_first_of(&quot; &quot;);
 		if (pos != std::string::npos) {
 			const std::string varName = action.extra.substr(0, pos);
 			configHandler.SetFloat(varName, atof(action.extra.substr(pos+1).c_str()));
 		}
 	}
 	else if (cmd == &quot;seti&quot;) {
-		const int pos = action.extra.find_first_of(&quot; &quot;);
+		const std::string::size_type pos = action.extra.find_first_of(&quot; &quot;);
 		if (pos != std::string::npos) {
 			const std::string varName = action.extra.substr(0, pos);
 			configHandler.SetInt(varName, atoi(action.extra.substr(pos+1).c_str()));
 		}
 	}
 	else if (cmd == &quot;sets&quot;) {
-		const int pos = action.extra.find_first_of(&quot; &quot;);
+		const std::string::size_type pos = action.extra.find_first_of(&quot; &quot;);
 		if (pos != std::string::npos) {
 			const std::string varName = action.extra.substr(0, pos);
 			configHandler.SetString(varName, action.extra.substr(pos+1));
@@ -3203,7 +3203,7 @@
 
 		std::vector&lt;int&gt; args;
 		args.push_back(0);
-		unit-&gt;cob-&gt;Call(COBFN_AimFromPrimary/*/COBFN_QueryPrimary+weaponNum/**/,args);
+		unit-&gt;cob-&gt;Call(COBFN_AimFromPrimary/*/COBFN_QueryPrimary+weaponNum/ **/,args);
 		float3 relPos=unit-&gt;localmodel-&gt;GetPiecePos(args[0]);
 		float3 pos=unit-&gt;pos+unit-&gt;frontdir*relPos.z+unit-&gt;updir*relPos.y+unit-&gt;rightdir*relPos.x;
 		pos+=UpVector*7;
@@ -4043,7 +4043,7 @@
 
 		std::vector&lt;int&gt; args;
 		args.push_back(0);
-		owner-&gt;cob-&gt;Call(COBFN_AimFromPrimary/*/COBFN_QueryPrimary+weaponNum/**/,args);
+		owner-&gt;cob-&gt;Call(COBFN_AimFromPrimary/*/COBFN_QueryPrimary+weaponNum/ **/,args);
 		float3 relPos = owner-&gt;localmodel-&gt;GetPiecePos(args[0]);
 		float3 pos = owner-&gt;pos + owner-&gt;frontdir * relPos.z
 		                        + owner-&gt;updir    * relPos.y
@@ -4275,7 +4275,7 @@
 		}
 
 		int numWeaponsToPrint = 0;
-		for (int a = 0; a &lt; unit-&gt;weapons.size(); ++a) {
+		for (unsigned int a = 0; a &lt; unit-&gt;weapons.size(); ++a) {
 			const WeaponDef* wd = unit-&gt;weapons[a]-&gt;weaponDef;
 			if (!wd-&gt;isShield) {
 				++numWeaponsToPrint;
@@ -4291,7 +4291,7 @@
 			const float fontSize = 1.2f * (lineHeight / maxLineHeight);
 			float yPos = yTop;
 
-			for (int a = 0; a &lt; unit-&gt;weapons.size(); ++a) {
+			for (unsigned int a = 0; a &lt; unit-&gt;weapons.size(); ++a) {
 				const CWeapon* w = unit-&gt;weapons[a];
 				const WeaponDef* wd = w-&gt;weaponDef;
 				if (!wd-&gt;isShield) {
@@ -4331,7 +4331,7 @@
 	camera-&gt;Update(false);		//draw some stuff in world coordinates
 	glDisable(GL_TEXTURE_2D);
 
-	for(int a=0;a&lt;unit-&gt;weapons.size();++a){
+	for(unsigned int a=0;a&lt;unit-&gt;weapons.size();++a){
 		const CWeapon* w = unit-&gt;weapons[a];
 		if(!w){
 			logOutput.Print(&quot;Null weapon in vector?&quot;);
@@ -4475,7 +4475,7 @@
 void CGame::HandleChatMsg(const ChatMessage&amp; msg)
 {
 	if ((msg.fromPlayer &lt; 0) ||
-	    ((msg.fromPlayer &gt;= MAX_PLAYERS) &amp;&amp; (msg.fromPlayer != SERVER_PLAYER))) {
+		((msg.fromPlayer &gt;= MAX_PLAYERS) &amp;&amp; (msg.fromPlayer != SERVER_PLAYER))) {
 		return;
 	}
 

Modified: branches/caiinterface/rts/Game/GameHelper.cpp
===================================================================
--- branches/caiinterface/rts/Game/GameHelper.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Game/GameHelper.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -24,6 +24,7 @@
 #include &quot;Sim/Misc/LosHandler.h&quot;
 #include &quot;Sim/Misc/QuadField.h&quot;
 #include &quot;Sim/Misc/RadarHandler.h&quot;
+#include &quot;Sim/ModInfo.h&quot;
 #include &quot;Sim/Projectiles/ExplosionGenerator.h&quot;
 #include &quot;Sim/Projectiles/Projectile.h&quot;
 #include &quot;Sim/Units/CommandAI/CommandAI.h&quot;
@@ -531,12 +532,14 @@
 }
 
 CUnit* CGameHelper::GetClosestEnemyUnitNoLosTest(const float3 &amp;pos, float radius,
-                                                 int searchAllyteam, bool sphere)
+                                                 int searchAllyteam, bool sphere, bool canBeBlind)
 {
 	const int tempNum = gs-&gt;tempNum++;
 
 	CUnit* closeUnit = NULL;
 
+	float losFactor = (SQUARE_SIZE * (1 &lt;&lt; modInfo.losMipLevel));
+
 	if (sphere) {  // includes target radius
 		float closeDist = radius;
 		std::vector&lt;int&gt; quads = qf-&gt;GetQuads(pos, radius + uh-&gt;maxUnitRadius);
@@ -550,7 +553,8 @@
 				    !gs-&gt;Ally(searchAllyteam, unit-&gt;allyteam)) {
 					unit-&gt;tempNum = tempNum;
 					const float dist = (pos - unit-&gt;midPos).Length() - unit-&gt;radius;
-					if (dist &lt;= closeDist){
+					if (dist &lt;= closeDist &amp;&amp;
+						(canBeBlind || unit-&gt;losRadius * losFactor &gt; dist)){
 						closeDist = dist;
 						closeUnit = unit;
 					}
@@ -571,7 +575,8 @@
 				    !gs-&gt;Ally(searchAllyteam, unit-&gt;allyteam)) {
 					unit-&gt;tempNum = tempNum;
 					const float sqDist = (pos - unit-&gt;midPos).SqLength2D();
-					if (sqDist &lt;= closeDistSq){
+					if (sqDist &lt;= closeDistSq &amp;&amp;
+						(canBeBlind || unit-&gt;losRadius * losFactor &gt; sqDist)){
 						closeDistSq = sqDist;
 						closeUnit = unit;
 					}

Modified: branches/caiinterface/rts/Game/GameHelper.h
===================================================================
--- branches/caiinterface/rts/Game/GameHelper.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Game/GameHelper.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -36,7 +36,7 @@
 	void GetEnemyUnits(const float3&amp; pos,float radius,int searchAllyteam,std::vector&lt;int&gt;&amp; found);
 	CUnit* GetClosestUnit(const float3&amp; pos,float radius);
 	CUnit* GetClosestEnemyUnit(const float3&amp; pos,float radius,int searchAllyteam);
-	CUnit* GetClosestEnemyUnitNoLosTest(const float3&amp; pos,float radius,int searchAllyteam,bool sphere);
+	CUnit* GetClosestEnemyUnitNoLosTest(const float3&amp; pos,float radius,int searchAllyteam,bool sphere,bool canBeBlind);
 	CUnit* GetClosestFriendlyUnit(const float3&amp; pos,float radius,int searchAllyteam);
 	CUnit* GetClosestEnemyAircraft(const float3&amp; pos,float radius,int searchAllyteam);
 	void GenerateTargets(const CWeapon *attacker, CUnit* lastTarget,std::map&lt;float,CUnit*&gt; &amp;targets);

Modified: branches/caiinterface/rts/Game/GameServer.cpp
===================================================================
--- branches/caiinterface/rts/Game/GameServer.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Game/GameServer.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -820,7 +820,7 @@
 								if (players[i] &amp;&amp; players[i]-&gt;team == team)
 								{
 									players[i]-&gt;team = 0;
-									players[player]-&gt;spectator = true;
+									players[i]-&gt;spectator = true;
 								}
 							}
 						}

Modified: branches/caiinterface/rts/Game/GameVersion.cpp
===================================================================
--- branches/caiinterface/rts/Game/GameVersion.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Game/GameVersion.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -11,10 +11,10 @@
 
 /** The game version as it's returned by unitsync and Spring on commandline.
 This version string is the one that's used to check sync. */
-const char* const VERSION_STRING = &quot;0.77b3+&quot;;
+const char* const VERSION_STRING = &quot;0.77b4+&quot;;
 
 /** The game version as it's printed to infolog, for e.g. stacktrace translator. */
-const char* const VERSION_STRING_DETAILED = &quot;0.77b3+&quot;;
+const char* const VERSION_STRING_DETAILED = &quot;0.77b4+&quot;;
 
 /** Build date and time. */
 const char* const BUILD_DATETIME = __DATE__ &quot; &quot; __TIME__;

Modified: branches/caiinterface/rts/Game/UI/LuaUI.cpp
===================================================================
--- branches/caiinterface/rts/Game/UI/LuaUI.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Game/UI/LuaUI.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -630,7 +630,7 @@
 
 			HSTR_PUSH(L, &quot;params&quot;);
 			lua_newtable(L);
-			for (int p = 0; p &lt; cmds[i].params.size(); p++) {
+			for (unsigned int p = 0; p &lt; cmds[i].params.size(); p++) {
 				lua_pushnumber(L, p + 1);
 				lua_pushstring(L, cmds[i].params[p].c_str());
 				lua_rawset(L, -3);

Modified: branches/caiinterface/rts/Lua/LuaOpenGL.cpp
===================================================================
--- branches/caiinterface/rts/Lua/LuaOpenGL.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Lua/LuaOpenGL.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -4057,6 +4057,8 @@
 
 	b.Save(fileName,false);
 	delete[] buf;
+
+	return 0;
 }
 
 

Modified: branches/caiinterface/rts/Lua/LuaShaders.cpp
===================================================================
--- branches/caiinterface/rts/Lua/LuaShaders.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Lua/LuaShaders.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -94,7 +94,7 @@
 
 GLuint LuaShaders::GetProgramName(unsigned int progID) const
 {
-	if ((progID &lt;= 0) || (progID &gt;= (int)programs.size())) {
+	if ((progID &lt;= 0) || (progID &gt;= programs.size())) {
 		return 0;
 	}
 	return programs[progID].id;
@@ -126,7 +126,7 @@
 
 void LuaShaders::RemoveProgram(unsigned int progID)
 {
-	if ((progID &lt;= 0) || (progID &gt;= (int)programs.size())) {
+	if ((progID &lt;= 0) || (progID &gt;= programs.size())) {
 		return;
 	}
 	Program&amp; p = programs[progID];

Modified: branches/caiinterface/rts/Lua/LuaSyncedRead.cpp
===================================================================
--- branches/caiinterface/rts/Lua/LuaSyncedRead.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Lua/LuaSyncedRead.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -2137,7 +2137,7 @@
 		target = helper-&gt;GetClosestEnemyUnit(unit-&gt;pos, range, unit-&gt;allyteam);
 	} else {
 		target = helper-&gt;GetClosestEnemyUnitNoLosTest(unit-&gt;pos, range,
-		                                              unit-&gt;allyteam, false);
+		                                              unit-&gt;allyteam, false, true);
 	}
 	if (target) {
 		lua_pushnumber(L, target-&gt;id);

Modified: branches/caiinterface/rts/Lua/LuaUnsyncedRead.cpp
===================================================================
--- branches/caiinterface/rts/Lua/LuaUnsyncedRead.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Lua/LuaUnsyncedRead.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -604,10 +604,7 @@
 		allyTeamID = gs-&gt;AllyTeam(teamID);
 	}
 	if (allyTeamID &lt; 0) {
-		allyTeamID = 0; // safety
-	}
-	if (!fullRead) {
-		if (allyTeamID &lt; 0) {
+		if (!fullRead) {
 			return 0;
 		}
 	}

Modified: branches/caiinterface/rts/Sim/Features/Feature.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Features/Feature.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Sim/Features/Feature.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -497,6 +497,8 @@
 				// position) if it's still greater than 0
 				pos += deathSpeed;
 				midPos += deathSpeed;
+				// NOTE: apply more drag if we were a tank or bot?
+				// (would require passing extra data to Initialize())
 				deathSpeed *= 0.95f;
 
 				haveForwardSpeed = true;
@@ -514,7 +516,7 @@
 			if (!reachedGround) {
 				if (pos.y &gt; 0.0f) {
 					// quadratic acceleration if not in water
-					deathSpeed.y += mapInfo-&gt;map.gravity * 0.25f;
+					deathSpeed.y += mapInfo-&gt;map.gravity;
 				} else {
 					// constant downward speed otherwise
 					deathSpeed.y = mapInfo-&gt;map.gravity;

Modified: branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.cpp
===================================================================
--- branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -151,7 +151,8 @@
 {
 	float3 &amp;pos = owner-&gt;pos;
 
-	//This is only set to false after the plane has finished constructing
+	// note: this is only set to false after
+	// the plane has finished constructing
 	if (useHeading) {
 		useHeading = false;
 		SetState(AIRCRAFT_TAKEOFF);
@@ -183,7 +184,7 @@
 			UpdateAirPhysics(0, aileron, elevator, 1, owner-&gt;frontdir);
 			maneuver = 0;
 
-			goto EndNormalControl;		//ok so goto is bad i know
+			goto EndNormalControl; // bad
 		}
 	}
 #endif
@@ -194,8 +195,9 @@
 		float3 pos = unit-&gt;pos + (unit-&gt;frontdir * relPos.z) + (unit-&gt;updir * relPos.y) + (unit-&gt;rightdir * relPos.x);
 
 		if (padStatus == 0) {
-			if (aircraftState != AIRCRAFT_FLYING &amp;&amp; aircraftState != AIRCRAFT_TAKEOFF)
+			if (aircraftState != AIRCRAFT_FLYING &amp;&amp; aircraftState != AIRCRAFT_TAKEOFF) {
 				SetState(AIRCRAFT_FLYING);
+			}
 
 			goalPos = pos;
 
@@ -203,8 +205,9 @@
 				padStatus = 1;
 			}
 		} else if (padStatus == 1) {
-			if (aircraftState != AIRCRAFT_LANDING)
+			if (aircraftState != AIRCRAFT_LANDING) {
 				SetState(AIRCRAFT_LANDING);
+			}
 
 			goalPos = pos;
 			reservedLandingPos = pos;
@@ -213,11 +216,11 @@
 				padStatus = 2;
 			}
 		} else {
-			if (aircraftState != AIRCRAFT_LANDED)
+			if (aircraftState != AIRCRAFT_LANDED) {
 				SetState(AIRCRAFT_LANDED);
+			}
 
 			owner-&gt;pos = pos;
-
 			owner-&gt;AddBuildPower(unit-&gt;unitDef-&gt;buildSpeed / 30, unit);
 			owner-&gt;currentFuel = std::min(owner-&gt;unitDef-&gt;maxFuel, owner-&gt;currentFuel + (owner-&gt;unitDef-&gt;maxFuel / (GAME_SPEED * owner-&gt;unitDef-&gt;refuelTime)));
 
@@ -230,6 +233,10 @@
 				SetState(AIRCRAFT_TAKEOFF);
 			}
 		}
+	} else if (padStatus == 0 &amp;&amp; owner-&gt;unitDef-&gt;maxFuel &gt; 0.0f &amp;&amp; owner-&gt;currentFuel &lt;= 0.0f) {
+		// keep us in the air to reach our landing goalPos
+		// (which is hopefully in the vicinity of a pad)
+		SetState(AIRCRAFT_FLYING);
 	}
 
 
@@ -790,8 +797,9 @@
 	else
 		h = pos.y - ground-&gt;GetHeight(pos.x,pos.z);
 
-	if (h &gt; wantedHeight)
+	if (h &gt; wantedHeight) {
 		SetState(AIRCRAFT_FLYING);
+	}
 
 	if ((h + speed.y * 20) &lt; (wantedHeight * 1.02f))
 		speed.y += maxAcc;
@@ -926,8 +934,9 @@
 			reservedLandingPos.y = gh;
 		}
 
-		if (alt &lt;= 1)
+		if (alt &lt;= 1) {
 			SetState(AIRCRAFT_LANDED);
+		}
 	}
 }
 
@@ -1201,9 +1210,9 @@
 
 
 
-void CAirMoveType::StartMoving(float3 pos, float goalRadius)
+void CAirMoveType::StartMoving(float3 gpos, float goalRadius)
 {
-	SetGoal(pos);
+	SetGoal(gpos);
 }
 
 
@@ -1219,8 +1228,9 @@
 void CAirMoveType::StopMoving()
 {
 	SetGoal(owner-&gt;pos);
-	if ((aircraftState == AAirMoveType::AIRCRAFT_FLYING)
-	   &amp;&amp; !owner-&gt;unitDef-&gt;DontLand() &amp;&amp; autoLand) {
+
+	if ((aircraftState == AAirMoveType::AIRCRAFT_FLYING) &amp;&amp;
+		!owner-&gt;unitDef-&gt;DontLand() &amp;&amp; autoLand) {
 		SetState(AAirMoveType::AIRCRAFT_LANDING);
 	}
 }

Modified: branches/caiinterface/rts/Sim/MoveTypes/TAAirMoveType.cpp
===================================================================
--- branches/caiinterface/rts/Sim/MoveTypes/TAAirMoveType.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Sim/MoveTypes/TAAirMoveType.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -308,17 +308,18 @@
 // it switches to normal flying instead
 void CTAAirMoveType::UpdateHovering()
 {
-	float driftSpeed = owner-&gt;unitDef-&gt;dlHoverFactor;	
-	float3 dir = goalPos - owner-&gt;pos;
+	float driftSpeed = owner-&gt;unitDef-&gt;dlHoverFactor;
+	float3 deltaVec = goalPos - owner-&gt;pos;
+	float3 deltaDir = float3(deltaVec).Normalize();
 
-	// move towards goal position if it's not immediately behind us when we have
-	// more waypoints to get to
+	// move towards goal position if it's not immediately
+	// behind us when we have more waypoints to get to
 	if (aircraftState != AIRCRAFT_LANDING &amp;&amp; (owner-&gt;commandAI-&gt;HasMoreMoveCommands() &amp;&amp;
-		dir.Length2D() &lt; 120) &amp;&amp; (goalPos - owner-&gt;pos).Normalize().distance(dir) &gt; 1) {
-		dir = owner-&gt;frontdir;
+		deltaVec.Length2D() &lt; 120) &amp;&amp; deltaDir.distance(deltaVec) &gt; 1.0f) {
+		deltaDir = owner-&gt;frontdir;
 	}
 
-	wantedSpeed += float3(dir.x, 0.0f, dir.z) * driftSpeed * 0.03f;
+	wantedSpeed += float3(deltaDir.x, 0.0f, deltaDir.z) * driftSpeed * 0.03f;
 	// damping
 	wantedSpeed *= 0.97f;
 	// random movement (a sort of fake wind effect)
@@ -363,10 +364,10 @@
 							wantedHeight = orgWantedHeight;
 						}
 					} else {
-						//wantedSpeed = ZeroVector;
+						wantedSpeed = ZeroVector;
 						if (!owner-&gt;commandAI-&gt;HasMoreMoveCommands())
-							wantToStop=true;
-						// SetState(AIRCRAFT_HOVERING);
+							wantToStop = true;
+						SetState(AIRCRAFT_HOVERING);
 					}
 				} else {
 					wantedHeight = orgWantedHeight;

Modified: branches/caiinterface/rts/Sim/Units/Unit.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/Unit.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Sim/Units/Unit.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -811,7 +811,7 @@
 	else if (wantCloak || (scriptCloak &gt;= 1)) {
 		if ((decloakDistance &gt; 0.0f) &amp;&amp;
 		    helper-&gt;GetClosestEnemyUnitNoLosTest(midPos, decloakDistance,
-		                                         allyteam, unitDef-&gt;decloakSpherical)) {
+		                                         allyteam, unitDef-&gt;decloakSpherical, false)) {
 			curCloakTimeout = gs-&gt;frameNum + cloakTimeout;
 			isCloaked = false;
 		}
@@ -862,7 +862,7 @@
 
 	if (unitDef-&gt;canKamikaze) {
 		if (fireState &gt;= 2) {
-			CUnit* u = helper-&gt;GetClosestEnemyUnitNoLosTest(pos, unitDef-&gt;kamikazeDist, allyteam, false);
+			CUnit* u = helper-&gt;GetClosestEnemyUnitNoLosTest(pos, unitDef-&gt;kamikazeDist, allyteam, false, true);
 			if (u &amp;&amp; u-&gt;physicalState != CSolidObject::Flying &amp;&amp; u-&gt;speed.dot(pos - u-&gt;pos) &lt;= 0) {
 				// self destruct when unit start moving away from mine, should maximize damage
 				KillUnit(true, false, NULL);
@@ -1587,7 +1587,8 @@
 
 	if (commandAI-&gt;CanChangeFireState()) {
 		if (unitDef-&gt;fireState &lt; 0) {
-			if (builder != NULL) {
+			if (builder != NULL &amp;&amp; (builder-&gt;unitDef-&gt;type == &quot;Factory&quot;
+						|| dynamic_cast&lt;CFactoryCAI*&gt;(builder-&gt;commandAI))) {
 				fireState = builder-&gt;fireState;
 			} else {
 				fireState = 2;

Modified: branches/caiinterface/rts/Sim/Units/UnitHandler.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/UnitHandler.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Sim/Units/UnitHandler.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -432,7 +432,11 @@
 		}
 	}
 
-	if (!unitdef-&gt;floater) {
+	const float groundheight = ground-&gt;GetHeight2(pos.x, pos.z);
+
+	if (!unitdef-&gt;floater || groundheight &gt; 0.0f) {
+		// if we are capable of floating, only test local
+		// height difference if terrain is above sea-level
 		const float* heightmap = readmap-&gt;GetHeightmap();
 		int x = (int) (pos.x / SQUARE_SIZE);
 		int z = (int) (pos.z / SQUARE_SIZE);
@@ -444,8 +448,6 @@
 		if (pos.y &lt; orgh - hdif &amp;&amp; pos.y &lt; h - hdif) { return 0; }
 	}
 
-	const float groundheight = ground-&gt;GetHeight2(pos.x, pos.z);
-
 	if (!unitdef-&gt;floater &amp;&amp; groundheight &lt; -unitdef-&gt;maxWaterDepth) {
 		// ground is deeper than our maxWaterDepth, cannot build here
 		return 0;

Modified: branches/caiinterface/rts/Sim/Units/UnitLoader.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/UnitLoader.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Sim/Units/UnitLoader.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -507,8 +507,14 @@
 void CUnitLoader::FlattenGround(const CUnit* unit)
 {
 	const UnitDef* unitDef = unit-&gt;unitDef;
-	if (!mapDamage-&gt;disabled &amp;&amp; unitDef-&gt;levelGround &amp;&amp; !unitDef-&gt;floater &amp;&amp;
-	    !(unitDef-&gt;canmove &amp;&amp; (unitDef-&gt;speed &gt; 0.0f))) {
+	const float groundheight = ground-&gt;GetHeight2(unit-&gt;pos.x, unit-&gt;pos.z);
+
+	if (!mapDamage-&gt;disabled &amp;&amp; unitDef-&gt;levelGround &amp;&amp;
+		!(unitDef-&gt;floater &amp;&amp; groundheight &lt;= 0) &amp;&amp;
+		!(unitDef-&gt;canmove &amp;&amp; (unitDef-&gt;speed &gt; 0.0f))) {
+		// if we are float-capable, only flatten
+		// if the terrain here is above sea level
+
 		BuildInfo bi(unitDef, unit-&gt;pos, unit-&gt;buildFacing);
 		bi.pos = helper-&gt;Pos2BuildPos(bi);
 		const float hss = 0.5f * SQUARE_SIZE;

Modified: branches/caiinterface/rts/Sim/Units/UnitTypes/Builder.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/UnitTypes/Builder.cpp	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/Sim/Units/UnitTypes/Builder.cpp	2008-10-17 22:09:54 UTC (rev 6798)
@@ -560,9 +560,13 @@
 	CUnit* b = unitLoader.LoadUnit(nextBuildType, nextBuildPos, team,
 	                               true, buildInfo.buildFacing, this);
 
-	if (mapDamage-&gt;disabled || !unitDef-&gt;levelGround || unitDef-&gt;floater ||
+	// floating structures don't terraform the seabed
+	const float groundheight = ground-&gt;GetHeight2(b-&gt;pos.x, b-&gt;pos.z);
+	const bool onWater = (unitDef-&gt;floater &amp;&amp; groundheight &lt;= 0.0f);
+
+	if (mapDamage-&gt;disabled || !unitDef-&gt;levelGround || onWater ||
 	    (unitDef-&gt;canmove &amp;&amp; (unitDef-&gt;speed &gt; 0.0f))) {
-		// skip the terraforming job.
+		// skip the terraforming job
 		b-&gt;terraformLeft = 0;
 		b-&gt;groundLevelled=true;
 	}
@@ -600,8 +604,8 @@
 		 * Duplicated from CMoveType::SlowUpdate(), which
 		 * is why we use the regular code for floating things.
 		 */
-		curBuild-&gt;pos.y=ground-&gt;GetHeight2(curBuild-&gt;pos.x,curBuild-&gt;pos.z);
-		curBuild-&gt;midPos.y=curBuild-&gt;pos.y+curBuild-&gt;relMidPos.y;
+		curBuild-&gt;pos.y = groundheight;
+		curBuild-&gt;midPos.y = groundheight + curBuild-&gt;relMidPos.y;
 	}
 	else {
 		float d=nextBuildPos.y-curBuild-&gt;pos.y;

Modified: branches/caiinterface/rts/System/exportdefines.h
===================================================================
--- branches/caiinterface/rts/System/exportdefines.h	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/rts/System/exportdefines.h	2008-10-17 22:09:54 UTC (rev 6798)
@@ -20,7 +20,7 @@
 
 #ifdef	__cplusplus
 extern &quot;C&quot; {
-#endif	/* __cplusplus */
+#endif	// __cplusplus
 
 #define SPRING_CALLING_CONVENTION stdcall
 #define SPRING_CALLING_CONVENTION_2 __stdcall
@@ -28,23 +28,28 @@
 // extern declaration that will work across
 // different platforms and compilers
 #ifndef SHARED_EXPORT
-	#ifdef _WIN32
-		#define SHARED_EXPORT extern &quot;C&quot; __declspec(dllexport)
-		#define SPRING_API
-	#elif __GNUC__ &gt;= 4
-		// Support for '-fvisibility=hidden'.
-		#define SHARED_EXPORT extern &quot;C&quot; __attribute__ ((visibility(&quot;default&quot;)))
-		#define SPRING_API __attribute__ ((visibility(&quot;default&quot;)))
-	#else
-		// Older versions of gcc have everything visible; no need for fancy stuff.
-		#define SHARED_EXPORT extern &quot;C&quot;
-		#define SPRING_API
-	#endif
-#endif	/* SHARED_EXPORT */
+	#ifdef	__cplusplus
+		#ifdef _WIN32
+			#define SHARED_EXPORT extern &quot;C&quot; __declspec(dllexport)
+			#define SPRING_API
+		#elif __GNUC__ &gt;= 4
+			// Support for '-fvisibility=hidden'.
+			#define SHARED_EXPORT extern &quot;C&quot; __attribute__ ((visibility(&quot;default&quot;)))
+			#define SPRING_API __attribute__ ((visibility(&quot;default&quot;)))
+		#else
+			// Older versions of gcc have everything visible; no need for fancy stuff.
+			#define SHARED_EXPORT extern &quot;C&quot;
+			#define SPRING_API
+		#endif
+	#else	// __cplusplus
+		// we dont have t oexport if we are in C already
+		#define SHARED_EXPORT
+	#endif	// __cplusplus
+#endif	// SHARED_EXPORT
 
 #ifndef DLL_EXPORT
 	#define DLL_EXPORT SHARED_EXPORT
-#endif	/* DLL_EXPORT */
+#endif	// DLL_EXPORT
 
 
 // calling convention declaration that will work across
@@ -62,7 +67,7 @@
 	#else
 		#define CALLING_CONV SPRING_CALLING_CONVENTION_2
 	#endif
-#endif	/* CALLING_CONV */
+#endif	// CALLING_CONV
 	
 #ifndef CALLING_CONV_FUNC_POINTER
 	#ifdef __INTEL_COMPILER
@@ -70,7 +75,7 @@
 	#else
 		#define CALLING_CONV_FUNC_POINTER CALLING_CONV
 	#endif
-#endif	/* CALLING_CONV_FUNC_POINTER */
+#endif	// CALLING_CONV_FUNC_POINTER
 
 
 #define Export(type) SHARED_EXPORT type CALLING_CONV
@@ -78,7 +83,7 @@
 
 #ifdef	__cplusplus
 }
-#endif	/* __cplusplus */
+#endif	// __cplusplus
 
-#endif	/* _EXPORTDEFINES_H */
+#endif	// _EXPORTDEFINES_H
 

Modified: branches/caiinterface/tools/unitsync/CMakeLists.txt
===================================================================
--- branches/caiinterface/tools/unitsync/CMakeLists.txt	2008-10-17 20:00:24 UTC (rev 6797)
+++ branches/caiinterface/tools/unitsync/CMakeLists.txt	2008-10-17 22:09:54 UTC (rev 6798)
@@ -2,7 +2,7 @@
 	set (unitsync_libs glew32 opengl32 glu32 devil ilu python25)
 	set (PYTHONLIBS_FOUND TRUE) # Python libs are part of the mingwlibs package
 	INCLUDE_DIRECTORIES(${MINGWLIBS}/include/python2.5)
-	set (JNI_FOUND TRUE)
+	set (JAVA_FOUND TRUE)
 ELSE (MINGW)
 	FIND_PACKAGE(Freetype REQUIRED)
 	INCLUDE_DIRECTORIES(${FREETYPE_INCLUDE_DIR})
@@ -70,7 +70,7 @@
 	list(APPEND unitsync_files javabind)
 endif (JAVA_FOUND)
 ADD_LIBRARY(unitsync SHARED ${platformfiles} ${unitsync_files} ${fsfiles} unitsync LuaParserAPI Syncer SyncServer stdafx)
-TARGET_LINK_LIBRARIES(unitsync ${unitsync_libs} hpiutil2 7zip minizip lua ${Boost_REGEX_LIBRARY} ${IL_ILU_LIBRARY} ${SDL_LIBRARY})
+TARGET_LINK_LIBRARIES(unitsync ${unitsync_libs} hpiutil2 7zip minizip lua ${Boost_REGEX_LIBRARY} ${DEVIL_ILU_LIBRARY} ${SDL_LIBRARY})
 if (PYTHONLIBS_FOUND)
 	TARGET_LINK_LIBRARIES(unitsync ${PYTHON_LIBRARIES})
 endif (PYTHONLIBS_FOUND)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001566.html">[Taspring-linux-commit] r6797 - trunk/rts/lib/gml
</A></li>
	<LI>Next message: <A HREF="001568.html">[Taspring-linux-commit] r6799 -	branches/caiinterface/AI/Skirmish/KAIK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1567">[ date ]</a>
              <a href="thread.html#1567">[ thread ]</a>
              <a href="subject.html#1567">[ subject ]</a>
              <a href="author.html#1567">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
