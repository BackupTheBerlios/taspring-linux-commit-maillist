<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6665 - in branches/caiinterface: .	AI/Interfaces/C AI/Skirmish/KAIK-0.13 AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI-0.553	Documentation installer installer/sections rts/ExternalAI	rts/ExternalAI/Interface rts/Lua rts/Sim/Features	rts/Sim/Misc rts/Sim/Projectiles/Unsynced	rts/Sim/Units/CommandAI rts/build/scons rts/lib/streflop	tools tools/unitsync
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6665%20-%20in%20branches/caiinterface%3A%20.%0A%09AI/Interfaces/C%20AI/Skirmish/KAIK-0.13%20AI/Skirmish/NullAI%0A%09AI/Skirmish/NullLegacyCppAI%20AI/Skirmish/RAI-0.553%0A%09Documentation%20installer%20installer/sections%20rts/ExternalAI%0A%09rts/ExternalAI/Interface%20rts/Lua%20rts/Sim/Features%0A%09rts/Sim/Misc%20rts/Sim/Projectiles/Unsynced%0A%09rts/Sim/Units/CommandAI%20rts/build/scons%20rts/lib/streflop%0A%09tools%20tools/unitsync&In-Reply-To=%3C20081011114410.664B246F0%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001433.html">
   <LINK REL="Next"  HREF="001435.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6665 - in branches/caiinterface: .	AI/Interfaces/C AI/Skirmish/KAIK-0.13 AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI-0.553	Documentation installer installer/sections rts/ExternalAI	rts/ExternalAI/Interface rts/Lua rts/Sim/Features	rts/Sim/Misc rts/Sim/Projectiles/Unsynced	rts/Sim/Units/CommandAI rts/build/scons rts/lib/streflop	tools tools/unitsync</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6665%20-%20in%20branches/caiinterface%3A%20.%0A%09AI/Interfaces/C%20AI/Skirmish/KAIK-0.13%20AI/Skirmish/NullAI%0A%09AI/Skirmish/NullLegacyCppAI%20AI/Skirmish/RAI-0.553%0A%09Documentation%20installer%20installer/sections%20rts/ExternalAI%0A%09rts/ExternalAI/Interface%20rts/Lua%20rts/Sim/Features%0A%09rts/Sim/Misc%20rts/Sim/Projectiles/Unsynced%0A%09rts/Sim/Units/CommandAI%20rts/build/scons%20rts/lib/streflop%0A%09tools%20tools/unitsync&In-Reply-To=%3C20081011114410.664B246F0%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6665 - in branches/caiinterface: .	AI/Interfaces/C AI/Skirmish/KAIK-0.13 AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI-0.553	Documentation installer installer/sections rts/ExternalAI	rts/ExternalAI/Interface rts/Lua rts/Sim/Features	rts/Sim/Misc rts/Sim/Projectiles/Unsynced	rts/Sim/Units/CommandAI rts/build/scons rts/lib/streflop	tools tools/unitsync">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sat Oct 11 13:44:08 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001433.html">[Taspring-linux-commit] r6664 - trunk/rts/Rendering/Textures
</A></li>
        <LI>Next message: <A HREF="001435.html">[Taspring-linux-commit] r6666 - Lobby/TASClient Lobby/TASServer	Lobby/TASServer/Documentation trunk/Documentation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1434">[ date ]</a>
              <a href="thread.html#1434">[ thread ]</a>
              <a href="subject.html#1434">[ subject ]</a>
              <a href="author.html#1434">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-10-11 13:44:05 +0200 (Sat, 11 Oct 2008)
New Revision: 6665

Added:
   branches/caiinterface/AI/Interfaces/C/Log.cpp
   branches/caiinterface/AI/Interfaces/C/Log.h
Removed:
   branches/caiinterface/Lobby/
   branches/caiinterface/tools/RtsSettings/
   branches/caiinterface/tools/RtsSettingsWiz/
   branches/caiinterface/tools/XmlSettings/
Modified:
   branches/caiinterface/AI/Interfaces/C/Interface.cpp
   branches/caiinterface/AI/Interfaces/C/Interface.h
   branches/caiinterface/AI/Interfaces/C/InterfaceExport.cpp
   branches/caiinterface/AI/Interfaces/C/InterfaceExport.h
   branches/caiinterface/AI/Interfaces/C/InterfaceInfo.lua
   branches/caiinterface/AI/Skirmish/KAIK-0.13/AIExport.h
   branches/caiinterface/AI/Skirmish/KAIK-0.13/AIExports.cpp
   branches/caiinterface/AI/Skirmish/NullAI/AIExport.h
   branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h
   branches/caiinterface/AI/Skirmish/RAI-0.553/AIExport.cpp
   branches/caiinterface/AI/Skirmish/RAI-0.553/AIExport.h
   branches/caiinterface/Documentation/cmds.txt
   branches/caiinterface/Doxyfile
   branches/caiinterface/SConstruct
   branches/caiinterface/installer/make_source_package.sh
   branches/caiinterface/installer/sections/tasclient.nsh
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h
   branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp
   branches/caiinterface/rts/ExternalAI/GroupAILibrary.cpp
   branches/caiinterface/rts/ExternalAI/GroupAILibrary.h
   branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h
   branches/caiinterface/rts/ExternalAI/IAIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/IGroupAILibrary.h
   branches/caiinterface/rts/ExternalAI/ISkirmishAILibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp
   branches/caiinterface/rts/ExternalAI/Interface/SInfo.h
   branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/aidefines.h
   branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h
   branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp
   branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h
   branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.cpp
   branches/caiinterface/rts/Lua/LuaSyncedRead.cpp
   branches/caiinterface/rts/Sim/Features/FeatureHandler.cpp
   branches/caiinterface/rts/Sim/Misc/AirBaseHandler.cpp
   branches/caiinterface/rts/Sim/Misc/AirBaseHandler.h
   branches/caiinterface/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp
   branches/caiinterface/rts/Sim/Units/CommandAI/CommandAI.cpp
   branches/caiinterface/rts/build/scons/rts.py
   branches/caiinterface/rts/lib/streflop/Makefile.common
   branches/caiinterface/tools/unitsync/unitsync.cpp
Log:
- added static initialization and release methods to AI Interfaces
- renamed infos to info
- made AI Interfaces loading only depend on information in their InterfaceInfo.lua files
- some other minor changes
- KAIK currently crashing

Modified: branches/caiinterface/AI/Interfaces/C/Interface.cpp
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -17,30 +17,59 @@
 
 #include &quot;Interface.h&quot;
 
+#include &quot;Log.h&quot;
+
 #include &quot;ExternalAI/Interface/aidefines.h&quot;
 #include &quot;ExternalAI/Interface/SAIInterfaceLibrary.h&quot;
+#include &quot;ExternalAI/Interface/SStaticGlobalData.h&quot;
+#include &quot;System/Platform/SharedLib.h&quot;
 
-#include &quot;Log.h&quot;
-#include &quot;Platform/SharedLib.h&quot;
+#define MY_SHORT_NAME &quot;C&quot;
+#define MY_VERSION &quot;0.1&quot;
 
-CInterface::CInterface() {}
+CInterface::CInterface(const SStaticGlobalData* _staticGlobalData)
+		: staticGlobalData(_staticGlobalData) {
+	
+	std::string mainLibDir = std::string(staticGlobalData-&gt;libDir);
+	if (!mainLibDir.empty()) {
+		mainLibDir = mainLibDir + '/';
+	}
+	
+	// will look about like this: &quot;C:/Games/spring/AI/Interfaces/impls&quot;
+	//std::string myLibDir = mainLibDir + AI_INTERFACES_IMPLS_DIR;
+	// will look about like this: &quot;C:/Games/spring/AI/Skirmish/impls&quot;
+	skirmishAIsLibDir = mainLibDir + SKIRMISH_AI_IMPLS_DIR;
+	// will look about like this: &quot;C:/Games/spring/AI/Skirmish/impls&quot;
+	groupAIsLibDir = mainLibDir + GROUP_AI_IMPLS_DIR;
+	
+	std::string mainDataDir = &quot;&quot;;
+	if (staticGlobalData-&gt;numDataDirs &gt;= 1) {
+		mainDataDir = std::string(staticGlobalData-&gt;dataDirs[0]) + '/';
+	}
+	// will look about like this: &quot;C:/Games/spring/AI/Interfaces/data/C/0.1&quot;
+	std::string myDataDir = mainDataDir + AI_INTERFACES_DATA_DIR&quot;/&quot;MY_SHORT_NAME&quot;/&quot;MY_VERSION;
+	
+	std::string logFileName = myDataDir + &quot;/log.txt&quot;;
+	
+	initLog(logFileName.c_str());
+}
 
-int CInterface::GetInfos(InfoItem infos[], unsigned int max) {
+unsigned int CInterface::GetInfo(InfoItem info[], unsigned int maxInfoItems) {
 	
 	unsigned int i = 0;
 	
-	if (myInfos.empty()) {
-		InfoItem ii_0 = {AI_INTERFACE_PROPERTY_SHORT_NAME, &quot;C&quot;, NULL}; myInfos.push_back(ii_0);
-		InfoItem ii_1 = {AI_INTERFACE_PROPERTY_VERSION, &quot;0.1&quot;, NULL}; myInfos.push_back(ii_1);
-		InfoItem ii_2 = {AI_INTERFACE_PROPERTY_NAME, &quot;default C &amp; C++ (legacy and new)&quot;, NULL}; myInfos.push_back(ii_2);
-		InfoItem ii_3 = {AI_INTERFACE_PROPERTY_DESCRIPTION, &quot;This AI Interface library is needed for Skirmish and Group AIs written in C or C++.&quot;, NULL}; myInfos.push_back(ii_3);
-		InfoItem ii_4 = {AI_INTERFACE_PROPERTY_URL, &quot;<A HREF="http://spring.clan-sy.com/wiki/AIInterface:C">http://spring.clan-sy.com/wiki/AIInterface:C</A>&quot;, NULL}; myInfos.push_back(ii_4);
-		InfoItem ii_5 = {AI_INTERFACE_PROPERTY_SUPPORTED_LANGUAGES, &quot;C, C++&quot;, NULL}; myInfos.push_back(ii_5);
+	if (myInfo.empty()) {
+		InfoItem ii_0 = {AI_INTERFACE_PROPERTY_SHORT_NAME, MY_SHORT_NAME, NULL}; myInfo.push_back(ii_0);
+		InfoItem ii_1 = {AI_INTERFACE_PROPERTY_VERSION, MY_VERSION, NULL}; myInfo.push_back(ii_1);
+		InfoItem ii_2 = {AI_INTERFACE_PROPERTY_NAME, &quot;default C &amp; C++ (legacy and new)&quot;, NULL}; myInfo.push_back(ii_2);
+		InfoItem ii_3 = {AI_INTERFACE_PROPERTY_DESCRIPTION, &quot;This AI Interface library is needed for Skirmish and Group AIs written in C or C++.&quot;, NULL}; myInfo.push_back(ii_3);
+		InfoItem ii_4 = {AI_INTERFACE_PROPERTY_URL, &quot;<A HREF="http://spring.clan-sy.com/wiki/AIInterface:C">http://spring.clan-sy.com/wiki/AIInterface:C</A>&quot;, NULL}; myInfo.push_back(ii_4);
+		InfoItem ii_5 = {AI_INTERFACE_PROPERTY_SUPPORTED_LANGUAGES, &quot;C, C++&quot;, NULL}; myInfo.push_back(ii_5);
 	}
 	
 	std::vector&lt;InfoItem&gt;::const_iterator inf;
-	for (inf=myInfos.begin(); inf!=myInfos.end() &amp;&amp; i &lt; max; inf++) {
-		infos[i] = *inf;
+	for (inf=myInfo.begin(); inf!=myInfo.end() &amp;&amp; i &lt; maxInfoItems; inf++) {
+		info[i] = *inf;
 		i++;
 	}
 	
@@ -52,10 +81,10 @@
 	return LOS_Working;
 }
 
-void copyToInfoMap(std::map&lt;std::string, InfoItem&gt;&amp; infoMap, const InfoItem infos[], unsigned int numInfos) {
+void copyToInfoMap(std::map&lt;std::string, InfoItem&gt;&amp; infoMap, const InfoItem info[], unsigned int numInfoItems) {
 
-	for (unsigned int i=0; i &lt; numInfos; ++i) {
-		infoMap[infos[i].key] = copyInfoItem(&amp;(infos[i]));
+	for (unsigned int i=0; i &lt; numInfoItems; ++i) {
+		infoMap[info[i].key] = copyInfoItem(&amp;(info[i]));
 	}
 }
 SSAISpecifier extractSSAISpecifier(const std::map&lt;std::string, InfoItem&gt;&amp; infoMap) {
@@ -77,12 +106,13 @@
 	return specifier;
 }
 
-const SSAILibrary* CInterface::LoadSkirmishAILibrary(const InfoItem infos[], unsigned int numInfos) {
+const SSAILibrary* CInterface::LoadSkirmishAILibrary(const InfoItem info[],
+		unsigned int numInfoItems) {
 
 	SSAILibrary* ai;
 
 	std::map&lt;std::string, InfoItem&gt; infoMap;
-	copyToInfoMap(infoMap, infos, numInfos);
+	copyToInfoMap(infoMap, info, numInfoItems);
 	SSAISpecifier sAISpecifier = extractSSAISpecifier(infoMap);
 	mySkirmishAISpecifiers.push_back(sAISpecifier);
 	mySkirmishAIInfos[sAISpecifier] = infoMap;
@@ -126,12 +156,12 @@
 
 
 
-const SGAILibrary* CInterface::LoadGroupAILibrary(const struct InfoItem infos[], unsigned int numInfos) {
+const SGAILibrary* CInterface::LoadGroupAILibrary(const struct InfoItem info[], unsigned int numInfoItems) {
 
 	SGAILibrary* ai = NULL;
 
 	std::map&lt;std::string, InfoItem&gt; infoMap;
-	copyToInfoMap(infoMap, infos, numInfos);
+	copyToInfoMap(infoMap, info, numInfoItems);
 	SGAISpecifier gAISpecifier = extractSGAISpecifier(infoMap);
 	myGroupAISpecifiers.push_back(gAISpecifier);
 	myGroupAIInfos[gAISpecifier] = infoMap;
@@ -189,10 +219,10 @@
 	// initialize the AI library
 	std::string funcName;
 
-	funcName = &quot;getInfos&quot;;
-	skirmishAILibrary-&gt;getInfos = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (skirmishAILibrary-&gt;getInfos == NULL) {
-		// do nothing: this is permitted, if the AI supplies infos through an AIInfo.lua file
+	funcName = &quot;getInfo&quot;;
+	skirmishAILibrary-&gt;getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(struct InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (skirmishAILibrary-&gt;getInfo == NULL) {
+		// do nothing: this is permitted, if the AI supplies info through an AIInfo.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
 
@@ -246,10 +276,10 @@
 	// initialize the AI library
 	std::string funcName;
 	
-	funcName = &quot;getInfos&quot;;
-	groupAILibrary-&gt;getInfos = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
-	if (groupAILibrary-&gt;getInfos == NULL) {
-		// do nothing: this is permitted, if the AI supplies infos through an AIInfo.lua file
+	funcName = &quot;getInfo&quot;;
+	groupAILibrary-&gt;getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (groupAILibrary-&gt;getInfo == NULL) {
+		// do nothing: this is permitted, if the AI supplies info through an AIInfo.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
 	}
 	
@@ -308,8 +338,8 @@
 
 std::string CInterface::GenerateLibFilePath(const SSAISpecifier&amp; sAISpecifier) {
 	
-	static const std::string path = std::string(PATH_TO_SPRING_HOME&quot;&quot;SKIRMISH_AI_IMPLS_DIR&quot;/&quot;);
-	
+	// fetch the file from the info about this interface
+	// which were supplied to us by the engine
 	T_skirmishAIInfos::const_iterator info = mySkirmishAIInfos.find(sAISpecifier);
 	if (info == mySkirmishAIInfos.end()) {
 		reportError(std::string(&quot;Missing Skirmish-AI info for &quot;) + sAISpecifier.shortName + &quot; &quot; + sAISpecifier.version);
@@ -320,20 +350,19 @@
 	}
 	
 	std::string libFileName = fileName-&gt;second.value; // eg. RAI-0.600
-#ifndef _WIN32
-	libFileName = &quot;lib&quot; + libFileName; // eg. libRAI-0.600
-#endif
+	#ifndef _WIN32
+		libFileName = &quot;lib&quot; + libFileName; // eg. libRAI-0.600
+	#endif
 	
-	libFileName.append(&quot;.&quot;); // eg. libRAI-0.600.
-	libFileName.append(SharedLib::GetLibExtension()); // eg. libRAI-0.600.so
+	libFileName = libFileName + &quot;.&quot; + SharedLib::GetLibExtension(); // eg. libRAI-0.600.so
 	
-	return path + libFileName;
+	return skirmishAIsLibDir + &quot;/&quot; + libFileName;
 }
 
 std::string CInterface::GenerateLibFilePath(const SGAISpecifier&amp; gAISpecifier) {
 	
-	static const std::string path = std::string(PATH_TO_SPRING_HOME&quot;&quot;GROUP_AI_IMPLS_DIR&quot;/&quot;);
-	
+	// fetch the file from the info about this interface
+	// which were supplied to us by the engine
 	T_groupAIInfos::const_iterator info = myGroupAIInfos.find(gAISpecifier);
 	if (info == myGroupAIInfos.end()) {
 		reportError(std::string(&quot;Missing Group-AI info for &quot;) + gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
@@ -343,32 +372,31 @@
 		reportError(std::string(&quot;Missing Group-AI file name for &quot;) + gAISpecifier.shortName + &quot; &quot; + gAISpecifier.version);
 	}
 	
-	std::string libFileName = fileName-&gt;second.value; // eg. RAI-0.600
-#ifndef _WIN32
-	libFileName = &quot;lib&quot; + libFileName; // eg. libRAI-0.600
-#endif
+	std::string libFileName = fileName-&gt;second.value; // eg. MetalMaker-1.0
+	#ifndef _WIN32
+		libFileName = &quot;lib&quot; + libFileName; // eg. libMetalMaker-1.0
+	#endif
 	
-	libFileName.append(&quot;.&quot;); // eg. libRAI-0.600.
-	libFileName.append(SharedLib::GetLibExtension()); // eg. libRAI-0.600.so
+	libFileName = libFileName + &quot;.&quot; + SharedLib::GetLibExtension(); // eg. libMetalMaker-1.0.so
 	
-	return path + libFileName;
+	return groupAIsLibDir + &quot;/&quot; + libFileName;
 }
 
 SSAISpecifier CInterface::extractSpecifier(const SSAILibrary&amp; skirmishAILib) {
 	
 	SSAISpecifier skirmishAISpecifier;
 	
-	InfoItem infos[MAX_INFOS];
-	int numInfos =  skirmishAILib.getInfos(infos, MAX_INFOS);
+	InfoItem info[MAX_INFOS];
+	int numInfo =  skirmishAILib.getInfo(info, MAX_INFOS);
 
 	std::string spsn = std::string(SKIRMISH_AI_PROPERTY_SHORT_NAME);
 	std::string spv = std::string(SKIRMISH_AI_PROPERTY_VERSION);
-	for (int i=0; i &lt; numInfos; ++i) {
-		std::string key = std::string(infos[i].key);
+	for (int i=0; i &lt; numInfo; ++i) {
+		std::string key = std::string(info[i].key);
 		if (key == spsn) {
-			skirmishAISpecifier.shortName = infos[i].value;
+			skirmishAISpecifier.shortName = info[i].value;
 		} else if (key == spv) {
-			skirmishAISpecifier.version = infos[i].value;
+			skirmishAISpecifier.version = info[i].value;
 		}
 	}
 	
@@ -379,17 +407,17 @@
 	
 	SGAISpecifier groupAISpecifier;
 	
-	InfoItem infos[MAX_INFOS];
-	int numInfos =  groupAILib.getInfos(infos, MAX_INFOS);
+	InfoItem info[MAX_INFOS];
+	int numInfo =  groupAILib.getInfo(info, MAX_INFOS);
 
 	std::string spsn = std::string(GROUP_AI_PROPERTY_SHORT_NAME);
 	std::string spv = std::string(GROUP_AI_PROPERTY_VERSION);
-	for (int i=0; i &lt; numInfos; ++i) {
-		std::string key = std::string(infos[i].key);
+	for (int i=0; i &lt; numInfo; ++i) {
+		std::string key = std::string(info[i].key);
 		if (key == spsn) {
-			groupAISpecifier.shortName = infos[i].value;
+			groupAISpecifier.shortName = info[i].value;
 		} else if (key == spv) {
-			groupAISpecifier.version = infos[i].value;
+			groupAISpecifier.version = info[i].value;
 		}
 	}
 	
@@ -401,18 +429,18 @@
 	bool shortNameFits = false;
 	bool versionFits = false;
 	
-	InfoItem infos[MAX_INFOS];
-	int num = GetInfos(infos, MAX_INFOS);
+	InfoItem info[MAX_INFOS];
+	int num = GetInfo(info, MAX_INFOS);
 	
 	std::string shortNameKey(AI_INTERFACE_PROPERTY_SHORT_NAME);
 	std::string versionKey(AI_INTERFACE_PROPERTY_VERSION);
 	for (int i=0; i &lt; num; ++i) {
-		if (shortNameKey == infos[i].key) {
-			if (requestedShortName == infos[i].value) {
+		if (shortNameKey == info[i].key) {
+			if (requestedShortName == info[i].value) {
 				shortNameFits = true;
 			}
-		} else if (versionKey == infos[i].key) {
-			if (requestedVersion == infos[i].value) {
+		} else if (versionKey == info[i].key) {
+			if (requestedVersion == info[i].value) {
 				versionFits = true;
 			}
 		}

Modified: branches/caiinterface/AI/Interfaces/C/Interface.h
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Interfaces/C/Interface.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -27,23 +27,25 @@
 
 enum LevelOfSupport;
 class SharedLib;
+struct SStaticGlobalData;
 
 class CInterface {
 public:
-	CInterface();
+	//CInterface();
+	CInterface(const SStaticGlobalData* staticGlobalData);
 	
 	// static properties
-	int GetInfos(InfoItem infos[], unsigned int max);
+	unsigned int GetInfo(InfoItem info[], unsigned int maxInfoItems);
 	LevelOfSupport GetLevelOfSupportFor(
 			const char* engineVersion, int engineAIInterfaceGeneratedVersion);
 
 	// skirmish AI methods
-	const SSAILibrary* LoadSkirmishAILibrary(const struct InfoItem infos[], unsigned int numInfos);
+	const SSAILibrary* LoadSkirmishAILibrary(const struct InfoItem info[], unsigned int numInfoItems);
 	int UnloadSkirmishAILibrary(const SSAISpecifier* const sAISpecifier);
 	int UnloadAllSkirmishAILibraries();
 
 	// group AI methods
-	const SGAILibrary* LoadGroupAILibrary(const struct InfoItem infos[], unsigned int numInfos);
+	const SGAILibrary* LoadGroupAILibrary(const struct InfoItem info[], unsigned int numInfoItems);
 	int UnloadGroupAILibrary(const SGAISpecifier* const gAISpecifier);
 	int UnloadAllGroupAILibraries();
 
@@ -65,7 +67,10 @@
 
 	bool FitsThisInterface(const std::string&amp; requestedShortName, const std::string&amp; requestedVersion);
 private:
-	std::vector&lt;InfoItem&gt; myInfos;
+	const SStaticGlobalData* staticGlobalData;
+	std::string skirmishAIsLibDir;
+	std::string groupAIsLibDir;
+	std::vector&lt;InfoItem&gt; myInfo;
 
 	std::vector&lt;SSAISpecifier&gt; mySkirmishAISpecifiers;
 	typedef std::map&lt;SSAISpecifier, std::map&lt;std::string, InfoItem&gt;, SSAISpecifier_Comparator&gt; T_skirmishAIInfos;

Modified: branches/caiinterface/AI/Interfaces/C/InterfaceExport.cpp
===================================================================
--- branches/caiinterface/AI/Interfaces/C/InterfaceExport.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Interfaces/C/InterfaceExport.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -20,140 +20,51 @@
 #include &quot;Interface.h&quot;
 
 #include &quot;ExternalAI/Interface/SAIInterfaceLibrary.h&quot;
-/*
-#include &quot;ExternalAI/Interface/ELevelOfSupport.h&quot;
-#include &quot;ExternalAI/Interface/SSAILibrary.h&quot;
-#include &quot;ExternalAI/Interface/SGAILibrary.h&quot;
-*/
+#include &quot;ExternalAI/Interface/SStaticGlobalData.h&quot;
 
-/*
-If we do not have an init() method, then we would instead pass
-an event InitEvent to handleEvent. However, we would have to make
-handleEvent have to wait for an InitEvent as a special case, since
-the team in question would not yet exist. 
+CInterface* myInterface = NULL;
 
-Therefore, the handleEvent code would look like this:
-[code]
-SHARED_EXPORT int handleEvent(int team, int eventID, void* event) {
-    if (eventID == INIT_EVENT) {
-        ais[team] = CAIObject();
-    }
-    if (ais.count(team) &gt; 0){
-        // allow the AI instance to handle the event.
-        return ais[team].handleEvent(eventID, event);
-    }
-    // no ai with value, so return error.
-    else return -1;
+Export(int) initStatic(const SStaticGlobalData* staticGlobalData) {
+	
+	myInterface = new CInterface(staticGlobalData);
+	return 0;
 }
-[/code]
-Advantages:
-* All events to AI go through handleEvent.
-* People don't get confused and start adding bananaSplitz() functions.
 
-Disadvantages:
-* We need to check for INIT_EVENT before *every message*.
-* These events will happen only once per game -- after that the check becomes a necessary waste of time.
-* Handling events is no longer about getting the right object to deal with an event, it also includes initialising object properly.
+Export(int) releaseStatic() {
+	
+	delete myInterface;
+	myInterface = NULL;
+	return 0;
+}
 
-I understand that we want to keep the interface simple. In fact,
-I think we should keep it as minimal as possible, and ideally everything
-would go through handleEvent. Practically though, it does not make sense
-to do this: we'll be wasting our own time for no good reason in the
-case of initialisation. 
-
-The (in my opinion much cleaner) alternative is the one I've implemented.
-Advantages:
-* One function that initialises a team before everything is passed to handlEvent
-* No redundant if statements.
-* Simple design.
-
-Disadvantage:
-* People might start adding other functions to the interface.
-
-I don't think that the disadvantage is a real one: it's pretty standard to 
-see initialisation as a special case. It's pretty clear that everything
-else goes through handleEvent. 
-
-The advantage is clear: a more efficient, simpler design. Of course, you could
-argue that the efficiency is nominal, one extra if per event is very little cost,
-and granted, that's true; but this doesn't change the fact that we're checking
-for a special case that we know only happens once at the beginning of the game, before
-every single event after.
-
-Of course, we still need an INIT_EVENT, since initialising the existance of a team
-member is not the same as initialising its state.
-
-You might also argue that we do this check in the handleEvent switch within each
-team. This is true, although the difference there is that a switch is translated
-to address lookups and so there is no increase in cost if there are more switch
-cases. 
-*/
-
-// AI Interface vars
-/*
-const char* const myProperties[][2] = {
-	{AI_INTERFACE_PROPERTY_SHORT_NAME, &quot;C&quot;},
-	{AI_INTERFACE_PROPERTY_VERSION, &quot;0.1&quot;},
-	{AI_INTERFACE_PROPERTY_NAME, &quot;C &amp; C++&quot;},
-	{AI_INTERFACE_PROPERTY_DESCRIPTION, &quot;This AI Interface library is needed for Skirmish and Group AIs written in C or C++.&quot;},
-	{AI_INTERFACE_PROPERTY_URL, &quot;<A HREF="http://sy.spring.com/Wiki/CInterface">http://sy.spring.com/Wiki/CInterface</A>&quot;},
-	{&quot;supportedLanguages&quot;, &quot;C, C++&quot;}
-};
-const int numMyProperties = 6;
-*/
-
-
-/*
-// Skirmish AI vars
-const struct SSAISpecifier* mySAISpecifiers = NULL;
-const int numMySAISpecifiers;
-
-const struct SSAILibrary* mySAILibraries;
-const int numMySAILibraries;
-
-
-// Group AI vars
-const struct SGAISpecifier* myGAISpecifiers = NULL;
-const int numMyGAISpecifiers;
-
-const struct SGAILibrary* myGAILibraries;
-const int numMyGAILibraries;
-*/
-
-CInterface myInterface;
-
-/*
-#include &quot;stdio.h&quot;
-*/
-//#include &quot;&lt;iostream&gt;&quot;
-
 Export(enum LevelOfSupport) getLevelOfSupportFor(
 		const char* engineVersion, int engineAIInterfaceGeneratedVersion) {
-	return myInterface.GetLevelOfSupportFor(engineVersion, engineAIInterfaceGeneratedVersion);
+	return myInterface-&gt;GetLevelOfSupportFor(engineVersion, engineAIInterfaceGeneratedVersion);
 }
 
-Export(int) getInfos(InfoItem infos[], unsigned int max) {
-	return myInterface.GetInfos(infos, max);
+Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems) {
+	return myInterface-&gt;GetInfo(info, maxInfoItems);
 }
 
 
 // skirmish AI methods
 /*
 Export(int) getSkirmishAISpecifiers(struct SSAISpecifier* sAISpecifiers, int max) {
-	return myInterface.GetSkirmishAISpecifiers(sAISpecifiers, max);
+	return myInterface-&gt;GetSkirmishAISpecifiers(sAISpecifiers, max);
 }
 Export(const struct SSAILibrary*) loadSkirmishAILibrary(const struct SSAISpecifier* const sAISpecifier) {
-	return myInterface.LoadSkirmishAILibrary(sAISpecifier);
+	return myInterface-&gt;LoadSkirmishAILibrary(sAISpecifier);
 }
 */
-Export(const struct SSAILibrary*) loadSkirmishAILibrary(const struct InfoItem infos[], unsigned int numInfos) {
-	return myInterface.LoadSkirmishAILibrary(infos, numInfos);
+Export(const struct SSAILibrary*) loadSkirmishAILibrary(
+const struct InfoItem info[], unsigned int numInfoItems) {
+	return myInterface-&gt;LoadSkirmishAILibrary(info, numInfoItems);
 }
 Export(int) unloadSkirmishAILibrary(const struct SSAISpecifier* const sAISpecifier) {
-	return myInterface.UnloadSkirmishAILibrary(sAISpecifier);
+	return myInterface-&gt;UnloadSkirmishAILibrary(sAISpecifier);
 }
 Export(int) unloadAllSkirmishAILibraries() {
-	return myInterface.UnloadAllSkirmishAILibraries();
+	return myInterface-&gt;UnloadAllSkirmishAILibraries();
 }
 
 
@@ -161,19 +72,20 @@
 // group AI methods
 /*
 Export(int) getGroupAISpecifiers(struct SGAISpecifier* gAISpecifiers, int max) {
-	return myInterface.GetGroupAISpecifiers(gAISpecifiers, max);
+	return myInterface-&gt;GetGroupAISpecifiers(gAISpecifiers, max);
 }
 Export(const struct SGAILibrary*) loadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier) {
-	return myInterface.LoadGroupAILibrary(gAISpecifier);
+	return myInterface-&gt;LoadGroupAILibrary(gAISpecifier);
 }
 */
-Export(const struct SGAILibrary*) loadGroupAILibrary(const struct InfoItem infos[], unsigned int numInfos) {
-	return myInterface.LoadGroupAILibrary(infos, numInfos);
+Export(const struct SGAILibrary*) loadGroupAILibrary(
+const struct InfoItem info[], unsigned int numInfoItems) {
+	return myInterface-&gt;LoadGroupAILibrary(info, numInfoItems);
 }
 Export(int) unloadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier) {
-	return myInterface.UnloadGroupAILibrary(gAISpecifier);
+	return myInterface-&gt;UnloadGroupAILibrary(gAISpecifier);
 }
 Export(int) unloadAllGroupAILibraries() {
-	return myInterface.UnloadAllGroupAILibraries();
+	return myInterface-&gt;UnloadAllGroupAILibraries();
 }
 

Modified: branches/caiinterface/AI/Interfaces/C/InterfaceExport.h
===================================================================
--- branches/caiinterface/AI/Interfaces/C/InterfaceExport.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Interfaces/C/InterfaceExport.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -40,26 +40,30 @@
 struct SSAILibrary;
 struct SGAISpecifier;
 struct SGAILibrary;
+struct SStaticGlobalData;
 
 // for a list of the functions that have to be exported,
 // see struct SAIInterfaceLibrary in &quot;ExternalAI/Interface/SAIInterfaceLibrary.h&quot;
 
 // static AI interface library functions
+
+Export(int) initStatic(const SStaticGlobalData* staticGlobalData);
+Export(int) releaseStatic();
 Export(enum LevelOfSupport) getLevelOfSupportFor(
 		const char* engineVersion, int engineAIInterfaceGeneratedVersion);
-Export(int) getInfos(struct InfoItem infos[], unsigned int max);
+Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
 	
 // skirmish AI methods
 //Export(int) getSkirmishAISpecifiers(struct SSAISpecifier* sAISpecifiers, int max);
 //Export(const struct SSAILibrary*) loadSkirmishAILibrary(const struct SSAISpecifier* const sAISpecifier);
-Export(const struct SSAILibrary*) loadSkirmishAILibrary(const struct InfoItem infos[], unsigned int numInfos);
+Export(const struct SSAILibrary*) loadSkirmishAILibrary(const struct InfoItem info[], unsigned int numInfoItems);
 Export(int) unloadSkirmishAILibrary(const struct SSAISpecifier* const sAISpecifier);
 Export(int) unloadAllSkirmishAILibraries();
 	
 // group AI methods
 //Export(int) getGroupAISpecifiers(struct SGAISpecifier* gAISpecifiers, int max);
 //Export(const struct SGAILibrary*) loadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier);
-Export(const struct SGAILibrary*) loadGroupAILibrary(const struct InfoItem infos[], unsigned int numInfos);
+Export(const struct SGAILibrary*) loadGroupAILibrary(const struct InfoItem info[], unsigned int numInfoItems);
 Export(int) unloadGroupAILibrary(const struct SGAISpecifier* const gAISpecifier);
 Export(int) unloadAllGroupAILibraries();
 

Modified: branches/caiinterface/AI/Interfaces/C/InterfaceInfo.lua
===================================================================
--- branches/caiinterface/AI/Interfaces/C/InterfaceInfo.lua	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Interfaces/C/InterfaceInfo.lua	2008-10-11 11:44:05 UTC (rev 6665)
@@ -15,6 +15,11 @@
 
 local infos = {
 	{
+		key    = 'fileName',
+		value  = 'C-0.1',
+		desc   = 'base of the library file of this AI. &quot;C-0.1&quot; means &quot;AI/Interfaces/impls/libC-0.1.so&quot;, &quot;AI/Interfaces/impls/libC-0.1.dylib&quot; or &quot;AI/Interfaces/impls/C-0.1.dll&quot;',
+	},
+	{
 		key    = 'shortName',
 		value  = 'C',
 		desc   = 'machine conform name.',

Added: branches/caiinterface/AI/Interfaces/C/Log.cpp
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Log.cpp	                        (rev 0)
+++ branches/caiinterface/AI/Interfaces/C/Log.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -0,0 +1,53 @@
+/*
+	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+	
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &quot;Log.h&quot;
+
+#include &lt;stdio.h&gt;	// for file IO
+#include &lt;stdlib.h&gt;	// calloc(), exit()
+#include &lt;string.h&gt;	// strlen(), strcpy()
+
+const char* myLogFileName = NULL;
+
+void initLog(const char* _logFileName) {
+	
+	// NOTE: causeing a memory leack, as it is never freed.
+	// but it is used till the end of the applications runtime anyway
+	// -&gt; no problem
+	char* logFileName = (char*) calloc(strlen(_logFileName) + 1, sizeof(char));
+	strcpy(logFileName, _logFileName);
+	myLogFileName = logFileName;
+	
+	log(&quot;\nlog initialized&quot;);
+}
+
+void log(const char* msg) {
+	
+	if (myLogFileName != NULL) {
+		FILE* file = fopen(myLogFileName, &quot;a&quot;);
+		fprintf(file, &quot;%s\n&quot;, msg);
+		fclose(file);
+	} else {
+		printf(msg);
+	}
+}
+
+void logFatalError(const char* msg, int error) {
+	
+	log(msg);
+	exit(error);
+}


Property changes on: branches/caiinterface/AI/Interfaces/C/Log.cpp
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Interfaces/C/Log.h
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Log.h	                        (rev 0)
+++ branches/caiinterface/AI/Interfaces/C/Log.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -0,0 +1,47 @@
+/*
+	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+	
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef _LOG_H
+#define	_LOG_H
+
+#ifdef	__cplusplus
+extern &quot;C&quot; {
+#endif
+
+#define EXTERNAL_LOGGER(msg)	log(msg);
+
+/**
+ * Initializes the log.
+ */
+void initLog(const char* logFileName);
+
+/**
+ * Logs a text message.
+ */
+void log(const char* msg);
+
+/**
+ * Logs a text message and exits.
+ */
+void logFatalError(const char* msg, int error = -1);
+
+#ifdef	__cplusplus
+}
+#endif
+
+#endif	/* _LOG_H */
+


Property changes on: branches/caiinterface/AI/Interfaces/C/Log.h
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/AI/Skirmish/KAIK-0.13/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/KAIK-0.13/AIExport.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Skirmish/KAIK-0.13/AIExport.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -39,11 +39,12 @@
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-Export(unsigned int) getInfos(InfoItem infos[], unsigned int max);
+Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
 Export(enum LevelOfSupport) getLevelOfSupportFor(
 		const char* engineVersionString, int engineVersionNumber,
 		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-Export(unsigned int) getOptions(struct Option options[], unsigned int max);
+Export(unsigned int) getOptions(struct Option options[],
+		unsigned int maxOptions);
 
 // team instance functions
 Export(int) init(int teamId);

Modified: branches/caiinterface/AI/Skirmish/KAIK-0.13/AIExports.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/KAIK-0.13/AIExports.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Skirmish/KAIK-0.13/AIExports.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -32,31 +32,32 @@
 
 
 std::map&lt;int, CAIGlobalAI*&gt; myAIs; // teamId -&gt; AI map
-std::vector&lt;InfoItem&gt; myInfos;
+std::vector&lt;InfoItem&gt; myInfo;
 
 
-Export(unsigned int) getInfos(InfoItem infos[], unsigned int max) {
+Export(unsigned int) getInfo(struct InfoItem info[],
+		unsigned int maxInfoItems) {
 	
 	unsigned int i = 0;
 	
-	// initialize the myInfos
-	if (myInfos.empty()) {
-		InfoItem ii_0 = {SKIRMISH_AI_PROPERTY_SHORT_NAME, &quot;KAIK&quot;, NULL}; myInfos.push_back(ii_0);
-		InfoItem ii_1 = {SKIRMISH_AI_PROPERTY_VERSION, &quot;0.13&quot;, NULL}; myInfos.push_back(ii_1);
-		InfoItem ii_2 = {SKIRMISH_AI_PROPERTY_NAME, &quot;Kloots Skirmish AI&quot;, NULL}; myInfos.push_back(ii_2);
-		InfoItem ii_3 = {SKIRMISH_AI_PROPERTY_DESCRIPTION, &quot;This Skirmish AI supports most TA based mods and plays decently.&quot;, NULL}; myInfos.push_back(ii_3);
-		InfoItem ii_4 = {SKIRMISH_AI_PROPERTY_URL, &quot;<A HREF="http://spring.clan-sy.com/wiki/AI:KAIK">http://spring.clan-sy.com/wiki/AI:KAIK</A>&quot;, NULL}; myInfos.push_back(ii_4);
-		InfoItem ii_5 = {SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED, &quot;no&quot;, NULL}; myInfos.push_back(ii_5);
+	// initialize the myInfo
+	if (myInfo.empty()) {
+		InfoItem ii_0 = {SKIRMISH_AI_PROPERTY_SHORT_NAME, &quot;KAIK&quot;, NULL}; myInfo.push_back(ii_0);
+		InfoItem ii_1 = {SKIRMISH_AI_PROPERTY_VERSION, &quot;0.13&quot;, NULL}; myInfo.push_back(ii_1);
+		InfoItem ii_2 = {SKIRMISH_AI_PROPERTY_NAME, &quot;Kloots Skirmish AI&quot;, NULL}; myInfo.push_back(ii_2);
+		InfoItem ii_3 = {SKIRMISH_AI_PROPERTY_DESCRIPTION, &quot;This Skirmish AI supports most TA based mods and plays decently.&quot;, NULL}; myInfo.push_back(ii_3);
+		InfoItem ii_4 = {SKIRMISH_AI_PROPERTY_URL, &quot;<A HREF="http://spring.clan-sy.com/wiki/AI:KAIK">http://spring.clan-sy.com/wiki/AI:KAIK</A>&quot;, NULL}; myInfo.push_back(ii_4);
+		InfoItem ii_5 = {SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED, &quot;no&quot;, NULL}; myInfo.push_back(ii_5);
 	}
 	
-	// copy myInfos to the argument container infos
+	// copy myInfo to the argument container info
 	std::vector&lt;InfoItem&gt;::const_iterator inf;
-	for (inf=myInfos.begin(); inf!=myInfos.end() &amp;&amp; i &lt; max; inf++) {
-		infos[i] = *inf;
+	for (inf=myInfo.begin(); inf!=myInfo.end() &amp;&amp; i &lt; maxInfoItems; inf++) {
+		info[i] = *inf;
 		i++;
 	}
 
-	// return the number of elements copied to infos 
+	// return the number of elements copied to info 
 	return i;
 }
 
@@ -72,7 +73,8 @@
 	return LOS_None;
 }
 
-Export(unsigned int) getOptions(struct Option options[], unsigned int max) {
+Export(unsigned int) getOptions(struct Option options[],
+		unsigned int maxOptions) {
 	return 0;
 }
 

Modified: branches/caiinterface/AI/Skirmish/NullAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/NullAI/AIExport.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Skirmish/NullAI/AIExport.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -42,11 +42,11 @@
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-//Export(unsigned int) getInfos(InfoItem infos[], unsigned int max);
+//Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
 //Export(enum LevelOfSupport) getLevelOfSupportFor(
 //		const char* engineVersionString, int engineVersionNumber,
 //		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-//Export(unsigned int) getOptions(struct Option options[], unsigned int max);
+//Export(unsigned int) getOptions(struct Option options[], unsigned int maxOptions);
 
 // team instance functions
 //Export(int) init(int teamId);

Modified: branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Skirmish/NullLegacyCppAI/AIExport.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -39,11 +39,11 @@
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-//Export(unsigned int) getInfos(InfoItem infos[], unsigned int max);
+//Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
 //Export(enum LevelOfSupport) getLevelOfSupportFor(
 //		const char* engineVersionString, int engineVersionNumber,
 //		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-//Export(unsigned int) getOptions(struct Option options[], unsigned int max);
+//Export(unsigned int) getOptions(struct Option options[], unsigned int maxOptions);
 
 // team instance functions
 Export(int) init(int teamId);

Modified: branches/caiinterface/AI/Skirmish/RAI-0.553/AIExport.cpp
===================================================================
--- branches/caiinterface/AI/Skirmish/RAI-0.553/AIExport.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Skirmish/RAI-0.553/AIExport.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -34,42 +34,42 @@
 std::map&lt;int, CAIGlobalAI*&gt; myAIs; // teamId -&gt; AI map
 
 
-Export(unsigned int) getInfos(InfoItem infos[], unsigned int max) {
+Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems) {
 	
 	unsigned int i = 0;
 	
-	if (i &lt; max) {
+	if (i &lt; maxInfoItems) {
 		InfoItem ii = {SKIRMISH_AI_PROPERTY_SHORT_NAME, &quot;RAI&quot;, NULL};
-		infos[i] = ii;
+		info[i] = ii;
 		i++;
 	}
-	if (i &lt; max) {
+	if (i &lt; maxInfoItems) {
 		InfoItem ii = {SKIRMISH_AI_PROPERTY_VERSION, &quot;0.553&quot;, NULL};
-		infos[i] = ii;
+		info[i] = ii;
 		i++;
 	}
-	if (i &lt; max) {
+	if (i &lt; maxInfoItems) {
 		InfoItem ii = {SKIRMISH_AI_PROPERTY_NAME, &quot;Reths Skirmish AI&quot;, NULL};
-		infos[i] = ii;
+		info[i] = ii;
 		i++;
 	}
-	if (i &lt; max) {
+	if (i &lt; maxInfoItems) {
 		InfoItem ii = {SKIRMISH_AI_PROPERTY_DESCRIPTION, &quot;This Skirmish AI supports most mods and plays decently.&quot;, NULL};
-		infos[i] = ii;
+		info[i] = ii;
 		i++;
 	}
-	if (i &lt; max) {
+	if (i &lt; maxInfoItems) {
 		InfoItem ii = {SKIRMISH_AI_PROPERTY_URL, &quot;<A HREF="http://spring.clan-sy.com/wiki/AI:RAI">http://spring.clan-sy.com/wiki/AI:RAI</A>&quot;, NULL};
-		infos[i] = ii;
+		info[i] = ii;
 		i++;
 	}
-	if (i &lt; max) {
+	if (i &lt; maxInfoItems) {
 		InfoItem ii = {SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED, &quot;no&quot;, NULL};
-		infos[i] = ii;
+		info[i] = ii;
 		i++;
 	}
 	
-	// return the number of elements copied to infos 
+	// return the number of elements copied to info
 	return i;
 }
 

Modified: branches/caiinterface/AI/Skirmish/RAI-0.553/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/RAI-0.553/AIExport.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/AI/Skirmish/RAI-0.553/AIExport.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -39,11 +39,11 @@
 // see struct SSAILibrary in &quot;ExternalAI/Interface/SSAILibrary.h&quot;
 
 // static AI library methods (optional to implement)
-Export(unsigned int) getInfos(InfoItem infos[], unsigned int max);
+Export(unsigned int) getInfo(struct InfoItem info[], unsigned int maxInfoItems);
 Export(enum LevelOfSupport) getLevelOfSupportFor(
 		const char* engineVersionString, int engineVersionNumber,
 		const char* aiInterfaceShortName, const char* aiInterfaceVersion);
-Export(unsigned int) getOptions(struct Option options[], unsigned int max);
+Export(unsigned int) getOptions(struct Option options[], unsigned int maxOptions);
 
 // team instance functions
 Export(int) init(int teamId);

Modified: branches/caiinterface/Documentation/cmds.txt
===================================================================
--- branches/caiinterface/Documentation/cmds.txt	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/Documentation/cmds.txt	2008-10-11 11:44:05 UTC (rev 6665)
@@ -15,18 +15,18 @@
 /nospectatorchat [0|1]
 /setmaxspeed &lt;number&gt;
 /setminspeed &lt;number&gt;
-/skip &lt;[+|f]seconds&gt;  -- requires .cheat if not in a replay
-/take                 -- requires .cheat when used by spectators
+/skip &lt;[+|f]seconds&gt;  -- requires /cheat if not in a replay
+/take                 -- requires /cheat when used by spectators
+/forcestart
 
 -- lua scripts
-/luacob   &lt; &quot;reload&quot; | &quot;disable&quot; | &lt;custom command&gt; &gt;
 /luagaia  &lt; &quot;reload&quot; | &quot;disable&quot; | &lt;custom command&gt; &gt;
 /luarules &lt; &quot;reload&quot; | &quot;disable&quot; | &lt;custom command&gt; &gt;
-/devlua   [0|1]  -- requires .cheat, allows loading non-archived scripts
-/editdefs [0|1]  -- requires .cheat,
+/devlua   [0|1]  -- requires /cheat, allows loading non-archived scripts
+/editdefs [0|1]  -- requires /cheat,
                  -- allows lua writing to UnitDefs, FeatureDefs, and WeaponDefs
 
--- the following require .cheat
+-- the following require /cheat
 /atm
 /team &lt;number&gt;
 /spectator
@@ -34,6 +34,7 @@
 /reloadcob &lt;unit_name&gt;
 /give [count] &lt;unit_name | &quot;all&quot;&gt; [team]   {{ @x,y,z }}
 /godmode [0|1]
+/globalLOS [0|1] (needs cheats on)
 
 -- debugging
 /crash
@@ -48,207 +49,207 @@
 --
 --  LOCAL COMMANDS
 --
---  These commands can be bound to keysets, or sent on the
---  text input line by adding a slash prefix.
 --
---    ex:  /water 3
 --
---
 
-select &lt;select_string&gt;
+/commands
 
-selectunits [&quot;clear&quot;] [+unitID] [-unitID] ...
+/select &lt;select_string&gt;
+/selectunits [&quot;clear&quot;] [+unitID] [-unitID] ...
+/selectcycle [&quot;restore&quot;]
+/deselect
 
-selectcycle [&quot;restore&quot;]
+/info     [0|1|2|3|4|5]  -- disable, ally, team, name, cpu, ping  (sort modes)
+/tooltip  [0|1]
+/resbar   [0|1]
+/console  [0|1]
+/clock    [0|1]
+/fps      [0|1]
+/endgraph [0|1]
 
-deselect
+/setf &lt;name&gt; &lt;float value&gt;		-- Set a config variable (.springrc linux, Registry windows)
+/seti &lt;name&gt; &lt;integer value&gt;
+/sets &lt;name&gt; &lt;string value&gt;
 
-info     [0|1|2|3|4|5]  -- disable, ally, team, name, cpu, ping  (sort modes)
-tooltip  [0|1]
-resbar   [0|1]
-console  [0|1]
-clock    [0|1]
-fps      [0|1]
-endgraph [0|1]
+/quit
+/quitwarn
+/pause
 
-setf &lt;name&gt; &lt;float value&gt;		-- Set a config variable (.springrc linux, Registry windows)
-seti &lt;name&gt; &lt;integer value&gt;
-sets &lt;name&gt; &lt;string value&gt;
-
-quit
-quitwarn
-pause
-
-shadows [&lt;0|1&gt; [mapsize]]
-water   [0|1|2|3|4]
-vsync   [-1|0|1|2|...]  --  -1 will use default setting in windows,
+/shadows [&lt;0|1&gt; [mapsize]]
+/water   [0|1|2|3|4]
+/vsync   [-1|0|1|2|...]  --  -1 will use default setting in windows,
                         --  numbers higher then 1 will result in
                         --  rendering every N frames.
 
-say  &lt;message&gt;
-echo &lt;message&gt;
-w &lt;playername&gt; &lt;message&gt; -- Private Message
+/say  &lt;message&gt;
+/echo &lt;message&gt;
+/w &lt;playername&gt; &lt;message&gt; -- Private Message
 
-drawinmap
-drawlabel
+/ally teamID [0|1]
 
-mouse1
-mouse2
-mouse3
-mouse4
-mouse5
+/drawinmap
+/drawlabel
 
-mousestate
+/mouse1
+/mouse2
+/mouse3
+/mouse4
+/mouse5
 
-fpshud [0|1]
+/mousestate
 
-viewfps
-viewta
-viewtw
-viewrot
-viewsave view_name
-viewload view_name
-viewselection
+/fpshud [0|1]
 
-specteam &lt;int&gt;
+/viewfps
+/viewta
+/viewtw
+/viewrot
+/viewsave view_name
+/viewload view_name
+/viewselection
 
-group &lt;int&gt; [ &quot;set&quot; | &quot;add&quot; | &quot;selectadd&quot; | &quot;selectclear&quot; | &quot;selecttoggle&quot; ]
+/specteam &lt;int&gt;
 
-group0
-group1
-group2
-group3
-group4
-group5
-group6
-group7
-group8
-group9
+/group &lt;int&gt; [ &quot;set&quot; | &quot;add&quot; | &quot;selectadd&quot; | &quot;selectclear&quot; | &quot;selecttoggle&quot; ]
 
-chat
-chatall
-chatally
-chatspec
-chatswitchall
-chatswitchally
-chatswitchspec
+/group0
+/group1
+/group2
+/group3
+/group4
+/group5
+/group6
+/group7
+/group8
+/group9
 
-lastmsgpos
+/chat
+/chatall
+/chatally
+/chatspec
+/chatswitchall
+/chatswitchally
+/chatswitchspec
 
-track
-trackoff
-trackmode [0|1|2]
+/lastmsgpos
+/movewarnings [0|1]
 
-gameinfo
-gameinfoclose
+/track
+/trackoff
+/trackmode [0|1|2]
 
-cross &lt;size&gt;  -- locked mouse cross size
+/gameinfo
+/gameinfoclose
 
-volume &lt;float&gt;  -- 0.0 to 1.0
-unitreplyvolume &lt;float&gt;  -- 0.0 to 1.0
+/cross &lt;size&gt;  -- locked mouse cross size
 
-toggleoverview
-showhealthbars
-singlestep
-debug
-nosound
-savegame
-createvideo
-updatefov
-drawtrees
-dynamicsky
+/volume &lt;float&gt;  -- 0.0 to 1.0
+/unitreplyvolume &lt;float&gt;  -- 0.0 to 1.0
 
-hideinterface
-increaseviewradius
-decreaseviewradius
-moretrees
-lesstrees
-moreclouds
-lessclouds
-speedup
-slowdown
-controlunit
-showshadowmap
-showstandard
-showelevation
-showmetalmap
-showpathmap
-toggleradarandjammer
-yardmap4
-wiremap [0|1]
-lodscale [&quot;shadow&quot;|&quot;reflection&quot;|&quot;refraction&quot;] &lt;value&gt;
+/toggleoverview
+/showhealthbars
+/singlestep
+/debug
+/nosound
+/savegame
+/createvideo
+/updatefov
+/drawtrees
+/dynamicsky
 
-mapmarks [0|1]
+/hideinterface
+/increaseviewradius
+/decreaseviewradius
+/moretrees
+/lesstrees
+/moreclouds
+/lessclouds
+/speedup
+/slowdown
+/controlunit
+/showshadowmap
+/showstandard
+/showelevation
+/showmetalmap
+/showpathmap
+/toggleradarandjammer
+/yardmap4
+/wiremap [0|1]
+/lodscale [&quot;shadow&quot;|&quot;reflection&quot;|&quot;refraction&quot;] &lt;value&gt;
 
-togglelos
-sharedialog
+/mapmarks [0|1]
+/allmapmarks [0|1]
 
-incguiopacity
-decguiopacity
+/togglelos
+/sharedialog
 
-screenshot [&quot;png&quot;]
+/incguiopacity
+/decguiopacity
 
-grabinput
-hardwarecursor [0|1]
+/screenshot [&quot;png&quot;]
 
-bind
-unbind
-unbindall
-unbindkeyset
-unbindaction
-fakemeta
+/grabinput
+/hardwarecursor [0|1]
 
-keydebug
-keyload
-keyreload
-keysave
-keyprint
-keysyms
-keycodes
+/bind
+/unbind
+/unbindall
+/unbindkeyset
+/unbindaction
+/fakemeta
 
-cmdcolors [filename]
-ctrlpanel [filename]
-font      &lt;filename&gt;
+/keydebug
+/keyload
+/keyreload
+/keysave
+/keyprint
+/keysyms
+/keycodes
 
-gathermode [0|1]
+/cmdcolors [filename]
+/ctrlpanel [filename]
+/font      &lt;filename&gt;
 
-moveforward
-moveback
-moveleft
-moveright
-moveup
-movedown
-movefast
-moveslow
+/gathermode [0|1]
 
-minimap &lt;&quot;fullproxy&quot;&gt;    [0|1]
-minimap &lt;&quot;icons&quot;&gt;        [0|1]
-minimap &lt;&quot;drawcommands&quot;&gt; [0|1]
-minimap &lt;&quot;drawprojectiles&quot;&gt; [0|1]
-minimap &lt;&quot;simplecolors&quot;&gt; [0|1]
-minimap &lt;&quot;min&quot; | &quot;minimize&quot;&gt; [0|1]
-minimap &lt;&quot;max&quot; | &quot;maximize&quot;&gt; [0|1]
-minimap &lt;&quot;maxspect&quot;&gt; [0|1]
-minimap &lt;&quot;unitexp&quot;&gt; &lt;float&gt;
-minimap &lt;&quot;unitsize&quot;&gt; &lt;float&gt;
-minimap &lt;&quot;geo&quot; | &quot;geometry&quot;&gt; px py sx sy
-minimap &lt;&quot;slavemode&quot;&gt; [0|1]
-minimap &lt;&quot;draw&quot;&gt;
+/moveforward
+/moveback
+/moveleft
+/moveright
+/moveup
+/movedown
+/movefast
+/moveslow
 
-luaui &lt; &quot;reload&quot; | &quot;disable&quot; | &lt;custom command&gt; &gt;
-safegl [0|1]
+/minimap &lt;&quot;fullproxy&quot;&gt;    [0|1]
+/minimap &lt;&quot;icons&quot;&gt;        [0|1]
+/minimap &lt;&quot;drawcommands&quot;&gt; [0|1]
+/minimap &lt;&quot;drawprojectiles&quot;&gt; [0|1]
+/minimap &lt;&quot;simplecolors&quot;&gt; [0|1]
+/minimap &lt;&quot;min&quot; | &quot;minimize&quot;&gt; [0|1]
+/minimap &lt;&quot;max&quot; | &quot;maximize&quot;&gt; [0|1]
+/minimap &lt;&quot;maxspect&quot;&gt; [0|1]
+/minimap &lt;&quot;unitexp&quot;&gt; &lt;float&gt;
+/minimap &lt;&quot;unitsize&quot;&gt; &lt;float&gt;
+/minimap &lt;&quot;geo&quot; | &quot;geometry&quot;&gt; px py sx sy
+/minimap &lt;&quot;slavemode&quot;&gt; [0|1]
+/minimap &lt;&quot;draw&quot;&gt;
 
-pastetext  &lt;text&gt;  -- inserts the text into the text input  (ex: ctrl+v)
-buffertext &lt;text&gt;  -- inserts the text into the console history
+/luaui &lt; &quot;reload&quot; | &quot;disable&quot; | &lt;custom command&gt; &gt;
+/luamoduictrl [0|1] -- Enables LuaRules/LuaGaia access to many LuaUI callins/functions.
+/safegl [0|1]
 
-techlevels
+/pastetext  &lt;text&gt;  -- inserts the text into the text input  (ex: ctrl+v)
+/buffertext &lt;text&gt;  -- inserts the text into the console history
 
-grounddecals [0|1]
-maxparticles &lt;number&gt;
+/techlevels
 
-aiselect [ai_name]  -- ai_name required if used as a slash command
+/grounddecals [0|1]
+/maxparticles &lt;number&gt;
 
+/aiselect [ai_name]  -- ai_name required if used as a slash command
 
+
 --------------------------------------------------------------------------------
 --------------------------------------------------------------------------------
 --

Modified: branches/caiinterface/Doxyfile
===================================================================
--- branches/caiinterface/Doxyfile	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/Doxyfile	2008-10-11 11:44:05 UTC (rev 6665)
@@ -1,4 +1,4 @@
-# Doxyfile 1.5.4
+# Doxyfile 1.5.6
 
 # This file describes the settings to be used by the documentation system
 # doxygen (www.doxygen.org) for a project
@@ -14,11 +14,11 @@
 # Project related configuration options
 #---------------------------------------------------------------------------
 
-# This tag specifies the encoding used for all characters in the config file that 
-# follow. The default is UTF-8 which is also the encoding used for all text before 
-# the first occurrence of this tag. Doxygen uses libiconv (or the iconv built into 
-# libc) for the transcoding. See <A HREF="http://www.gnu.org/software/libiconv">http://www.gnu.org/software/libiconv</A> for the list of 
-# possible encodings.
+# This tag specifies the encoding used for all characters in the config file 
+# that follow. The default is UTF-8 which is also the encoding used for all 
+# text before the first occurrence of this tag. Doxygen uses libiconv (or the 
+# iconv built into libc) for the transcoding. See 
+# <A HREF="http://www.gnu.org/software/libiconv">http://www.gnu.org/software/libiconv</A> for the list of possible encodings.
 
 DOXYFILE_ENCODING      = UTF-8
 
@@ -54,10 +54,11 @@
 # information to generate all constant output in the proper language. 
 # The default language is English, other supported languages are: 
 # Afrikaans, Arabic, Brazilian, Catalan, Chinese, Chinese-Traditional, 
-# Croatian, Czech, Danish, Dutch, Finnish, French, German, Greek, Hungarian, 
-# Italian, Japanese, Japanese-en (Japanese with English messages), Korean, 
-# Korean-en, Lithuanian, Norwegian, Polish, Portuguese, Romanian, Russian, 
-# Serbian, Slovak, Slovene, Spanish, Swedish, and Ukrainian.
+# Croatian, Czech, Danish, Dutch, Farsi, Finnish, French, German, Greek, 
+# Hungarian, Italian, Japanese, Japanese-en (Japanese with English messages), 
+# Korean, Korean-en, Lithuanian, Norwegian, Macedonian, Persian, Polish, 
+# Portuguese, Romanian, Russian, Serbian, Slovak, Slovene, Spanish, Swedish, 
+# and Ukrainian.
 
 OUTPUT_LANGUAGE        = English
 
@@ -195,14 +196,26 @@
 OPTIMIZE_OUTPUT_FOR_C  = NO
 
 # Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java 
-# sources only. Doxygen will then generate output that is more tailored for Java. 
-# For instance, namespaces will be presented as packages, qualified scopes 
-# will look different, etc.
+# sources only. Doxygen will then generate output that is more tailored for 
+# Java. For instance, namespaces will be presented as packages, qualified 
+# scopes will look different, etc.
 
 OPTIMIZE_OUTPUT_JAVA   = NO
 
-# If you use STL classes (i.e. std::string, std::vector, etc.) but do not want to 
-# include (a tag file for) the STL sources as input, then you should 
+# Set the OPTIMIZE_FOR_FORTRAN tag to YES if your project consists of Fortran 
+# sources only. Doxygen will then generate output that is more tailored for 
+# Fortran.
+
+OPTIMIZE_FOR_FORTRAN   = NO
+
+# Set the OPTIMIZE_OUTPUT_VHDL tag to YES if your project consists of VHDL 
+# sources. Doxygen will then generate output that is tailored for 
+# VHDL.
+
+OPTIMIZE_OUTPUT_VHDL   = NO
+
+# If you use STL classes (i.e. std::string, std::vector, etc.) but do not want 
+# to include (a tag file for) the STL sources as input, then you should 
 # set this tag to YES in order to let doxygen match functions declarations and 
 # definitions whose arguments contain STL classes (e.g. func(std::string); v.s. 
 # func(std::string) {}). This also make the inheritance and collaboration 
@@ -221,6 +234,15 @@
 
 SIP_SUPPORT            = NO
 
+# For Microsoft's IDL there are propget and propput attributes to indicate getter 
+# and setter methods for a property. Setting this option to YES (the default) 
+# will make doxygen to replace the get and set methods by a property in the 
+# documentation. This will only work if the methods are indeed getting or 
+# setting a simple type. If this is not the case, or you want to show the 
+# methods anyway, you should set this option to NO.
+
+IDL_PROPERTY_SUPPORT   = YES
+
 # If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC 
 # tag is set to YES, then doxygen will reuse the documentation of the first 
 # member in the group (if any) for the other members of the group. By default 
@@ -236,13 +258,13 @@
 
 SUBGROUPING            = YES
 
-# When TYPEDEF_HIDES_STRUCT is enabled, a typedef of a struct (or union) is 
-# documented as struct with the name of the typedef. So 
+# When TYPEDEF_HIDES_STRUCT is enabled, a typedef of a struct, union, or enum 
+# is documented as struct, union, or enum with the name of the typedef. So 
 # typedef struct TypeS {} TypeT, will appear in the documentation as a struct 
 # with name TypeT. When disabled the typedef will appear as a member of a file, 
 # namespace, or class. And the struct will be named TypeS. This can typically 
-# be useful for C code where the coding convention is that all structs are 
-# typedef'ed and only the typedef is referenced never the struct's name.
+# be useful for C code in case the coding convention dictates that all compound 
+# types are typedef'ed and only the typedef is referenced, never the tag name.
 
 TYPEDEF_HIDES_STRUCT   = NO
 
@@ -280,10 +302,11 @@
 
 EXTRACT_LOCAL_METHODS  = NO
 
-# If this flag is set to YES, the members of anonymous namespaces will be extracted 
-# and appear in the documentation as a namespace called 'anonymous_namespace{file}', 
-# where file will be replaced with the base name of the file that contains the anonymous 
-# namespace. By default anonymous namespace are hidden.
+# If this flag is set to YES, the members of anonymous namespaces will be 
+# extracted and appear in the documentation as a namespace called 
+# 'anonymous_namespace{file}', where file will be replaced with the base 
+# name of the file that contains the anonymous namespace. By default 
+# anonymous namespace are hidden.
 
 EXTRACT_ANON_NSPACES   = NO
 
@@ -362,6 +385,12 @@
 
 SORT_BRIEF_DOCS        = NO
 
+# If the SORT_GROUP_NAMES tag is set to YES then doxygen will sort the 
+# hierarchy of group names into alphabetical order. If set to NO (the default) 
+# the group names will appear in their defined order.
+
+SORT_GROUP_NAMES       = NO
+
 # If the SORT_BY_SCOPE_NAME tag is set to YES, the class list will be 
 # sorted by fully-qualified names, including namespaces. If set to 
 # NO (the default), the class list will be sorted only by class name, 
@@ -423,9 +452,21 @@
 
 SHOW_DIRECTORIES       = YES
 
+# Set the SHOW_FILES tag to NO to disable the generation of the Files page.
+# This will remove the Files entry from the Quick Index and from the 
+# Folder Tree View (if specified). The default is YES.
+
+SHOW_FILES             = YES
+
+# Set the SHOW_NAMESPACES tag to NO to disable the generation of the 
+# Namespaces page.  This will remove the Namespaces entry from the Quick Index
+# and from the Folder Tree View (if specified). The default is YES.
+
+SHOW_NAMESPACES        = YES
+
 # The FILE_VERSION_FILTER tag can be used to specify a program or script that 
-# doxygen should invoke to get the current version for each file (typically from the 
-# version control system). Doxygen will invoke the program by executing (via 
+# doxygen should invoke to get the current version for each file (typically from 
+# the version control system). Doxygen will invoke the program by executing (via 
 # popen()) the command &lt;command&gt; &lt;input-file&gt;, where &lt;command&gt; is the value of 
 # the FILE_VERSION_FILTER tag, and &lt;input-file&gt; is the name of an input file 
 # provided by doxygen. Whatever the program writes to standard output 
@@ -495,10 +536,11 @@
 
 INPUT                  = rts
 
-# This tag can be used to specify the character encoding of the source files that 
-# doxygen parses. Internally doxygen uses the UTF-8 encoding, which is also the default 
-# input encoding. Doxygen uses libiconv (or the iconv built into libc) for the transcoding. 
-# See <A HREF="http://www.gnu.org/software/libiconv">http://www.gnu.org/software/libiconv</A> for the list of possible encodings.
+# This tag can be used to specify the character encoding of the source files 
+# that doxygen parses. Internally doxygen uses the UTF-8 encoding, which is 
+# also the default input encoding. Doxygen uses libiconv (or the iconv built 
+# into libc) for the transcoding. See <A HREF="http://www.gnu.org/software/libiconv">http://www.gnu.org/software/libiconv</A> for 
+# the list of possible encodings.
 
 INPUT_ENCODING         = UTF-8
 
@@ -538,9 +580,10 @@
 EXCLUDE_PATTERNS       = 
 
 # The EXCLUDE_SYMBOLS tag can be used to specify one or more symbol names 
-# (namespaces, classes, functions, etc.) that should be excluded from the output. 
-# The symbol name can be a fully qualified name, a word, or if the wildcard * is used, 
-# a substring. Examples: ANamespace, AClass, AClass::ANamespace, ANamespace::*Test
+# (namespaces, classes, functions, etc.) that should be excluded from the 
+# output. The symbol name can be a fully qualified name, a word, or if the 
+# wildcard * is used, a substring. Examples: ANamespace, AClass, 
+# AClass::ANamespace, ANamespace::*Test
 
 EXCLUDE_SYMBOLS        = 
 
@@ -602,9 +645,7 @@
 # If the SOURCE_BROWSER tag is set to YES then a list of source files will 
 # be generated. Documented entities will be cross-referenced with these sources. 
 # Note: To get rid of all source code in the generated output, make sure also 
-# VERBATIM_HEADERS is set to NO. If you have enabled CALL_GRAPH or CALLER_GRAPH 
-# then you must also enable this option. If you don't then doxygen will produce 
-# a warning and turn it on anyway
+# VERBATIM_HEADERS is set to NO.
 
 SOURCE_BROWSER         = YES
 
@@ -619,13 +660,13 @@
 
 STRIP_CODE_COMMENTS    = YES
 
-# If the REFERENCED_BY_RELATION tag is set to YES (the default) 
+# If the REFERENCED_BY_RELATION tag is set to YES 
 # then for each documented function all documented 
 # functions referencing it will be listed.
 
 REFERENCED_BY_RELATION = YES
 
-# If the REFERENCES_RELATION tag is set to YES (the default) 
+# If the REFERENCES_RELATION tag is set to YES 
 # then for each documented function all documented entities 
 # called/used by that function will be listed.
 
@@ -725,11 +766,36 @@
 
 # If the GENERATE_HTMLHELP tag is set to YES, additional index files 
 # will be generated that can be used as input for tools like the 
-# Microsoft HTML help workshop to generate a compressed HTML help file (.chm) 
+# Microsoft HTML help workshop to generate a compiled HTML help file (.chm) 
 # of the generated HTML documentation.
 
 GENERATE_HTMLHELP      = NO
 
+# If the GENERATE_DOCSET tag is set to YES, additional index files 
+# will be generated that can be used as input for Apple's Xcode 3 
+# integrated development environment, introduced with OSX 10.5 (Leopard). 
+# To create a documentation set, doxygen will generate a Makefile in the 
+# HTML output directory. Running make will produce the docset in that 
+# directory and running &quot;make install&quot; will install the docset in 
+# ~/Library/Developer/Shared/Documentation/DocSets so that Xcode will find 
+# it at startup.
+
+GENERATE_DOCSET        = NO
+
+# When GENERATE_DOCSET tag is set to YES, this tag determines the name of the 
+# feed. A documentation feed provides an umbrella under which multiple 
+# documentation sets from a single provider (such as a company or product suite) 
+# can be grouped.
+
+DOCSET_FEEDNAME        = &quot;Doxygen generated docs&quot;
+
+# When GENERATE_DOCSET tag is set to YES, this tag specifies a string that 
+# should uniquely identify the documentation set bundle. This should be a 
+# reverse domain-name style string, e.g. com.mycompany.MyDocSet. Doxygen 
+# will append .docset to the name.
+
+DOCSET_BUNDLE_ID       = org.doxygen.Project
+
 # If the HTML_DYNAMIC_SECTIONS tag is set to YES then the generated HTML 
 # documentation will contain sections that can be hidden and shown after the 
 # page has loaded. For this to work a browser that supports 
@@ -758,6 +824,12 @@
 
 GENERATE_CHI           = NO
 
+# If the GENERATE_HTMLHELP tag is set to YES, the CHM_INDEX_ENCODING
+# is used to encode HtmlHelp index (hhk), content (hhc) and project file
+# content.
+
+CHM_INDEX_ENCODING     = 
+
 # If the GENERATE_HTMLHELP tag is set to YES, the BINARY_TOC flag 
 # controls whether a binary table of contents is generated (YES) or a 
 # normal table of contents (NO) in the .chm file.
@@ -780,12 +852,20 @@
 
 ENUM_VALUES_PER_LINE   = 4
 
-# If the GENERATE_TREEVIEW tag is set to YES, a side panel will be
-# generated containing a tree-like index structure (just like the one that 
+# The GENERATE_TREEVIEW tag is used to specify whether a tree-like index
+# structure should be generated to display hierarchical information.
+# If the tag value is set to FRAME, a side panel will be generated
+# containing a tree-like index structure (just like the one that 
 # is generated for HTML Help). For this to work a browser that supports 
 # JavaScript, DHTML, CSS and frames is required (for instance Mozilla 1.0+, 
 # Netscape 6.0+, Internet explorer 5.0+, or Konqueror). Windows users are 
-# probably better off using the HTML help feature.
+# probably better off using the HTML help feature. Other possible values 
+# for this tag are: HIERARCHIES, which will generate the Groups, Directories,
+# and Class Hiererachy pages using a tree view instead of an ordered list;
+# ALL, which combines the behavior of FRAME and HIERARCHIES; and NONE, which
+# disables this behavior completely. For backwards compatibility with previous
+# releases of Doxygen, the values YES and NO are equivalent to FRAME and NONE
+# respectively.
 
 GENERATE_TREEVIEW      = YES
 
@@ -795,6 +875,14 @@
 
 TREEVIEW_WIDTH         = 250
 
+# Use this tag to change the font size of Latex formulas included 
+# as images in the HTML documentation. The default is 10. Note that 
+# when you change the font size after a successful doxygen run you need 
+# to manually remove any form_*.png images from the HTML output directory 
+# to force them to be regenerated.
+
+FORMULA_FONTSIZE       = 10
+
 #---------------------------------------------------------------------------
 # configuration options related to the LaTeX output
 #---------------------------------------------------------------------------
@@ -1144,10 +1232,11 @@
 CLASS_DIAGRAMS         = YES
 
 # You can define message sequence charts within doxygen comments using the \msc 
-# command. Doxygen will then run the mscgen tool (see <A HREF="http://www.mcternan.me.uk/mscgen/">http://www.mcternan.me.uk/mscgen/</A>) to 
-# produce the chart and insert it in the documentation. The MSCGEN_PATH tag allows you to 
-# specify the directory where the mscgen tool resides. If left empty the tool is assumed to 
-# be found in the default search path.
+# command. Doxygen will then run the mscgen tool (see 
+# <A HREF="http://www.mcternan.me.uk/mscgen/">http://www.mcternan.me.uk/mscgen/</A>) to produce the chart and insert it in the 
+# documentation. The MSCGEN_PATH tag allows you to specify the directory where 
+# the mscgen tool resides. If left empty the tool is assumed to be found in the 
+# default search path.
 
 MSCGEN_PATH            = 
 
@@ -1164,6 +1253,24 @@
 
 HAVE_DOT               = YES
 
+# By default doxygen will write a font called FreeSans.ttf to the output 
+# directory and reference it in all dot files that doxygen generates. This 
+# font does not include all possible unicode characters however, so when you need 
+# these (or just want a differently looking font) you can specify the font name 
+# using DOT_FONTNAME. You need need to make sure dot is able to find the font, 
+# which can be done by putting it in a standard location or by setting the 
+# DOTFONTPATH environment variable or by setting DOT_FONTPATH to the directory 
+# containing the font.
+
+DOT_FONTNAME           = FreeSans
+
+# By default doxygen will tell dot to use the output directory to look for the 
+# FreeSans.ttf font (which doxygen will put there itself). If you specify a 
+# different font using DOT_FONTNAME you can set the path where dot 
+# can find it using this tag.
+
+DOT_FONTPATH           = 
+
 # If the CLASS_GRAPH and HAVE_DOT tags are set to YES then doxygen 
 # will generate a graph for each documented class showing the direct and 
 # indirect inheritance relations. Setting this tag to YES will force the 
@@ -1208,19 +1315,19 @@
 
 INCLUDED_BY_GRAPH      = YES
 
-# If the CALL_GRAPH, SOURCE_BROWSER and HAVE_DOT tags are set to YES then doxygen will 
-# generate a call dependency graph for every global function or class method. 
-# Note that enabling this option will significantly increase the time of a run. 
-# So in most cases it will be better to enable call graphs for selected 
-# functions only using the \callgraph command.
+# If the CALL_GRAPH and HAVE_DOT options are set to YES then 
+# doxygen will generate a call dependency graph for every global function 
+# or class method. Note that enabling this option will significantly increase 
+# the time of a run. So in most cases it will be better to enable call graphs 
+# for selected functions only using the \callgraph command.
 
 CALL_GRAPH             = YES
 
-# If the CALLER_GRAPH, SOURCE_BROWSER and HAVE_DOT tags are set to YES then doxygen will 
-# generate a caller dependency graph for every global function or class method. 
-# Note that enabling this option will significantly increase the time of a run. 
-# So in most cases it will be better to enable caller graphs for selected 
-# functions only using the \callergraph command.
+# If the CALLER_GRAPH and HAVE_DOT tags are set to YES then 
+# doxygen will generate a caller dependency graph for every global function 
+# or class method. Note that enabling this option will significantly increase 
+# the time of a run. So in most cases it will be better to enable caller 
+# graphs for selected functions only using the \callergraph command.
 
 CALLER_GRAPH           = YES
 
@@ -1253,12 +1360,12 @@
 
 DOTFILE_DIRS           = 
 
-# The MAX_DOT_GRAPH_MAX_NODES tag can be used to set the maximum number of 
+# The DOT_GRAPH_MAX_NODES tag can be used to set the maximum number of 
 # nodes that will be shown in the graph. If the number of nodes in a graph 
 # becomes larger than this value, doxygen will truncate the graph, which is 
-# visualized by representing a node as a red box. Note that doxygen if the number 
-# of direct children of the root node in a graph is already larger than 
-# MAX_DOT_GRAPH_NOTES then the graph will not be shown at all. Also note 
+# visualized by representing a node as a red box. Note that doxygen if the 
+# number of direct children of the root node in a graph is already larger than 
+# DOT_GRAPH_MAX_NODES then the graph will not be shown at all. Also note 
 # that the size of a graph can be further restricted by MAX_DOT_GRAPH_DEPTH.
 
 DOT_GRAPH_MAX_NODES    = 50
@@ -1274,10 +1381,10 @@
 MAX_DOT_GRAPH_DEPTH    = 0
 
 # Set the DOT_TRANSPARENT tag to YES to generate images with a transparent 
-# background. This is disabled by default, which results in a white background. 
-# Warning: Depending on the platform used, enabling this option may lead to 
-# badly anti-aliased labels on the edges of a graph (i.e. they become hard to 
-# read).
+# background. This is enabled by default, which results in a transparent 
+# background. Warning: Depending on the platform used, enabling this option 
+# may lead to badly anti-aliased labels on the edges of a graph (i.e. they 
+# become hard to read).
 
 DOT_TRANSPARENT        = NO
 

Modified: branches/caiinterface/SConstruct
===================================================================
--- branches/caiinterface/SConstruct	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/SConstruct	2008-10-11 11:44:05 UTC (rev 6665)
@@ -404,12 +404,17 @@
 ### Build streflop (which has it's own Makefile-based build system)
 if not 'configure' in sys.argv and not 'test' in sys.argv and not 'install' in sys.argv:
 	cmd = &quot;CC=&quot; + env['CC'] + &quot; CXX=&quot; + env['CXX'] + &quot; --no-print-directory -C rts/lib/streflop&quot;
+	if env.has_key('streflop_extra'):
+		cmd += &quot; &quot; + env['streflop_extra']
 	if env['fpmath'] == 'sse':
 		cmd = &quot;STREFLOP_SSE=1 &quot; + cmd
 	else:
 		cmd = &quot;STREFLOP_X87=1 &quot; + cmd
+	if env['platform'] == 'windows':
+		cmd += &quot; WIN32=1&quot;
 	if env.GetOption('clean'):
 		cmd += &quot; clean&quot;
+	print 'streflop options:', cmd
 	if env['platform'] == 'freebsd':
 		status = os.system(&quot;gmake &quot; + cmd)
 	else:
@@ -489,7 +494,7 @@
 # install menu entry &amp; icon
 inst = env.Install(os.path.join(env['installprefix'], 'share/pixmaps'), 'rts/spring.png')
 Alias('install', inst)
-inst = env.Install(os.path.join(env['installprefix'], 'share/applications'), 'rts/spring.desktop')
+inst = env.Install(os.path.join(env['installprefix'], 'share/applications'), 'installer/freedesktop/applications/spring.desktop')
 Alias('install', inst)
 
 # install LuaUI files

Modified: branches/caiinterface/installer/make_source_package.sh
===================================================================
--- branches/caiinterface/installer/make_source_package.sh	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/installer/make_source_package.sh	2008-10-11 11:44:05 UTC (rev 6665)
@@ -38,9 +38,10 @@
 # (directories are included recursively)
 include=&quot; \
  $dir/AI/Group/ \
- $dir/AI/Global/AAI/ \
- $dir/AI/Global/KAIK-0.13/ \
- $dir/AI/Global/TestGlobalAI/ \
+ $dir/AI/Interfaces/C/ \
+ $dir/AI/Skirmish/AAI/ \
+ $dir/AI/Skirmish/KAIK/ \
+ $dir/AI/Skirmish/NullAI/ \
  $dir/Documentation/ \
  $dir/Doxyfile \
  $dir/game/ \
@@ -49,17 +50,20 @@
  $dir/README.* \
  $dir/rts/ \
  $dir/SConstruct \
- $dir/tools/RtsSettings/ \
  $dir/tools/SelectionEditor/ \
+ $dir/CMakeLists.txt \
+ $dir/AI/CMakeLists.txt \
+ $dir/AI/Interfaces/CMakeLists.txt \
+ $dir/AI/Skirmish/CMakeLists.txt \
  $dir/tools/unitsync/ \
- $dir/Lobby/TASServer/&quot;
+ $dir/tools/DedicatedServer/&quot;
 
 # On linux, win32 executables are useless.
 # TASClient is windows only.
-linux_exclude=&quot;$dir/installer/pkzip.exe $dir/Lobby/TASClient/brcc32.exe&quot;
+linux_exclude=&quot;$dir/installer/pkzip.exe&quot;
 linux_include=&quot;&quot;
 windows_exclude=&quot;&quot;
-windows_include=&quot;$dir/Lobby/TASClient/&quot;
+windows_include=&quot;&quot;
 
 # Linux line endings, .tar.{bz2,gz} package.
 echo 'Exporting checkout dir with LF line endings'

Modified: branches/caiinterface/installer/sections/tasclient.nsh
===================================================================
--- branches/caiinterface/installer/sections/tasclient.nsh	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/installer/sections/tasclient.nsh	2008-10-11 11:44:05 UTC (rev 6665)
@@ -19,8 +19,8 @@
   CreateDirectory &quot;$INSTDIR\lobby\python\&quot;
 
   SetOutPath &quot;$INSTDIR\lobby\var&quot;
-  File &quot;..\Lobby\TASClient\lobby\var\groups.ini&quot;
-  File &quot;..\Lobby\TASClient\lobby\var\tips.txt&quot;
+  File &quot;..\external\TASClient\groups.ini&quot;
+  File &quot;..\external\TASClient\tips.txt&quot;
 
   Call GetDotNETVersion
   Pop $0

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -19,37 +19,47 @@
 
 #include &quot;Interface/aidefines.h&quot;
 #include &quot;Interface/SAIInterfaceLibrary.h&quot;
+#include &quot;Interface/SStaticGlobalData.h&quot;
 #include &quot;SkirmishAILibrary.h&quot;
 #include &quot;GroupAILibrary.h&quot;
+#include &quot;AIInterfaceLibraryInfo.h&quot;
 #include &quot;SkirmishAILibraryInfo.h&quot;
 #include &quot;GroupAILibraryInfo.h&quot;
 
-#include &quot;Util.h&quot;
-#include &quot;Platform/errorhandler.h&quot;
+#include &quot;System/Util.h&quot;
+#include &quot;System/Platform/errorhandler.h&quot;
 
 #include &lt;string&gt;
 
 
 /*
-CAIInterfaceLibrary::CAIInterfaceLibrary(const CAIInterfaceLibrary&amp; interface) {
-	int loadCount = 0;
-	SAIInterfaceLibrary sAIInterfaceLibrary;wecd
-}
-CAIInterfaceLibrary::CAIInterfaceLibrary(SharedLib* sharedLib) {TODO;}
-*/
-
 CAIInterfaceLibrary::CAIInterfaceLibrary(
 		const SAIInterfaceSpecifier&amp; interfaceSpecifier,
 		const std::string&amp; libFileName)
 		: specifier(interfaceSpecifier) {
+*/
+CAIInterfaceLibrary::CAIInterfaceLibrary(const CAIInterfaceLibraryInfo* _info)
+		: info(_info) {
 	
+	staticGlobalData = createStaticGlobalData();
+	
+	std::string mainLibDir = std::string(staticGlobalData-&gt;libDir);
+	if (!mainLibDir.empty()) {
+		mainLibDir = mainLibDir + '/';
+	}
+	
+	// will look about like this: &quot;C:/Games/spring/AI/Interfaces/impls&quot;
+	aiInterfacesLibDir = mainLibDir + AI_INTERFACES_IMPLS_DIR;
+	
 	std::string libFilePath;
-	
+
+	std::string libFileName = info-&gt;GetFileName();
 	if (libFileName.empty()) {
-		libFilePath = GenerateLibFilePath(specifier);
-	} else {
-		libFilePath = GenerateLibFilePath(libFileName);
+		handleerror(NULL, &quot;Error while loading AI Interface Library.&quot;
+				&quot; No file name specified in AIInterface.lua&quot;,
+				&quot;AI Interface Error&quot;, MBF_OK | MBF_EXCL);
 	}
+	libFilePath = GenerateLibFilePath(libFileName, aiInterfacesLibDir);
 	
 	sharedLib = SharedLib::Instantiate(libFilePath);
 	if (sharedLib == NULL) {
@@ -62,32 +72,32 @@
 	}
 	
 	InitializeFromLib(libFilePath);
+	
+	InitStatic();
 }
-/*
-CAIInterfaceLibrary::CAIInterfaceLibrary(const std::string&amp; libFileName,
-		const SAIInterfaceSpecifier&amp; interfaceSpecifier)
-		: specifier(interfaceSpecifier) {
-	
-	std::string libFilePath = GenerateLibFilePath(libFileName);
-	
-	sharedLib = SharedLib::Instantiate(libFilePath);
-	
-	InitializeFromLib(libFilePath);
-*/
-	
-/*
-	std::map&lt;std::string, InfoItem&gt; infos = GetInfos();
-	specifier.shortName = infos.at(AI_INTERFACE_PROPERTY_SHORT_NAME).value;
-	specifier.version = infos.at(AI_INTERFACE_PROPERTY_VERSION).value;
-*/
-//}
 
 CAIInterfaceLibrary::~CAIInterfaceLibrary() {
+	
+	ReleaseStatic();
+	freeStaticGlobalData(staticGlobalData);
 	delete sharedLib;
 }
 
+void CAIInterfaceLibrary::InitStatic() {
+	
+	if (sAIInterfaceLibrary.initStatic != NULL) {
+		sAIInterfaceLibrary.initStatic(staticGlobalData);
+	}
+}
+void CAIInterfaceLibrary::ReleaseStatic() {
+	
+	if (sAIInterfaceLibrary.releaseStatic != NULL) {
+		sAIInterfaceLibrary.releaseStatic();
+	}
+}
+
 SAIInterfaceSpecifier CAIInterfaceLibrary::GetSpecifier() const {
-	return specifier;
+	return info-&gt;GetSpecifier();
 }
 
 LevelOfSupport CAIInterfaceLibrary::GetLevelOfSupportFor(
@@ -100,22 +110,22 @@
 	}
 }
 
-std::map&lt;std::string, InfoItem&gt; CAIInterfaceLibrary::GetInfos() const {
+std::map&lt;std::string, InfoItem&gt; CAIInterfaceLibrary::GetInfo() const {
 	
-	std::map&lt;std::string, InfoItem&gt; infos;
+	std::map&lt;std::string, InfoItem&gt; info;
 	
-	if (sAIInterfaceLibrary.getInfos != NULL) {
+	if (sAIInterfaceLibrary.getInfo != NULL) {
 		InfoItem infs[MAX_INFOS];
-		int num = sAIInterfaceLibrary.getInfos(infs, MAX_INFOS);
+		int num = sAIInterfaceLibrary.getInfo(infs, MAX_INFOS);
 
 		int i;
 		for (i=0; i &lt; num; ++i) {
 			InfoItem newII = copyInfoItem(&amp;infs[i]);
-			infos[std::string(newII.key)] = newII;
+			info[std::string(newII.key)] = newII;
 		}
 	}
 
-	return infos;
+	return info;
 }
 
 int CAIInterfaceLibrary::GetLoadCount() const {
@@ -153,19 +163,19 @@
 }
 */
 //const ISkirmishAILibrary* CAIInterfaceLibrary::FetchSkirmishAILibrary(const SSAISpecifier&amp; sAISpecifier) {
-//const ISkirmishAILibrary* CAIInterfaceLibrary::FetchSkirmishAILibrary(const InfoItem* infos, unsigned int numInfos) {
+//const ISkirmishAILibrary* CAIInterfaceLibrary::FetchSkirmishAILibrary(const InfoItem* info, unsigned int numInfo) {
 const ISkirmishAILibrary* CAIInterfaceLibrary::FetchSkirmishAILibrary(const CSkirmishAILibraryInfo* aiInfo) {
 	
 	ISkirmishAILibrary* ai = NULL;
 	
 	const unsigned int MAX_INFOS = 128;
-	InfoItem infos[MAX_INFOS];
-	unsigned int num = aiInfo-&gt;GetInfosCReference(infos, MAX_INFOS);
+	InfoItem info[MAX_INFOS];
+	unsigned int num = aiInfo-&gt;GetInfoCReference(info, MAX_INFOS);
 	
 	SSAISpecifier sAISpecifier = aiInfo-&gt;GetSpecifier();
 	if (skirmishAILoadCount[sAISpecifier] == 0) {
 		//const SSAILibrary* sLib = sAIInterfaceLibrary.loadSkirmishAILibrary(&amp;sAISpecifier);
-		const SSAILibrary* sLib = sAIInterfaceLibrary.loadSkirmishAILibrary(infos, num);
+		const SSAILibrary* sLib = sAIInterfaceLibrary.loadSkirmishAILibrary(info, num);
 		ai = new CSkirmishAILibrary(*sLib, sAISpecifier);
 		loadedSkirmishAILibraries[sAISpecifier] = ai;
 	} else {
@@ -227,13 +237,13 @@
 	IGroupAILibrary* ai = NULL;
 	
 	const unsigned int MAX_INFOS = 128;
-	InfoItem infos[MAX_INFOS];
-	unsigned int num = aiInfo-&gt;GetInfosCReference(infos, MAX_INFOS);
+	InfoItem info[MAX_INFOS];
+	unsigned int num = aiInfo-&gt;GetInfoCReference(info, MAX_INFOS);
 	
 	SGAISpecifier gAISpecifier = aiInfo-&gt;GetSpecifier();
 	if (groupAILoadCount[gAISpecifier] == 0) {
-		const SGAILibrary* gLib = sAIInterfaceLibrary.loadGroupAILibrary(infos, num);
-		ai = new CGroupAILibrary(*gLib);
+		const SGAILibrary* gLib = sAIInterfaceLibrary.loadGroupAILibrary(info, num);
+		ai = new CGroupAILibrary(*gLib, gAISpecifier);
 		loadedGroupAILibraries[gAISpecifier] = ai;
 	} else {
 		ai = loadedGroupAILibraries[gAISpecifier];
@@ -287,14 +297,22 @@
 	
 	std::string funcName;
 	
-	funcName = &quot;getInfos&quot;;
-    sAIInterfaceLibrary.getInfos = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (sAIInterfaceLibrary.getInfos == NULL) {
-		// do nothing: this is permitted, if the AI supplies infos through an AIInfo.lua file
+	funcName = &quot;initStatic&quot;;
+    sAIInterfaceLibrary.initStatic = (int (CALLING_CONV_FUNC_POINTER *)(const SStaticGlobalData* staticGlobalData)) sharedLib-&gt;FindAddress(funcName.c_str());
+    if (sAIInterfaceLibrary.initStatic == NULL) {
+		// do nothing: it is permitted that an AI does not export this function
 		//reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
         //return -1;
     }
 	
+	funcName = &quot;releaseStatic&quot;;
+    sAIInterfaceLibrary.releaseStatic = (int (CALLING_CONV_FUNC_POINTER *)()) sharedLib-&gt;FindAddress(funcName.c_str());
+    if (sAIInterfaceLibrary.releaseStatic == NULL) {
+		// do nothing: it is permitted that an AI does not export this function
+		//reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
+        //return -1;
+    }
+	
 	funcName = &quot;getLevelOfSupportFor&quot;;
     sAIInterfaceLibrary.getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(const char*, int)) sharedLib-&gt;FindAddress(funcName.c_str());
     if (sAIInterfaceLibrary.getLevelOfSupportFor == NULL) {
@@ -303,6 +321,14 @@
         //return -2;
     }
 	
+	funcName = &quot;getInfo&quot;;
+    sAIInterfaceLibrary.getInfo = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
+    if (sAIInterfaceLibrary.getInfo == NULL) {
+		// do nothing: this is permitted, if the AI supplies info through an AIInfo.lua file
+		//reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
+        //return -1;
+    }
+	
 /*
 	funcName = &quot;getSkirmishAISpecifiers&quot;;
     sAIInterfaceLibrary.getSkirmishAISpecifiers = (int (CALLING_CONV_FUNC_POINTER *)(SSAISpecifier*, int max)) sharedLib-&gt;FindAddress(funcName.c_str());
@@ -313,7 +339,7 @@
 */
 	
 	funcName = &quot;loadSkirmishAILibrary&quot;;
-    sAIInterfaceLibrary.loadSkirmishAILibrary = (const SSAILibrary* (CALLING_CONV_FUNC_POINTER *)(const struct InfoItem infos[], unsigned int numInfos)) sharedLib-&gt;FindAddress(funcName.c_str());
+    sAIInterfaceLibrary.loadSkirmishAILibrary = (const SSAILibrary* (CALLING_CONV_FUNC_POINTER *)(const struct InfoItem info[], unsigned int numInfoItems)) sharedLib-&gt;FindAddress(funcName.c_str());
     if (sAIInterfaceLibrary.loadSkirmishAILibrary == NULL) {
 		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
         return -4;
@@ -343,7 +369,7 @@
 */
 	
 	funcName = &quot;loadGroupAILibrary&quot;;
-    sAIInterfaceLibrary.loadGroupAILibrary = (const SGAILibrary* (CALLING_CONV_FUNC_POINTER *)(const struct InfoItem infos[], unsigned int numInfos)) sharedLib-&gt;FindAddress(funcName.c_str());
+    sAIInterfaceLibrary.loadGroupAILibrary = (const SGAILibrary* (CALLING_CONV_FUNC_POINTER *)(const struct InfoItem info[], unsigned int numInfoItems)) sharedLib-&gt;FindAddress(funcName.c_str());
     if (sAIInterfaceLibrary.loadGroupAILibrary == NULL) {
 		reportInterfaceFunctionError(&amp;libFilePath, &amp;funcName);
         return -8;
@@ -367,17 +393,23 @@
 }
 
 
-std::string CAIInterfaceLibrary::GenerateLibFilePath(const std::string&amp; libFileName) {
-	return std::string(PATH_TO_SPRING_HOME) +
-			std::string(AI_INTERFACES_IMPLS_DIR) // eg AI/Interfaces/impls
-			.append(&quot;/&quot;)
-			.append(libFileName) // eg. Java-0.600
-			.append(&quot;.&quot;)
-			.append(SharedLib::GetLibExtension()); // eg. dll
+std::string CAIInterfaceLibrary::GenerateLibFilePath(
+		const std::string&amp; fileNameMainPart,
+		const std::string&amp; aiInterfacesLibDir) {
+	
+	std::string libFileName = fileNameMainPart + &quot;.&quot; + SharedLib::GetLibExtension();
+	#ifndef _WIN32
+		libFileName = &quot;lib&quot; + libFileName;
+	#endif
+	// libFileName should now look about like this: libJava-0.600.so or Java-0.600.dll
+	
+	// generate a path like this: &quot;C:/Games/spring/AI/Interfaces/impls/Java-0.600.dll&quot;
+	return aiInterfacesLibDir + &quot;/&quot; + libFileName;
 }
 
+/*
 std::string CAIInterfaceLibrary::GenerateLibFilePath(const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
-	
+	REDO THIS (use filename attribute, instead of shortName and version)
 	std::string libFileName = std::string(interfaceSpecifier.shortName) // eg. Java
 			.append(&quot;-&quot;)
 			.append(interfaceSpecifier.version); // eg. 0.600
@@ -386,4 +418,5 @@
 #endif
 	return GenerateLibFilePath(libFileName);
 }
+*/
 

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibrary.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -23,6 +23,7 @@
 #include &quot;Platform/SharedLib.h&quot;
 #include &quot;Interface/SAIInterfaceLibrary.h&quot;
 
+class CAIInterfaceLibraryInfo;
 class CSkirmishAILibraryInfo;
 class CGroupAILibraryInfo;
 
@@ -30,8 +31,9 @@
 public:
 //	CAIInterfaceLibrary(const CAIInterfaceLibrary&amp; interface);
 //	CAIInterfaceLibrary(const std::string&amp; libFileName);
-	CAIInterfaceLibrary(const SAIInterfaceSpecifier&amp; interfaceSpecifier, const std::string&amp; libFileName = &quot;&quot;);
 	//CAIInterfaceLibrary(const std::string&amp; libFileName, const SAIInterfaceSpecifier&amp; interfaceSpecifier);
+	//CAIInterfaceLibrary(const SAIInterfaceSpecifier&amp; interfaceSpecifier, const std::string&amp; libFileName = &quot;&quot;);
+	CAIInterfaceLibrary(const CAIInterfaceLibraryInfo* info);
 	virtual ~CAIInterfaceLibrary();
 	
 //	static CAIInterfaceLibrary* Load(const std::string&amp; libFileName); // increments load counter
@@ -42,13 +44,13 @@
 			const std::string&amp; engineVersionString, int engineVersionNumber) const;
 	
 //    virtual std::string GetProperty(const std::string&amp; propertyName) const;
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfos() const;
+    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const;
 	virtual int GetLoadCount() const;
 	
 	// Skirmish AI methods
 	//virtual std::vector&lt;SSAISpecifier&gt; GetSkirmishAILibrarySpecifiers() const;
 	//virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const SSAISpecifier&amp; sAISpecifier);
-	//virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const InfoItem* infos, unsigned int numInfos);
+	//virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const InfoItem* info, unsigned int numInfo);
 	virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const CSkirmishAILibraryInfo* aiInfo);
 	virtual int ReleaseSkirmishAILibrary(const SSAISpecifier&amp; sAISpecifier);
 	virtual int GetSkirmishAILibraryLoadCount(const SSAISpecifier&amp; sAISpecifier) const;
@@ -57,20 +59,23 @@
 	// Group AI methods
 	//virtual std::vector&lt;SGAISpecifier&gt; GetGroupAILibrarySpecifiers() const;
 	//virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAISpecifier&amp; gAISpecifier);
-	//virtual const IGroupAILibrary* FetchGroupAILibrary(const InfoItem* infos, unsigned int numInfos);
+	//virtual const IGroupAILibrary* FetchGroupAILibrary(const InfoItem* info, unsigned int numInfo);
 	virtual const IGroupAILibrary* FetchGroupAILibrary(const CGroupAILibraryInfo* aiInfo);
 	virtual int ReleaseGroupAILibrary(const SGAISpecifier&amp; gAISpecifier);
 	virtual int GetGroupAILibraryLoadCount(const SGAISpecifier&amp; gAISpecifier) const;
 	virtual int ReleaseAllGroupAILibraries();
 	
 private:
-//	static s_assoc&lt;const std::string, const std::string&gt; specifiers; // &quot;libFileName&quot; -&gt; &quot;shortName#version&quot;
-//	static s_assoc&lt;const std::string, CSkirmishAILibraryInterface&gt;::map interfaces; // &quot;shortName#version&quot; -&gt; interface
+	SStaticGlobalData* staticGlobalData;
+	void InitStatic();
+	void ReleaseStatic();
 	
 private:
+	std::string aiInterfacesLibDir;
 	SharedLib* sharedLib;
 	SAIInterfaceLibrary sAIInterfaceLibrary;
-	SAIInterfaceSpecifier specifier;
+	//SAIInterfaceSpecifier specifier;
+	const CAIInterfaceLibraryInfo* info;
 	std::map&lt;const SSAISpecifier, ISkirmishAILibrary*, SSAISpecifier_Comparator&gt; loadedSkirmishAILibraries;
 	std::map&lt;const SSAISpecifier, int, SSAISpecifier_Comparator&gt; skirmishAILoadCount;
 	std::map&lt;const SGAISpecifier, IGroupAILibrary*, SGAISpecifier_Comparator&gt; loadedGroupAILibraries;
@@ -79,11 +84,14 @@
 private:
 	static const int MAX_INFOS = 128;
 	
-	static void reportInterfaceFunctionError(const std::string* libFileName, const std::string* functionName);
+	static void reportInterfaceFunctionError(const std::string* libFileName,
+			const std::string* functionName);
 	int InitializeFromLib(const std::string&amp; libFilePath);
 	
-	static std::string GenerateLibFilePath(const SAIInterfaceSpecifier&amp; interfaceSpecifier);
-	static std::string GenerateLibFilePath(const std::string&amp; libFileName);
+	//static std::string GenerateLibFilePath(const SAIInterfaceSpecifier&amp; interfaceSpecifier, const std::string&amp; libPathPrefix = &quot;&quot;);
+	//static std::string GenerateLibFilePath(const InfoItem&amp; interfaceSpecifier, const std::string&amp; libPathPrefix = &quot;&quot;);
+	static std::string GenerateLibFilePath(const std::string&amp; fileNameMainPart,
+			const std::string&amp; aiInterfacesLibDir);
 };
 
 #endif	/* _AIINTERFACELIBRARY_H */

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -24,17 +24,21 @@
 #include &quot;Util.h&quot;
 #include &quot;LogOutput.h&quot;
 
-CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(const IAIInterfaceLibrary&amp; interface) {
-	infos = interface.GetInfos();
-	levelOfSupport = interface.GetLevelOfSupportFor(std::string(ENGINE_VERSION_STRING),
-			ENGINE_VERSION_NUMBER);
+CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
+		const IAIInterfaceLibrary&amp; interface) {
+	
+	infoItems = interface.GetInfo();
+	//levelOfSupport = interface.GetLevelOfSupportFor(std::string(ENGINE_VERSION_STRING),
+	//		ENGINE_VERSION_NUMBER);
 }
 
-CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(const CAIInterfaceLibraryInfo&amp; interfaceInfo) {
-	infos = std::map&lt;std::string, InfoItem&gt;(
-			interfaceInfo.infos.begin(),
-			interfaceInfo.infos.end());
-	levelOfSupport = interfaceInfo.levelOfSupport;
+CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
+		const CAIInterfaceLibraryInfo&amp; interfaceInfo) {
+	
+	infoItems = std::map&lt;std::string, InfoItem&gt;(
+			interfaceInfo.infoItems.begin(),
+			interfaceInfo.infoItems.end());
+	//levelOfSupport = interfaceInfo.levelOfSupport;
 }
 
 CAIInterfaceLibraryInfo::CAIInterfaceLibraryInfo(
@@ -42,27 +46,34 @@
 		const std::string&amp; fileModes,
 		const std::string&amp; accessModes) {
 	
-	//std::vector&lt;InfoItem&gt; tmpInfos = ParseInfos(interfaceInfoFile, fileModes, accessModes);
-	InfoItem tmpInfos[MAX_INFOS];
-	unsigned int num = ParseInfos(interfaceInfoFile.c_str(), fileModes.c_str(), accessModes.c_str(), tmpInfos, MAX_INFOS);
+	InfoItem tmpInfo[MAX_INFOS];
+	unsigned int num = ParseInfo(interfaceInfoFile.c_str(), fileModes.c_str(),
+			accessModes.c_str(), tmpInfo, MAX_INFOS);
+    for (unsigned int i=0; i &lt; num; ++i) {
 /*
-	std::vector&lt;InfoItem&gt;::iterator i;
-    for (i = tmpInfos.begin(); i != tmpInfos.end(); ++i) {
-		infos[std::string(i-&gt;key)] = *i;
-    }
+		logOutput.Print(&quot;info %i: %s / %s / %s&quot;, i, tmpInfo[i].key,
+				tmpInfo[i].value, tmpInfo[i].desc);
 */
-    for (unsigned int i=0; i &lt; num; ++i) {
-		logOutput.Print(&quot;info %i: %s / %s / %s&quot;, i, tmpInfos[i].key, tmpInfos[i].value, tmpInfos[i].desc);
-		infos[std::string(tmpInfos[i].key)] = copyInfoItem(&amp;(tmpInfos[i]));
+		infoItems[std::string(tmpInfo[i].key)] = copyInfoItem(&amp;(tmpInfo[i]));
     }
 	
-	levelOfSupport = LOS_Unknown;
+	//levelOfSupport = LOS_Unknown;
 }
 
+/*
 LevelOfSupport CAIInterfaceLibraryInfo::GetLevelOfSupportForCurrentEngine() const {
 	return levelOfSupport;
 }
+*/
 
+SAIInterfaceSpecifier CAIInterfaceLibraryInfo::GetSpecifier() const {
+	
+	const char* sn = infoItems.at(AI_INTERFACE_PROPERTY_SHORT_NAME).value;
+	const char* v = infoItems.at(AI_INTERFACE_PROPERTY_VERSION).value;
+	SAIInterfaceSpecifier specifier = {sn, v};
+	return specifier;
+}
+
 std::string CAIInterfaceLibraryInfo::GetFileName() const {
 	return GetInfo(AI_INTERFACE_PROPERTY_FILE_NAME);
 }
@@ -83,30 +94,16 @@
 }
 std::string CAIInterfaceLibraryInfo::GetInfo(const std::string&amp; key) const {
 	
-	if (infos.find(key) == infos.end()) {
-		std::string tmp = std::string(&quot;numInfos: &quot;);
-		tmp += IntToString(infos.size());
-		tmp += &quot;\n&quot;;
-		std::map&lt;std::string, InfoItem&gt;::const_iterator it = infos.begin();
-		for (unsigned int i=0; it != infos.end(); ++i, ++it) {
-            tmp += &quot;info &quot;;
-			tmp += IntToString(i);
-			tmp += &quot;: &quot;;
-			tmp += it-&gt;first;
-			tmp += &quot; / &quot;;
-			tmp += it-&gt;second.value;
-			tmp += &quot;\n&quot;;
-        }
-		tmp += &quot;shortName: &quot;;
-		tmp += infos.at(std::string(AI_INTERFACE_PROPERTY_SHORT_NAME)).value;
-		tmp += &quot;\n&quot;;
-
-		handleerror(NULL, std::string(&quot;AI interface property '&quot;).append(key).append(&quot;' can not be found&quot;).append(&quot;\n&quot;).append(tmp).c_str(), &quot;IntefaceInfo Error&quot;, MBF_OK | MBF_EXCL);
+	if (infoItems.find(key) == infoItems.end()) {
+		std::string errorMsg = std::string(&quot;AI interface property '&quot;) + key
+				+ &quot;' could not be found.\n&quot;;
+		handleerror(NULL, errorMsg.c_str(), &quot;AI Interface Info Error&quot;,
+				MBF_OK | MBF_EXCL);
 	}
-	return infos.at(key).value;
+	return infoItems.at(key).value;
 }
-const std::map&lt;std::string, InfoItem&gt;* CAIInterfaceLibraryInfo::GetInfos() const {
-	return &infos;
+const std::map&lt;std::string, InfoItem&gt;* CAIInterfaceLibraryInfo::GetInfo() const {
+	return &infoItems;
 }
 
 
@@ -128,17 +125,20 @@
 void CAIInterfaceLibraryInfo::SetURL(const std::string&amp; url) {
 	SetInfo(AI_INTERFACE_PROPERTY_URL, url);
 }
-bool CAIInterfaceLibraryInfo::SetInfo(const std::string&amp; key, const std::string&amp; value) {
+bool CAIInterfaceLibraryInfo::SetInfo(const std::string&amp; key,
+		const std::string&amp; value) {
 	
 	if (key == AI_INTERFACE_PROPERTY_SHORT_NAME ||
 			key == AI_INTERFACE_PROPERTY_VERSION) {
 		if (value.find_first_of(&quot;\t _#&quot;) != std::string::npos) {
-			handleerror(NULL, &quot;AI interface property (shortName or version) contains illegal characters ('_', '#' or white spaces)&quot;, &quot;IntefaceInfo Error&quot;, MBF_OK | MBF_EXCL);
+			handleerror(NULL, &quot;AI interface property (shortName or version)\n&quot;
+					&quot;contains illegal characters ('_', '#' or white spaces)&quot;,
+					&quot;AI Interface Info Error&quot;, MBF_OK | MBF_EXCL);
 			return false;
 		}
 	}
 	
 	InfoItem ii = {key.c_str(), value.c_str(), NULL};
-	infos[key] = ii;
+	infoItems[key] = ii;
 	return true;
 }

Modified: branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/AIInterfaceLibraryInfo.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -34,7 +34,9 @@
 			const std::string&amp; fileModes,
 			const std::string&amp; accessModes);
     
-    virtual LevelOfSupport GetLevelOfSupportForCurrentEngine() const;
+    //virtual LevelOfSupport GetLevelOfSupportForCurrentEngine() const;
+	
+    virtual SAIInterfaceSpecifier GetSpecifier() const;
     
     virtual std::string GetFileName() const; // when the AI is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
     virtual std::string GetShortName() const; // restrictions: none of the following: spaces, '_', '#'
@@ -43,7 +45,7 @@
     virtual std::string GetDescription() const;
     virtual std::string GetURL() const;
     virtual std::string GetInfo(const std::string&amp; key) const;
-    virtual const std::map&lt;std::string, InfoItem&gt;* GetInfos() const;
+    virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
 	
     virtual void SetFileName(const std::string&amp; fileName); // when the AI is &quot;libRAI-0.600.so&quot; or &quot;RAI-0.600.dll&quot;, this value should be &quot;RAI-0.600&quot;
     virtual void SetShortName(const std::string&amp; shortName); // restrictions: none of the following: spaces, '_', '#'
@@ -55,8 +57,8 @@
 	
 private:
 	static const unsigned int MAX_INFOS = 128;
-	std::map&lt;std::string, InfoItem&gt; infos;
-	LevelOfSupport levelOfSupport;
+	std::map&lt;std::string, InfoItem&gt; infoItems;
+	//LevelOfSupport levelOfSupport;
 };
 
 #endif	/* _AIINTERFACELIBRARYINFO_H */

Modified: branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -574,12 +574,18 @@
 
 IAIInterfaceLibrary* CAILibraryManager::FetchInterface(const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
 	
-	IAIInterfaceLibrary* interfaceLib;
+	IAIInterfaceLibrary* interfaceLib = NULL;
 	
 	T_loadedInterfaces::const_iterator interfacePos = loadedAIInterfaceLibraries.find(interfaceSpecifier);
 	if (interfacePos == loadedAIInterfaceLibraries.end()) { // interface not yet loaded
-		interfaceLib = new CAIInterfaceLibrary(interfaceSpecifier);
-		loadedAIInterfaceLibraries[interfaceSpecifier] = interfaceLib;
+		T_interfaceInfos::const_iterator interfaceInfo = interfaceInfos.find(interfaceSpecifier);
+		if (interfaceInfo != interfaceInfos.end()) {
+			//interfaceLib = new CAIInterfaceLibrary(interfaceSpecifier);
+			interfaceLib = new CAIInterfaceLibrary(interfaceInfo-&gt;second);
+			loadedAIInterfaceLibraries[interfaceSpecifier] = interfaceLib;
+		} else {
+			// unavailable interface requested, returning NULL
+		}
 	} else {
 		interfaceLib = interfacePos-&gt;second;
 	}

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibrary.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibrary.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -21,14 +21,8 @@
 #include &quot;LogOutput.h&quot;
 #include &lt;string&gt;
 
-CGroupAILibrary::CGroupAILibrary(const SGAILibrary&amp; ai) {
-	
-	sGAI = ai;
-	
-	std::map&lt;std::string, InfoItem&gt; infos = GetInfos();
-	specifier.shortName = infos.at(GROUP_AI_PROPERTY_SHORT_NAME).value;
-	specifier.version = infos.at(GROUP_AI_PROPERTY_VERSION).value;
-}
+CGroupAILibrary::CGroupAILibrary(const SGAILibrary&amp; ai,
+		const SGAISpecifier&amp; specifier) : sGAI(ai), specifier(specifier) {}
 
 CGroupAILibrary::~CGroupAILibrary() {}
 	
@@ -48,22 +42,22 @@
 	}
 }
 	
-std::map&lt;std::string, InfoItem&gt; CGroupAILibrary::GetInfos() const {
+std::map&lt;std::string, InfoItem&gt; CGroupAILibrary::GetInfo() const {
 	
-	std::map&lt;std::string, InfoItem&gt; infos;
+	std::map&lt;std::string, InfoItem&gt; info;
 	
-	if (sGAI.getInfos != NULL) {
+	if (sGAI.getInfo != NULL) {
 		InfoItem infs[MAX_INFOS];
-		int num = sGAI.getInfos(infs, MAX_INFOS);
+		int num = sGAI.getInfo(infs, MAX_INFOS);
 
 		int i;
 		for (i=0; i &lt; num; ++i) {
 			InfoItem newII = copyInfoItem(&amp;infs[i]);
-			infos[std::string(newII.key)] = newII;
+			info[std::string(newII.key)] = newII;
 		}
 	}
 
-	return infos;
+	return info;
 }
 std::vector&lt;Option&gt; CGroupAILibrary::GetOptions() const {
 	

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibrary.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibrary.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -25,7 +25,7 @@
 
 class CGroupAILibrary : public IGroupAILibrary {
 public:
-	CGroupAILibrary(const SGAILibrary&amp; ai);
+	CGroupAILibrary(const SGAILibrary&amp; ai, const SGAISpecifier&amp; specifier);
 	virtual ~CGroupAILibrary();
 	
 	virtual SGAISpecifier GetSpecifier() const;
@@ -37,7 +37,7 @@
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 			const SAIInterfaceSpecifier&amp; interfaceSpecifier) const;
 	
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfos() const;
+    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const;
 	virtual std::vector&lt;Option&gt; GetOptions() const;
 	
 	

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -25,16 +25,16 @@
 #include &quot;Platform/errorhandler.h&quot;
 
 CGroupAILibraryInfo::CGroupAILibraryInfo(const IGroupAILibrary&amp; ai, const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
-	infos = ai.GetInfos();
+	info = ai.GetInfo();
 	options = ai.GetOptions();
 	//levelOfSupport = ai.GetLevelOfSupportFor(std::string(ENGINE_VERSION_STRING),
 	//		ENGINE_VERSION_NUMBER, interfaceSpecifier);
 }
 
 CGroupAILibraryInfo::CGroupAILibraryInfo(const CGroupAILibraryInfo&amp; aiInfo) {
-	infos = std::map&lt;std::string, InfoItem&gt;(
-			aiInfo.infos.begin(),
-			aiInfo.infos.end());
+	info = std::map&lt;std::string, InfoItem&gt;(
+			aiInfo.info.begin(),
+			aiInfo.info.end());
 	options = std::vector&lt;Option&gt;(
 			aiInfo.options.begin(),
 			aiInfo.options.end());
@@ -47,10 +47,10 @@
 		const std::string&amp; fileModes,
 		const std::string&amp; accessModes) {
 	
-	InfoItem tmpInfos[MAX_INFOS];
-	unsigned int num = ParseInfos(aiInfoFile.c_str(), fileModes.c_str(), accessModes.c_str(), tmpInfos, MAX_INFOS);
+	InfoItem tmpInfo[MAX_INFOS];
+	unsigned int num = ParseInfo(aiInfoFile.c_str(), fileModes.c_str(), accessModes.c_str(), tmpInfo, MAX_INFOS);
     for (unsigned int i=0; i &lt; num; ++i) {
-		infos[std::string(tmpInfos[i].key)] = tmpInfos[i];
+		info[std::string(tmpInfo[i].key)] = tmpInfo[i];
     }
 	
 	if (!aiOptionFile.empty()) {
@@ -70,8 +70,8 @@
 
 SGAISpecifier CGroupAILibraryInfo::GetSpecifier() const {
 	
-	const char* sn = infos.at(GROUP_AI_PROPERTY_SHORT_NAME).value;
-	const char* v = infos.at(GROUP_AI_PROPERTY_SHORT_NAME).value;
+	const char* sn = info.at(GROUP_AI_PROPERTY_SHORT_NAME).value;
+	const char* v = info.at(GROUP_AI_PROPERTY_VERSION).value;
 	SGAISpecifier specifier = {sn, v};
 	return specifier;
 }
@@ -101,10 +101,10 @@
 	return GetInfo(GROUP_AI_PROPERTY_INTERFACE_VERSION);
 }
 std::string CGroupAILibraryInfo::GetInfo(const std::string&amp; key) const {
-	return infos.at(key).value;
+	return info.at(key).value;
 }
-const std::map&lt;std::string, InfoItem&gt;* CGroupAILibraryInfo::GetInfos() const {
-	return &infos;
+const std::map&lt;std::string, InfoItem&gt;* CGroupAILibraryInfo::GetInfo() const {
+	return &info;
 }
 
 const std::vector&lt;Option&gt;* CGroupAILibraryInfo::GetOptions() const {
@@ -112,13 +112,13 @@
 }
 
 
-unsigned int CGroupAILibraryInfo::GetInfosCReference(InfoItem cInfos[], unsigned int max) const {
+unsigned int CGroupAILibraryInfo::GetInfoCReference(InfoItem cInfo[], unsigned int maxInfoItems) const {
 	
 	unsigned int i=0;
 	
 	std::map&lt;std::string, InfoItem&gt;::const_iterator infs;
-	for (infs=infos.begin(); infs != infos.end() &amp;&amp; i &lt; max; ++infs) {
-		cInfos[i++] = infs-&gt;second;
+	for (infs=info.begin(); infs != info.end() &amp;&amp; i &lt; maxInfoItems; ++infs) {
+		cInfo[i++] = infs-&gt;second;
     }
 	
 	return i;
@@ -171,7 +171,7 @@
 	}
 	
 	InfoItem ii = {key.c_str(), value.c_str(), NULL};
-	infos[key] = ii;
+	info[key] = ii;
 	return true;
 }
 

Modified: branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/GroupAILibraryInfo.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -52,9 +52,9 @@
     virtual std::string GetInterfaceShortName() const;
     virtual std::string GetInterfaceVersion() const;
     virtual std::string GetInfo(const std::string&amp; key) const;
-    virtual const std::map&lt;std::string, InfoItem&gt;* GetInfos() const;
-	virtual unsigned int GetInfosCReference(InfoItem cInfos[], unsigned int max) const;
-	virtual unsigned int GetOptionsCReference(Option cOptions[], unsigned int max) const;
+    virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
+	virtual unsigned int GetInfoCReference(InfoItem cInfo[], unsigned int maxInfoItems) const;
+	virtual unsigned int GetOptionsCReference(Option cOptions[], unsigned int maxOptions) const;
 	
 	virtual const std::vector&lt;Option&gt;* GetOptions() const;
 	
@@ -73,7 +73,7 @@
 private:
 	static const unsigned int MAX_INFOS = 128;
 	static const unsigned int MAX_OPTIONS = 128;
-	std::map&lt;std::string, InfoItem&gt; infos;
+	std::map&lt;std::string, InfoItem&gt; info;
 	std::vector&lt;Option&gt; options;
 };
 

Modified: branches/caiinterface/rts/ExternalAI/IAIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/IAIInterfaceLibrary.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/IAIInterfaceLibrary.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -34,7 +34,7 @@
 			const std::string&amp; engineVersionString, int engineVersionNumber) const = 0;
 	
 //    virtual std::string GetProperty(const std::string&amp; propertyName) const = 0;
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfos() const = 0;
+    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const = 0;
 	
 	/**
 	 * @brief	how many times is this interface loaded
@@ -47,7 +47,7 @@
 	
 	
 	
-//	virtual std::vector&lt;ISkirmishAILibraryInfo*&gt; GetSkirmishAILibraryInfos(bool forceLoadFromLibrary = false) const;
+//	virtual std::vector&lt;ISkirmishAILibraryInfo*&gt; GetSkirmishAILibraryInfo(bool forceLoadFromLibrary = false) const;
 	/**
 	 * Returns the specifiers for all Skirmish AIs available through this interface.
 	 */
@@ -60,7 +60,7 @@
 	 * Increments the load counter.
 	 */
 	//virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const SSAISpecifier&amp; sAISpecifier) = 0;
-	//virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const InfoItem* infos, unsigned int numInfos) = 0;
+	//virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const InfoItem* info, unsigned int numInfo) = 0;
 	virtual const ISkirmishAILibrary* FetchSkirmishAILibrary(const CSkirmishAILibraryInfo* skirmishAIInfo) = 0;
 	/**
 	 * @brief	unloads the Skirmish AI library
@@ -91,10 +91,10 @@
 	
 	
 	
-//	virtual std::vector&lt;IGroupAILibraryInfo*&gt; GetGroupAILibraryInfos(bool forceLoadFromLibrary = false) const;
+//	virtual std::vector&lt;IGroupAILibraryInfo*&gt; GetGroupAILibraryInfo(bool forceLoadFromLibrary = false) const;
 	//virtual std::vector&lt;SGAISpecifier&gt; GetGroupAILibrarySpecifiers() const = 0;
 	//virtual const IGroupAILibrary* FetchGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) = 0;
-	//virtual const IGroupAILibrary* FetchGroupAILibrary(const InfoItem* infos, unsigned int numInfos) = 0;
+	//virtual const IGroupAILibrary* FetchGroupAILibrary(const InfoItem* info, unsigned int numInfo) = 0;
 	virtual const IGroupAILibrary* FetchGroupAILibrary(const CGroupAILibraryInfo* aiInfo) = 0;
 	virtual int ReleaseGroupAILibrary(const SGAISpecifier&amp; gAISpecifier) = 0;
 	virtual int GetGroupAILibraryLoadCount(const SGAISpecifier&amp; gAISpecifier) const = 0;

Modified: branches/caiinterface/rts/ExternalAI/IGroupAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/IGroupAILibrary.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/IGroupAILibrary.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -41,7 +41,7 @@
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 			const SAIInterfaceSpecifier&amp; interfaceSpecifier) const = 0;
 	
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfos() const = 0;
+    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const = 0;
 	virtual std::vector&lt;Option&gt; GetOptions() const = 0;
 	
 	

Modified: branches/caiinterface/rts/ExternalAI/ISkirmishAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/ISkirmishAILibrary.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/ISkirmishAILibrary.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -41,7 +41,7 @@
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 			const SAIInterfaceSpecifier&amp; interfaceSpecifier) const = 0;
 	
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfos() const = 0;
+    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const = 0;
 	virtual std::vector&lt;Option&gt; GetOptions() const = 0;
 	
 	

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -30,8 +30,10 @@
 #include &quot;ELevelOfSupport.h&quot;
 #include &quot;SSAILibrary.h&quot;
 #include &quot;SGAILibrary.h&quot;
-#include &quot;exportdefines.h&quot;
+#include &quot;System/exportdefines.h&quot;
 
+struct SStaticGlobalData;
+
 #define AI_INTERFACE_PROPERTY_FILE_NAME &quot;fileName&quot;                     // [string] when the library file is &quot;libC-0.1.so&quot; or &quot;C-0.1.dll&quot;, this value should be &quot;C-0.1&quot;
 #define AI_INTERFACE_PROPERTY_SHORT_NAME &quot;shortName&quot;                   // [string: [a-zA-Z0-9_.]*]
 #define AI_INTERFACE_PROPERTY_VERSION &quot;version&quot;                        // [string: [a-zA-Z0-9_.]*]
@@ -119,6 +121,32 @@
 	// static AI interface library functions
 	
 	/**
+	 * This function is called right after the library is dynamically loaded.
+	 * It can be used to initialize variables and to check or prepare
+	 * the environment (os, engine, filesystem, ...).
+	 * See also releaseStatic().
+	 *
+	 * NOTE: this method is optional. An AI Interface not exporting this
+	 * function is still valid.
+	 *
+	 * @return	init ok: 0, on error: != 0
+	 */
+	int (CALLING_CONV *initStatic)(const SStaticGlobalData* staticGlobalData);
+	
+	/**
+	 * This function is called right right before the library is unloaded.
+	 * It can be used to deinitialize variables and to cleanup the environment,
+	 * for example the filesystem.
+	 * See also initStatic().
+	 *
+	 * NOTE: this method is optional. An AI Interface not exporting this
+	 * function is still valid.
+	 *
+	 * @return	release ok: 0, on error: != 0
+	 */
+	int (CALLING_CONV *releaseStatic)();
+	
+	/**
 	 * Level of Support for a specific engine version.
 	 *
 	 * NOTE: this method is optional. An AI Interface not exporting this
@@ -132,17 +160,20 @@
 	 * NOTE: this method is optional. An AI Interface not exporting this
 	 * function is still valid.
 	 *
-	 * @return number of elements stored into parameter infos
+	 * @return number of elements stored into parameter info
 	 */
-	unsigned int (CALLING_CONV *getInfos)(struct InfoItem infos[], unsigned int max);
+	unsigned int (CALLING_CONV *getInfo)(struct InfoItem info[],
+			unsigned int maxInfoItems);
 	
 	
 	// skirmish AI methods
 	
 	//int (CALLING_CONV *getSkirmishAISpecifiers)(struct SSAISpecifier* sAISpecifiers, int max);
 	//const struct SSAILibrary* (CALLING_CONV *loadSkirmishAILibrary)(const struct SSAISpecifier* const sAISpecifier);
-	const struct SSAILibrary* (CALLING_CONV *loadSkirmishAILibrary)(const struct InfoItem infos[], unsigned int numInfos);
-	int (CALLING_CONV *unloadSkirmishAILibrary)(const struct SSAISpecifier* const sAISpecifier);
+	const struct SSAILibrary* (CALLING_CONV *loadSkirmishAILibrary)(
+			const struct InfoItem info[], unsigned int numInfoItems);
+	int (CALLING_CONV *unloadSkirmishAILibrary)(
+			const struct SSAISpecifier* const sAISpecifier);
 	int (CALLING_CONV *unloadAllSkirmishAILibraries)();
 	
 	
@@ -150,8 +181,10 @@
 	
 	//int (CALLING_CONV *getGroupAISpecifiers)(struct SGAISpecifier* gAISpecifiers, int max);
 	//const struct SGAILibrary* (CALLING_CONV *loadGroupAILibrary)(const struct SGAISpecifier* const gAISpecifier);
-	const struct SGAILibrary* (CALLING_CONV *loadGroupAILibrary)(const struct InfoItem infos[], unsigned int numInfos);
-	int (CALLING_CONV *unloadGroupAILibrary)(const struct SGAISpecifier* const gAISpecifier);
+	const struct SGAILibrary* (CALLING_CONV *loadGroupAILibrary)(
+			const struct InfoItem info[], unsigned int numInfoItems);
+	int (CALLING_CONV *unloadGroupAILibrary)(
+			const struct SGAISpecifier* const gAISpecifier);
 	int (CALLING_CONV *unloadAllGroupAILibraries)();
 };
 

Modified: branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/Interface/SGAILibrary.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -91,12 +91,12 @@
 	 * NOTE: this method is optional. An AI not exporting this function is still
 	 * valid.
 	 *
-	 * @param	infos	where the info about this AI library shall be stored to
-	 * @param	max	the maximum number of elements to store into param infos
-	 * @return number of elements stored into parameter infos
+	 * @param	info	where the info about this AI library shall be stored to
+	 * @param	maxInfoItems	the maximum number of elements to store into param info
+	 * @return	number of elements stored into parameter info
 	 */
-	unsigned int (CALLING_CONV *getInfos)(struct InfoItem infos[],
-			unsigned int max);
+	unsigned int (CALLING_CONV *getInfo)(struct InfoItem info[],
+			unsigned int maxInfoItems);
 	
 	/**
 	 * Returns options that can be set on this AI.
@@ -104,12 +104,12 @@
 	 * NOTE: this method is optional. An AI not exporting this function is still
 	 * valid.
 	 *
-	 * @param	infos	where the options of this AI library shall be stored to
-	 * @param	max	the maximum number of elements to store into param options
-	 * @return number of elements stored into parameter options
+	 * @param	options	where the options of this AI library shall be stored to
+	 * @param	maxOptions	the maximum number of elements to store into param options
+	 * @return	number of elements stored into parameter options
 	 */
 	unsigned int (CALLING_CONV *getOptions)(struct Option options[],
-			unsigned int max);
+			unsigned int maxOptions);
 
 	// team and group instance functions
 	

Modified: branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -17,7 +17,7 @@
 
 #include &quot;SInfo.h&quot;
 
-#include &quot;Util.h&quot;
+#include &quot;System/Util.h&quot;
 #include &lt;string.h&gt;
 #include &lt;stdlib.h&gt;
 
@@ -57,7 +57,7 @@
 
 static const char* badKeyChars = &quot; =;\r\n\t&quot;;
 
-bool ParseInfo(const LuaTable&amp; root, int index, InfoItem&amp; info, std::set&lt;std::string&gt; infosSet)
+bool ParseInfo(const LuaTable&amp; root, int index, InfoItem&amp; info, std::set&lt;std::string&gt; infoSet)
 {
 	const LuaTable&amp; infoTbl = root.SubTable(index);
 	if (!infoTbl.IsValid()) {
@@ -71,7 +71,7 @@
 		return false;
 	}
 	std::string keyLower = StringToLower(info_key);
-	if (infosSet.find(keyLower) != infosSet.end()) {
+	if (infoSet.find(keyLower) != infoSet.end()) {
 		return false;
 	}
 	info.key = mallocCopyString(info_key.c_str());
@@ -89,21 +89,21 @@
 		info.desc = mallocCopyString(info_desc.c_str());
 	}
 
-	infosSet.insert(keyLower);
+	infoSet.insert(keyLower);
 
 	return true;
 }
 
-unsigned int ParseInfos(
+unsigned int ParseInfo(
 		const char* fileName,
 		const char* fileModes,
 		const char* accessModes,
-		InfoItem infos[], unsigned int max)
+		InfoItem info[], unsigned int max)
 {
 	LuaParser luaParser(fileName, fileModes, accessModes);
 		
 	if (!luaParser.Execute()) {
-		printf(&quot;ParseInfos(%s) ERROR: %s\n&quot;,
+		printf(&quot;ParseInfo(%s) ERROR: %s\n&quot;,
 		       fileName, luaParser.GetErrorLog().c_str());
 		return 0;
 	}
@@ -114,20 +114,20 @@
 	}
 
 	unsigned int i = 0;
-	std::set&lt;std::string&gt; infosSet;
+	std::set&lt;std::string&gt; infoSet;
 	for (int index = 1; root.KeyExists(index) &amp;&amp; i &lt; max; index++) {
-		InfoItem info;
-		if (ParseInfo(root, index, info, infosSet)) {
-			infos[i++] = info;
+		InfoItem infoItem;
+		if (ParseInfo(root, index, infoItem, infoSet)) {
+			info[i++] = infoItem;
 		}
 	}
 	
 	return i;
 }
-unsigned int ParseInfosRawFileSystem(
+unsigned int ParseInfoRawFileSystem(
 		const char* fileName,
-		InfoItem infos[], unsigned int max) {
-	return ParseInfos(fileName, SPRING_VFS_RAW, SPRING_VFS_RAW, infos, max);
+		InfoItem info[], unsigned int max) {
+	return ParseInfo(fileName, SPRING_VFS_RAW, SPRING_VFS_RAW, info, max);
 }
 
 #endif	/* defined(__cplusplus) &amp;&amp; !defined(BUILDING_AI) &amp;&amp; !defined(BUILDING_AI_INTERFACE) */

Modified: branches/caiinterface/rts/ExternalAI/Interface/SInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SInfo.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/Interface/SInfo.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -15,7 +15,7 @@
 	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-// The structs in this files relate to *Infos.lua files
+// The structs in this files relate to *Info.lua files
 // They are used for AIs eg (-&gt; AIInfo.lua)
 
 #ifndef _SINFO_H
@@ -35,14 +35,14 @@
 void deleteInfoItem(const struct InfoItem* const info);
 
 #if	defined(__cplusplus) &amp;&amp; !defined(BUILDING_AI) &amp;&amp; !defined(BUILDING_AI_INTERFACE)
-unsigned int ParseInfos(
+unsigned int ParseInfo(
 		const char* fileName,
 		const char* fileModes,
 		const char* accessModes,
-		InfoItem infos[], unsigned int max);
-unsigned int ParseInfosRawFileSystem(
+		InfoItem info[], unsigned int max);
+unsigned int ParseInfoRawFileSystem(
 		const char* fileName,
-		InfoItem infos[], unsigned int max);
+		InfoItem info[], unsigned int max);
 #endif	/* defined(__cplusplus) &amp;&amp; !defined(BUILDING_AI) &amp;&amp; !defined(BUILDING_AI_INTERFACE) */
 
 #ifdef	__cplusplus

Modified: branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/Interface/SSAILibrary.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -92,12 +92,12 @@
 	 * NOTE: this method is optional. An AI not exporting this function is still
 	 * valid.
 	 *
-	 * @param	infos	where the info about this AI library shall be stored to
-	 * @param	max	the maximum number of elements to store into param infos
-	 * @return	number of elements stored into parameter infos
+	 * @param	info	where the info about this AI library shall be stored to
+	 * @param	max	the maximum number of elements to store into param info
+	 * @return	number of elements stored into parameter info
 	 */
-	unsigned int (CALLING_CONV *getInfos)(struct InfoItem infos[],
-			unsigned int max);
+	unsigned int (CALLING_CONV *getInfo)(struct InfoItem info[],
+			unsigned int maxInfoItems);
 	
 	/**
 	 * Returns options that can be set on this AI.
@@ -110,7 +110,7 @@
 	 * @return	number of elements stored into parameter options
 	 */
 	unsigned int (CALLING_CONV *getOptions)(struct Option options[],
-			unsigned int max);
+			unsigned int maxOptions);
 
 	
 	// team instance functions

Modified: branches/caiinterface/rts/ExternalAI/Interface/aidefines.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/aidefines.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/Interface/aidefines.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -20,9 +20,9 @@
 
 #ifdef	__cplusplus
 extern &quot;C&quot; {
-#endif
+#endif	/* __cplusplus */
 
-#include &quot;exportdefines.h&quot;
+#include &quot;System/exportdefines.h&quot;
 
 #include &quot;SAIFloat3.h&quot;
 
@@ -35,7 +35,7 @@
 // !!!absolute paths are needed when debugging!!!
 //#define PATH_TO_SPRING_HOME &quot;/home/robin/svn_work/robin/Development/Projects/Others/spring_C_AI_interface/game_linux/&quot;
 //#define PATH_TO_SPRING_HOME &quot;P:/svn_work/robin/Development/Projects/Others/spring_current/game/&quot;
-#define PATH_TO_SPRING_HOME &quot;&quot;
+//#define PATH_TO_SPRING_HOME &quot;&quot;
 
 /**
  * @brief max skirmish AIs
@@ -60,7 +60,7 @@
 #define GROUP_AI_DATA_DIR &quot;AI/Group/data&quot;
 
 #ifdef	__cplusplus
-}
-#endif
+}		/* extern &quot;C&quot; */
+#endif	/* __cplusplus */
 
 #endif	/* _AIDEFINES_H */

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -22,14 +22,7 @@
 #include &lt;string&gt;
 
 CSkirmishAILibrary::CSkirmishAILibrary(const SSAILibrary&amp; ai,
-		const SSAISpecifier&amp; specifier) : sSAI(ai), specifier(specifier) {
-	
-/*
-	std::map&lt;std::string, InfoItem&gt; infos = GetInfos();
-	specifier.shortName = infos.at(SKIRMISH_AI_PROPERTY_SHORT_NAME).value;
-	specifier.version = infos.at(SKIRMISH_AI_PROPERTY_VERSION).value;
-*/
-}
+		const SSAISpecifier&amp; specifier) : sSAI(ai), specifier(specifier) {}
 
 CSkirmishAILibrary::~CSkirmishAILibrary() {}
 	
@@ -49,22 +42,22 @@
 	}
 }
 	
-std::map&lt;std::string, InfoItem&gt; CSkirmishAILibrary::GetInfos() const {
+std::map&lt;std::string, InfoItem&gt; CSkirmishAILibrary::GetInfo() const {
 	
-	std::map&lt;std::string, InfoItem&gt; infos;
+	std::map&lt;std::string, InfoItem&gt; info;
 	
-	if (sSAI.getInfos != NULL) {
+	if (sSAI.getInfo != NULL) {
 		InfoItem infs[MAX_INFOS];
-		int num = sSAI.getInfos(infs, MAX_INFOS);
+		int num = sSAI.getInfo(infs, MAX_INFOS);
 
 		int i;
 		for (i=0; i &lt; num; ++i) {
 			InfoItem newII = copyInfoItem(&amp;infs[i]);
-			infos[std::string(newII.key)] = newII;
+			info[std::string(newII.key)] = newII;
 		}
 	}
 
-	return infos;
+	return info;
 }
 std::vector&lt;Option&gt; CSkirmishAILibrary::GetOptions() const {
 	

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibrary.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -36,7 +36,7 @@
 			const std::string&amp; engineVersionString, int engineVersionNumber,
 			const SAIInterfaceSpecifier&amp; interfaceSpecifier) const;
 	
-    virtual std::map&lt;std::string, InfoItem&gt; GetInfos() const;
+    virtual std::map&lt;std::string, InfoItem&gt; GetInfo() const;
 	virtual std::vector&lt;Option&gt; GetOptions() const;
 	
 	

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -27,17 +27,18 @@
 #include &lt;vector&gt;
 #include &lt;map&gt;
 
-CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(const ISkirmishAILibrary&amp; ai, const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
-	infos = ai.GetInfos();
+CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(const ISkirmishAILibrary&amp; ai,
+		const SAIInterfaceSpecifier&amp; interfaceSpecifier) {
+	info = ai.GetInfo();
 	options = ai.GetOptions();
 	//levelOfSupport = ai.GetLevelOfSupportFor(std::string(ENGINE_VERSION_STRING),
 	//		ENGINE_VERSION_NUMBER, interfaceSpecifier);
 }
 
 CSkirmishAILibraryInfo::CSkirmishAILibraryInfo(const CSkirmishAILibraryInfo&amp; aiInfo) {
-	infos = std::map&lt;std::string, InfoItem&gt;(
-			aiInfo.infos.begin(),
-			aiInfo.infos.end());
+	info = std::map&lt;std::string, InfoItem&gt;(
+			aiInfo.info.begin(),
+			aiInfo.info.end());
 	options = std::vector&lt;Option&gt;(
 			aiInfo.options.begin(),
 			aiInfo.options.end());
@@ -50,10 +51,10 @@
 		const std::string&amp; fileModes,
 		const std::string&amp; accessModes) {
 	
-	InfoItem tmpInfos[MAX_INFOS];
-	unsigned int num = ParseInfos(aiInfoFile.c_str(), fileModes.c_str(), accessModes.c_str(), tmpInfos, MAX_INFOS);
+	InfoItem tmpInfo[MAX_INFOS];
+	unsigned int num = ParseInfo(aiInfoFile.c_str(), fileModes.c_str(), accessModes.c_str(), tmpInfo, MAX_INFOS);
     for (unsigned int i=0; i &lt; num; ++i) {
-		infos[std::string(tmpInfos[i].key)] = tmpInfos[i];
+		info[std::string(tmpInfo[i].key)] = tmpInfo[i];
     }
 	
 	if (!aiOptionFile.empty()) {
@@ -74,8 +75,8 @@
 
 SSAISpecifier CSkirmishAILibraryInfo::GetSpecifier() const {
 	
-	const char* sn = infos.at(SKIRMISH_AI_PROPERTY_SHORT_NAME).value;
-	const char* v = infos.at(SKIRMISH_AI_PROPERTY_SHORT_NAME).value;
+	const char* sn = info.at(SKIRMISH_AI_PROPERTY_SHORT_NAME).value;
+	const char* v = info.at(SKIRMISH_AI_PROPERTY_VERSION).value;
 	SSAISpecifier specifier = {sn, v};
 	return specifier;
 }
@@ -105,51 +106,34 @@
 	return GetInfo(SKIRMISH_AI_PROPERTY_INTERFACE_VERSION);
 }
 std::string CSkirmishAILibraryInfo::GetInfo(const std::string&amp; key) const {
-	return infos.at(key).value;
+	return info.at(key).value;
 }
-const std::map&lt;std::string, InfoItem&gt;* CSkirmishAILibraryInfo::GetInfos() const {
-	return &infos;
+const std::map&lt;std::string, InfoItem&gt;* CSkirmishAILibraryInfo::GetInfo() const {
+	return &info;
 }
 
 const std::vector&lt;Option&gt;* CSkirmishAILibraryInfo::GetOptions() const {
-//	return &optionInfos;
-/*
-	std::vector&lt;const ISkirmishAIOption*&gt; opInfs;
-	
-	std::vector&lt;CSkirmishAIOption&gt;::const_iterator  opInf;
-	for (opInf=optionInfos.begin(); opInf != optionInfos.end(); opInf++) {
-//		opInfs.push_back((const ISkirmishAIOption*) opInf);
-		const CSkirmishAIOption* cop = &amp;(*opInf);
-		const ISkirmishAIOption* iop = cop;
-		opInfs.push_back(iop);
-	}
-	
-	return opInfs;
-*/
-/*
-	ISkirmishAIOption::const_vector c_optionInfos(optionInfos.begin(), optionInfos.end()); // implicit convertible types -&gt; range-ctor can be used
-*/
 	return &options;
 }
 
 
-unsigned int CSkirmishAILibraryInfo::GetInfosCReference(InfoItem cInfos[], unsigned int max) const {
+unsigned int CSkirmishAILibraryInfo::GetInfoCReference(InfoItem cInfo[], unsigned int maxInfoItems) const {
 	
 	unsigned int i=0;
 	
 	std::map&lt;std::string, InfoItem&gt;::const_iterator infs;
-	for (infs=infos.begin(); infs != infos.end() &amp;&amp; i &lt; max; ++infs) {
-		cInfos[i++] = infs-&gt;second;
+	for (infs=info.begin(); infs != info.end() &amp;&amp; i &lt; maxInfoItems; ++infs) {
+		cInfo[i++] = infs-&gt;second;
     }
 	
 	return i;
 }
-unsigned int CSkirmishAILibraryInfo::GetOptionsCReference(Option cOptions[], unsigned int max) const {
+unsigned int CSkirmishAILibraryInfo::GetOptionsCReference(Option cOptions[], unsigned int maxOptions) const {
 	
 	unsigned int i=0;
 	
 	std::vector&lt;Option&gt;::const_iterator ops;
-	for (ops=options.begin(); ops != options.end() &amp;&amp; i &lt; max; ++ops) {
+	for (ops=options.begin(); ops != options.end() &amp;&amp; i &lt; maxOptions; ++ops) {
 		cOptions[i++] = *ops;
     }
 	
@@ -192,17 +176,10 @@
 	}
 	
 	InfoItem ii = {key.c_str(), value.c_str(), NULL};
-	infos[key] = ii;
+	info[key] = ii;
 	return true;
 }
 
 void CSkirmishAILibraryInfo::SetOptions(const std::vector&lt;Option&gt;&amp; _options) {
-/*
-	optionInfos.clear();
-	ISkirmishAIOption::const_vector::const_iterator opInf;
-	for (opInf=_optionInfos.begin(); opInf != _optionInfos.end(); opInf++) {
-		optionInfos.push_back(**opInf);
-	}
-*/
 	options = std::vector&lt;Option&gt;(_options.begin(), _options.end()); // implicit convertible types -&gt; range-ctor can be used
 }

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAILibraryInfo.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -56,10 +56,10 @@
     virtual std::string GetInterfaceShortName() const;
     virtual std::string GetInterfaceVersion() const;
     virtual std::string GetInfo(const std::string&amp; key) const;
-    virtual const std::map&lt;std::string, InfoItem&gt;* GetInfos() const;
+    virtual const std::map&lt;std::string, InfoItem&gt;* GetInfo() const;
 //    virtual std::vector&lt;std::string&gt; GetPropertyNames() const;
-	virtual unsigned int GetInfosCReference(InfoItem cInfos[], unsigned int max) const;
-	virtual unsigned int GetOptionsCReference(Option cOptions[], unsigned int max) const;
+	virtual unsigned int GetInfoCReference(InfoItem cInfo[], unsigned int maxInfoItems) const;
+	virtual unsigned int GetOptionsCReference(Option cOptions[], unsigned int maxOptions) const;
 	
 	virtual const std::vector&lt;Option&gt;* GetOptions() const;
 	
@@ -78,7 +78,7 @@
 private:
 	static const unsigned int MAX_INFOS = 128;
 	static const unsigned int MAX_OPTIONS = 128;
-	std::map&lt;std::string, InfoItem&gt; infos;
+	std::map&lt;std::string, InfoItem&gt; info;
 	std::vector&lt;Option&gt; options;
 	//LevelOfSupport levelOfSupport;
 };

Modified: branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/ExternalAI/SkirmishAIWrapper.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -123,7 +123,7 @@
 	ai = SAFE_NEW CSkirmishAI(teamId, skirmishAIKey);
 	
 	const ISkirmishAILibrary* skirmishAILibrary = IAILibraryManager::GetInstance()-&gt;FetchSkirmishAILibrary(skirmishAIKey);
-	//bool loadSupported = std::string(skirmishAILibrary-&gt;GetInfos()[SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED].value) == &quot;yes&quot;;
+	//bool loadSupported = std::string(skirmishAILibrary-&gt;GetInfo()[SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED].value) == &quot;yes&quot;;
 	bool loadSupported = IAILibraryManager::GetInstance()-&gt;GetSkirmishAIInfos()-&gt;at(skirmishAIKey)-&gt;GetInfo(SKIRMISH_AI_PROPERTY_LOAD_SUPPORTED) == &quot;yes&quot;;
 	IAILibraryManager::GetInstance()-&gt;ReleaseSkirmishAILibrary(skirmishAIKey);
 

Modified: branches/caiinterface/rts/Lua/LuaSyncedRead.cpp
===================================================================
--- branches/caiinterface/rts/Lua/LuaSyncedRead.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/Lua/LuaSyncedRead.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -1580,7 +1580,7 @@
 	else if (lua_istable(L, 2)) {
 		const int table = 2;
 		for (lua_pushnil(L); lua_next(L, table) != 0; lua_pop(L, 1)) {
-			if (!lua_isnumber(L, -1)) {
+			if (lua_isnumber(L, -1)) {
 				const int unitDefID = lua_toint(L, -1);
 				const UnitDef* ud = unitDefHandler-&gt;GetUnitByID(unitDefID);
 				InsertSearchUnitDefs(ud, allied, defs);
@@ -2758,7 +2758,7 @@
 		lua_pushnumber(L, unit-&gt;flankingBonusDir.z);
 		return 7;
 	}
-	
+
 	return 0;
 }
 
@@ -2964,7 +2964,7 @@
 		lua_pushnumber(L, losStatus); // return a numberic value
 		return 1;
 	}
-	
+
 	lua_newtable(L);
 	if (losStatus &amp; LOS_INLOS) {
 		HSTR_PUSH_BOOL(L, &quot;los&quot;, true);
@@ -4541,7 +4541,7 @@
 	}
 	lua_pushnumber(L, value);
 	return 1;
-	 		
+
 }
 
 

Modified: branches/caiinterface/rts/Sim/Features/FeatureHandler.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Features/FeatureHandler.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/Sim/Features/FeatureHandler.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -280,6 +280,9 @@
 
 const FeatureDef* CFeatureHandler::GetFeatureDef(const std::string mixedCase)
 {
+	if (mixedCase.empty())
+		return NULL;
+
 	const string name = StringToLower(mixedCase);
 	std::map&lt;std::string, const FeatureDef*&gt;::iterator fi = featureDefs.find(name);
 

Modified: branches/caiinterface/rts/Sim/Misc/AirBaseHandler.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Misc/AirBaseHandler.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/Sim/Misc/AirBaseHandler.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -6,7 +6,7 @@
 #include &quot;Sim/Units/UnitDef.h&quot;
 #include &quot;creg/STL_List.h&quot;
 
-CAirBaseHandler* airBaseHandler=0;
+CAirBaseHandler* airBaseHandler = 0;
 
 CR_BIND(CAirBaseHandler, )
 CR_REG_METADATA(CAirBaseHandler,(
@@ -40,9 +40,9 @@
 CAirBaseHandler::~CAirBaseHandler(void)
 {
 	//shouldnt be any bases left here...
-	for(int a=0;a&lt;gs-&gt;activeAllyTeams;++a){
-		for(std::list&lt;AirBase*&gt;::iterator bi=bases[a].begin();bi!=bases[a].end();++bi){
-			for(std::list&lt;LandingPad*&gt;::iterator pi=(*bi)-&gt;pads.begin();pi!=(*bi)-&gt;pads.end();++pi){
+	for (int a = 0; a &lt; gs-&gt;activeAllyTeams; ++a) {
+		for (airBaseLstIt bi = bases[a].begin(); bi != bases[a].end(); ++bi) {
+			for (padLstIt pi = (*bi)-&gt;pads.begin(); pi !=(*bi)-&gt;pads.end(); ++pi) {
 				delete *pi;
 			}
 			delete *bi;
@@ -76,7 +76,7 @@
 		if ((piece &lt; 0) || (piece &gt;= base-&gt;cob-&gt;pieces.size())) {
 			continue;
 		}
-		LandingPad* pad=SAFE_NEW LandingPad(base, piece, ab);
+		LandingPad* pad = SAFE_NEW LandingPad(base, piece, ab);
 
 		ab-&gt;pads.push_back(pad);
 		ab-&gt;freePads.push_back(pad);
@@ -89,16 +89,17 @@
 
 void CAirBaseHandler::DeregisterAirBase(CUnit* base)
 {
-	for(std::list&lt;AirBase*&gt;::iterator bi=freeBases[base-&gt;allyteam].begin();bi!=freeBases[base-&gt;allyteam].end();++bi){
-		if((*bi)-&gt;unit==base){
+	for (airBaseLstIt bi = freeBases[base-&gt;allyteam].begin(); bi != freeBases[base-&gt;allyteam].end(); ++bi) {
+		if ((*bi)-&gt;unit == base) {
 			freeBases[base-&gt;allyteam].erase(bi);
 			break;
 		}
 	}
-	for(std::list&lt;AirBase*&gt;::iterator bi=bases[base-&gt;allyteam].begin();bi!=bases[base-&gt;allyteam].end();++bi){
-		if((*bi)-&gt;unit==base){
-			for(std::list&lt;LandingPad*&gt;::iterator pi=(*bi)-&gt;pads.begin();pi!=(*bi)-&gt;pads.end();++pi){
-				delete *pi;		//its the unit that has reserved a pads responsibility to see if the pad is gone so just delete it
+	for (airBaseLstIt bi = bases[base-&gt;allyteam].begin(); bi != bases[base-&gt;allyteam].end(); ++bi) {
+		if ((*bi)-&gt;unit == base) {
+			for (padLstIt pi = (*bi)-&gt;pads.begin(); pi != (*bi)-&gt;pads.end(); ++pi) {
+				// the unit that has reserved a pad is responsible to see if the pad is gone so just delete it
+				delete *pi;
 			}
 			delete *bi;
 			bases[base-&gt;allyteam].erase(bi);
@@ -112,26 +113,36 @@
 it's the callers responsibility to detect if the base dies while its reserved. */
 CAirBaseHandler::LandingPad* CAirBaseHandler::FindAirBase(CUnit* unit, float minPower)
 {
-	float closest=1e6f;
-	std::list&lt;LandingPad*&gt;::iterator foundPad;
-	std::list&lt;AirBase*&gt;::iterator foundBase=freeBases[unit-&gt;allyteam].end();
+	float closest = 1e6f;
+	padLstIt foundPad;
+	airBaseLstIt foundBase = freeBases[unit-&gt;allyteam].end();
 
-	for(std::list&lt;AirBase*&gt;::iterator bi=freeBases[unit-&gt;allyteam].begin();bi!=freeBases[unit-&gt;allyteam].end();++bi){
-		if((*bi)-&gt;unit-&gt;pos.distance(unit-&gt;pos)&gt;=closest || (*bi)-&gt;unit-&gt;unitDef-&gt;buildSpeed &lt; minPower)
+	for (airBaseLstIt bi = freeBases[unit-&gt;allyteam].begin(); bi != freeBases[unit-&gt;allyteam].end(); ++bi) {
+		CUnit* baseUnit = (*bi)-&gt;unit;
+
+		if (unit == baseUnit) {
+			// don't pick ourselves as a landing pad
 			continue;
-		for(std::list&lt;LandingPad*&gt;::iterator pi=(*bi)-&gt;freePads.begin();pi!=(*bi)-&gt;freePads.end();++pi){
-			closest=(*bi)-&gt;unit-&gt;pos.distance(unit-&gt;pos);
-			foundPad=pi;
-			foundBase=bi;
 		}
+
+		if (baseUnit-&gt;pos.distance(unit-&gt;pos) &gt;= closest || baseUnit-&gt;unitDef-&gt;buildSpeed &lt; minPower) {
+			continue;
+		}
+
+		for (padLstIt pi = (*bi)-&gt;freePads.begin(); pi != (*bi)-&gt;freePads.end(); ++pi) {
+			closest = baseUnit-&gt;pos.distance(unit-&gt;pos);
+			foundPad = pi;
+			foundBase = bi;
+		}
 	}
 
 
-	if(foundBase!=freeBases[unit-&gt;allyteam].end()){
-		LandingPad* found=*foundPad;
+	if (foundBase != freeBases[unit-&gt;allyteam].end()) {
+		LandingPad* found = *foundPad;
 		(*foundBase)-&gt;freePads.erase(foundPad);
 		return found;
 	}
+
 	return 0;
 }
 
@@ -145,18 +156,28 @@
 /** @brief Try to find the closest airbase even if its reserved */
 float3 CAirBaseHandler::FindClosestAirBasePos(CUnit* unit, float minPower)
 {
-	float closest=1e6f;
-	std::list&lt;AirBase*&gt;::iterator foundBase=freeBases[unit-&gt;allyteam].end();
+	float closest = 1e6f;
+	airBaseLstIt foundBase = freeBases[unit-&gt;allyteam].end();
 
-	for(std::list&lt;AirBase*&gt;::iterator bi=freeBases[unit-&gt;allyteam].begin();bi!=freeBases[unit-&gt;allyteam].end();++bi){
-		if((*bi)-&gt;unit-&gt;pos.distance(unit-&gt;pos)&gt;=closest || (*bi)-&gt;unit-&gt;unitDef-&gt;buildSpeed &lt; minPower)
+	for (airBaseLstIt bi = freeBases[unit-&gt;allyteam].begin(); bi != freeBases[unit-&gt;allyteam].end(); ++bi) {
+		CUnit* baseUnit = (*bi)-&gt;unit;
+
+		if (unit == baseUnit) {
+			// don't pick ourselves as a landing pad
 			continue;
-		closest=(*bi)-&gt;unit-&gt;pos.distance(unit-&gt;pos);
-		foundBase=bi;
+		}
+
+		if (baseUnit-&gt;pos.distance(unit-&gt;pos) &gt;= closest || baseUnit-&gt;unitDef-&gt;buildSpeed &lt; minPower) {
+			continue;
+		}
+
+		closest = baseUnit-&gt;pos.distance(unit-&gt;pos);
+		foundBase = bi;
 	}
 
-	if(foundBase!=freeBases[unit-&gt;allyteam].end()){
+	if (foundBase != freeBases[unit-&gt;allyteam].end()) {
 		return (*foundBase)-&gt;unit-&gt;pos;
 	}
+
 	return ZeroVector;
 }

Modified: branches/caiinterface/rts/Sim/Misc/AirBaseHandler.h
===================================================================
--- branches/caiinterface/rts/Sim/Misc/AirBaseHandler.h	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/Sim/Misc/AirBaseHandler.h	2008-10-11 11:44:05 UTC (rev 6665)
@@ -62,6 +62,11 @@
 private:
 	std::list&lt;AirBase*&gt; freeBases[MAX_TEAMS];
 	std::list&lt;AirBase*&gt; bases[MAX_TEAMS];
+
+	typedef std::list&lt;AirBase*&gt; airBaseLst;
+	typedef std::list&lt;AirBase*&gt;::iterator airBaseLstIt;
+	typedef std::list&lt;LandingPad*&gt; padLst;
+	typedef std::list&lt;LandingPad*&gt;::iterator padLstIt;
 };
 
 extern CAirBaseHandler* airBaseHandler;

Modified: branches/caiinterface/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -130,7 +130,7 @@
 
 void CSpherePartSpawner::Init(const float3&amp; pos, CUnit *owner)
 {
+	CProjectile::Init(pos, owner);
 	deleteMe = true;
 	CSpherePartProjectile::CreateSphere(pos + this-&gt;pos, alpha, ttl, expansionSpeed, owner, color);
-
 }

Modified: branches/caiinterface/rts/Sim/Units/CommandAI/CommandAI.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/CommandAI/CommandAI.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/Sim/Units/CommandAI/CommandAI.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -371,9 +371,6 @@
 	// AI's may do as they like
 	bool aiOrder = (gs-&gt;Team(owner-&gt;team) &amp;&amp; gs-&gt;Team(owner-&gt;team)-&gt;isAI);
 
-	if (fromSynced)
-		maxHeightDiff = 200;
-
 	switch (c.id) {
 		case CMD_DGUN:
 			if (!owner-&gt;unitDef-&gt;canDGun)
@@ -384,7 +381,7 @@
 
 			if (c.params.size() == 3) {
 				// check if attack ground is really attack ground
-				if (!aiOrder &amp;&amp;
+				if (!aiOrder &amp;&amp; !fromSynced &amp;&amp;
 					fabs(c.params[1] - ground-&gt;GetHeight2(c.params[0], c.params[2])) &gt; maxHeightDiff) {
 					return false;
 				}

Modified: branches/caiinterface/rts/build/scons/rts.py
===================================================================
--- branches/caiinterface/rts/build/scons/rts.py	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/build/scons/rts.py	2008-10-11 11:44:05 UTC (rev 6665)
@@ -1,6 +1,7 @@
 # Copyright (C) 2006  Tobi Vollebregt
 
 import os, sys
+import platform
 import SCons.Util
 from SCons.Options import Options
 import config, detect, filelist
@@ -86,13 +87,14 @@
 	usropts.AddOptions(
 		#permanent options
 		('platform',          'Set to linux, freebsd or windows', None),
-		('gml',               'Set to false to disable OpenGL thread library', True),
+		('gml',               'Set to false to disable OpenGL thread library', False),
 		('debug',             'Set to yes to produce a binary with debug information', 0),
 		('debugdefines',      'Set to no to suppress DEBUG and _DEBUG preprocessor #defines (use to add symbols to release build)', True),
 		('syncdebug',         'Set to yes to enable the sync debugger', False),
 		('synccheck',         'Set to yes to enable sync checker &amp; resyncer', True),
 		('synctrace',         'Enable sync tracing', False),
 		('optimize',          'Enable processor optimizations during compilation', 1),
+		('arch',	      'CPU architecture to use', 'auto'),
 		('profile',           'Set to yes to produce a binary with profiling information', False),
 		('profile_generate',  'Set to yes to compile with -fprofile-generate to generate profiling information', False),
 		('profile_use',       'Set to yes to compile with -fprofile-use to use profiling information', False),
@@ -126,6 +128,7 @@
 		('CC',            'c compiler'),
 		('CXX',           'c++ compiler'),
 		('spring_defines','extra c preprocessor defines for spring'),
+		('streflop_extra','extra options for streflop Makefile'),
 		('is_configured', 'configuration version stamp'))
 
 	usropts.Update(env)
@@ -152,7 +155,7 @@
 		for key in ['platform', 'gml', 'debug', 'optimize', 'profile', 'profile_use', 'profile_generate', 'cpppath',
 			'libpath', 'prefix', 'installprefix', 'datadir', 'bindir', 'libdir', 'cachedir', 'strip',
 			'disable_avi', 'use_tcmalloc', 'use_mmgr', 'use_gch', 'LINKFLAGS', 'LIBPATH', 'LIBS', 'CCFLAGS',
-			'CXXFLAGS', 'CPPDEFINES', 'CPPPATH', 'CC', 'CXX', 'is_configured', 'spring_defines']:
+			'CXXFLAGS', 'CPPDEFINES', 'CPPPATH', 'CC', 'CXX', 'is_configured', 'spring_defines', 'arch']:
 			if env.has_key(key): env.__delitem__(key)
 
 		print &quot;\nNow configuring.  If something fails, consult `config.log' for details.\n&quot;
@@ -215,6 +218,26 @@
 		# Other options copied from streflop makefiles.
 		env['CCFLAGS'] = ['-fsingle-precision-constant', '-frounding-math', '-fsignaling-nans', '-mieee-fp']
 
+		# set architecture
+		if 'arch' in args and args['arch'] != 'auto':
+			arch = args['arch']
+			if not arch or arch == 'none':
+				print 'Configuring for default architecture'
+				env['streflop_extra'] = ''
+			else:
+				print 'Configuring for', arch
+				env['CCFLAGS'] += ['-march=' + arch]
+				env['streflop_extra'] = 'ARCH=' + arch
+		else:
+			bits, archname = platform.architecture()
+			if bits == '32bit' or env['platform'] == 'windows':
+				print 'Configuring for i686'
+				env['CCFLAGS'] += ['-march=i686']
+				env['streflop_extra'] = 'ARCH=i686'
+			else:
+				print 'Configuring for default architecture'
+				env['streflop_extra'] = ''
+
 		# profile?
 		bool_opt('profile', False)
 		if env['profile']:
@@ -349,7 +372,7 @@
 			#else:
 			#	env['CXXFLAGS'] = env['CCFLAGS']
 
-		bool_opt('gml', True)
+		bool_opt('gml', False)
 		bool_opt('strip', False)
 		bool_opt('disable_avi', env['platform'] != 'windows')
 		bool_opt('use_tcmalloc', False)

Modified: branches/caiinterface/rts/lib/streflop/Makefile.common
===================================================================
--- branches/caiinterface/rts/lib/streflop/Makefile.common	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/rts/lib/streflop/Makefile.common	2008-10-11 11:44:05 UTC (rev 6665)
@@ -16,7 +16,14 @@
 #STREFLOP_NO_DENORMALS = 1
 
 # 3. Set optimization options. You may add -march=you_cpu here for example
-CXXFLAGS = -O3 -pipe -g
+CXXFLAGS = -O3 -pipe -g -mno-tls-direct-seg-refs
+ifdef WIN32
+	CXXFLAGS += -mthreads
+endif
+ifdef ARCH
+	CXXFLAGS += -march=$(ARCH)
+endif
+
 #CXXFLAGS = -O0 -pipe -g
 
 
@@ -25,7 +32,7 @@
 ############################################################
 
 # 4. Optional, removes false dependency on libm
-LDFLAGS=-Wl,--as-needed
+LDFLAGS=-Wl,--as-needed -mno-tls-direct-seg-refs -mthreads
 
 # Options for correctness of code.
 # -ffloat-store is not needed since the FPU flags are set by the streflop_init functions

Modified: branches/caiinterface/tools/unitsync/unitsync.cpp
===================================================================
--- branches/caiinterface/tools/unitsync/unitsync.cpp	2008-10-11 00:59:23 UTC (rev 6664)
+++ branches/caiinterface/tools/unitsync/unitsync.cpp	2008-10-11 11:44:05 UTC (rev 6665)
@@ -1156,16 +1156,17 @@
 		const std::string&amp; fileModes,
 		const std::string&amp; accessModes)
 {
-	std::vector&lt;InfoItem&gt; infos;
+	std::vector&lt;InfoItem&gt; info;
 	
 	static const unsigned int MAX_INFOS = 128;
-	InfoItem tmpInfos[MAX_INFOS];
-	unsigned int num = ParseInfos(fileName.c_str(), fileModes.c_str(), accessModes.c_str(), tmpInfos, MAX_INFOS);
+	InfoItem tmpInfo[MAX_INFOS];
+	unsigned int num = ParseInfo(fileName.c_str(), fileModes.c_str(),
+			accessModes.c_str(), tmpInfo, MAX_INFOS);
 	for (unsigned int i=0; i &lt; num; ++i) {
-		infos.push_back(tmpInfos[i]);
+		info.push_back(tmpInfo[i]);
     }
 	
-	return infos;
+	return info;
 }
 
 Export(int) GetSkirmishAIInfoCount(int index) {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001433.html">[Taspring-linux-commit] r6664 - trunk/rts/Rendering/Textures
</A></li>
	<LI>Next message: <A HREF="001435.html">[Taspring-linux-commit] r6666 - Lobby/TASClient Lobby/TASServer	Lobby/TASServer/Documentation trunk/Documentation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1434">[ date ]</a>
              <a href="thread.html#1434">[ thread ]</a>
              <a href="subject.html#1434">[ subject ]</a>
              <a href="author.html#1434">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
