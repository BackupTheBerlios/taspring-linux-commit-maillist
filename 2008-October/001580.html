<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6811 - in trunk: AI/Global/AAI	AI/Global/JCAI AI/Global/KAI-0.2 AI/Global/KAIK-0.13	AI/Global/NTai/AI/NTai/SDK AI/Group/MexUpgraderAI	rts/ExternalAI rts/Game rts/Game/Camera rts/Game/StartScripts	rts/Game/UI rts/Lua rts/Map rts/Map/SM3 rts/Map/SM3/terrain	rts/Map/SMF rts/Rendering rts/Rendering/Env rts/Rendering/GL	rts/Rendering/Textures rts/Rendering/UnitModels rts/Sim	rts/Sim/Features rts/Sim/Misc rts/Sim/MoveTypes	rts/Sim/Objects rts/Sim/Path rts/Sim/Projectiles	rts/Sim/Projectiles/Unsynced	rts/Sim/Projectiles/WeaponProjectiles rts/Sim/Units	rts/Sim/Units/COB rts/Sim/Units/CommandAI	rts/Sim/Units/UnitTypes rts/Sim/Weapons rts/System	rts/System/Script rts/System/Sync
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6811%20-%20in%20trunk%3A%20AI/Global/AAI%0A%09AI/Global/JCAI%20AI/Global/KAI-0.2%20AI/Global/KAIK-0.13%0A%09AI/Global/NTai/AI/NTai/SDK%20AI/Group/MexUpgraderAI%0A%09rts/ExternalAI%20rts/Game%20rts/Game/Camera%20rts/Game/StartScripts%0A%09rts/Game/UI%20rts/Lua%20rts/Map%20rts/Map/SM3%20rts/Map/SM3/terrain%0A%09rts/Map/SMF%20rts/Rendering%20rts/Rendering/Env%20rts/Rendering/GL%0A%09rts/Rendering/Textures%20rts/Rendering/UnitModels%20rts/Sim%0A%09rts/Sim/Features%20rts/Sim/Misc%20rts/Sim/MoveTypes%0A%09rts/Sim/Objects%20rts/Sim/Path%20rts/Sim/Projectiles%0A%09rts/Sim/Projectiles/Unsynced%0A%09rts/Sim/Projectiles/WeaponProjectiles%20rts/Sim/Units%0A%09rts/Sim/Units/COB%20rts/Sim/Units/CommandAI%0A%09rts/Sim/Units/UnitTypes%20rts/Sim/Weapons%20rts/System%0A%09rts/System/Script%20rts/System/Sync&In-Reply-To=%3C20081018145508.3E815472A%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001579.html">
   <LINK REL="Next"  HREF="001581.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6811 - in trunk: AI/Global/AAI	AI/Global/JCAI AI/Global/KAI-0.2 AI/Global/KAIK-0.13	AI/Global/NTai/AI/NTai/SDK AI/Group/MexUpgraderAI	rts/ExternalAI rts/Game rts/Game/Camera rts/Game/StartScripts	rts/Game/UI rts/Lua rts/Map rts/Map/SM3 rts/Map/SM3/terrain	rts/Map/SMF rts/Rendering rts/Rendering/Env rts/Rendering/GL	rts/Rendering/Textures rts/Rendering/UnitModels rts/Sim	rts/Sim/Features rts/Sim/Misc rts/Sim/MoveTypes	rts/Sim/Objects rts/Sim/Path rts/Sim/Projectiles	rts/Sim/Projectiles/Unsynced	rts/Sim/Projectiles/WeaponProjectiles rts/Sim/Units	rts/Sim/Units/COB rts/Sim/Units/CommandAI	rts/Sim/Units/UnitTypes rts/Sim/Weapons rts/System	rts/System/Script rts/System/Sync</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6811%20-%20in%20trunk%3A%20AI/Global/AAI%0A%09AI/Global/JCAI%20AI/Global/KAI-0.2%20AI/Global/KAIK-0.13%0A%09AI/Global/NTai/AI/NTai/SDK%20AI/Group/MexUpgraderAI%0A%09rts/ExternalAI%20rts/Game%20rts/Game/Camera%20rts/Game/StartScripts%0A%09rts/Game/UI%20rts/Lua%20rts/Map%20rts/Map/SM3%20rts/Map/SM3/terrain%0A%09rts/Map/SMF%20rts/Rendering%20rts/Rendering/Env%20rts/Rendering/GL%0A%09rts/Rendering/Textures%20rts/Rendering/UnitModels%20rts/Sim%0A%09rts/Sim/Features%20rts/Sim/Misc%20rts/Sim/MoveTypes%0A%09rts/Sim/Objects%20rts/Sim/Path%20rts/Sim/Projectiles%0A%09rts/Sim/Projectiles/Unsynced%0A%09rts/Sim/Projectiles/WeaponProjectiles%20rts/Sim/Units%0A%09rts/Sim/Units/COB%20rts/Sim/Units/CommandAI%0A%09rts/Sim/Units/UnitTypes%20rts/Sim/Weapons%20rts/System%0A%09rts/System/Script%20rts/System/Sync&In-Reply-To=%3C20081018145508.3E815472A%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6811 - in trunk: AI/Global/AAI	AI/Global/JCAI AI/Global/KAI-0.2 AI/Global/KAIK-0.13	AI/Global/NTai/AI/NTai/SDK AI/Group/MexUpgraderAI	rts/ExternalAI rts/Game rts/Game/Camera rts/Game/StartScripts	rts/Game/UI rts/Lua rts/Map rts/Map/SM3 rts/Map/SM3/terrain	rts/Map/SMF rts/Rendering rts/Rendering/Env rts/Rendering/GL	rts/Rendering/Textures rts/Rendering/UnitModels rts/Sim	rts/Sim/Features rts/Sim/Misc rts/Sim/MoveTypes	rts/Sim/Objects rts/Sim/Path rts/Sim/Projectiles	rts/Sim/Projectiles/Unsynced	rts/Sim/Projectiles/WeaponProjectiles rts/Sim/Units	rts/Sim/Units/COB rts/Sim/Units/CommandAI	rts/Sim/Units/UnitTypes rts/Sim/Weapons rts/System	rts/System/Script rts/System/Sync">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sat Oct 18 16:55:07 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001579.html">[Taspring-linux-commit] r6810 - trunk/tools/unitsync
</A></li>
        <LI>Next message: <A HREF="001581.html">[Taspring-linux-commit] r6812 - trunk/rts/System
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1580">[ date ]</a>
              <a href="thread.html#1580">[ thread ]</a>
              <a href="subject.html#1580">[ subject ]</a>
              <a href="author.html#1580">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: Auswaschbar
Date: 2008-10-18 16:55:04 +0200 (Sat, 18 Oct 2008)
New Revision: 6811

Added:
   trunk/rts/Game/GlobalConstants.h
   trunk/rts/Game/GlobalSynced.cpp
   trunk/rts/Game/GlobalSynced.h
   trunk/rts/System/GlobalUnsynced.cpp
   trunk/rts/System/GlobalUnsynced.h
   trunk/rts/System/Vec2.h
Removed:
   trunk/rts/System/GlobalStuff.cpp
   trunk/rts/System/GlobalStuff.h
Modified:
   trunk/AI/Global/AAI/aidef.h
   trunk/AI/Global/JCAI/BaseAIDef.h
   trunk/AI/Global/JCAI/ForceHandler.cpp
   trunk/AI/Global/KAI-0.2/CoverageHandler.cpp
   trunk/AI/Global/KAI-0.2/DamageControl.cpp
   trunk/AI/Global/KAIK-0.13/DefenseMatrix.cpp
   trunk/AI/Global/KAIK-0.13/Unit.cpp
   trunk/AI/Global/KAIK-0.13/UnitTable.cpp
   trunk/AI/Global/NTai/AI/NTai/SDK/AI.h
   trunk/AI/Group/MexUpgraderAI/GroupAI.cpp
   trunk/rts/ExternalAI/AICheats.cpp
   trunk/rts/ExternalAI/GlobalAI.cpp
   trunk/rts/ExternalAI/GlobalAIHandler.cpp
   trunk/rts/ExternalAI/GlobalAIHandler.h
   trunk/rts/ExternalAI/Group.cpp
   trunk/rts/ExternalAI/GroupHandler.h
   trunk/rts/Game/Camera.cpp
   trunk/rts/Game/Camera/FPSController.cpp
   trunk/rts/Game/Camera/FreeController.cpp
   trunk/rts/Game/Camera/OrbitController.h
   trunk/rts/Game/Camera/OverheadController.cpp
   trunk/rts/Game/Camera/SmoothController.cpp
   trunk/rts/Game/Camera/TWController.cpp
   trunk/rts/Game/CameraHandler.cpp
   trunk/rts/Game/GameHelper.cpp
   trunk/rts/Game/GameServer.cpp
   trunk/rts/Game/GameServer.h
   trunk/rts/Game/GameSetup.h
   trunk/rts/Game/Player.cpp
   trunk/rts/Game/PlayerRoster.cpp
   trunk/rts/Game/PreGame.cpp
   trunk/rts/Game/SelectedUnits.cpp
   trunk/rts/Game/SelectedUnitsAI.cpp
   trunk/rts/Game/StartScripts/AirScript.cpp
   trunk/rts/Game/Team.cpp
   trunk/rts/Game/UI/EndGameBox.cpp
   trunk/rts/Game/UI/EndGameBox.h
   trunk/rts/Game/UI/GameSetupDrawer.cpp
   trunk/rts/Game/UI/InputReceiver.h
   trunk/rts/Game/UI/MouseCursor.cpp
   trunk/rts/Game/UI/QuitBox.cpp
   trunk/rts/Game/UI/ResourceBar.cpp
   trunk/rts/Game/UI/ShareBox.cpp
   trunk/rts/Game/WaitCommandsAI.cpp
   trunk/rts/Lua/LuaFeatureDefs.cpp
   trunk/rts/Lua/LuaGaia.cpp
   trunk/rts/Lua/LuaHandle.cpp
   trunk/rts/Lua/LuaHandleSynced.cpp
   trunk/rts/Lua/LuaPathFinder.cpp
   trunk/rts/Lua/LuaRules.cpp
   trunk/rts/Lua/LuaSyncedCtrl.cpp
   trunk/rts/Lua/LuaWeaponDefs.cpp
   trunk/rts/Map/Ground.h
   trunk/rts/Map/MapInfo.cpp
   trunk/rts/Map/MetalMap.cpp
   trunk/rts/Map/MetalMap.h
   trunk/rts/Map/ReadMap.h
   trunk/rts/Map/SM3/Sm3GroundDrawer.cpp
   trunk/rts/Map/SM3/terrain/TerrainTextureGLSL.cpp
   trunk/rts/Map/SMF/BFGroundDrawer.cpp
   trunk/rts/Rendering/Env/AdvSky.cpp
   trunk/rts/Rendering/Env/AdvTreeGenerator.cpp
   trunk/rts/Rendering/Env/AdvWater.cpp
   trunk/rts/Rendering/Env/BaseTreeDrawer.cpp
   trunk/rts/Rendering/Env/BasicSky.cpp
   trunk/rts/Rendering/Env/BumpWater.cpp
   trunk/rts/Rendering/Env/DynWater.cpp
   trunk/rts/Rendering/Env/GrassDrawer.cpp
   trunk/rts/Rendering/Env/RefractWater.cpp
   trunk/rts/Rendering/Env/SkyBox.cpp
   trunk/rts/Rendering/FartextureHandler.cpp
   trunk/rts/Rendering/GL/myGL.cpp
   trunk/rts/Rendering/GroundDecalHandler.cpp
   trunk/rts/Rendering/GroundFlash.cpp
   trunk/rts/Rendering/IconHandler.cpp
   trunk/rts/Rendering/Textures/NamedTextures.cpp
   trunk/rts/Rendering/Textures/TextureAtlas.cpp
   trunk/rts/Rendering/Textures/TextureHandler.cpp
   trunk/rts/Rendering/UnitModels/3DModelParser.h
   trunk/rts/Rendering/UnitModels/3DOParser.cpp
   trunk/rts/Rendering/UnitModels/UnitDrawer.cpp
   trunk/rts/Rendering/glFont.cpp
   trunk/rts/Sim/Features/Feature.cpp
   trunk/rts/Sim/Features/FeatureHandler.cpp
   trunk/rts/Sim/Misc/AirBaseHandler.cpp
   trunk/rts/Sim/Misc/AirBaseHandler.h
   trunk/rts/Sim/Misc/GroundBlockingObjectMap.cpp
   trunk/rts/Sim/Misc/InterceptHandler.cpp
   trunk/rts/Sim/Misc/QuadField.cpp
   trunk/rts/Sim/Misc/QuadField.h
   trunk/rts/Sim/Misc/Wind.cpp
   trunk/rts/Sim/ModInfo.cpp
   trunk/rts/Sim/MoveTypes/GroundMoveType.cpp
   trunk/rts/Sim/MoveTypes/ScriptMoveType.cpp
   trunk/rts/Sim/Objects/SolidObject.cpp
   trunk/rts/Sim/Objects/SolidObject.h
   trunk/rts/Sim/Path/PathCache.cpp
   trunk/rts/Sim/Path/PathCache.h
   trunk/rts/Sim/Projectiles/ExplosionGenerator.cpp
   trunk/rts/Sim/Projectiles/FireProjectile.cpp
   trunk/rts/Sim/Projectiles/FlareProjectile.cpp
   trunk/rts/Sim/Projectiles/PieceProjectile.cpp
   trunk/rts/Sim/Projectiles/Projectile.cpp
   trunk/rts/Sim/Projectiles/ProjectileHandler.cpp
   trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp
   trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.cpp
   trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp
   trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.cpp
   trunk/rts/Sim/Units/COB/CobInstance.cpp
   trunk/rts/Sim/Units/COB/CobInstance.h
   trunk/rts/Sim/Units/COB/CobThread.cpp
   trunk/rts/Sim/Units/CommandAI/AirCAI.cpp
   trunk/rts/Sim/Units/CommandAI/BuilderCAI.cpp
   trunk/rts/Sim/Units/CommandAI/CommandAI.cpp
   trunk/rts/Sim/Units/CommandAI/FactoryCAI.cpp
   trunk/rts/Sim/Units/CommandAI/LineDrawer.cpp
   trunk/rts/Sim/Units/CommandAI/MobileCAI.cpp
   trunk/rts/Sim/Units/CommandAI/TransportCAI.cpp
   trunk/rts/Sim/Units/Unit.cpp
   trunk/rts/Sim/Units/Unit.h
   trunk/rts/Sim/Units/UnitHandler.cpp
   trunk/rts/Sim/Units/UnitTracker.cpp
   trunk/rts/Sim/Units/UnitTypes/Builder.cpp
   trunk/rts/Sim/Units/UnitTypes/Building.cpp
   trunk/rts/Sim/Units/UnitTypes/Factory.cpp
   trunk/rts/Sim/Weapons/DGunWeapon.cpp
   trunk/rts/Sim/Weapons/PlasmaRepulser.cpp
   trunk/rts/Sim/Weapons/WeaponDefHandler.cpp
   trunk/rts/Sim/Weapons/bombdropper.cpp
   trunk/rts/System/DemoRecorder.cpp
   trunk/rts/System/FastMath.h
   trunk/rts/System/LoadSaveHandler.cpp
   trunk/rts/System/LogOutput.cpp
   trunk/rts/System/Matrix44f.h
   trunk/rts/System/Messages.cpp
   trunk/rts/System/MouseInput.h
   trunk/rts/System/Script/LuaBinder.cpp
   trunk/rts/System/Script/LuaFunctions.cpp
   trunk/rts/System/Sound.cpp
   trunk/rts/System/Sound.h
   trunk/rts/System/SpringApp.cpp
   trunk/rts/System/StdAfx.h
   trunk/rts/System/Sync/SyncDebugger.cpp
   trunk/rts/System/Sync/SyncDebugger.h
   trunk/rts/System/Sync/SyncedPrimitive.h
   trunk/rts/System/float3.h
   trunk/rts/System/myMath.cpp
   trunk/rts/System/myMath.h
Log:
* moved CGlobalSyncedStuff from System/GlobalStuff.h to Game/GlobalSynced.h
* moved GlobalUnsyncedStuff to System/GlobalUnsynced.h
* moved often-used constants (MAX_TEAMS, MAX_PLAYERS ...) to Game/GlobalConstants.h
and adjusted all headers


Modified: trunk/AI/Global/AAI/aidef.h
===================================================================
--- trunk/AI/Global/AAI/aidef.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Global/AAI/aidef.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,9 +18,10 @@
 #include &quot;ExternalAI/IGlobalAICallback.h&quot;
 #include &quot;ExternalAI/IAICallback.h&quot;
 #include &quot;ExternalAI/aibase.h&quot;
+#include &quot;System/Vec2.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;
 #include &quot;Sim/MoveTypes/MoveInfo.h&quot;
-#include &quot;GlobalStuff.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
 #include &quot;Sim/Weapons/Weapon.h&quot;
 #include &quot;Sim/Units/CommandAI/CommandQueue.h&quot;

Modified: trunk/AI/Global/JCAI/BaseAIDef.h
===================================================================
--- trunk/AI/Global/JCAI/BaseAIDef.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Global/JCAI/BaseAIDef.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -9,7 +9,8 @@
 #ifndef JC_BASE_AI_DEF_H
 #define JC_BASE_AI_DEF_H
 
-#include &quot;GlobalStuff.h&quot;
+#include &quot;System/Vec2.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 #include &quot;ExternalAI/IGlobalAI.h&quot;
 #include &quot;ExternalAI/IGlobalAICallback.h&quot;
 #include &quot;ExternalAI/IAICallback.h&quot;

Modified: trunk/AI/Global/JCAI/ForceHandler.cpp
===================================================================
--- trunk/AI/Global/JCAI/ForceHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Global/JCAI/ForceHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -312,7 +312,7 @@
 bool UnitGroup::CalcPositioning (float2&amp; pmin, float2&amp; pmax, float2&amp; mid, int2&amp; cs)
 {
 	const float l=10000000;
-	float2 sum= {0.0f,0.0f};
+	float2 sum(0.0f,0.0f);
 	pmin.x=pmin.y=l;pmax.x=pmax.y=-l;
 
 	int bestdis=10000000;

Modified: trunk/AI/Global/KAI-0.2/CoverageHandler.cpp
===================================================================
--- trunk/AI/Global/KAI-0.2/CoverageHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Global/KAI-0.2/CoverageHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,7 +1,6 @@
 
 #include &quot;CoverageHandler.h&quot;
 
-#include &quot;System/GlobalStuff.h&quot;
 
 #define COVERAGE_SQUARE 4.0
 #define COVERAGE_SQUARE2 32.0

Modified: trunk/AI/Global/KAI-0.2/DamageControl.cpp
===================================================================
--- trunk/AI/Global/KAI-0.2/DamageControl.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Global/KAI-0.2/DamageControl.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,6 +1,6 @@
 #include &quot;DamageControl.h&quot;
 
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 
 CDamageControl::CDamageControl(AIClasses* ai)
 {

Modified: trunk/AI/Global/KAIK-0.13/DefenseMatrix.cpp
===================================================================
--- trunk/AI/Global/KAIK-0.13/DefenseMatrix.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Global/KAIK-0.13/DefenseMatrix.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,6 +1,5 @@
 #include &quot;DefenseMatrix.h&quot;
 
-#include &quot;System/GlobalStuff.h&quot;
 
 CR_BIND(CDefenseMatrix, (NULL));
 CR_REG_METADATA(CDefenseMatrix, (

Modified: trunk/AI/Global/KAIK-0.13/Unit.cpp
===================================================================
--- trunk/AI/Global/KAIK-0.13/Unit.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Global/KAIK-0.13/Unit.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,7 +1,7 @@
 #include &quot;Unit.h&quot;
 #include &quot;GlobalAI.h&quot;
 
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 
 CR_BIND(CUNIT, )
 CR_REG_METADATA(CUNIT, (

Modified: trunk/AI/Global/KAIK-0.13/UnitTable.cpp
===================================================================
--- trunk/AI/Global/KAIK-0.13/UnitTable.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Global/KAIK-0.13/UnitTable.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,7 +2,7 @@
 
 #include &quot;UnitTable.h&quot;
 
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 #include &quot;System/Util.h&quot;
 
 /// CR_BIND(CUnitTable, );

Modified: trunk/AI/Global/NTai/AI/NTai/SDK/AI.h
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/SDK/AI.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Global/NTai/AI/NTai/SDK/AI.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -28,7 +28,7 @@
 #include &quot;ExternalAI/IAICallback.h&quot; // AI Callback
 #include &quot;ExternalAI/IGlobalAICallback.h&quot; //GlobalAI callback
 #include &quot;ExternalAI/IAICheats.h&quot; // Cheat Interface
-#include &quot;GlobalStuff.h&quot; // Common definitions in spring
+#include &quot;Game/GlobalConstants.h&quot; // Common definitions in spring
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot; // Needed for WeaponDef
 #include &quot;Sim/Misc/DamageArray.h&quot; // Needed for WeaponDef
 #include &quot;Sim/MoveTypes/MoveInfo.h&quot;

Modified: trunk/AI/Group/MexUpgraderAI/GroupAI.cpp
===================================================================
--- trunk/AI/Group/MexUpgraderAI/GroupAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/AI/Group/MexUpgraderAI/GroupAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,7 +13,7 @@
 #include &quot;creg/STL_Set.h&quot;
 #include &quot;creg/Serializer.h&quot;
 #include &quot;creg/cregex.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 
 #define CMD_CHANGE_MODE 	160
 #define CMD_AREA_UPGRADE 	165

Modified: trunk/rts/ExternalAI/AICheats.cpp
===================================================================
--- trunk/rts/ExternalAI/AICheats.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/ExternalAI/AICheats.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -8,6 +8,7 @@
 #include &quot;Sim/Units/UnitHandler.h&quot;
 #include &quot;Sim/Units/UnitLoader.h&quot;
 #include &quot;NetProtocol.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/Team.h&quot;
 #include &quot;Game/GameServer.h&quot;
 #include &quot;Game/GameSetup.h&quot;

Modified: trunk/rts/ExternalAI/GlobalAI.cpp
===================================================================
--- trunk/rts/ExternalAI/GlobalAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/ExternalAI/GlobalAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -9,6 +9,7 @@
 #include &quot;Platform/SharedLib.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;mmgr.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Units/UnitHandler.h&quot;
 

Modified: trunk/rts/ExternalAI/GlobalAIHandler.cpp
===================================================================
--- trunk/rts/ExternalAI/GlobalAIHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/ExternalAI/GlobalAIHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,6 +2,7 @@
 #include &quot;GlobalAIHandler.h&quot;
 #include &quot;GlobalAI.h&quot;
 #include &quot;IGlobalAI.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/GameHelper.h&quot;
 #include &quot;Game/Player.h&quot;
 #include &quot;Game/Team.h&quot;

Modified: trunk/rts/ExternalAI/GlobalAIHandler.h
===================================================================
--- trunk/rts/ExternalAI/GlobalAIHandler.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/ExternalAI/GlobalAIHandler.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -4,7 +4,7 @@
 #include &quot;Object.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;
 #include &quot;float3.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 #include &lt;map&gt;
 #include &lt;string&gt;
 

Modified: trunk/rts/ExternalAI/Group.cpp
===================================================================
--- trunk/rts/ExternalAI/Group.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/ExternalAI/Group.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -9,6 +9,7 @@
 #include &quot;GroupHandler.h&quot;
 #include &quot;Game/SelectedUnits.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/EventHandler.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Platform/errorhandler.h&quot;

Modified: trunk/rts/ExternalAI/GroupHandler.h
===================================================================
--- trunk/rts/ExternalAI/GroupHandler.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/ExternalAI/GroupHandler.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -9,7 +9,7 @@
 #include &lt;vector&gt;
 #include &lt;set&gt;
 #include &quot;ExternalAI/aikey.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 
 class CGroup;
 class CUnitSet;

Modified: trunk/rts/Game/Camera/FPSController.cpp
===================================================================
--- trunk/rts/Game/Camera/FPSController.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/Camera/FPSController.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -7,6 +7,7 @@
 #include &quot;Game/Camera.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/Ground.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 using std::min;
 using std::max;

Modified: trunk/rts/Game/Camera/FreeController.cpp
===================================================================
--- trunk/rts/Game/Camera/FreeController.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/Camera/FreeController.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,6 +10,7 @@
 #include &quot;Game/Camera.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/Ground.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 using std::max;
 using std::min;

Modified: trunk/rts/Game/Camera/OrbitController.h
===================================================================
--- trunk/rts/Game/Camera/OrbitController.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/Camera/OrbitController.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,7 +2,6 @@
 #define __ORBIT_CONTROLLER_H__
 
 #include &quot;CameraController.h&quot;
-#include &quot;GlobalStuff.h&quot;
 
 class COrbitController: public CCameraController {
 	public:

Modified: trunk/rts/Game/Camera/OverheadController.cpp
===================================================================
--- trunk/rts/Game/Camera/OverheadController.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/Camera/OverheadController.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -12,6 +12,7 @@
 #include &quot;Game/UI/MouseHandler.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/Ground.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 
 

Modified: trunk/rts/Game/Camera/SmoothController.cpp
===================================================================
--- trunk/rts/Game/Camera/SmoothController.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/Camera/SmoothController.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -14,6 +14,7 @@
 #include &quot;Game/UI/MouseHandler.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/Ground.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 
 

Modified: trunk/rts/Game/Camera/TWController.cpp
===================================================================
--- trunk/rts/Game/Camera/TWController.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/Camera/TWController.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -12,6 +12,7 @@
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/Ground.h&quot;
 #include &quot;Game/UI/MouseHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 extern Uint8 *keys;
 

Modified: trunk/rts/Game/Camera.cpp
===================================================================
--- trunk/rts/Game/Camera.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/Camera.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,6 +5,7 @@
 
 #include &quot;mmgr.h&quot;
 
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;Camera.h&quot;
 #include &quot;Map/Ground.h&quot;
 

Modified: trunk/rts/Game/CameraHandler.cpp
===================================================================
--- trunk/rts/Game/CameraHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/CameraHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,7 +18,7 @@
 #include &quot;Game/Camera/OrbitController.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;
 #include &quot;LogOutput.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
 
 
 CCameraHandler* camHandler = NULL;

Modified: trunk/rts/Game/GameHelper.cpp
===================================================================
--- trunk/rts/Game/GameHelper.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/GameHelper.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -6,6 +6,7 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;mmgr.h&quot;
 
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;Camera.h&quot;
 #include &quot;Game/GameSetup.h&quot;
 #include &quot;Game.h&quot;

Modified: trunk/rts/Game/GameServer.cpp
===================================================================
--- trunk/rts/Game/GameServer.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/GameServer.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -27,6 +27,7 @@
 
 #include &quot;LogOutput.h&quot;
 #include &quot;GameSetup.h&quot;
+#include &quot;GlobalSynced.h&quot;
 #include &quot;Action.h&quot;
 #include &quot;ChatMessage.h&quot;
 #include &quot;CommandMessage.h&quot;
@@ -39,6 +40,7 @@
 #include &quot;System/DemoReader.h&quot;
 #include &quot;System/AutohostInterface.h&quot;
 #include &quot;System/Util.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot; // for syncdebug
 #include &quot;Platform/ConfigHandler.h&quot;
 #include &quot;FileSystem/CRC.h&quot;
 #include &quot;Player.h&quot;

Modified: trunk/rts/Game/GameServer.h
===================================================================
--- trunk/rts/Game/GameServer.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/GameServer.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -12,7 +12,7 @@
 #include &quot;Console.h&quot;
 #include &quot;GameData.h&quot;
 #include &quot;PlayerBase.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 #include &quot;System/UnsyncedRNG.h&quot;
 #include &quot;SFloat3.h&quot;
 

Modified: trunk/rts/Game/GameSetup.h
===================================================================
--- trunk/rts/Game/GameSetup.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/GameSetup.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -6,7 +6,7 @@
 #include &lt;vector&gt;
 
 #include &quot;SFloat3.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalConstants.h&quot;
 #include &quot;PlayerBase.h&quot;
 
 class TdfParser;

Added: trunk/rts/Game/GlobalConstants.h
===================================================================
--- trunk/rts/Game/GlobalConstants.h	                        (rev 0)
+++ trunk/rts/Game/GlobalConstants.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -0,0 +1,62 @@
+#ifndef GLOBAL_CONSTANTS_H
+#define GLOBAL_CONSTANTS_H
+
+/**
+ * @brief maximum world size
+ *
+ * Defines the maximum world size as 1000000
+ */
+const int MAX_WORLD_SIZE = 1000000;
+
+/**
+ * @brief square size
+ *
+ * Defines the size of 1 square as 8
+ */
+const int  SQUARE_SIZE = 8;
+
+/**
+ * @brief game speed
+ *
+ * Defines the game speed as 30
+ */
+const int GAME_SPEED = 30;
+
+/**
+ * @brief max view range
+ *
+ * Defines the maximum view range as 8000
+ */
+const int MAX_VIEW_RANGE = 8000;
+
+/**
+ * @brief max teams
+ *
+ * Defines the maximum number of teams
+ * as 17 (16 real teams, and an extra slot for the GAIA team)
+ */
+const int MAX_TEAMS = 17;
+
+/**
+ * @brief max players
+ *
+ * Defines the maximum number of players as 32
+ */
+const int MAX_PLAYERS = 32;
+
+/**
+ * @brief near plane
+ *
+ * Defines the near plane as 2.8f
+ */
+const float NEAR_PLANE = 2.8f;
+
+/**
+ * @brief randint max
+ *
+ * Defines the maximum random integer as 0x7fff
+ */
+const int RANDINT_MAX = 0x7fff;
+
+
+#endif
\ No newline at end of file

Added: trunk/rts/Game/GlobalSynced.cpp
===================================================================
--- trunk/rts/Game/GlobalSynced.cpp	                        (rev 0)
+++ trunk/rts/Game/GlobalSynced.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -0,0 +1,242 @@
+#include &quot;GlobalSynced.h&quot;
+
+#include &lt;assert.h&gt;
+#include &lt;cstring&gt;
+
+#include &quot;GameSetup.h&quot;
+#include &quot;Team.h&quot;
+#include &quot;Player.h&quot;
+#include &quot;Lua/LuaGaia.h&quot;
+#include &quot;Lua/LuaRules.h&quot;
+
+/**
+ * @brief global synced
+ *
+ * Global instance of CGlobalSyncedStuff
+ */
+CGlobalSyncedStuff* gs;
+
+
+
+CR_BIND(CGlobalSyncedStuff,);
+
+CR_REG_METADATA(CGlobalSyncedStuff, (
+	CR_MEMBER(randSeed),
+	CR_MEMBER(initRandSeed),
+	CR_MEMBER(frameNum),
+	CR_MEMBER(speedFactor),
+	CR_MEMBER(userSpeedFactor),
+	CR_MEMBER(paused),
+	CR_MEMBER(tempNum),
+	CR_MEMBER(godMode),
+	CR_MEMBER(globalLOS),
+	CR_MEMBER(cheatEnabled),
+	CR_MEMBER(noHelperAIs),
+	CR_MEMBER(editDefsEnabled),
+	CR_MEMBER(useLuaRules),
+	CR_MEMBER(useLuaGaia),
+	CR_MEMBER(gaiaTeamID),
+	CR_MEMBER(gaiaAllyTeamID),
+	CR_MEMBER(gameMode),
+	CR_MEMBER(players),
+	CR_MEMBER(activeTeams),
+	CR_MEMBER(activeAllyTeams),
+	CR_MEMBER(activePlayers),
+	CR_MEMBER(allies),
+	CR_MEMBER(team2allyteam),
+	CR_MEMBER(teams),
+	CR_RESERVED(64)
+));
+
+
+/**
+ * Initializes variables in CGlobalSyncedStuff
+ */
+CGlobalSyncedStuff::CGlobalSyncedStuff()
+{
+	hmapx = 256;
+	hmapy = 256;
+	randSeed = 18655;
+	initRandSeed = randSeed;
+	frameNum = 0;
+	speedFactor = 1;
+	userSpeedFactor = 1;
+	paused = false;
+	godMode = false;
+	globalLOS = false;
+	cheatEnabled = false;
+	noHelperAIs = false;
+	editDefsEnabled = false;
+	tempNum = 2;
+	gameMode = 0;
+	useLuaGaia = true;
+	gaiaTeamID = -1;
+	gaiaAllyTeamID = -1;
+	useLuaRules = true;
+	
+	for(int a = 0; a &lt; MAX_TEAMS; ++a) {
+		teams[a] = SAFE_NEW CTeam();
+		teams[a]-&gt;teamNum = a;
+		team2allyteam[a] = a;
+	}
+	for(int a = 0; a &lt; MAX_PLAYERS; ++a) {
+		players[a] = SAFE_NEW CPlayer();
+		players[a]-&gt;playerNum = a;
+	}
+
+	for (int a = 0; a &lt; MAX_TEAMS; ++a) {
+		for (int b = 0; b &lt; MAX_TEAMS; ++b) {
+			allies[a][b] = false;
+		}
+		allies[a][a] = true;
+	}
+
+	activeTeams = 2;
+	activeAllyTeams = 2;
+	activePlayers = MAX_PLAYERS;
+}
+
+/**
+ * Destroys data inside CGlobalSyncedStuff
+ */
+CGlobalSyncedStuff::~CGlobalSyncedStuff()
+{
+	for(int a = 0; a &lt; MAX_TEAMS; a++) {
+		delete teams[a];
+	}
+	for(int a = 0; a &lt; MAX_PLAYERS; a++) {
+		delete players[a];
+	}
+}
+
+void CGlobalSyncedStuff::LoadFromSetup(const CGameSetup* setup)
+{
+	gameMode = setup-&gt;gameMode;
+	noHelperAIs = !!setup-&gt;noHelperAIs;
+
+	useLuaGaia  = CLuaGaia::SetConfigString(setup-&gt;luaGaiaStr);
+	useLuaRules = CLuaRules::SetConfigString(setup-&gt;luaRulesStr);
+
+	activePlayers = setup-&gt;numPlayers;
+	activeTeams = setup-&gt;numTeams;
+	activeAllyTeams = setup-&gt;numAllyTeams;
+	
+	assert(activeTeams &lt;= MAX_TEAMS);
+	assert(activeAllyTeams &lt;= MAX_TEAMS);
+
+	for (int i = 0; i &lt; activePlayers; ++i)
+	{
+		// TODO: refactor
+		*static_cast&lt;PlayerBase*&gt;(players[i]) = setup-&gt;playerStartingData[i];
+	}
+
+	for (int i = 0; i &lt; activeTeams; ++i)
+	{
+		teams[i]-&gt;metal = setup-&gt;startMetal;
+		teams[i]-&gt;metalIncome = setup-&gt;startMetal; // for the endgame statistics
+
+		teams[i]-&gt;energy = setup-&gt;startEnergy;
+		teams[i]-&gt;energyIncome = setup-&gt;startEnergy;
+
+		float3 start(setup-&gt;teamStartingData[i].startPos.x, setup-&gt;teamStartingData[i].startPos.y, setup-&gt;teamStartingData[i].startPos.z);
+		teams[i]-&gt;StartposMessage(start, (setup-&gt;startPosType != CGameSetup::StartPos_ChooseInGame));
+		std::memcpy(teams[i]-&gt;color, setup-&gt;teamStartingData[i].color, 4);
+		teams[i]-&gt;handicap = setup-&gt;teamStartingData[i].handicap;
+		teams[i]-&gt;leader = setup-&gt;teamStartingData[i].leader;
+		teams[i]-&gt;side = setup-&gt;teamStartingData[i].side;
+		SetAllyTeam(i, setup-&gt;teamStartingData[i].teamAllyteam);
+		if (!setup-&gt;teamStartingData[i].aiDll.empty())
+		{
+			if (setup-&gt;teamStartingData[i].aiDll.substr(0, 6) == &quot;LuaAI:&quot;) // its a LuaAI
+			{
+				teams[i]-&gt;luaAI = setup-&gt;teamStartingData[i].aiDll.substr(6);
+				teams[i]-&gt;isAI = true;
+			}
+			else // no LuaAI
+			{
+				if (setup-&gt;hostDemo) // in demo replay, we don't need AI's to load again
+					teams[i]-&gt;dllAI = &quot;&quot;;
+				else
+				{
+					teams[i]-&gt;dllAI = setup-&gt;teamStartingData[i].aiDll;
+					teams[i]-&gt;isAI = true;
+				}
+			}
+		}
+	}
+
+	for (int allyTeam1 = 0; allyTeam1 &lt; activeAllyTeams; ++allyTeam1)
+	{
+		for (int allyTeam2 = 0; allyTeam2 &lt; activeAllyTeams; ++allyTeam2)
+			allies[allyTeam1][allyTeam2] = setup-&gt;allyStartingData[allyTeam1].allies[allyTeam2];
+	}
+
+	if (useLuaGaia) {
+		//TODO duplicated in SpringApp::CreateGameSetup()
+		// Gaia adjustments
+		gaiaTeamID = activeTeams;
+		gaiaAllyTeamID = activeAllyTeams;
+		activeTeams++;
+		activeAllyTeams++;
+
+		// Setup the gaia team
+		CTeam* team = gs-&gt;Team(gs-&gt;gaiaTeamID);
+		team-&gt;color[0] = 255;
+		team-&gt;color[1] = 255;
+		team-&gt;color[2] = 255;
+		team-&gt;color[3] = 255;
+		team-&gt;gaia = true;
+		team-&gt;StartposMessage(float3(0.0, 0.0, 0.0), true);
+		//players[setup-&gt;numPlayers]-&gt;team = gaiaTeamID;
+		SetAllyTeam(gaiaTeamID, gaiaAllyTeamID);
+	}
+}
+
+/**
+ * @return synced random integer
+ *
+ * returns a synced random integer
+ */
+int CGlobalSyncedStuff::randInt()
+{
+	randSeed = (randSeed * 214013L + 2531011L);
+	return randSeed &amp; RANDINT_MAX;
+}
+
+/**
+ * @return synced random float
+ *
+ * returns a synced random float
+ */
+float CGlobalSyncedStuff::randFloat()
+{
+	randSeed = (randSeed * 214013L + 2531011L);
+	return float(randSeed &amp; RANDINT_MAX)/RANDINT_MAX;
+}
+
+/**
+ * @return synced random vector
+ *
+ * returns a synced random vector
+ */
+float3 CGlobalSyncedStuff::randVector()
+{
+	float3 ret;
+	do {
+		ret.x = randFloat()*2-1;
+		ret.y = randFloat()*2-1;
+		ret.z = randFloat()*2-1;
+	} while(ret.SqLength()&gt;1);
+
+	return ret;
+}
+
+int CGlobalSyncedStuff::Player(const std::string&amp; name)
+{
+	for (int i = 0; i &lt; MAX_PLAYERS; ++i) {
+		if (players[i] &amp;&amp; players[i]-&gt;name == name) {
+			return i;
+		}
+	}
+	return -1;
+}

Added: trunk/rts/Game/GlobalSynced.h
===================================================================
--- trunk/rts/Game/GlobalSynced.h	                        (rev 0)
+++ trunk/rts/Game/GlobalSynced.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -0,0 +1,341 @@
+#ifndef GLOBAL_UNSYNCED_H
+#define GLOBAL_UNSYNCED_H
+
+#include &lt;string&gt;
+
+#include &quot;float3.h&quot;
+#include &quot;GlobalConstants.h&quot;
+#include &quot;creg/creg.h&quot;
+
+
+class CGameSetup;
+class CTeam;
+class CPlayer;
+
+/**
+ * @brief Global synced stuff
+ *
+ * Class contains globally accessible
+ * stuff that remains synced.
+ */
+class CGlobalSyncedStuff
+{
+public:
+	CR_DECLARE(CGlobalSyncedStuff);
+	CGlobalSyncedStuff();  //!&lt; Constructor
+	~CGlobalSyncedStuff(); //!&lt; Destructor
+	void LoadFromSetup(const CGameSetup*);
+
+	int    randInt();    //!&lt; synced random int
+	float  randFloat();  //!&lt; synced random float
+	float3 randVector(); //!&lt; synced random vector
+
+	void SetRandSeed(unsigned int seed, bool init = false) {
+		randSeed = seed;
+		if (init) { initRandSeed = randSeed; }
+	}
+	unsigned int GetRandSeed()     const { return randSeed; }
+	unsigned int GetInitRandSeed() const { return initRandSeed; }
+
+	/**
+	* @brief frame number
+	*
+	* Stores the current frame number
+	*/
+	int frameNum;
+
+	/**
+	* @brief speed factor
+	*
+	* Contains the actual gamespeed used by the game
+	*/
+	float speedFactor;
+
+	/**
+	* @brief user speed factor
+	*
+	* Contains the user's speed factor.
+	* The real gamespeed can be up to this
+	* but is lowered if a computer can't keep up
+	*/
+	float userSpeedFactor;
+
+	/**
+	* @brief paused
+	*
+	* Holds whether the game is paused
+	*/
+	bool paused;
+
+	/**
+	* @brief map x
+	*
+	* The map's number of squares in the x direction
+	* (note that the number of vertices is one more)
+	*/
+	int mapx;
+
+	/**
+	* @brief map y
+	*
+	* The map's number of squares in the y direction
+	*/
+	int mapy;
+
+	/**
+	* @brief map squares
+	*
+	* Total number of squares on the map
+	*/
+	int mapSquares;
+
+	/**
+	* @brief half map x
+	*
+	* Contains half of the number of squares in the x direction
+	*/
+	int hmapx;
+
+	/**
+	* @brief half map y
+	*
+	* Contains half of the number of squares in the y direction
+	*/
+	int hmapy;
+
+	/**
+	* @brief map x power of 2
+	*
+	* Map's size in the x direction rounded
+	* up to the next power of 2
+	*/
+	int pwr2mapx;
+
+	/**
+	* @brief map y power of 2
+	*
+	* Map's size in the y direction rounded
+	* up to the next power of 2
+	*/
+	int pwr2mapy;
+
+	/**
+	* @brief temp num
+	*
+	* Used for getting temporary but unique numbers
+	* (increase after each use)
+	*/
+	int tempNum;
+
+	/**
+	* @brief god mode
+	*
+	* Whether god mode is enabled, allows all players to control all units (even specs)
+	*/
+	bool godMode;
+
+	/**
+	* @brief global line-of-sight
+	*
+	* Whether everything on the map is visible at all times
+	*/
+	bool globalLOS;
+
+	/**
+	* @brief cheat enabled
+	*
+	* Whether cheating is enabled
+	*/
+	bool cheatEnabled;
+
+	/**
+	* @brief disable helper AIs
+	*
+	* Whether helper AIs are allowed, including GroupAI and LuaUI control widgets
+	*/
+	bool noHelperAIs;
+
+	/**
+	* @brief definition editing enabled
+	*
+	* Whether definition editing is enabled
+	*/
+	bool editDefsEnabled;
+
+	/**
+	* @brief LuaRules control
+	*
+	* Whether or not LuaRules is enabled
+	*/
+	bool useLuaRules;
+
+	/**
+	* @brief LuaGaia control
+	*
+	* Whether or not LuaGaia is enabled
+	*/
+	bool useLuaGaia;
+
+	/**
+	* @brief gaia team
+	*
+	* gaia's team id
+	*/
+	int gaiaTeamID;
+
+	/**
+	* @brief gaia team
+	*
+	* gaia's team id
+	*/
+	int gaiaAllyTeamID;
+
+	/**
+	* @brief game mode
+	*
+	* Determines the commander mode of this game
+	*   0: game continues after commander dies
+	*   1: game ends when commander dies
+	*   2: lineage mode (all descendants die when a commander dies)
+	*/
+	int gameMode;
+
+	/**
+	* @brief players
+	*
+	* Array of CPlayer pointers, for all the
+	* players in the game
+	* (size MAX_PLAYERS)
+	*/
+	CPlayer* players[MAX_PLAYERS];
+
+	/**
+	* @brief active teams
+	*
+	* The number of active teams
+	* (don't change during play)
+	*/
+	int activeTeams;
+
+	/**
+	* @brief active ally teams
+	*
+	* The number of active ally teams
+	*/
+	int activeAllyTeams;
+
+	/**
+	* @brief active players
+	*
+	* The number of active players
+	*/
+	int activePlayers;
+
+	/**
+	* @brief Player
+	* @param name name of the player
+	* @return his playernumber of -1 if not found
+	*
+	* Search a player by name.
+	*/
+	int Player(const std::string&amp; name);
+
+	/**
+	* @brief Team
+	* @param i index to fetch
+	* @return CTeam pointer
+	*
+	* Accesses a CTeam pointer at a given index
+	*/
+	CTeam *Team(int i) { return teams[i]; }
+
+	/**
+	* @brief ally
+	* @param a first index
+	* @param b second index
+	* @return allies[a][b]
+	*
+	* Returns ally at [a][b]
+	*/
+	bool Ally(int a,int b) { return allies[a][b]; }
+
+	/**
+	* @brief ally team
+	* @param team team to find
+	* @return the ally team
+	*
+	* returns the team2ally at given index
+	*/
+	int AllyTeam(int team) { return team2allyteam[team]; }
+
+	/**
+	* @brief allied teams
+	* @param a first team
+	* @param b second team
+	* @return whether teams are allied
+	*
+	* Tests whether teams are allied
+	*/
+	bool AlliedTeams(int a,int b) { return allies[team2allyteam[a]][team2allyteam[b]]; }
+
+	/**
+	* @brief set ally team
+	* @param team team to set
+	* @param allyteam allyteam to set
+	*
+	* Sets team's ally team
+	*/
+	void SetAllyTeam(int team, int allyteam) { team2allyteam[team]=allyteam; }
+
+	/**
+	* @brief set ally
+	* @param allyteamA first allyteam
+	* @param allyteamB second allyteam
+	* @param allied whether or not these two teams are allied
+	*
+	* Sets two allyteams to be allied or not
+	*/
+	void SetAlly(int allyteamA,int allyteamB, bool allied) { allies[allyteamA][allyteamB]=allied; }
+
+private:
+	/**
+	* @brief random seed
+	*
+	* Holds the synced random seed
+	*/
+	int randSeed;
+
+	/**
+	* @brief initial random seed
+	*
+	* Holds the synced initial random seed
+	*/
+	int initRandSeed;
+
+	/**
+	* @brief allies array
+	*
+	* Array indicates whether teams are allied,
+	* allies[a][b] means allyteam a is allied with
+	* allyteam b, NOT the other way around
+	*/
+	bool allies[MAX_TEAMS][MAX_TEAMS];
+
+	/**
+	* @brief team to ally team
+	*
+	* Array stores what ally team a specific team is part of
+	*/
+	int team2allyteam[MAX_TEAMS];
+
+	/**
+	* @brief teams
+	*
+	* Array of CTeam pointers for teams in game
+	*/
+	CTeam* teams[MAX_TEAMS];
+};
+
+extern CGlobalSyncedStuff* gs;
+
+#endif //GLOBAL_UNSYNCED_H

Modified: trunk/rts/Game/Player.cpp
===================================================================
--- trunk/rts/Game/Player.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/Player.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -8,12 +8,14 @@
 
 #include &quot;Player.h&quot;
 #include &quot;Team.h&quot;
+#include &quot;GlobalSynced.h&quot;
 #ifdef DIRECT_CONTROL_ALLOWED
 #  include &quot;UI/MouseHandler.h&quot;
 #  include &quot;CameraHandler.h&quot;
 #  include &quot;Camera.h&quot;
 #endif
 #include &quot;System/EventHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND(CPlayer,);
 

Modified: trunk/rts/Game/PlayerRoster.cpp
===================================================================
--- trunk/rts/Game/PlayerRoster.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/PlayerRoster.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -11,6 +11,8 @@
 #include &quot;Player.h&quot;
 #include &quot;Team.h&quot;
 #include &quot;Util.h&quot;
+#include &quot;GlobalSynced.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
 
 static int CompareAllies     (const void* a, const void* b);
 static int CompareTeamIDs    (const void* a, const void* b);

Modified: trunk/rts/Game/PreGame.cpp
===================================================================
--- trunk/rts/Game/PreGame.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/PreGame.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -15,6 +15,7 @@
 #include &quot;GameServer.h&quot;
 #include &quot;GameSetup.h&quot;
 #include &quot;GameData.h&quot;
+#include &quot;GlobalSynced.h&quot;
 #include &quot;NetProtocol.h&quot;
 #include &quot;Net/RawPacket.h&quot;
 #include &quot;DemoRecorder.h&quot;

Modified: trunk/rts/Game/SelectedUnits.cpp
===================================================================
--- trunk/rts/Game/SelectedUnits.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/SelectedUnits.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,6 +10,7 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;Game/Team.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;SelectedUnits.h&quot;
 #include &quot;WaitCommandsAI.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;

Modified: trunk/rts/Game/SelectedUnitsAI.cpp
===================================================================
--- trunk/rts/Game/SelectedUnitsAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/SelectedUnitsAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,7 +13,8 @@
 #include &quot;SelectedUnits.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;NetProtocol.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalSynced.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
 #include &quot;Player.h&quot;
 #include &quot;WaitCommandsAI.h&quot;
 #include &quot;Map/Ground.h&quot;
@@ -38,29 +39,7 @@
 	lineDist = 64;
 }
 
-/*
-Group-AI.
-Processing commands given to selected group.
-*/
 
-
-/*
-void CSelectedUnitsAI::AddUnit(int unit)
-{
-	myUnits.insert(unit);
-	unitsChanged=true;
-	return true;
-}
-
-
-void CSelectedUnitsAI::RemoveUnit(int unit)
-{
-	myUnits.erase(unit);
-	unitsChanged=true;
-}
-*/
-
-
 inline void CSelectedUnitsAI::AddUnitSetMaxSpeedCommand(CUnit* unit,
                                                         unsigned char options)
 {

Modified: trunk/rts/Game/StartScripts/AirScript.cpp
===================================================================
--- trunk/rts/Game/StartScripts/AirScript.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/StartScripts/AirScript.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,6 +13,7 @@
 #include &quot;Platform/ConfigHandler.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/Ground.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 
 

Modified: trunk/rts/Game/Team.cpp
===================================================================
--- trunk/rts/Game/Team.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/Team.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,10 +5,13 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;mmgr.h&quot;
 
+#include &quot;Team.h&quot;
+
 #include &quot;Messages.h&quot;
-#include &quot;Team.h&quot;
+#include &quot;GlobalSynced.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Player.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
 #include &quot;Game/UI/LuaUI.h&quot;
 #include &quot;Lua/LuaRules.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
@@ -17,6 +20,7 @@
 #include &quot;ExternalAI/GlobalAI.h&quot;
 #include &quot;ExternalAI/GlobalAIHandler.h&quot;
 #include &quot;System/EventHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;creg/STL_List.h&quot;
 #include &quot;creg/STL_Map.h&quot;
 #include &quot;creg/STL_Set.h&quot;

Modified: trunk/rts/Game/UI/EndGameBox.cpp
===================================================================
--- trunk/rts/Game/UI/EndGameBox.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/UI/EndGameBox.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,6 +10,7 @@
 #include &quot;Rendering/glFont.h&quot;
 #include &quot;NetProtocol.h&quot;
 #include &quot;Game/Game.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/SelectedUnits.h&quot;
 #include &quot;Rendering/Textures/Bitmap.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;

Modified: trunk/rts/Game/UI/EndGameBox.h
===================================================================
--- trunk/rts/Game/UI/EndGameBox.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/UI/EndGameBox.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,6 +5,7 @@
 #include &lt;list&gt;
 #include &lt;vector&gt;
 #include &quot;Rendering/GL/myGL.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 
 
 // msvc behaves really strange

Modified: trunk/rts/Game/UI/GameSetupDrawer.cpp
===================================================================
--- trunk/rts/Game/UI/GameSetupDrawer.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/UI/GameSetupDrawer.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -16,6 +16,7 @@
 #include &quot;../Player.h&quot;
 #include &quot;../Team.h&quot;
 #include &quot;../GameSetup.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;StartPosSelecter.h&quot;
 #include &quot;Rendering/glFont.h&quot;
 #include &quot;System/EventHandler.h&quot;

Modified: trunk/rts/Game/UI/InputReceiver.h
===================================================================
--- trunk/rts/Game/UI/InputReceiver.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/UI/InputReceiver.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,7 +5,7 @@
 #include &lt;string&gt;
 
 #include &quot;Object.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
 
 class CInputReceiver :
 	public CObject

Modified: trunk/rts/Game/UI/MouseCursor.cpp
===================================================================
--- trunk/rts/Game/UI/MouseCursor.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/UI/MouseCursor.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -7,6 +7,7 @@
 #include &quot;FileSystem/SimpleParser.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;System/Util.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;MouseCursor.h&quot;
 #include &quot;HwMouseCursor.h&quot;
 #include &quot;myMath.h&quot;

Modified: trunk/rts/Game/UI/QuitBox.cpp
===================================================================
--- trunk/rts/Game/UI/QuitBox.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/UI/QuitBox.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -3,6 +3,7 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;Game/Team.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;MouseHandler.h&quot;
 #include &quot;NetProtocol.h&quot;

Modified: trunk/rts/Game/UI/ResourceBar.cpp
===================================================================
--- trunk/rts/Game/UI/ResourceBar.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/UI/ResourceBar.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,6 +5,7 @@
 #include &quot;MouseHandler.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Game/Team.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Rendering/glFont.h&quot;
 #include &quot;NetProtocol.h&quot;
 #include &quot;TimeProfiler.h&quot;

Modified: trunk/rts/Game/UI/ShareBox.cpp
===================================================================
--- trunk/rts/Game/UI/ShareBox.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/UI/ShareBox.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -7,6 +7,7 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Game/Team.h&quot;
 #include &quot;Game/Player.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Rendering/glFont.h&quot;
 #include &quot;NetProtocol.h&quot;
 #include &quot;Game/SelectedUnits.h&quot;

Modified: trunk/rts/Game/WaitCommandsAI.cpp
===================================================================
--- trunk/rts/Game/WaitCommandsAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Game/WaitCommandsAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,7 +18,8 @@
 #include &quot;Sim/Units/CommandAI/FactoryCAI.h&quot;
 #include &quot;Sim/Units/CommandAI/LineDrawer.h&quot;
 #include &quot;Sim/Units/UnitTypes/Factory.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Object.h&quot;
 #include &quot;UI/CommandColors.h&quot;
 #include &quot;UI/CursorIcons.h&quot;

Modified: trunk/rts/Lua/LuaFeatureDefs.cpp
===================================================================
--- trunk/rts/Lua/LuaFeatureDefs.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Lua/LuaFeatureDefs.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -16,6 +16,7 @@
 
 #include &quot;LuaInclude.h&quot;
 
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;LuaDefs.h&quot;
 #include &quot;LuaHandle.h&quot;
 #include &quot;LuaUtils.h&quot;

Modified: trunk/rts/Lua/LuaGaia.cpp
===================================================================
--- trunk/rts/Lua/LuaGaia.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Lua/LuaGaia.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -19,6 +19,7 @@
 #include &quot;LuaWeaponDefs.h&quot;
 #include &quot;LuaOpenGL.h&quot;
 
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Sim/Units/CommandAI/Command.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Rendering/UnitModels/UnitDrawer.h&quot;

Modified: trunk/rts/Lua/LuaHandle.cpp
===================================================================
--- trunk/rts/Lua/LuaHandle.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Lua/LuaHandle.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -26,6 +26,7 @@
 #include &quot;Game/UI/KeySet.h&quot;
 #include &quot;Game/UI/KeyBindings.h&quot;
 #include &quot;Game/UI/MiniMap.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Rendering/InMapDraw.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Rendering/UnitModels/UnitDrawer.h&quot;

Modified: trunk/rts/Lua/LuaHandleSynced.cpp
===================================================================
--- trunk/rts/Lua/LuaHandleSynced.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Lua/LuaHandleSynced.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -35,6 +35,7 @@
 #include &quot;Sim/Units/CommandAI/Command.h&quot;
 #include &quot;Game/Game.h&quot;
 #include &quot;Game/WordCompletion.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;
 #include &quot;Sim/Units/COB/CobInstance.h&quot;

Modified: trunk/rts/Lua/LuaPathFinder.cpp
===================================================================
--- trunk/rts/Lua/LuaPathFinder.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Lua/LuaPathFinder.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,7 +18,6 @@
 #include &quot;LuaUtils.h&quot;
 #include &quot;Sim/MoveTypes/MoveInfo.h&quot;
 #include &quot;Sim/Path/PathManager.h&quot;
-#include &quot;GlobalStuff.h&quot;
 
 
 static void CreatePathMetatable(lua_State* L);

Modified: trunk/rts/Lua/LuaRules.cpp
===================================================================
--- trunk/rts/Lua/LuaRules.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Lua/LuaRules.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -25,6 +25,7 @@
 #include &quot;Sim/Units/CommandAI/Command.h&quot;
 #include &quot;Game/Game.h&quot;
 #include &quot;Game/Team.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Rendering/UnitModels/UnitDrawer.h&quot;
 #include &quot;Rendering/UnitModels/3DModelParser.h&quot;

Modified: trunk/rts/Lua/LuaSyncedCtrl.cpp
===================================================================
--- trunk/rts/Lua/LuaSyncedCtrl.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Lua/LuaSyncedCtrl.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -61,7 +61,6 @@
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
 #include &quot;System/myMath.h&quot;
 #include &quot;System/LogOutput.h&quot;
-#include &quot;Sync/SyncDebugger.h&quot;
 
 using namespace std;
 

Modified: trunk/rts/Lua/LuaWeaponDefs.cpp
===================================================================
--- trunk/rts/Lua/LuaWeaponDefs.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Lua/LuaWeaponDefs.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -27,7 +27,7 @@
 #include &quot;System/FileSystem/SimpleParser.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &quot;System/Util.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 
 using namespace std;
 

Modified: trunk/rts/Map/Ground.h
===================================================================
--- trunk/rts/Map/Ground.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Map/Ground.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -4,7 +4,9 @@
 //
 //////////////////////////////////////////////////////////////////////
 
-#include &quot;GlobalStuff.h&quot;
+#include &quot;float3.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 
 class CProjectileHandler;
 class CProjectile;

Modified: trunk/rts/Map/MapInfo.cpp
===================================================================
--- trunk/rts/Map/MapInfo.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Map/MapInfo.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -4,11 +4,11 @@
 
 #include &quot;MapInfo.h&quot;
 
+#include &quot;Game/GlobalConstants.h&quot;
 #include &quot;MapParser.h&quot;
 #include &quot;Lua/LuaParser.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &quot;System/FileSystem/FileHandler.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
 #include &quot;System/Exceptions.h&quot;
 
 

Modified: trunk/rts/Map/MetalMap.cpp
===================================================================
--- trunk/rts/Map/MetalMap.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Map/MetalMap.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,7 +2,6 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;MetalMap.h&quot;
-#include &quot;GlobalStuff.h&quot;
 #include &quot;ReadMap.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;
 

Modified: trunk/rts/Map/MetalMap.h
===================================================================
--- trunk/rts/Map/MetalMap.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Map/MetalMap.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,8 +1,10 @@
 #ifndef METALMAP_H
 #define METALMAP_H
 
-#include &quot;GlobalStuff.h&quot;
+#include &lt;vector&gt;
 
+#include &quot;creg/creg.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 
 // Each square on metalmap is a 2x2 square on normal map.
 const float METAL_MAP_SQUARE_SIZE = SQUARE_SIZE * 2;

Modified: trunk/rts/Map/ReadMap.h
===================================================================
--- trunk/rts/Map/ReadMap.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Map/ReadMap.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -7,7 +7,8 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;creg/creg.h&quot;
 #include &quot;float3.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 
 class CMetalMap;
 class CCamera;

Modified: trunk/rts/Map/SM3/Sm3GroundDrawer.cpp
===================================================================
--- trunk/rts/Map/SM3/Sm3GroundDrawer.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Map/SM3/Sm3GroundDrawer.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,6 +10,7 @@
 #include &quot;Rendering/GroundDecalHandler.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Map/MapInfo.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;
 
 #include &lt;SDL_keysym.h&gt;

Modified: trunk/rts/Map/SM3/terrain/TerrainTextureGLSL.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/TerrainTextureGLSL.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Map/SM3/terrain/TerrainTextureGLSL.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -38,7 +38,7 @@
 #include &quot;Platform/FileSystem.h&quot;
 #include &quot;bitops.h&quot;
 #include &quot;System/Util.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Exceptions.h&quot;
 
 #include &lt;fstream&gt;

Modified: trunk/rts/Map/SMF/BFGroundDrawer.cpp
===================================================================
--- trunk/rts/Map/SMF/BFGroundDrawer.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Map/SMF/BFGroundDrawer.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,6 +13,7 @@
 #include &quot;Rendering/GroundDecalHandler.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;
 #include &quot;System/FastMath.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;mmgr.h&quot;
 
 #ifdef USE_GML

Modified: trunk/rts/Rendering/Env/AdvSky.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvSky.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/AdvSky.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -17,6 +17,7 @@
 #include &quot;TimeProfiler.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;
 #include &quot;Matrix44f.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 #define Y_PART 10.0
 #define X_PART 10.0

Modified: trunk/rts/Rendering/Env/AdvTreeGenerator.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvTreeGenerator.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/AdvTreeGenerator.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -14,6 +14,7 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Rendering/Textures/Bitmap.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &quot;System/Exceptions.h&quot;
 

Modified: trunk/rts/Rendering/Env/AdvWater.cpp
===================================================================
--- trunk/rts/Rendering/Env/AdvWater.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/AdvWater.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -17,6 +17,7 @@
 #include &quot;Rendering/UnitModels/UnitDrawer.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Sim/Features/FeatureHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/EventHandler.h&quot;
 #include &quot;Map/MapInfo.h&quot;
 

Modified: trunk/rts/Rendering/Env/BaseTreeDrawer.cpp
===================================================================
--- trunk/rts/Rendering/Env/BaseTreeDrawer.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/BaseTreeDrawer.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -7,7 +7,7 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;
 #include &quot;Game/Camera.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 
 CBaseTreeDrawer* treeDrawer=0;
 

Modified: trunk/rts/Rendering/Env/BasicSky.cpp
===================================================================
--- trunk/rts/Rendering/Env/BasicSky.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/BasicSky.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,6 +18,7 @@
 #include &quot;Rendering/Textures/Bitmap.h&quot;
 #include &quot;TimeProfiler.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;Matrix44f.h&quot;
 #include &quot;LogOutput.h&quot;
 

Modified: trunk/rts/Rendering/Env/BumpWater.cpp
===================================================================
--- trunk/rts/Rendering/Env/BumpWater.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/BumpWater.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -32,6 +32,7 @@
 #include &quot;System/Platform/ConfigHandler.h&quot;
 #include &quot;TimeProfiler.h&quot;
 #include &quot;LogOutput.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Exceptions.h&quot;
 
 using std::string;

Modified: trunk/rts/Rendering/Env/DynWater.cpp
===================================================================
--- trunk/rts/Rendering/Env/DynWater.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/DynWater.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -22,6 +22,7 @@
 #include &quot;Sim/Units/UnitHandler.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/EventHandler.h&quot;
 #include &quot;System/Exceptions.h&quot;
 

Modified: trunk/rts/Rendering/Env/GrassDrawer.cpp
===================================================================
--- trunk/rts/Rendering/Env/GrassDrawer.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/GrassDrawer.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,6 +18,7 @@
 #include &quot;Map/MapInfo.h&quot;
 #include &quot;Map/ReadMap.h&quot;
 #include &quot;Rendering/ShadowHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Util.h&quot;
 #include &quot;System/Exceptions.h&quot;
 //#include &quot;TimeProfiler.h&quot;

Modified: trunk/rts/Rendering/Env/RefractWater.cpp
===================================================================
--- trunk/rts/Rendering/Env/RefractWater.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/RefractWater.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -7,6 +7,7 @@
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/MapInfo.h&quot;
 #include &quot;Map/ReadMap.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;bitops.h&quot;
 
 CRefractWater::CRefractWater() : CAdvWater(false)

Modified: trunk/rts/Rendering/Env/SkyBox.cpp
===================================================================
--- trunk/rts/Rendering/Env/SkyBox.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Env/SkyBox.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -6,7 +6,7 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Rendering/Textures/Bitmap.h&quot;
 #include &quot;Game/Camera.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;Map/MapInfo.h&quot;
 #include &quot;Map/ReadMap.h&quot;
 #include &quot;Rendering/UnitModels/UnitDrawer.h&quot;

Modified: trunk/rts/Rendering/FartextureHandler.cpp
===================================================================
--- trunk/rts/Rendering/FartextureHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/FartextureHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,7 +5,7 @@
 #include &quot;FartextureHandler.h&quot;
 #include &quot;UnitModels/3DOParser.h&quot;
 #include &quot;GL/myGL.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
 #include &quot;UnitModels/UnitDrawer.h&quot;
 #include &quot;Rendering/Textures/Bitmap.h&quot;
 #include &quot;Map/MapInfo.h&quot;

Modified: trunk/rts/Rendering/GL/myGL.cpp
===================================================================
--- trunk/rts/Rendering/GL/myGL.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/GL/myGL.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -15,7 +15,7 @@
 #include &quot;Platform/ConfigHandler.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;FPUCheck.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Util.h&quot;
 #include &quot;System/Exceptions.h&quot;
 

Modified: trunk/rts/Rendering/GroundDecalHandler.cpp
===================================================================
--- trunk/rts/Rendering/GroundDecalHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/GroundDecalHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,6 +18,7 @@
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;
 #include &quot;Sim/Units/UnitTypes/Building.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &quot;System/Util.h&quot;
 #include &quot;System/Exceptions.h&quot;

Modified: trunk/rts/Rendering/GroundFlash.cpp
===================================================================
--- trunk/rts/Rendering/GroundFlash.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/GroundFlash.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -8,6 +8,7 @@
 #include &quot;GL/VertexArray.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Rendering/Textures/ColorMap.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CGroundFlash, CExpGenSpawnable, );
 

Modified: trunk/rts/Rendering/IconHandler.cpp
===================================================================
--- trunk/rts/Rendering/IconHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/IconHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -9,7 +9,6 @@
 #include &lt;string&gt;
 #include &quot;mmgr.h&quot;
 
-#include &quot;GlobalStuff.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;IconHandler.h&quot;
 #include &quot;Lua/LuaParser.h&quot;

Modified: trunk/rts/Rendering/Textures/NamedTextures.cpp
===================================================================
--- trunk/rts/Rendering/Textures/NamedTextures.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Textures/NamedTextures.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -9,7 +9,7 @@
 #include &quot;NamedTextures.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Rendering/Textures/Bitmap.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 
 map&lt;string, CNamedTextures::TexInfo&gt; CNamedTextures::texMap;

Modified: trunk/rts/Rendering/Textures/TextureAtlas.cpp
===================================================================
--- trunk/rts/Rendering/Textures/TextureAtlas.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Textures/TextureAtlas.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -9,7 +9,7 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;System/Util.h&quot;
 #include &quot;System/Exceptions.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/Vec2.h&quot;
 
 CR_BIND(AtlasedTexture, );
 CR_BIND_DERIVED(GroundFXTexture, AtlasedTexture, );

Modified: trunk/rts/Rendering/Textures/TextureHandler.cpp
===================================================================
--- trunk/rts/Rendering/Textures/TextureHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/Textures/TextureHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,6 +13,7 @@
 #include &quot;TextureHandler.h&quot;
 #include &quot;FileSystem/FileHandler.h&quot;
 #include &quot;FileSystem/SimpleParser.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/Team.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;

Modified: trunk/rts/Rendering/UnitModels/3DModelParser.h
===================================================================
--- trunk/rts/Rendering/UnitModels/3DModelParser.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/UnitModels/3DModelParser.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,7 +5,6 @@
 #include &lt;string&gt;
 #include &lt;set&gt;
 #include &quot;Matrix44f.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 
 struct S3DO;

Modified: trunk/rts/Rendering/UnitModels/3DOParser.cpp
===================================================================
--- trunk/rts/Rendering/UnitModels/3DOParser.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/UnitModels/3DOParser.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,7 +13,6 @@
 
 #include &quot;3DOParser.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;
-#include &quot;GlobalStuff.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;FileSystem/VFSHandler.h&quot;

Modified: trunk/rts/Rendering/UnitModels/UnitDrawer.cpp
===================================================================
--- trunk/rts/Rendering/UnitModels/UnitDrawer.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/UnitModels/UnitDrawer.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -42,6 +42,7 @@
 #include &quot;Sim/Units/UnitHandler.h&quot;
 #include &quot;Sim/Units/UnitTypes/TransportUnit.h&quot;
 #include &quot;Sim/Weapons/Weapon.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;mmgr.h&quot;
 
 #ifdef USE_GML

Modified: trunk/rts/Rendering/glFont.cpp
===================================================================
--- trunk/rts/Rendering/glFont.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Rendering/glFont.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -12,6 +12,7 @@
 #include &quot;Game/Camera.h&quot;
 #include &quot;myMath.h&quot;
 #include &quot;Platform/FileSystem.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Util.h&quot;
 #include &quot;System/Exceptions.h&quot;
 

Modified: trunk/rts/Sim/Features/Feature.cpp
===================================================================
--- trunk/rts/Sim/Features/Feature.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Features/Feature.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -24,6 +24,7 @@
 #include &quot;Sim/Projectiles/Unsynced/SmokeProjectile.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &lt;assert.h&gt;
 
 CR_BIND_DERIVED(CFeature, CSolidObject, )

Modified: trunk/rts/Sim/Features/FeatureHandler.cpp
===================================================================
--- trunk/rts/Sim/Features/FeatureHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Features/FeatureHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -25,6 +25,7 @@
 #include &quot;Sim/Misc/CollisionVolume.h&quot;
 #include &quot;Sim/Units/UnitHandler.h&quot;
 #include &quot;Sim/Units/CommandAI/BuilderCAI.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/EventHandler.h&quot;
 #include &quot;System/TimeProfiler.h&quot;
 #include &quot;System/Platform/ConfigHandler.h&quot;

Modified: trunk/rts/Sim/Misc/AirBaseHandler.cpp
===================================================================
--- trunk/rts/Sim/Misc/AirBaseHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Misc/AirBaseHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,6 +1,8 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;mmgr.h&quot;
 #include &quot;AirBaseHandler.h&quot;
+
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Units/COB/CobInstance.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;

Modified: trunk/rts/Sim/Misc/AirBaseHandler.h
===================================================================
--- trunk/rts/Sim/Misc/AirBaseHandler.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Misc/AirBaseHandler.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,12 +1,13 @@
 #ifndef AIRBASEHANDLER_H
 #define AIRBASEHANDLER_H
 
-#include &quot;Object.h&quot;
-#include &quot;System/float3.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
 #include &lt;list&gt;
 #include &lt;boost/noncopyable.hpp&gt;
 
+#include &quot;Object.h&quot;
+#include &quot;System/float3.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
+
 class CUnit;
 
 class CAirBaseHandler : public boost::noncopyable

Modified: trunk/rts/Sim/Misc/GroundBlockingObjectMap.cpp
===================================================================
--- trunk/rts/Sim/Misc/GroundBlockingObjectMap.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Misc/GroundBlockingObjectMap.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -3,6 +3,8 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;GroundBlockingObjectMap.h&quot;
+
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Sim/Objects/SolidObject.h&quot;
 #include &quot;Sim/Path/PathManager.h&quot;
 #include &quot;creg/STL_Map.h&quot;

Modified: trunk/rts/Sim/Misc/InterceptHandler.cpp
===================================================================
--- trunk/rts/Sim/Misc/InterceptHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Misc/InterceptHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,6 +2,8 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;InterceptHandler.h&quot;
+
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Sim/Weapons/Weapon.h&quot;
 #include &quot;Sim/Projectiles/WeaponProjectiles/WeaponProjectile.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;

Modified: trunk/rts/Sim/Misc/QuadField.cpp
===================================================================
--- trunk/rts/Sim/Misc/QuadField.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Misc/QuadField.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -8,6 +8,7 @@
 
 #include &quot;QuadField.h&quot;
 
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Sim/Features/Feature.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;LogOutput.h&quot;

Modified: trunk/rts/Sim/Misc/QuadField.h
===================================================================
--- trunk/rts/Sim/Misc/QuadField.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Misc/QuadField.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -11,7 +11,7 @@
 
 #include &quot;creg/creg.h&quot;
 #include &quot;float3.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 
 class CUnit;
 class CWorldObject;

Modified: trunk/rts/Sim/Misc/Wind.cpp
===================================================================
--- trunk/rts/Sim/Misc/Wind.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Misc/Wind.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,6 +2,7 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;Wind.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Sim/Units/UnitHandler.h&quot;
 #include &quot;Map/MapInfo.h&quot;
 

Modified: trunk/rts/Sim/ModInfo.cpp
===================================================================
--- trunk/rts/Sim/ModInfo.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/ModInfo.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,7 +2,7 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;mmgr.h&quot;
 
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
 #include &quot;ModInfo.h&quot;
 #include &quot;Game/GameSetup.h&quot;
 #include &quot;Lua/LuaParser.h&quot;

Modified: trunk/rts/Sim/MoveTypes/GroundMoveType.cpp
===================================================================
--- trunk/rts/Sim/MoveTypes/GroundMoveType.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/MoveTypes/GroundMoveType.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -30,6 +30,7 @@
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
 #include &quot;Sim/Weapons/Weapon.h&quot;
 #include &quot;Sync/SyncTracer.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/EventHandler.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &quot;System/Sound.h&quot;

Modified: trunk/rts/Sim/MoveTypes/ScriptMoveType.cpp
===================================================================
--- trunk/rts/Sim/MoveTypes/ScriptMoveType.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/MoveTypes/ScriptMoveType.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -15,6 +15,7 @@
 #include &quot;Sim/Misc/RadarHandler.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;
 #include &quot;Sim/Units/UnitTypes/Building.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Matrix44f.h&quot;
 #include &quot;System/myMath.h&quot;
 

Modified: trunk/rts/Sim/Objects/SolidObject.cpp
===================================================================
--- trunk/rts/Sim/Objects/SolidObject.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Objects/SolidObject.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -26,7 +26,9 @@
 	CR_MEMBER(isMoving),
 	CR_MEMBER(residualImpulse),
 	CR_MEMBER(mobility),
-	CR_MEMBER(mapPos),
+	// can't get creg work on templates
+	CR_MEMBER(mapPos.x),
+	CR_MEMBER(mapPos.y),
 	CR_MEMBER(buildFacing),
 	CR_MEMBER(isMarkedOnBlockingMap),
 	CR_MEMBER(speed),

Modified: trunk/rts/Sim/Objects/SolidObject.h
===================================================================
--- trunk/rts/Sim/Objects/SolidObject.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Objects/SolidObject.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -3,7 +3,7 @@
 
 #include &quot;WorldObject.h&quot;
 #include &quot;Sim/MoveTypes/MoveInfo.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Vec2.h&quot;
 #include &quot;Sync/SyncedFloat3.h&quot;
 
 class CUnit;

Modified: trunk/rts/Sim/Path/PathCache.cpp
===================================================================
--- trunk/rts/Sim/Path/PathCache.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Path/PathCache.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -3,6 +3,8 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;PathCache.h&quot;
+
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;LogOutput.h&quot;
 
 using namespace std;

Modified: trunk/rts/Sim/Path/PathCache.h
===================================================================
--- trunk/rts/Sim/Path/PathCache.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Path/PathCache.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,7 +5,7 @@
 #include &lt;list&gt;
 
 #include &quot;IPath.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/Vec2.h&quot;
 
 class CPathCache
 {

Modified: trunk/rts/Sim/Projectiles/ExplosionGenerator.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/ExplosionGenerator.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/ExplosionGenerator.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -24,6 +24,7 @@
 #include &quot;Sim/Projectiles/Unsynced/WakeProjectile.h&quot;
 #include &quot;Sim/Projectiles/Unsynced/WreckProjectile.h&quot;
 #include &lt;assert.h&gt;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Exceptions.h&quot;
 
 using std::min;

Modified: trunk/rts/Sim/Projectiles/FireProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/FireProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/FireProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,10 +5,12 @@
 #include &quot;Sim/Misc/Wind.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Game/Camera.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Sim/Misc/QuadField.h&quot;
 #include &quot;Sim/Features/Feature.h&quot;
 #include &quot;ProjectileHandler.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;creg/STL_List.h&quot;
 
 CR_BIND_DERIVED(CFireProjectile, CProjectile, (float3(0,0,0),float3(0,0,0),NULL,0,0,0,0));

Modified: trunk/rts/Sim/Projectiles/FlareProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/FlareProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/FlareProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,6 +2,7 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;FlareProjectile.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/Camera.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/MapInfo.h&quot;
@@ -11,6 +12,7 @@
 #include &quot;Sim/Units/UnitDef.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;WeaponProjectiles/MissileProjectile.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CFlareProjectile, CProjectile, (float3(0,0,0),float3(0,0,0),0,0));
 

Modified: trunk/rts/Sim/Projectiles/PieceProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/PieceProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/PieceProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -3,7 +3,8 @@
 
 #include &quot;Game/Camera.h&quot;
 #include &quot;Game/GameHelper.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/Ground.h&quot;
 #include &quot;Map/MapInfo.h&quot;

Modified: trunk/rts/Sim/Projectiles/Projectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Projectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Projectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,6 +13,7 @@
 #include &quot;LogOutput.h&quot;
 #include &quot;Rendering/UnitModels/3DModelParser.h&quot;
 #include &quot;Map/MapInfo.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CProjectile, CExpGenSpawnable, );
 

Modified: trunk/rts/Sim/Projectiles/ProjectileHandler.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/ProjectileHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/ProjectileHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -33,6 +33,7 @@
 #include &quot;Sim/Projectiles/Unsynced/ShieldPartProjectile.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/EventHandler.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &quot;System/TimeProfiler.h&quot;

Modified: trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,11 +2,12 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;BitmapMuzzleFlame.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Rendering/Textures/ColorMap.h&quot;
 #include &quot;Rendering/Textures/TextureAtlas.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CBitmapMuzzleFlame, CProjectile, );
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,7 +5,7 @@
 #include &quot;Game/Camera.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CBubbleProjectile, CProjectile, (float3(0,0,0),float3(0,0,0),0,0,0,NULL,0));
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,6 +10,7 @@
 #include &quot;Map/MapInfo.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CDirtProjectile, CProjectile, );
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,7 +5,7 @@
 #include &quot;Game/Camera.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CExploSpikeProjectile, CProjectile, );
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -3,7 +3,7 @@
 
 #include &quot;Game/Camera.h&quot;
 #include &quot;GenericParticleProjectile.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Rendering/Textures/ColorMap.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;

Modified: trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,7 +5,7 @@
 #include &quot;GeoSquareProjectile.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CGeoSquareProjectile, CProjectile, (float3(0,0,0),float3(0,0,0),float3(0,0,0),float3(0,0,0),0,0));
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -4,11 +4,12 @@
 //////////////////////////////////////////////////////////////////////
 #include &quot;mmgr.h&quot;
 
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/Camera.h&quot;
 #include &quot;GfxProjectile.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CGfxProjectile, CProjectile, );
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -8,7 +8,7 @@
 #include &quot;HeatCloudProjectile.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CHeatCloudProjectile, CProjectile, );
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,7 +5,7 @@
 #include &quot;MuzzleFlame.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 
 CR_BIND_DERIVED(CMuzzleFlame, CProjectile, (float3(0,0,0),float3(0,0,0),float3(0,0,0),0));

Modified: trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -6,6 +6,7 @@
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CRepulseGfx, CProjectile, (NULL,NULL,0,float3(0,0,0)));
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -6,7 +6,7 @@
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Rendering/Textures/TextureAtlas.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CShieldPartProjectile, CProjectile, (float3(0,0,0),0,0,0,float3(0,0,0),0,NULL,NULL));
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,8 +2,9 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;Game/Camera.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 #include &quot;GenericParticleProjectile.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Rendering/Textures/ColorMap.h&quot;
 #include &quot;SimpleParticleSystem.h&quot;

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,12 +5,14 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;mmgr.h&quot;
 
+#include &quot;SmokeProjectile.h&quot;
+
 #include &quot;Game/Camera.h&quot;
 #include &quot;Map/Ground.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Misc/Wind.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;SmokeProjectile.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CSmokeProjectile, CProjectile, );
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,12 +5,14 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;mmgr.h&quot;
 
+#include &quot;SmokeProjectile2.h&quot;
+
 #include &quot;Game/Camera.h&quot;
 #include &quot;Map/Ground.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Misc/Wind.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;SmokeProjectile2.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CSmokeProjectile2, CProjectile, );
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,6 +5,9 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;mmgr.h&quot;
 
+#include &quot;SmokeTrailProjectile.h&quot;
+
+#include &quot;Rendering/Textures/TextureAtlas.h&quot;
 #include &quot;Game/Camera.h&quot;
 #include &quot;Map/Ground.h&quot;
 #include &quot;myMath.h&quot;
@@ -12,7 +15,7 @@
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Misc/Wind.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;SmokeTrailProjectile.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CSmokeTrailProjectile, CProjectile, (float3(0,0,0),float3(0,0,0),float3(0,0,0),float3(0,0,0),NULL,0,0,0,0,0,0,NULL,NULL));
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -6,6 +6,8 @@
 
 #include &quot;Sim/Projectiles/Projectile.h&quot;
 
+class AtlasedTexture;
+
 class CSmokeTrailProjectile : public CProjectile
 {
 	CR_DECLARE(CSmokeTrailProjectile);

Modified: trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,11 +2,12 @@
 #include &lt;algorithm&gt;
 #include &quot;mmgr.h&quot;
 
+#include &quot;Game/GlobalConstants.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;SpherePartProjectile.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 using std::min;
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -7,7 +7,7 @@
 
 #include &quot;TracerProjectile.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;			// Header File For The OpenGL32 Library
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CTracerProjectile, CProjectile, )
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2,12 +2,13 @@
 #include &quot;mmgr.h&quot;
 
 #include &quot;Game/Camera.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 #include &quot;Rendering/Env/BaseWater.h&quot;
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Misc/Wind.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;WakeProjectile.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CWakeProjectile, CProjectile, (float3(0,0,0),float3(0,0,0),0,0,NULL,0,0,0));
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,6 +13,7 @@
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;SmokeProjectile.h&quot;
 #include &quot;WreckProjectile.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CWreckProjectile, CProjectile, (float3(0,0,0),float3(0,0,0),0,0));
 

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -8,6 +8,7 @@
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
 #include &quot;Sync/SyncTracer.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CEmgProjectile, CWeaponProjectile, (float3(0,0,0),float3(0,0,0),NULL,float3(0,0,0),0,0,NULL));
 

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -14,6 +14,7 @@
 #include &quot;Sim/Misc/InterceptHandler.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 #ifdef TRACE_SYNC
 	#include &quot;Sync/SyncTracer.h&quot;

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -9,6 +9,7 @@
 #include &quot;Rendering/GL/VertexArray.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CFireBallProjectile, CWeaponProjectile, (float3(0,0,0),float3(0,0,0),NULL,NULL,float3(0,0,0),NULL));
 CR_BIND(CFireBallProjectile::Spark, );

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -8,6 +8,7 @@
 #include &quot;Rendering/Textures/ColorMap.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CFlameProjectile, CWeaponProjectile, (float3(0,0,0),float3(0,0,0),float3(0,0,0),NULL,NULL,0));
 

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -8,6 +8,7 @@
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CLargeBeamLaserProjectile, CWeaponProjectile, (float3(0,0,0),float3(0,0,0),float3(0,0,0),float3(0,0,0),NULL,NULL));
 

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -9,6 +9,7 @@
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Sim/Projectiles/Unsynced/SimpleParticleSystem.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 #ifdef TRACE_SYNC
 	#include &quot;Sync/SyncTracer.h&quot;

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -7,7 +7,7 @@
 #include &quot;Sim/Weapons/Weapon.h&quot;
 #include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 
 #ifdef TRACE_SYNC
 	#include &quot;Sync/SyncTracer.h&quot;

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -21,6 +21,7 @@
 #include &quot;Sync/SyncTracer.h&quot;
 #include &quot;Rendering/UnitModels/s3oParser.h&quot;
 #include &quot;Rendering/UnitModels/3DOParser.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 static const float Smoke_Time=60;
 

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,6 +18,7 @@
 #include &quot;StarburstProjectile.h&quot;
 #include &quot;Sync/SyncTracer.h&quot;
 #include &quot;Rendering/UnitModels/s3oParser.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 static const float Smoke_Time=70;
 

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,6 +13,7 @@
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
 #include &quot;TorpedoProjectile.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 #ifdef TRACE_SYNC
 	#include &quot;Sync/SyncTracer.h&quot;

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,6 +18,7 @@
 #include &quot;Sim/Features/Feature.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Misc/InterceptHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #ifdef TRACE_SYNC
 	#include &quot;Sync/SyncTracer.h&quot;

Modified: trunk/rts/Sim/Units/COB/CobInstance.cpp
===================================================================
--- trunk/rts/Sim/Units/COB/CobInstance.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/COB/CobInstance.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -38,6 +38,7 @@
 #include &quot;Sim/Weapons/PlasmaRepulser.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
 #include &quot;Sim/Weapons/Weapon.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;Sound.h&quot;
 #include &quot;Sync/SyncTracer.h&quot;
 

Modified: trunk/rts/Sim/Units/COB/CobInstance.h
===================================================================
--- trunk/rts/Sim/Units/COB/CobInstance.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/COB/CobInstance.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,7 +10,7 @@
 const float  RAD2TAANG = 9.587526207370107576104371709781e-5f;
 
 #include &quot;Object.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 
 
 #define PACKXZ(x,z) (((int)(x) &lt;&lt; 16)+((int)(z) &amp; 0xffff))

Modified: trunk/rts/Sim/Units/COB/CobThread.cpp
===================================================================
--- trunk/rts/Sim/Units/COB/CobThread.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/COB/CobThread.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,11 +10,7 @@
 
 #include &quot;LogOutput.h&quot;
 
-#ifdef _CONSOLE
-#include &quot;GlobalStuff.h&quot;
-#else
-#include &quot;GlobalStuff.h&quot;
-#endif
+#include &quot;Game/GlobalSynced.h&quot;
 
 CCobThread::CCobThread(CCobFile &amp;script, CCobInstance *owner)
 : owner(owner), script(script)

Modified: trunk/rts/Sim/Units/CommandAI/AirCAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/AirCAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/CommandAI/AirCAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -18,6 +18,7 @@
 #include &quot;System/myMath.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &lt;assert.h&gt;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Util.h&quot;
 
 

Modified: trunk/rts/Sim/Units/CommandAI/BuilderCAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/BuilderCAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/CommandAI/BuilderCAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -36,6 +36,7 @@
 #include &quot;Sim/Units/UnitTypes/TransportUnit.h&quot;
 #include &quot;myMath.h&quot;
 #include &quot;creg/STL_Map.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Util.h&quot;
 #include &quot;System/Exceptions.h&quot;
 

Modified: trunk/rts/Sim/Units/CommandAI/CommandAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/CommandAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/CommandAI/CommandAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -33,6 +33,7 @@
 #include &quot;creg/STL_Set.h&quot;
 #include &quot;creg/STL_Deque.h&quot;
 #include &lt;assert.h&gt;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Util.h&quot;
 
 const int TARGET_LOST_TIMER =120;	// in calls to SlowUpdate() (approx. once every second)

Modified: trunk/rts/Sim/Units/CommandAI/FactoryCAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/FactoryCAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/CommandAI/FactoryCAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -4,6 +4,7 @@
 #include &quot;FactoryCAI.h&quot;
 #include &quot;LineDrawer.h&quot;
 #include &quot;ExternalAI/Group.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/GameHelper.h&quot;
 #include &quot;Game/SelectedUnits.h&quot;
 #include &quot;Game/Team.h&quot;
@@ -20,6 +21,7 @@
 #include &quot;Sim/Units/UnitTypes/Factory.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;creg/STL_Map.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Util.h&quot;
 #include &quot;System/Exceptions.h&quot;
 

Modified: trunk/rts/Sim/Units/CommandAI/LineDrawer.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/LineDrawer.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/CommandAI/LineDrawer.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,7 +1,7 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;LineDrawer.h&quot;
 #include &quot;Game/UI/CommandColors.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
 
 CLineDrawer lineDrawer;
 

Modified: trunk/rts/Sim/Units/CommandAI/MobileCAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/MobileCAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/CommandAI/MobileCAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -25,6 +25,7 @@
 #include &quot;myMath.h&quot;
 #include &lt;assert.h&gt;
 #include &quot;System/Util.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 CR_BIND_DERIVED(CMobileCAI ,CCommandAI , );
 

Modified: trunk/rts/Sim/Units/CommandAI/TransportCAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/TransportCAI.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/CommandAI/TransportCAI.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -19,6 +19,7 @@
 #include &quot;Sim/ModInfo.h&quot;
 #include &quot;Rendering/UnitModels/3DOParser.h&quot;
 #include &quot;creg/STL_List.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 #define AIRTRANSPORT_DOCKING_RADIUS 16
 #define AIRTRANSPORT_DOCKING_ANGLE 50

Modified: trunk/rts/Sim/Units/Unit.cpp
===================================================================
--- trunk/rts/Sim/Units/Unit.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/Unit.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -2336,7 +2336,8 @@
 	CR_MEMBER(sonarJamRadius),
 	CR_MEMBER(hasRadarCapacity),
 	CR_MEMBER(radarSquares),
-	CR_MEMBER(oldRadarPos),
+	CR_MEMBER(oldRadarPos.x),
+	CR_MEMBER(oldRadarPos.y),
 	CR_MEMBER(stealth),
 	CR_MEMBER(sonarStealth),
 	CR_RESERVED(15),

Modified: trunk/rts/Sim/Units/Unit.h
===================================================================
--- trunk/rts/Sim/Units/Unit.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/Unit.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -8,10 +8,12 @@
 #include &lt;vector&gt;
 #include &lt;string&gt;
 #include &lt;deque&gt;
+
 #include &quot;Lua/LuaUnitMaterial.h&quot;
 #include &quot;Sim/Objects/SolidObject.h&quot;
 #include &quot;System/Matrix44f.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
+#include &quot;Vec2.h&quot;
 
 class CCobInstance;
 class CCommandAI;

Modified: trunk/rts/Sim/Units/UnitHandler.cpp
===================================================================
--- trunk/rts/Sim/Units/UnitHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/UnitHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -27,6 +27,7 @@
 #include &quot;Sim/Misc/QuadField.h&quot;
 #include &quot;Sim/Units/CommandAI/Command.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/FileSystem/FileHandler.h&quot;
 #include &quot;System/LoadSaveInterface.h&quot;
 #include &quot;System/LogOutput.h&quot;

Modified: trunk/rts/Sim/Units/UnitTracker.cpp
===================================================================
--- trunk/rts/Sim/Units/UnitTracker.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/UnitTracker.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,6 +10,7 @@
 #include &quot;Game/SelectedUnits.h&quot;
 #include &quot;Map/Ground.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;LogOutput.h&quot;
 
 

Modified: trunk/rts/Sim/Units/UnitTypes/Builder.cpp
===================================================================
--- trunk/rts/Sim/Units/UnitTypes/Builder.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/UnitTypes/Builder.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -26,6 +26,7 @@
 #include &quot;Sim/Units/UnitDefHandler.h&quot;
 #include &quot;Sim/Units/UnitHandler.h&quot;
 #include &quot;Sim/Units/UnitLoader.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/EventHandler.h&quot;
 #include &quot;Sound.h&quot;
 #include &quot;mmgr.h&quot;

Modified: trunk/rts/Sim/Units/UnitTypes/Building.cpp
===================================================================
--- trunk/rts/Sim/Units/UnitTypes/Building.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/UnitTypes/Building.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -14,6 +14,7 @@
 #include &quot;Rendering/GroundDecalHandler.h&quot;
 #include &quot;Game/GameSetup.h&quot;
 #include &quot;Rendering/UnitModels/UnitDrawer.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 #include &quot;mmgr.h&quot;
 

Modified: trunk/rts/Sim/Units/UnitTypes/Factory.cpp
===================================================================
--- trunk/rts/Sim/Units/UnitTypes/Factory.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Units/UnitTypes/Factory.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -25,6 +25,7 @@
 #include &quot;Sim/Units/UnitHandler.h&quot;
 #include &quot;Sim/Units/UnitLoader.h&quot;
 #include &quot;Sync/SyncTracer.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/EventHandler.h&quot;
 #include &quot;Sound.h&quot;
 #include &quot;LogOutput.h&quot;

Modified: trunk/rts/Sim/Weapons/DGunWeapon.cpp
===================================================================
--- trunk/rts/Sim/Weapons/DGunWeapon.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Weapons/DGunWeapon.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,5 +1,6 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;DGunWeapon.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/Team.h&quot;
 #include &quot;Sim/Projectiles/WeaponProjectiles/FireBallProjectile.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;

Modified: trunk/rts/Sim/Weapons/PlasmaRepulser.cpp
===================================================================
--- trunk/rts/Sim/Weapons/PlasmaRepulser.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Weapons/PlasmaRepulser.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,6 +1,7 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;creg/STL_List.h&quot;
 #include &quot;creg/STL_Set.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/Team.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;PlasmaRepulser.h&quot;

Modified: trunk/rts/Sim/Weapons/WeaponDefHandler.cpp
===================================================================
--- trunk/rts/Sim/Weapons/WeaponDefHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Weapons/WeaponDefHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -4,6 +4,7 @@
 #include &lt;iostream&gt;
 #include &lt;stdexcept&gt;
 #include &quot;WeaponDefHandler.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
 #include &quot;Game/Game.h&quot;
 #include &quot;Lua/LuaParser.h&quot;
 #include &quot;FileSystem/FileHandler.h&quot;

Modified: trunk/rts/Sim/Weapons/bombdropper.cpp
===================================================================
--- trunk/rts/Sim/Weapons/bombdropper.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/Sim/Weapons/bombdropper.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,6 +5,7 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;bombdropper.h&quot;
 #include &quot;Game/GameHelper.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/Team.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Map/MapInfo.h&quot;

Modified: trunk/rts/System/DemoRecorder.cpp
===================================================================
--- trunk/rts/System/DemoRecorder.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/DemoRecorder.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -13,6 +13,7 @@
 #include &quot;Game/GameVersion.h&quot;
 #include &quot;Game/GameSetup.h&quot;
 #include &quot;System/Util.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 
 #include &quot;LogOutput.h&quot;
 

Modified: trunk/rts/System/FastMath.h
===================================================================
--- trunk/rts/System/FastMath.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/FastMath.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -174,6 +174,7 @@
 	}
 }
 
+using fastmath::PI;
 namespace math {
 	using fastmath::isqrt;
 	using fastmath::isqrt2;

Deleted: trunk/rts/System/GlobalStuff.cpp
===================================================================
--- trunk/rts/System/GlobalStuff.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/GlobalStuff.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,386 +0,0 @@
-/**
- * @file GlobalStuff.cpp
- * @brief Globally accessible stuff
- *
- * Contains implementation of synced and
- * unsynced global stuff
- */
-#include &quot;StdAfx.h&quot;
-#include &lt;cstring&gt;
-#include &quot;mmgr.h&quot;
-#include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
-#include &quot;Game/GameHelper.h&quot;
-#include &quot;Game/GameSetup.h&quot;
-#include &quot;Sync/SyncTracer.h&quot;
-#include &quot;Game/Team.h&quot;
-#include &quot;Game/Player.h&quot;
-#include &quot;Rendering/Textures/TAPalette.h&quot;
-#include &quot;Lua/LuaGaia.h&quot;
-#include &quot;Lua/LuaRules.h&quot;
-#include &quot;SDL_types.h&quot;
-#include &quot;SDL_timer.h&quot;
-#include &lt;assert.h&gt;
-
-/**
- * @brief global synced
- *
- * Global instance of CGlobalSyncedStuff
- */
-CGlobalSyncedStuff* gs;
-
-/**
- * @brief global unsynced
- *
- * Global instance of CGlobalUnsyncedStuff
- */
-CGlobalUnsyncedStuff* gu;
-
-/**
- * @brief randint max
- *
- * Defines the maximum random integer as 0x7fff
- */
-const int RANDINT_MAX = 0x7fff;
-
-CR_BIND(CGlobalSyncedStuff,);
-
-CR_REG_METADATA(CGlobalSyncedStuff, (
-				CR_MEMBER(randSeed),
-				CR_MEMBER(initRandSeed),
-				CR_MEMBER(frameNum),
-				CR_MEMBER(speedFactor),
-				CR_MEMBER(userSpeedFactor),
-				CR_MEMBER(paused),
-				CR_MEMBER(tempNum),
-				CR_MEMBER(godMode),
-				CR_MEMBER(globalLOS),
-				CR_MEMBER(cheatEnabled),
-				CR_MEMBER(noHelperAIs),
-				CR_MEMBER(editDefsEnabled),
-				CR_MEMBER(useLuaRules),
-				CR_MEMBER(useLuaGaia),
-				CR_MEMBER(gaiaTeamID),
-				CR_MEMBER(gaiaAllyTeamID),
-				CR_MEMBER(gameMode),
-				CR_MEMBER(players),
-				CR_MEMBER(activeTeams),
-				CR_MEMBER(activeAllyTeams),
-				CR_MEMBER(activePlayers),
-				CR_MEMBER(allies),
-				CR_MEMBER(team2allyteam),
-				CR_MEMBER(teams),
-				CR_RESERVED(64)
-				));
-
-CR_BIND(CGlobalUnsyncedStuff,);
-
-CR_REG_METADATA(CGlobalUnsyncedStuff, (
-				CR_MEMBER(usRandSeed),
-				CR_MEMBER(modGameTime),
-				CR_MEMBER(gameTime),
-				CR_MEMBER(lastFrameTime),
-				CR_MEMBER(myPlayerNum),
-				CR_MEMBER(myTeam),
-				CR_MEMBER(myAllyTeam),
-				CR_MEMBER(spectating),
-				CR_MEMBER(spectatingFullView),
-				CR_MEMBER(spectatingFullSelect),
-				CR_MEMBER(viewRange),
-				CR_MEMBER(timeOffset),
-				CR_MEMBER(drawFog),
-				CR_MEMBER(autoQuit),
-				CR_MEMBER(quitTime),
-				CR_RESERVED(64)
-				));
-
-/**
- * Initializes variables in CGlobalSyncedStuff
- */
-CGlobalSyncedStuff::CGlobalSyncedStuff()
-{
-	hmapx = 256;
-	hmapy = 256;
-	randSeed = 18655;
-	initRandSeed = randSeed;
-	frameNum = 0;
-	speedFactor = 1;
-	userSpeedFactor = 1;
-	paused = false;
-	godMode = false;
-	globalLOS = false;
-	cheatEnabled = false;
-	noHelperAIs = false;
-	editDefsEnabled = false;
-	tempNum = 2;
-	gameMode = 0;
-	useLuaGaia = true;
-	gaiaTeamID = -1;
-	gaiaAllyTeamID = -1;
-	useLuaRules = true;
-	
-	for(int a = 0; a &lt; MAX_TEAMS; ++a) {
-		teams[a] = SAFE_NEW CTeam();
-		teams[a]-&gt;teamNum = a;
-		team2allyteam[a] = a;
-	}
-	for(int a = 0; a &lt; MAX_PLAYERS; ++a) {
-		players[a] = SAFE_NEW CPlayer();
-		players[a]-&gt;playerNum = a;
-	}
-
-	for (int a = 0; a &lt; MAX_TEAMS; ++a) {
-		for (int b = 0; b &lt; MAX_TEAMS; ++b) {
-			allies[a][b] = false;
-		}
-		allies[a][a] = true;
-	}
-
-	activeTeams = 2;
-	activeAllyTeams = 2;
-	activePlayers = MAX_PLAYERS;
-}
-
-/**
- * Destroys data inside CGlobalSyncedStuff
- */
-CGlobalSyncedStuff::~CGlobalSyncedStuff()
-{
-	for(int a = 0; a &lt; MAX_TEAMS; a++) {
-		delete teams[a];
-	}
-	for(int a = 0; a &lt; MAX_PLAYERS; a++) {
-		delete players[a];
-	}
-}
-
-void CGlobalSyncedStuff::LoadFromSetup(const CGameSetup* setup)
-{
-	gameMode = setup-&gt;gameMode;
-	noHelperAIs = !!setup-&gt;noHelperAIs;
-
-	useLuaGaia  = CLuaGaia::SetConfigString(setup-&gt;luaGaiaStr);
-	useLuaRules = CLuaRules::SetConfigString(setup-&gt;luaRulesStr);
-
-	activePlayers = setup-&gt;numPlayers;
-	activeTeams = setup-&gt;numTeams;
-	activeAllyTeams = setup-&gt;numAllyTeams;
-	
-	assert(activeTeams &lt;= MAX_TEAMS);
-	assert(activeAllyTeams &lt;= MAX_TEAMS);
-
-	for (int i = 0; i &lt; activePlayers; ++i)
-	{
-		// TODO: refactor
-		*static_cast&lt;PlayerBase*&gt;(players[i]) = setup-&gt;playerStartingData[i];
-	}
-
-	for (int i = 0; i &lt; activeTeams; ++i)
-	{
-		teams[i]-&gt;metal = setup-&gt;startMetal;
-		teams[i]-&gt;metalIncome = setup-&gt;startMetal; // for the endgame statistics
-
-		teams[i]-&gt;energy = setup-&gt;startEnergy;
-		teams[i]-&gt;energyIncome = setup-&gt;startEnergy;
-
-		float3 start(setup-&gt;teamStartingData[i].startPos.x, setup-&gt;teamStartingData[i].startPos.y, setup-&gt;teamStartingData[i].startPos.z);
-		teams[i]-&gt;StartposMessage(start, (setup-&gt;startPosType != CGameSetup::StartPos_ChooseInGame));
-		std::memcpy(teams[i]-&gt;color, setup-&gt;teamStartingData[i].color, 4);
-		teams[i]-&gt;handicap = setup-&gt;teamStartingData[i].handicap;
-		teams[i]-&gt;leader = setup-&gt;teamStartingData[i].leader;
-		teams[i]-&gt;side = setup-&gt;teamStartingData[i].side;
-		SetAllyTeam(i, setup-&gt;teamStartingData[i].teamAllyteam);
-		if (!setup-&gt;teamStartingData[i].aiDll.empty())
-		{
-			if (setup-&gt;teamStartingData[i].aiDll.substr(0, 6) == &quot;LuaAI:&quot;) // its a LuaAI
-			{
-				teams[i]-&gt;luaAI = setup-&gt;teamStartingData[i].aiDll.substr(6);
-				teams[i]-&gt;isAI = true;
-			}
-			else // no LuaAI
-			{
-				if (setup-&gt;hostDemo) // in demo replay, we don't need AI's to load again
-					teams[i]-&gt;dllAI = &quot;&quot;;
-				else
-				{
-					teams[i]-&gt;dllAI = setup-&gt;teamStartingData[i].aiDll;
-					teams[i]-&gt;isAI = true;
-				}
-			}
-		}
-	}
-
-	for (int allyTeam1 = 0; allyTeam1 &lt; activeAllyTeams; ++allyTeam1)
-	{
-		for (int allyTeam2 = 0; allyTeam2 &lt; activeAllyTeams; ++allyTeam2)
-			allies[allyTeam1][allyTeam2] = setup-&gt;allyStartingData[allyTeam1].allies[allyTeam2];
-	}
-
-	if (useLuaGaia) {
-		//TODO duplicated in SpringApp::CreateGameSetup()
-		// Gaia adjustments
-		gaiaTeamID = activeTeams;
-		gaiaAllyTeamID = activeAllyTeams;
-		activeTeams++;
-		activeAllyTeams++;
-
-		// Setup the gaia team
-		CTeam* team = gs-&gt;Team(gs-&gt;gaiaTeamID);
-		team-&gt;color[0] = 255;
-		team-&gt;color[1] = 255;
-		team-&gt;color[2] = 255;
-		team-&gt;color[3] = 255;
-		team-&gt;gaia = true;
-		team-&gt;StartposMessage(float3(0.0, 0.0, 0.0), true);
-		//players[setup-&gt;numPlayers]-&gt;team = gaiaTeamID;
-		SetAllyTeam(gaiaTeamID, gaiaAllyTeamID);
-	}
-}
-
-/**
- * @return synced random integer
- *
- * returns a synced random integer
- */
-int CGlobalSyncedStuff::randInt()
-{
-	randSeed = (randSeed * 214013L + 2531011L);
-	return randSeed &amp; RANDINT_MAX;
-}
-
-/**
- * @return synced random float
- *
- * returns a synced random float
- */
-float CGlobalSyncedStuff::randFloat()
-{
-	randSeed = (randSeed * 214013L + 2531011L);
-	return float(randSeed &amp; RANDINT_MAX)/RANDINT_MAX;
-}
-
-/**
- * @return synced random vector
- *
- * returns a synced random vector
- */
-float3 CGlobalSyncedStuff::randVector()
-{
-	float3 ret;
-	do {
-		ret.x = randFloat()*2-1;
-		ret.y = randFloat()*2-1;
-		ret.z = randFloat()*2-1;
-	} while(ret.SqLength()&gt;1);
-
-	return ret;
-}
-
-int CGlobalSyncedStuff::Player(const std::string&amp; name)
-{
-	for (int i = 0; i &lt; MAX_PLAYERS; ++i) {
-		if (players[i] &amp;&amp; players[i]-&gt;name == name) {
-			return i;
-		}
-	}
-	return -1;
-}
-
-/**
- * Initializes variables in CGlobalUnsyncedStuff
- */
-CGlobalUnsyncedStuff::CGlobalUnsyncedStuff()
-{
-	Uint64 randnum;
-	randnum = SDL_GetTicks();
-	usRandSeed = randnum&amp;0xffffffff;
-	modGameTime = 0;
-	gameTime = 0;
-	lastFrameTime = 0;
-	drawFrame = 1;
-	viewSizeX = 100;
-	viewSizeY = 100;
-	pixelX = 0.01f;
-	pixelY = 0.01f;
-	aspectRatio = 1.0f;
-	myPlayerNum = 0;
-	myTeam = 1;
-	myAllyTeam = 1;
-	spectating           = false;
-	spectatingFullView   = false;
-	spectatingFullSelect = false;
-	drawdebug = false;
-	active = true;
-	viewRange = MAX_VIEW_RANGE;
-	timeOffset = 0;
-	drawFog = true;
-	compressTextures = false;
-	atiHacks = false;
-	teamNanospray = false;
-	autoQuit = false;
-	quitTime = 0;
-#ifdef DIRECT_CONTROL_ALLOWED
-	directControl = 0;
-#endif
-}
-
-/**
- * Destroys variables in CGlobalUnsyncedStuff
- */
-CGlobalUnsyncedStuff::~CGlobalUnsyncedStuff()
-{
-}
-
-/**
- * @return unsynced random integer
- *
- * Returns an unsynced random integer
- */
-int CGlobalUnsyncedStuff::usRandInt()
-{
-	usRandSeed = (usRandSeed * 214013L + 2531011L);
-	return usRandSeed &amp; RANDINT_MAX;
-}
-
-/**
- * @return unsynced random float
- *
- * returns an unsynced random float
- */
-float CGlobalUnsyncedStuff::usRandFloat()
-{
-	usRandSeed = (usRandSeed * 214013L + 2531011L);
-	return float(usRandSeed &amp; RANDINT_MAX)/RANDINT_MAX;
-}
-
-/**
- * @return unsynced random vector
- *
- * returns an unsynced random vector
- */
-float3 CGlobalUnsyncedStuff::usRandVector()
-{
-	float3 ret;
-	do {
-		ret.x = usRandFloat() * 2 - 1;
-		ret.y = usRandFloat() * 2 - 1;
-		ret.z = usRandFloat() * 2 - 1;
-	} while (ret.SqLength() &gt; 1);
-
-	return ret;
-}
-
-void CGlobalUnsyncedStuff::LoadFromSetup(const CGameSetup* setup)
-{
-	myPlayerNum = setup-&gt;myPlayerNum;
-	myTeam = setup-&gt;playerStartingData[myPlayerNum].team;
-	myAllyTeam = setup-&gt;teamStartingData[myTeam].teamAllyteam;
-
-	spectating = setup-&gt;playerStartingData[myPlayerNum].spectator;
-	spectatingFullView   = setup-&gt;playerStartingData[myPlayerNum].spectator;
-	spectatingFullSelect = setup-&gt;playerStartingData[myPlayerNum].spectator;
-	
-	assert(myPlayerNum &gt;= 0 &amp;&amp; myPlayerNum &lt; MAX_PLAYERS &amp;&amp;
-			setup-&gt;playerStartingData.size() &gt;= myPlayerNum &amp;&amp;
-			setup-&gt;teamStartingData.size() &gt;= myTeam);
-}
-

Deleted: trunk/rts/System/GlobalStuff.h
===================================================================
--- trunk/rts/System/GlobalStuff.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/GlobalStuff.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,693 +0,0 @@
-/**
- * @file GlobalStuff.h
- * @brief Globally accessible stuff
- *
- * Contains the synced and unsynced global
- * data accessed by the program
- */
-#ifndef GLOBALSTUFF_H
-#define GLOBALSTUFF_H
-
-#include &quot;float3.h&quot;
-
-/**
- * @brief pi
- *
- * Defines PI as a float
- */
-const float PI = 3.141592654f;
-
-/**
- * @brief maximum world size
- *
- * Defines the maximum world size as 1000000
- */
-const int MAX_WORLD_SIZE = 1000000;
-
-/**
- * @brief square size
- *
- * Defines the size of 1 square as 8
- */
-const int  SQUARE_SIZE = 8;
-
-/**
- * @brief game speed
- *
- * Defines the game speed as 30
- */
-const int GAME_SPEED = 30;
-
-/**
- * @brief max view range
- *
- * Defines the maximum view range as 8000
- */
-const int MAX_VIEW_RANGE = 8000;
-
-/**
- * @brief max teams
- *
- * Defines the maximum number of teams
- * as 17 (16 real teams, and an extra slot for the GAIA team)
- */
-const int MAX_TEAMS = 17;
-
-/**
- * @brief max players
- *
- * Defines the maximum number of players as 32
- */
-const int MAX_PLAYERS = 32;
-
-/**
- * @brief near plane
- *
- * Defines the near plane as 2.8f
- */
-const float NEAR_PLANE = 2.8f;
-
-
-/**
- * @brief int2 struct
- *
- * Struct containing two integers
- */
-struct int2 {
-	CR_DECLARE_STRUCT(int2);
-
-	/**
-	 * @brief Constructor
-	 *
-	 * Does nothing
-	 */
-	int2(){};
-
-	/**
-	 * @brief Constructor
-	 * @param x x value to use
-	 * @param y y value to use
-	 *
-	 * Initializes struct with a
-	 * given x and y
-	 */
-	int2(int x,int y):x(x),y(y){};
-
-	int x; //!&lt; x component of int2
-	int y; //!&lt; y component of int2
-};
-
-/**
- * @brief float2 struct
- *
- * Struct containing two floats
- */
-struct float2 {
-	CR_DECLARE_STRUCT(float2);
-	float x; //!&lt; x component of float2
-	float y; //!&lt; y component of float2
-};
-
-/**
- * @brief upwards vector
- *
- * Defines constant upwards vector
- * (0,1,0)
- */
-const float3 UpVector(0,1,0);
-
-/**
- * @brief zero vector
- *
- * Defines constant zero vector
- * (0,0,0)
- */
-const float3 ZeroVector(0,0,0);
-
-class CTeam;
-class CUnit;
-class CPlayer;
-class LuaParser;
-class CGameSetup;
-
-/**
- * @brief Global synced stuff
- *
- * Class contains globally accessible
- * stuff that remains synced.
- */
-class CGlobalSyncedStuff
-{
-public:
-	CR_DECLARE(CGlobalSyncedStuff);
-	CGlobalSyncedStuff();  //!&lt; Constructor
-	~CGlobalSyncedStuff(); //!&lt; Destructor
-	void LoadFromSetup(const CGameSetup*);
-
-	int    randInt();    //!&lt; synced random int
-	float  randFloat();  //!&lt; synced random float
-	float3 randVector(); //!&lt; synced random vector
-
-	void SetRandSeed(unsigned int seed, bool init = false) {
-		randSeed = seed;
-		if (init) { initRandSeed = randSeed; }
-	}
-	unsigned int GetRandSeed()     const { return randSeed; }
-	unsigned int GetInitRandSeed() const { return initRandSeed; }
-
-	/**
-	 * @brief frame number
-	 *
-	 * Stores the current frame number
-	 */
-	int frameNum;
-
-	/**
-	 * @brief speed factor
-	 *
-	 * Contains the actual gamespeed used by the game
-	 */
-	float speedFactor;
-
-	/**
-	 * @brief user speed factor
-	 *
-	 * Contains the user's speed factor.
-	 * The real gamespeed can be up to this
-	 * but is lowered if a computer can't keep up
-	 */
-	float userSpeedFactor;
-
-	/**
-	 * @brief paused
-	 *
-	 * Holds whether the game is paused
-	 */
-	bool paused;
-
-	/**
-	 * @brief map x
-	 *
-	 * The map's number of squares in the x direction
-	 * (note that the number of vertices is one more)
-	 */
-	int mapx;
-
-	/**
-	 * @brief map y
-	 *
-	 * The map's number of squares in the y direction
-	 */
-	int mapy;
-
-	/**
-	 * @brief map squares
-	 *
-	 * Total number of squares on the map
-	 */
-	int mapSquares;
-
-	/**
-	 * @brief half map x
-	 *
-	 * Contains half of the number of squares in the x direction
-	 */
-	int hmapx;
-
-	/**
-	 * @brief half map y
-	 *
-	 * Contains half of the number of squares in the y direction
-	 */
-	int hmapy;
-
-	/**
-	 * @brief map x power of 2
-	 *
-	 * Map's size in the x direction rounded
-	 * up to the next power of 2
-	 */
-	int pwr2mapx;
-
-	/**
-	 * @brief map y power of 2
-	 *
-	 * Map's size in the y direction rounded
-	 * up to the next power of 2
-	 */
-	int pwr2mapy;
-
-	/**
-	 * @brief temp num
-	 *
-	 * Used for getting temporary but unique numbers
-	 * (increase after each use)
-	 */
-	int tempNum;
-
-	/**
-	 * @brief god mode
-	 *
-	 * Whether god mode is enabled, allows all players to control all units (even specs)
-	 */
-	bool godMode;
-
-	/**
-	 * @brief global line-of-sight
-	 *
-	 * Whether everything on the map is visible at all times
-	 */
-	bool globalLOS;
-
-	/**
-	 * @brief cheat enabled
-	 *
-	 * Whether cheating is enabled
-	 */
-	bool cheatEnabled;
-
-	/**
-	 * @brief disable helper AIs
-	 *
-	 * Whether helper AIs are allowed, including GroupAI and LuaUI control widgets
-	 */
-	bool noHelperAIs;
-
-	/**
-	 * @brief definition editing enabled
-	 *
-	 * Whether definition editing is enabled
-	 */
-	bool editDefsEnabled;
-
-	/**
-	 * @brief LuaRules control
-	 *
-	 * Whether or not LuaRules is enabled
-	 */
-	bool useLuaRules;
-
-	/**
-	 * @brief LuaGaia control
-	 *
-	 * Whether or not LuaGaia is enabled
-	 */
-	bool useLuaGaia;
-
-	/**
-	 * @brief gaia team
-	 *
-	 * gaia's team id
-	 */
-	int gaiaTeamID;
-
-	/**
-	 * @brief gaia team
-	 *
-	 * gaia's team id
-	 */
-	int gaiaAllyTeamID;
-
-	/**
-	 * @brief game mode
-	 *
-	 * Determines the commander mode of this game
-	 *   0: game continues after commander dies
-	 *   1: game ends when commander dies
-	 *   2: lineage mode (all descendants die when a commander dies)
-	 */
-	int gameMode;
-
-	/**
-	 * @brief players
-	 *
-	 * Array of CPlayer pointers, for all the
-	 * players in the game
-	 * (size MAX_PLAYERS)
-	 */
-	CPlayer* players[MAX_PLAYERS];
-
-	/**
-	 * @brief active teams
-	 *
-	 * The number of active teams
-	 * (don't change during play)
-	 */
-	int activeTeams;
-
-	/**
-	 * @brief active ally teams
-	 *
-	 * The number of active ally teams
-	 */
-	int activeAllyTeams;
-
-	/**
-	 * @brief active players
-	 *
-	 * The number of active players
-	 */
-	int activePlayers;
-
-	/**
-	 * @brief Player
-	 * @param name name of the player
-	 * @return his playernumber of -1 if not found
-	 *
-	 * Search a player by name.
-	 */
-	int Player(const std::string&amp; name);
-
-	/**
-	 * @brief Team
-	 * @param i index to fetch
-	 * @return CTeam pointer
-	 *
-	 * Accesses a CTeam pointer at a given index
-	 */
-	CTeam *Team(int i) { return teams[i]; }
-
-	/**
-	 * @brief ally
-	 * @param a first index
-	 * @param b second index
-	 * @return allies[a][b]
-	 *
-	 * Returns ally at [a][b]
-	 */
-	bool Ally(int a,int b) { return allies[a][b]; }
-
-	/**
-	 * @brief ally team
-	 * @param team team to find
-	 * @return the ally team
-	 *
-	 * returns the team2ally at given index
-	 */
-	int AllyTeam(int team) { return team2allyteam[team]; }
-
-	/**
-	 * @brief allied teams
-	 * @param a first team
-	 * @param b second team
-	 * @return whether teams are allied
-	 *
-	 * Tests whether teams are allied
-	 */
-	bool AlliedTeams(int a,int b) { return allies[team2allyteam[a]][team2allyteam[b]]; }
-
-	/**
-	 * @brief set ally team
-	 * @param team team to set
-	 * @param allyteam allyteam to set
-	 *
-	 * Sets team's ally team
-	 */
-	void SetAllyTeam(int team, int allyteam) { team2allyteam[team]=allyteam; }
-
-	/**
-	 * @brief set ally
-	 * @param allyteamA first allyteam
-	 * @param allyteamB second allyteam
-	 * @param allied whether or not these two teams are allied
-	 *
-	 * Sets two allyteams to be allied or not
-	 */
-	void SetAlly(int allyteamA,int allyteamB, bool allied) { allies[allyteamA][allyteamB]=allied; }
-
-private:
-	/**
-	* @brief random seed
-	*
-	* Holds the synced random seed
-	*/
-	int randSeed;
-
-	/**
-	* @brief initial random seed
-	*
-	* Holds the synced initial random seed
-	*/
-	int initRandSeed;
-
-	/**
-	 * @brief allies array
-	 *
-	 * Array indicates whether teams are allied,
-	 * allies[a][b] means allyteam a is allied with
-	 * allyteam b, NOT the other way around
-	 */
-	bool allies[MAX_TEAMS][MAX_TEAMS];
-
-	/**
-	 * @brief team to ally team
-	 *
-	 * Array stores what ally team a specific team is part of
-	 */
-	int team2allyteam[MAX_TEAMS];
-
-	/**
-	 * @brief teams
-	 *
-	 * Array of CTeam pointers for teams in game
-	 */
-	CTeam* teams[MAX_TEAMS];
-};
-
-/**
- * @brief Global unsynced stuff
- *
- * Class containing globally accessible
- * stuff that does not remain synced
- */
-class CGlobalUnsyncedStuff
-{
-public:
-	CR_DECLARE(CGlobalUnsyncedStuff);
-	CGlobalUnsyncedStuff();  //!&lt; Constructor
-	~CGlobalUnsyncedStuff(); //!&lt; Destructor
-
-	int    usRandInt();    //!&lt; Unsynced random int
-	float  usRandFloat();  //!&lt; Unsynced random float
-	float3 usRandVector(); //!&lt; Unsynced random vector
-
-	void LoadFromSetup(const CGameSetup*);
-
-	/**
-	 * Does the user want team colored nanospray if the mod allows it?
-	 */
-	bool teamNanospray;
-
-	/**
-	 * @brief mod game time
-	 *
-	 * How long the game has been going on
-	 * (modified with game's speed factor)
-	 */
-	float modGameTime;
-
-	/**
-	 * @brief game time
-	 *
-	 * How long the game has been going on
-	 * in real time
-	 */
-	float gameTime;
-
-	/**
-	 * @brief last frame time
-	 *
-	 * How long the last draw cycle took in real time
-	 */
-	float lastFrameTime;
-
-	// the draw frame number (never 0)
-	unsigned int drawFrame;
-
-	// the screen size in pixels
-	int screenSizeX;
-	int screenSizeY;
-
-	// the window position relative to the screen's bottom-left corner
-	int winPosX;
-	int winPosY;
-
-	// the window size in pixels
-	int winSizeX;
-	int winSizeY;
-
-	// the viewport position relative to the window's bottom-left corner
-	int viewPosX;
-	int viewPosY;
-
-	// the viewport size in pixels
-	int viewSizeX;
-	int viewSizeY;
-
-	// size of one pixel in viewport coordinates, i.e. 1/viewSizeX and 1/viewSizeY
-	float pixelX;
-	float pixelY;
-
-	/**
-	 * @brief aspect ratio
-	 *
-	 * (float)viewSizeX / (float)viewSizeY
-	 */
-	float aspectRatio;
-
-	/**
-	 * @brief Depthbuffer bits
-	 *
-	 * depthbuffer precision
-	 */
-	int depthBufferBits;
-
-	/**
-	 * @brief my player num
-	 *
-	 * Local player's number
-	 */
-	int myPlayerNum;
-
-	/**
-	 * @brief my team
-	 *
-	 * Local player's team
-	 */
-	int myTeam;
-
-	/**
-	 * @brief my ally team
-	 *
-	 * Local player's ally team
-	 */
-	int myAllyTeam;
-
-	/**
-	 * @brief spectating
-	 *
-	 * Whether this player is spectating
-	 * (can't give orders, and can see everything if spectateFullView is true)
-	 */
-	bool spectating;
-
-	/**
-	 * @brief spectatingFullView
-	 *
-	 * Whether this player is a spectator, and can see everything
-	 * (if set to false, visibility is determined by the current team)
-	 */
-	bool spectatingFullView;
-
-	/**
-	 * @brief spectatingFullSelect
-	 *
-	 * Can all units be selected when spectating?
-	 */
-	bool spectatingFullSelect;
-
-	/**
-	 * @brief draw debug
-	 *
-	 * Whether debugging info is drawn
-	 */
-	bool drawdebug;
-
-	/**
-	 * @brief active video
-	 *
-	 * Whether the graphics need to be drawn
-	 */
-	bool active;
-
-	/**
-	 * @brief view range
-	 *
-	 * Player's view range
-	 */
-	float viewRange;
-
-	/**
-	 * @brief time offset
-	 *
-	 * Time in number of frames since last update
-	 * (for interpolation)
-	 */
-	float timeOffset;
-
-	/**
-	 * @brief draw fog
-	 *
-	 * Whether fog (of war) is drawn or not
-	 */
-	bool drawFog;
-
-	/**
-	 * @brief compressTextures
-	 *
-	 * If set, many (not all) textures will compressed on run-time.
-	*/
-	bool compressTextures;
-
-	/**
-	 * @brief collection of some ATI bugfixes
-	 *
-	 * enables some ATI bugfixes
-	 */
-	bool atiHacks;
-
-	/**
-	 * @brief quit automatically?
-	 *
-	 * If set, quit immediately on game over or if gameTime &gt; quitTime,
-	 * whichever comes first.
-	 */
-	bool autoQuit;
-
-	/**
-	 * @brief quit time
-	 *
-	 * If autoQuit is set, the host quits if gameTime &gt; quitTime.
-	 * (This automatically causes all other clients to quit too.)
-	 */
-	float quitTime;
-
-	/**
-	 * @brief dual screen mode
-	 * In dual screen mode, the screen is split up between a game screen and a minimap screen.
-	 * In this case viewSizeX is half of the actual GL viewport width,
-	 */
-	bool dualScreenMode;
-
-	/**
-	 * @brief dual screen minimap on left
-	 * In dual screen mode, allow the minimap to either be shown on the left or the right display.
-	 * Minimap on the right is the default.
-	 */
-	bool dualScreenMiniMapOnLeft;
-
-#ifdef DIRECT_CONTROL_ALLOWED
-	/**
-	 * @brief direct control
-	 *
-	 * Pointer to unit being directly controlled by
-	 * this player
-	 */
-	CUnit* directControl;
-#endif
-
-private:
-	/**
-	* @brief rand seed
-	*
-	* Stores the unsynced random seed
-	*/
-	int usRandSeed;
-
-};
-
-extern CGlobalSyncedStuff* gs;
-extern CGlobalUnsyncedStuff* gu;
-extern bool fullscreen;
-
-#endif /* GLOBALSTUFF_H */

Copied: trunk/rts/System/GlobalUnsynced.cpp (from rev 6807, trunk/rts/System/GlobalStuff.cpp)
===================================================================
--- trunk/rts/System/GlobalUnsynced.cpp	                        (rev 0)
+++ trunk/rts/System/GlobalUnsynced.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -0,0 +1,157 @@
+/**
+ * @file GlobalStuff.cpp
+ * @brief Globally accessible stuff
+ *
+ * Contains implementation of synced and
+ * unsynced global stuff
+ */
+#include &quot;StdAfx.h&quot;
+
+#include &quot;GlobalUnsynced.h&quot;
+
+#include &lt;cstring&gt;
+#include &lt;assert.h&gt;
+
+#include &quot;mmgr.h&quot;
+#include &quot;Sim/Projectiles/ProjectileHandler.h&quot;
+#include &quot;Game/GameHelper.h&quot;
+#include &quot;Game/GameSetup.h&quot;
+#include &quot;Sync/SyncTracer.h&quot;
+#include &quot;Game/Team.h&quot;
+#include &quot;Game/Player.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
+#include &quot;Rendering/Textures/TAPalette.h&quot;
+#include &quot;Lua/LuaGaia.h&quot;
+#include &quot;Lua/LuaRules.h&quot;
+#include &quot;SDL_types.h&quot;
+#include &quot;SDL_timer.h&quot;
+
+
+/**
+ * @brief global unsynced
+ *
+ * Global instance of CGlobalUnsyncedStuff
+ */
+CGlobalUnsyncedStuff* gu;
+
+
+CR_BIND(CGlobalUnsyncedStuff,);
+
+CR_REG_METADATA(CGlobalUnsyncedStuff, (
+				CR_MEMBER(usRandSeed),
+				CR_MEMBER(modGameTime),
+				CR_MEMBER(gameTime),
+				CR_MEMBER(lastFrameTime),
+				CR_MEMBER(myPlayerNum),
+				CR_MEMBER(myTeam),
+				CR_MEMBER(myAllyTeam),
+				CR_MEMBER(spectating),
+				CR_MEMBER(spectatingFullView),
+				CR_MEMBER(spectatingFullSelect),
+				CR_MEMBER(viewRange),
+				CR_MEMBER(timeOffset),
+				CR_MEMBER(drawFog),
+				CR_MEMBER(autoQuit),
+				CR_MEMBER(quitTime),
+				CR_RESERVED(64)
+				));
+
+/**
+ * Initializes variables in CGlobalUnsyncedStuff
+ */
+CGlobalUnsyncedStuff::CGlobalUnsyncedStuff()
+{
+	Uint64 randnum;
+	randnum = SDL_GetTicks();
+	usRandSeed = randnum&amp;0xffffffff;
+	modGameTime = 0;
+	gameTime = 0;
+	lastFrameTime = 0;
+	drawFrame = 1;
+	viewSizeX = 100;
+	viewSizeY = 100;
+	pixelX = 0.01f;
+	pixelY = 0.01f;
+	aspectRatio = 1.0f;
+	myPlayerNum = 0;
+	myTeam = 1;
+	myAllyTeam = 1;
+	spectating           = false;
+	spectatingFullView   = false;
+	spectatingFullSelect = false;
+	drawdebug = false;
+	active = true;
+	viewRange = MAX_VIEW_RANGE;
+	timeOffset = 0;
+	drawFog = true;
+	compressTextures = false;
+	atiHacks = false;
+	teamNanospray = false;
+	autoQuit = false;
+	quitTime = 0;
+#ifdef DIRECT_CONTROL_ALLOWED
+	directControl = 0;
+#endif
+}
+
+/**
+ * Destroys variables in CGlobalUnsyncedStuff
+ */
+CGlobalUnsyncedStuff::~CGlobalUnsyncedStuff()
+{
+}
+
+/**
+ * @return unsynced random integer
+ *
+ * Returns an unsynced random integer
+ */
+int CGlobalUnsyncedStuff::usRandInt()
+{
+	usRandSeed = (usRandSeed * 214013L + 2531011L);
+	return usRandSeed &amp; RANDINT_MAX;
+}
+
+/**
+ * @return unsynced random float
+ *
+ * returns an unsynced random float
+ */
+float CGlobalUnsyncedStuff::usRandFloat()
+{
+	usRandSeed = (usRandSeed * 214013L + 2531011L);
+	return float(usRandSeed &amp; RANDINT_MAX)/RANDINT_MAX;
+}
+
+/**
+ * @return unsynced random vector
+ *
+ * returns an unsynced random vector
+ */
+float3 CGlobalUnsyncedStuff::usRandVector()
+{
+	float3 ret;
+	do {
+		ret.x = usRandFloat() * 2 - 1;
+		ret.y = usRandFloat() * 2 - 1;
+		ret.z = usRandFloat() * 2 - 1;
+	} while (ret.SqLength() &gt; 1);
+
+	return ret;
+}
+
+void CGlobalUnsyncedStuff::LoadFromSetup(const CGameSetup* setup)
+{
+	myPlayerNum = setup-&gt;myPlayerNum;
+	myTeam = setup-&gt;playerStartingData[myPlayerNum].team;
+	myAllyTeam = setup-&gt;teamStartingData[myTeam].teamAllyteam;
+
+	spectating = setup-&gt;playerStartingData[myPlayerNum].spectator;
+	spectatingFullView   = setup-&gt;playerStartingData[myPlayerNum].spectator;
+	spectatingFullSelect = setup-&gt;playerStartingData[myPlayerNum].spectator;
+	
+	assert(myPlayerNum &gt;= 0 &amp;&amp; myPlayerNum &lt; MAX_PLAYERS &amp;&amp;
+			setup-&gt;playerStartingData.size() &gt;= myPlayerNum &amp;&amp;
+			setup-&gt;teamStartingData.size() &gt;= myTeam);
+}
+


Property changes on: trunk/rts/System/GlobalUnsynced.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/rts/System/GlobalUnsynced.h (from rev 6807, trunk/rts/System/GlobalStuff.h)
===================================================================
--- trunk/rts/System/GlobalUnsynced.h	                        (rev 0)
+++ trunk/rts/System/GlobalUnsynced.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -0,0 +1,254 @@
+/**
+ * @file GlobalStuff.h
+ * @brief Globally accessible stuff
+ *
+ * Contains the synced and unsynced global
+ * data accessed by the program
+ */
+#ifndef GLOBALSTUFF_H
+#define GLOBALSTUFF_H
+
+#include &quot;float3.h&quot;
+
+
+class CUnit;
+class LuaParser;
+class CGameSetup;
+
+
+/**
+ * @brief Global unsynced stuff
+ *
+ * Class containing globally accessible
+ * stuff that does not remain synced
+ */
+class CGlobalUnsyncedStuff
+{
+public:
+	CR_DECLARE(CGlobalUnsyncedStuff);
+	CGlobalUnsyncedStuff();  //!&lt; Constructor
+	~CGlobalUnsyncedStuff(); //!&lt; Destructor
+
+	int    usRandInt();    //!&lt; Unsynced random int
+	float  usRandFloat();  //!&lt; Unsynced random float
+	float3 usRandVector(); //!&lt; Unsynced random vector
+
+	void LoadFromSetup(const CGameSetup*);
+
+	/**
+	 * Does the user want team colored nanospray if the mod allows it?
+	 */
+	bool teamNanospray;
+
+	/**
+	 * @brief mod game time
+	 *
+	 * How long the game has been going on
+	 * (modified with game's speed factor)
+	 */
+	float modGameTime;
+
+	/**
+	 * @brief game time
+	 *
+	 * How long the game has been going on
+	 * in real time
+	 */
+	float gameTime;
+
+	/**
+	 * @brief last frame time
+	 *
+	 * How long the last draw cycle took in real time
+	 */
+	float lastFrameTime;
+
+	// the draw frame number (never 0)
+	unsigned int drawFrame;
+
+	// the screen size in pixels
+	int screenSizeX;
+	int screenSizeY;
+
+	// the window position relative to the screen's bottom-left corner
+	int winPosX;
+	int winPosY;
+
+	// the window size in pixels
+	int winSizeX;
+	int winSizeY;
+
+	// the viewport position relative to the window's bottom-left corner
+	int viewPosX;
+	int viewPosY;
+
+	// the viewport size in pixels
+	int viewSizeX;
+	int viewSizeY;
+
+	// size of one pixel in viewport coordinates, i.e. 1/viewSizeX and 1/viewSizeY
+	float pixelX;
+	float pixelY;
+
+	/**
+	 * @brief aspect ratio
+	 *
+	 * (float)viewSizeX / (float)viewSizeY
+	 */
+	float aspectRatio;
+
+	/**
+	 * @brief Depthbuffer bits
+	 *
+	 * depthbuffer precision
+	 */
+	int depthBufferBits;
+
+	/**
+	 * @brief my player num
+	 *
+	 * Local player's number
+	 */
+	int myPlayerNum;
+
+	/**
+	 * @brief my team
+	 *
+	 * Local player's team
+	 */
+	int myTeam;
+
+	/**
+	 * @brief my ally team
+	 *
+	 * Local player's ally team
+	 */
+	int myAllyTeam;
+
+	/**
+	 * @brief spectating
+	 *
+	 * Whether this player is spectating
+	 * (can't give orders, and can see everything if spectateFullView is true)
+	 */
+	bool spectating;
+
+	/**
+	 * @brief spectatingFullView
+	 *
+	 * Whether this player is a spectator, and can see everything
+	 * (if set to false, visibility is determined by the current team)
+	 */
+	bool spectatingFullView;
+
+	/**
+	 * @brief spectatingFullSelect
+	 *
+	 * Can all units be selected when spectating?
+	 */
+	bool spectatingFullSelect;
+
+	/**
+	 * @brief draw debug
+	 *
+	 * Whether debugging info is drawn
+	 */
+	bool drawdebug;
+
+	/**
+	 * @brief active video
+	 *
+	 * Whether the graphics need to be drawn
+	 */
+	bool active;
+
+	/**
+	 * @brief view range
+	 *
+	 * Player's view range
+	 */
+	float viewRange;
+
+	/**
+	 * @brief time offset
+	 *
+	 * Time in number of frames since last update
+	 * (for interpolation)
+	 */
+	float timeOffset;
+
+	/**
+	 * @brief draw fog
+	 *
+	 * Whether fog (of war) is drawn or not
+	 */
+	bool drawFog;
+
+	/**
+	 * @brief compressTextures
+	 *
+	 * If set, many (not all) textures will compressed on run-time.
+	*/
+	bool compressTextures;
+
+	/**
+	 * @brief collection of some ATI bugfixes
+	 *
+	 * enables some ATI bugfixes
+	 */
+	bool atiHacks;
+
+	/**
+	 * @brief quit automatically?
+	 *
+	 * If set, quit immediately on game over or if gameTime &gt; quitTime,
+	 * whichever comes first.
+	 */
+	bool autoQuit;
+
+	/**
+	 * @brief quit time
+	 *
+	 * If autoQuit is set, the host quits if gameTime &gt; quitTime.
+	 * (This automatically causes all other clients to quit too.)
+	 */
+	float quitTime;
+
+	/**
+	 * @brief dual screen mode
+	 * In dual screen mode, the screen is split up between a game screen and a minimap screen.
+	 * In this case viewSizeX is half of the actual GL viewport width,
+	 */
+	bool dualScreenMode;
+
+	/**
+	 * @brief dual screen minimap on left
+	 * In dual screen mode, allow the minimap to either be shown on the left or the right display.
+	 * Minimap on the right is the default.
+	 */
+	bool dualScreenMiniMapOnLeft;
+
+#ifdef DIRECT_CONTROL_ALLOWED
+	/**
+	 * @brief direct control
+	 *
+	 * Pointer to unit being directly controlled by
+	 * this player
+	 */
+	CUnit* directControl;
+#endif
+
+private:
+	/**
+	* @brief rand seed
+	*
+	* Stores the unsynced random seed
+	*/
+	int usRandSeed;
+
+};
+
+extern CGlobalUnsyncedStuff* gu;
+extern bool fullscreen;
+
+#endif /* GLOBALSTUFF_H */


Property changes on: trunk/rts/System/GlobalUnsynced.h
___________________________________________________________________
Name: svn:mime-type
   + text/cpp
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Modified: trunk/rts/System/LoadSaveHandler.cpp
===================================================================
--- trunk/rts/System/LoadSaveHandler.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/LoadSaveHandler.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -30,6 +30,7 @@
 #include &quot;Sim/Units/CommandAI/BuilderCAI.h&quot;
 #include &quot;Game/GameServer.h&quot;
 #include &quot;Rendering/InMapDraw.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Exceptions.h&quot;
 
 extern std::string stupidGlobalMapname;

Modified: trunk/rts/System/LogOutput.cpp
===================================================================
--- trunk/rts/System/LogOutput.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/LogOutput.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -15,7 +15,7 @@
 #include &quot;mmgr.h&quot;
 #include &quot;Util.h&quot;
 #include &quot;float3.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 
 
 static std::ofstream* filelog = 0;

Modified: trunk/rts/System/Matrix44f.h
===================================================================
--- trunk/rts/System/Matrix44f.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/Matrix44f.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,6 +1,7 @@
 #ifndef MATRIX44F_H
 #define MATRIX44F_H
 
+#include &quot;Sync/Syncify.h&quot;
 #include &quot;float3.h&quot;
 
 class CMatrix44f

Modified: trunk/rts/System/Messages.cpp
===================================================================
--- trunk/rts/System/Messages.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/Messages.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,7 +10,7 @@
 #include &lt;map&gt;
 #include &quot;mmgr.h&quot;
 
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalUnsynced.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Messages.h&quot;
 #include &quot;Lua/LuaParser.h&quot;

Modified: trunk/rts/System/MouseInput.h
===================================================================
--- trunk/rts/System/MouseInput.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/MouseInput.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -3,7 +3,7 @@
 
 #include &lt;SDL_events.h&gt;
 
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Vec2.h&quot;
 
 class IMouseInput
 {

Modified: trunk/rts/System/Script/LuaBinder.cpp
===================================================================
--- trunk/rts/System/Script/LuaBinder.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/Script/LuaBinder.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -3,7 +3,7 @@
 #include &quot;Game/StartScripts/Script.h&quot;
 #include &quot;float3.h&quot;
 #include &quot;LogOutput.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/Team.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Units/UnitTypes/TransportUnit.h&quot;

Modified: trunk/rts/System/Script/LuaFunctions.cpp
===================================================================
--- trunk/rts/System/Script/LuaFunctions.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/Script/LuaFunctions.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -5,7 +5,7 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;LuaFunctions.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;float3.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;ExternalAI/GlobalAIHandler.h&quot;

Modified: trunk/rts/System/Sound.cpp
===================================================================
--- trunk/rts/System/Sound.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/Sound.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,7 +1,6 @@
 #include &quot;StdAfx.h&quot;
 #include &quot;mmgr.h&quot;
 #include &quot;Sound.h&quot;
-#include &quot;GlobalStuff.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Platform/ConfigHandler.h&quot;

Modified: trunk/rts/System/Sound.h
===================================================================
--- trunk/rts/System/Sound.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/Sound.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,12 +1,14 @@
 #ifndef SOUNDSYSTEM_INTERFACE_H
 #define SOUNDSYSTEM_INTERFACE_H
 
-#include &quot;float3.h&quot;
-#include &quot;GlobalStuff.h&quot;
 #include &lt;set&gt;
+#include &lt;string&gt;
 
+#include &quot;System/float3.h&quot; // for zerovector
+
 class CWorldObject;
 class CUnit;
+class float3;
 
 // Sound system interface
 class CSound

Modified: trunk/rts/System/SpringApp.cpp
===================================================================
--- trunk/rts/System/SpringApp.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/SpringApp.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -14,6 +14,7 @@
 #undef KeyPress
 #undef KeyRelease
 
+#include &quot;Game/GlobalSynced.h&quot;
 #include &quot;Game/GameVersion.h&quot;
 #include &quot;Game/GameSetup.h&quot;
 #include &quot;Game/GameController.h&quot;
@@ -39,6 +40,7 @@
 #include &quot;MouseInput.h&quot;
 #include &quot;bitops.h&quot;
 #include &quot;Sync/Syncify.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
 #include &quot;System/Util.h&quot;
 #include &quot;System/Exceptions.h&quot;
 

Modified: trunk/rts/System/StdAfx.h
===================================================================
--- trunk/rts/System/StdAfx.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/StdAfx.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -56,7 +56,7 @@
 // also, they shouldn't get in the way of mmgr
 #include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;float3.h&quot;
-#include &quot;GlobalStuff.h&quot;
+#include &quot;GlobalSynced.h&quot;
 #include &quot;System/Util.h&quot;
 #include &quot;Map/Ground.h&quot;
 #include &quot;Map/ReadMap.h&quot;

Modified: trunk/rts/System/Sync/SyncDebugger.cpp
===================================================================
--- trunk/rts/System/Sync/SyncDebugger.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/Sync/SyncDebugger.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -7,7 +7,8 @@
 #include &lt;boost/format.hpp&gt;
 
 #include &quot;LogOutput.h&quot;
-#include &quot;System/GlobalStuff.h&quot;
+#include &quot;System/GlobalUnsynced.h&quot;
+#include &quot;GlobalSynced.h&quot;
 #include &quot;System/BaseNetProtocol.h&quot;
 #include &quot;System/NetProtocol.h&quot;
 #include &quot;SyncDebugger.h&quot;
@@ -63,13 +64,6 @@
 		disable_history(false), may_enable_history(false),
 		flop(0), waitingForBlockResponse(false)
 {
-	// Need to allocate those here instead of having them inlined in the class,
-	// because of #include dependency: MAX_PLAYERS is in GlobalStuff.h, which
-	// needs creg.h. But creg.h needs SyncedPrimitive.h, which needs
-	// SyncDebugger.h. Hence we can't use MAX_PLAYERS in SyncDebugger.h.  :-)
-	checksumResponses = new std::vector&lt;unsigned&gt; [MAX_PLAYERS];
-	remoteHistory     = new std::vector&lt;unsigned&gt; [MAX_PLAYERS];
-	remoteFlop = new Uint64 [MAX_PLAYERS];
 }
 
 
@@ -80,9 +74,6 @@
 {
 	delete[] history;
 	delete[] historybt;
-	delete[] checksumResponses;
-	delete[] remoteHistory;
-	delete[] remoteFlop;
 }
 
 

Modified: trunk/rts/System/Sync/SyncDebugger.h
===================================================================
--- trunk/rts/System/Sync/SyncDebugger.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/Sync/SyncDebugger.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -10,6 +10,8 @@
 #include &lt;vector&gt;
 #include &lt;SDL_types.h&gt;
 
+#include &quot;Game/GlobalConstants.h&quot;
+
 /**
  * @brief sync debugger class
  *
@@ -100,12 +102,12 @@
 
 		// server thread
 
-		std::vector&lt;unsigned&gt;* checksumResponses;    ///&lt; Received checksums after a checkum request.
-		Uint64* remoteFlop;                          ///&lt; Received operation number.
+		std::vector&lt;unsigned&gt; checksumResponses[MAX_PLAYERS];    ///&lt; Received checksums after a checkum request.
+		Uint64 remoteFlop[MAX_PLAYERS];                          ///&lt; Received operation number.
 		std::deque&lt;unsigned&gt; requestedBlocks;        ///&lt; We are processing these blocks.
 		std::deque&lt;unsigned&gt; pendingBlocksToRequest; ///&lt; We still need to receive these blocks (slowly emptied).
 		bool waitingForBlockResponse;                ///&lt; Are we still waiting for a block response?
-		std::vector&lt;unsigned&gt;* remoteHistory;        ///&lt; Chk field of history of clients (only of differing blocks).
+		std::vector&lt;unsigned&gt; remoteHistory[MAX_PLAYERS];        ///&lt; Chk field of history of clients (only of differing blocks).
 
 	private:
 

Modified: trunk/rts/System/Sync/SyncedPrimitive.h
===================================================================
--- trunk/rts/System/Sync/SyncedPrimitive.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/Sync/SyncedPrimitive.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -6,7 +6,9 @@
 #if defined(SYNCDEBUG) || defined(SYNCCHECK)
 
 #include &quot;SyncChecker.h&quot;  // for CSyncedPrimitiveBase (if SYNCCHECK is defined)
-#include &quot;SyncDebugger.h&quot; // for CSyncedPrimitiveBase (if SYNCDEBUG is defined)
+#ifdef SYNCDEBUG
+	#include &quot;SyncDebugger.h&quot; // for CSyncedPrimitiveBase (if SYNCDEBUG is defined)
+#endif // SYNCDEBUG
 #include &quot;SyncedPrimitiveBase.h&quot;
 #include &quot;Upcast.h&quot;       // for UPCAST macro
 

Added: trunk/rts/System/Vec2.h
===================================================================
--- trunk/rts/System/Vec2.h	                        (rev 0)
+++ trunk/rts/System/Vec2.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -0,0 +1,19 @@
+#ifndef VEC2_H
+#define VEC2_H
+
+
+template&lt;typename T&gt;
+class Vec2
+{
+public:
+	Vec2() {};
+	Vec2(const T nx, const T ny) : x(nx), y(ny) {};
+
+	T x;
+	T y;
+};
+
+typedef Vec2&lt;int&gt; int2;
+typedef Vec2&lt;float&gt; float2;
+
+#endif
\ No newline at end of file

Modified: trunk/rts/System/float3.h
===================================================================
--- trunk/rts/System/float3.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/float3.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -452,4 +452,21 @@
 	bool CheckInBounds(); //!&lt; Check if this vector is in bounds and clamp x and z if not
 };
 
+/**
+ * @brief upwards vector
+ *
+ * Defines constant upwards vector
+ * (0,1,0)
+ */
+const float3 UpVector(0,1,0);
+
+/**
+ * @brief zero vector
+ *
+ * Defines constant zero vector
+ * (0,0,0)
+ */
+const float3 ZeroVector(0,0,0);
+
+
 #endif /* FLOAT3_H */

Modified: trunk/rts/System/myMath.cpp
===================================================================
--- trunk/rts/System/myMath.cpp	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/myMath.cpp	2008-10-18 14:55:04 UTC (rev 6811)
@@ -4,12 +4,7 @@
 #include &quot;myMath.h&quot;
 #include &quot;mmgr.h&quot;
 
-CR_BIND(float2, );
-CR_REG_METADATA(float2, (CR_MEMBER(x), CR_MEMBER(y)));
 
-CR_BIND(int2, );
-CR_REG_METADATA(int2, (CR_MEMBER(x),CR_MEMBER(y)));
-
 float2 headingToVectorTable[NUM_HEADINGS];
 
 class CMyMath

Modified: trunk/rts/System/myMath.h
===================================================================
--- trunk/rts/System/myMath.h	2008-10-18 13:06:46 UTC (rev 6810)
+++ trunk/rts/System/myMath.h	2008-10-18 14:55:04 UTC (rev 6811)
@@ -1,7 +1,9 @@
 #ifndef MYMATH_H
 #define MYMATH_H
 
-#include &quot;GlobalStuff.h&quot;
+#include &quot;Game/GlobalConstants.h&quot;
+#include &quot;Vec2.h&quot;
+#include &quot;float3.h&quot;
 
 #define MaxByAbs(a,b) (abs((a)) &gt; abs((b))) ? (a) : (b);
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001579.html">[Taspring-linux-commit] r6810 - trunk/tools/unitsync
</A></li>
	<LI>Next message: <A HREF="001581.html">[Taspring-linux-commit] r6812 - trunk/rts/System
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1580">[ date ]</a>
              <a href="thread.html#1580">[ thread ]</a>
              <a href="subject.html#1580">[ subject ]</a>
              <a href="author.html#1580">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
