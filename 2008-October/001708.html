<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6939 - in trunk/rts: Game Rendering	Rendering/UnitModels Sim/Misc Sim/Projectiles	Sim/Projectiles/Unsynced Sim/Projectiles/WeaponProjectiles	Sim/Units lib/gml
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6939%20-%20in%20trunk/rts%3A%20Game%20Rendering%0A%09Rendering/UnitModels%20Sim/Misc%20Sim/Projectiles%0A%09Sim/Projectiles/Unsynced%20Sim/Projectiles/WeaponProjectiles%0A%09Sim/Units%20lib/gml&In-Reply-To=%3C20081031173207.AF696473D%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001707.html">
   <LINK REL="Next"  HREF="001709.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6939 - in trunk/rts: Game Rendering	Rendering/UnitModels Sim/Misc Sim/Projectiles	Sim/Projectiles/Unsynced Sim/Projectiles/WeaponProjectiles	Sim/Units lib/gml</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6939%20-%20in%20trunk/rts%3A%20Game%20Rendering%0A%09Rendering/UnitModels%20Sim/Misc%20Sim/Projectiles%0A%09Sim/Projectiles/Unsynced%20Sim/Projectiles/WeaponProjectiles%0A%09Sim/Units%20lib/gml&In-Reply-To=%3C20081031173207.AF696473D%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6939 - in trunk/rts: Game Rendering	Rendering/UnitModels Sim/Misc Sim/Projectiles	Sim/Projectiles/Unsynced Sim/Projectiles/WeaponProjectiles	Sim/Units lib/gml">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Fri Oct 31 18:32:07 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001707.html">[Taspring-linux-commit] r6938 - trunk/tools/unitsync
</A></li>
        <LI>Next message: <A HREF="001709.html">[Taspring-linux-commit] r6940 - in trunk: rts/Game rts/System	tools/DedicatedServer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1708">[ date ]</a>
              <a href="thread.html#1708">[ thread ]</a>
              <a href="subject.html#1708">[ subject ]</a>
              <a href="author.html#1708">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: zerver
Date: 2008-10-31 18:32:06 +0100 (Fri, 31 Oct 2008)
New Revision: 6939

Modified:
   trunk/rts/Game/GameHelper.cpp
   trunk/rts/Rendering/GroundFlash.cpp
   trunk/rts/Rendering/GroundFlash.h
   trunk/rts/Rendering/UnitModels/UnitDrawer.cpp
   trunk/rts/Sim/Misc/QuadField.cpp
   trunk/rts/Sim/Projectiles/ExplosionGenerator.h
   trunk/rts/Sim/Projectiles/FireProjectile.cpp
   trunk/rts/Sim/Projectiles/FireProjectile.h
   trunk/rts/Sim/Projectiles/FlareProjectile.cpp
   trunk/rts/Sim/Projectiles/FlareProjectile.h
   trunk/rts/Sim/Projectiles/PieceProjectile.cpp
   trunk/rts/Sim/Projectiles/PieceProjectile.h
   trunk/rts/Sim/Projectiles/Projectile.cpp
   trunk/rts/Sim/Projectiles/Projectile.h
   trunk/rts/Sim/Projectiles/ProjectileHandler.cpp
   trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp
   trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.h
   trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.cpp
   trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.h
   trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp
   trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.h
   trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.h
   trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.h
   trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.h
   trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.cpp
   trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/BeamLaserProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/BeamLaserProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.h
   trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.cpp
   trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.h
   trunk/rts/Sim/Units/Unit.cpp
   trunk/rts/Sim/Units/UnitHandler.cpp
   trunk/rts/lib/gml/gml.cpp
   trunk/rts/lib/gml/gml.h
Log:
Improved thread safety for projectiles
Improved interpolation for multithreaded rendering

Modified: trunk/rts/Game/GameHelper.cpp
===================================================================
--- trunk/rts/Game/GameHelper.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Game/GameHelper.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -451,6 +451,8 @@
 void CGameHelper::GenerateTargets(const CWeapon *weapon, CUnit* lastTarget,
                                   std::map&lt;float,CUnit*&gt; &amp;targets)
 {
+	GML_RECMUTEX_LOCK(qnum); // GenerateTargets
+
 	CUnit* attacker = weapon-&gt;owner;
 	float radius = weapon-&gt;range;
 	float3 pos = attacker-&gt;pos;
@@ -541,10 +543,12 @@
 
 CUnit* CGameHelper::GetClosestUnit(const float3 &amp;pos, float radius)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetClosestUnit
+
 	float closeDist = (radius * radius);
 	CUnit* closeUnit = NULL;
 
-	GML_RECMUTEX_LOCK(quad); //GetClosestUnit
+//	GML_RECMUTEX_LOCK(quad); //GetClosestUnit
 
 	vector&lt;int&gt; quads = qf-&gt;GetQuads(pos, radius);
 
@@ -580,6 +584,8 @@
 
 CUnit* CGameHelper::GetClosestEnemyUnit(const float3&amp; pos, float searchRadius, int searchAllyteam)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetClosestEnemyUnit
+
 	float closeDist = searchRadius * searchRadius;
 	CUnit* closeUnit = 0;
 	vector&lt;int&gt; quads = qf-&gt;GetQuads(pos, searchRadius);
@@ -611,6 +617,8 @@
 CUnit* CGameHelper::GetClosestEnemyUnitNoLosTest(const float3 &amp;pos, float radius,
                                                  int searchAllyteam, bool sphere, bool canBeBlind)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetClosestEnemyUnitNoLosTest
+
 	const int tempNum = gs-&gt;tempNum++;
 	CUnit* closeUnit = NULL;
 	float losFactor = (SQUARE_SIZE * (1 &lt;&lt; modInfo.losMipLevel));
@@ -676,6 +684,8 @@
 
 CUnit* CGameHelper::GetClosestFriendlyUnit(const float3 &amp;pos, float radius,int searchAllyteam)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetClosestFriendlyUnit
+
 	float closeDist=radius*radius;
 	CUnit* closeUnit=0;
 	std::vector&lt;int&gt; quads=qf-&gt;GetQuads(pos,radius);
@@ -701,6 +711,8 @@
 
 CUnit* CGameHelper::GetClosestEnemyAircraft(const float3 &amp;pos, float radius,int searchAllyteam)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetClosestEnemyAircraft
+
 	float closeDist=radius*radius;
 	CUnit* closeUnit=0;
 	vector&lt;int&gt; quads=qf-&gt;GetQuads(pos,radius);
@@ -726,6 +738,8 @@
 
 void CGameHelper::GetEnemyUnits(const float3 &amp;pos, float radius, int searchAllyteam, vector&lt;int&gt; &amp;found)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetEnemyUnits
+
 	float sqRadius = radius * radius;
 	std::vector&lt;int&gt; quads = qf-&gt;GetQuads(pos, radius);
 

Modified: trunk/rts/Rendering/GroundFlash.cpp
===================================================================
--- trunk/rts/Rendering/GroundFlash.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Rendering/GroundFlash.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -55,7 +55,7 @@
 
 CVertexArray* CGroundFlash::va=0;
 
-CGroundFlash::CGroundFlash(const float3&amp; p)
+CGroundFlash::CGroundFlash(const float3&amp; p GML_PARG_C)
 {
 	pos=p;
 	alwaysVisible=false;
@@ -69,8 +69,8 @@
 {
 }
 
-CStandardGroundFlash::CStandardGroundFlash(const float3&amp; p,float circleAlpha,float flashAlpha,float flashSize,float circleSpeed,float ttl, const float3&amp; col)
-	: CGroundFlash(p),
+CStandardGroundFlash::CStandardGroundFlash(const float3&amp; p,float circleAlpha,float flashAlpha,float flashSize,float circleSpeed,float ttl, const float3&amp; col GML_PARG_C)
+	: CGroundFlash(p GML_PARG_P),
 	circleAlpha(circleAlpha),
 	flashAlpha(flashAlpha),
 	flashSize(flashSize),
@@ -175,8 +175,8 @@
 	}
 }
 
-CSeismicGroundFlash::CSeismicGroundFlash(const float3&amp; p, AtlasedTexture texture, int ttl, int fade, float size, float sizeGrowth, float alpha, const float3&amp; col)
-	: CGroundFlash(p),
+CSeismicGroundFlash::CSeismicGroundFlash(const float3&amp; p, AtlasedTexture texture, int ttl, int fade, float size, float sizeGrowth, float alpha, const float3&amp; col GML_PARG_C)
+	: CGroundFlash(p GML_PARG_P),
 	sizeGrowth(sizeGrowth),
 	size(size),
 	texture(texture),
@@ -251,7 +251,7 @@
 {
 }
 
-void CSimpleGroundFlash::Init(const float3&amp; explosionPos, CUnit *owner)
+void CSimpleGroundFlash::Init(const float3&amp; explosionPos, CUnit *owner GML_PARG_C)
 {
 	pos += explosionPos;
 

Modified: trunk/rts/Rendering/GroundFlash.h
===================================================================
--- trunk/rts/Rendering/GroundFlash.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Rendering/GroundFlash.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -12,12 +12,12 @@
 public:
 	CR_DECLARE(CGroundFlash);
 
-	CGroundFlash(const float3&amp; p);
+	CGroundFlash(const float3&amp; p GML_PARG_H);
 	CGroundFlash();
 	virtual ~CGroundFlash(){};
 	virtual void Draw(){};
 	virtual bool Update(){return false;}; // returns false when it should be deleted
-	virtual void Init(const float3&amp; pos, CUnit *owner){};
+	virtual void Init(const float3&amp; pos, CUnit *owner GML_PARG_H){};
 
 	//bool alwaysVisible;
 	//float3 pos;
@@ -31,7 +31,7 @@
 	CR_DECLARE(CStandardGroundFlash);
 
 	CStandardGroundFlash();
-	CStandardGroundFlash(const float3&amp; pos, float circleAlpha,float flashAlpha,float flashSize,float circleSpeed,float ttl, const float3&amp; color=float3(1.0f,1.0f,0.7f));
+	CStandardGroundFlash(const float3&amp; pos, float circleAlpha,float flashAlpha,float flashSize,float circleSpeed,float ttl, const float3&amp; color=float3(1.0f,1.0f,0.7f) GML_PARG_H);
 	~CStandardGroundFlash();
 	void Draw();
 	bool Update(); // returns false when it should be deleted
@@ -58,7 +58,7 @@
 public:
 	CR_DECLARE(CSeismicGroundFlash);
 	~CSeismicGroundFlash();
-	CSeismicGroundFlash(const float3&amp; pos, AtlasedTexture texture, int ttl, int fade, float size, float sizeGrowth, float alpha, const float3&amp; col);
+	CSeismicGroundFlash(const float3&amp; pos, AtlasedTexture texture, int ttl, int fade, float size, float sizeGrowth, float alpha, const float3&amp; col GML_PARG_H);
 	void Draw();
 	bool Update(); // returns false when it should be deleted
 
@@ -82,7 +82,7 @@
 	CSimpleGroundFlash();
 	~CSimpleGroundFlash();
 
-	void Init(const float3&amp; explosionPos, CUnit *owner);
+	void Init(const float3&amp; explosionPos, CUnit *owner GML_PARG_H);
 	void Draw();
 	bool Update(); // returns false when it should be deleted
 

Modified: trunk/rts/Rendering/UnitModels/UnitDrawer.cpp
===================================================================
--- trunk/rts/Rendering/UnitModels/UnitDrawer.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Rendering/UnitModels/UnitDrawer.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -393,9 +393,6 @@
 	drawFar.clear();
 	drawStat.clear();
 
-	drawCloaked.clear();
-	drawCloakedS3O.clear();
-
 	glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
 	glFogfv(GL_FOG_COLOR, mapInfo-&gt;atmosphere.fogColor);
 
@@ -418,6 +415,9 @@
 
 	GML_RECMUTEX_LOCK(unit); // Draw
 
+	drawCloaked.clear();
+	drawCloakedS3O.clear();
+
 #ifdef USE_GML
 	if(multiThreadDrawUnit) {
 		mt_drawReflection=drawReflection; // these member vars will be accessed by DoDrawUnitMT
@@ -927,6 +927,10 @@
 	// cloaked units and living ghosted buildings (stored in same vector)
 	for (GML_VECTOR&lt;CUnit*&gt;::iterator ui = dC.begin(); ui != dC.end(); ++ui) {
 		CUnit* unit = *ui;
+#if defined(USE_GML) &amp;&amp; GML_ENABLE_SIMDRAW
+		if(unit==NULL)
+			continue;
+#endif
 		const unsigned short losStatus = unit-&gt;losStatus[gu-&gt;myAllyTeam];
 		if ((losStatus &amp; LOS_INLOS) || gu-&gt;spectatingFullView) {
 			if (is_s3o) {

Modified: trunk/rts/Sim/Misc/QuadField.cpp
===================================================================
--- trunk/rts/Sim/Misc/QuadField.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Misc/QuadField.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -154,6 +154,8 @@
 
 std::vector&lt;CUnit*&gt; CQuadField::GetUnits(const float3&amp; pos,float radius)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetUnits
+
 	std::vector&lt;CUnit*&gt; units;
 
 	int* endQuad=tempQuads;
@@ -176,6 +178,8 @@
 
 std::vector&lt;CUnit*&gt; CQuadField::GetUnitsExact(const float3&amp; pos,float radius)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetUnitsExact
+
 	std::vector&lt;CUnit*&gt; units;
 
 	int* endQuad=tempQuads;
@@ -199,6 +203,8 @@
 
 std::vector&lt;CUnit*&gt; CQuadField::GetUnitsExact(const float3&amp; mins, const float3&amp; maxs)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetUnitsExact
+
 	std::vector&lt;CUnit*&gt; units;
 	std::vector&lt;int&gt; quads = GetQuadsRectangle(mins, maxs);
 
@@ -410,6 +416,8 @@
 
 vector&lt;CFeature*&gt; CQuadField::GetFeaturesExact(const float3&amp; pos,float radius)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetFeaturesExact
+
 	vector&lt;CFeature*&gt; features;
 /*	if(pos.x&lt;0 || pos.z&lt;0 || pos.x&gt;gs-&gt;mapx*SQUARE_SIZE || pos.z&gt;gs-&gt;mapy*SQUARE_SIZE){
 		logOutput.Print(&quot;Trying to get units outside map %.0f %.0f&quot;,pos.x,pos.z);
@@ -438,6 +446,8 @@
 std::vector&lt;CFeature*&gt; CQuadField::GetFeaturesExact(const float3&amp; mins,
                                                const float3&amp; maxs)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetFeaturesExact
+
 	std::vector&lt;CFeature*&gt; features;
 	std::vector&lt;int&gt; quads = GetQuadsRectangle(mins, maxs);
 
@@ -464,6 +474,8 @@
 
 std::vector&lt;CSolidObject*&gt; CQuadField::GetSolidsExact(const float3&amp; pos,float radius)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetSolidsExact
+
 	std::vector&lt;CSolidObject*&gt; solids;
 	std::vector&lt;int&gt; quads = GetQuads(pos,radius);
 	int tempNum = gs-&gt;tempNum++;
@@ -522,6 +534,8 @@
 // optimization specifically for projectile collisions
 void CQuadField::GetUnitsAndFeaturesExact(const float3&amp; pos, float radius, CUnit**&amp; dstUnit, CFeature**&amp; dstFeature)
 {
+	GML_RECMUTEX_LOCK(qnum); // GetUnitsAndFeaturesExact
+
 	int tempNum=gs-&gt;tempNum++;
 
 	int* endQuad = tempQuads;

Modified: trunk/rts/Sim/Projectiles/ExplosionGenerator.h
===================================================================
--- trunk/rts/Sim/Projectiles/ExplosionGenerator.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/ExplosionGenerator.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -1,6 +1,7 @@
 #ifndef EXPLOSION_GRAPHICS_H
 #define EXPLOSION_GRAPHICS_H
 
+#include &quot;Rendering/GL/myGL.h&quot;
 #include &quot;Sim/Misc/DamageArray.h&quot;
 #include &quot;Lua/LuaParser.h&quot;
 #include &quot;Sim/Objects/WorldObject.h&quot;
@@ -18,7 +19,7 @@
 	CExpGenSpawnable(): CWorldObject(){};
 	CExpGenSpawnable(const float3&amp; pos): CWorldObject(pos) {};
 	virtual ~CExpGenSpawnable() {};
-	virtual void Init(const float3&amp; pos, CUnit* owner) = 0;
+	virtual void Init(const float3&amp; pos, CUnit* owner GML_PARG_H) = 0;
 };
 
 

Modified: trunk/rts/Sim/Projectiles/FireProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/FireProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/FireProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -39,8 +39,8 @@
 	));
 
 
-CFireProjectile::CFireProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner,int emitTtl,float emitRadius,int particleTtl,float particleSize)
-: CProjectile(pos,speed,owner, true),
+CFireProjectile::CFireProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner,int emitTtl,float emitRadius,int particleTtl,float particleSize GML_PARG_C)
+: CProjectile(pos,speed,owner, true GML_PARG_P),
 	ttl(emitTtl),
 	emitPos(pos),
 	emitRadius(emitRadius),

Modified: trunk/rts/Sim/Projectiles/FireProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/FireProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/FireProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -10,7 +10,7 @@
 	CR_DECLARE(CFireProjectile);
 	CR_DECLARE_SUB(SubParticle);
 public:
-	CFireProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner,int emitTtl,float emitRadius,int particleTtl,float particleSize);
+	CFireProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner,int emitTtl,float emitRadius,int particleTtl,float particleSize GML_PARG_H);
 	~CFireProjectile(void);
 
 	void Draw(void);

Modified: trunk/rts/Sim/Projectiles/FlareProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/FlareProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/FlareProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -28,8 +28,8 @@
 				CR_RESERVED(8)
 				));
 
-CFlareProjectile::CFlareProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner,int activateFrame)
-:	CProjectile(pos,speed,owner, true),
+CFlareProjectile::CFlareProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner,int activateFrame GML_PARG_C)
+:	CProjectile(pos,speed,owner, true GML_PARG_P),
 	activateFrame(activateFrame),
 	deathFrame(activateFrame+(owner?owner-&gt;unitDef-&gt;flareTime:1)),
 	numSub(0),

Modified: trunk/rts/Sim/Projectiles/FlareProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/FlareProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/FlareProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -9,7 +9,7 @@
 {
 public:
 	CR_DECLARE(CFlareProjectile);
-	CFlareProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner,int activateFrame);
+	CFlareProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner,int activateFrame GML_PARG_H);
 	~CFlareProjectile();
 	void Update(void);
 	void Draw(void);

Modified: trunk/rts/Sim/Projectiles/PieceProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/PieceProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/PieceProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -58,8 +58,8 @@
 	}
 }
 
-CPieceProjectile::CPieceProjectile(const float3&amp; pos, const float3&amp; speed, LocalS3DO* piece, int f, CUnit* owner, float radius):
-	CProjectile(pos, speed, owner, true),
+CPieceProjectile::CPieceProjectile(const float3&amp; pos, const float3&amp; speed, LocalS3DO* piece, int f, CUnit* owner, float radius GML_PARG_C):
+	CProjectile(pos, speed, owner, true GML_PARG_P),
 	dispList(piece? piece-&gt;displist: 0),
 	drawTrail(true),
 	oldSmoke(pos),

Modified: trunk/rts/Sim/Projectiles/PieceProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/PieceProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/PieceProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -46,7 +46,7 @@
 	int colorTeam;
 	
 public:
-	CPieceProjectile(const float3&amp; pos, const float3&amp; speed, LocalS3DO* piece, int flags, CUnit* owner, float radius);
+	CPieceProjectile(const float3&amp; pos, const float3&amp; speed, LocalS3DO* piece, int flags, CUnit* owner, float radius GML_PARG_H);
 	virtual ~CPieceProjectile(void);
 	void Update();
 	void Draw();

Modified: trunk/rts/Sim/Projectiles/Projectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Projectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Projectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -23,8 +23,8 @@
 	CR_MEMBER(castShadow),
 	CR_MEMBER(owner),
 	CR_MEMBER(synced),
-	CR_MEMBER(drawPos),
-	CR_RESERVED(4),
+//	CR_MEMBER(drawPos),
+//	CR_RESERVED(4),
 	CR_MEMBER_BEGINFLAG(CM_Config),
 		CR_MEMBER(speed),
 	CR_MEMBER_ENDFLAG(CM_Config),
@@ -45,13 +45,11 @@
 	s3domodel(0),
 	collisionFlags(0)
 {
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_SIMDRAW
-	lastProjUpdate=gu-&gt;lastFrameStart;
-#endif
+	GML_GET_TICKS(lastProjUpdate);
 }
 
 
-void CProjectile::Init(const float3&amp; explosionPos, CUnit* owner)
+void CProjectile::Init(const float3&amp; explosionPos, CUnit* owner GML_PARG_C)
 {
 	pos += explosionPos;
 	SetRadius(1.7f);
@@ -63,7 +61,7 @@
 }
 
 
-CProjectile::CProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner, bool synced, bool weapon)
+CProjectile::CProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner, bool synced, bool weapon GML_PARG_C)
 :	CExpGenSpawnable(pos),
 	owner(owner),
 	speed(speed),
@@ -80,6 +78,8 @@
 
 	if (owner)
 		AddDeathDependence(owner);
+
+	GML_GET_TICKS(lastProjUpdate);
 }
 
 CProjectile::~CProjectile()

Modified: trunk/rts/Sim/Projectiles/Projectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Projectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Projectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -33,14 +33,14 @@
 
 	virtual void Draw();
 	CProjectile(); // default constructor is needed for creg
-	CProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner, bool synced, bool weapon = false);
+	CProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner, bool synced, bool weapon = false GML_PARG_H);
 	virtual void Collision();
 	virtual void Collision(CUnit* unit);
 	virtual void Collision(CFeature* feature);
 	virtual ~CProjectile();
 	virtual void Update();
 	void DependentDied(CObject* o);
-	virtual void Init(const float3&amp; pos, CUnit* owner);
+	virtual void Init(const float3&amp; pos, CUnit* owner GML_PARG_H);
 
 	bool synced;
 	bool weapon;

Modified: trunk/rts/Sim/Projectiles/ProjectileHandler.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/ProjectileHandler.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/ProjectileHandler.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -406,6 +406,8 @@
 
 	SCOPED_TIMER(&quot;Projectile handler&quot;);
 
+	GML_UPDATE_TICKS();
+
 	Projectile_List::iterator psi = ps.begin();
 	while (psi != ps.end()) {
 		CProjectile* p = *psi;
@@ -429,9 +431,7 @@
 			delete p;
 		} else {
 			p-&gt;Update();
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_SIMDRAW
-			p-&gt;lastProjUpdate=gu-&gt;lastFrameStart;
-#endif
+			GML_GET_TICKS(p-&gt;lastProjUpdate);
 			++psi;
 		}
 	}
@@ -719,7 +719,7 @@
 
 void CProjectileHandler::AddProjectile(CProjectile* p)
 {
-	GML_RECMUTEX_LOCK(proj); // AddProjectile
+//	GML_RECMUTEX_LOCK(proj); // AddProjectile
 
 	ps.push_back(p);
 
@@ -843,7 +843,7 @@
 
 void CProjectileHandler::AddGroundFlash(CGroundFlash* flash)
 {
-	GML_RECMUTEX_LOCK(proj); // AddGroundFlash
+//	GML_RECMUTEX_LOCK(proj); // AddGroundFlash
 	groundFlashes.push_back(flash);
 }
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -81,9 +81,9 @@
 		deleteMe = true;
 }
 
-void CBitmapMuzzleFlame::Init(const float3 &amp;pos, CUnit *owner)
+void CBitmapMuzzleFlame::Init(const float3 &amp;pos, CUnit *owner GML_PARG_C)
 {
-	CProjectile::Init(pos, owner);
+	CProjectile::Init(pos, owner GML_PARG_P);
 	life = 0;
 	createTime = gs-&gt;frameNum;
 	invttl = 1.0f/(float)ttl;

Modified: trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/BitmapMuzzleFlame.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -13,7 +13,7 @@
 	~CBitmapMuzzleFlame(void);
 	void Draw(void);
 	void Update(void);
-	virtual void Init(const float3 &amp;pos, CUnit *owner);
+	virtual void Init(const float3 &amp;pos, CUnit *owner GML_PARG_H);
 
 	AtlasedTexture *sideTexture;
 	AtlasedTexture *frontTexture;

Modified: trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -19,8 +19,8 @@
 	));
 
 
-CBubbleProjectile::CBubbleProjectile(float3 pos,float3 speed,float ttl,float startSize,float sizeExpansion, CUnit* owner, float alpha)
-: CProjectile(pos,speed,owner, false),
+CBubbleProjectile::CBubbleProjectile(float3 pos,float3 speed,float ttl,float startSize,float sizeExpansion, CUnit* owner, float alpha GML_PARG_C)
+: CProjectile(pos,speed,owner, false GML_PARG_P),
 	alpha(alpha),
 	startSize(startSize),
 	size(startSize*0.4f),

Modified: trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/BubbleProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -8,7 +8,7 @@
 {
 	CR_DECLARE(CBubbleProjectile);
 public:
-	CBubbleProjectile(float3 pos,float3 speed,float ttl,float startSize,float sizeExpansion, CUnit* owner,float alpha);
+	CBubbleProjectile(float3 pos,float3 speed,float ttl,float startSize,float sizeExpansion, CUnit* owner,float alpha GML_PARG_H);
 	virtual ~CBubbleProjectile();
 	void Update();
 	void Draw();

Modified: trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -32,8 +32,8 @@
 // Construction/Destruction
 //////////////////////////////////////////////////////////////////////
 
-CDirtProjectile::CDirtProjectile(const float3 pos,const float3 speed,const float ttl,const float size,const float expansion,float slowdown,CUnit* owner,const float3&amp; color)
-: CProjectile(pos,speed,owner, false),
+CDirtProjectile::CDirtProjectile(const float3 pos,const float3 speed,const float ttl,const float size,const float expansion,float slowdown,CUnit* owner,const float3&amp; color GML_PARG_C)
+: CProjectile(pos,speed,owner, false GML_PARG_P),
 	alpha(255),
 	size(size),
 	sizeExpansion(expansion),

Modified: trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/DirtProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -16,7 +16,7 @@
 	virtual void Draw();
 	virtual void Update();
 	CDirtProjectile();
-	CDirtProjectile(const float3 pos,const float3 speed,const float ttl,const float size,const float expansion,float slowdown,CUnit* owner,const float3&amp; color);
+	CDirtProjectile(const float3 pos,const float3 speed,const float ttl,const float size,const float expansion,float slowdown,CUnit* owner,const float3&amp; color GML_PARG_H);
 	virtual ~CDirtProjectile();
 
 	float alpha;

Modified: trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -28,8 +28,8 @@
 	synced=false;
 }
 
-CExploSpikeProjectile::CExploSpikeProjectile(const float3&amp; pos,const float3&amp; speed,float length,float width,float alpha,float alphaDecay,CUnit* owner)
-:	CProjectile(pos,speed,owner, false),
+CExploSpikeProjectile::CExploSpikeProjectile(const float3&amp; pos,const float3&amp; speed,float length,float width,float alpha,float alphaDecay,CUnit* owner GML_PARG_C)
+:	CProjectile(pos,speed,owner, false GML_PARG_P),
 	length(length),
 	width(width),
 	alpha(alpha),
@@ -86,9 +86,9 @@
 	va-&gt;AddVertexTC(drawPos-l+w, ph-&gt;laserendtex.xstart, ph-&gt;laserendtex.yend, col);
 }
 
-void CExploSpikeProjectile::Init(const float3&amp; pos, CUnit *owner)
+void CExploSpikeProjectile::Init(const float3&amp; pos, CUnit *owner GML_PARG_C)
 {
-	CProjectile::Init(pos, owner);
+	CProjectile::Init(pos, owner GML_PARG_P);
 
 	lengthGrowth=dir.Length()*(0.5f+gu-&gt;usRandFloat()*0.4f);
 	dir/=lengthGrowth;

Modified: trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/ExploSpikeProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -9,7 +9,7 @@
 	CR_DECLARE(CExploSpikeProjectile);
 public:
 	CExploSpikeProjectile();
-	CExploSpikeProjectile(const float3&amp; pos,const float3&amp; speed,float length,float width,float alpha,float alphaDecay,CUnit* owner);
+	CExploSpikeProjectile(const float3&amp; pos,const float3&amp; speed,float length,float width,float alpha,float alphaDecay,CUnit* owner GML_PARG_H);
 	~CExploSpikeProjectile(void);
 	void Update(void);
 	void Draw(void);
@@ -22,7 +22,7 @@
 	float3 dir;
 	float3 color;
 
-	virtual void Init(const float3&amp; pos, CUnit *owner);
+	virtual void Init(const float3&amp; pos, CUnit *owner GML_PARG_H);
 };
 
 #endif

Modified: trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -24,8 +24,8 @@
 	CR_RESERVED(8)
 	));
 
-CGenericParticleProjectile::CGenericParticleProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner) :
-	CProjectile(pos, speed, owner, false)
+CGenericParticleProjectile::CGenericParticleProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner GML_PARG_C) :
+	CProjectile(pos, speed, owner, false GML_PARG_P)
 {
 	deleteMe=false;
 	checkCol=false;

Modified: trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/GenericParticleProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -9,7 +9,7 @@
 {
 	CR_DECLARE(CGenericParticleProjectile);
 public:
-	CGenericParticleProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner);
+	CGenericParticleProjectile(const float3&amp; pos,const float3&amp; speed,CUnit* owner GML_PARG_H);
 	~CGenericParticleProjectile(void);
 
 	virtual void Update();

Modified: trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -23,8 +23,8 @@
 	CR_RESERVED(8)
 	));
 
-CGeoSquareProjectile::CGeoSquareProjectile(const float3&amp; p1,const float3&amp; p2,const float3&amp; v1,const float3&amp; v2,float w1,float w2)
-: CProjectile((p1+p2)*0.5f,ZeroVector,0, false),
+CGeoSquareProjectile::CGeoSquareProjectile(const float3&amp; p1,const float3&amp; p2,const float3&amp; v1,const float3&amp; v2,float w1,float w2 GML_PARG_C)
+: CProjectile((p1+p2)*0.5f,ZeroVector,0, false GML_PARG_P),
 	p1(p1),
 	p2(p2),
 	v1(v1),

Modified: trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/GeoSquareProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -7,7 +7,7 @@
 {
 	CR_DECLARE(CGeoSquareProjectile);
 public:
-	CGeoSquareProjectile(const float3&amp; p1,const float3&amp; p2,const float3&amp; v1,const float3&amp; v2,float w1,float w2);
+	CGeoSquareProjectile(const float3&amp; p1,const float3&amp; p2,const float3&amp; v1,const float3&amp; v2,float w1,float w2 GML_PARG_H);
 	virtual ~CGeoSquareProjectile(void);
 
 	float3 p1,p2,v1,v2;

Modified: trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -12,8 +12,8 @@
 	CR_RESERVED(8)
 	));
 
-CGeoThermSmokeProjectile::CGeoThermSmokeProjectile(const float3&amp; pos,const float3&amp; speed,int ttl, CFeature* geo)
-: CSmokeProjectile(pos,speed,ttl,6,0.35f,0,0.8f), geo(geo)
+CGeoThermSmokeProjectile::CGeoThermSmokeProjectile(const float3&amp; pos,const float3&amp; speed,int ttl, CFeature* geo GML_PARG_C)
+: CSmokeProjectile(pos,speed,ttl,6,0.35f,0,0.8f GML_PARG_P), geo(geo)
 {}
 
 void CGeoThermSmokeProjectile::Update()

Modified: trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/GeoThermSmokeProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -9,7 +9,7 @@
 {
 	CR_DECLARE(CGeoThermSmokeProjectile)
 public:
-	CGeoThermSmokeProjectile(const float3&amp; pos,const float3&amp; speed,int ttl,CFeature *geo);
+	CGeoThermSmokeProjectile(const float3&amp; pos,const float3&amp; speed,int ttl,CFeature *geo GML_PARG_H);
 	void Update();
 	CFeature *geo;
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -35,8 +35,8 @@
 	synced=false;
 }
 
-CGfxProjectile::CGfxProjectile(const float3&amp; pos,const float3&amp; speed,int lifeTime,const float3&amp; color)
-: CProjectile(pos,speed,0, false),
+CGfxProjectile::CGfxProjectile(const float3&amp; pos,const float3&amp; speed,int lifeTime,const float3&amp; color GML_PARG_C)
+: CProjectile(pos,speed,0, false GML_PARG_P),
 	lifeTime(lifeTime),
 	creationTime(gs-&gt;frameNum)
 {

Modified: trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/GfxProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -14,7 +14,7 @@
 	void Update();
 	void Draw();
 	CGfxProjectile();
-	CGfxProjectile(const float3&amp; pos,const float3&amp; speed,int lifeTime,const float3&amp; color);
+	CGfxProjectile(const float3&amp; pos,const float3&amp; speed,int lifeTime,const float3&amp; color GML_PARG_H);
 	virtual ~CGfxProjectile();
 
 	int creationTime;

Modified: trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -40,8 +40,8 @@
 	texture = &amp;ph-&gt;heatcloudtex;
 }
 
-CHeatCloudProjectile::CHeatCloudProjectile(const float3 pos,const float3 speed,const  float temperature,const float size, CUnit* owner)
-: CProjectile(pos,speed,owner, false),
+CHeatCloudProjectile::CHeatCloudProjectile(const float3 pos,const float3 speed,const  float temperature,const float size, CUnit* owner GML_PARG_C)
+: CProjectile(pos,speed,owner, false GML_PARG_P),
 	heat(temperature),
 	maxheat(temperature),
 	heatFalloff(1),

Modified: trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/HeatCloudProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -15,7 +15,7 @@
 	virtual void Draw();
 	virtual void Update();
 	CHeatCloudProjectile();
-	CHeatCloudProjectile(const float3 pos,const float3 speed,const float temperature,const float size, CUnit* owner);  //projectile start at size 0 and ends at size size
+	CHeatCloudProjectile(const float3 pos,const float3 speed,const float temperature,const float size, CUnit* owner GML_PARG_H);  //projectile start at size 0 and ends at size size
 	virtual ~CHeatCloudProjectile();
 
 	float heat;

Modified: trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -26,8 +26,8 @@
 //	s.Serialize(randSmokeDir, numSmoke*sizeof(float3));
 }
 
-CMuzzleFlame::CMuzzleFlame(const float3&amp; pos,const float3&amp; speed,const float3&amp; dir,float size)
-: CProjectile(pos,speed,0, false),
+CMuzzleFlame::CMuzzleFlame(const float3&amp; pos,const float3&amp; speed,const float3&amp; dir,float size GML_PARG_C)
+: CProjectile(pos,speed,0, false GML_PARG_P),
 	size(size),
 	dir(dir),
 	age(0)

Modified: trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/MuzzleFlame.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -10,7 +10,7 @@
 
 	void creg_Serialize(creg::ISerializer&amp; s);
 public:
-	CMuzzleFlame(const float3&amp; pos,const float3&amp; speed,const float3&amp; dir,float size);
+	CMuzzleFlame(const float3&amp; pos,const float3&amp; speed,const float3&amp; dir,float size GML_PARG_H);
 	~CMuzzleFlame(void);
 
 	void Draw(void);

Modified: trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -19,8 +19,8 @@
 	CR_RESERVED(8)
 	));
 
-CRepulseGfx::CRepulseGfx(CUnit* owner,CProjectile* repulsed,float maxDist,float3 color)
-: CProjectile(repulsed?repulsed-&gt;pos:float3(0,0,0),repulsed?repulsed-&gt;speed:float3(0,0,0),owner, false),
+CRepulseGfx::CRepulseGfx(CUnit* owner,CProjectile* repulsed,float maxDist,float3 color GML_PARG_C)
+: CProjectile(repulsed?repulsed-&gt;pos:float3(0,0,0),repulsed?repulsed-&gt;speed:float3(0,0,0),owner, false GML_PARG_P),
 	repulsed(repulsed),
 	age(0),
 	sqMaxDist(maxDist*maxDist+100),

Modified: trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/RepulseGfx.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -10,7 +10,7 @@
 {
 	CR_DECLARE(CRepulseGfx);
 public:
-	CRepulseGfx(CUnit* owner,CProjectile* repulsed,float maxDist,float3 color);
+	CRepulseGfx(CUnit* owner,CProjectile* repulsed,float maxDist,float3 color GML_PARG_H);
 	~CRepulseGfx(void);
 
 	void DependentDied(CObject* o);

Modified: trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -22,8 +22,8 @@
 
 CShieldPartProjectile::CShieldPartProjectile(
 	const float3&amp; centerPos, int xpart, int ypart, float sphereSize,
-	float3 color, float alpha, AtlasedTexture* texture, CUnit* owner):
-	CProjectile(centerPos, ZeroVector, owner, false),
+	float3 color, float alpha, AtlasedTexture* texture, CUnit* owner GML_PARG_C):
+	CProjectile(centerPos, ZeroVector, owner, false GML_PARG_P),
 	centerPos(centerPos),
 	sphereSize(sphereSize),
 	baseAlpha(alpha),

Modified: trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/ShieldPartProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -10,7 +10,7 @@
 {
 	CR_DECLARE(CShieldPartProjectile);
 public:
-	CShieldPartProjectile(const float3&amp; centerPos,int xpart,int ypart,float size,float3 color,float alpha, AtlasedTexture *texture,CUnit* owner);
+	CShieldPartProjectile(const float3&amp; centerPos,int xpart,int ypart,float size,float3 color,float alpha, AtlasedTexture *texture,CUnit* owner GML_PARG_H);
 	~CShieldPartProjectile(void);
 	void Draw(void);
 	void Update(void);

Modified: trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -140,9 +140,9 @@
 
 }
 
-void CSimpleParticleSystem::Init(const float3&amp; explosionPos, CUnit *owner)
+void CSimpleParticleSystem::Init(const float3&amp; explosionPos, CUnit *owner GML_PARG_C)
 {
-	CProjectile::Init(explosionPos, owner);
+	CProjectile::Init(explosionPos, owner GML_PARG_P);
 
 	particles = new Particle[numParticles];
 

Modified: trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SimpleParticleSystem.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -16,7 +16,7 @@
 
 	CSimpleParticleSystem(void);
 	virtual ~CSimpleParticleSystem(void);
-	virtual void Init(const float3&amp; explosionPos, CUnit *owner);
+	virtual void Init(const float3&amp; explosionPos, CUnit *owner GML_PARG_H);
 
 	float3 emitVector;
 	float3 emitMul;

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -41,7 +41,7 @@
 	synced=false;
 }
 
-void CSmokeProjectile::Init(const float3&amp; pos, CUnit *owner)
+void CSmokeProjectile::Init(const float3&amp; pos, CUnit *owner GML_PARG_C)
 {
 	textureNum=(int)(gu-&gt;usRandInt() % ph-&gt;smoketex.size());
 
@@ -51,11 +51,11 @@
 	if(!owner)
 		alwaysVisible=true;
 
-	CProjectile::Init(pos, owner);
+	CProjectile::Init(pos, owner GML_PARG_P);
 }
 
-CSmokeProjectile::CSmokeProjectile(const float3&amp; pos,const float3&amp; speed,float ttl,float startSize,float sizeExpansion, CUnit* owner, float color)
-: CProjectile(pos, speed, owner, false),
+CSmokeProjectile::CSmokeProjectile(const float3&amp; pos,const float3&amp; speed,float ttl,float startSize,float sizeExpansion, CUnit* owner, float color GML_PARG_C)
+: CProjectile(pos, speed, owner, false GML_PARG_P),
 	color(color),
 	age(0),
 	startSize(startSize),

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -13,9 +13,9 @@
 
 	void Update();
 	void Draw();
-	void Init(const float3&amp; pos, CUnit *owner);
+	void Init(const float3&amp; pos, CUnit *owner GML_PARG_H);
 	CSmokeProjectile();
-	CSmokeProjectile(const float3&amp; pos,const float3&amp; speed,float ttl,float startSize,float sizeExpansion, CUnit* owner,float color=0.7f);
+	CSmokeProjectile(const float3&amp; pos,const float3&amp; speed,float ttl,float startSize,float sizeExpansion, CUnit* owner,float color=0.7f GML_PARG_H);
 	virtual ~CSmokeProjectile();
 
 	float color;

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -44,7 +44,7 @@
 	synced=false;
 }
 
-void CSmokeProjectile2::Init(const float3&amp; pos, CUnit *owner)
+void CSmokeProjectile2::Init(const float3&amp; pos, CUnit *owner GML_PARG_C)
 {
 	textureNum=(int)(gu-&gt;usRandInt() % ph-&gt;smoketex.size());
 
@@ -56,11 +56,11 @@
 
 	wantedPos += pos;
 
-	CProjectile::Init(pos, owner);
+	CProjectile::Init(pos, owner GML_PARG_P);
 }
 
-CSmokeProjectile2::CSmokeProjectile2(float3 pos,float3 wantedPos,float3 speed,float ttl,float startSize,float sizeExpansion, CUnit* owner, float color)
-: CProjectile(pos,speed,owner, false),
+CSmokeProjectile2::CSmokeProjectile2(float3 pos,float3 wantedPos,float3 speed,float ttl,float startSize,float sizeExpansion, CUnit* owner, float color GML_PARG_C)
+: CProjectile(pos,speed,owner, false GML_PARG_P),
 	wantedPos(wantedPos),
 	color(color),
 	age(0),

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeProjectile2.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -13,9 +13,9 @@
 
 	void Update();
 	void Draw();
-	void Init(const float3&amp; pos, CUnit *owner);
+	void Init(const float3&amp; pos, CUnit *owner GML_PARG_H);
 	CSmokeProjectile2();
-	CSmokeProjectile2(float3 pos,float3 wantedPos,float3 speed,float ttl,float startSize,float sizeExpansion, CUnit* owner,float color=0.7f);
+	CSmokeProjectile2(float3 pos,float3 wantedPos,float3 speed,float ttl,float startSize,float sizeExpansion, CUnit* owner,float color=0.7f GML_PARG_H);
 	virtual ~CSmokeProjectile2();
 
 	float color;

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -45,8 +45,8 @@
 // Construction/Destruction
 //////////////////////////////////////////////////////////////////////
 
-CSmokeTrailProjectile::CSmokeTrailProjectile(const float3&amp; pos1,const float3&amp; pos2,const float3&amp; dir1,const float3&amp; dir2, CUnit* owner,bool firstSegment,bool lastSegment,float size,float time,float color,bool drawTrail,CProjectile* drawCallback,AtlasedTexture* texture)
-: CProjectile((pos1+pos2)*0.5f,ZeroVector,owner, false),
+CSmokeTrailProjectile::CSmokeTrailProjectile(const float3&amp; pos1,const float3&amp; pos2,const float3&amp; dir1,const float3&amp; dir2, CUnit* owner,bool firstSegment,bool lastSegment,float size,float time,float color,bool drawTrail,CProjectile* drawCallback,AtlasedTexture* texture GML_PARG_C)
+: CProjectile((pos1+pos2)*0.5f,ZeroVector,owner, false GML_PARG_P),
 	pos1(pos1),
 	pos2(pos2),
 	creationTime(gs-&gt;frameNum),

Modified: trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SmokeTrailProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -14,7 +14,7 @@
 public:
 	void Update();
 	void Draw();
-	CSmokeTrailProjectile(const float3&amp; pos1,const float3&amp; pos2,const float3&amp; dir1,const float3&amp; dir2, CUnit* owner,bool firstSegment,bool lastSegment,float size=1,float time=80,float color=0.7f,bool drawTrail=true,CProjectile* drawCallback=0,AtlasedTexture* texture=0);
+	CSmokeTrailProjectile(const float3&amp; pos1,const float3&amp; pos2,const float3&amp; dir1,const float3&amp; dir2, CUnit* owner,bool firstSegment,bool lastSegment,float size=1,float time=80,float color=0.7f,bool drawTrail=true,CProjectile* drawCallback=0,AtlasedTexture* texture=0 GML_PARG_H);
 	virtual ~CSmokeTrailProjectile();
 
 	float3 pos1;

Modified: trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -29,8 +29,8 @@
 	CR_RESERVED(16)
 	));
 
-CSpherePartProjectile::CSpherePartProjectile(const float3&amp; centerPos,int xpart,int ypart,float expansionSpeed,float alpha,int ttl,CUnit* owner,const float3 &amp;color)
-: CProjectile(centerPos,ZeroVector,owner, false),
+CSpherePartProjectile::CSpherePartProjectile(const float3&amp; centerPos,int xpart,int ypart,float expansionSpeed,float alpha,int ttl,CUnit* owner,const float3 &amp;color GML_PARG_C)
+: CProjectile(centerPos,ZeroVector,owner, false GML_PARG_P),
 	centerPos(centerPos),
 	expansionSpeed(expansionSpeed),
 	sphereSize(expansionSpeed),
@@ -129,9 +129,9 @@
 	CR_MEMBER_ENDFLAG(CM_Config)
 ));
 
-void CSpherePartSpawner::Init(const float3&amp; pos, CUnit *owner)
+void CSpherePartSpawner::Init(const float3&amp; pos, CUnit *owner GML_PARG_C)
 {
-	CProjectile::Init(pos, owner);
+	CProjectile::Init(pos, owner GML_PARG_P);
 	deleteMe = true;
 	CSpherePartProjectile::CreateSphere(pos, alpha, ttl, expansionSpeed, owner, color);
 }

Modified: trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -8,7 +8,7 @@
 {
 	CR_DECLARE(CSpherePartProjectile);
 public:
-	CSpherePartProjectile(const float3&amp; centerPos,int xpart,int ypart,float expansionSpeed,float alpha,int ttl,CUnit* owner,const float3 &amp;color);
+	CSpherePartProjectile(const float3&amp; centerPos,int xpart,int ypart,float expansionSpeed,float alpha,int ttl,CUnit* owner,const float3 &amp;color GML_PARG_H);
 	~CSpherePartProjectile(void);
 
 	float3 centerPos;
@@ -44,7 +44,7 @@
 	CSpherePartSpawner();
 	~CSpherePartSpawner();
 
-	virtual void Init(const float3&amp; pos, CUnit *owner);
+	virtual void Init(const float3&amp; pos, CUnit *owner GML_PARG_H);
 };
 
 #endif /* SPHEREPARTPROJECTILE_H */

Modified: trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -26,8 +26,8 @@
 // Construction/Destruction
 //////////////////////////////////////////////////////////////////////
 
-CTracerProjectile::CTracerProjectile(const float3 pos, const float3 speed,const float range,CUnit* owner)
-: CProjectile(pos,speed,owner, false)
+CTracerProjectile::CTracerProjectile(const float3 pos, const float3 speed,const float range,CUnit* owner GML_PARG_C)
+: CProjectile(pos,speed,owner, false GML_PARG_P)
 {
 	SetRadius(1);
 	speedf=this-&gt;speed.Length();
@@ -44,13 +44,13 @@
 	checkCol=false;
 }
 
-void CTracerProjectile::Init(const float3&amp; pos, CUnit* owner)
+void CTracerProjectile::Init(const float3&amp; pos, CUnit* owner GML_PARG_C)
 {
 	speedf=this-&gt;speed.Length();
 	if (speedf==0.0f) speed=float3(1.0f,0.0f,0.0f);
 	dir=this-&gt;speed/speedf;
 
-	CProjectile::Init (pos, owner);
+	CProjectile::Init (pos, owner GML_PARG_P);
 }
 
 CTracerProjectile::~CTracerProjectile()

Modified: trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/TracerProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -13,9 +13,9 @@
 
 	void Draw();
 	void Update();
-	void Init(const float3&amp; pos, CUnit *owner);
+	void Init(const float3&amp; pos, CUnit *owner GML_PARG_H);
 	CTracerProjectile();
-	CTracerProjectile(const float3 pos,const float3 speed,const float range,CUnit* owner);
+	CTracerProjectile(const float3 pos,const float3 speed,const float range,CUnit* owner GML_PARG_H);
 	virtual ~CTracerProjectile();
 	float speedf;
 	float length;

Modified: trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -28,8 +28,8 @@
 // Construction/Destruction
 //////////////////////////////////////////////////////////////////////
 
-CWakeProjectile::CWakeProjectile(const float3 pos,const float3 speed,float startSize,float sizeExpansion, CUnit* owner, float alpha,float alphaFalloff,float fadeupTime)
-: CProjectile(pos,speed,owner, false),
+CWakeProjectile::CWakeProjectile(const float3 pos,const float3 speed,float startSize,float sizeExpansion, CUnit* owner, float alpha,float alphaFalloff,float fadeupTime GML_PARG_C)
+: CProjectile(pos,speed,owner, false GML_PARG_P),
 	alpha(0),
 	alphaAdd(alpha/fadeupTime),
 	alphaAddTime((int)fadeupTime),

Modified: trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/WakeProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -8,7 +8,7 @@
 {
 	CR_DECLARE(CWakeProjectile);
 public:
-	CWakeProjectile(const float3 pos,const float3 speed,float startSize,float sizeExpansion, CUnit* owner,float alpha,float alphaFalloff,float fadeupTime);
+	CWakeProjectile(const float3 pos,const float3 speed,float startSize,float sizeExpansion, CUnit* owner,float alpha,float alphaFalloff,float fadeupTime GML_PARG_H);
 	virtual ~CWakeProjectile();
 	void Update();
 	void Draw();

Modified: trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -25,8 +25,8 @@
 // Construction/Destruction
 //////////////////////////////////////////////////////////////////////
 
-CWreckProjectile::CWreckProjectile(float3 pos,float3 speed,float temperature,CUnit* owner)
-: CProjectile(pos,speed,owner, false)
+CWreckProjectile::CWreckProjectile(float3 pos,float3 speed,float temperature,CUnit* owner GML_PARG_C)
+: CProjectile(pos,speed,owner, false GML_PARG_P)
 {
 	checkCol=false;
 	drawRadius=2;

Modified: trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/Unsynced/WreckProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -11,7 +11,7 @@
 public:
 	CR_DECLARE(CWreckProjectile);
 	void Update();
-	CWreckProjectile(float3 pos,float3 speed,float temperature,CUnit* owner);
+	CWreckProjectile(float3 pos,float3 speed,float temperature,CUnit* owner GML_PARG_H);
 	virtual ~CWreckProjectile();
 
 	void Draw(void);

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/BeamLaserProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/BeamLaserProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/BeamLaserProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -29,9 +29,9 @@
 CBeamLaserProjectile::CBeamLaserProjectile(const float3&amp; startPos, const float3&amp; endPos,
 	float startAlpha, float endAlpha, const float3&amp; color, const float3&amp; color2,
 	CUnit* owner, float thickness, float corethickness, float flaresize,
-	const WeaponDef* weaponDef, int ttl, float decay):
+	const WeaponDef* weaponDef, int ttl, float decay GML_PARG_C):
 
-	CWeaponProjectile((startPos + endPos) * 0.5f, ZeroVector, owner, 0, ZeroVector, weaponDef, 0, false,  ttl),
+	CWeaponProjectile((startPos + endPos) * 0.5f, ZeroVector, owner, 0, ZeroVector, weaponDef, 0, false,  ttl GML_PARG_P),
 	startPos(startPos),
 	endPos(endPos),
 	thickness(thickness),

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/BeamLaserProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/BeamLaserProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/BeamLaserProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -10,7 +10,7 @@
 	CBeamLaserProjectile(const float3&amp; startPos, const float3&amp; endPos,
 		float startAlpha, float endAlpha, const float3&amp; color, const float3&amp; color2,
 		CUnit* owner, float thickness, float corethickness, float flaresize,
-		const WeaponDef* weaponDef, int ttl, float decay);
+		const WeaponDef* weaponDef, int ttl, float decay GML_PARG_H);
 	~CBeamLaserProjectile(void);
 
 	float3 startPos;

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -20,8 +20,8 @@
 
 CEmgProjectile::CEmgProjectile(const float3&amp; pos, const float3&amp; speed,
 		CUnit* owner, const float3&amp; color, float intensity, int ttl,
-		const WeaponDef* weaponDef):
-	CWeaponProjectile(pos, speed, owner, 0, ZeroVector, weaponDef, 0, true,  ttl),
+		const WeaponDef* weaponDef GML_PARG_C):
+	CWeaponProjectile(pos, speed, owner, 0, ZeroVector, weaponDef, 0, true,  ttl GML_PARG_P),
 	color(color),
 	intensity(intensity)
 {

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/EmgProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -10,7 +10,7 @@
 	CR_DECLARE(CEmgProjectile);
 public:
 	CEmgProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner, const float3&amp; color,
-		float intensity, int ttl, const WeaponDef *weaponDef);
+		float intensity, int ttl, const WeaponDef *weaponDef GML_PARG_H);
 	virtual ~CEmgProjectile();
 	void Update(void);
 	void Draw(void);

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -34,8 +34,8 @@
 
 CExplosiveProjectile::CExplosiveProjectile(const float3&amp; pos,
 		const float3&amp; speed, CUnit* owner, const WeaponDef *weaponDef, int ttl,
-		float areaOfEffect, float gravity):
-	CWeaponProjectile(pos, speed, owner, 0, ZeroVector, weaponDef, 0, true,  ttl),
+		float areaOfEffect, float gravity GML_PARG_C):
+	CWeaponProjectile(pos, speed, owner, 0, ZeroVector, weaponDef, 0, true,  ttl GML_PARG_P),
 	areaOfEffect(areaOfEffect),
 	curTime(0),
 	gravity(gravity)

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/ExplosiveProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -14,7 +14,7 @@
 public:
 	CExplosiveProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner,
 		const WeaponDef *weaponDef, int ttl = 100000, float areaOfEffect = 8,
-		float gravity = 0);
+		float gravity = 0 GML_PARG_H);
 	virtual ~CExplosiveProjectile();
 	virtual void Update();
 	void Draw(void);

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -28,8 +28,8 @@
 	));
 
 CFireBallProjectile::CFireBallProjectile(const float3&amp; pos, const float3&amp; speed,
-		CUnit* owner, CUnit* target, const float3 &amp;targetPos, const WeaponDef* weaponDef):
-	CWeaponProjectile(pos, speed, owner, target, targetPos, weaponDef, 0, true,  1)
+		CUnit* owner, CUnit* target, const float3 &amp;targetPos, const WeaponDef* weaponDef GML_PARG_C):
+	CWeaponProjectile(pos, speed, owner, target, targetPos, weaponDef, 0, true,  1 GML_PARG_P)
 {
 	if (weaponDef) {
 		SetRadius(weaponDef-&gt;collisionSize);

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/FireBallProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -11,7 +11,7 @@
 	CR_DECLARE_SUB(Spark);
 public:
 	CFireBallProjectile(const float3&amp; pos,const float3&amp; speed, CUnit* owner,
-			CUnit *target, const float3 &amp;targetPos, const WeaponDef* weaponDef);
+			CUnit *target, const float3 &amp;targetPos, const WeaponDef* weaponDef GML_PARG_H);
 	~CFireBallProjectile(void);
 
 	void Draw();

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -25,8 +25,8 @@
 
 
 CFlameProjectile::CFlameProjectile(const float3&amp; pos, const float3&amp; speed, const float3&amp; spread,
-		CUnit* owner, const WeaponDef* weaponDef, int ttl):
-	CWeaponProjectile(pos, speed, owner, 0, ZeroVector, weaponDef, 0, true,  ttl),
+		CUnit* owner, const WeaponDef* weaponDef, int ttl GML_PARG_C):
+	CWeaponProjectile(pos, speed, owner, 0, ZeroVector, weaponDef, 0, true,  ttl GML_PARG_P),
 	color(color),
 	color2(color2),
 	intensity(intensity),

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/FlameProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -10,7 +10,7 @@
 	CR_DECLARE(CFlameProjectile);
 public:
 	CFlameProjectile(const float3&amp; pos, const float3&amp; speed, const float3&amp; spread,
-		CUnit* owner, const WeaponDef* weaponDef, int ttl = 50);
+		CUnit* owner, const WeaponDef* weaponDef, int ttl = 50 GML_PARG_H);
 	~CFlameProjectile(void);
 	float3 color;
 	float3 color2;

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -29,8 +29,8 @@
 	));
 
 CLargeBeamLaserProjectile::CLargeBeamLaserProjectile(const float3&amp; startPos, const float3&amp; endPos,
-		const float3&amp; color, const float3&amp; color2, CUnit* owner, const WeaponDef* weaponDef):
-	CWeaponProjectile(startPos + (endPos - startPos) * 0.5f, ZeroVector, owner, 0, ZeroVector, weaponDef, 0, false,  1),
+		const float3&amp; color, const float3&amp; color2, CUnit* owner, const WeaponDef* weaponDef GML_PARG_C):
+	CWeaponProjectile(startPos + (endPos - startPos) * 0.5f, ZeroVector, owner, 0, ZeroVector, weaponDef, 0, false,  1 GML_PARG_P),
 	startPos(startPos),
 	endPos(endPos),
 	decay(1.0f)

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/LargeBeamLaserProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -9,7 +9,7 @@
 	CR_DECLARE(CLargeBeamLaserProjectile);
 public:
 	CLargeBeamLaserProjectile(const float3&amp; startPos, const float3&amp; endPos, const float3&amp; color, const float3&amp; color2,
-		CUnit* owner, const WeaponDef* weaponDef);
+		CUnit* owner, const WeaponDef* weaponDef GML_PARG_H);
 	~CLargeBeamLaserProjectile(void);
 
 	float3 startPos;

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -33,8 +33,8 @@
 
 CLaserProjectile::CLaserProjectile(const float3&amp; pos, const float3&amp; speed,
 		CUnit* owner, float length, const float3&amp; color, const float3&amp; color2,
-		float intensity, const WeaponDef *weaponDef, int ttl)
-: CWeaponProjectile(pos,speed,owner,0,ZeroVector,weaponDef,0, true,  ttl),
+		float intensity, const WeaponDef *weaponDef, int ttl GML_PARG_C)
+: CWeaponProjectile(pos,speed,owner,0,ZeroVector,weaponDef,0, true,  ttl GML_PARG_P),
 	color(color),
 	color2(color2),
 	length(length),

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/LaserProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -11,7 +11,7 @@
 public:
 	CLaserProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner,float length,
 		const float3&amp; color, const float3&amp; color2, float intensity, const WeaponDef *weaponDef,
-		int ttl = 1000);
+		int ttl = 1000 GML_PARG_H);
 	virtual ~CLaserProjectile();
 	void Draw(void);
 	void Update(void);

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -26,8 +26,8 @@
 
 CLightingProjectile::CLightingProjectile(const float3&amp; pos, const float3&amp; end,
 		CUnit* owner, const float3&amp; color, const WeaponDef *weaponDef,
-		int ttl, CWeapon* weap):
-	CWeaponProjectile(pos, ZeroVector, owner, 0, ZeroVector, weaponDef, 0, true,  ttl),
+		int ttl, CWeapon* weap GML_PARG_C):
+	CWeaponProjectile(pos, ZeroVector, owner, 0, ZeroVector, weaponDef, 0, true,  ttl GML_PARG_P),
 	color(color),
 	endPos(end),
 	weapon(weap)

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/LightingProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -11,7 +11,7 @@
 	CR_DECLARE(CLightingProjectile);
 public:
 	CLightingProjectile(const float3&amp; pos, const float3&amp; end, CUnit* owner, const float3&amp; color,
-		const WeaponDef *weaponDef, int ttl = 10, CWeapon* weap = 0);
+		const WeaponDef *weaponDef, int ttl = 10, CWeapon* weap = 0 GML_PARG_H);
 	~CLightingProjectile(void);
 
 	float3 color;

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -57,8 +57,8 @@
 
 CMissileProjectile::CMissileProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner,
 		float areaOfEffect, float maxSpeed, int ttl, CUnit* target, const WeaponDef *weaponDef,
-		float3 targetPos):
-	CWeaponProjectile(pos, speed, owner, target, targetPos, weaponDef, 0, true,  ttl),
+		float3 targetPos GML_PARG_C):
+	CWeaponProjectile(pos, speed, owner, target, targetPos, weaponDef, 0, true,  ttl GML_PARG_P),
 	maxSpeed(maxSpeed),
 	target(target),
 	dir(speed),

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/MissileProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -14,7 +14,7 @@
 	void UpdateGroundBounce();
 public:
 	CMissileProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner, float areaOfEffect,
-		float maxSpeed, int ttl, CUnit* target, const WeaponDef *weaponDef, float3 targetPos);
+		float maxSpeed, int ttl, CUnit* target, const WeaponDef *weaponDef, float3 targetPos GML_PARG_H);
 	~CMissileProjectile(void);
 	void DependentDied(CObject* o);
 	void Collision(CUnit* unit);

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -56,8 +56,8 @@
 
 CStarburstProjectile::CStarburstProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner,
 		float3 targetPos, float areaOfEffect, float maxSpeed, float tracking, int uptime, CUnit* target,
-		const WeaponDef* weaponDef, CWeaponProjectile* interceptTarget, float maxdistance, float3 aimError):
-	CWeaponProjectile(pos, speed, owner, target, targetPos, weaponDef, interceptTarget, true,  200),
+		const WeaponDef* weaponDef, CWeaponProjectile* interceptTarget, float maxdistance, float3 aimError GML_PARG_C):
+	CWeaponProjectile(pos, speed, owner, target, targetPos, weaponDef, interceptTarget, true,  200 GML_PARG_P),
 	maxSpeed(maxSpeed),
 	tracking(tracking),
 	dir(speed),

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/StarburstProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -16,7 +16,7 @@
 	CStarburstProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner,
 			float3 targetPos,float areaOfEffect, float maxSpeed,float tracking,
 			int uptime, CUnit* target, const WeaponDef* weaponDef,
-			CWeaponProjectile* interceptTarget, float maxdistance, float3 aimError);
+			CWeaponProjectile* interceptTarget, float maxdistance, float3 aimError GML_PARG_H);
 	~CStarburstProjectile(void);
 	void Collision(CUnit* unit);
 	void Collision();

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -36,8 +36,8 @@
 
 CTorpedoProjectile::CTorpedoProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner,
 		float areaOfEffect, float maxSpeed, float tracking, int ttl, CUnit* target,
-		const WeaponDef *weaponDef):
-	CWeaponProjectile(pos, speed, owner, target, ZeroVector, weaponDef, 0, true,  ttl),
+		const WeaponDef *weaponDef GML_PARG_C):
+	CWeaponProjectile(pos, speed, owner, target, ZeroVector, weaponDef, 0, true,  ttl GML_PARG_P),
 	maxSpeed(maxSpeed),
 	tracking(tracking),
 	target(target),

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/TorpedoProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -10,7 +10,7 @@
 	CR_DECLARE(CTorpedoProjectile);
 public:
 	CTorpedoProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner, float areaOfEffect,
-		float maxSpeed, float tracking, int ttl, CUnit* target, const WeaponDef* weaponDef);
+		float maxSpeed, float tracking, int ttl, CUnit* target, const WeaponDef* weaponDef GML_PARG_H);
 	~CTorpedoProjectile(void);
 	void DependentDied(CObject* o);
 	void Collision(CUnit* unit);

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -64,8 +64,8 @@
 CWeaponProjectile::CWeaponProjectile(const float3&amp; pos, const float3&amp; speed,
 		CUnit* owner, CUnit* target, const float3 &amp;targetPos,
 		const WeaponDef* weaponDef, CWeaponProjectile* interceptTarget,
-		bool synced, int ttl):
-	CProjectile(pos, speed, owner, synced, true),
+		bool synced, int ttl GML_PARG_C):
+	CProjectile(pos, speed, owner, synced, true GML_PARG_P),
 	weaponDef(weaponDef),
 	weaponDefName(weaponDef? weaponDef-&gt;name: std::string(&quot;&quot;)),
 	target(target),

Modified: trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.h
===================================================================
--- trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Projectiles/WeaponProjectiles/WeaponProjectile.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -16,7 +16,7 @@
 	CWeaponProjectile();
 	CWeaponProjectile(const float3&amp; pos, const float3&amp; speed, CUnit* owner,
 			CUnit* target, const float3 &amp;targetPos, const WeaponDef *weaponDef,
-			CWeaponProjectile* interceptTarget, bool synced, int ttl = 1);
+			CWeaponProjectile* interceptTarget, bool synced, int ttl = 1 GML_PARG_H);
 	virtual ~CWeaponProjectile();
 
 	virtual void Collision();

Modified: trunk/rts/Sim/Units/Unit.cpp
===================================================================
--- trunk/rts/Sim/Units/Unit.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Units/Unit.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -237,9 +237,7 @@
 	directControl = NULL;
 #endif
 	activated = false;
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_SIMDRAW
-	lastUnitUpdate=gu-&gt;lastFrameStart;
-#endif
+	GML_GET_TICKS(lastUnitUpdate);
 }
 
 CUnit::~CUnit()
@@ -533,9 +531,7 @@
 	const bool oldInWater = inWater;
 
 	moveType-&gt;Update();
-#if defined(USE_GML) &amp;&amp; GML_ENABLE_SIMDRAW
-	lastUnitUpdate=gu-&gt;lastFrameStart;
-#endif
+	GML_GET_TICKS(lastUnitUpdate);
 
 	inAir   = ((pos.y + height) &gt;= 0.0f);
 	inWater =  (pos.y           &lt;= 0.0f);
@@ -2478,8 +2474,8 @@
 
 	CR_MEMBER(inAir),
 	CR_MEMBER(inWater),
-	CR_MEMBER(drawPos),
-	CR_RESERVED(4),
+//	CR_MEMBER(drawPos),
+//	CR_RESERVED(4),
 
 	CR_RESERVED(126),
 

Modified: trunk/rts/Sim/Units/UnitHandler.cpp
===================================================================
--- trunk/rts/Sim/Units/UnitHandler.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/Sim/Units/UnitHandler.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -38,6 +38,7 @@
 #include &quot;System/creg/STL_Deque.h&quot;
 #include &quot;System/creg/STL_List.h&quot;
 #include &quot;System/creg/STL_Set.h&quot;
+#include &quot;Rendering/UnitModels/UnitDrawer.h&quot;
 
 using std::min;
 using std::max;
@@ -103,7 +104,7 @@
 	CR_MEMBER(metalMakerEfficiency),
 	CR_MEMBER(toBeRemoved),
 	CR_MEMBER(morphUnitToFeature),
-	CR_MEMBER(toBeRemoved),
+//	CR_MEMBER(toBeRemoved),
 	CR_MEMBER(toBeAdded),
 	CR_MEMBER(renderUnits),
 	CR_MEMBER(builderCAIs),
@@ -273,6 +274,17 @@
 			break;
 		}
 	}
+
+#if defined(USE_GML) &amp;&amp; GML_ENABLE_SIMDRAW
+	for(int i=0, dcs=unitDrawer-&gt;drawCloaked.size(); i&lt;dcs; ++i)
+		if(unitDrawer-&gt;drawCloaked[i]==delUnit)
+			unitDrawer-&gt;drawCloaked[i]=NULL;
+
+	for(int i=0, dcs=unitDrawer-&gt;drawCloakedS3O.size(); i&lt;dcs; ++i)
+		if(unitDrawer-&gt;drawCloakedS3O[i]==delUnit)
+			unitDrawer-&gt;drawCloakedS3O[i]=NULL;
+#endif
+
 	toBeAdded.erase(delUnit);
 }
 
@@ -295,6 +307,8 @@
 		}
 	}
 
+	GML_UPDATE_TICKS();
+
 	std::list&lt;CUnit*&gt;::iterator usi;
 	for (usi = activeUnits.begin(); usi != activeUnits.end(); usi++) {
 		(*usi)-&gt;Update();

Modified: trunk/rts/lib/gml/gml.cpp
===================================================================
--- trunk/rts/lib/gml/gml.cpp	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/lib/gml/gml.cpp	2008-10-31 17:32:06 UTC (rev 6939)
@@ -63,6 +63,9 @@
 int gmlThreadCount=GML_CPU_COUNT; // number of threads to use
 int gmlItemsConsumed=0;
 
+int gmlNextTickUpdate=0;
+unsigned gmlCurrentTicks;
+
 // gmlCPUCount returns the number of CPU cores
 // it was taken from the latest version of boost
 // boost::thread::hardware_concurrency()
@@ -212,6 +215,7 @@
 boost::recursive_mutex grassmutex;
 boost::recursive_mutex guimutex;
 boost::recursive_mutex filemutex;
+boost::recursive_mutex &amp;qnummutex=quadmutex;
 #endif
 
 // GMLqueue implementation

Modified: trunk/rts/lib/gml/gml.h
===================================================================
--- trunk/rts/lib/gml/gml.h	2008-10-31 17:02:15 UTC (rev 6938)
+++ trunk/rts/lib/gml/gml.h	2008-10-31 17:32:06 UTC (rev 6939)
@@ -176,15 +176,46 @@
 extern boost::recursive_mutex grassmutex;
 extern boost::recursive_mutex guimutex;
 extern boost::recursive_mutex filemutex;
+extern boost::recursive_mutex &qnummutex;
 
 #define GML_STDMUTEX_LOCK(name) boost::mutex::scoped_lock name##lock(name##mutex)
 #define GML_RECMUTEX_LOCK(name) boost::recursive_mutex::scoped_lock name##lock(name##mutex)
 
+extern int gmlNextTickUpdate;
+extern unsigned gmlCurrentTicks;
+
+#include &lt;SDL_timer.h&gt;
+
+inline unsigned gmlUpdateTicks() {
+	gmlNextTickUpdate = 100;
+	return gmlCurrentTicks=SDL_GetTicks();
+}
+
+inline unsigned gmlGetTicks() {
+	if(--gmlNextTickUpdate &gt; 0)
+		return gmlCurrentTicks;
+	return gmlUpdateTicks();
+}
+
+#define GML_GET_TICKS(var) var=gmlGetTicks()
+#define GML_UPDATE_TICKS() gmlUpdateTicks()
+
+#define GML_PARG_H , boost::recursive_mutex::scoped_lock&amp; projlock = boost::recursive_mutex::scoped_lock(projmutex)
+#define GML_PARG_C , boost::recursive_mutex::scoped_lock&amp; projlock
+#define GML_PARG_P , projlock
+
 #else
 
 #define GML_STDMUTEX_LOCK(name)
 #define GML_RECMUTEX_LOCK(name)
 
+#define GML_GET_TICKS(var)
+#define GML_UPDATE_TICKS()
+
+#define GML_PARG_H
+#define GML_PARG_C
+#define GML_PARG_P
+
 #endif
 
 #else
@@ -195,6 +226,13 @@
 #define GML_STDMUTEX_LOCK(name)
 #define GML_RECMUTEX_LOCK(name)
 
+#define GML_GET_TICKS(var)
+#define GML_UPDATE_TICKS()
+
+#define GML_PARG_H
+#define GML_PARG_C
+#define GML_PARG_P
+
 #endif // USE_GML
 
 #endif


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001707.html">[Taspring-linux-commit] r6938 - trunk/tools/unitsync
</A></li>
	<LI>Next message: <A HREF="001709.html">[Taspring-linux-commit] r6940 - in trunk: rts/Game rts/System	tools/DedicatedServer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1708">[ date ]</a>
              <a href="thread.html#1708">[ thread ]</a>
              <a href="subject.html#1708">[ subject ]</a>
              <a href="author.html#1708">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
