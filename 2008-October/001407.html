<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6638 - in branches/caiinterface: . AI	AI/Interfaces AI/Interfaces/C AI/Skirmish AI/Skirmish/AAI	AI/Skirmish/KAIK-0.13 AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI-0.553	rts/ExternalAI/Interface	rts/ExternalAI/Interface/LegacyCppWrapper rts/Game	rts/Sim/Misc rts/Sim/MoveTypes rts/Sim/Units	rts/Sim/Units/CommandAI rts/System rts/System/Platform	rts/System/Platform/Win rts/System/creg rts/build/scons
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6638%20-%20in%20branches/caiinterface%3A%20.%20AI%0A%09AI/Interfaces%20AI/Interfaces/C%20AI/Skirmish%20AI/Skirmish/AAI%0A%09AI/Skirmish/KAIK-0.13%20AI/Skirmish/NullAI%0A%09AI/Skirmish/NullLegacyCppAI%20AI/Skirmish/RAI-0.553%0A%09rts/ExternalAI/Interface%0A%09rts/ExternalAI/Interface/LegacyCppWrapper%20rts/Game%0A%09rts/Sim/Misc%20rts/Sim/MoveTypes%20rts/Sim/Units%0A%09rts/Sim/Units/CommandAI%20rts/System%20rts/System/Platform%0A%09rts/System/Platform/Win%20rts/System/creg%20rts/build/scons&In-Reply-To=%3C20081009175543.AE10546EB%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001406.html">
   <LINK REL="Next"  HREF="001408.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6638 - in branches/caiinterface: . AI	AI/Interfaces AI/Interfaces/C AI/Skirmish AI/Skirmish/AAI	AI/Skirmish/KAIK-0.13 AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI-0.553	rts/ExternalAI/Interface	rts/ExternalAI/Interface/LegacyCppWrapper rts/Game	rts/Sim/Misc rts/Sim/MoveTypes rts/Sim/Units	rts/Sim/Units/CommandAI rts/System rts/System/Platform	rts/System/Platform/Win rts/System/creg rts/build/scons</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6638%20-%20in%20branches/caiinterface%3A%20.%20AI%0A%09AI/Interfaces%20AI/Interfaces/C%20AI/Skirmish%20AI/Skirmish/AAI%0A%09AI/Skirmish/KAIK-0.13%20AI/Skirmish/NullAI%0A%09AI/Skirmish/NullLegacyCppAI%20AI/Skirmish/RAI-0.553%0A%09rts/ExternalAI/Interface%0A%09rts/ExternalAI/Interface/LegacyCppWrapper%20rts/Game%0A%09rts/Sim/Misc%20rts/Sim/MoveTypes%20rts/Sim/Units%0A%09rts/Sim/Units/CommandAI%20rts/System%20rts/System/Platform%0A%09rts/System/Platform/Win%20rts/System/creg%20rts/build/scons&In-Reply-To=%3C20081009175543.AE10546EB%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6638 - in branches/caiinterface: . AI	AI/Interfaces AI/Interfaces/C AI/Skirmish AI/Skirmish/AAI	AI/Skirmish/KAIK-0.13 AI/Skirmish/NullAI	AI/Skirmish/NullLegacyCppAI AI/Skirmish/RAI-0.553	rts/ExternalAI/Interface	rts/ExternalAI/Interface/LegacyCppWrapper rts/Game	rts/Sim/Misc rts/Sim/MoveTypes rts/Sim/Units	rts/Sim/Units/CommandAI rts/System rts/System/Platform	rts/System/Platform/Win rts/System/creg rts/build/scons">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Thu Oct  9 19:55:43 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001406.html">[Taspring-linux-commit] r6637 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="001408.html">[Taspring-linux-commit] r6639 - in branches/caiinterface: .	AI/Skirmish Documentation installer	installer/freedesktop/applications installer/freedesktop/mime	installer/sections rts/Game rts/Game/Camera rts/Game/UI	rts/Rendering rts/Rendering/Env rts/Sim/Misc	rts/Sim/MoveTypes rts/Sim/Weapons tools/DedicatedServer	tools/springie tools/springie/Springie	tools/springie/Springie/Properties tools/springie/Springie/autohost	tools/springie/Springie/client tools/springie/Springie/doc	tools/springie/Springie/spring tools/springie/Springie/utils	tools/springie/libs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1407">[ date ]</a>
              <a href="thread.html#1407">[ thread ]</a>
              <a href="subject.html#1407">[ subject ]</a>
              <a href="author.html#1407">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-10-09 19:55:40 +0200 (Thu, 09 Oct 2008)
New Revision: 6638

Added:
   branches/caiinterface/AI/Interfaces/C/VERSION
   branches/caiinterface/AI/Skirmish/KAIK-0.13/VERSION
   branches/caiinterface/AI/Skirmish/NullAI/VERSION
   branches/caiinterface/AI/Skirmish/NullLegacyCppAI/VERSION
   branches/caiinterface/AI/Skirmish/RAI-0.553/VERSION
   branches/caiinterface/rts/System/creg/creg_cond.h
Modified:
   branches/caiinterface/AI/CMakeLists.txt
   branches/caiinterface/AI/Interfaces/C/Interface.cpp
   branches/caiinterface/AI/Interfaces/C/Interface.h
   branches/caiinterface/AI/Interfaces/C/InterfaceExport.h
   branches/caiinterface/AI/Interfaces/CMakeLists.txt
   branches/caiinterface/AI/Skirmish/AAI/aidef.h
   branches/caiinterface/AI/Skirmish/CMakeLists.txt
   branches/caiinterface/AI/Skirmish/NullAI/AIExport.h
   branches/caiinterface/SConstruct
   branches/caiinterface/rts/ExternalAI/Interface/LegacyCppWrapper/AIAICallback.cpp
   branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp
   branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
   branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp
   branches/caiinterface/rts/Game/GameVersion.cpp
   branches/caiinterface/rts/Sim/Misc/DamageArray.cpp
   branches/caiinterface/rts/Sim/Misc/DamageArray.h
   branches/caiinterface/rts/Sim/MoveTypes/MoveInfo.h
   branches/caiinterface/rts/Sim/Units/CommandAI/Command.h
   branches/caiinterface/rts/Sim/Units/UnitDef.h
   branches/caiinterface/rts/System/Platform/SharedLib.cpp
   branches/caiinterface/rts/System/Platform/Win/DllLib.cpp
   branches/caiinterface/rts/System/StdAfx.h
   branches/caiinterface/rts/System/float3.h
   branches/caiinterface/rts/build/scons/filelist.py
Log:
- cleaned up rts/Sim/Misc/DamageArray.* and some things under ExternalAI/Interface
- cleaned up scons (filelist.py and SConstruct)
- build systems append versions (found in source in VERSION files) to AI library names (experimental)
- got rid of creg in AI Interface and AIs (also remove it from AI deps in scons and cmake)
- introducing System/creg/creg_cond.h for conditional creg compiling (see below)
- AIs that want to use creg have to specify -DUSING_CREG when compiling (other parts of spring do not have to specify that)

Modified: branches/caiinterface/AI/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/CMakeLists.txt	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/AI/CMakeLists.txt	2008-10-09 17:55:40 UTC (rev 6638)
@@ -1,7 +1,5 @@
 include_directories(${CMAKE_SOURCE_DIR}/rts ${CMAKE_SOURCE_DIR}/rts/ExternalAI ${CMAKE_SOURCE_DIR}/rts/System ${SDL_INCLUDE_DIR})
 
-#FIND_PACKAGE(SDL REQUIRED)
-
 add_definitions(${PIC_FLAG} -D_REENTRANT -D_GNU_SOURCE=1)
 aux_source_directory(${CMAKE_SOURCE_DIR}/rts/System/creg creg)
 #list (APPEND creg ${CMAKE_SOURCE_DIR}/rts/System/float3)
@@ -19,8 +17,9 @@
 
 aux_source_directory(${CMAKE_SOURCE_DIR}/rts/ExternalAI/Interface/LegacyCppWrapper legacycppaienv)
 list (APPEND legacycppaienv ${aienv})
-list (APPEND legacycppaienv ${errorhandler})
 list (APPEND legacycppaienv ${CMAKE_SOURCE_DIR}/rts/System/float3)
+list (APPEND legacycppaienv ${CMAKE_SOURCE_DIR}/rts/Sim/Misc/DamageArray)
+#list (APPEND legacycppaienv ${errorhandler})
 #list (APPEND legacycppaienv ${CMAKE_SOURCE_DIR}/rts/System/LogOutput)
 
 

Modified: branches/caiinterface/AI/Interfaces/C/Interface.cpp
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/AI/Interfaces/C/Interface.cpp	2008-10-09 17:55:40 UTC (rev 6638)
@@ -20,106 +20,11 @@
 #include &quot;ExternalAI/Interface/aidefines.h&quot;
 #include &quot;ExternalAI/Interface/SAIInterfaceLibrary.h&quot;
 
-//#include &lt;boost/filesystem.hpp&gt;
-//#include &lt;boost/regex.hpp&gt;
-
-#include &quot;Util.h&quot;
-#include &quot;System/Platform/errorhandler.h&quot;
+#include &quot;Log.h&quot;
 #include &quot;Platform/SharedLib.h&quot;
-//#include &quot;LogOutput.h&quot;
 
-/*
-void CInterface::errorMsgFileNames(const std::string&amp; additionalTxt) const {
-	// !!!check everything in mySkirmishAIFileNames and do a reportError!!!;
-	std::string msg(&quot;mySkirmishAIFileNames:\n&quot;);
-	char buffer[16];
-	sprintf(buffer, &quot;%i&quot;, mySkirmishAIFileNames.size());
-	msg.append(&quot;num: &quot;).append(buffer).append(&quot;\n&quot;);
-	T_skirmishAIFileNames::const_iterator fn;
-	for (fn=mySkirmishAIFileNames.begin(); fn!=mySkirmishAIFileNames.end(); fn++) {
-		msg.append(fn-&gt;first.shortName).append(&quot;\t&quot;);
-		msg.append(fn-&gt;first.version).append(&quot;\t&quot;);
-		msg.append(fn-&gt;second).append(&quot;\n&quot;);
-	}
-	msg.append(&quot;additionalTxt:\n&quot;).append(additionalTxt).append(&quot;\n&quot;);
-	
-	reportError(msg);
-}
-*/
+CInterface::CInterface() {}
 
-CInterface::CInterface() {
-	
-	// Read from Skirmish AI info and option files
-/*
-	std::vector&lt;std::string&gt; skirmishAIDataDirs = FindDirs(SKIRMISH_AI_DATA_DIR);
-	for (std::vector&lt;std::string&gt;::iterator dir = skirmishAIDataDirs.begin(); dir != skirmishAIDataDirs.end(); ++dir) {
-		const std::string&amp; possibleDataDir = *dir;
-		boost::filesystem::path fullPath(possibleDataDir + &quot;/AIInfo.lua&quot;);
-		if (boost::filesystem::exists(fullPath)) { // skirmish AI info is available
-			// parse the ai info and extract specifier and filename
-			InfoItem tmpInfos[MAX_INFOS];
-			unsigned int num = ParseInfosRawFileSystem(fullPath.string().c_str(), tmpInfos, MAX_INFOS);
-			std::map&lt;std::string,const char*&gt; infos;
-			for (unsigned int i=0; i &lt; num; ++i) {
-				infos[std::string(tmpInfos[i].key)] = tmpInfos[i].value;
-			}
-	
-			const char* intSN = infos[SKIRMISH_AI_PROPERTY_INTERFACE_SHORT_NAME];
-			const char* intV = infos[SKIRMISH_AI_PROPERTY_INTERFACE_VERSION];
-			bool fits = FitsThisInterface(intSN, intV);
-			if (fits) {
-				const char* fn = infos[SKIRMISH_AI_PROPERTY_FILE_NAME];
-				const char* sn = infos[SKIRMISH_AI_PROPERTY_SHORT_NAME];
-				const char* v = infos[SKIRMISH_AI_PROPERTY_VERSION];
-				if (strlen(fn) == 0 || strlen(sn) == 0 || strlen(v) == 0) {
-					// not all needed values are specifyed in AIInfo.lua
-				} else {
-					SSAISpecifier skirmishAISpecifier = {sn, v};
-					skirmishAISpecifier = copySSAISpecifier(&amp;skirmishAISpecifier);
-					mySkirmishAISpecifiers.push_back(skirmishAISpecifier);
-					mySkirmishAIFileNames[skirmishAISpecifier] = fn;
-				}
-			}
-		}
-	}
-*/
-	
-	
-	// Read from Group AI info and option files
-/*
-	std::vector&lt;std::string&gt; groupAIDataDirs = FindDirs(GROUP_AI_DATA_DIR);
-	for (std::vector&lt;std::string&gt;::iterator dir = groupAIDataDirs.begin(); dir != groupAIDataDirs.end(); ++dir) {
-		const std::string&amp; possibleDataDir = *dir;
-		boost::filesystem::path fullPath(possibleDataDir + &quot;/AIInfo.lua&quot;);
-		if (boost::filesystem::exists(fullPath)) { // group AI info is available
-			// parse the ai info and extract specifier and filename
-			InfoItem tmpInfos[MAX_INFOS];
-			unsigned int num = ParseInfosRawFileSystem(fullPath.string().c_str(), tmpInfos, MAX_INFOS);
-			std::map&lt;std::string,const char*&gt; infos;
-			for (unsigned int i=0; i &lt; num; ++i) {
-				infos[std::string(tmpInfos[i].key)] = tmpInfos[i].value;
-			}
-	
-			const char* intSN = infos[GROUP_AI_PROPERTY_INTERFACE_SHORT_NAME];
-			const char* intV = infos[GROUP_AI_PROPERTY_INTERFACE_VERSION];
-			bool fits = FitsThisInterface(intSN, intV);
-			if (fits) {
-				const char* fn = infos[GROUP_AI_PROPERTY_FILE_NAME];
-				const char* sn = infos[GROUP_AI_PROPERTY_SHORT_NAME];
-				const char* v = infos[GROUP_AI_PROPERTY_VERSION];
-				if (strlen(fn) == 0 || strlen(sn) == 0 || strlen(v) == 0) {
-					// not all needed values are specifyed in AIInfo.lua
-				} else {
-					SGAISpecifier groupAISpecifier = {sn, v};
-					myGroupAIFileNames[groupAISpecifier] = fn;
-					myGroupAISpecifiers.push_back(groupAISpecifier);
-				}
-			}
-		}
-	}
-*/
-}
-
 int CInterface::GetInfos(InfoItem infos[], unsigned int max) {
 	
 	unsigned int i = 0;
@@ -148,40 +53,40 @@
 }
 
 void copyToInfoMap(std::map&lt;std::string, InfoItem&gt;&amp; infoMap, const InfoItem infos[], unsigned int numInfos) {
-	
-    for (unsigned int i=0; i &lt; numInfos; ++i) {
-        infoMap[infos[i].key] = copyInfoItem(&amp;(infos[i]));
-    }
+
+	for (unsigned int i=0; i &lt; numInfos; ++i) {
+		infoMap[infos[i].key] = copyInfoItem(&amp;(infos[i]));
+	}
 }
 SSAISpecifier extractSSAISpecifier(const std::map&lt;std::string, InfoItem&gt;&amp; infoMap) {
-	
+
 	const char* sn = infoMap.find(SKIRMISH_AI_PROPERTY_SHORT_NAME)-&gt;second.value;
 	const char* v = infoMap.find(SKIRMISH_AI_PROPERTY_VERSION)-&gt;second.value;
-	
+
 	SSAISpecifier specifier = {sn, v};
-	
+
 	return specifier;
 }
 SGAISpecifier extractSGAISpecifier(const std::map&lt;std::string, InfoItem&gt;&amp; infoMap) {
-	
+
 	const char* sn = infoMap.find(GROUP_AI_PROPERTY_SHORT_NAME)-&gt;second.value;
 	const char* v = infoMap.find(GROUP_AI_PROPERTY_VERSION)-&gt;second.value;
-	
+
 	SGAISpecifier specifier = {sn, v};
-	
+
 	return specifier;
 }
 
 const SSAILibrary* CInterface::LoadSkirmishAILibrary(const InfoItem infos[], unsigned int numInfos) {
-	
+
 	SSAILibrary* ai;
-	
+
 	std::map&lt;std::string, InfoItem&gt; infoMap;
 	copyToInfoMap(infoMap, infos, numInfos);
 	SSAISpecifier sAISpecifier = extractSSAISpecifier(infoMap);
 	mySkirmishAISpecifiers.push_back(sAISpecifier);
 	mySkirmishAIInfos[sAISpecifier] = infoMap;
-	
+
 	T_skirmishAIs::iterator skirmishAI;
 	skirmishAI = myLoadedSkirmishAIs.find(sAISpecifier);
 	if (skirmishAI == myLoadedSkirmishAIs.end()) {
@@ -192,11 +97,11 @@
 	} else {
 		ai = skirmishAI-&gt;second;
 	}
-	
+
 	return ai;
 }
 int CInterface::UnloadSkirmishAILibrary(const SSAISpecifier* const sAISpecifier) {
-	
+
 	T_skirmishAIs::iterator skirmishAI = myLoadedSkirmishAIs.find(*sAISpecifier);
 	T_skirmishAILibs::iterator skirmishAILib = myLoadedSkirmishAILibs.find(*sAISpecifier);
 	if (skirmishAI == myLoadedSkirmishAIs.end()) {
@@ -207,30 +112,30 @@
 		delete skirmishAILib-&gt;second;
 		myLoadedSkirmishAILibs.erase(skirmishAILib);
 	}
-	
+
 	return 0;
 }
 int CInterface::UnloadAllSkirmishAILibraries() {
-	
+
 	while (myLoadedSkirmishAIs.size() &gt; 0) {
 		UnloadSkirmishAILibrary(&amp;(myLoadedSkirmishAIs.begin()-&gt;first));
 	}
-	
+
 	return 0;
 }
 
 
 
 const SGAILibrary* CInterface::LoadGroupAILibrary(const struct InfoItem infos[], unsigned int numInfos) {
-	
+
 	SGAILibrary* ai = NULL;
-	
+
 	std::map&lt;std::string, InfoItem&gt; infoMap;
 	copyToInfoMap(infoMap, infos, numInfos);
 	SGAISpecifier gAISpecifier = extractSGAISpecifier(infoMap);
 	myGroupAISpecifiers.push_back(gAISpecifier);
 	myGroupAIInfos[gAISpecifier] = infoMap;
-	
+
 	T_groupAIs::iterator groupAI;
 	groupAI = myLoadedGroupAIs.find(gAISpecifier);
 	if (groupAI == myLoadedGroupAIs.end()) {
@@ -241,11 +146,11 @@
 	} else {
 		ai = groupAI-&gt;second;
 	}
-	
+
 	return ai;
 }
 int CInterface::UnloadGroupAILibrary(const SGAISpecifier* const gAISpecifier) {
-	
+
 	T_groupAIs::iterator groupAI = myLoadedGroupAIs.find(*gAISpecifier);
 	T_groupAILibs::iterator groupAILib = myLoadedGroupAILibs.find(*gAISpecifier);
 	if (groupAI == myLoadedGroupAIs.end()) {
@@ -256,7 +161,7 @@
 		delete groupAILib-&gt;second;
 		myLoadedGroupAILibs.erase(groupAILib);
 	}
-	
+
 	return 0;
 }
 int CInterface::UnloadAllGroupAILibraries() {
@@ -268,66 +173,64 @@
 	return 0;
 }
 
+// private functions following
 
-
-
 SharedLib* CInterface::Load(const SSAISpecifier* const sAISpecifier, SSAILibrary* skirmishAILibrary) {
 	return LoadSkirmishAILib(GenerateLibFilePath(*sAISpecifier), skirmishAILibrary);
 }
 SharedLib* CInterface::LoadSkirmishAILib(const std::string&amp; libFilePath, SSAILibrary* skirmishAILibrary) {
-	
-	//reportError(std::string(&quot;CInterface::LoadSkirmishAILib libFilePath: &quot;) + libFilePath);
+
 	SharedLib* sharedLib = SharedLib::Instantiate(libFilePath);
-	
+
 	if (sharedLib == NULL) {
 		reportError(std::string(&quot;Failed loading shared library: &quot;) + libFilePath);
 	}
-	
+
 	// initialize the AI library
 	std::string funcName;
-	
+
 	funcName = &quot;getInfos&quot;;
-    skirmishAILibrary-&gt;getInfos = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (skirmishAILibrary-&gt;getInfos == NULL) {
+	skirmishAILibrary-&gt;getInfos = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (skirmishAILibrary-&gt;getInfos == NULL) {
 		// do nothing: this is permitted, if the AI supplies infos through an AIInfo.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
-	
+	}
+
 	funcName = &quot;getOptions&quot;;
-    skirmishAILibrary-&gt;getOptions = (unsigned int (CALLING_CONV_FUNC_POINTER *)(Option[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (skirmishAILibrary-&gt;getOptions == NULL) {
+	skirmishAILibrary-&gt;getOptions = (unsigned int (CALLING_CONV_FUNC_POINTER *)(Option[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (skirmishAILibrary-&gt;getOptions == NULL) {
 		// do nothing: this is permitted, if the AI supplies options through an AIOptions.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
-	
+	}
+
 	funcName = &quot;getLevelOfSupportFor&quot;;
-    skirmishAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (skirmishAILibrary-&gt;getLevelOfSupportFor == NULL) {
+	skirmishAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (skirmishAILibrary-&gt;getLevelOfSupportFor == NULL) {
 		// do nothing: it is permitted that an AI does not export this function
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	funcName = &quot;init&quot;;
-    skirmishAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (skirmishAILibrary-&gt;init == NULL) {
+	skirmishAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (skirmishAILibrary-&gt;init == NULL) {
 		// do nothing: it is permitted that an AI does not export this function,
 		// as it can still use EVENT_INIT instead
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	funcName = &quot;release&quot;;
-    skirmishAILibrary-&gt;release = (int (CALLING_CONV_FUNC_POINTER *)(int)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (skirmishAILibrary-&gt;release == NULL) {
+	skirmishAILibrary-&gt;release = (int (CALLING_CONV_FUNC_POINTER *)(int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (skirmishAILibrary-&gt;release == NULL) {
 		// do nothing: it is permitted that an AI does not export this function,
 		// as it can still use EVENT_RELEASE instead
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	funcName = &quot;handleEvent&quot;;
-    skirmishAILibrary-&gt;handleEvent = (int (CALLING_CONV_FUNC_POINTER *)(int, int, const void*)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (skirmishAILibrary-&gt;handleEvent == NULL) {
+	skirmishAILibrary-&gt;handleEvent = (int (CALLING_CONV_FUNC_POINTER *)(int, int, const void*)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (skirmishAILibrary-&gt;handleEvent == NULL) {
 		reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	return sharedLib;
 }
@@ -344,47 +247,47 @@
 	std::string funcName;
 	
 	funcName = &quot;getInfos&quot;;
-    groupAILibrary-&gt;getInfos = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (groupAILibrary-&gt;getInfos == NULL) {
+	groupAILibrary-&gt;getInfos = (unsigned int (CALLING_CONV_FUNC_POINTER *)(InfoItem[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (groupAILibrary-&gt;getInfos == NULL) {
 		// do nothing: this is permitted, if the AI supplies infos through an AIInfo.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	funcName = &quot;getLevelOfSupportFor&quot;;
-    groupAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (groupAILibrary-&gt;getLevelOfSupportFor == NULL) {
+	groupAILibrary-&gt;getLevelOfSupportFor = (LevelOfSupport (CALLING_CONV_FUNC_POINTER *)(const char*, int, const char*, const char*)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (groupAILibrary-&gt;getLevelOfSupportFor == NULL) {
 		// do nothing: it is permitted that an AI does not export this function
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	funcName = &quot;getOptions&quot;;
-    groupAILibrary-&gt;getOptions = (unsigned int (CALLING_CONV_FUNC_POINTER *)(Option[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (groupAILibrary-&gt;getOptions == NULL) {
+	groupAILibrary-&gt;getOptions = (unsigned int (CALLING_CONV_FUNC_POINTER *)(Option[], unsigned int max)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (groupAILibrary-&gt;getOptions == NULL) {
 		// do nothing: this is permitted, if the AI supplies options through an AIOptions.lua file
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	funcName = &quot;init&quot;;
-    groupAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int, int)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (groupAILibrary-&gt;init == NULL) {
+	groupAILibrary-&gt;init = (int (CALLING_CONV_FUNC_POINTER *)(int, int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (groupAILibrary-&gt;init == NULL) {
 		// do nothing: it is permitted that an AI does not export this function,
 		// as it can still use EVENT_INIT instead
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	funcName = &quot;release&quot;;
-    groupAILibrary-&gt;release = (int (CALLING_CONV_FUNC_POINTER *)(int, int)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (groupAILibrary-&gt;release == NULL) {
+	groupAILibrary-&gt;release = (int (CALLING_CONV_FUNC_POINTER *)(int, int)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (groupAILibrary-&gt;release == NULL) {
 		// do nothing: it is permitted that an AI does not export this function,
 		// as it can still use EVENT_RELEASE instead
 		//reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	funcName = &quot;handleEvent&quot;;
-    groupAILibrary-&gt;handleEvent = (int (CALLING_CONV_FUNC_POINTER *)(int, int, int, const void*)) sharedLib-&gt;FindAddress(funcName.c_str());
-    if (groupAILibrary-&gt;handleEvent == NULL) {
+	groupAILibrary-&gt;handleEvent = (int (CALLING_CONV_FUNC_POINTER *)(int, int, int, const void*)) sharedLib-&gt;FindAddress(funcName.c_str());
+	if (groupAILibrary-&gt;handleEvent == NULL) {
 		reportInterfaceFunctionError(libFilePath, funcName);
-    }
+	}
 	
 	return sharedLib;
 }
@@ -398,31 +301,13 @@
 }
 
 void CInterface::reportError(const std::string&amp; msg) {
-	handleerror(NULL, msg.c_str(), &quot;C AI Interface Error&quot;, MBF_OK | MBF_EXCL);
+	///handleerror(NULL, msg.c_str(), &quot;C AI Interface Error&quot;, MBF_OK | MBF_EXCL);
+	logFatalError(msg.c_str());
 }
 
 
 std::string CInterface::GenerateLibFilePath(const SSAISpecifier&amp; sAISpecifier) {
 	
-/*
-	std::string libFileName = std::string(sAISpecifier.shortName) // eg. RAI
-			.append(&quot;-&quot;)
-			.append(sAISpecifier.version); // eg. 0.600
-#ifndef _WIN32
-	libFileName = &quot;lib&quot; + libFileName;
-#endif
-	return GenerateLibFilePath(std::string(PATH_TO_SPRING_HOME) +
-			SKIRMISH_AI_IMPLS_DIR, libFileName);
-*/
-	
-/*
-	std::string pattern(&quot;.*&quot;);
-	pattern.append(sAISpecifier.shortName).append(&quot;.*&quot;);
-	pattern.append(sAISpecifier.version).append(&quot;.*&quot;);
-	pattern.append(SharedLib::GetLibExtension());
-	
-	return FindFilesRegex(PATH_TO_SPRING_HOME&quot;&quot;SKIRMISH_AI_IMPLS_DIR, pattern).at(0);
-*/
 	static const std::string path = std::string(PATH_TO_SPRING_HOME&quot;&quot;SKIRMISH_AI_IMPLS_DIR&quot;/&quot;);
 	
 	T_skirmishAIInfos::const_iterator info = mySkirmishAIInfos.find(sAISpecifier);
@@ -469,16 +354,6 @@
 	return path + libFileName;
 }
 
-/*
-std::string CInterface::GenerateLibFilePath(const std::string&amp; basePath, const std::string&amp; libFileName) {
-	return std::string(basePath) // eg AI/Skirmish/impls
-			.append(&quot;/&quot;)
-			.append(libFileName) // eg. RAI-0.600
-			.append(&quot;.&quot;)
-			.append(SharedLib::GetLibExtension()); // eg. dll
-}
-*/
-
 SSAISpecifier CInterface::extractSpecifier(const SSAILibrary&amp; skirmishAILib) {
 	
 	SSAISpecifier skirmishAISpecifier;
@@ -521,78 +396,6 @@
 	return groupAISpecifier;
 }
 
-/*
-std::vector&lt;std::string&gt; CInterface::FindDirs(const std::string&amp; path, const std::string&amp; pattern) {
-	
-	std::vector&lt;std::string&gt; found;
-
-	boost::regex regPattern(pattern, boost::regex::perl|boost::regex::icase);
-	boost::match_results&lt;std::string::const_iterator&gt; matchResult;
-	if (boost::filesystem::exists(path)) {
-		  boost::filesystem::directory_iterator end_itr; // default construction yields past-the-end
-		  for (boost::filesystem::directory_iterator itr(path); itr != end_itr; ++itr) {
-			  if (boost::filesystem::is_directory(*itr)
-					  &amp;&amp; boost::regex_match(itr-&gt;string(), matchResult, regPattern, boost::match_default) != 0
-					  &amp;&amp; matchResult[0].matched) {
-				  found.push_back(itr-&gt;string());
-			  }
-		  }
-	}
-	
-	return found;
-}
-*/
-
-/*
-std::vector&lt;std::string&gt; CInterface::FindFiles(const std::string&amp; path, const std::string&amp; fileExtension) {
-	
-	std::vector&lt;std::string&gt; found;
-
-	if (boost::filesystem::exists(path)) {
-		  boost::filesystem::directory_iterator end_itr; // default construction yields past-the-end
-		  for (boost::filesystem::directory_iterator itr(path); itr != end_itr; ++itr) {
-			  if (!boost::filesystem::is_directory(*itr)
-					  &amp;&amp; boost::filesystem::extension(*itr) == fileExtension) {
-				  found.push_back(itr-&gt;string());
-			  }
-		  }
-	}
-	
-	return found;
-}
-*/
-
-/*
-bool CInterface::FileExists(const std::string&amp; path, const std::string&amp; fileName) {
-	
-	boost::filesystem::path fullPath(path, fileName);
-	
-	return boost::filesystem::exists(fullPath);
-}
-*/
-
-/*
-std::vector&lt;std::string&gt; CInterface::FindFilesRegex(const std::string&amp; path, const std::string&amp; pattern) {
-	
-	std::vector&lt;std::string&gt; found;
-
-	boost::regex regPattern(pattern, boost::regex::perl|boost::regex::icase);
-	boost::match_results&lt;std::string::const_iterator&gt; matchResult;
-	if (boost::filesystem::exists(path)) {
-		  boost::filesystem::directory_iterator end_itr; // default construction yields past-the-end
-		  for (boost::filesystem::directory_iterator itr(path); itr != end_itr; ++itr) {
-			  if (!boost::filesystem::is_directory(*itr)
-					  &amp;&amp; boost::regex_match(itr-&gt;string(), matchResult, regPattern, boost::match_default) != 0
-					  &amp;&amp; matchResult[0].matched) {
-				  found.push_back(itr-&gt;string());
-			  }
-		  }
-	}
-	
-	return found;
-}
-*/
-
 bool CInterface::FitsThisInterface(const std::string&amp; requestedShortName, const std::string&amp; requestedVersion) {
 	
 	bool shortNameFits = false;
@@ -603,7 +406,7 @@
 	
 	std::string shortNameKey(AI_INTERFACE_PROPERTY_SHORT_NAME);
 	std::string versionKey(AI_INTERFACE_PROPERTY_VERSION);
-    for (int i=0; i &lt; num; ++i) {
+	for (int i=0; i &lt; num; ++i) {
 		if (shortNameKey == infos[i].key) {
 			if (requestedShortName == infos[i].value) {
 				shortNameFits = true;
@@ -613,7 +416,7 @@
 				versionFits = true;
 			}
 		}
-    }
+	}
 	
 	return shortNameFits &amp;&amp; versionFits;
 }

Modified: branches/caiinterface/AI/Interfaces/C/Interface.h
===================================================================
--- branches/caiinterface/AI/Interfaces/C/Interface.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/AI/Interfaces/C/Interface.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -31,69 +31,51 @@
 class CInterface {
 public:
 	CInterface();
-    
+	
 	// static properties
 	int GetInfos(InfoItem infos[], unsigned int max);
 	LevelOfSupport GetLevelOfSupportFor(
 			const char* engineVersion, int engineAIInterfaceGeneratedVersion);
 
 	// skirmish AI methods
-	//int GetSkirmishAISpecifiers(SSAISpecifier* sAISpecifiers, int max) const;
 	const SSAILibrary* LoadSkirmishAILibrary(const struct InfoItem infos[], unsigned int numInfos);
 	int UnloadSkirmishAILibrary(const SSAISpecifier* const sAISpecifier);
 	int UnloadAllSkirmishAILibraries();
 
 	// group AI methods
-	//int GetGroupAISpecifiers(SGAISpecifier* gAISpecifiers, int max) const;
 	const SGAILibrary* LoadGroupAILibrary(const struct InfoItem infos[], unsigned int numInfos);
 	int UnloadGroupAILibrary(const SGAISpecifier* const gAISpecifier);
 	int UnloadAllGroupAILibraries();
-	
+
 private:
 	// these functions actually load and unload the libraries
 	SharedLib* Load(const SSAISpecifier* const sAISpecifier, SSAILibrary* ai);
 	SharedLib* LoadSkirmishAILib(const std::string&amp; libFilePath, SSAILibrary* ai);
-	
+
 	SharedLib* Load(const SGAISpecifier* const gAISpecifier, SGAILibrary* ai);
 	SharedLib* LoadGroupAILib(const std::string&amp; libFilePath, SGAILibrary* ai);
-	
+
 	static void reportInterfaceFunctionError(const std::string&amp; libFileName, const std::string&amp; functionName);
 	static void reportError(const std::string&amp; msg);
 	std::string GenerateLibFilePath(const SSAISpecifier&amp; sAISpecifier);
 	std::string GenerateLibFilePath(const SGAISpecifier&amp; gAISpecifier);
-	//static std::string GenerateLibFilePath(const std::string&amp; basePath, const std::string&amp; libFileName);
-#define MAX_INFOS 128
+	#define MAX_INFOS 128
 	static SSAISpecifier extractSpecifier(const SSAILibrary&amp; skirmishAILib);
 	static SGAISpecifier extractSpecifier(const SGAILibrary&amp; groupAILib);
-	
-	//static std::vector&lt;std::string&gt; FindDirs(const std::string&amp; path, const std::string&amp; pattern = &quot;.*&quot;);
-	/**
-	 * Searches non-recursively for files under path, with a given file extension.
-	 * The fileExtension you supplied have to contain the '.' as well, it will not be prepended.
-	 */
-	//static std::vector&lt;std::string&gt; FindFiles(const std::string&amp; path, const std::string&amp; fileExtension);
-	//static bool FileExists(const std::string&amp; path, const std::string&amp; fileName);
-	//static std::vector&lt;std::string&gt; FindFilesRegex(const std::string&amp; path, const std::string&amp; pattern);
-	
+
 	bool FitsThisInterface(const std::string&amp; requestedShortName, const std::string&amp; requestedVersion);
-	//void errorMsgFileNames(const std::string&amp; additionalTxt = &quot;&quot;) const;
 private:
-//	std::map&lt;std::string, std::string&gt; myProperties;
 	std::vector&lt;InfoItem&gt; myInfos;
-	
+
 	std::vector&lt;SSAISpecifier&gt; mySkirmishAISpecifiers;
-//	typedef std::map&lt;SSAISpecifier, std::string, SSAISpecifier_Comparator&gt; T_skirmishAIFileNames;
-//	T_skirmishAIFileNames mySkirmishAIFileNames;
 	typedef std::map&lt;SSAISpecifier, std::map&lt;std::string, InfoItem&gt;, SSAISpecifier_Comparator&gt; T_skirmishAIInfos;
 	T_skirmishAIInfos mySkirmishAIInfos;
 	typedef std::map&lt;SSAISpecifier, SSAILibrary*, SSAISpecifier_Comparator&gt; T_skirmishAIs;
 	T_skirmishAIs myLoadedSkirmishAIs;
 	typedef std::map&lt;SSAISpecifier, SharedLib*, SSAISpecifier_Comparator&gt; T_skirmishAILibs;
 	T_skirmishAILibs myLoadedSkirmishAILibs;
-	
+
 	std::vector&lt;SGAISpecifier&gt; myGroupAISpecifiers;
-//	typedef std::map&lt;SGAISpecifier, std::string, SGAISpecifier_Comparator&gt; T_groupAIFileNames;
-//	T_groupAIFileNames myGroupAIFileNames;
 	typedef std::map&lt;SGAISpecifier, std::map&lt;std::string, InfoItem&gt;, SGAISpecifier_Comparator&gt; T_groupAIInfos;
 	T_groupAIInfos myGroupAIInfos;
 	typedef std::map&lt;SGAISpecifier, SGAILibrary*, SGAISpecifier_Comparator&gt; T_groupAIs;

Modified: branches/caiinterface/AI/Interfaces/C/InterfaceExport.h
===================================================================
--- branches/caiinterface/AI/Interfaces/C/InterfaceExport.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/AI/Interfaces/C/InterfaceExport.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -24,6 +24,9 @@
 #if	defined BUILDING_AI
 #error BUILDING_AI should not be defined when building AI interfaces
 #endif
+#if	defined SYNCIFY
+#error SYNCIFY should not be defined when building AI interfaces
+#endif
 
 #include &quot;ExternalAI/Interface/aidefines.h&quot;
 

Added: branches/caiinterface/AI/Interfaces/C/VERSION
===================================================================
--- branches/caiinterface/AI/Interfaces/C/VERSION	                        (rev 0)
+++ branches/caiinterface/AI/Interfaces/C/VERSION	2008-10-09 17:55:40 UTC (rev 6638)
@@ -0,0 +1 @@
+0.1


Property changes on: branches/caiinterface/AI/Interfaces/C/VERSION
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/AI/Interfaces/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/AI/Interfaces/CMakeLists.txt	2008-10-09 17:55:40 UTC (rev 6638)
@@ -1,4 +1,3 @@
-
 ### AI Interfaces
 ## This section will only contain the C AI interface most likely,
 ## as all the other ones will need special libraries to compile and link,
@@ -6,6 +5,8 @@
 #add_definitions(-DBUILDING_AI_INTERFACE -DSTREFLOP_X87)
 add_definitions(-DBUILDING_AI_INTERFACE)
 
+file(STRINGS &quot;${CMAKE_SOURCE_DIR}/AI/Interfaces/C/VERSION&quot; C_AIINTERFACE_VERSION LIMIT_COUNT 1)
+message(&quot;C AI Interface version is: ${C_AIINTERFACE_VERSION}&quot;)
 aux_source_directory(${CMAKE_SOURCE_DIR}/AI/Interfaces/C cAIInterface)
 list (APPEND cAIInterface ${CMAKE_SOURCE_DIR}/rts/System/Platform/SharedLib)
 if (UNIX)
@@ -13,8 +14,8 @@
 else (UNIX)
 	list (APPEND cAIInterface ${CMAKE_SOURCE_DIR}/rts/System/Platform/Win/DllLib)
 endif (UNIX)
-add_library(C-0.1 MODULE ${cAIInterface} ${aienv} ${errorhandler})
-install (FILES ${CMAKE_SOURCE_DIR}/AI/Interfaces/C/InterfaceInfo.lua DESTINATION ${DATADIR}/AI/Interfaces/data/C-0.1)
+add_library(&quot;C-${C_AIINTERFACE_VERSION}&quot; MODULE ${cAIInterface} ${aienv}) # ${errorhandler})
+install (FILES &quot;${CMAKE_SOURCE_DIR}/AI/Interfaces/C/InterfaceInfo.lua&quot; DESTINATION &quot;${DATADIR}/AI/Interfaces/data/C-${C_AIINTERFACE_VERSION}&quot;)
 
-install (TARGETS C-0.1 DESTINATION ${DATADIR}/AI/Interfaces/impls)
+install (TARGETS &quot;C-${C_AIINTERFACE_VERSION}&quot; DESTINATION ${DATADIR}/AI/Interfaces/impls)
 

Modified: branches/caiinterface/AI/Skirmish/AAI/aidef.h
===================================================================
--- branches/caiinterface/AI/Skirmish/AAI/aidef.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/AI/Skirmish/AAI/aidef.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -17,7 +17,6 @@
 #include &quot;Sim/MoveTypes/MoveInfo.h&quot;
 #include &quot;GlobalStuff.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
-#include &quot;Sim/Weapons/Weapon.h&quot;
 #include &quot;Sim/Units/CommandAI/CommandQueue.h&quot;
 #include &quot;AAIConfig.h&quot;
 

Modified: branches/caiinterface/AI/Skirmish/CMakeLists.txt
===================================================================
--- branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/AI/Skirmish/CMakeLists.txt	2008-10-09 17:55:40 UTC (rev 6638)
@@ -1,29 +1,65 @@
-
 ### Skirmish AIs
-#remove_definitions(-DBUILDING_AI_INTERFACE -DSTREFLOP_X87 -DSTREFLOP_SSE -DSTREFLOP_SOFT)
 add_definitions(-DBUILDING_AI)
 
+
 ## KAI
+set(KAI_VERS &quot;UNKNOWN_VERSION&quot;)
+if (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/KAI/VERSION)
+	file(STRINGS &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish/KAI/VERSION&quot; KAI_VERS LIMIT_COUNT 1)
+endif (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/KAI/VERSION)
+message(&quot;${KAI_VERS}\t(KAI Version)&quot;)
+
 aux_source_directory(${CMAKE_SOURCE_DIR}/AI/Skirmish/KAI-0.2 kai02)
-#add_library(KAI-0.2 MODULE ${kai02} ${legacycppaienv} ${creg})
+#add_library(KAI-${KAI_VERS} MODULE ${kai02} ${legacycppaienv} ${creg})
+#set_target_properties(KAI-${KAI_VERS} PROPERTIES COMPILE_FLAGS &quot;-DUSING_CREG&quot;)
 
+
 ## KAIK
-aux_source_directory(${CMAKE_SOURCE_DIR}/AI/Skirmish/KAIK-0.13 kaik013)
-add_library(KAIK-0.13 MODULE ${kaik013} ${legacycppaienv} ${creg})
-install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/KAIK-0.13/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/KAIK-0.13)
-install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/KAIK-0.13/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/KAIK-0.13)
+set(KAIK_VERS &quot;UNKNOWN_VERSION&quot;)
+if (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/KAIK-0.13/VERSION)
+	file(STRINGS &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish/KAIK-0.13/VERSION&quot; KAIK_VERS LIMIT_COUNT 1)
+endif (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/KAIK-0.13/VERSION)
+message(&quot;${KAIK_VERS}\t(KAIK Version)&quot;)
 
+add_library(&quot;KAIK-${KAIK_VERS}&quot; MODULE ${kaik013} ${legacycppaienv} ${creg})
+install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/KAIK-0.13/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/KAIK-${KAIK_VERS})
+install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/KAIK-0.13/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/KAIK-${KAIK_VERS})
+set_target_properties(&quot;KAIK-${KAIK_VERS}&quot; PROPERTIES COMPILE_FLAGS &quot;-DUSING_CREG&quot;)
+
+
 ## RAI
+set(RAI_VERS &quot;UNKNOWN_VERSION&quot;)
+if (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/RAI-0.553/VERSION)
+	file(STRINGS &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish/RAI-0.553/VERSION&quot; RAI_VERS LIMIT_COUNT 1)
+endif (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/RAI-0.553/VERSION)
+message(&quot;${RAI_VERS}\t(RAI Version)&quot;)
+
 aux_source_directory(${CMAKE_SOURCE_DIR}/AI/Skirmish/RAI-0.553 rai)
-add_library(RAI-0.553 MODULE ${rai} ${legacycppaienv} ${creg} RAI-0.553/KrogsMetalClass/MetalMap)
-install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/RAI-0.553/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/RAI-0.553)
-install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/RAI-0.553/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/RAI-0.553)
+add_library(RAI-${RAI_VERS} MODULE ${rai} ${legacycppaienv} RAI-0.553/KrogsMetalClass/MetalMap)
+install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/RAI-0.553/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/RAI-${RAI_VERS})
+install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/RAI-0.553/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/RAI-${RAI_VERS})
 
+
 ## AAI
+set(AAI_VERS &quot;UNKNOWN_VERSION&quot;)
+if (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/AAI/VERSION)
+	file(STRINGS &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish/AAI/VERSION&quot; AAI_VERS LIMIT_COUNT 1)
+endif (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/AAI/VERSION)
+message(&quot;${AAI_VERS}\t(AAI Version)&quot;)
+
 aux_source_directory(${CMAKE_SOURCE_DIR}/AI/Skirmish/AAI aai)
-#add_library(AAI MODULE ${aai} ${legacycppaienv})
+#add_library(AAI-${AAI_VERS} MODULE ${aai} ${legacycppaienv})
+#install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/AAI/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/AAI-${AAI_VERS})
+#install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/AAI/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/AAI-${AAI_VERS})
 
+
 ## NTai
+set(NTai_VERS &quot;UNKNOWN_VERSION&quot;)
+if (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/NTai/VERSION)
+	file(STRINGS &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish/NTai/VERSION&quot; NTai_VERS LIMIT_COUNT 1)
+endif (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/NTai/VERSION)
+message(&quot;${NTai_VERS}\t(NTai Version)&quot;)
+
 aux_source_directory(NTai/AI/NTai/Units ntai)
 aux_source_directory(NTai/AI/NTai/Units/Behaviours ntai)
 aux_source_directory(NTai/AI/NTai/Tasks ntai)
@@ -35,30 +71,53 @@
 aux_source_directory(NTai/AI/NTai/Core ntai)
 aux_source_directory(NTai/AI/NTai/Agents ntai)
 #add_library(NTai SHARED ${ntai} ${legacycppaienv})
-#target_link_libraries(NTai boost_thread-mt)
+#target_link_libraries(NTai-${NTai_VERS} boost_thread-mt)
+#install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NTai/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NTai-${NTai_VERS})
+#install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NTai/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NTai-${NTai_VERS})
 
+
 ## Null Legacy C++ AI
+set(NullLegacyCppAI_VERS &quot;UNKNOWN_VERSION&quot;)
+if (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullLegacyCppAI/VERSION)
+	file(STRINGS &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish/NullLegacyCppAI/VERSION&quot; NullLegacyCppAI_VERS LIMIT_COUNT 1)
+endif (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullLegacyCppAI/VERSION)
+message(&quot;${NullLegacyCppAI_VERS}\t(NullLegacyCppAI Version)&quot;)
+
 aux_source_directory(${CMAKE_SOURCE_DIR}/AI/Skirmish/NullLegacyCppAI nullLegacyCppAI)
-add_library(NullLegacyCppAI-0.1 MODULE ${nullLegacyCppAI} ${legacycppaienv} ${creg})
-install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullLegacyCppAI/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NullLegacyCppAI-0.1)
-install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullLegacyCppAI/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NullLegacyCppAI-0.1)
+add_library(NullLegacyCppAI-${NullLegacyCppAI_VERS} MODULE ${nullLegacyCppAI} ${legacycppaienv})
+install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullLegacyCppAI/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NullLegacyCppAI-${NullLegacyCppAI_VERS})
+install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullLegacyCppAI/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NullLegacyCppAI-${NullLegacyCppAI_VERS})
 
+
 ## Null C AI
+set(NullAI_VERS &quot;UNKNOWN_VERSION&quot;)
+if (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullAI/VERSION)
+	file(STRINGS &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish/NullAI/VERSION&quot; NullAI_VERS LIMIT_COUNT 1)
+endif (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullAI/VERSION)
+message(&quot;${NullAI_VERS}\t(NullAI Version)&quot;)
+
 aux_source_directory(${CMAKE_SOURCE_DIR}/AI/Skirmish/NullAI nullAI)
-add_library(NullAI-0.1 MODULE ${nullAI} ${aienv})
-install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullAI/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NullAI-0.1)
-install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullAI/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NullAI-0.1)
+add_library(NullAI-${NullAI_VERS} MODULE ${nullAI} ${aienv})
+install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullAI/AIInfo.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NullAI-${NullAI_VERS})
+install (FILES ${CMAKE_SOURCE_DIR}/AI/Skirmish/NullAI/AIOptions.lua DESTINATION ${DATADIR}/AI/Skirmish/data/NullAI-${NullAI_VERS})
 
+## JCAI
 if (UNIX)
 	# doesn't build in win32currently
+	set(JCAI_VERS &quot;UNKNOWN_VERSION&quot;)
+	if (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/JCAI/VERSION)
+		file(STRINGS &quot;${CMAKE_SOURCE_DIR}/AI/Skirmish/JCAI/VERSION&quot; JCAI_VERS LIMIT_COUNT 1)
+	endif (EXISTS ${CMAKE_SOURCE_DIR}/AI/Skirmish/JCAI/VERSION)
+	message(&quot;${JCAI_VERS}\t(JCAI version)&quot;)
+	
 	aux_source_directory(${CMAKE_SOURCE_DIR}/AI/Skirmish/JCAI jcai)
-#	add_library(JCAI MODULE ${jcai} ${legacycppaienv})
+#	add_library(JCAI-${JCAI_VERS} MODULE ${jcai} ${legacycppaienv})
 endif (UNIX)
 
-if (UNIX)
-#	install (TARGETS KAIK-0.13 KAI-0.2 RAI-0.553 AAI NTai NullLegacyCppAI-0.1 NullAI-0.1 JCAI DESTINATION ${DATADIR}/AI/Skirmish/impls)
-else (UNIX)
-#	install (TARGETS KAIK-0.13 KAI-0.2 RAI-0.553 AAI NTai NullLegacyCppAI-0.1 NullAI-0.1 DESTINATION ${DATADIR}/AI/Skirmish/impls)
-endif (UNIX)
-install (TARGETS KAIK-0.13 RAI-0.553 NullLegacyCppAI-0.1 NullAI-0.1 DESTINATION ${DATADIR}/AI/Skirmish/impls)
 
+## Instal all AIs
+install (TARGETS KAIK-${KAIK_VERS} RAI-${RAI_VERS} NullLegacyCppAI-${NullLegacyCppAI_VERS} NullAI-${NullAI_VERS} DESTINATION ${DATADIR}/AI/Skirmish/impls)
+#install (TARGETS KAI-${KAI_VERS} AAI-${AAI_VERS} NTai-${NTai_VERS} DESTINATION ${DATADIR}/AI/Skirmish/impls)
+#if (UNIX)
+#	install (TARGETS JCAI-${JCAI_VERS} DESTINATION ${DATADIR}/AI/Skirmish/impls)
+#endif (UNIX)

Added: branches/caiinterface/AI/Skirmish/KAIK-0.13/VERSION
===================================================================
--- branches/caiinterface/AI/Skirmish/KAIK-0.13/VERSION	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/KAIK-0.13/VERSION	2008-10-09 17:55:40 UTC (rev 6638)
@@ -0,0 +1 @@
+0.13


Property changes on: branches/caiinterface/AI/Skirmish/KAIK-0.13/VERSION
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/AI/Skirmish/NullAI/AIExport.h
===================================================================
--- branches/caiinterface/AI/Skirmish/NullAI/AIExport.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/AI/Skirmish/NullAI/AIExport.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -28,6 +28,9 @@
 #if	defined BUILDING_AI_INTERFACE
 	#error BUILDING_AI_INTERFACE should not be defined when building AIs
 #endif
+#if	defined SYNCIFY
+#error SYNCIFY should not be defined when building AIs
+#endif
 
 #include &quot;ExternalAI/Interface/aidefines.h&quot;
 //#include &quot;ExternalAI/Interface/ELevelOfSupport.h&quot;

Added: branches/caiinterface/AI/Skirmish/NullAI/VERSION
===================================================================
--- branches/caiinterface/AI/Skirmish/NullAI/VERSION	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/NullAI/VERSION	2008-10-09 17:55:40 UTC (rev 6638)
@@ -0,0 +1 @@
+0.1


Property changes on: branches/caiinterface/AI/Skirmish/NullAI/VERSION
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/NullLegacyCppAI/VERSION
===================================================================
--- branches/caiinterface/AI/Skirmish/NullLegacyCppAI/VERSION	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/NullLegacyCppAI/VERSION	2008-10-09 17:55:40 UTC (rev 6638)
@@ -0,0 +1 @@
+0.1


Property changes on: branches/caiinterface/AI/Skirmish/NullLegacyCppAI/VERSION
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/AI/Skirmish/RAI-0.553/VERSION
===================================================================
--- branches/caiinterface/AI/Skirmish/RAI-0.553/VERSION	                        (rev 0)
+++ branches/caiinterface/AI/Skirmish/RAI-0.553/VERSION	2008-10-09 17:55:40 UTC (rev 6638)
@@ -0,0 +1 @@
+0.553


Property changes on: branches/caiinterface/AI/Skirmish/RAI-0.553/VERSION
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/SConstruct
===================================================================
--- branches/caiinterface/SConstruct	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/SConstruct	2008-10-09 17:55:40 UTC (rev 6638)
@@ -170,142 +170,234 @@
 aienv = env.Copy()
 aienv.Append(CPPPATH = ['rts/ExternalAI'])
 aienv['LINKFLAGS'] += ['-Wl,--kill-at', '--add-stdcall-alias', '-mno-cygwin', '-lstdc++']
+#print aienv['CPPDEFINES']
+
 aiinterfaceenv = aienv.Copy()
-print aienv['CPPDEFINES']
+aiinterfaceenv['CPPDEFINES'] += ['BUILDING_AI_INTERFACE']
 
 aienv['CPPDEFINES'] += ['BUILDING_AI']
 
-aiinterfaceenv['CPPDEFINES'] += ['BUILDING_AI_INTERFACE']
-#aiinterfaceenv['LINKFLAGS'] += ['-llua']
+skirmishaienv = aienv.Copy()
 
+groupaienv = aienv.Copy()
+
+
+# stores shared objects so newer scons versions don't choke with
+def create_shared_objects(env, fileList, suffix, additionalCPPDEFINES = []):
+	objsList = []
+	myEnv = env.Copy()
+	myEnv['CPPDEFINES'] += additionalCPPDEFINES
+	for f in fileList:
+		while isinstance(f, list):
+			f = f[0]
+		fpath, fbase = os.path.split(f)
+#		print &quot;file: %s&quot; % f
+#		print &quot;base: %s&quot; % fbase
+		fname, fext = fbase.rsplit('.', 1)
+		objsList.append(myEnv.SharedObject(os.path.join(fpath, fname + suffix), f))
+	return objsList
+
+# retrieves the version of a Skirmish AI from the following file
+# {spring_source}/AI/Skirmish/{ai_name}/VERSION
+def fetch_ai_version(aiName, subDir = 'Skirmish'):
+	version = 'VERSION_UNKNOWN'
+	versionFile = os.path.join('AI', subDir, aiName, 'VERSION')
+	if os.path.exists(versionFile):
+		file = open(versionFile, 'r')
+		version = file.readline().strip()
+		file.close()
+	return version
+
+# appends the version to the end of the AI Interface name
+def construct_aiinterface_libName(interfaceName):
+	libName = interfaceName + '-' + fetch_ai_version(interfaceName, 'Interfaces')
+	return libName
+
+# appends the version to the end of the Skirmish AI name
+def construct_skirmishai_libName(aiName):
+	libName = aiName + '-' + fetch_ai_version(aiName, 'Skirmish')
+	return libName
+
+# appends the version to the end of the Group AI name
+def construct_groupai_libName(aiName):
+	libName = aiName + '-' + fetch_ai_version(aiName, 'Group')
+	return libName
+
 ################################################################################
 ### Build AI Interface shared objects
 ################################################################################
-## Use subst() to substitute $installprefix in datadir.
-#install_dir = os.path.join(aiinterfaceenv['installprefix'], aiinterfaceenv.subst(aiinterfaceenv['libdir']), 'AI/Interfaces/impls')
-install_dir = os.path.join(aiinterfaceenv['installprefix'], aiinterfaceenv['libdir'], 'AI/Interfaces/impls')
+install_aiinterfaces_lib_dir = os.path.join(aiinterfaceenv['installprefix'], aiinterfaceenv['libdir'], 'AI/Interfaces/impls')
+install_aiinterfaces_data_dir = os.path.join(aiinterfaceenv['installprefix'], aiinterfaceenv['datadir'], 'AI/Interfaces/data')
 
 # store shared ai-interface objects so newer scons versions don't choke with
 # *** Two environments with different actions were specified for the same target
-aiinterfaceobjs = []
-for f in filelist.get_shared_AIInterface_source(aiinterfaceenv, True, True, False):
-	while isinstance(f, list):
-		f = f[0]
-	fpath, fbase = os.path.split(f)
-#	print &quot;file: %s&quot; % f
-#	print &quot;base: %s&quot; % fbase
-	fname, fext = fbase.rsplit('.', 1)
-	aiinterfaceobjs.append(aiinterfaceenv.SharedObject(os.path.join(fpath, fname + '-aiinterface'), f))
+aiinterfaceobjs_main = create_shared_objects(aiinterfaceenv, filelist.get_shared_AIInterface_source(aiinterfaceenv), '-aiinterface')
+aiinterfaceobjs_SharedLib = create_shared_objects(aiinterfaceenv, filelist.get_shared_AIInterface_source_SharedLib(aiinterfaceenv), '-aiinterface')
 
 # Build
-for f in filelist.list_AIInterfaces(aiinterfaceenv, exclude_list=['build']):
-	lib = aiinterfaceenv.SharedLibrary(os.path.join('game/AI/Interfaces/impls', f), aiinterfaceobjs + filelist.get_AIInterface_source(aiinterfaceenv, f))
-	Alias(f, lib)          # Allow e.g. `scons Java' to compile just that specific AI interface.
+aiinterfaces_exclude_list=['build', 'Java']
+aiinterfaces_needSharedLib_list=['C']
+for baseName in filelist.list_AIInterfaces(aiinterfaceenv, exclude_list=aiinterfaces_exclude_list):
+	libName = construct_aiinterface_libName(baseName) # eg. C-0.1
+	print &quot;AI Interface: &quot; + libName
+	objs = aiinterfaceobjs_main
+	if baseName in aiinterfaces_needSharedLib_list:
+		objs += aiinterfaceobjs_SharedLib
+	mySource = objs + filelist.get_AIInterface_source(aiinterfaceenv, baseName)
+	#lib = aiinterfaceenv.SharedLibrary(os.path.join('game/AI/Interfaces/impls', baseName), mySource)
+	lib = aiinterfaceenv.SharedLibrary(os.path.join('game/AI/Interfaces/impls', libName), mySource)
+	Alias(baseName, lib)       # Allow e.g. `scons Java' to compile just that specific AI interface.
 	Alias('AIInterfaces', lib) # Allow `scons AIInterfaces' to compile all AI interfaces.
 	Default(lib)
-	inst = env.Install(install_dir, lib)
+	inst = env.Install(install_aiinterfaces_lib_dir, lib)
 	Alias('install', inst)
 	Alias('install-AIInterfaces', inst)
-	Alias('install-'+f, inst)
+	Alias('install-'+baseName, inst)
 	if aiinterfaceenv['strip']:
 		aiinterfaceenv.AddPostAction(lib, Action([['strip','$TARGET']]))
 
+# install AI interface info files
+aiinterfaces_data_dirs = filelist.list_directories(env, 'AI/Interfaces', exclude_list=aiinterfaces_exclude_list, recursively=False)
+for f in aiinterfaces_data_dirs:
+	baseName = os.path.basename(f)
+	libName = construct_aiinterface_libName(baseName)
+	#install_data_interface_dir = os.path.join(install_aiinterfaces_data_dir, baseName)
+	install_data_interface_dir = os.path.join(install_aiinterfaces_data_dir, libName)
+	infoFile = os.path.join(f, &quot;InterfaceInfo.lua&quot;)
+	if os.path.exists(infoFile):
+		inst = env.Install(install_data_interface_dir, infoFile)
+		Alias('install', inst)
+		Alias('install-AIInterfaces', inst)
+		Alias('install-'+baseName, inst)
+
 ################################################################################
 ### Build Skirmish AI shared objects
 ################################################################################
-# Use subst() to substitute $installprefix in datadir.
-install_dir = os.path.join(aienv['installprefix'], aienv.subst(aienv['libdir']), 'AI/Skirmish/impls')
+install_skirmishai_lib_dir = os.path.join(skirmishaienv['installprefix'], skirmishaienv['libdir'], 'AI/Skirmish/impls')
+install_skirmishai_data_dir = os.path.join(skirmishaienv['installprefix'], skirmishaienv['datadir'], 'AI/Skirmish/data')
 
 # store shared ai objects so newer scons versions don't choke with
 # *** Two environments with different actions were specified for the same target
-skirmishaiobjs = []
-for f in filelist.get_shared_skirmishAI_source(aienv, True, False, True):
-        while isinstance(f, list):
-                f = f[0]
-        fpath, fbase = os.path.split(f)
-        fname, fext = fbase.rsplit('.', 1)
-        skirmishaiobjs.append(aienv.SharedObject(os.path.join(fpath, fname + '-skirmishai'), f))
+skirmishaiobjs_main = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source(skirmishaienv), '-skirmishai')
+skirmishaiobjs_mainCregged = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
+skirmishaiobjs_creg = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_Creg(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
+skirmishaiobjs_LegacyCpp = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_LegacyCpp(skirmishaienv), '-skirmishai')
+skirmishaiobjs_LegacyCppCregged = create_shared_objects(skirmishaienv, filelist.get_shared_skirmishAI_source_LegacyCpp(skirmishaienv), '-skirmishai_creg', ['USING_CREG'])
 
 # Build
-ai_exclude_list=['build', 'CSAI', 'TestABICAI','AbicWrappersTestAI', 'TestGlobalAI']
-for f in filelist.list_skirmishAIs(aienv, exclude_list=ai_exclude_list):
-	lib = aienv.SharedLibrary(os.path.join('game/AI/Skirmish/impls', f), skirmishaiobjs + filelist.get_skirmishAI_source(aienv, f))
-	Alias(f, lib)          # Allow e.g. `scons JCAI' to compile just a skirmish AI.
+skirmishai_exclude_list=['build', 'CSAI', 'TestABICAI','AbicWrappersTestAI']
+skirmishai_isLegacyCpp_list=['AAI', 'KAIK-0.13', 'RAI-0.553', 'NullLegacyCppAI', 'KAI-0.2', 'NTai']
+skirmishai_needCreg_list=['KAIK-0.13', 'KAI-0.2']
+for baseName in filelist.list_skirmishAIs(skirmishaienv, exclude_list=skirmishai_exclude_list):
+	libName = construct_skirmishai_libName(baseName) # eg. RAI-0.600
+	print &quot;Skirmish AI: &quot; + libName
+	useCreg = baseName in skirmishai_needCreg_list
+	isLegacyCpp = baseName in skirmishai_isLegacyCpp_list
+	myEnv = skirmishaienv.Copy()
+	if useCreg:
+		myEnv['CPPDEFINES'] += ['USING_CREG']
+	objs = []
+	if useCreg:
+		objs += skirmishaiobjs_mainCregged
+		objs += skirmishaiobjs_creg
+	else:
+		objs += skirmishaiobjs_main
+	if isLegacyCpp:
+		if useCreg:
+			objs += skirmishaiobjs_LegacyCppCregged
+		else:
+			objs += skirmishaiobjs_LegacyCpp
+	mySource = objs + filelist.get_skirmishAI_source(myEnv, baseName)
+	lib = myEnv.SharedLibrary(os.path.join('game/AI/Skirmish/impls', baseName), mySource)
+	#lib = myEnv.SharedLibrary(os.path.join('game/AI/Skirmish/impls', libName), mySource)
+	Alias(baseName, lib)            # Allow e.g. `scons JCAI' to compile just a skirmish AI.
 	Alias('SkirmishAI', lib) # Allow `scons SkirmishAI' to compile all skirmishAIs.
 	Default(lib)
-	inst = env.Install(install_dir, lib)
+	inst = env.Install(install_skirmishai_lib_dir, lib)
 	Alias('install', inst)
 	Alias('install-SkirmishAI', inst)
-	Alias('install-'+f, inst)
-	if aienv['strip']:
-		aienv.AddPostAction(lib, Action([['strip','$TARGET']]))
+	Alias('install-'+baseName, inst)
+	if myEnv['strip']:
+		myEnv.AddPostAction(lib, Action([['strip','$TARGET']]))
 
-# build TestABICAI
-# lib = aienv.SharedLibrary(os.path.join('game/AI/Skirmish/impls','TestABICAI'), ['game/spring.a'], CPPDEFINES = env# ['CPPDEFINES'] + ['BUILDING_AI'] )
-# Alias('TestABICAI', lib)
-# Alias('install-TestABICAI', inst)
-# if sys.platform == 'win32':
-# 	Alias('SkirmishAI', lib)
-# 	Default(lib)
-# 	inst = env.Install(install_dir, lib)
-# 	Alias('install', inst)
-# 	Alias('install-SkirmishAI', inst)
-# 	if env['strip']:
-# 		env.AddPostAction(lib, Action([['strip','$TARGET']]))
-
 # install Skirmish AI info and options files
-info_files=filelist.list_directories(env, 'AI/Skirmish', exclude_list=ai_exclude_list, recursively=False)
-for f in info_files:
-	#print &quot;inspecting %s ...&quot; % f
-	if os.path.exists(f + &quot;/AIInfo.lua&quot;):
-		print &quot;exists: %s/AIInfo.lua&quot; % f
-		print &quot;installprefix: %s&quot; % aienv['installprefix']
-		print &quot;datadir: %s&quot; % aienv['datadir']
-		print &quot;copying to: %s&quot; % &quot;AI/Skirmish/data/&quot; + os.path.basename(f) + &quot;/AIInfo.lua&quot;
-		inst = env.Install(os.path.join(aienv['installprefix'], aienv['datadir'], &quot;AI/Skirmish/data/&quot; + os.path.basename(f)), f + &quot;/AIInfo.lua&quot;)
+skirmishai_data_dirs=filelist.list_directories(env, 'AI/Skirmish', exclude_list=skirmishai_exclude_list, recursively=False)
+for f in skirmishai_data_dirs:
+	baseName = os.path.basename(f)
+	libName = construct_aiinterface_libName(baseName)
+	install_data_ai_dir = os.path.join(install_skirmishai_data_dir, baseName)
+	#install_data_ai_dir = os.path.join(install_skirmishai_data_dir, libName)
+	infoFile = os.path.join(f, &quot;AIInfo.lua&quot;)
+	if os.path.exists(infoFile):
+		inst = env.Install(install_data_ai_dir, infoFile)
 		Alias('install', inst)
-	if os.path.exists(f + &quot;/AIOptions.lua&quot;):
-		print &quot;exists: %s/AIOptions.lua&quot; % f
-		print &quot;copying to: %s&quot; % &quot;AI/Skirmish/data/&quot; + os.path.basename(f) + &quot;/AIOptions.lua&quot;
-		inst = env.Install(os.path.join(aienv['installprefix'], aienv['datadir'], &quot;AI/Skirmish/data/&quot; + os.path.basename(f)), f + &quot;/AIOptions.lua&quot;)
+		Alias('install-SkirmishAI', inst)
+		Alias('install-'+baseName, inst)
+	optionsFile = os.path.join(f, &quot;AIOptions.lua&quot;)
+	if os.path.exists(optionsFile):
+		inst = env.Install(install_data_ai_dir, optionsFile)
 		Alias('install', inst)
-	print &quot;&quot;
+		Alias('install-SkirmishAI', inst)
+		Alias('install-'+baseName, inst)
 
 # install AAI config files
 aai_data=filelist.list_files_recursive(env, 'game/AI/AAI')
 for f in aai_data:
 	if not os.path.isdir(f):
-		inst = env.Install(os.path.join(aienv['installprefix'], aienv['datadir'], os.path.dirname(f)[5:]), f)
+		inst = env.Install(os.path.join(skirmishaienv['installprefix'], skirmishaienv['datadir'], os.path.dirname(f)[5:]), f)
 		Alias('install', inst)
 
 ################################################################################
 ### Build Group AI shared objects
 ################################################################################
-# Use subst() to substitute $installprefix in datadir.
-install_dir = os.path.join(aienv['installprefix'], aienv.subst(aienv['libdir']), 'AI/Helper-libs')
+install_groupai_lib_dir = os.path.join(groupaienv['installprefix'], groupaienv['libdir'], 'AI/Helper-libs')
+#install_groupai_data_dir = os.path.join(groupaienv['installprefix'], groupaienv['datadir'], 'AI/Helper-libs/data')
 
 # store shared ai objects so newer scons versions don't choke with
 # *** Two environments with different actions were specified for the same target
-groupaiobjs = []
-for f in filelist.get_shared_skirmishAI_source(aienv, True, False, True):
-        while isinstance(f, list):
-                f = f[0]
-        fpath, fbase = os.path.split(f)
-        fname, fext = fbase.rsplit('.', 1)
-        groupaiobjs.append(aienv.SharedObject(os.path.join(fpath, fname + '-groupai'), f))
+groupaiobjs_main = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source(groupaienv), '-groupai')
+groupaiobjs_mainCregged = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source(groupaienv), '-groupai_creg', ['USING_CREG'])
+groupaiobjs_creg = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source_Creg(groupaienv), '-groupai_creg', ['USING_CREG'])
+groupaiobjs_LegacyCpp = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source_LegacyCpp(groupaienv), '-groupai')
+groupaiobjs_LegacyCppCregged = create_shared_objects(groupaienv, filelist.get_shared_groupAI_source_LegacyCpp(groupaienv), '-groupai_creg', ['USING_CREG'])
 
 # Build
-for f in filelist.list_groupAIs(aienv, exclude_list=['build']):
-	lib = aienv.SharedLibrary(os.path.join('game/AI/Helper-libs', f), groupaiobjs + filelist.get_groupAI_source(aienv, f))
-	Alias(f, lib)         # Allow e.g. `scons CentralBuildAI' to compile just an AI.
+groupai_exclude_list=['build']
+groupai_isLegacyCpp_list=['?', '??']
+groupai_needCreg_list=[]
+for baseName in filelist.list_groupAIs(groupaienv, exclude_list=groupai_exclude_list):
+	libName = construct_groupai_libName(baseName) # eg. MetalMaker-1.0
+	print &quot;Group AI: &quot; + libName
+	#TODO remove the True in the next line, uncomment the rest, and actualize groupai_needCreg_list
+	useCreg = True #baseName in groupai_needCreg_list
+	#TODO remove the True in the next line, uncomment the rest, and actualize groupai_isLegacyCpp_list
+	isLegacyCpp = True #baseName in groupai_isLegacyCpp_list
+	myEnv = groupaienv.Copy()
+	if useCreg:
+		myEnv['CPPDEFINES'] += ['USING_CREG']
+	objs = []
+	if useCreg:
+		objs += groupaiobjs_mainCregged
+		objs += groupaiobjs_creg
+	else:
+		objs += groupaiobjs_main
+	if isLegacyCpp:
+		if useCreg:
+			objs += groupaiobjs_LegacyCppCregged
+		else:
+			objs += groupaiobjs_LegacyCpp
+	mySource = objs + filelist.get_groupAI_source(myEnv, baseName)
+	lib = myEnv.SharedLibrary(os.path.join('game/AI/Helper-libs', baseName), mySource)
+	#lib = myEnv.SharedLibrary(os.path.join('game/AI/Helper-libs', libName), mySource)
+	Alias(baseName, lib)         # Allow e.g. `scons CentralBuildAI' to compile just an AI.
 	Alias('GroupAI', lib) # Allow `scons GroupAI' to compile all groupAIs.
 	Default(lib)
-	inst = env.Install(install_dir, lib)
+	inst = env.Install(install_groupai_lib_dir, lib)
 	Alias('install', inst)
 	Alias('install-GroupAI', inst)
-	Alias('install-'+f, inst)
-	if aienv['strip']:
-		aienv.AddPostAction(lib, Action([['strip','$TARGET']]))
+	Alias('install-'+baseName, inst)
+	if myEnv['strip']:
+		myEnv.AddPostAction(lib, Action([['strip','$TARGET']]))
 
 
 ################################################################################

Modified: branches/caiinterface/rts/ExternalAI/Interface/LegacyCppWrapper/AIAICallback.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/LegacyCppWrapper/AIAICallback.cpp	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/ExternalAI/Interface/LegacyCppWrapper/AIAICallback.cpp	2008-10-09 17:55:40 UTC (rev 6638)
@@ -19,12 +19,14 @@
 
 #include &quot;ExternalAI/Interface/AISCommands.h&quot;
 
-
+#include &quot;creg/creg_cond.h&quot;
+#ifdef USING_CREG
 creg::Class* CCommandQueue::GetClass() { return NULL; }
+#endif
 #include &quot;Sim/Units/UnitDef.h&quot;
 #include &quot;Sim/MoveTypes/MoveInfo.h&quot;
 UnitDef::~UnitDef() {
-    delete movedata;
+	delete movedata;
 }
 CIcon::CIcon() {}
 CIcon::~CIcon() {}
@@ -32,7 +34,6 @@
 #include &quot;Sim/Features/FeatureDef.h&quot;
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
 WeaponDef::~WeaponDef() {}
-DamageArray::DamageArray() {}
 
 #include &lt;string&gt;
 

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp	2008-10-09 17:55:40 UTC (rev 6638)
@@ -20,11 +20,6 @@
 #include &lt;string.h&gt;
 #include &lt;stdlib.h&gt;
 
-#if defined __cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
-#define __USE_CREG_HERE
-#include &quot;creg/creg.h&quot;
-#endif /* __cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
-
 SAIInterfaceSpecifier copySAIInterfaceSpecifier(const struct SAIInterfaceSpecifier* const orig) {
 	
 	struct SAIInterfaceSpecifier copy;
@@ -47,10 +42,8 @@
 
 #ifdef	__cplusplus
 
-#ifdef	__USE_CREG_HERE
 CR_BIND(SSAIKey,)
 CR_BIND(SGAIKey,)
-#endif /* __USE_CREG_HERE */
 
 bool SAIInterfaceSpecifier_Comparator::operator()(const struct SAIInterfaceSpecifier&amp; a, const struct SAIInterfaceSpecifier&amp; b) const {
 
@@ -138,9 +131,5 @@
 	return empty;
 }
 
-#ifdef __USE_CREG_HERE
-#undef __USE_CREG_HERE
-#endif	/* __USE_CREG_HERE */
-
 #endif /* __cplusplus */
 

Modified: branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/ExternalAI/Interface/SAIInterfaceLibrary.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -18,10 +18,9 @@
 #ifndef _SAIINTERFACELIBRARY_H
 #define	_SAIINTERFACELIBRARY_H
 
-#if defined __cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
-#define __USE_CREG_HERE
-#include &quot;creg/creg.h&quot;
-#endif /* __cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
+#ifdef __cplusplus
+#include &quot;creg/creg_cond.h&quot;
+#endif
 
 
 #ifdef	__cplusplus
@@ -71,9 +70,7 @@
  * Compleetly specifies a skirmish AI together with an interface.
  */
 struct SSAIKey {
-#ifdef	__USE_CREG_HERE
 	CR_DECLARE_STRUCT(SSAIKey);
-#endif /* __USE_CREG_HERE */
 	struct SAIInterfaceSpecifier interface;
 	struct SSAISpecifier ai;
 };
@@ -96,9 +93,7 @@
  * Compleetly specifies a group AI together with an interface.
  */
 struct SGAIKey {
-#ifdef	__USE_CREG_HERE
 	CR_DECLARE_STRUCT(SGAIKey);
-#endif /* __USE_CREG_HERE */
 	struct SAIInterfaceSpecifier interface;
 	struct SGAISpecifier ai;
 };
@@ -160,10 +155,6 @@
 	int (CALLING_CONV *unloadAllGroupAILibraries)();
 };
 
-#ifdef __USE_CREG_HERE
-#undef __USE_CREG_HERE
-#endif	/* __USE_CREG_HERE */
-
 #ifdef	__cplusplus
 }
 #endif

Modified: branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/ExternalAI/Interface/SInfo.cpp	2008-10-09 17:55:40 UTC (rev 6638)
@@ -17,9 +17,9 @@
 
 #include &quot;SInfo.h&quot;
 
-#include &quot;string.h&quot;
-#include &quot;System/Util.h&quot;
-#include &lt;cstdlib&gt;
+#include &quot;Util.h&quot;
+#include &lt;string.h&gt;
+#include &lt;stdlib.h&gt;
 
 InfoItem copyInfoItem(const struct InfoItem* const orig) {
 	

Modified: branches/caiinterface/rts/Game/GameVersion.cpp
===================================================================
--- branches/caiinterface/rts/Game/GameVersion.cpp	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/Game/GameVersion.cpp	2008-10-09 17:55:40 UTC (rev 6638)
@@ -3,7 +3,7 @@
 	Take special care when moving this file, the Spring buildbot refers to this
 	file to append the version string with the SVN revision number.
 */
-#include &quot;StdAfx.h&quot;
+
 #include &quot;GameVersion.h&quot;
 
 /** The game version. */

Modified: branches/caiinterface/rts/Sim/Misc/DamageArray.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Misc/DamageArray.cpp	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/Sim/Misc/DamageArray.cpp	2008-10-09 17:55:40 UTC (rev 6638)
@@ -1,9 +1,16 @@
+
+#include &quot;DamageArray.h&quot;
+
+#if defined __cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
 #include &quot;StdAfx.h&quot;
 #include &quot;mmgr.h&quot;
-
-#include &quot;DamageArray.h&quot;
 #include &quot;DamageArrayHandler.h&quot;
+#else	/* __cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
+#define SAFE_NEW new
+#endif	/* __cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
 
+
+#ifdef USING_CREG
 CR_BIND(DamageArray, );
 
 CR_REG_METADATA(DamageArray, (
@@ -22,8 +29,9 @@
 {
 	s.Serialize(damages, numTypes * sizeof(damages[0]));
 }
+#endif /* USING_CREG */
 
-
+#if !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
 DamageArray::DamageArray() : paralyzeDamageTime(0),
 			impulseFactor(1.0f), impulseBoost(0.0f),
 			craterMult(1.0f), craterBoost(0.0f)
@@ -34,9 +42,20 @@
 	for(int a = 0; a &lt; numTypes; ++a)
 		damages[a] = 1.0f;
 }
+#else	/* !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
+DamageArray::DamageArray() {}
+#endif	/* !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
 
+DamageArray::DamageArray(int numTypes, const float* typeDamages) :
+			numTypes(numTypes)
+{
+	damages = new float[numTypes];
+	for(int a = 0; a &lt; numTypes; ++a) {
+		damages[a] = typeDamages[a];
+	}
+}
 
-/*DamageArray::DamageArray(const DamageArray&amp; other)
+DamageArray::DamageArray(const DamageArray&amp; other)
 {
 	paralyzeDamageTime = other.paralyzeDamageTime;
 	impulseBoost = other.impulseBoost;
@@ -47,10 +66,10 @@
 	damages = SAFE_NEW float[numTypes];
 	for(int a = 0; a &lt; numTypes; ++a)
 		damages[a] = other.damages[a];
-}*/
+}
 
 
-/*DamageArray::~DamageArray()
+DamageArray::~DamageArray()
 {
 	delete[] damages;
-}*/
+}

Modified: branches/caiinterface/rts/Sim/Misc/DamageArray.h
===================================================================
--- branches/caiinterface/rts/Sim/Misc/DamageArray.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/Sim/Misc/DamageArray.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -1,9 +1,8 @@
 #ifndef __DAMAGE_ARRAY_H__
 #define __DAMAGE_ARRAY_H__
 
-#include &quot;StdAfx.h&quot;
 #include &lt;algorithm&gt;
-#include &quot;creg/creg.h&quot;
+#include &quot;creg/creg_cond.h&quot;
 
 struct DamageArray
 {
@@ -12,39 +11,14 @@
 public:
 
 	DamageArray();
-
 	/**
 	 * This constructor is currently only used by C++ AIs
 	 * which use the legacy C++ wrapper around the C AI interface.
 	 */
-	DamageArray(int numTypes, const float* typeDamages) :
-			numTypes(numTypes)
-	{
-		damages = new float[numTypes];
-		for(int a = 0; a &lt; numTypes; ++a) {
-			damages[a] = typeDamages[a];
-		}
-	}
+	DamageArray(int numTypes, const float* typeDamages);
+	DamageArray(const DamageArray&amp; other);
+	~DamageArray();
 
-DamageArray(const DamageArray&amp; other)
-{
-	paralyzeDamageTime = other.paralyzeDamageTime;
-	impulseBoost = other.impulseBoost;
-	craterBoost = other.craterBoost;
-	impulseFactor = other.impulseFactor;
-	craterMult = other.craterMult;
-	numTypes = other.numTypes;
-	damages = SAFE_NEW float[numTypes];
-	for(int a = 0; a &lt; numTypes; ++a)
-		damages[a] = other.damages[a];
-}
-
-
-	~DamageArray()
-	{
-		delete[] damages;
-	}
-
 	void operator=(const DamageArray&amp; other) {
 		paralyzeDamageTime = other.paralyzeDamageTime;
 		impulseFactor = other.impulseFactor;
@@ -72,7 +46,9 @@
 	float impulseFactor, impulseBoost, craterMult, craterBoost;
 
 private:
+	#ifdef USING_CREG
 	void creg_Serialize(creg::ISerializer&amp; s);
+	#endif /* USING_CREG */
 
 	int numTypes;
 	float* damages;

Modified: branches/caiinterface/rts/Sim/MoveTypes/MoveInfo.h
===================================================================
--- branches/caiinterface/rts/Sim/MoveTypes/MoveInfo.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/Sim/MoveTypes/MoveInfo.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -4,7 +4,7 @@
 #include &lt;vector&gt;
 #include &lt;map&gt;
 #include &lt;string&gt;
-#include &quot;creg/creg.h&quot;
+#include &quot;creg/creg_cond.h&quot;
 
 class CMoveMath;
 

Modified: branches/caiinterface/rts/Sim/Units/CommandAI/Command.h
===================================================================
--- branches/caiinterface/rts/Sim/Units/CommandAI/Command.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/Sim/Units/CommandAI/Command.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -4,7 +4,7 @@
 #include &lt;string&gt;
 #include &lt;vector&gt;
 #include &lt;limits.h&gt; // for INT_MAX
-#include &quot;creg/creg.h&quot;
+#include &quot;creg/creg_cond.h&quot;
 
 // cmds lower than 0 is reserved for build options (cmd -x = unitdefs[x])
 #define CMD_STOP                   0

Modified: branches/caiinterface/rts/Sim/Units/UnitDef.h
===================================================================
--- branches/caiinterface/rts/Sim/Units/UnitDef.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/Sim/Units/UnitDef.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -6,7 +6,7 @@
 #include &lt;vector&gt;
 #include &lt;map&gt;
 
-#include &quot;creg/creg.h&quot;
+#include &quot;creg/creg_cond.h&quot;
 #include &quot;float3.h&quot;
 #include &quot;Rendering/Icon.h&quot;
 

Modified: branches/caiinterface/rts/System/Platform/SharedLib.cpp
===================================================================
--- branches/caiinterface/rts/System/Platform/SharedLib.cpp	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/System/Platform/SharedLib.cpp	2008-10-09 17:55:40 UTC (rev 6638)
@@ -9,8 +9,8 @@
  */
 
 #if defined BUILDING_AI || defined BUILDING_AI_INTERFACE
-#include &quot;Util.h&quot;
-#include &quot;errorhandler.h&quot;
+//#include &quot;Util.h&quot;
+//#include &quot;errorhandler.h&quot;
 #define SAFE_NEW new
 #else	/* defined BUILDING_AI || defined BUILDING_AI_INTERFACE */
 #include &quot;StdAfx.h&quot;
@@ -67,10 +67,15 @@
 void SharedLib::reportError(const char* errorMsg, const char* fileName, int lineNumber, const char* function) {
 	
 #if defined BUILDING_AI || defined BUILDING_AI_INTERFACE
-	const int MAX_MSG_LENGTH = 511;
-	char s_msg[MAX_MSG_LENGTH + 1];
-	SNPRINTF(s_msg, MAX_MSG_LENGTH, &quot;%s:%d: %s: %s&quot;, fileName, lineNumber, function, errorMsg);
-	handleerror(NULL, s_msg, &quot;Shared Library Error&quot;, MBF_OK | MBF_EXCL);
+	#if defined EXTERNAL_LOGGER
+		const int MAX_MSG_LENGTH = 511;
+		char s_msg[MAX_MSG_LENGTH + 1];
+		SNPRINTF(s_msg, MAX_MSG_LENGTH, &quot;%s:%d: %s: %s&quot;, fileName, lineNumber, function, errorMsg);
+		//handleerror(NULL, s_msg, &quot;Shared Library Error&quot;, MBF_OK | MBF_EXCL);
+		EXTERNAL_LOGGER(s_msg)
+	#else	/* defined EXTERNAL_LOGGER */
+		// DO NOTHING
+	#endif	/* defined EXTERNAL_LOGGER */
 #else	/* defined BUILDING_AI || defined BUILDING_AI_INTERFACE */
 	logOutput.Print(&quot;%s:%d: %s: %s&quot;, fileName, lineNumber, function, errorMsg);
 #endif	/* defined BUILDING_AI || defined BUILDING_AI_INTERFACE */

Modified: branches/caiinterface/rts/System/Platform/Win/DllLib.cpp
===================================================================
--- branches/caiinterface/rts/System/Platform/Win/DllLib.cpp	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/System/Platform/Win/DllLib.cpp	2008-10-09 17:55:40 UTC (rev 6638)
@@ -7,7 +7,7 @@
  * Copyright (C) 2005.  Licensed under the terms of the
  * GNU GPL, v2 or later.
  */
-#include &quot;StdAfx.h&quot;
+
 #include &quot;DllLib.h&quot;
 
 /**

Modified: branches/caiinterface/rts/System/StdAfx.h
===================================================================
--- branches/caiinterface/rts/System/StdAfx.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/System/StdAfx.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -60,9 +60,11 @@
 #include &quot;float3.h&quot;
 #include &quot;GlobalStuff.h&quot;
 #include &quot;System/Util.h&quot;
+#if !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
 #include &quot;Map/Ground.h&quot;
 #include &quot;Map/ReadMap.h&quot;
 #include &quot;Game/Camera.h&quot;
+#endif	/* !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
 #endif // USE_PRECOMPILED_HEADER
 
 #endif	/* __cplusplus */

Added: branches/caiinterface/rts/System/creg/creg_cond.h
===================================================================
--- branches/caiinterface/rts/System/creg/creg_cond.h	                        (rev 0)
+++ branches/caiinterface/rts/System/creg/creg_cond.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -0,0 +1,42 @@
+/* 
+ * Author: hoijui (I am giving the copyright to Jelmer Cnossen)
+ *
+ * Created on October 9, 2008, 7:07 AM
+ */
+
+#ifndef _CREG_COND_H
+#define	_CREG_COND_H
+
+// AIs which want to use creg have to specify this when compiling: '-DUSING_CREG'
+#if (defined BUILDING_AI || defined BUILDING_AI_INTERFACE) &amp;&amp; !defined USING_CREG
+	#define NOT_USING_CREG
+#else	/* defined BUILDING_AI || defined BUILDING_AI_INTERFACE */
+	#ifndef USING_CREG
+		#define USING_CREG
+	#endif	/* USING_CREG */
+	#include &quot;creg/creg.h&quot;
+#endif	/* defined BUILDING_AI || defined BUILDING_AI_INTERFACE */
+
+#ifdef NOT_USING_CREG
+// define all creg preprocessor macros from creg/creg.h to do nothing
+#define CR_DECLARE(TCls)
+#define CR_DECLARE_STRUCT(TStr)
+#define CR_DECLARE_SUB(cl)
+#define CR_BIND_DERIVED(TCls, TBase, ctor_args)
+#define CR_BIND_DERIVED(TCls, TBase, ctor_args)
+#define CR_BIND(TCls, ctor_args)
+#define CR_BIND_DERIVED_INTERFACE(TCls, TBase)
+#define CR_BIND_INTERFACE(TCls)
+#define CR_REG_METADATA(TClass, Members)
+#define CR_REG_METADATA_SUB(TSuperClass, TSubClass, Members)
+#define CR_MEMBER(Member)
+#define CR_ENUM_MEMBER(Member)
+#define CR_RESERVED(Size)
+#define CR_MEMBER_SETFLAG(Member, Flag)
+#define CR_MEMBER_BEGINFLAG(Flag)
+#define CR_MEMBER_ENDFLAG(Flag)
+#define CR_SERIALIZER(SerializeFunc)
+#define CR_POSTLOAD(PostLoadFunc)
+#endif	/* NOT_USING_CREG */
+
+#endif	/* _CREG_COND_H */


Property changes on: branches/caiinterface/rts/System/creg/creg_cond.h
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/caiinterface/rts/System/float3.h
===================================================================
--- branches/caiinterface/rts/System/float3.h	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/System/float3.h	2008-10-09 17:55:40 UTC (rev 6638)
@@ -9,7 +9,7 @@
 
 #include &quot;SFloat3.h&quot;
 #include &quot;lib/streflop/streflop_cond.h&quot;
-#include &quot;creg/creg.h&quot;
+#include &quot;creg/creg_cond.h&quot;
 #include &quot;ExternalAI/Interface/SAIFloat3.h&quot;
 #include &quot;FastMath.h&quot;
 

Modified: branches/caiinterface/rts/build/scons/filelist.py
===================================================================
--- branches/caiinterface/rts/build/scons/filelist.py	2008-10-09 17:10:21 UTC (rev 6637)
+++ branches/caiinterface/rts/build/scons/filelist.py	2008-10-09 17:55:40 UTC (rev 6638)
@@ -117,103 +117,109 @@
 	source = get_source(env, 'rts', exclude_list = exclude)
 	return source
 
+################################################################################
+### AI
+################################################################################
 
+# lists source files for each individual AI Interface, Skirmish and Group AI
 def get_AI_source(env, path, which):
-	return get_source(env, os.path.join(path, which))
+	result = get_source(env, os.path.join(path, which))
+	return result
 
+# lists source files for each individual AI Interface
 def get_AIInterface_source(env, which):
-	return get_AI_source(env, 'AI/Interfaces', which)
+	result = get_AI_source(env, 'AI/Interfaces', which)
+	return result
 
+# lists source files for each individual Skirmish AI
 def get_skirmishAI_source(env, which):
-	return get_AI_source(env, 'AI/Skirmish', which)
+	result = get_AI_source(env, 'AI/Skirmish', which)
+	return result
 
-
+# lists source files for each individual Group AI
 def get_groupAI_source(env, which):
-	return get_AI_source(env, 'AI/Group', which)
+	result = get_AI_source(env, 'AI/Group', which)
+	return result
 
 
-def get_shared_AI_source(env, needLuaParsing = False, needCreg = False):
+# lists source files common for all AI Interfaces, Skirmish and Group AIs
+def get_shared_AI_source(env):
 	result = []
 	if env.has_key('builddir') and env['builddir']:
-		if needLuaParsing:
-			result += [os.path.join(env['builddir'], 'rts/Lua/LuaParser.cpp')]
-			#result += [os.path.join(env['builddir'], 'rts/Lua/LuaSyncedRead.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/Lua/LuaIO.cpp')]
-			#result += [os.path.join(env['builddir'], 'rts/Lua/LuaHandle.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/Lua/LuaUtils.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/Map/MapParser.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/LogOutput.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/FileHandler.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/VFSHandler.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/ArchiveScanner.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/ArchiveFactory.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/ArchiveBase.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/ArchiveBuffered.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/Archive7Zip.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/ArchiveZip.cpp')]
-			result += get_source(env, 'rts/lib/minizip')
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/ArchiveDir.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/ArchiveHPI.cpp')]
-			result += get_source(env, 'rts/lib/hpiutil2')
-			needCreg = True
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/CRC.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/FileSystem/FileFilter.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/System/Platform/FileSystem.cpp')]
-			if env['platform'] == 'windows':
-				result += [os.path.join(env['builddir'], 'rts/System/Platform/Win/WinFileSystemHandler.cpp')]
-				result += [os.path.join(env['builddir'], 'rts/System/Platform/Win/DataDirLocater.cpp')]
-			else:
-				result += [os.path.join(env['builddir'], 'rts/System/Platform/Linux/UnixFileSystemHandler.cpp')]
-				result += [os.path.join(env['builddir'], 'rts/System/Platform/Linux/DataDirLocater.cpp')]
-			result += get_source(env, 'rts/lib/lua/src')
-			result += [os.path.join(env['builddir'], 'rts/System/Platform/ConfigHandler.cpp')]
-			if env['platform'] == 'windows':
-				result += [os.path.join(env['builddir'], 'rts/System/Platform/Win/RegHandler.cpp')]
-			else:
-				result += [os.path.join(env['builddir'], 'rts/System/Platform/Linux/DotfileHandler.cpp')]
-			result += get_source(env, 'rts/lib/7zip')
-
-		if needCreg:
-			result += get_source(env, 'rts/System/creg')
 		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/SInfo.cpp')]
 		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/SOption.cpp')]
 		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/SGAILibrary.cpp')]
 		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/SSAILibrary.cpp')]
 		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/SAIInterfaceLibrary.cpp')]
 		result += [os.path.join(env['builddir'], 'rts/Game/GameVersion.cpp')]
-		#result += [os.path.join(env['builddir'], 'rts/System/Platform/errorhandler.cpp')]
-		#result += [os.path.join(env['builddir'], 'rts/System/LogOutput.cpp')]
+#		result += [os.path.join(env['builddir'], 'rts/System/Platform/errorhandler.cpp')]
 	return result
 
-def get_shared_AIInterface_source(env, needSharedLib, needLuaParsing = False, needCreg = False):
-	result = get_shared_AI_source(env, needLuaParsing, needCreg)
+# lists source files common for all AI Interfaces
+def get_shared_AIInterface_source(env):
+	result = get_shared_AI_source(env)
+	return result
+# list SharedLib source files (used by some AI Interface libraries)
+def get_shared_AIInterface_source_SharedLib(env):
+	result = []
 	if env.has_key('builddir') and env['builddir']:
-		result += [os.path.join(env['builddir'], 'rts/System/Platform/errorhandler.cpp')]
-		#if not needLuaParsing:
-			#result += [os.path.join(env['builddir'], 'rts/System/LogOutput.cpp')]
-		if needSharedLib:
-			result += [os.path.join(env['builddir'], 'rts/System/Platform/SharedLib.cpp')]
-			if env['platform'] == 'windows':
-				result += [os.path.join(env['builddir'], 'rts/System/Platform/Win/DllLib.cpp')]
-			else:
-				result += [os.path.join(env['builddir'], 'rts/System/Platform/Linux/SoLib.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/System/Platform/SharedLib.cpp')]
+		if env['platform'] == 'windows':
+			result += [os.path.join(env['builddir'], 'rts/System/Platform/Win/DllLib.cpp')]
+		else:
+			result += [os.path.join(env['builddir'], 'rts/System/Platform/Linux/SoLib.cpp')]
 	return result
 
-def get_shared_skirmishAI_source(env, isLegacyCPP, needLuaParsing = False, needCreg = False):
-	result = get_shared_AI_source(env, needLuaParsing, needCreg)
+# lists source files common for all Skirmish AIs
+def get_shared_skirmishAI_source(env):
+	result = get_shared_AI_source(env)
+	return result
+# list LegacyCpp source files (used by some Skirmish AI libraries)
+def get_shared_skirmishAI_source_LegacyCpp(env):
+	result = []
 	if env.has_key('builddir') and env['builddir']:
-		if isLegacyCPP:
-			result += [os.path.join(env['builddir'], 'rts/System/float3.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AISCommands.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIAICallback.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIAICheats.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIGlobalAICallback.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIGlobalAI.cpp')]
-			result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AI.cpp')]
-		#result += [os.path.join(env['builddir'], 'rts/System/Platform/errorhandler.cpp')]
-		#result += [os.path.join(env['builddir'], 'rts/System/LogOutput.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/System/float3.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/Sim/Misc/DamageArray.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AISCommands.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIAICallback.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIAICheats.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIGlobalAICallback.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIGlobalAI.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AI.cpp')]
 	return result
+# list Creg source files (used by some Skirmish AI libraries)
+def get_shared_skirmishAI_source_Creg(env):
+	result = []
+	if env.has_key('builddir') and env['builddir']:
+		result += get_source(env, 'rts/System/creg')
+	return result
 
+# lists source files common for all Group AIs
+def get_shared_groupAI_source(env):
+	result = get_shared_AI_source(env)
+	return result
+# list LegacyCpp source files (used by some Group AI libraries)
+def get_shared_groupAI_source_LegacyCpp(env):
+	result = []
+	if env.has_key('builddir') and env['builddir']:
+		result += [os.path.join(env['builddir'], 'rts/System/float3.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/Sim/Misc/DamageArray.cpp')]
+		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AISCommands.cpp')]
+#		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIAICallback.cpp')]
+#		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIAICheats.cpp')]
+#		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIGroupAICallback.cpp')]
+#		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AIGroupAI.cpp')]
+#		result += [os.path.join(env['builddir'], 'rts/ExternalAI/Interface/LegacyCppWrapper/AI.cpp')]
+	return result
+# list Creg source files (used by some Group AI libraries)
+def get_shared_groupAI_source_Creg(env):
+	result = []
+	if env.has_key('builddir') and env['builddir']:
+		result += get_source(env, 'rts/System/creg')
+	return result
+
+
+# lists source directories for AI Interfaces, Skirmish or Group AIs
 def list_AIs(env, path, exclude_list = (), exclude_regexp = '^\.'):
 	exclude = re.compile(exclude_regexp)
 	files = os.listdir(path)
@@ -225,14 +231,14 @@
 				result += [f]
 	return result
 
-
+# lists source directories for AI Interfaces
 def list_AIInterfaces(env, exclude_list = (), exclude_regexp = '^\.'):
 	return list_AIs(env, 'AI/Interfaces', exclude_list, exclude_regexp)
 
-
+# lists source directories for Skirmish AIs
 def list_skirmishAIs(env, exclude_list = (), exclude_regexp = '^\.'):
 	return list_AIs(env, 'AI/Skirmish', exclude_list, exclude_regexp)
 
-
+# lists source directories for Group AIs
 def list_groupAIs(env, exclude_list = (), exclude_regexp = '^\.'):
 	return list_AIs(env, 'AI/Group', exclude_list, exclude_regexp)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001406.html">[Taspring-linux-commit] r6637 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="001408.html">[Taspring-linux-commit] r6639 - in branches/caiinterface: .	AI/Skirmish Documentation installer	installer/freedesktop/applications installer/freedesktop/mime	installer/sections rts/Game rts/Game/Camera rts/Game/UI	rts/Rendering rts/Rendering/Env rts/Sim/Misc	rts/Sim/MoveTypes rts/Sim/Weapons tools/DedicatedServer	tools/springie tools/springie/Springie	tools/springie/Springie/Properties tools/springie/Springie/autohost	tools/springie/Springie/client tools/springie/Springie/doc	tools/springie/Springie/spring tools/springie/Springie/utils	tools/springie/libs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1407">[ date ]</a>
              <a href="thread.html#1407">[ thread ]</a>
              <a href="subject.html#1407">[ subject ]</a>
              <a href="author.html#1407">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
