<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6714 - in branches/caiinterface: .	installer/sections rts rts/ExternalAI rts/Game	rts/Game/StartScripts rts/Game/UI rts/Lua rts/Map/SMF	rts/Rendering rts/Rendering/GL rts/Sim/Features rts/Sim/Misc	rts/Sim/MoveTypes rts/Sim/Objects	rts/Sim/Projectiles/Unsynced rts/Sim/Units	rts/Sim/Units/CommandAI rts/Sim/Units/UnitTypes rts/System	rts/System/Platform rts/System/Platform/Linux	rts/System/Platform/Win rts/build/kdevelop rts/lib tools	tools/DedicatedServer tools/unitsync
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6714%20-%20in%20branches/caiinterface%3A%20.%0A%09installer/sections%20rts%20rts/ExternalAI%20rts/Game%0A%09rts/Game/StartScripts%20rts/Game/UI%20rts/Lua%20rts/Map/SMF%0A%09rts/Rendering%20rts/Rendering/GL%20rts/Sim/Features%20rts/Sim/Misc%0A%09rts/Sim/MoveTypes%20rts/Sim/Objects%0A%09rts/Sim/Projectiles/Unsynced%20rts/Sim/Units%0A%09rts/Sim/Units/CommandAI%20rts/Sim/Units/UnitTypes%20rts/System%0A%09rts/System/Platform%20rts/System/Platform/Linux%0A%09rts/System/Platform/Win%20rts/build/kdevelop%20rts/lib%20tools%0A%09tools/DedicatedServer%20tools/unitsync&In-Reply-To=%3C20081014095625.8B0004730%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001482.html">
   <LINK REL="Next"  HREF="001484.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6714 - in branches/caiinterface: .	installer/sections rts rts/ExternalAI rts/Game	rts/Game/StartScripts rts/Game/UI rts/Lua rts/Map/SMF	rts/Rendering rts/Rendering/GL rts/Sim/Features rts/Sim/Misc	rts/Sim/MoveTypes rts/Sim/Objects	rts/Sim/Projectiles/Unsynced rts/Sim/Units	rts/Sim/Units/CommandAI rts/Sim/Units/UnitTypes rts/System	rts/System/Platform rts/System/Platform/Linux	rts/System/Platform/Win rts/build/kdevelop rts/lib tools	tools/DedicatedServer tools/unitsync</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6714%20-%20in%20branches/caiinterface%3A%20.%0A%09installer/sections%20rts%20rts/ExternalAI%20rts/Game%0A%09rts/Game/StartScripts%20rts/Game/UI%20rts/Lua%20rts/Map/SMF%0A%09rts/Rendering%20rts/Rendering/GL%20rts/Sim/Features%20rts/Sim/Misc%0A%09rts/Sim/MoveTypes%20rts/Sim/Objects%0A%09rts/Sim/Projectiles/Unsynced%20rts/Sim/Units%0A%09rts/Sim/Units/CommandAI%20rts/Sim/Units/UnitTypes%20rts/System%0A%09rts/System/Platform%20rts/System/Platform/Linux%0A%09rts/System/Platform/Win%20rts/build/kdevelop%20rts/lib%20tools%0A%09tools/DedicatedServer%20tools/unitsync&In-Reply-To=%3C20081014095625.8B0004730%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6714 - in branches/caiinterface: .	installer/sections rts rts/ExternalAI rts/Game	rts/Game/StartScripts rts/Game/UI rts/Lua rts/Map/SMF	rts/Rendering rts/Rendering/GL rts/Sim/Features rts/Sim/Misc	rts/Sim/MoveTypes rts/Sim/Objects	rts/Sim/Projectiles/Unsynced rts/Sim/Units	rts/Sim/Units/CommandAI rts/Sim/Units/UnitTypes rts/System	rts/System/Platform rts/System/Platform/Linux	rts/System/Platform/Win rts/build/kdevelop rts/lib tools	tools/DedicatedServer tools/unitsync">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Tue Oct 14 11:56:25 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001482.html">[Taspring-linux-commit] r6713 - trunk/rts/Game
</A></li>
        <LI>Next message: <A HREF="001484.html">[Taspring-linux-commit] r6715 - trunk/rts/Rendering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1483">[ date ]</a>
              <a href="thread.html#1483">[ thread ]</a>
              <a href="subject.html#1483">[ subject ]</a>
              <a href="author.html#1483">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-10-14 11:56:24 +0200 (Tue, 14 Oct 2008)
New Revision: 6714

Removed:
   branches/caiinterface/tools/springie/
Modified:
   branches/caiinterface/CMakeLists.txt
   branches/caiinterface/installer/sections/docs.nsh
   branches/caiinterface/rts/CMakeLists.txt
   branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp
   branches/caiinterface/rts/ExternalAI/AILibraryManager.h
   branches/caiinterface/rts/ExternalAI/IAILibraryManager.cpp
   branches/caiinterface/rts/ExternalAI/IAILibraryManager.h
   branches/caiinterface/rts/Game/Game.cpp
   branches/caiinterface/rts/Game/GameHelper.cpp
   branches/caiinterface/rts/Game/GameServer.cpp
   branches/caiinterface/rts/Game/GameServer.h
   branches/caiinterface/rts/Game/GameVersion.cpp
   branches/caiinterface/rts/Game/GameVersion.h
   branches/caiinterface/rts/Game/StartScripts/ScriptHandler.cpp
   branches/caiinterface/rts/Game/Team.cpp
   branches/caiinterface/rts/Game/Team.h
   branches/caiinterface/rts/Game/UI/GameInfo.cpp
   branches/caiinterface/rts/Lua/LuaConstGame.cpp
   branches/caiinterface/rts/Lua/LuaSyncedCtrl.cpp
   branches/caiinterface/rts/Lua/LuaSyncedMoveCtrl.cpp
   branches/caiinterface/rts/Lua/LuaUnitDefs.cpp
   branches/caiinterface/rts/Map/SMF/BFGroundTextures.cpp
   branches/caiinterface/rts/Rendering/FartextureHandler.cpp
   branches/caiinterface/rts/Rendering/GL/myGL.cpp
   branches/caiinterface/rts/Rendering/GroundDecalHandler.cpp
   branches/caiinterface/rts/Sim/Features/Feature.cpp
   branches/caiinterface/rts/Sim/Misc/CollisionHandler.cpp
   branches/caiinterface/rts/Sim/Misc/CollisionVolume.h
   branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.cpp
   branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.h
   branches/caiinterface/rts/Sim/MoveTypes/ScriptMoveType.cpp
   branches/caiinterface/rts/Sim/Objects/SolidObject.cpp
   branches/caiinterface/rts/Sim/Objects/SolidObject.h
   branches/caiinterface/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp
   branches/caiinterface/rts/Sim/Units/CommandAI/CommandAI.cpp
   branches/caiinterface/rts/Sim/Units/CommandAI/MobileCAI.cpp
   branches/caiinterface/rts/Sim/Units/Unit.cpp
   branches/caiinterface/rts/Sim/Units/Unit.h
   branches/caiinterface/rts/Sim/Units/UnitDef.h
   branches/caiinterface/rts/Sim/Units/UnitDefHandler.cpp
   branches/caiinterface/rts/Sim/Units/UnitLoader.cpp
   branches/caiinterface/rts/Sim/Units/UnitTypes/Factory.cpp
   branches/caiinterface/rts/System/BaseNetProtocol.cpp
   branches/caiinterface/rts/System/BaseNetProtocol.h
   branches/caiinterface/rts/System/DemoRecorder.cpp
   branches/caiinterface/rts/System/GlobalStuff.cpp
   branches/caiinterface/rts/System/LoadSaveHandler.cpp
   branches/caiinterface/rts/System/Platform/BaseCmd.cpp
   branches/caiinterface/rts/System/Platform/ConfigHandler.cpp
   branches/caiinterface/rts/System/Platform/Linux/DataDirLocater.cpp
   branches/caiinterface/rts/System/Platform/Win/AVIGenerator.cpp
   branches/caiinterface/rts/System/Platform/Win/CrashHandler.cpp
   branches/caiinterface/rts/System/SpringApp.cpp
   branches/caiinterface/rts/build/kdevelop/rts.kdevelop
   branches/caiinterface/rts/lib/CMakeLists.txt
   branches/caiinterface/tools/DedicatedServer/CMakeLists.txt
   branches/caiinterface/tools/unitsync/CMakeLists.txt
Log:
* reintegrated trunk
* new: issueing warnings for multipli defined AIs and AI interfaces (multiple *Info.lua files for one of them)
* added --list-group-ais and --list-ai-interfaces command line options, in addition to --listskirmish-ais
* the above mentioned 3 command line options now issue warnings for multipli defined entries as well

Modified: branches/caiinterface/CMakeLists.txt
===================================================================
--- branches/caiinterface/CMakeLists.txt	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/CMakeLists.txt	2008-10-14 09:56:24 UTC (rev 6714)
@@ -52,6 +52,7 @@
 	set (SDL_LIBRARY SDL)
 	set (Boost_REGEX_LIBRARY boost_regex-mt)
 	set (Boost_THREAD_LIBRARY boost_thread-mt)
+	set (Boost_FILESYSTEM_LIBRARY boost_filesystem-mt)
 	set (IL_ILU_LIBRARY ILU)
 	set (DEVIL_LIBRARIES &quot;devil ${IL_ILU_LIBRARY}&quot;)
 else (MINGW)
@@ -59,7 +60,7 @@
 	FIND_PACKAGE(SDL REQUIRED)
 	INCLUDE_DIRECTORIES(${SDL_INCLUDE_DIR})
 
-	FIND_PACKAGE(Boost 1.34.0 COMPONENTS thread regex REQUIRED)
+	FIND_PACKAGE(Boost 1.34.0 COMPONENTS thread regex filesystem REQUIRED)
 	INCLUDE_DIRECTORIES(${Boost_INCLUDE_DIR})
 	
 	FIND_PACKAGE(Devil REQUIRED)

Modified: branches/caiinterface/installer/sections/docs.nsh
===================================================================
--- branches/caiinterface/installer/sections/docs.nsh	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/installer/sections/docs.nsh	2008-10-14 09:56:24 UTC (rev 6714)
@@ -4,7 +4,6 @@
   File &quot;..\LICENSE.html&quot;
   File &quot;..\Documentation\changelog.txt&quot;
   File &quot;..\Documentation\cmds.txt&quot;
-  File &quot;..\Documentation\lobbychangelog.txt&quot;
   Delete &quot;$INSTDIR\docs\xtachanges.txt&quot;
 
   File &quot;..\Documentation\userdocs\Q&amp;A.html&quot;
@@ -18,7 +17,6 @@
   Delete &quot;$INSTDIR\docs\LICENSE.html&quot;
   Delete &quot;$INSTDIR\docs\changelog.txt&quot;
   Delete &quot;$INSTDIR\docs\cmds.txt&quot;
-  Delete &quot;$INSTDIR\docs\lobbychangelog.txt&quot;
   Delete &quot;$INSTDIR\docs\Q&amp;A.html&quot;
   Delete &quot;$INSTDIR\docs\Getting Started.html&quot;
   Delete &quot;$INSTDIR\docs\Legal.html&quot;

Modified: branches/caiinterface/rts/CMakeLists.txt
===================================================================
--- branches/caiinterface/rts/CMakeLists.txt	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/CMakeLists.txt	2008-10-14 09:56:24 UTC (rev 6714)
@@ -2,23 +2,6 @@
 
 INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/ System)
 
-if (NOT COMPLETE_BUILD)
-	### Compiler flags and defines based on build type
-	INCLUDE(TestCXXAcceptsVisibilityFlag)
-	SET(BASE_FLAGS &quot;-fsingle-precision-constant -frounding-math -fsignaling-nans -mieee-fp -pipe -fno-strict-aliasing&quot;)
-	IF (NOT $ENV{CXX} MATCHES &quot;icpc&quot;)
-		SET(BASE_FLAGS &quot;${BASE_FLAGS} -march=i686 -mfpmath=387&quot;)
-	ENDIF (NOT $ENV{CXX} MATCHES &quot;icpc&quot;)
-	IF (UNIX)
-		SET(BASE_FLAGS &quot;${BASE_FLAGS} -pthread&quot;)
-	ENDIF (UNIX)
-	SET(CMAKE_CXX_FLAGS_DEBUG   &quot;${BASE_FLAGS} -ggdb1 -O1 -Wall -DDEBUG -D_DEBUG -DNO_CATCH_EXCEPTIONS&quot;)
-	SET(CMAKE_CXX_FLAGS_DEBUG2  &quot;${BASE_FLAGS} -ggdb2 -O0 -Wall -DDEBUG -D_DEBUG -DNO_CATCH_EXCEPTIONS&quot;)
-	SET(CMAKE_CXX_FLAGS_DEBUG3  &quot;${BASE_FLAGS} -ggdb3 -O0 -Wall -DDEBUG -D_DEBUG -DNO_CATCH_EXCEPTIONS&quot;)
-	SET(CMAKE_CXX_FLAGS_RELEASE &quot;${BASE_FLAGS} ${VISIBILITY_HIDDEN} -O2 -DNDEBUG -fomit-frame-pointer&quot;)
-	SET(CMAKE_CXX_FLAGS_PROFILE   &quot;${BASE_FLAGS} -O2 -pg -Wall -DNDEBUG&quot;)
-endif (NOT COMPLETE_BUILD)
-
 ### Spring defines
 SET(USE_MMGR FALSE CACHE BOOL &quot;Use memory manager?&quot;)
 if (USE_MMGR)
@@ -43,27 +26,31 @@
 ### Find include directories and add platform specific libraries
 IF (MINGW)
 	FIND_PACKAGE(Win32Libs REQUIRED)
-	LIST(APPEND spring_libraries glu32 ilu opengl32 ${WIN32_LIBRARIES} glew32 mingw32 devil)
-	LIST(APPEND spring_libraries boost_thread-mt boost_regex-mt)
+	LIST(APPEND spring_libraries glu32 opengl32 ${WIN32_LIBRARIES} glew32 mingw32)
+	#TODO make FindLibraryX work with mingwlibs
+	set (VORBISFILE_LIBRARY vorbisfile)
+	set(VORBIS_LIBRARY vorbis)
+	set (OGG_LIBRARY ogg)
+	set(FREETYPE_LIBRARIES freetype)
 ELSE (MINGW)
-	FIND_PACKAGE(Boost 1.34.0 COMPONENTS thread regex filesystem REQUIRED)
-
 	FIND_PACKAGE(X11 REQUIRED)
 	FIND_PACKAGE(OpenAL REQUIRED)
+	if (NOT OPENAL_FOUND)
+		message (SEND_ERROR &quot;OpenAL libraries not found&quot;)
+	endif (NOT OPENAL_FOUND)
 	FIND_PACKAGE(OpenGL REQUIRED)
 	FIND_PACKAGE(GLU REQUIRED)
 	FIND_PACKAGE(GLUT REQUIRED)
 	FIND_PACKAGE(GLEW REQUIRED)
-	FIND_PACKAGE(Devil REQUIRED)
 	FIND_PACKAGE(OggVorbis REQUIRED)
 
 	FIND_PACKAGE(Freetype REQUIRED)
 	INCLUDE_DIRECTORIES(${FREETYPE_INCLUDE_DIR})
-	LIST(APPEND spring_libraries openal GL GLU ${DEVIL_LIBRARIES} X11 Xcursor ${GLEW_LIBRARIES} ${Boost_REGEX_LIBRARY} ${Boost_THREAD_LIBRARY} ${Boost_FILESYSTEM_LIBRARY})
+	LIST(APPEND spring_libraries ${OPENAL_LIBRARY} ${OPENGL_gl_LIBRARY} ${OPENGL_glu_LIBRARY} ${X11_X11_LIB} ${X11_Xcursor_LIB} ${GLEW_LIBRARIES})
 ENDIF (MINGW)
 
 ### libraries needed on all platforms
-LIST(APPEND spring_libraries SDL vorbisfile vorbis ogg freetype)
+LIST(APPEND spring_libraries  ${SDL_LIBRARY} ${Boost_REGEX_LIBRARY} ${Boost_THREAD_LIBRARY} ${Boost_FILESYSTEM_LIBRARY} ${VORBISFILE_LIBRARY} ${VORBIS_LIBRARY} ${OGG_LIBRARY} ${FREETYPE_LIBRARIES} ${DEVIL_LIBRARIES} )
 
 ### build all libraries in lib (has its own CMakeLists.txt)
 ADD_SUBDIRECTORY(lib)
@@ -73,7 +60,7 @@
 endif (USE_GML)
 
 ### include directories needed for compiling spring
-INCLUDE_DIRECTORIES(lib/lua/include lib/luabind)
+INCLUDE_DIRECTORIES(BEFORE lib/lua/include lib/luabind)
 
 ### all spring source directories
 ### each directorie which contains source has to be here

Modified: branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/ExternalAI/AILibraryManager.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -30,12 +30,11 @@
 #include &quot;FileSystem/FileHandler.h&quot;
 #include &quot;LogOutput.h&quot;
 
-#include &lt;map&gt;
 #include &lt;string&gt;
+#include &lt;set&gt;
 #include &lt;sstream&gt;
-#include &lt;vector&gt;
+
 #include &lt;limits.h&gt;
-//#include &lt;fstream&gt;
 #include &lt;string.h&gt;
 
 
@@ -179,6 +178,9 @@
 	// AI/Interfaces/data/ * / * /InterfaceInfo.lua
 	T_dirs aiInterfaceDataDirs =
 			FindDirsAndDirectSubDirs(AI_INTERFACES_DATA_DIR);
+	typedef std::map&lt;const SAIInterfaceSpecifier, std::set&lt;std::string&gt;,
+			SAIInterfaceSpecifier_Comparator&gt; T_dupInt;
+	T_dupInt duplicateInterfaceInfoCheck;
 	for (T_dirs::iterator dir = aiInterfaceDataDirs.begin();
 			dir != aiInterfaceDataDirs.end(); ++dir) {
 		const std::string&amp; possibleDataDir = *dir;
@@ -194,18 +196,37 @@
 			std::string v = interfaceInfo-&gt;GetVersion();
 			SAIInterfaceSpecifier interfaceSpecifier = {sn.c_str(), v.c_str()};
 			interfaceSpecifier = copySAIInterfaceSpecifier(&amp;interfaceSpecifier);
-			interfaceSpecifiers.push_back(interfaceSpecifier);
+			interfaceSpecifiers.insert(interfaceSpecifier);
 			interfaceInfos[interfaceSpecifier] = interfaceInfo;
+			
+			// so we can check if one interface is specified multiple times
+			duplicateInterfaceInfoCheck[interfaceSpecifier].insert(infoFile.at(0));
 		}
 	}
 	
+	// filter out interfaces that are specified multiple times
+	for (T_dupInt::const_iterator info = duplicateInterfaceInfoCheck.begin();
+			info != duplicateInterfaceInfoCheck.end(); ++info) {
+		if (info-&gt;second.size() &gt;= 2) {
+			duplicateInterfaceInfos[info-&gt;first] = info-&gt;second;
+			
+			logOutput.Print(&quot;WARNING: Duplicate AI Interface Info found:&quot;);
+			logOutput.Print(&quot;\tfor interface: %s %s&quot;, info-&gt;first.shortName,
+					info-&gt;first.version);
+			logOutput.Print(&quot;\tin files:&quot;);
+			std::set&lt;std::string&gt;::const_iterator dir;
+			for (dir = info-&gt;second.begin(); dir != info-&gt;second.end(); ++dir) {
+				logOutput.Print(&quot;\t%s&quot;, dir-&gt;c_str());
+			}
+		}
+	}
 	
-	
 	// Read from Skirmish AI info and option files
 	// we are looking for:
 	// AI/Skirmish/data/ * /AIInfo.lua
 	// AI/Skirmish/data/ * / * /AIInfo.lua
 	T_dirs skirmishAIDataDirs = FindDirsAndDirectSubDirs(SKIRMISH_AI_DATA_DIR);
+	T_dupSkirm duplicateSkirmishAIInfoCheck;
 	for (T_dirs::iterator dir = skirmishAIDataDirs.begin();
 			dir != skirmishAIDataDirs.end(); ++dir) {
 		const std::string&amp; possibleDataDir = *dir;
@@ -233,18 +254,39 @@
 			if (interfaceSpecifier.shortName != NULL) {
 				aiSpecifier = copySSAISpecifier(&amp;aiSpecifier);
 				SSAIKey skirmishAIKey = {interfaceSpecifier, aiSpecifier};
-				skirmishAIKeys.push_back(skirmishAIKey);
+				skirmishAIKeys.insert(skirmishAIKey);
 				skirmishAIInfos[skirmishAIKey] = skirmishAIInfo;
+			
+				// so we can check if one skirmish AI is specified multiple times
+				duplicateSkirmishAIInfoCheck[skirmishAIKey].insert(infoFile.at(0));
 			}
 		}
 	}
 	
+	// filter out skirmish AIs that are specified multiple times
+	for (T_dupSkirm::const_iterator info = duplicateSkirmishAIInfoCheck.begin();
+			info != duplicateSkirmishAIInfoCheck.end(); ++info) {
+		if (info-&gt;second.size() &gt;= 2) {
+			duplicateSkirmishAIInfos[info-&gt;first] = info-&gt;second;
+			
+			logOutput.Print(&quot;WARNING: Duplicate Skirmish AI Info found:&quot;);
+			logOutput.Print(&quot;\tfor Skirmish AI: %s %s&quot;, info-&gt;first.ai.shortName,
+					info-&gt;first.ai.version);
+			logOutput.Print(&quot;\tin files:&quot;);
+			std::set&lt;std::string&gt;::const_iterator dir;
+			for (dir = info-&gt;second.begin(); dir != info-&gt;second.end(); ++dir) {
+				logOutput.Print(&quot;\t%s&quot;, dir-&gt;c_str());
+			}
+		}
+	}
 	
+	
 	// Read from Group AI info and option files
 	// we are looking for:
 	// AI/Group/data/ * /AIInfo.lua
 	// AI/Group/data/ * / * /AIInfo.lua
 	T_dirs groupAIDataDirs = FindDirsAndDirectSubDirs(GROUP_AI_DATA_DIR);
+	T_dupGroup duplicateGroupAIInfoCheck;
 	for (T_dirs::iterator dir = groupAIDataDirs.begin();
 			dir != groupAIDataDirs.end(); ++dir) {
 		const std::string&amp; possibleDataDir = *dir;
@@ -272,12 +314,31 @@
 			if (interfaceSpecifier.shortName != NULL) {
 				aiSpecifier = copySGAISpecifier(&amp;aiSpecifier);
 				SGAIKey groupAIKey = {interfaceSpecifier, aiSpecifier};
-				groupAIKeys.push_back(groupAIKey);
+				groupAIKeys.insert(groupAIKey);
 				groupAIInfos[groupAIKey] = groupAIInfo;
+			
+				// so we can check if one group AI is specified multiple times
+				duplicateGroupAIInfoCheck[groupAIKey].insert(infoFile.at(0));
 			}
 		}
 	}
 	
+	// filter out group AIs that are specified multiple times
+	for (T_dupGroup::const_iterator info = duplicateGroupAIInfoCheck.begin();
+			info != duplicateGroupAIInfoCheck.end(); ++info) {
+		if (info-&gt;second.size() &gt;= 2) {
+			duplicateGroupAIInfos[info-&gt;first] = info-&gt;second;
+			
+			logOutput.Print(&quot;WARNING: Duplicate Group AI Info found:&quot;);
+			logOutput.Print(&quot;\tfor Group AI: %s %s&quot;, info-&gt;first.ai.shortName,
+					info-&gt;first.ai.version);
+			logOutput.Print(&quot;\tin files:&quot;);
+			std::set&lt;std::string&gt;::const_iterator dir;
+			for (dir = info-&gt;second.begin(); dir != info-&gt;second.end(); ++dir) {
+				logOutput.Print(&quot;\t%s&quot;, dir-&gt;c_str());
+			}
+		}
+	}
 	
 /*
 	std::vector&lt;std::string&gt; infoFiles =
@@ -340,19 +401,19 @@
 }
 void CAILibraryManager::ClearAllInfos() {
 	
-	std::map&lt;const SAIInterfaceSpecifier, CAIInterfaceLibraryInfo*&gt;::iterator iii;
+	IAILibraryManager::T_interfaceInfos::iterator iii;
 	for (iii=interfaceInfos.begin(); iii!=interfaceInfos.end(); iii++) {
 		delete iii-&gt;second;
 		iii-&gt;second = NULL;
 	}
 	
-	std::map&lt;const SSAIKey, CSkirmishAILibraryInfo*&gt;::iterator sai;
+	IAILibraryManager::T_skirmishAIInfos::iterator sai;
 	for (sai=skirmishAIInfos.begin(); sai!=skirmishAIInfos.end(); sai++) {
 		delete sai-&gt;second;
 		sai-&gt;second = NULL;
 	}
 	
-	std::map&lt;const SGAIKey, CGroupAILibraryInfo*&gt;::iterator gai;
+	IAILibraryManager::T_groupAIInfos::iterator gai;
 	for (gai=groupAIInfos.begin(); gai!=groupAIInfos.end(); gai++) {
 		delete gai-&gt;second;
 		gai-&gt;second = NULL;
@@ -372,34 +433,34 @@
 	ReleaseEverything();
 
 	// delete all strings contained in skirmish AI specifiers
-	std::vector&lt;SSAIKey&gt;::iterator sSpec;
+	IAILibraryManager::T_skirmishAIKeys::iterator sSpec;
 	for (sSpec=skirmishAIKeys.begin(); sSpec!=skirmishAIKeys.end(); sSpec++) {
 		deleteSSAISpecifier(&amp;(sSpec-&gt;ai));
 	}
 	
 	// delete all strings contained in group AI specifiers
-	std::vector&lt;SGAIKey&gt;::iterator gSpec;
+	IAILibraryManager::T_groupAIKeys::iterator gSpec;
 	for (gSpec=groupAIKeys.begin(); gSpec!=groupAIKeys.end(); gSpec++) {
 		deleteSGAISpecifier(&amp;(gSpec-&gt;ai));
 	}
 	
 	// delete all strings contained in interface specifiers
-	std::vector&lt;SAIInterfaceSpecifier&gt;::iterator iSpec;
+	IAILibraryManager::T_interfaceSpecs::iterator iSpec;
 	for (iSpec=interfaceSpecifiers.begin(); iSpec!=interfaceSpecifiers.end(); iSpec++) {
 		deleteSAIInterfaceSpecifier(&amp;(*iSpec));
 	}
 }
 
-const std::vector&lt;SAIInterfaceSpecifier&gt;* CAILibraryManager::GetInterfaceSpecifiers() const {
+const IAILibraryManager::T_interfaceSpecs* CAILibraryManager::GetInterfaceSpecifiers() const {
 	return &interfaceSpecifiers;
 }
-const std::vector&lt;SSAIKey&gt;* CAILibraryManager::GetSkirmishAIKeys() const {
+const IAILibraryManager::T_skirmishAIKeys* CAILibraryManager::GetSkirmishAIKeys() const {
 	return &skirmishAIKeys;
 }
-const std::vector&lt;SGAIKey&gt;* CAILibraryManager::GetGroupAIKeys() const {
+const IAILibraryManager::T_groupAIKeys* CAILibraryManager::GetGroupAIKeys() const {
 	return &groupAIKeys;
 }
-	
+
 const IAILibraryManager::T_interfaceInfos* CAILibraryManager::GetInterfaceInfos() const {
 	return &interfaceInfos;
 }
@@ -410,9 +471,19 @@
 	return &groupAIInfos;
 }
 
+const IAILibraryManager::T_dupInt* CAILibraryManager::GetDuplicateInterfaceInfos() const {
+	return &duplicateInterfaceInfos;
+}
+const IAILibraryManager::T_dupSkirm* CAILibraryManager::GetDuplicateSkirmishAIInfos() const {
+	return &duplicateSkirmishAIInfos;
+}
+const IAILibraryManager::T_dupGroup* CAILibraryManager::GetDuplicateGroupAIInfos() const {
+	return &duplicateGroupAIInfos;
+}
 
 
-std::vector&lt;SSAIKey&gt; CAILibraryManager::ResolveSkirmishAIKey(const SSAISpecifier&amp; skirmishAISpecifier) const {
+std::vector&lt;SSAIKey&gt; CAILibraryManager::ResolveSkirmishAIKey(
+		const SSAISpecifier&amp; skirmishAISpecifier) const {
 	
 	std::vector&lt;SSAIKey&gt; applyingKeys;
 	
@@ -429,7 +500,7 @@
 		checkVersion = true;
 	}
 	
-	std::vector&lt;SSAIKey&gt;::const_iterator sasi;
+	std::set&lt;SSAIKey&gt;::const_iterator sasi;
 	for (sasi=skirmishAIKeys.begin(); sasi!=skirmishAIKeys.end(); sasi++) {
 
 		// check if the ai name fits
@@ -462,7 +533,7 @@
 		return applyingKeys;
 	}
 	
-	std::vector&lt;SSAIKey&gt;::const_iterator sasi;
+	std::set&lt;SSAIKey&gt;::const_iterator sasi;
 	for (sasi=skirmishAIKeys.begin(); sasi!=skirmishAIKeys.end(); sasi++) {
 
 		// check if the ai name fits
@@ -531,7 +602,7 @@
 		return applyingKeys;
 	}
 	
-	std::vector&lt;SGAIKey&gt;::const_iterator gasi;
+	std::set&lt;SGAIKey&gt;::const_iterator gasi;
 	for (gasi=groupAIKeys.begin(); gasi!=groupAIKeys.end(); gasi++) {
 
 		// check if the ai name fits
@@ -673,9 +744,9 @@
 SAIInterfaceSpecifier CAILibraryManager::FindFittingInterfaceSpecifier(
 		const std::string&amp; shortName,
 		const std::string&amp; minVersion,
-		const std::vector&lt;SAIInterfaceSpecifier&gt;&amp; specs) {
+		const T_interfaceSpecs&amp; specs) {
 	
-	std::vector&lt;SAIInterfaceSpecifier&gt;::const_iterator spec;
+	std::set&lt;SAIInterfaceSpecifier&gt;::const_iterator spec;
 	int minDiff = INT_MAX;
 	const char* chosenShortName = NULL;
 	const char* chosenVersion = NULL;

Modified: branches/caiinterface/rts/ExternalAI/AILibraryManager.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/AILibraryManager.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/ExternalAI/AILibraryManager.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -25,6 +25,10 @@
 #include &quot;SkirmishAILibraryInfo.h&quot;
 #include &quot;GroupAILibraryInfo.h&quot;
 
+#include &lt;vector&gt;
+#include &lt;map&gt;
+#include &lt;set&gt;
+
 class CAILibraryManager : public IAILibraryManager {
 private:
 //	typedef s_cont&lt;ISkirmishAILibraryInterfaceInfo&gt;::vector T_interfaceInfos;
@@ -39,13 +43,17 @@
 	CAILibraryManager(); // looks for interface and AIs supported by them (ret != 0: error)
 	~CAILibraryManager(); // unloads all shared libraries that are currently loaded (interfaces and implementations)
 	
-	virtual const std::vector&lt;SAIInterfaceSpecifier&gt;* GetInterfaceSpecifiers() const;
-	virtual const std::vector&lt;SSAIKey&gt;* GetSkirmishAIKeys() const;
-	virtual const std::vector&lt;SGAIKey&gt;* GetGroupAIKeys() const;
+	virtual const T_interfaceSpecs* GetInterfaceSpecifiers() const;
+	virtual const T_skirmishAIKeys* GetSkirmishAIKeys() const;
+	virtual const T_groupAIKeys* GetGroupAIKeys() const;
 	
 	virtual const T_interfaceInfos* GetInterfaceInfos() const;
 	virtual const T_skirmishAIInfos* GetSkirmishAIInfos() const;
 	virtual const T_groupAIInfos* GetGroupAIInfos() const;
+	
+	virtual const T_dupInt* GetDuplicateInterfaceInfos() const;
+	virtual const T_dupSkirm* GetDuplicateSkirmishAIInfos() const;
+	virtual const T_dupGroup* GetDuplicateGroupAIInfos() const;
 
 	virtual std::vector&lt;SSAIKey&gt; ResolveSkirmishAIKey(const SSAISpecifier&amp; skirmishAISpecifier) const;
 	virtual std::vector&lt;SSAIKey&gt; ResolveSkirmishAIKey(const std::string&amp; skirmishAISpecifier) const;
@@ -74,9 +82,9 @@
 	typedef std::map&lt;const SAIInterfaceSpecifier, IAIInterfaceLibrary*, SAIInterfaceSpecifier_Comparator&gt; T_loadedInterfaces;
 	T_loadedInterfaces loadedAIInterfaceLibraries;
 	
-	std::vector&lt;SAIInterfaceSpecifier&gt; interfaceSpecifiers;
-	std::vector&lt;SSAIKey&gt; skirmishAIKeys;
-	std::vector&lt;SGAIKey&gt; groupAIKeys;
+	T_interfaceSpecs interfaceSpecifiers;
+	T_skirmishAIKeys skirmishAIKeys;
+	T_groupAIKeys groupAIKeys;
 //	std::vector&lt;const SAIInterfaceSpecifier&gt; interfaceLibrarySpecifiers;
 //	std::vector&lt;const SSAIKey&gt; skirmishAILibrarySpecifiers;
 //	std::vector&lt;const SGAIKey&gt; groupAILibrarySpecifiers;
@@ -85,6 +93,10 @@
 	T_interfaceInfos interfaceInfos;
 	T_skirmishAIInfos skirmishAIInfos;
 	T_groupAIInfos groupAIInfos;
+	
+	T_dupInt duplicateInterfaceInfos;
+	T_dupSkirm duplicateSkirmishAIInfos;
+	T_dupGroup duplicateGroupAIInfos;
 //	T_interfaceInfos interfaceInfos;
 //	T_infoKeys infoKeys;
 ////	typedef s_cont&lt;ISkirmishAILibraryInfo&gt;::vector T_aiInfos;
@@ -177,7 +189,7 @@
 	static SAIInterfaceSpecifier FindFittingInterfaceSpecifier(
 			const std::string&amp; shortName,
 			const std::string&amp; minVersion,
-			const std::vector&lt;SAIInterfaceSpecifier&gt;&amp; specs);
+			const T_interfaceSpecs&amp; specs);
 	static int versionCompare(
 			const std::string&amp; version1,
 			const std::string&amp; version2);

Modified: branches/caiinterface/rts/ExternalAI/IAILibraryManager.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/IAILibraryManager.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/ExternalAI/IAILibraryManager.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -22,6 +22,7 @@
 #include &quot;AILibraryManager.h&quot;
 
 #include &lt;iostream&gt;
+#include &lt;c++/4.2/bits/basic_string.h&gt;
 
 IAILibraryManager* IAILibraryManager::myAILibraryManager = NULL;
 
@@ -34,29 +35,114 @@
 	return myAILibraryManager;
 }
 
+std::string fillUpTo(const std::string&amp; str, unsigned int numChars) {
+	
+	std::string filler = &quot;&quot;;
+	
+	filler.append(numChars - str.size(), ' ');
+
+	return filler;
+}
+
+void IAILibraryManager::OutputAIInterfacesInfo() {
+
+	const IAILibraryManager* myLibManager = IAILibraryManager::GetInstance();
+	const T_interfaceSpecs* specs =
+			myLibManager-&gt;GetInterfaceSpecifiers();
+	
+	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
+	std::cout &lt;&lt; &quot;# Available Spring Skirmish AIs&quot; &lt;&lt; std::endl;
+	std::cout &lt;&lt; &quot;# -----------------------------&quot; &lt;&lt; std::endl;
+	std::cout &lt;&lt; &quot;# [Name]              [Version]&quot; &lt;&lt; std::endl;
+	
+	T_interfaceSpecs::const_iterator spec;
+    for (spec=specs-&gt;begin(); spec != specs-&gt;end(); spec++) {
+		std::cout &lt;&lt; &quot;  &quot;;
+		std::cout &lt;&lt; spec-&gt;shortName &lt;&lt; fillUpTo(spec-&gt;shortName, 20);
+		std::cout &lt;&lt; spec-&gt;version &lt;&lt; fillUpTo(spec-&gt;version, 20) &lt;&lt; std::endl;
+    }
+	
+	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
+}
+
 void IAILibraryManager::OutputSkirmishAIInfo() {
 
 	const IAILibraryManager* myLibManager = IAILibraryManager::GetInstance();
-	const std::vector&lt;SSAIKey&gt;* keys = myLibManager-&gt;GetSkirmishAIKeys();
+	const T_skirmishAIKeys* keys = myLibManager-&gt;GetSkirmishAIKeys();
 	
 	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
 	std::cout &lt;&lt; &quot;# Available Spring Skirmish AIs&quot; &lt;&lt; std::endl;
 	std::cout &lt;&lt; &quot;# -----------------------------&quot; &lt;&lt; std::endl;
-	std::cout &lt;&lt; &quot;# [Name]\t[Version]\t[Interface-name]\t[Interface-version]&quot; &lt;&lt; std::endl;
+	std::cout &lt;&lt; &quot;# [Name]              [Version]           &quot;
+			&quot;[Interface-name]    [Interface-version]&quot; &lt;&lt; std::endl;
 	
-	std::vector&lt;SSAIKey&gt;::const_iterator key;
+	T_skirmishAIKeys::const_iterator key;
     for (key=keys-&gt;begin(); key != keys-&gt;end(); key++) {
 		std::cout &lt;&lt; &quot;  &quot;;
-		std::cout &lt;&lt; key-&gt;ai.shortName &lt;&lt; &quot;\t\t&quot;;
-		std::cout &lt;&lt; key-&gt;ai.version &lt;&lt; &quot;\t\t&quot;;
-		std::cout &lt;&lt; key-&gt;interface.shortName &lt;&lt; &quot;\t\t\t&quot;;
-		std::cout &lt;&lt; key-&gt;interface.version;
-		std::cout &lt;&lt; std::endl;
+		std::cout &lt;&lt; key-&gt;ai.shortName &lt;&lt; fillUpTo(key-&gt;ai.shortName, 20);
+		std::cout &lt;&lt; key-&gt;ai.version &lt;&lt; fillUpTo(key-&gt;ai.version, 20);
+		std::cout &lt;&lt; key-&gt;interface.shortName
+				&lt;&lt; fillUpTo(key-&gt;interface.shortName, 20);
+		std::cout &lt;&lt; key-&gt;interface.version &lt;&lt; std::endl;
     }
 	
+	const T_dupSkirm* duplicateSkirmishAIInfos =
+			myLibManager-&gt;GetDuplicateSkirmishAIInfos();
+	for (T_dupSkirm::const_iterator info = duplicateSkirmishAIInfos-&gt;begin();
+			info != duplicateSkirmishAIInfos-&gt;end(); ++info) {
+		std::cout &lt;&lt; &quot;# WARNING: Duplicate Skirmish AI Info found:&quot;
+				&lt;&lt; std::endl;
+		std::cout &lt;&lt; &quot;# \tfor Skirmish AI: &quot; &lt;&lt; info-&gt;first.ai.shortName
+				&lt;&lt; &quot; &quot; &lt;&lt; info-&gt;first.ai.version &lt;&lt; std::endl;
+		std::cout &lt;&lt; &quot;# \tin files:&quot; &lt;&lt; std::endl;
+		std::set&lt;std::string&gt;::const_iterator dir;
+		for (dir = info-&gt;second.begin(); dir != info-&gt;second.end(); ++dir) {
+			std::cout &lt;&lt; &quot;# \t&quot; &lt;&lt; dir-&gt;c_str() &lt;&lt; std::endl;
+		}
+	}
+	
 	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
 }
+
+void IAILibraryManager::OutputGroupAIInfo() {
 	
+	const IAILibraryManager* myLibManager = IAILibraryManager::GetInstance();
+	const T_groupAIKeys* keys = myLibManager-&gt;GetGroupAIKeys();
+	
+	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
+	std::cout &lt;&lt; &quot;# Available Spring Group AIs&quot; &lt;&lt; std::endl;
+	std::cout &lt;&lt; &quot;# --------------------------&quot; &lt;&lt; std::endl;
+	std::cout &lt;&lt; &quot;# [Name]              [Version]           &quot;
+			&quot;[Interface-name]    [Interface-version]&quot; &lt;&lt; std::endl;
+	
+	T_groupAIKeys::const_iterator key;
+    for (key=keys-&gt;begin(); key != keys-&gt;end(); key++) {
+		std::cout &lt;&lt; &quot;  &quot;;
+		std::cout &lt;&lt; key-&gt;ai.shortName &lt;&lt; fillUpTo(key-&gt;ai.shortName, 20);
+		std::cout &lt;&lt; key-&gt;ai.version &lt;&lt; fillUpTo(key-&gt;ai.version, 20);
+		std::cout &lt;&lt; key-&gt;interface.shortName
+				&lt;&lt; fillUpTo(key-&gt;interface.shortName, 20);
+		std::cout &lt;&lt; key-&gt;interface.version &lt;&lt; std::endl;
+    }
+	
+	const T_dupGroup* duplicateGroupAIInfos =
+			myLibManager-&gt;GetDuplicateGroupAIInfos();
+	for (T_dupGroup::const_iterator info = duplicateGroupAIInfos-&gt;begin();
+			info != duplicateGroupAIInfos-&gt;end(); ++info) {
+		std::cout &lt;&lt; &quot;# WARNING: Duplicate Group AI Info found:&quot;
+				&lt;&lt; std::endl;
+		std::cout &lt;&lt; &quot;# \tfor Group AI: &quot; &lt;&lt; info-&gt;first.ai.shortName
+				&lt;&lt; &quot; &quot; &lt;&lt; info-&gt;first.ai.version &lt;&lt; std::endl;
+		std::cout &lt;&lt; &quot;# \tin files:&quot; &lt;&lt; std::endl;
+		std::set&lt;std::string&gt;::const_iterator dir;
+		for (dir = info-&gt;second.begin(); dir != info-&gt;second.end(); ++dir) {
+			std::cout &lt;&lt; &quot;# \t&quot; &lt;&lt; dir-&gt;c_str() &lt;&lt; std::endl;
+		}
+	}
+	
+	std::cout &lt;&lt; &quot;#&quot; &lt;&lt; std::endl;
+}
+	
 bool IAILibraryManager::SplittAIKey(const std::string&amp; key,
 		std::string* aiName,
 		std::string* aiVersion,

Modified: branches/caiinterface/rts/ExternalAI/IAILibraryManager.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/IAILibraryManager.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/ExternalAI/IAILibraryManager.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -20,77 +20,56 @@
 
 #include &quot;IAIInterfaceLibrary.h&quot;
 #include &quot;ISkirmishAILibrary.h&quot;
-//#include &quot;SkirmishAILibraryKey.h&quot;
-
-//#include &quot;AIInterfaceLibraryInfo.h&quot;
-struct SSAIKey;
-struct SGAIKey;
 #include &quot;AIInterfaceLibraryInfo.h&quot;
 #include &quot;SkirmishAILibraryInfo.h&quot;
 #include &quot;GroupAILibraryInfo.h&quot;
 
+#include &lt;vector&gt;
+#include &lt;map&gt;
+#include &lt;set&gt;
+
+struct SSAIKey;
+struct SGAIKey;
+
 /**
  * @brief manages AIs and AI interfaces
  */
 class IAILibraryManager {
-//public:
-//	typedef s_cont&lt;ISkirmishAILibraryInterfaceInfo&gt;::const_vector T_interfaceInfos_const;
-//	typedef s_cont&lt;CSkirmishAILibraryInfoKey&gt;::const_vector T_infoKeys_const;
-////	typedef s_cont&lt;ISkirmishAILibraryInfo&gt;::const_vector T_aiInfos_const;
-//	typedef s_cont&lt;std::string&gt;::const_vector T_specifiers_const;
 	
 public:
 	virtual ~IAILibraryManager() {}
-////	virtual ISkirmishAILibraryManager() = 0; // looks for interface and AIs supported by them (ret != 0: error)
-////	virtual ~ISkirmishAILibraryManager() = 0; // unloads all shared libraries that are currently loaded (interfaces and implementations)
-//
-//	virtual T_interfaceInfos_const GetInterfaceInfos() const = 0;
-//	virtual T_infoKeys_const GetInfoKeys() const = 0;
-////	virtual const std::vector&lt;const ISkirmishAILibraryInfo*&gt;* GetAIInfos() const = 0;
-////	virtual const std::vector&lt;const ISkirmishAILibraryInfo*&gt;* GetInterfaceAIs(const SAIInterfaceLibraryInfo&amp; interfaceInfo) const = 0;
-//
-//	virtual T_specifiers_const GetSpecifiers() const = 0;
-//	virtual T_infoKeys_const GetApplyingInfoKeys(const std::string&amp; specifier) const {
-//		
-//		T_infoKeys_const applyingInfoKeys;
-//		
-//		const T_infoKeys_const infoKeys = GetInfoKeys();
-//		T_infoKeys_const::const_iterator infoKey;
-//		for (infoKey=infoKeys.begin(); infoKey!=infoKeys.end(); infoKey++) {
-//			if ((*infoKey)-&gt;IsApplyingSpecifier(specifier)) {
-//				applyingInfoKeys.push_back(*infoKey);
-//			}
-//		}
-//		
-//		return applyingInfoKeys;
-//	}
-//
-//	// an AI is only really loaded when it is not yet loaded.
-//	virtual const s_p&lt;const CSkirmishAILibraryKey&gt; LoadAI(const CSkirmishAILibraryInfoKey&amp; infoKey) = 0;
-//	// an AI is only unloaded when UnloadAI() is called
-//	// as many times as LoadAI() was.
-//	// loading and unloading of the interfaces
-//	// is handled internally/automatically.
-////	virtual int UnloadAI(const CSkirmishAILibraryKey&amp; key) = 0;
-//	virtual void UnloadAI(const CSkirmishAILibraryInfoKey&amp; infoKey) = 0;
-//	
-//	virtual int UnloadEverything() = 0; // unloads all currently loaded AIs and interfaces
-//	faces and implementations)
 	
-	virtual const std::vector&lt;SAIInterfaceSpecifier&gt;* GetInterfaceSpecifiers() const = 0;
-	virtual const std::vector&lt;SSAIKey&gt;* GetSkirmishAIKeys() const = 0;
-	virtual const std::vector&lt;SGAIKey&gt;* GetGroupAIKeys() const = 0;
+	typedef std::set&lt;SAIInterfaceSpecifier, SAIInterfaceSpecifier_Comparator&gt; T_interfaceSpecs;
+	typedef std::set&lt;SSAIKey, SSAIKey_Comparator&gt; T_skirmishAIKeys;
+	typedef std::set&lt;SGAIKey, SGAIKey_Comparator&gt; T_groupAIKeys;
 	
-//	virtual const std::map&lt;const SAIInterfaceSpecifier, CAIInterfaceLibraryInfo*&gt;* GetInterfaceInfos() const = 0;
-//	virtual const std::map&lt;const SSAIKey, CSkirmishAILibraryInfo*&gt;* GetSkirmishAIInfos() const = 0;
-//	virtual const std::map&lt;const SGAIKey, CGroupAILibraryInfo*&gt;* GetGroupAIInfos() const = 0;
-	typedef std::map&lt;const SAIInterfaceSpecifier, CAIInterfaceLibraryInfo*, SAIInterfaceSpecifier_Comparator&gt; T_interfaceInfos;
-	typedef std::map&lt;const SSAIKey, CSkirmishAILibraryInfo*, SSAIKey_Comparator&gt; T_skirmishAIInfos;
-	typedef std::map&lt;const SGAIKey, CGroupAILibraryInfo*, SGAIKey_Comparator&gt; T_groupAIInfos;
+	virtual const T_interfaceSpecs* GetInterfaceSpecifiers() const = 0;
+	virtual const T_skirmishAIKeys* GetSkirmishAIKeys() const = 0;
+	virtual const T_groupAIKeys* GetGroupAIKeys() const = 0;
 	
+	typedef std::map&lt;const SAIInterfaceSpecifier, CAIInterfaceLibraryInfo*,
+			SAIInterfaceSpecifier_Comparator&gt; T_interfaceInfos;
+	typedef std::map&lt;const SSAIKey, CSkirmishAILibraryInfo*, SSAIKey_Comparator&gt;
+			T_skirmishAIInfos;
+	typedef std::map&lt;const SGAIKey, CGroupAILibraryInfo*, SGAIKey_Comparator&gt;
+			T_groupAIInfos;
+	
 	virtual const T_interfaceInfos* GetInterfaceInfos() const = 0;
 	virtual const T_skirmishAIInfos* GetSkirmishAIInfos() const = 0;
 	virtual const T_groupAIInfos* GetGroupAIInfos() const = 0;
+	
+	typedef std::map&lt;const SAIInterfaceSpecifier, std::set&lt;std::string&gt;,
+			SAIInterfaceSpecifier_Comparator&gt; T_dupInt;
+	typedef std::map&lt;const SSAIKey, std::set&lt;std::string&gt;, SSAIKey_Comparator&gt;
+			T_dupSkirm;
+	typedef std::map&lt;const SGAIKey, std::set&lt;std::string&gt;, SGAIKey_Comparator&gt;
+			T_dupGroup;
+	
+	// The following three methods return sets of files which contain duplicate
+	// infos. These methods can be used for issueing warnings.
+	virtual const T_dupInt* GetDuplicateInterfaceInfos() const = 0;
+	virtual const T_dupSkirm* GetDuplicateSkirmishAIInfos() const = 0;
+	virtual const T_dupGroup* GetDuplicateGroupAIInfos() const = 0;
 
 	virtual std::vector&lt;SSAIKey&gt; ResolveSkirmishAIKey(const SSAISpecifier&amp; skirmishAISpecifier) const = 0;
 	virtual std::vector&lt;SSAIKey&gt; ResolveSkirmishAIKey(const std::string&amp; skirmishAISpecifier) const = 0;
@@ -118,7 +97,9 @@
 public:
 	/* guaranteed to not return NULL */
 	static IAILibraryManager* GetInstance();
+	static void OutputAIInterfacesInfo();
 	static void OutputSkirmishAIInfo();
+	static void OutputGroupAIInfo();
 private:
 	static IAILibraryManager* myAILibraryManager;
 	

Modified: branches/caiinterface/rts/Game/Game.cpp
===================================================================
--- branches/caiinterface/rts/Game/Game.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/Game.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -510,10 +510,11 @@
 	net-&gt;loading = false;
 	thread.join();
 #ifdef USE_GML
-	logOutput.Print(&quot;Spring %s MT (%d threads)&quot;,VERSION_STRING, gmlThreadCount);
+	logOutput.Print(&quot;Spring %s MT (%d threads)&quot;,VERSION_STRING_DETAILED, gmlThreadCount);
 #else
-	logOutput.Print(&quot;Spring %s&quot;,VERSION_STRING);
+	logOutput.Print(&quot;Spring %s&quot;,VERSION_STRING_DETAILED);
 #endif
+	logOutput.Print(&quot;Build date/time: %s&quot;, BUILD_DATETIME);
 	//sending your playername to the server indicates that you are finished loading
 	net-&gt;Send(CBaseNetProtocol::Get().SendPlayerName(gu-&gt;myPlayerNum, p-&gt;name));
 
@@ -2376,12 +2377,7 @@
 					}
 				}
 				if (!hasPlayer) {
-					for (std::list&lt;CUnit*&gt;::iterator ui=uh-&gt;activeUnits.begin();ui!=uh-&gt;activeUnits.end();++ui) {
-						CUnit* unit = *ui;
-						if ((unit-&gt;team == a) &amp;&amp; (unit-&gt;selfDCountdown == 0)) {
-							unit-&gt;ChangeTeam(sendTeam, CUnit::ChangeGiven);
-						}
-					}
+					gs-&gt;Team(a)-&gt;GiveEverythingTo(sendTeam);
 				}
 			}
 		}
@@ -3859,16 +3855,6 @@
 
 				switch (action)
 				{
-					case TEAMMSG_SELFD: {
-						if (numPlayersInTeam == 1) {
-							gs-&gt;Team(fromTeam)-&gt;SelfDestruct();
-							gs-&gt;Team(fromTeam)-&gt;leader = -1;
-						} else {
-							gs-&gt;players[player]-&gt;StartSpectating();
-						}
-						CPlayer::UpdateControlledTeams();
-						break;
-					}
 					case TEAMMSG_GIVEAWAY: {
 						const int toTeam = inbuf[3];
 						if (numPlayersInTeam == 1) {

Modified: branches/caiinterface/rts/Game/GameHelper.cpp
===================================================================
--- branches/caiinterface/rts/Game/GameHelper.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/GameHelper.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -305,7 +305,7 @@
 				CollisionVolume* cv = 0x0;
 				float3 error = (!gu-&gt;spectatingFullView)?
 					// relative error, since MouseHit() translates by relMidPos
-					(unit-&gt;midPos - GetUnitErrorPos(unit, gu-&gt;myAllyTeam)):
+					(GetUnitErrorPos(unit, gu-&gt;myAllyTeam) - unit-&gt;midPos):
 					ZeroVector;
 
 				if (unit-&gt;isIcon) {

Modified: branches/caiinterface/rts/Game/GameServer.cpp
===================================================================
--- branches/caiinterface/rts/Game/GameServer.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/GameServer.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -15,7 +15,7 @@
 #if defined DEDICATED || defined DEBUG
 #include &lt;iostream&gt;
 #endif
-#include &lt;malloc.h&gt;
+#include &lt;stdlib.h&gt; // why is this here?
 
 #include &quot;mmgr.h&quot;
 
@@ -121,7 +121,7 @@
 #endif
 	hasLocalClient = false;
 	localClientNumber = 0;
-	IsPaused = false;
+	isPaused = false;
 	userSpeedFactor = 1.0f;
 	internalSpeed = 1.0f;
 	gamePausable = true;
@@ -236,7 +236,7 @@
 		if (UDPNet)
 			UDPNet-&gt;Update();
 		lastUpdate = SDL_GetTicks();
-		IsPaused = true;
+		isPaused = true;
 	}
 	else
 	{
@@ -261,7 +261,7 @@
 	netcode::RawPacket* buf = 0;
 	while ( (buf = demoReader-&gt;GetData(modGameTime)) )
 	{
-		unsigned msgCode = static_cast&lt;unsigned&gt;(buf-&gt;data[0]);
+		unsigned msgCode = buf-&gt;data[0];
 		if (msgCode == NETMSG_NEWFRAME || msgCode == NETMSG_KEYFRAME)
 		{
 			// we can't use CreateNewFrame() here
@@ -297,7 +297,7 @@
 
 void CGameServer::Broadcast(boost::shared_ptr&lt;const netcode::RawPacket&gt; packet)
 {
-	for (unsigned p = 0; p &lt; static_cast&lt;unsigned&gt;(MAX_PLAYERS); ++p)
+	for (int p = 0; p &lt; MAX_PLAYERS; ++p)
 	{
 		if (players[p])
 			players[p]-&gt;link-&gt;SendData(packet);
@@ -371,7 +371,7 @@
 #ifdef SYNCDEBUG
 				CSyncDebugger::GetInstance()-&gt;ServerTriggerSyncErrorHandling(serverframenum);
 				Broadcast(CBaseNetProtocol::Get().SendPause(gu-&gt;myPlayerNum, true));
-				IsPaused = true;
+				isPaused = true;
 				Broadcast(CBaseNetProtocol::Get().SendSdCheckrequest(serverframenum));
 #endif
 				//For each group, output a message with list of playernames in it.
@@ -408,7 +408,7 @@
 
 void CGameServer::Update()
 {
-	if (!IsPaused &amp;&amp; !WaitsOnCon())
+	if (!isPaused &amp;&amp; !WaitsOnCon())
 	{
 		modGameTime += float(SDL_GetTicks() - lastUpdate) * 0.001f * internalSpeed;
 	}
@@ -484,7 +484,7 @@
 	if ((SDL_GetTicks() - serverStartTime) &gt; serverTimeout)
 	{
 		bool hasPlayers = false;
-		for (unsigned i = 0; i &lt; static_cast&lt;unsigned&gt;(MAX_PLAYERS); ++i)
+		for (int i = 0; i &lt; MAX_PLAYERS; ++i)
 		{
 			if (players[i])
 				hasPlayers = true;
@@ -517,8 +517,8 @@
 				if(gamePausable || players[a]-&gt;isLocal) // allow host to pause even if nopause is set
 				{
 					timeLeft=0;
-					if (IsPaused != !!inbuf[2]) {
-						IsPaused ? IsPaused = false : IsPaused = true;
+					if (isPaused != !!inbuf[2]) {
+						isPaused = !isPaused;
 					}
 					Broadcast(CBaseNetProtocol::Get().SendPause(inbuf[1],inbuf[2]));
 				}
@@ -580,7 +580,7 @@
 
 		case NETMSG_CHAT: {
 			ChatMessage msg(packet);
-			if (static_cast&lt;unsigned&gt;(msg.fromPlayer) != a ) {
+			if (msg.fromPlayer != a ) {
 				Warning(str(format(WrongPlayer) %(unsigned)NETMSG_CHAT %a %(unsigned)msg.fromPlayer));
 			} else {
 				GotChatMessage(msg);
@@ -773,16 +773,6 @@
 							
 				switch (action)
 				{
-					case TEAMMSG_SELFD: {
-						Broadcast(CBaseNetProtocol::Get().SendSelfD(player));
-						if (numPlayersInTeam &lt;= 1 &amp;&amp; teams[fromTeam])
-						{
-							teams[fromTeam].reset();
-						}
-						players[player]-&gt;team = 0;
-						players[player]-&gt;spectator = true;
-						break;
-					}
 					case TEAMMSG_GIVEAWAY: {
 						const unsigned toTeam = inbuf[3];
 						Broadcast(CBaseNetProtocol::Get().SendGiveAwayEverything(player, toTeam));
@@ -823,7 +813,7 @@
 						if (teams[team])
 #endif
 						{
-							teams[fromTeam].reset();
+							teams[team].reset();
 							for (int i = 0; i &lt; MAX_PLAYERS; ++i)
 							{
 								if (players[i] &amp;&amp; players[i]-&gt;team == team)
@@ -857,7 +847,7 @@
 		}
 		case NETMSG_CCOMMAND: {
 			CommandMessage msg(packet);
-			if (static_cast&lt;unsigned&gt;(msg.player) == a)
+			if (msg.player == a)
 			{
 				if ((commandBlacklist.find(msg.action.command) != commandBlacklist.end()) &amp;&amp; players[a]-&gt;isLocal)
 				{
@@ -1006,7 +996,7 @@
 		if (setup &amp;&amp; (unsigned)setup-&gt;myPlayerNum == start)
 			start++;
 #endif
-		for (unsigned a = start; a &lt; (unsigned)setup-&gt;numPlayers; a++) {
+		for (int a = start; a &lt; setup-&gt;numPlayers; a++) {
 			if (!players[a] || !players[a]-&gt;readyToStart) {
 				allReady = false;
 				break;
@@ -1202,7 +1192,7 @@
 	}
 	else if (action.command == &quot;singlestep&quot;)
 	{
-		if (IsPaused &amp;&amp; !demoReader)
+		if (isPaused &amp;&amp; !demoReader)
 			gameServer-&gt;CreateNewFrame(true, true);
 	}
 	else
@@ -1233,15 +1223,15 @@
 		return;
 	}
 
-	unsigned numActiveAllyTeams = 0;
+	int numActiveAllyTeams = 0;
 
 #ifndef DEDICATED
-	unsigned numActiveTeams[MAX_TEAMS]; // active teams per ally team
+	int numActiveTeams[MAX_TEAMS]; // active teams per ally team
 	memset(numActiveTeams, 0, sizeof(numActiveTeams));
-	for (unsigned a = 0; (int)a &lt; gs-&gt;activeTeams; ++a)
+	for (int a = 0; a &lt; gs-&gt;activeTeams; ++a)
 	{
 		bool hasPlayer = false;
-		for (unsigned b = 0; b &lt; static_cast&lt;unsigned&gt;(gs-&gt;activePlayers); ++b) {
+		for (int b = 0; b &lt; gs-&gt;activePlayers; ++b) {
 			if (gs-&gt;players[b]-&gt;active &amp;&amp; gs-&gt;players[b]-&gt;team == static_cast&lt;int&gt;(a) &amp;&amp; !gs-&gt;players[b]-&gt;spectator) {
 				hasPlayer = true;
 			}
@@ -1253,12 +1243,12 @@
 			++numActiveTeams[gs-&gt;AllyTeam(a)];
 	}
 
-	for (unsigned a = 0; (int)a &lt; gs-&gt;activeAllyTeams; ++a)
+	for (int a = 0; a &lt; gs-&gt;activeAllyTeams; ++a)
 		if (numActiveTeams[a] != 0)
 			++numActiveAllyTeams;
 #else
 	int firstAllyTeam = -1;
-	for (unsigned i = 0; i &lt; MAX_PLAYERS; ++i)
+	for (int i = 0; i &lt; MAX_PLAYERS; ++i)
 	{
 		if (players[i] &amp;&amp; !players[i]-&gt;spectator)
 		{
@@ -1320,8 +1310,8 @@
 #ifndef NO_AVI
 		rec = game &amp;&amp; game-&gt;creatingVideo;
 #endif
-		bool normalFrame = !IsPaused &amp;&amp; !rec;
-		bool videoFrame = !IsPaused &amp;&amp; fixedFrameTime;
+		bool normalFrame = !isPaused &amp;&amp; !rec;
+		bool videoFrame = !isPaused &amp;&amp; fixedFrameTime;
 		bool singleStep = fixedFrameTime &amp;&amp; !rec;
 	
 		if(normalFrame || videoFrame || singleStep){
@@ -1407,7 +1397,7 @@
 	}
 	if (players[hisNewNumber])
 	{
-		for (unsigned p = 0; p &lt; static_cast&lt;unsigned&gt;(MAX_PLAYERS); ++p)
+		for (int p = 0; p &lt; MAX_PLAYERS; ++p)
 		{
 			if (!players[p])
 			{
@@ -1480,7 +1470,7 @@
 void CGameServer::GotChatMessage(const ChatMessage&amp; msg)
 {
 	Broadcast(boost::shared_ptr&lt;const RawPacket&gt;(msg.Pack()));
-	if (hostif &amp;&amp; static_cast&lt;unsigned&gt;(msg.fromPlayer) != SERVER_PLAYER) {
+	if (hostif &amp;&amp; msg.fromPlayer != SERVER_PLAYER) {
 		// don't echo packets to autohost
 		hostif-&gt;SendPlayerChat(msg.fromPlayer, msg.msg);
 	}

Modified: branches/caiinterface/rts/Game/GameServer.h
===================================================================
--- branches/caiinterface/rts/Game/GameServer.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/GameServer.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -150,7 +150,7 @@
 	unsigned lastUpdate;
 	float modGameTime;
 
-	bool IsPaused;
+	bool isPaused;
 	float userSpeedFactor;
 	float internalSpeed;
 	bool cheating;

Modified: branches/caiinterface/rts/Game/GameVersion.cpp
===================================================================
--- branches/caiinterface/rts/Game/GameVersion.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/GameVersion.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -6,5 +6,15 @@
 
 #include &quot;GameVersion.h&quot;
 
-/** The game version. */
+// IMPORTANT NOTE: external systems sed -i this file so DO NOT CHANGE without
+// major thought in advance, and deliberation with bibim and tvo/Tobi!
+
+/** The game version as it's returned by unitsync and Spring on commandline.
+This version string is the one that's used to check sync. */
 const char* const VERSION_STRING = &quot;0.77b3+&quot;;
+
+/** The game version as it's printed to infolog, for e.g. stacktrace translator. */
+const char* const VERSION_STRING_DETAILED = &quot;0.77b3+&quot;;
+
+/** Build date and time. */
+const char* const BUILD_DATETIME = __DATE__ &quot; &quot; __TIME__;

Modified: branches/caiinterface/rts/Game/GameVersion.h
===================================================================
--- branches/caiinterface/rts/Game/GameVersion.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/GameVersion.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -2,5 +2,7 @@
 #define GAMEVERSION_H
 
 extern const char* const VERSION_STRING;
+extern const char* const VERSION_STRING_DETAILED;
+extern const char* const BUILD_DATETIME;
 
 #endif

Modified: branches/caiinterface/rts/Game/StartScripts/ScriptHandler.cpp
===================================================================
--- branches/caiinterface/rts/Game/StartScripts/ScriptHandler.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/StartScripts/ScriptHandler.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -48,9 +48,9 @@
 	loaded_scripts.push_back( SAFE_NEW CSpawnScript(true) );
 	loaded_scripts.push_back( SAFE_NEW CTestScript() );
 
-	const std::vector&lt;SSAIKey&gt;* skirmishAIKeys = IAILibraryManager::GetInstance()-&gt;GetSkirmishAIKeys();
+	const IAILibraryManager::T_skirmishAIKeys* skirmishAIKeys = IAILibraryManager::GetInstance()-&gt;GetSkirmishAIKeys();
 	
-	std::vector&lt;SSAIKey&gt;::const_iterator ai, e;
+	IAILibraryManager::T_skirmishAIKeys::const_iterator ai, e;
 	for(ai=skirmishAIKeys-&gt;begin(), e=skirmishAIKeys-&gt;end(); ai != e; ++ai) {
 		loaded_scripts.push_back(SAFE_NEW CGlobalAITestScript(*ai));
 	}

Modified: branches/caiinterface/rts/Game/Team.cpp
===================================================================
--- branches/caiinterface/rts/Game/Team.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/Team.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -194,9 +194,9 @@
 }
 
 
-void CTeam::AddMetal(float amount)
+void CTeam::AddMetal(float amount, bool hc)
 {
-	amount *= handicap;
+	if (hc) { amount *= handicap; }
 	metal += amount;
 	metalIncome += amount;
 	if (metal &gt; metalStorage) {
@@ -206,9 +206,9 @@
 }
 
 
-void CTeam::AddEnergy(float amount)
+void CTeam::AddEnergy(float amount, bool hc)
 {
-	amount *= handicap;
+	if (hc) { amount *= handicap; }
 	energy += amount;
 	energyIncome += amount;
 	if (energy &gt; energyStorage) {
@@ -217,23 +217,6 @@
 	}
 }
 
-
-void CTeam::SelfDestruct()
-{
-	for (CUnitSet::iterator ui = units.begin(); ui != units.end(); ++ui) {
-		CUnit* unit = (*ui);
-		if (unit != NULL &amp;&amp; unit-&gt;unitDef-&gt;canSelfD) {
-			if (unit-&gt;beingBuilt) {
-				unit-&gt;KillUnit(false, true, NULL); // kill units under construction without explosion
-			} else {
-				unit-&gt;KillUnit(true, false, NULL);
-			}
-		}
-	}
-	Died();
-}
-
-
 void CTeam::GiveEverythingTo(const unsigned toTeam)
 {
 	CTeam* target = gs-&gt;Team(toTeam);
@@ -251,7 +234,7 @@
 		target-&gt;energy += energy;
 		energy = 0;
 	}
-	
+
 	for (CUnitSet::iterator ui = units.begin(); ui != units.end(); ) {
 		// must pass the normal checks, isDead, unit count restrictions, luaRules, etc...
 		CUnitSet::iterator next = ui; ++next;
@@ -423,7 +406,7 @@
 		case AddCaptured: {
 			currentStats.unitsCaptured++;
 			break;
-		}	
+		}
 	}
 	if (unit-&gt;unitDef-&gt;isCommander) {
 		numCommanders++;

Modified: branches/caiinterface/rts/Game/Team.h
===================================================================
--- branches/caiinterface/rts/Game/Team.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/Team.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -22,8 +22,8 @@
 	void SlowUpdate();
 
 
-	void AddMetal(float amount);
-	void AddEnergy(float amount);
+	void AddMetal(float amount, bool handicap = true);
+	void AddEnergy(float amount, bool handicap = true);
 	bool UseEnergy(float amount);
 	bool UseMetal(float amount);
 	bool UseEnergyUpkeep(float amount);
@@ -31,8 +31,7 @@
 
 	void SetBaseMetalStorage(float storage) {metalStorage = storage;};
 	void SetBaseEnergyStorage(float storage) {energyStorage = storage;};
-	
-	void SelfDestruct();
+
 	void GiveEverythingTo(const unsigned toTeam);
 	
 	void Died();

Modified: branches/caiinterface/rts/Game/UI/GameInfo.cpp
===================================================================
--- branches/caiinterface/rts/Game/UI/GameInfo.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Game/UI/GameInfo.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -167,10 +167,10 @@
 	labels.push_back(&quot;Game Version:&quot;);
 #ifdef USE_GML
 	char ver[64];
-	sprintf(ver, &quot;%s MT (%d threads)&quot;, VERSION_STRING, gmlThreadCount);
+	sprintf(ver, &quot;%s MT (%d threads)&quot;, VERSION_STRING_DETAILED, gmlThreadCount);
 	values.push_back(ver);
 #else
-	values.push_back(VERSION_STRING);
+	values.push_back(VERSION_STRING_DETAILED);
 #endif
 	labels.push_back(&quot;Game Speed:&quot;);
 	values.push_back(gs-&gt;speedFactor);

Modified: branches/caiinterface/rts/Lua/LuaConstGame.cpp
===================================================================
--- branches/caiinterface/rts/Lua/LuaConstGame.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Lua/LuaConstGame.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -57,7 +57,7 @@
 	lua_pushlstring(L, (const char*)game-&gt;gameID, sizeof(game-&gt;gameID));
 	lua_rawset(L, -3);
 
-	LuaPushNamedString(L, &quot;version&quot;,       VERSION_STRING);
+	LuaPushNamedString(L, &quot;version&quot;,       VERSION_STRING_DETAILED);
 
 	LuaPushNamedNumber(L, &quot;maxUnits&quot;,      MAX_UNITS);
 	LuaPushNamedNumber(L, &quot;maxTeams&quot;,      MAX_TEAMS);

Modified: branches/caiinterface/rts/Lua/LuaSyncedCtrl.cpp
===================================================================
--- branches/caiinterface/rts/Lua/LuaSyncedCtrl.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Lua/LuaSyncedCtrl.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -1508,14 +1508,24 @@
 	if (!lua_isboolean(L, 2)) {
 		luaL_error(L, &quot;Incorrect arguments to SetUnitBlocking()&quot;);
 	}
-	const bool longTerm = lua_isboolean(L, 3) &amp;&amp; lua_toboolean(L, 3);
+
 	if (lua_toboolean(L, 2)) {
-		if (longTerm) { unit-&gt;blocking = true; }
 		unit-&gt;Block();
 	} else {
 		unit-&gt;UnBlock();
-		if (longTerm) { unit-&gt;blocking = false; }
 	}
+
+	if (lua_isboolean(L, 3)) {
+		// change the collidable state
+		unit-&gt;blocking = lua_toboolean(L, 3);
+
+		// run this again so that we are removed from
+		// the blocking map if unit-&gt;blocking was set
+		// to false but arg. #2 was true (no point in
+		// being registered on the map then)
+		unit-&gt;Block();
+	}
+
 	return 0;
 }
 

Modified: branches/caiinterface/rts/Lua/LuaSyncedMoveCtrl.cpp
===================================================================
--- branches/caiinterface/rts/Lua/LuaSyncedMoveCtrl.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Lua/LuaSyncedMoveCtrl.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -509,6 +509,9 @@
 	if ((args &lt; 2) || !lua_isboolean(L, 2)) {
 		luaL_error(L, &quot;Incorrect arguments to SetNoBlocking()&quot;);
 	}
+
+	// marks or unmarks the unit on the blocking-map, but
+	// does not change its blocking (collidable) state
 	moveType-&gt;SetNoBlocking(lua_toboolean(L, 2));
 	return 0;
 }

Modified: branches/caiinterface/rts/Lua/LuaUnitDefs.cpp
===================================================================
--- branches/caiinterface/rts/Lua/LuaUnitDefs.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Lua/LuaUnitDefs.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -805,6 +805,7 @@
 	ADD_FLOAT(&quot;wingDrag&quot;,     ud.wingDrag);
 	ADD_FLOAT(&quot;wingAngle&quot;,    ud.wingAngle);
 	ADD_FLOAT(&quot;drag&quot;,         ud.drag);
+	ADD_FLOAT(&quot;crashDrag&quot;,    ud.crashDrag);
 	ADD_FLOAT(&quot;frontToSpeed&quot;, ud.frontToSpeed);
 	ADD_FLOAT(&quot;speedToFront&quot;, ud.speedToFront);
 	ADD_FLOAT(&quot;myGravity&quot;,    ud.myGravity);

Modified: branches/caiinterface/rts/Map/SMF/BFGroundTextures.cpp
===================================================================
--- branches/caiinterface/rts/Map/SMF/BFGroundTextures.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Map/SMF/BFGroundTextures.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -195,10 +195,11 @@
 {
 	int size = 1024 &gt;&gt; level;
 
-	GLubyte* buf=NULL; bool usedPBO=false;
+	GLubyte* buf = NULL;
+	bool usedPBO = false;
 
 	if (usePBO) {
-		if (currentPBO &gt; 9) currentPBO=0;
+		if (currentPBO &gt; 9) currentPBO = 0;
 		glBindBuffer(GL_PIXEL_UNPACK_BUFFER, pboIDs[currentPBO++]);
 		glBufferData(GL_PIXEL_UNPACK_BUFFER, size * size / 2, 0, GL_STREAM_DRAW);
 
@@ -207,7 +208,7 @@
 		usedPBO = true;
 	}
 
-	if(buf==NULL) {
+	if (buf == NULL) {
 		buf = SAFE_NEW GLubyte[size * size / 2];
 		usedPBO = false;
 	}
@@ -251,7 +252,7 @@
 		glCompressedTexImage2D(GL_TEXTURE_2D, 0, GL_COMPRESSED_RGBA_S3TC_DXT1_EXT, size, size, 0, size * size / 2, 0);
 		glBufferData(GL_PIXEL_UNPACK_BUFFER, 0, 0, GL_STREAM_DRAW); //free it
 		glBindBuffer(GL_PIXEL_UNPACK_BUFFER, 0);
-	}else{
+	} else {
 		glCompressedTexImage2D(GL_TEXTURE_2D, 0, GL_COMPRESSED_RGBA_S3TC_DXT1_EXT, size, size, 0, size * size / 2, buf);
 		delete[] buf;
 	}

Modified: branches/caiinterface/rts/Rendering/FartextureHandler.cpp
===================================================================
--- branches/caiinterface/rts/Rendering/FartextureHandler.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Rendering/FartextureHandler.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -91,7 +91,7 @@
 	glLoadIdentity();
 	glOrtho(-model-&gt;radius,model-&gt;radius,-model-&gt;radius,model-&gt;radius,-model-&gt;radius*1.5f,model-&gt;radius*1.5f);
 	glMatrixMode(GL_MODELVIEW);
-	glClearColor(0.5f,0.5f,0.5f,0);
+	glClearColor(1.0f,0.0f,1.0f,0.0f); // image transparency key
 	glDisable(GL_BLEND);
 
 	glEnable(GL_LIGHTING);
@@ -124,7 +124,7 @@
 				farTextureMem[(baseX+x+(y)*128)*4]=buf[(x+y*16)*4];
 				farTextureMem[(baseX+x+(y)*128)*4+1]=buf[(x+y*16)*4+1];
 				farTextureMem[(baseX+x+(y)*128)*4+2]=buf[(x+y*16)*4+2];
-				if(buf[(x+y*16)*4]==128 &amp;&amp; buf[(x+y*16)*4+1]==128 &amp;&amp; buf[(x+y*16)*4+2]==128)
+				if(buf[(x+y*16)*4]==255 &amp;&amp; buf[(x+y*16)*4+1]==0 &amp;&amp; buf[(x+y*16)*4+2]==255)
 					farTextureMem[(baseX+x+(y)*128)*4+3]=0;
 				else
 					farTextureMem[(baseX+x+(y)*128)*4+3]=255;

Modified: branches/caiinterface/rts/Rendering/GL/myGL.cpp
===================================================================
--- branches/caiinterface/rts/Rendering/GL/myGL.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Rendering/GL/myGL.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -280,9 +280,9 @@
 	}
 	font-&gt;glPrintCentered (0.5f,0.48f, 2.0f, text);
 #ifdef USE_GML
-	font-&gt;glPrintCentered(0.5f,0.06f,1.0f,&quot;Spring %s MT (%d threads)&quot;, VERSION_STRING, gmlThreadCount);
+	font-&gt;glPrintCentered(0.5f,0.06f,1.0f,&quot;Spring %s MT (%d threads)&quot;, VERSION_STRING_DETAILED, gmlThreadCount);
 #else
-	font-&gt;glPrintCentered(0.5f,0.06f,1.0f,&quot;Spring %s&quot;, VERSION_STRING);
+	font-&gt;glPrintCentered(0.5f,0.06f,1.0f,&quot;Spring %s&quot;, VERSION_STRING_DETAILED);
 #endif
 	font-&gt;glPrintCentered(0.5f,0.02f,0.6f,&quot;This program is distributed under the GNU General Public License, see license.html for more info&quot;);
 	if (swapbuffers) {

Modified: branches/caiinterface/rts/Rendering/GroundDecalHandler.cpp
===================================================================
--- branches/caiinterface/rts/Rendering/GroundDecalHandler.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Rendering/GroundDecalHandler.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -444,7 +444,10 @@
 					delete decal;
 
 					(*bdi)-&gt;buildingDecals.erase(bi++);
-					continue;
+					if (bi == (*bdi)-&gt;buildingDecals.end())
+						break;
+					else
+						continue;
 				}
 
 				if (camera-&gt;InView(decal-&gt;pos, decal-&gt;radius) &amp;&amp;

Modified: branches/caiinterface/rts/Sim/Features/Feature.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Features/Feature.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Features/Feature.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -325,13 +325,13 @@
 
 		if ((modInfo.reclaimMethod == 1) &amp;&amp; (reclaimLeft == 0)) {
 			// All-at-end method
-			builder-&gt;AddMetal(def-&gt;metal);
-			builder-&gt;AddEnergy(def-&gt;energy);
+			builder-&gt;AddMetal(def-&gt;metal, false);
+			builder-&gt;AddEnergy(def-&gt;energy, false);
 		}
 		else if (modInfo.reclaimMethod == 0) {
 			// Gradual reclaim
-			builder-&gt;AddMetal(metalFraction);
-			builder-&gt;AddEnergy(energyFraction);
+			builder-&gt;AddMetal(metalFraction, false);
+			builder-&gt;AddEnergy(energyFraction, false);
 		}
 		else {
 			// Chunky reclaiming, work out how many chunk boundaries we crossed
@@ -340,8 +340,8 @@
 			const int newChunk = ChunkNumber(reclaimLeft);
 			if (oldChunk != newChunk) {
 				const float noChunks = (float)oldChunk - (float)newChunk;
-				builder-&gt;AddMetal(noChunks * def-&gt;metal * chunkSize);
-				builder-&gt;AddEnergy(noChunks * def-&gt;energy * chunkSize);
+				builder-&gt;AddMetal(noChunks * def-&gt;metal * chunkSize, false);
+				builder-&gt;AddEnergy(noChunks * def-&gt;energy * chunkSize, false);
 			}
 		}
 

Modified: branches/caiinterface/rts/Sim/Misc/CollisionHandler.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Misc/CollisionHandler.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Misc/CollisionHandler.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -11,7 +11,7 @@
 #include &quot;CollisionHandler.h&quot;
 #include &quot;CollisionVolume.h&quot;
 
-#define ZVec ZeroVector
+#define ZVEC ZeroVector
 
 CR_BIND(CCollisionHandler, );
 CR_BIND(CollisionVolume, );
@@ -70,15 +70,15 @@
 {
 	const CollisionVolume* v = u-&gt;collisionVolume;
 
-	if ((u-&gt;midPos - p).SqLength() &gt; v-&gt;volumeBoundingRadiusSq) {
+	if (((u-&gt;midPos + v-&gt;axisOffsets) - p).SqLength() &gt; v-&gt;volumeBoundingRadiusSq) {
 		return false;
 	} else {
 		if (v-&gt;spherical) {
 			return true;
 		} else {
-			// NOTE: we have to translate by relMidPos (which is where
-			// collision volume gets drawn) since GetTransformMatrix()
-			// does not
+			// NOTE: we have to translate by relMidPos to get to midPos
+			// (which is where the collision volume gets drawn) because
+			// GetTransformMatrix() only uses pos
 			CMatrix44f m;
 			u-&gt;GetTransformMatrix(m, true);
 			m.Translate(u-&gt;relMidPos.x, u-&gt;relMidPos.y, u-&gt;relMidPos.z);
@@ -93,14 +93,18 @@
 {
 	const CollisionVolume* v = f-&gt;collisionVolume;
 
-	if ((f-&gt;midPos - p).SqLength() &gt; v-&gt;volumeBoundingRadiusSq) {
+	if (((f-&gt;midPos + v-&gt;axisOffsets) - p).SqLength() &gt; v-&gt;volumeBoundingRadiusSq) {
 		return false;
 	} else {
 		if (v-&gt;spherical) {
 			return true;
 		} else {
-			// NOTE: CFeature does not have a relMidPos member
+			// NOTE: CFeature does not have a relMidPos member so
+			// calculate and apply the translation from pos (used
+			// by transMatrix) to midPos manually
 			CMatrix44f m(f-&gt;transMatrix);
+			float3 frelMidPos(f-&gt;midPos - f-&gt;pos);
+			m.Translate(frelMidPos.x, frelMidPos.y, frelMidPos.z);
 			m.Translate(v-&gt;axisOffsets.x, v-&gt;axisOffsets.y, v-&gt;axisOffsets.z);
 
 			return CCollisionHandler::Collision(v, m, p);
@@ -175,7 +179,8 @@
 {
 	CMatrix44f m;
 	u-&gt;GetTransformMatrix(m, true);
-	m.Translate(u-&gt;relMidPos.x + e.x, u-&gt;relMidPos.y + e.y, u-&gt;relMidPos.z + e.z);
+	float3 midPos(u-&gt;midPos - u-&gt;pos);
+	m.Translate(midPos.x + e.x, midPos.y + e.y, midPos.z + e.z);
 	m.Translate(v-&gt;axisOffsets.x, v-&gt;axisOffsets.y, v-&gt;axisOffsets.z);
 
 	return CCollisionHandler::Intersect(v, m, p0, p1, q);
@@ -198,6 +203,8 @@
 	const CollisionVolume* v = f-&gt;collisionVolume;
 
 	CMatrix44f m(f-&gt;transMatrix);
+	float3 frelMidPos(f-&gt;midPos - f-&gt;pos);
+	m.Translate(frelMidPos.x, frelMidPos.y, frelMidPos.z);
 	m.Translate(v-&gt;axisOffsets.x, v-&gt;axisOffsets.y, v-&gt;axisOffsets.z);
 
 	return CCollisionHandler::Intersect(v, m, p0, p1, q);
@@ -227,8 +234,8 @@
 {
 	if (q) {
 		// reset the query
-		q-&gt;b0 = false; q-&gt;t0 = 0.0f; q-&gt;p0 = ZVec;
-		q-&gt;b1 = false; q-&gt;t1 = 0.0f; q-&gt;p1 = ZVec;
+		q-&gt;b0 = false; q-&gt;t0 = 0.0f; q-&gt;p0 = ZVEC;
+		q-&gt;b1 = false; q-&gt;t1 = 0.0f; q-&gt;p1 = ZVEC;
 	}
 
 	CMatrix44f mInv = m.Invert();
@@ -282,9 +289,9 @@
 	if (pii0.dot(pii0) &lt;= rSq /* &amp;&amp; pii1.dot(pii1) &lt;= rSq */) {
 		// terminate early in the special case
 		// that shot originated within volume
-		// (note: can mean missed impacts when
-		// two units are very close together)
-		return false;
+		q-&gt;b0 = true; q-&gt;p0 = ZVEC;
+		q-&gt;b1 = true; q-&gt;p1 = ZVEC;
+		return true;
 	}
 
 	// get the ray direction in unit-sphere space
@@ -322,7 +329,7 @@
 			if (q) {
 				q-&gt;b0 = b0; q-&gt;b1 = false;
 				q-&gt;t0 = t0; q-&gt;t1 = 0.0f;
-				q-&gt;p0 = p0; q-&gt;p1 = ZVec;
+				q-&gt;p0 = p0; q-&gt;p1 = ZVEC;
 			}
 
 			return b0;
@@ -373,24 +380,24 @@
 	if ((pi0[pAx] &gt; -ahs[pAx] &amp;&amp; pi0[pAx] &lt; ahs[pAx]) &amp;&amp; ratio &lt;= 1.0f) {
 		// terminate early in the special case
 		// that shot originated within volume
-		// (note: can mean missed impacts when
-		// two units are very close together)
-		return false;
+		q-&gt;b0 = true; q-&gt;p0 = ZVEC;
+		q-&gt;b1 = true; q-&gt;p1 = ZVEC;
+		return true;
 	}
 
 	// ray direction in volume-space
 	const float3 dir = (pi1 - pi0).Normalize();
 
 	// ray direction in (unit) cylinder-space
-	float3 diir = ZVec;
+	float3 diir = ZVEC;
 
 	// ray terminals in (unit) cylinder-space
 	float3 pii0 = pi0;
 	float3 pii1 = pi1;
 
 	// end-cap plane normals in volume-space
-	float3 n0 = ZVec;
-	float3 n1 = ZVec;
+	float3 n0 = ZVEC;
+	float3 n1 = ZVEC;
 
 	// (unit) cylinder-space to volume-space transformation
 	float3 inv(1.0f, 1.0f, 1.0f);
@@ -459,10 +466,11 @@
 
 	float d = (b * b) - (4.0f * a * c);
 	float rd = 0.0f;
+	float dp = 0.0f, rdp = 0.0f;
 
 	// volume-space intersection points
-	float3 p0 = ZVec;
-	float3 p1 = ZVec;
+	float3 p0 = ZVEC;
+	float3 p1 = ZVEC;
 
 	bool b0 = false;
 	bool b1 = false;
@@ -496,8 +504,11 @@
 		// p0 does not lie on ray segment, or does not fall
 		// between cylinder end-caps: check if segment goes
 		// through front cap (plane)
-		// NOTE: DIV0 if normal and dir are orthogonal?
-		t0 = -(n0.dot(pi0) - ahs[pAx]) / n0.dot(dir);
+		// NOTE: normal n0 and dir should not be orthogonal
+		dp = n0.dot(dir);
+		rdp = (dp != 0.0f)? 1.0f / dp: 0.01f;
+
+		t0 = -(n0.dot(pi0) - ahs[pAx]) * rdp;
 		p0 = pi0 + (dir * t0);
 		s0 = (p0 - pi0).SqLength();
 		r0 =
@@ -509,8 +520,11 @@
 		// p1 does not lie on ray segment, or does not fall
 		// between cylinder end-caps: check if segment goes
 		// through rear cap (plane)
-		// NOTE: DIV0 if normal and dir are orthogonal?
-		t1 = -(n1.dot(pi0) - ahs[pAx]) / n1.dot(dir);
+		// NOTE: normal n1 and dir should not be orthogonal
+		dp = n1.dot(dir);
+		rdp = (dp != 0.0f)? 1.0f / dp: 0.01f;
+
+		t1 = -(n1.dot(pi0) - ahs[pAx]) * rdp;
 		p1 = pi0 + (dir * t1);
 		s1 = (p1 - pi0).SqLength();
 		r1 =
@@ -537,10 +551,9 @@
 	if ((ba &amp;&amp; bb &amp;&amp; bc) /* &amp;&amp; (bd &amp;&amp; be &amp;&amp; bf) */) {
 		// terminate early in the special case
 		// that shot originated within volume
-		// (note: can mean missed impacts when
-		// two units are very close together)
-		// FIXME: results in undetected hits?
-		// return false;
+		q-&gt;b0 = true; q-&gt;p0 = ZVEC;
+		q-&gt;b1 = true; q-&gt;p1 = ZVEC;
+		return true;
 	}
 
 	float tn = -9999999.9f;

Modified: branches/caiinterface/rts/Sim/Misc/CollisionVolume.h
===================================================================
--- branches/caiinterface/rts/Sim/Misc/CollisionVolume.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Misc/CollisionVolume.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -122,17 +122,17 @@
 				volumeBoundingRadius = streflop::sqrt(volumeBoundingRadiusSq);
 			} break;
 			case COLVOL_TYPE_CYLINDER: {
-				const float prhs = axisHScales[primaryAxis     ];	// primary axis half-scale
-				const float sahs = axisHScales[secondaryAxes[0]];	// 1st secondary axis half-scale
-				const float sbhs = axisHScales[secondaryAxes[1]];	// 2nd secondary axis half-scale
-				const float mshs = std::max(sahs, sbhs);					// max. secondary axis half-scale
+				const float prhs = axisHScales[primaryAxis     ];   // primary axis half-scale
+				const float sahs = axisHScales[secondaryAxes[0]];   // 1st secondary axis half-scale
+				const float sbhs = axisHScales[secondaryAxes[1]];   // 2nd secondary axis half-scale
+				const float mshs = std::max(sahs, sbhs);            // max. secondary axis half-scale
 
 				volumeBoundingRadiusSq = prhs * prhs + mshs * mshs;
 				volumeBoundingRadius = streflop::sqrtf(volumeBoundingRadiusSq);
 			} break;
 			case COLVOL_TYPE_ELLIPSOID: {
 				if (spherical) {
-					// std::max(x, y, z) would suffice here too
+					// max{x, y, z} would suffice here too
 					volumeBoundingRadius = axisHScales.x;
 				} else {
 					volumeBoundingRadius = std::max(axisHScales.x, std::max(axisHScales.y, axisHScales.z));

Modified: branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.cpp
===================================================================
--- branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -37,6 +37,7 @@
 		CR_MEMBER(wingDrag),
 		CR_MEMBER(wingAngle),
 		CR_MEMBER(invDrag),
+		CR_MEMBER(crashDrag),
 		CR_MEMBER(frontToSpeed),
 		CR_MEMBER(speedToFront),
 		CR_MEMBER(myGravity),
@@ -100,6 +101,7 @@
 	maxElevator(0.02f),
 	maxRudder(0.01f),
 	invDrag(0.995f),
+	crashDrag(0.995f),
 	inSupply(0),
 	subState(0),
 	myGravity(0.8f),
@@ -200,7 +202,6 @@
 			if (pos.distance2D(owner-&gt;pos) &lt; 400) {
 				padStatus = 1;
 			}
-			//			geometricObjects-&gt;AddLine(owner-&gt;pos,pos,1,0,1);
 		} else if (padStatus == 1) {
 			if (aircraftState != AIRCRAFT_LANDING)
 				SetState(AIRCRAFT_LANDING);
@@ -208,24 +209,24 @@
 			goalPos = pos;
 			reservedLandingPos = pos;
 
-			if (owner-&gt;pos.distance(pos) &lt; 3 || aircraftState == AIRCRAFT_LANDED){
+			if (owner-&gt;pos.distance(pos) &lt; 3 || aircraftState == AIRCRAFT_LANDED) {
 				padStatus = 2;
 			}
-			//			geometricObjects-&gt;AddLine(owner-&gt;pos,pos,10,0,1);
 		} else {
 			if (aircraftState != AIRCRAFT_LANDED)
 				SetState(AIRCRAFT_LANDED);
 
 			owner-&gt;pos = pos;
 
-			owner-&gt;AddBuildPower(unit-&gt;unitDef-&gt;buildSpeed/30,unit);
+			owner-&gt;AddBuildPower(unit-&gt;unitDef-&gt;buildSpeed / 30, unit);
 			owner-&gt;currentFuel = std::min (owner-&gt;unitDef-&gt;maxFuel, owner-&gt;currentFuel + (owner-&gt;unitDef-&gt;maxFuel / (GAME_SPEED * owner-&gt;unitDef-&gt;refuelTime)));
 
 			if (owner-&gt;health &gt;= owner-&gt;maxHealth - 1 &amp;&amp; owner-&gt;currentFuel &gt;= owner-&gt;unitDef-&gt;maxFuel) {
+				// repaired and filled up, leave the pad
 				airBaseHandler-&gt;LeaveLandingPad(reservedPad);
-				reservedPad=0;
-				padStatus=0;
-				goalPos=oldGoalPos;
+				reservedPad = 0;
+				padStatus = 0;
+				goalPos = oldGoalPos;
 				SetState(AIRCRAFT_TAKEOFF);
 			}
 		}
@@ -233,54 +234,57 @@
 
 
 	switch (aircraftState) {
-	case AIRCRAFT_FLYING:
-#ifdef DEBUG_AIRCRAFT
-		if (selectedUnits.selectedUnits.find(this) != selectedUnits.selectedUnits.end()) {
-			logOutput.Print(&quot;Flying %i %i %.1f %i&quot;, moveState, fireState, inefficientAttackTime, (int) isFighter);
-		}
-#endif
-		owner-&gt;restTime = 0;
-		if (owner-&gt;userTarget || owner-&gt;userAttackGround) {
-			inefficientAttackTime = std::min(inefficientAttackTime, (float)gs-&gt;frameNum - owner-&gt;lastFireWeapon);
-			if (owner-&gt;userTarget) {
-				goalPos = owner-&gt;userTarget-&gt;pos;
-			} else {
-				goalPos = owner-&gt;userAttackPos;
+		case AIRCRAFT_FLYING:
+	#ifdef DEBUG_AIRCRAFT
+			if (selectedUnits.selectedUnits.find(this) != selectedUnits.selectedUnits.end()) {
+				logOutput.Print(&quot;Flying %i %i %.1f %i&quot;, moveState, fireState, inefficientAttackTime, (int) isFighter);
 			}
-			if(maneuver) {
-				UpdateManeuver();
-				inefficientAttackTime = 0;
-			} else if(isFighter &amp;&amp; goalPos.distance(pos) &lt; owner-&gt;maxRange * 4) {
-				inefficientAttackTime++;
-				UpdateFighterAttack();
+	#endif
+
+			owner-&gt;restTime = 0;
+
+			if (!reservedPad &amp;&amp; (owner-&gt;userTarget || owner-&gt;userAttackGround)) {
+				inefficientAttackTime = std::min(inefficientAttackTime, float(gs-&gt;frameNum) - owner-&gt;lastFireWeapon);
+
+				if (owner-&gt;userTarget) {
+					goalPos = owner-&gt;userTarget-&gt;pos;
+				} else {
+					goalPos = owner-&gt;userAttackPos;
+				}
+				if (maneuver) {
+					UpdateManeuver();
+					inefficientAttackTime = 0;
+				} else if (isFighter &amp;&amp; goalPos.distance(pos) &lt; owner-&gt;maxRange * 4) {
+					inefficientAttackTime++;
+					UpdateFighterAttack();
+				} else {
+					inefficientAttackTime = 0;
+					UpdateAttack();
+				}
 			} else {
 				inefficientAttackTime = 0;
-				UpdateAttack();
+				UpdateFlying(wantedHeight, 1);
 			}
-		} else {
+			break;
+		case AIRCRAFT_LANDED:
 			inefficientAttackTime = 0;
-			UpdateFlying(wantedHeight, 1);
-		}
-		break;
-	case AIRCRAFT_LANDED:
-		inefficientAttackTime = 0;
-		UpdateLanded();
-		break;
-	case AIRCRAFT_LANDING:
-		inefficientAttackTime = 0;
-		UpdateLanding();
-		break;
-	case AIRCRAFT_CRASHING:
-		owner-&gt;crashing = true;
-		UpdateAirPhysics(crashRudder, crashAileron, crashElevator, 0, owner-&gt;frontdir);
-		SAFE_NEW CSmokeProjectile(owner-&gt;midPos, gs-&gt;randVector() * 0.08f, 100 + gs-&gt;randFloat() * 50, 5, 0.2f, owner, 0.4f);
-		if (!(gs-&gt;frameNum &amp; 3) &amp;&amp; std::max(0.f, ground-&gt;GetApproximateHeight(pos.x, pos.z)) + 5 + owner-&gt;radius &gt; pos.y)
-			owner-&gt;KillUnit(true, false, 0);
-		break;
-	case AIRCRAFT_TAKEOFF:
-		UpdateTakeOff(wantedHeight);
-	default:
-		break;
+			UpdateLanded();
+			break;
+		case AIRCRAFT_LANDING:
+			inefficientAttackTime = 0;
+			UpdateLanding();
+			break;
+		case AIRCRAFT_CRASHING:
+			owner-&gt;crashing = true;
+			UpdateAirPhysics(crashRudder, crashAileron, crashElevator, 0, owner-&gt;frontdir);
+			SAFE_NEW CSmokeProjectile(owner-&gt;midPos, gs-&gt;randVector() * 0.08f, 100 + gs-&gt;randFloat() * 50, 5, 0.2f, owner, 0.4f);
+			if (!(gs-&gt;frameNum &amp; 3) &amp;&amp; std::max(0.f, ground-&gt;GetApproximateHeight(pos.x, pos.z)) + 5 + owner-&gt;radius &gt; pos.y)
+				owner-&gt;KillUnit(true, false, 0);
+			break;
+		case AIRCRAFT_TAKEOFF:
+			UpdateTakeOff(wantedHeight);
+		default:
+			break;
 	}
 
 EndNormalControl:
@@ -731,7 +735,11 @@
 		} else if (goalDot &gt; maxRudder * speedf * 2) {
 			rudder = 1;
 		} else {
-			rudder = goalDot / (maxRudder * speedf * 2);
+			if (speedf &gt; 0.0f) {
+				rudder = goalDot / (maxRudder * speedf * 2);
+			} else {
+				rudder = 0;
+			}
 		}
 	}
 
@@ -972,7 +980,12 @@
 
 	speed += engineVector * maxAcc * engine;
 	speed.y += mapInfo-&gt;map.gravity * myGravity;
-	speed *= invDrag;
+	if (aircraftState == AIRCRAFT_CRASHING) {
+		speed *= crashDrag;
+	}
+	else {
+		speed *= invDrag;
+	}
 
 	float3 wingDir = updir * (1 - wingAngle) - frontdir * wingAngle;
 	float wingForce = wingDir.dot(speed) * wingDrag;

Modified: branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.h
===================================================================
--- branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/MoveTypes/AirMoveType.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -56,6 +56,7 @@
 	float wingDrag;
 	float wingAngle;
 	float invDrag;
+	float crashDrag;    //actually the invDrag of crashDrag
 	float frontToSpeed;
 	float speedToFront;
 	float myGravity;

Modified: branches/caiinterface/rts/Sim/MoveTypes/ScriptMoveType.cpp
===================================================================
--- branches/caiinterface/rts/Sim/MoveTypes/ScriptMoveType.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/MoveTypes/ScriptMoveType.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -1,4 +1,3 @@
-
 #include &quot;StdAfx.h&quot;
 #include &quot;System/mmgr.h&quot;
 
@@ -34,7 +33,6 @@
 	CR_MEMBER(trackGround),
 	CR_MEMBER(hasDecal),
 	CR_MEMBER(isBuilding),
-	CR_MEMBER(isBlocking),
 	CR_MEMBER(gravityFactor),
 	CR_MEMBER(windFactor),
 	CR_MEMBER(trackSlope),
@@ -42,7 +40,8 @@
 	CR_MEMBER(groundOffset),
 	CR_MEMBER(mins),
 	CR_MEMBER(maxs),
-	CR_MEMBER(noBlocking),
+	CR_MEMBER(isBlocking), // copy of CSolidObject::blocking (no longer used)
+	CR_MEMBER(noBlocking), // copy of CSolidObject::isMarkedOnBlockingMap
 	CR_MEMBER(gndStop),
 	CR_MEMBER(shotStop),
 	CR_MEMBER(slopeStop),
@@ -94,19 +93,18 @@
 	if (owner) {
 		const UnitDef* unitDef = owner-&gt;unitDef;
 		isBuilding = (unitDef-&gt;type == &quot;Building&quot;);
-		isBlocking = (!unitDef-&gt;canKamikaze || !isBuilding);
 	} else {
 		isBuilding = false;
-		isBlocking = false;
 	}
 }
 
 
 CScriptMoveType::~CScriptMoveType(void)
 {
-	if (isBlocking &amp;&amp; noBlocking) {
-		owner-&gt;Block();
-	}
+	// clean up if noBlocking was made true at
+	// some point during this script's lifetime
+	// and not reset
+	owner-&gt;Block();
 }
 
 inline void CScriptMoveType::CalcDirections()
@@ -137,7 +135,7 @@
 	const float3&amp; pos = owner-&gt;pos;
 
 	// make sure the unit is in the map
-//	pos.CheckInBounds();
+	// pos.CheckInBounds();
 
 	// don't need the rest if the pos hasn't changed
 	if (pos == oldSlowUpdatePos) {
@@ -227,8 +225,7 @@
 
 	oldPos = owner-&gt;pos;
 
-	if (isBlocking &amp;&amp; !noBlocking) {
-		owner-&gt;UnBlock();
+	if (!noBlocking) {
 		owner-&gt;Block();
 	}
 
@@ -321,15 +318,16 @@
 
 void CScriptMoveType::SetNoBlocking(bool state)
 {
+	// if false, forces blocking-map updates
 	noBlocking = state;
+
 	if (noBlocking) {
 		owner-&gt;UnBlock();
 	} else {
-		if (isBlocking) {
-			owner-&gt;Block();
-		}
+		owner-&gt;Block();
 	}
 }
+
 void CScriptMoveType::TrackSlope()
 {
 	owner-&gt;frontdir = GetVectorFromHeading(owner-&gt;heading);
@@ -338,5 +336,3 @@
 	owner-&gt;rightdir.Normalize();
 	owner-&gt;frontdir = owner-&gt;updir.cross(owner-&gt;rightdir);
 }
-
-

Modified: branches/caiinterface/rts/Sim/Objects/SolidObject.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Objects/SolidObject.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Objects/SolidObject.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -65,34 +65,50 @@
 CSolidObject::~CSolidObject() {
 	if (mobility) {
 		delete mobility;
-		mobility = 0x0;
 	}
+
+	mobility = 0x0;
+	blocking = false;
 }
 
 
 
-/* Removes this object from the GroundBlockingMap. */
+/*
+ * removes this object from the GroundBlockingMap
+ * if it is currently marked on it, does nothing
+ * otherwise
+ */
 void CSolidObject::UnBlock() {
 	if (isMarkedOnBlockingMap) {
 		groundBlockingObjectMap-&gt;RemoveGroundBlockingObject(this);
+		// isMarkedOnBlockingMap is now false
 	}
 }
 
-/* Adds this object to the GroundBlockingMap. */
+/*
+ * adds this object to the GroundBlockingMap
+ * if and only if its collidable property is
+ * set (blocking), else does nothing (except
+ * call UnBlock())
+ */
 void CSolidObject::Block() {
 	UnBlock();
 
-	if (blocking &amp;&amp; (physicalState == OnGround ||
-	                 physicalState == Floating ||
-	                 physicalState == Hovering ||
-	                 physicalState == Submarine)) {
-		// use the object's yardmap if available
-		if (yardMap) {
-			groundBlockingObjectMap-&gt;AddGroundBlockingObject(this, yardMap);
-		} else {
-			groundBlockingObjectMap-&gt;AddGroundBlockingObject(this);
-		}
+	if (!blocking) {
+		return;
 	}
+	if (physicalState == Ghost || physicalState == Flying) {
+		return;
+	}
+
+	// use the object's yardmap if available
+	if (yardMap) {
+		groundBlockingObjectMap-&gt;AddGroundBlockingObject(this, yardMap);
+	} else {
+		groundBlockingObjectMap-&gt;AddGroundBlockingObject(this);
+	}
+
+	// isMarkedOnBlockingMap is now true
 }
 
 

Modified: branches/caiinterface/rts/Sim/Objects/SolidObject.h
===================================================================
--- branches/caiinterface/rts/Sim/Objects/SolidObject.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Objects/SolidObject.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -36,9 +36,9 @@
 	void UnBlock();
 
 	// Static properties.
-	float mass;									// The physical mass of this object.
-	bool blocking;								// If this object is blocking/collidable. (NOTE: Some objects could be flat =&gt; not collidable.)
-	bool floatOnWater;							// If the object will float or not in water. (TODO: &quot;float density;&quot; would be more dynamic.)
+	float mass;									// the physical mass of this object
+	bool blocking;								// if this object can be collided with at all (NOTE: Some objects could be flat =&gt; not collidable.)
+	bool floatOnWater;							// if the object will float on water (TODO: &quot;float density;&quot; would be more dynamic.)
 	bool isUnderWater;
 	bool immobile;								// Immobile objects can not be moved. (Except perhaps along y-axis, to make them stay on ground.)
 	bool blockHeightChanges;					// map height cannot change under this object

Modified: branches/caiinterface/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Projectiles/Unsynced/SpherePartProjectile.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -132,5 +132,5 @@
 {
 	CProjectile::Init(pos, owner);
 	deleteMe = true;
-	CSpherePartProjectile::CreateSphere(pos + this-&gt;pos, alpha, ttl, expansionSpeed, owner, color);
+	CSpherePartProjectile::CreateSphere(pos, alpha, ttl, expansionSpeed, owner, color);
 }

Modified: branches/caiinterface/rts/Sim/Units/CommandAI/CommandAI.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/CommandAI/CommandAI.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Units/CommandAI/CommandAI.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -1342,6 +1342,7 @@
 
 void CCommandAI::FinishCommand(void)
 {
+	assert(!commandQue.empty());
 	const Command&amp; cmd = commandQue.front();
 	const int cmdID  = cmd.id;  // save
 	const int cmdTag = cmd.tag; // save

Modified: branches/caiinterface/rts/Sim/Units/CommandAI/MobileCAI.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/CommandAI/MobileCAI.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Units/CommandAI/MobileCAI.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -270,42 +270,54 @@
 
 void CMobileCAI::RefuelIfNeeded()
 {
-	if(!owner-&gt;moveType-&gt;reservedPad) {
-		if(owner-&gt;currentFuel &lt;= 0){
+	if (!owner-&gt;moveType-&gt;reservedPad) {
+		// we don't have a pad yet
+		if (owner-&gt;currentFuel &lt;= 0) {
+			// we're out of fuel
 			StopMove();
-			owner-&gt;userAttackGround=false;
-			owner-&gt;userTarget=0;
-			inCommand=false;
+			owner-&gt;userAttackGround = false;
+			owner-&gt;userTarget = 0;
+			inCommand = false;
+
 			CAirBaseHandler::LandingPad* lp = airBaseHandler-&gt;FindAirBase(
 				owner, owner-&gt;unitDef-&gt;minAirBasePower);
-			if(lp){
+
+			if (lp) {
+				// found a pad
 				owner-&gt;moveType-&gt;ReservePad(lp);
 			} else {
 				float3 landingPos = airBaseHandler-&gt;FindClosestAirBasePos(
-						owner, owner-&gt;unitDef-&gt;minAirBasePower);
-				if(landingPos != ZeroVector &amp;&amp; owner-&gt;pos.distance2D(landingPos) &gt; 800){
-					SetGoal(landingPos,owner-&gt;pos);
-					//myPlane-&gt;goalPos = landingPos;
+					owner, owner-&gt;unitDef-&gt;minAirBasePower);
+
+				if (landingPos != ZeroVector &amp;&amp; owner-&gt;pos.distance2D(landingPos) &gt; 800) {
+					// didn't find a pad, but we have an in-range ('&gt;' ?) landing pos
+					SetGoal(landingPos, owner-&gt;pos);
 				} else {
 					owner-&gt;moveType-&gt;StopMoving();
 				}
 			}
-		} else if(owner-&gt;currentFuel &lt;
-				(owner-&gt;moveType-&gt;repairBelowHealth * owner-&gt;unitDef-&gt;maxFuel) &amp;&amp; 
-				(commandQue.empty() || commandQue.front().id == CMD_PATROL || commandQue.front().id == CMD_FIGHT)) {
+		} else if (owner-&gt;currentFuel &lt; (owner-&gt;moveType-&gt;repairBelowHealth * owner-&gt;unitDef-&gt;maxFuel) &amp;&amp; true
+			/* (commandQue.empty() || commandQue.front().id == CMD_PATROL || commandQue.front().id == CMD_FIGHT) */) {
+			// current fuel level is below our bingo threshold
+			// note: force the refuel attempt (irrespective of
+			// what our currently active command is)
+
 			CAirBaseHandler::LandingPad* lp =
 				airBaseHandler-&gt;FindAirBase(owner, owner-&gt;unitDef-&gt;minAirBasePower);
-			if(lp) {
+
+			if (lp) {
 				StopMove();
 				owner-&gt;userAttackGround = false;
 				owner-&gt;userTarget = 0;
 				inCommand = false;
 				owner-&gt;moveType-&gt;ReservePad(lp);
 			}
-		} else if(owner-&gt;health &lt; owner-&gt;maxHealth*owner-&gt;moveType-&gt;repairBelowHealth) {
+		} else if (owner-&gt;health &lt; owner-&gt;maxHealth * owner-&gt;moveType-&gt;repairBelowHealth) {
+			// we're damaged, just seek a pad for repairs
 			CAirBaseHandler::LandingPad* lp =
 				airBaseHandler-&gt;FindAirBase(owner, owner-&gt;unitDef-&gt;minAirBasePower);
-			if(lp) {
+
+			if (lp) {
 				owner-&gt;moveType-&gt;ReservePad(lp);
 			}
 		}
@@ -314,20 +326,19 @@
 
 void CMobileCAI::SlowUpdate()
 {
-	if(owner-&gt;unitDef-&gt;maxFuel&gt;0 &amp;&amp; dynamic_cast&lt;AAirMoveType*&gt;(owner-&gt;moveType)){
+	if (owner-&gt;unitDef-&gt;maxFuel &gt; 0 &amp;&amp; dynamic_cast&lt;AAirMoveType*&gt;(owner-&gt;moveType)) {
 		RefuelIfNeeded();
 	}
 
-	if(!commandQue.empty() &amp;&amp; commandQue.front().timeOut &lt; gs-&gt;frameNum){
+	if (!commandQue.empty() &amp;&amp; commandQue.front().timeOut &lt; gs-&gt;frameNum) {
 		StopMove();
 		FinishCommand();
 		return;
 	}
 
-	if(commandQue.empty()) {
-//		if(!owner-&gt;ai || owner-&gt;ai-&gt;State() != CHasState::Active) {
-			IdleCheck();
-//		}
+	if (commandQue.empty()) {
+		IdleCheck();
+
 		//the attack order could terminate directly and thus cause a loop
 		if(commandQue.empty() || commandQue.front().id == CMD_ATTACK) {
 			return;
@@ -417,7 +428,8 @@
 		tran-&gt;commandAI-&gt;GiveCommandReal(newCommand);
 	}
 	if (owner-&gt;transporter) {
-		FinishCommand();
+		if (!commandQue.empty())
+			FinishCommand();
 		return;
 	}
 
@@ -705,7 +717,7 @@
 		bool b3 = false;
 		bool b4 = false;
 		float edgeFactor = 0.f; // percent offset to target center
-		float3 diff = owner-&gt;pos - orderTarget-&gt;pos;
+		float3 diff = owner-&gt;pos - orderTarget-&gt;midPos;
 
 		if (owner-&gt;weapons.size() &gt; 0) {
 			if (!(c.options &amp; ALT_KEY) &amp;&amp; SkipParalyzeTarget(orderTarget)) {
@@ -743,7 +755,7 @@
 				StopMove();
 				// FIXME kill magic frame number
 				if (gs-&gt;frameNum &gt; lastCloseInTry + MAX_CLOSE_IN_RETRY_TICKS) {
-					owner-&gt;moveType-&gt;KeepPointingTo(orderTarget,
+					owner-&gt;moveType-&gt;KeepPointingTo(orderTarget-&gt;midPos,
 							std::min((float) (owner-&gt;losRadius * SQUARE_SIZE * 2),
 									owner-&gt;maxRange * 0.9f), true);
 				}
@@ -758,7 +770,7 @@
 					|| (diff.SqLength2D() &lt; 1024))
 			{
 				StopMove();
-				owner-&gt;moveType-&gt;KeepPointingTo(orderTarget,
+				owner-&gt;moveType-&gt;KeepPointingTo(orderTarget-&gt;midPos,
 						std::min((float) (owner-&gt;losRadius * SQUARE_SIZE * 2),
 								owner-&gt;maxRange * 0.9f), true);
 			} else if(tempOrder &amp;&amp; owner-&gt;moveState == 0){

Modified: branches/caiinterface/rts/Sim/Units/Unit.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/Unit.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Units/Unit.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -241,6 +241,9 @@
 
 CUnit::~CUnit()
 {
+	// clean up if we are still under movectrl here
+	DisableScriptMoveType();
+
 	// not all unit deletions run through KillUnit(),
 	// but we always want to call this for ourselves
 	UnBlock();
@@ -481,6 +484,8 @@
 		moveType-&gt;SetGoal(pos);
 		moveType-&gt;StopMoving();
 	}
+
+	// ??
 	CMobileCAI* mobile = dynamic_cast&lt;CMobileCAI*&gt;(moveType);
 	if (mobile) {
 		mobile-&gt;lastUserGoal = pos;
@@ -729,7 +734,7 @@
 			const float buildDecay = 1.0f / (buildTime * modInfo.constructionDecaySpeed);
 			health -= maxHealth * buildDecay;
 			buildProgress -= buildDecay;
-			AddMetal(metalCost * buildDecay);
+			AddMetal(metalCost * buildDecay, false);
 			if (health &lt; 0.0f) {
 				KillUnit(false, true, NULL);
 			}
@@ -1750,7 +1755,7 @@
 
 		health += maxHealth * part;
 		if (beingBuilt) {
-			builder-&gt;AddMetal(-metalUse * modInfo.reclaimUnitEfficiency);
+			builder-&gt;AddMetal(-metalUse * modInfo.reclaimUnitEfficiency, false);
 			buildProgress+=part;
 			if(buildProgress&lt;0 || health&lt;0){
 				KillUnit(false, true, NULL);
@@ -1761,7 +1766,7 @@
 
 		else {
 			if (health &lt; 0) {
-				builder-&gt;AddMetal(metalCost * modInfo.reclaimUnitEfficiency);
+				builder-&gt;AddMetal(metalCost * modInfo.reclaimUnitEfficiency, false);
 				KillUnit(false, true, NULL);
 				return false;
 			}
@@ -1961,14 +1966,14 @@
 }
 
 
-void CUnit::AddMetal(float metal)
+void CUnit::AddMetal(float metal, bool handicap)
 {
 	if (metal &lt; 0) {
 		UseMetal(-metal);
 		return;
 	}
 	metalMakeI += metal;
-	gs-&gt;Team(team)-&gt;AddMetal(metal);
+	gs-&gt;Team(team)-&gt;AddMetal(metal, handicap);
 }
 
 
@@ -1986,14 +1991,14 @@
 }
 
 
-void CUnit::AddEnergy(float energy)
+void CUnit::AddEnergy(float energy, bool handicap)
 {
 	if (energy &lt; 0) {
 		UseEnergy(-energy);
 		return;
 	}
 	energyMakeI += energy;
-	gs-&gt;Team(team)-&gt;AddEnergy(energy);
+	gs-&gt;Team(team)-&gt;AddEnergy(energy, handicap);
 }
 
 

Modified: branches/caiinterface/rts/Sim/Units/Unit.h
===================================================================
--- branches/caiinterface/rts/Sim/Units/Unit.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Units/Unit.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -118,9 +118,9 @@
 
 	bool AllowedReclaim(CUnit *builder);
 	bool UseMetal(float metal);
-	void AddMetal(float metal);
+	void AddMetal(float metal, bool handicap = true);
 	bool UseEnergy(float energy);
-	void AddEnergy(float energy);
+	void AddEnergy(float energy, bool handicap = true);
 	void PushWind(float x, float z, float strength);		//push the new wind to the script
 	void SetMetalStorage(float newStorage);
 	void SetEnergyStorage(float newStorage);

Modified: branches/caiinterface/rts/Sim/Units/UnitDef.h
===================================================================
--- branches/caiinterface/rts/Sim/Units/UnitDef.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Units/UnitDef.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -297,6 +297,7 @@
 	float maxAileron;
 	float maxElevator;
 	float maxRudder;
+	float crashDrag;
 
 	MoveData* movedata;
 //	unsigned char* yardmapLevels[6];

Modified: branches/caiinterface/rts/Sim/Units/UnitDefHandler.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/UnitDefHandler.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Units/UnitDefHandler.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -487,6 +487,7 @@
 	ud.frontToSpeed = udTable.GetFloat(&quot;frontToSpeed&quot;, 0.1f);   // fudge factor for lining up speed and front of plane
 	ud.speedToFront = udTable.GetFloat(&quot;speedToFront&quot;, 0.07f);  // fudge factor for lining up speed and front of plane
 	ud.myGravity    = udTable.GetFloat(&quot;myGravity&quot;,    0.4f);   // planes are slower than real airplanes so lower gravity to compensate
+	ud.crashDrag    = udTable.GetFloat(&quot;crashDrag&quot;,0.005f);     // drag used when crashing
 
 	ud.maxBank = udTable.GetFloat(&quot;maxBank&quot;, 0.8f);         // max roll
 	ud.maxPitch = udTable.GetFloat(&quot;maxPitch&quot;, 0.45f);      // max pitch this plane tries to keep

Modified: branches/caiinterface/rts/Sim/Units/UnitLoader.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/UnitLoader.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Units/UnitLoader.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -91,7 +91,6 @@
  			pos.y = -ud-&gt;waterline;
 		}
 	}
-	bool blocking = false;	//Used to tell if ground area shall be blocked of not.
 
 	if (team &lt; 0) {
 		team = MAX_TEAMS - 1; // FIXME use gs-&gt;gaiaTeamID ?  (once it is always enabled)
@@ -99,24 +98,18 @@
 
 	if (type == &quot;GroundUnit&quot;) {
 		unit = SAFE_NEW CUnit;
-		blocking = true;
 	} else if (type == &quot;Transport&quot;) {
 		unit = SAFE_NEW CTransportUnit;
-		blocking = true;
 	} else if (type == &quot;Building&quot;) {
 		unit = SAFE_NEW CBuilding;
-		blocking = true;
 	} else if (type == &quot;Factory&quot;) {
 		unit = SAFE_NEW CFactory;
-		blocking = true;
 	} else if (type == &quot;Builder&quot;) {
 		unit = SAFE_NEW CBuilder;
-		blocking = true;
 	} else if (type == &quot;Bomber&quot; || type == &quot;Fighter&quot;) {
 		unit = SAFE_NEW CUnit;
 	} else if (type == &quot;MetalExtractor&quot;) {
 		unit = SAFE_NEW CExtractorBuilding;
-		blocking = true;
 	} else {
 		logOutput &lt;&lt; &quot;Unknown unit type &quot; &lt;&lt; type.c_str() &lt;&lt; &quot;\n&quot;;
 		return NULL;
@@ -276,6 +269,7 @@
 			mt-&gt;collide = ud-&gt;collide;
 
 			mt-&gt;wingAngle = ud-&gt;wingAngle;
+			mt-&gt;crashDrag = 1 - ud-&gt;crashDrag;
 			mt-&gt;invDrag = 1 - ud-&gt;drag;
 			mt-&gt;frontToSpeed = ud-&gt;frontToSpeed;
 			mt-&gt;speedToFront = ud-&gt;speedToFront;

Modified: branches/caiinterface/rts/Sim/Units/UnitTypes/Factory.cpp
===================================================================
--- branches/caiinterface/rts/Sim/Units/UnitTypes/Factory.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/Sim/Units/UnitTypes/Factory.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -271,7 +271,7 @@
 	cob-&gt;Call(&quot;StopBuilding&quot;);
 	if (curBuild) {
 		if (curBuild-&gt;beingBuilt) {
-			AddMetal(curBuild-&gt;metalCost * curBuild-&gt;buildProgress);
+			AddMetal(curBuild-&gt;metalCost * curBuild-&gt;buildProgress, false);
 			curBuild-&gt;KillUnit(false, true, NULL);
 		}
 		DeleteDeathDependence(curBuild);

Modified: branches/caiinterface/rts/System/BaseNetProtocol.cpp
===================================================================
--- branches/caiinterface/rts/System/BaseNetProtocol.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/BaseNetProtocol.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -274,13 +274,6 @@
 	return PacketType(packet);
 }
 
-PacketType CBaseNetProtocol::SendSelfD(uchar myPlayerNum)
-{
-	PackPacket* packet = new PackPacket(4, NETMSG_TEAM);
-	*packet &lt;&lt; myPlayerNum &lt;&lt; static_cast&lt;uchar&gt;(TEAMMSG_SELFD) &lt;&lt; static_cast&lt;uchar&gt;(0);
-	return PacketType(packet);
-}
-
 PacketType CBaseNetProtocol::SendGiveAwayEverything(uchar myPlayerNum, uchar giveTo)
 {
 	PackPacket* packet = new PackPacket(4, NETMSG_TEAM);

Modified: branches/caiinterface/rts/System/BaseNetProtocol.h
===================================================================
--- branches/caiinterface/rts/System/BaseNetProtocol.h	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/BaseNetProtocol.h	2008-10-14 09:56:24 UTC (rev 6714)
@@ -86,7 +86,6 @@
 // action to do with NETMSG_TEAM 
 enum TEAMMSG {
 //	TEAMMSG_NAME			= number	   parameter1
-	TEAMMSG_SELFD           = 0,		// not used 
 	TEAMMSG_GIVEAWAY        = 1,		// team to give stuff to
 	TEAMMSG_RESIGN			= 2,		// not used
 	TEAMMSG_JOIN_TEAM		= 3,		// team to join
@@ -146,7 +145,6 @@
 	PacketType SendPlayerLeft(uchar myPlayerNum, uchar bIntended);
 	PacketType SendLuaMsg(uchar myPlayerNum, uchar script, uchar mode, const std::string&amp; msg);
 	
-	PacketType SendSelfD(uchar myPlayerNum);
 	PacketType SendGiveAwayEverything(uchar myPlayerNum, uchar giveTo);
 	PacketType SendResign(uchar myPlayerNum);
 	PacketType SendJoinTeam(uchar myPlayerNum, uchar wantedTeamNum);

Modified: branches/caiinterface/rts/System/DemoRecorder.cpp
===================================================================
--- branches/caiinterface/rts/System/DemoRecorder.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/DemoRecorder.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -108,7 +108,7 @@
 	SNPRINTF(buf, sizeof(buf), &quot;%04i%02i%02i_%02i%02i%02i&quot;, newtime-&gt;tm_year+1900, newtime-&gt;tm_mon + 1, newtime-&gt;tm_mday,
         newtime-&gt;tm_hour, newtime-&gt;tm_min, newtime-&gt;tm_sec);
 	std::string name = std::string(buf) + &quot;_&quot; + mapname.substr(0, mapname.find_first_of(&quot;.&quot;));
-	name += std::string(&quot;_&quot;) + VERSION_STRING;
+	name += std::string(&quot;_&quot;) + VERSION_STRING_DETAILED;
 	// games without gameSetup should have different names
 	if (!gameSetup) {
 	    name = &quot;local_&quot; + name;

Modified: branches/caiinterface/rts/System/GlobalStuff.cpp
===================================================================
--- branches/caiinterface/rts/System/GlobalStuff.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/GlobalStuff.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -170,13 +170,14 @@
 	
 	assert(activeTeams &lt;= MAX_TEAMS);
 	assert(activeAllyTeams &lt;= MAX_TEAMS);
-	
-	for (unsigned i = 0; i &lt; static_cast&lt;unsigned&gt;(activePlayers); ++i)
+
+	for (int i = 0; i &lt; activePlayers; ++i)
 	{
+		// TODO: refactor
 		*static_cast&lt;PlayerBase*&gt;(players[i]) = setup-&gt;playerStartingData[i];
 	}
-	
-	for (unsigned i = 0; i &lt; static_cast&lt;unsigned&gt;(activeTeams); ++i)
+
+	for (int i = 0; i &lt; activeTeams; ++i)
 	{
 		teams[i]-&gt;metal = setup-&gt;startMetal;
 		teams[i]-&gt;metalIncome = setup-&gt;startMetal; // for the endgame statistics
@@ -219,9 +220,9 @@
 		}
 	}
 
-	for (unsigned allyTeam1 = 0; allyTeam1 &lt; static_cast&lt;unsigned&gt;(activeAllyTeams); ++allyTeam1)
+	for (int allyTeam1 = 0; allyTeam1 &lt; activeAllyTeams; ++allyTeam1)
 	{
-		for (unsigned allyTeam2 = 0; allyTeam2 &lt; static_cast&lt;unsigned&gt;(activeAllyTeams); ++allyTeam2)
+		for (int allyTeam2 = 0; allyTeam2 &lt; activeAllyTeams; ++allyTeam2)
 			allies[allyTeam1][allyTeam2] = setup-&gt;allyStartingData[allyTeam1].allies[allyTeam2];
 	}
 

Modified: branches/caiinterface/rts/System/LoadSaveHandler.cpp
===================================================================
--- branches/caiinterface/rts/System/LoadSaveHandler.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/LoadSaveHandler.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -209,7 +209,7 @@
 	}
 	gs-&gt;paused = false;
 	if (gameServer) {
-		gameServer-&gt;IsPaused = false;
+		gameServer-&gt;isPaused = false;
 		gameServer-&gt;syncErrorFrame = 0;
 	}
 	UnloadStartPicture();

Modified: branches/caiinterface/rts/System/Platform/BaseCmd.cpp
===================================================================
--- branches/caiinterface/rts/System/Platform/BaseCmd.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/Platform/BaseCmd.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -224,7 +224,7 @@
 {
 	if (!isdigit(s[0]) &amp;&amp; s[0] != '-' &amp;&amp; s[0] != '+')
 		return false;
-	for (int j = 1; j &lt; s.size(); ++j)
+	for (unsigned int j = 1; j &lt; s.size(); ++j)
 		if (!isdigit(s[j]))
 			return false;
 	return true;

Modified: branches/caiinterface/rts/System/Platform/ConfigHandler.cpp
===================================================================
--- branches/caiinterface/rts/System/Platform/ConfigHandler.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/Platform/ConfigHandler.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -18,6 +18,7 @@
 #include &quot;Linux/DotfileHandler.h&quot;
 #endif
 #include &lt;sstream&gt;
+#include &quot;Game/GameVersion.h&quot;
 
 
 /**
@@ -30,7 +31,6 @@
 
 
 std::string ConfigHandler::configSource;
-extern const char* const VERSION_STRING;
 
 
 /**

Modified: branches/caiinterface/rts/System/Platform/Linux/DataDirLocater.cpp
===================================================================
--- branches/caiinterface/rts/System/Platform/Linux/DataDirLocater.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/Platform/Linux/DataDirLocater.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -297,11 +297,20 @@
 
 	if (!writedir) {
 		// bail out
-		throw content_error(&quot;Not a single writable data directory found!\n\n&quot;
+#ifdef WIN32
+		const std::string errstr = &quot;Not a single writable data directory found!\n\n&quot;
 				&quot;Configure a writable data directory using either:\n&quot;
 				&quot;- the SPRING_DATADIR environment variable,\n&quot;
+				&quot;- a SpringData=C:/path/to/data declaration in spring's registry entry or\n&quot;
+				&quot;- by giving you write access to the installation directory&quot;;
+#else
+		const std::string errstr = &quot;Not a single writable data directory found!\n\n&quot;
+				&quot;Configure a writable data directory using either:\n&quot;
+				&quot;- the SPRING_DATADIR environment variable,\n&quot;
 				&quot;- a SpringData=/path/to/data declaration in ~/.springrc or\n&quot;
-				&quot;- the configuration file /etc/spring/datadir&quot;);
+				&quot;- the configuration file /etc/spring/datadir&quot;;
+#endif
+		throw content_error(errstr);
 	}
 
 	// for now, chdir to the datadirectory as a safety measure:

Modified: branches/caiinterface/rts/System/Platform/Win/AVIGenerator.cpp
===================================================================
--- branches/caiinterface/rts/System/Platform/Win/AVIGenerator.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/Platform/Win/AVIGenerator.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -347,7 +347,7 @@
 		freeImageBuffers.push_back(tmpBuf);
 	}
 
-	HWND mainWindow = FindWindow(NULL, (&quot;Spring &quot; + std::string(VERSION_STRING)).c_str());
+	HWND mainWindow = FindWindow(NULL, (&quot;Spring &quot; + std::string(VERSION_STRING_DETAILED)).c_str());
 	if(fullscreen){
 		ShowWindow(mainWindow, SW_SHOWMINNOACTIVE);
 	}

Modified: branches/caiinterface/rts/System/Platform/Win/CrashHandler.cpp
===================================================================
--- branches/caiinterface/rts/System/Platform/Win/CrashHandler.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/Platform/Win/CrashHandler.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -124,9 +124,9 @@
 	// Prologue.
 	logOutput.RemoveAllSubscribers();
 #ifdef USE_GML
-	PRINT(&quot;Spring %s MT (%d threads) has crashed.&quot;, VERSION_STRING, gmlThreadCount);
+	PRINT(&quot;Spring %s MT (%d threads) has crashed.&quot;, VERSION_STRING_DETAILED, gmlThreadCount);
 #else
-	PRINT(&quot;Spring %s has crashed.&quot;, VERSION_STRING);
+	PRINT(&quot;Spring %s has crashed.&quot;, VERSION_STRING_DETAILED);
 #endif
 	// Initialize IMAGEHLP.DLL.
 	SymInitialize(GetCurrentProcess(), &quot;.&quot;, TRUE);

Modified: branches/caiinterface/rts/System/SpringApp.cpp
===================================================================
--- branches/caiinterface/rts/System/SpringApp.cpp	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/System/SpringApp.cpp	2008-10-14 09:56:24 UTC (rev 6714)
@@ -228,7 +228,7 @@
 
 	FileSystemHandler::Initialize(true);
 
-	if (!InitWindow((&quot;Spring &quot; + std::string(VERSION_STRING)).c_str())) {
+	if (!InitWindow((&quot;Spring &quot; + std::string(VERSION_STRING_DETAILED)).c_str())) {
 		SDL_Quit();
 		return false;
 	}
@@ -629,19 +629,21 @@
  */
 void SpringApp::ParseCmdLine()
 {
-	cmdline-&gt;addoption('f', &quot;fullscreen&quot;,     OPTPARM_NONE,   &quot;&quot;,  &quot;Run in fullscreen mode&quot;);
-	cmdline-&gt;addoption('w', &quot;window&quot;,         OPTPARM_NONE,   &quot;&quot;,  &quot;Run in windowed mode&quot;);
-	cmdline-&gt;addoption('x', &quot;xresolution&quot;,    OPTPARM_INT,    &quot;&quot;,  &quot;Set X resolution&quot;);
-	cmdline-&gt;addoption('y', &quot;yresolution&quot;,    OPTPARM_INT,    &quot;&quot;,  &quot;Set Y resolution&quot;);
-	cmdline-&gt;addoption('m', &quot;minimise&quot;,       OPTPARM_NONE,   &quot;&quot;,  &quot;Start minimised&quot;);
-	cmdline-&gt;addoption('s', &quot;server&quot;,         OPTPARM_NONE,   &quot;&quot;,  &quot;Run as a server&quot;);
-	cmdline-&gt;addoption('c', &quot;client&quot;,         OPTPARM_NONE,   &quot;&quot;,  &quot;Run as a client&quot;);
-	cmdline-&gt;addoption('p', &quot;projectiledump&quot;, OPTPARM_NONE,   &quot;&quot;,  &quot;Dump projectile class info in projectiles.txt&quot;);
-	cmdline-&gt;addoption('t', &quot;textureatlas&quot;,   OPTPARM_NONE,   &quot;&quot;,  &quot;Dump each finalized textureatlas in textureatlasN.tga&quot;);
-	cmdline-&gt;addoption('a', &quot;list-skirmish-ais&quot;,   OPTPARM_NONE,   &quot;&quot;,  &quot;Dump a list of all available skirmish AIs&quot;);
-	cmdline-&gt;addoption('q', &quot;quit&quot;,           OPTPARM_INT,    &quot;T&quot;, &quot;Quit immediately on game over or after T seconds&quot;);
-	cmdline-&gt;addoption('n', &quot;name&quot;,           OPTPARM_STRING, &quot;&quot;,  &quot;Set your player name&quot;);
-	cmdline-&gt;addoption('C', &quot;config&quot;,         OPTPARM_STRING, &quot;&quot;,  &quot;Configuration file&quot;);
+	cmdline-&gt;addoption('f', &quot;fullscreen&quot;,         OPTPARM_NONE,   &quot;&quot;,  &quot;Run in fullscreen mode&quot;);
+	cmdline-&gt;addoption('w', &quot;window&quot;,             OPTPARM_NONE,   &quot;&quot;,  &quot;Run in windowed mode&quot;);
+	cmdline-&gt;addoption('x', &quot;xresolution&quot;,        OPTPARM_INT,    &quot;&quot;,  &quot;Set X resolution&quot;);
+	cmdline-&gt;addoption('y', &quot;yresolution&quot;,        OPTPARM_INT,    &quot;&quot;,  &quot;Set Y resolution&quot;);
+	cmdline-&gt;addoption('m', &quot;minimise&quot;,           OPTPARM_NONE,   &quot;&quot;,  &quot;Start minimised&quot;);
+	cmdline-&gt;addoption('s', &quot;server&quot;,             OPTPARM_NONE,   &quot;&quot;,  &quot;Run as a server&quot;);
+	cmdline-&gt;addoption('c', &quot;client&quot;,             OPTPARM_NONE,   &quot;&quot;,  &quot;Run as a client&quot;);
+	cmdline-&gt;addoption('p', &quot;projectiledump&quot;,     OPTPARM_NONE,   &quot;&quot;,  &quot;Dump projectile class info in projectiles.txt&quot;);
+	cmdline-&gt;addoption('t', &quot;textureatlas&quot;,       OPTPARM_NONE,   &quot;&quot;,  &quot;Dump each finalized textureatlas in textureatlasN.tga&quot;);
+	cmdline-&gt;addoption('i', &quot;list-ai-interfaces&quot;, OPTPARM_NONE,   &quot;&quot;,  &quot;Dump a list of available AI Interfaces to stdout&quot;);
+	cmdline-&gt;addoption('a', &quot;list-skirmish-ais&quot;,  OPTPARM_NONE,   &quot;&quot;,  &quot;Dump a list of available Skirmish AIs to stdout&quot;);
+	cmdline-&gt;addoption('g', &quot;list-group-ais&quot;,     OPTPARM_NONE,   &quot;&quot;,  &quot;Dump a list of available Group AIs to stdout&quot;);
+	cmdline-&gt;addoption('q', &quot;quit&quot;,               OPTPARM_INT,    &quot;T&quot;, &quot;Quit immediately on game over or after T seconds&quot;);
+	cmdline-&gt;addoption('n', &quot;name&quot;,               OPTPARM_STRING, &quot;&quot;,  &quot;Set your player name&quot;);
+	cmdline-&gt;addoption('C', &quot;config&quot;,             OPTPARM_STRING, &quot;&quot;,  &quot;Configuration file&quot;);
 	cmdline-&gt;parse();
 
 	string configSource;
@@ -667,9 +669,15 @@
 	} else if (cmdline-&gt;result(&quot;projectiledump&quot;)) {
 		CCustomExplosionGenerator::OutputProjectileClassInfo();
 		exit(0);
+	} else if (cmdline-&gt;result(&quot;list-ai-interfaces&quot;)) {
+		IAILibraryManager::OutputAIInterfacesInfo();
+		exit(0);
 	} else if (cmdline-&gt;result(&quot;list-skirmish-ais&quot;)) {
 		IAILibraryManager::OutputSkirmishAIInfo();
 		exit(0);
+	} else if (cmdline-&gt;result(&quot;list-group-ais&quot;)) {
+		IAILibraryManager::OutputGroupAIInfo();
+		exit(0);
 	}
 
 	// flags
@@ -1070,8 +1078,13 @@
 		if (globalQuit)
 			break;
 
-		if (!Update())
-			break;
+		try {
+			if (!Update())
+				break;
+		} catch (content_error &amp;e) {
+			logOutput &lt;&lt; &quot;Caught content exception: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
+			handleerror(NULL, e.what(), &quot;Content error&quot;, MBF_OK | MBF_EXCL);
+		}
 	}
 	ENTER_MIXED;
 

Modified: branches/caiinterface/rts/build/kdevelop/rts.kdevelop
===================================================================
--- branches/caiinterface/rts/build/kdevelop/rts.kdevelop	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/build/kdevelop/rts.kdevelop	2008-10-14 09:56:24 UTC (rev 6714)
@@ -168,108 +168,108 @@
       &lt;path&gt;AI/Skirmish/JCAI/TaskManager.h&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/JCAI/Tasks.cpp&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/JCAI/Tasks.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/AreaManager.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/AreaManager.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/AttackGroup.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/AttackGroup.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/AttackHandler.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/AttackHandler.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/BuildUp.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/BuildUp.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/Containers.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/CoverageHandler.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/CoverageHandler.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/DamageControl.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/DamageControl.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/Debug.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/Debug.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/DefenseMatrix.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/DefenseMatrix.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/Definitions.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/DGunController.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/DGunController.hpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/EconomyManager.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/EconomyManager.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/EconomyTracker.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/EconomyTracker.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/GlobalAI.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/GlobalAI.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/Include.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/Maths.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/Maths.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/MetalMaker.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/MetalMaker.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/MetalMap.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/MetalMap.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/MicroPather.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/MicroPather.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/MTRand.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/MTRand.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/PathFinder.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/PathFinder.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/SpotFinder.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/SpotFinder.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/SunParser.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/SunParser.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/SurveillanceHandler.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/SurveillanceHandler.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/TestAI.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/ThreatMap.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/ThreatMap.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/Unit.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/Unit.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/UnitHandler.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/UnitHandler.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/UnitTable.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAI-0.2/UnitTable.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/AIExports.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/AttackGroup.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/AttackGroup.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/AttackHandler.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/AttackHandler.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/BuildUp.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/BuildUp.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/Containers.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/Debug.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/Debug.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/DefenseMatrix.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/DefenseMatrix.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/Defines.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/DGunController.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/DGunController.hpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/EconomyManager.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/EconomyManager.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/EconomyTracker.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/EconomyTracker.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/GlobalAI.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/GlobalAI.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/Include.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/Maths.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/Maths.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/MetalMaker.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/MetalMaker.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/MetalMap.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/MetalMap.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/MicroPather.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/MicroPather.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/MTRand.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/MTRand.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/PathFinder.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/PathFinder.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/SpotFinder.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/SpotFinder.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/SunParser.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/SunParser.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/ThreatMap.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/ThreatMap.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/Unit.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/Unit.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/UnitHandler.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/UnitHandler.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/UnitTable.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/KAIK-0.13/UnitTable.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/AreaManager.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/AreaManager.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/AttackGroup.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/AttackGroup.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/AttackHandler.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/AttackHandler.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/BuildUp.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/BuildUp.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/Containers.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/CoverageHandler.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/CoverageHandler.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/DamageControl.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/DamageControl.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/Debug.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/Debug.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/DefenseMatrix.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/DefenseMatrix.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/Definitions.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/DGunController.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/DGunController.hpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/EconomyManager.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/EconomyManager.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/EconomyTracker.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/EconomyTracker.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/GlobalAI.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/GlobalAI.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/Include.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/Maths.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/Maths.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/MetalMaker.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/MetalMaker.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/MetalMap.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/MetalMap.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/MicroPather.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/MicroPather.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/MTRand.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/MTRand.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/PathFinder.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/PathFinder.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/SpotFinder.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/SpotFinder.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/SunParser.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/SunParser.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/SurveillanceHandler.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/SurveillanceHandler.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/TestAI.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/ThreatMap.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/ThreatMap.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/Unit.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/Unit.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/UnitHandler.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/UnitHandler.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/UnitTable.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAI/UnitTable.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/AIExports.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/AttackGroup.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/AttackGroup.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/AttackHandler.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/AttackHandler.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/BuildUp.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/BuildUp.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/Containers.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/Debug.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/Debug.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/DefenseMatrix.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/DefenseMatrix.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/Defines.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/DGunController.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/DGunController.hpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/EconomyManager.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/EconomyManager.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/EconomyTracker.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/EconomyTracker.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/GlobalAI.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/GlobalAI.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/Include.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/Maths.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/Maths.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/MetalMaker.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/MetalMaker.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/MetalMap.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/MetalMap.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/MicroPather.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/MicroPather.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/MTRand.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/MTRand.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/PathFinder.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/PathFinder.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/SpotFinder.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/SpotFinder.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/SunParser.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/SunParser.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/ThreatMap.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/ThreatMap.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/Unit.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/Unit.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/UnitHandler.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/UnitHandler.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/UnitTable.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/KAIK/UnitTable.h&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/NTai&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/NTai/AI&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/NTai/AI/Makefile&lt;/path&gt;
@@ -376,35 +376,35 @@
       &lt;path&gt;AI/Skirmish/NTai/AI/NTai/Units/IBehaviour.h&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/NTai/AI/NTai/Units/ITaskManagerFactory.h&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/NTai/AI/NTai/Units/ITaskManager.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/Builder.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/Builder.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/BuilderPlacement.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/BuilderPlacement.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/CombatManager.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/CombatManager.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/GlobalAIs.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/Global.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/Global.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/GMetalMap.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/GMetalMap.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/GTerrainMap.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/GTerrainMap.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/KrogsMetalClass&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/KrogsMetalClass/MetalMap.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/KrogsMetalClass/MetalMap.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/LogFile.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/LogFile.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/PowerManager.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/PowerManager.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/RAI.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/RAI.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/SWeaponManager.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/SWeaponManager.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/UnitDef.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/UnitDef.h&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/UnitManager.cpp&lt;/path&gt;
-      &lt;path&gt;AI/Skirmish/RAI-0.553/UnitManager.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/Builder.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/Builder.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/BuilderPlacement.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/BuilderPlacement.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/CombatManager.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/CombatManager.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/GlobalAIs.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/Global.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/Global.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/GMetalMap.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/GMetalMap.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/GTerrainMap.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/GTerrainMap.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/KrogsMetalClass&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/KrogsMetalClass/MetalMap.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/KrogsMetalClass/MetalMap.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/LogFile.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/LogFile.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/PowerManager.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/PowerManager.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/RAI.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/RAI.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/SWeaponManager.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/SWeaponManager.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/UnitDef.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/UnitDef.h&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/UnitManager.cpp&lt;/path&gt;
+      &lt;path&gt;AI/Skirmish/RAI/UnitManager.h&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/TestGlobalAI&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/TestGlobalAI/TestAI.cpp&lt;/path&gt;
       &lt;path&gt;AI/Skirmish/TestGlobalAI/TestGlobalAI.cpp&lt;/path&gt;

Modified: branches/caiinterface/rts/lib/CMakeLists.txt
===================================================================
--- branches/caiinterface/rts/lib/CMakeLists.txt	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/rts/lib/CMakeLists.txt	2008-10-14 09:56:24 UTC (rev 6714)
@@ -36,4 +36,4 @@
 ENDIF (UNIX)
 TARGET_LINK_LIBRARIES(minizip z)
 
-ADD_SUBDIRECTORY(streflop)
\ No newline at end of file
+ADD_SUBDIRECTORY(streflop)

Modified: branches/caiinterface/tools/DedicatedServer/CMakeLists.txt
===================================================================
--- branches/caiinterface/tools/DedicatedServer/CMakeLists.txt	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/tools/DedicatedServer/CMakeLists.txt	2008-10-14 09:56:24 UTC (rev 6714)
@@ -50,11 +50,10 @@
 	../../rts/Lua/LuaUtils
 	../../rts/Map/MapParser
 	../../rts/Rendering/Textures/TAPalette)
-TARGET_LINK_LIBRARIES(springserver SDL hpiutil2 7zip minizip lua)
+TARGET_LINK_LIBRARIES(springserver ${SDL_LIBRARY} ${Boost_REGEX_LIBRARY} ${Boost_THREAD_LIBRARY} hpiutil2 7zip minizip lua)
 if (MINGW)
-	TARGET_LINK_LIBRARIES (springserver ws2_32 boost_thread-mt boost_regex-mt)
+	TARGET_LINK_LIBRARIES (springserver ws2_32)
 else (MINGW)
-	TARGET_LINK_LIBRARIES (springserver ${Boost_REGEX_LIBRARY} ${Boost_THREAD_LIBRARY})
 	ADD_DEFINITIONS (-fvisibility=default ) #overwrite hidden visibility
 endif (MINGW)
 

Modified: branches/caiinterface/tools/unitsync/CMakeLists.txt
===================================================================
--- branches/caiinterface/tools/unitsync/CMakeLists.txt	2008-10-14 09:29:37 UTC (rev 6713)
+++ branches/caiinterface/tools/unitsync/CMakeLists.txt	2008-10-14 09:56:24 UTC (rev 6714)
@@ -4,15 +4,12 @@
 	INCLUDE_DIRECTORIES(${MINGWLIBS}/include/python2.5)
 	set (JNI_FOUND TRUE)
 ELSE (MINGW)
-	FIND_PACKAGE(SDL REQUIRED)
-	INCLUDE_DIRECTORIES(${SDL_INCLUDE_DIR})
-	
 	FIND_PACKAGE(Freetype REQUIRED)
 	INCLUDE_DIRECTORIES(${FREETYPE_INCLUDE_DIR})
 	
 	FIND_PACKAGE(GLEW REQUIRED)
 	
-	set (unitsync_libs ${GLEW_LIBRARIES} IL openal GL GLU)
+	set (unitsync_libs ${GLEW_LIBRARIES} ${DEVIL_IL_LIBRARY} ${OPENAL_LIBRARY} ${GL_gl_LIBRARY} ${GL_glu_LIBRARY})
 	list (APPEND unitsync_libs util) # sometimes this is needed (and I have no clue why)
 	
 	FIND_PACKAGE(PythonLibs)
@@ -73,7 +70,7 @@
 	list(APPEND unitsync_files javabind)
 endif (JAVA_FOUND)
 ADD_LIBRARY(unitsync SHARED ${platformfiles} ${unitsync_files} ${fsfiles} unitsync LuaParserAPI Syncer SyncServer stdafx)
-TARGET_LINK_LIBRARIES(unitsync ${unitsync_libs} hpiutil2 7zip minizip lua boost_regex-mt ILU SDL)
+TARGET_LINK_LIBRARIES(unitsync ${unitsync_libs} hpiutil2 7zip minizip lua ${Boost_REGEX_LIBRARY} ${IL_ILU_LIBRARY} ${SDL_LIBRARY})
 if (PYTHONLIBS_FOUND)
 	TARGET_LINK_LIBRARIES(unitsync ${PYTHON_LIBRARIES})
 endif (PYTHONLIBS_FOUND)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001482.html">[Taspring-linux-commit] r6713 - trunk/rts/Game
</A></li>
	<LI>Next message: <A HREF="001484.html">[Taspring-linux-commit] r6715 - trunk/rts/Rendering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1483">[ date ]</a>
              <a href="thread.html#1483">[ thread ]</a>
              <a href="subject.html#1483">[ subject ]</a>
              <a href="author.html#1483">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
