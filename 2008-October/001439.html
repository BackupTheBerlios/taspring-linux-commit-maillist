<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6670 - in	branches/caiinterface/rts/ExternalAI: . Interface
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6670%20-%20in%0A%09branches/caiinterface/rts/ExternalAI%3A%20.%20Interface&In-Reply-To=%3C20081011123753.C39A446F0%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001438.html">
   <LINK REL="Next"  HREF="001440.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6670 - in	branches/caiinterface/rts/ExternalAI: . Interface</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6670%20-%20in%0A%09branches/caiinterface/rts/ExternalAI%3A%20.%20Interface&In-Reply-To=%3C20081011123753.C39A446F0%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6670 - in	branches/caiinterface/rts/ExternalAI: . Interface">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sat Oct 11 14:37:53 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001438.html">[Taspring-linux-commit] r6669 - in branches/caiinterface:	Documentation game/LuaUI/Widgets installer installer/sections	rts/ExternalAI rts/Game rts/Game/Camera rts/Game/UI rts/Lua	rts/Map rts/Rendering rts/Rendering/Env	rts/Rendering/Textures rts/Rendering/UnitModels	rts/Sim/Features rts/Sim/Misc rts/Sim/MoveTypes rts/Sim/Path	rts/Sim/Projectiles rts/Sim/Projectiles/WeaponProjectiles	rts/Sim/Units rts/Sim/Units/UnitTypes rts/Sim/Weapons	rts/System rts/System/Platform rts/build/vstudio8 rts/lib/gml	tools/springie/Springie/autohost tools/springie/Springie/spring
</A></li>
        <LI>Next message: <A HREF="001440.html">[Taspring-linux-commit] r6671 - trunk/rts/Sim/MoveTypes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1439">[ date ]</a>
              <a href="thread.html#1439">[ thread ]</a>
              <a href="subject.html#1439">[ subject ]</a>
              <a href="author.html#1439">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hoijui
Date: 2008-10-11 14:37:53 +0200 (Sat, 11 Oct 2008)
New Revision: 6670

Added:
   branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h
   branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp
Log:
forgot these two files :/

Added: branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h
===================================================================
--- branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h	                        (rev 0)
+++ branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h	2008-10-11 12:37:53 UTC (rev 6670)
@@ -0,0 +1,47 @@
+/*
+	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+	
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef _SSTATICGLOBALDATA_H
+#define	_SSTATICGLOBALDATA_H
+
+#ifdef	__cplusplus
+extern &quot;C&quot; {
+#endif	/* __cplusplus */
+
+// paths/dirs stored in this struct are guaranteed
+// to come with no '/' or '\\' at the end.
+// they come like this:	/home/username/.spring
+// NOT like this:		/home/username/.spring/
+struct SStaticGlobalData {
+	unsigned int maxTeams;
+	const char* springVersion;
+	const char* libDir;
+	unsigned int numDataDirs;
+	const char** dataDirs;
+};
+
+#ifdef	__cplusplus
+}		/* extern &quot;C&quot; */
+#endif	/* __cplusplus */
+
+#if defined	__cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
+SStaticGlobalData* createStaticGlobalData();
+void freeStaticGlobalData(SStaticGlobalData* staticGlobalData);
+#endif	/* defined	__cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */
+
+#endif	/* _SSTATICGLOBALDATA_H */
+


Property changes on: branches/caiinterface/rts/ExternalAI/Interface/SStaticGlobalData.h
___________________________________________________________________
Name: svn:eol-style
   + native

Added: branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp
===================================================================
--- branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp	                        (rev 0)
+++ branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp	2008-10-11 12:37:53 UTC (rev 6670)
@@ -0,0 +1,118 @@
+/*
+	Copyright (c) 2008 Robin Vobruba &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">hoijui.quaero at gmail.com</A>&gt;
+	
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &lt;string&gt;
+
+
+#include &quot;Interface/SStaticGlobalData.h&quot;
+
+#if defined	__cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE
+#include &quot;System/GlobalStuff.h&quot; // for MAX_TEAMS
+#include &quot;System/Platform/FileSystem.h&quot; // for data directories
+#include &quot;Game/GameVersion.h&quot; // for VERSION_STRING
+
+#ifdef WIN32
+//#include &lt;windows.h&gt;	// filesystem operations
+#include &lt;direct.h&gt;	// filesystem operations
+#else
+#include &lt;unistd.h&gt;	// filesystem operations
+#endif
+#include &lt;stdlib.h&gt;	// malloc, calloc, free
+#include &lt;string.h&gt;	// strcpy
+
+bool getCWD(char* cwdPath, unsigned int maxLength) {
+
+	bool success = false;
+	//#ifdef WIN32
+	//	unsigned int cwdLength = GetCurrentDirectory(maxLength, cwdPath);
+	//	if (cwdLength &gt; 0 &amp;&amp; cwdLength &lt;= maxLength) {
+	//		success = true;
+	//	}
+	//#else	/* WIN32 */
+		const char* ret = getcwd(cwdPath, maxLength);
+		if (ret != NULL) {
+			success = true;
+		}
+	//#endif	/* WIN32 */
+
+	if (!success) {
+		cwdPath[0] = '\0'; // make the path an empty string
+		//cwdPath = &quot;./&quot;;
+	}
+
+	return success;
+}
+
+/**
+ * Appends '/' to inPath if it is not empty and does not yet have a '/'
+ * or a '\\'at the end.
+ */
+std::string ensurePathHasNoSlashAtTail(const std::string&amp; inPath) {
+	
+	std::string outPath = inPath;
+	
+	if (!outPath.empty()) {
+		char lastChar = outPath.at(outPath.size()-1);
+		if (lastChar == '/' || lastChar == '\\') {
+			outPath.erase(outPath.size()-1, 1);
+		}
+	}
+	
+	return outPath;
+}
+
+SStaticGlobalData* createStaticGlobalData() {
+	
+	char tmpPath[1024];
+	getCWD(tmpPath, sizeof(tmpPath));
+	std::string cleanCWD = ensurePathHasNoSlashAtTail(tmpPath);
+	char* cwdPath = (char*) calloc(cleanCWD.size()+1, sizeof(char));
+	strcpy(cwdPath, cleanCWD.c_str());
+
+	const std::vector&lt;std::string&gt; dds = FileSystemHandler::GetInstance().GetDataDirectories();
+	unsigned int numDataDirs = dds.size();
+	char** dataDirs = (char**) calloc(numDataDirs, sizeof(char*));
+	for (unsigned int i=0; i &lt; numDataDirs; ++i) {
+		std::string cleanPath = ensurePathHasNoSlashAtTail(dds.at(i));
+		dataDirs[i] = (char*) calloc(cleanPath.size()+1, sizeof(char));
+		strcpy(dataDirs[i], cleanPath.c_str());
+	}
+
+	const SStaticGlobalData sgd = {
+		MAX_TEAMS,
+		VERSION_STRING,	// spring version string
+		cwdPath,		// libDir
+		numDataDirs,
+		(const char**) dataDirs};
+	SStaticGlobalData* staticGlobalData = (struct SStaticGlobalData*) malloc(sizeof(struct SStaticGlobalData));
+	*staticGlobalData = sgd;
+	
+	return staticGlobalData;
+}
+
+void freeStaticGlobalData(SStaticGlobalData* staticGlobalData) {
+	
+	free(const_cast&lt;char*&gt;(staticGlobalData-&gt;springVersion));
+	free(const_cast&lt;char*&gt;(staticGlobalData-&gt;libDir));
+	for(unsigned int i=0; i &lt; staticGlobalData-&gt;numDataDirs; ++i)
+		free(const_cast&lt;char*&gt;(staticGlobalData-&gt;dataDirs[i]));
+	free(const_cast&lt;char**&gt;(staticGlobalData-&gt;dataDirs));
+	free(staticGlobalData);
+	staticGlobalData = NULL;
+}
+
+#endif	/* defined	__cplusplus &amp;&amp; !defined BUILDING_AI &amp;&amp; !defined BUILDING_AI_INTERFACE */


Property changes on: branches/caiinterface/rts/ExternalAI/SStaticGlobalData.cpp
___________________________________________________________________
Name: svn:eol-style
   + native


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001438.html">[Taspring-linux-commit] r6669 - in branches/caiinterface:	Documentation game/LuaUI/Widgets installer installer/sections	rts/ExternalAI rts/Game rts/Game/Camera rts/Game/UI rts/Lua	rts/Map rts/Rendering rts/Rendering/Env	rts/Rendering/Textures rts/Rendering/UnitModels	rts/Sim/Features rts/Sim/Misc rts/Sim/MoveTypes rts/Sim/Path	rts/Sim/Projectiles rts/Sim/Projectiles/WeaponProjectiles	rts/Sim/Units rts/Sim/Units/UnitTypes rts/Sim/Weapons	rts/System rts/System/Platform rts/build/vstudio8 rts/lib/gml	tools/springie/Springie/autohost tools/springie/Springie/spring
</A></li>
	<LI>Next message: <A HREF="001440.html">[Taspring-linux-commit] r6671 - trunk/rts/Sim/MoveTypes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1439">[ date ]</a>
              <a href="thread.html#1439">[ thread ]</a>
              <a href="subject.html#1439">[ subject ]</a>
              <a href="author.html#1439">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
