<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r5288 - in trunk/Lobby/AFLobby/src/aflobby:	. UI framework protocol protocol/tasserver
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-January/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r5288%20-%20in%20trunk/Lobby/AFLobby/src/aflobby%3A%0A%09.%20UI%20framework%20protocol%20protocol/tasserver&In-Reply-To=%3CE1JBrER-0004XV-BQ%40proserver.fnord.lan%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000095.html">
   <LINK REL="Next"  HREF="000097.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r5288 - in trunk/Lobby/AFLobby/src/aflobby:	. UI framework protocol protocol/tasserver</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r5288%20-%20in%20trunk/Lobby/AFLobby/src/aflobby%3A%0A%09.%20UI%20framework%20protocol%20protocol/tasserver&In-Reply-To=%3CE1JBrER-0004XV-BQ%40proserver.fnord.lan%3E"
       TITLE="[Taspring-linux-commit] r5288 - in trunk/Lobby/AFLobby/src/aflobby:	. UI framework protocol protocol/tasserver">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Mon Jan  7 13:37:31 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000095.html">[Taspring-linux-commit] r5287 - in trunk/Lobby/AFLobby/src/aflobby:	. framework protocol/tasserver
</A></li>
        <LI>Next message: <A HREF="000097.html">[Taspring-linux-commit] r5289 - in branches/testserver: ChanServ	WebInterface WebInterface/inc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96">[ date ]</a>
              <a href="thread.html#96">[ thread ]</a>
              <a href="subject.html#96">[ subject ]</a>
              <a href="author.html#96">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: tnowell
Date: 2008-01-07 13:37:31 +0100 (Mon, 07 Jan 2008)
New Revision: 5288

Added:
   trunk/Lobby/AFLobby/src/aflobby/UI/CPlayerTableModel.java
Removed:
   trunk/Lobby/AFLobby/src/aflobby/CPlayerTableModel.java
Modified:
   trunk/Lobby/AFLobby/src/aflobby/CBattleTableModel.java
   trunk/Lobby/AFLobby/src/aflobby/CChannel.java
   trunk/Lobby/AFLobby/src/aflobby/CChannelView.java
   trunk/Lobby/AFLobby/src/aflobby/CSettings.java
   trunk/Lobby/AFLobby/src/aflobby/IView.java
   trunk/Lobby/AFLobby/src/aflobby/LMain.form
   trunk/Lobby/AFLobby/src/aflobby/LMain.java
   trunk/Lobby/AFLobby/src/aflobby/UI/CView.java
   trunk/Lobby/AFLobby/src/aflobby/framework/CBaseModule.java
   trunk/Lobby/AFLobby/src/aflobby/languages.properties
   trunk/Lobby/AFLobby/src/aflobby/protocol/IProtocol.java
   trunk/Lobby/AFLobby/src/aflobby/protocol/tasserver/CTASServerProtocol.java
Log:
- moved playertablemodel to a different package
- Changed LMain main window from an AWT window to a Swing window, and did some cleanup
- removed the main content pane from LMain and it was no longer necessary.
- minor changes to CSettings to prevent a mysterious crash by removing the GUI creation from the swing event thread. I must look into this further as this is a breach of the event thread golden rules.

Modified: trunk/Lobby/AFLobby/src/aflobby/CBattleTableModel.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/CBattleTableModel.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/CBattleTableModel.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -68,7 +68,6 @@
 
     CBattleTableModel(LMain L) {
         LM = L;
-        //this.cv = cv;
     }
 
     public int getRowCount() {

Modified: trunk/Lobby/AFLobby/src/aflobby/CChannel.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/CChannel.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/CChannel.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -47,9 +47,10 @@
     //public Timer jast;
     public boolean inchannel = true;
     //private boolean wipenext;
-    static ImageIcon[] ranks = null;
-    static ImageIcon[] smallranks = null;
-    static TreeMap&lt;String, ImageIcon&gt; flags = new TreeMap&lt;String,ImageIcon&gt;();
+    public static ImageIcon[] ranks = null;
+    public static ImageIcon[] smallranks = null;
+    public static TreeMap&lt;String, ImageIcon&gt; flags = new TreeMap&lt;String,ImageIcon&gt;();
+    
     FileHandler txtLog = null;
     Logger logger = null;
     CVectorListModel vmodel = new CVectorListModel();
@@ -963,4 +964,5 @@
     public void OnRemove() {
 
     }
+
 }
\ No newline at end of file

Modified: trunk/Lobby/AFLobby/src/aflobby/CChannelView.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/CChannelView.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/CChannelView.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -6,6 +6,7 @@
 
 package aflobby;
 
+import aflobby.UI.CPlayerTableModel;
 import aflobby.UI.CUISettings;
 import aflobby.UI.CUserSettings;
 import aflobby.UI.CView;
@@ -44,10 +45,6 @@
  * @author  Shade
  */
 public class CChannelView extends CView {
-
-    //public LMain LM;
-    boolean redrawusers = true;
-    //int status;
     
     
     public boolean htmlaccess = false;
@@ -58,10 +55,6 @@
     CPlayerTableModel usertablemodel = null;
     TableRowSorter&lt;CPlayerTableModel&gt; playertablesorter = null;
     
-    
-    
-    
-    
 
     public CChannelView(LMain L) {
         try {

Deleted: trunk/Lobby/AFLobby/src/aflobby/CPlayerTableModel.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/CPlayerTableModel.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/CPlayerTableModel.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -1,154 +0,0 @@
-/*
- * CBattleTableModel.java
- *
- * Created on 17 September 2006, 02:19
- *
- * To change this template, choose Tools | Template Manager
- * and open the template in the editor.
- */
-
-package aflobby;
-
-import java.util.ArrayList;
-import java.util.Iterator;
-import javax.swing.ImageIcon;
-import javax.swing.table.AbstractTableModel;
-
-/**
- *
- * @author AF
- */
-public class CPlayerTableModel extends AbstractTableModel {
-
-    
-    LMain LM;
-    //CChannelView cv;
-    private String[] columns = {&quot;Flag&quot;,&quot;Rank&quot;,&quot;...&quot;,&quot;Username&quot;,&quot;Status&quot;};//{java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Description&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Status&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Map&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Mod&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Host&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Players&quot;)}; //,&quot;ID&quot;&quot;Private?&quot;,
-    public ArrayList&lt;CPlayer&gt; players = new ArrayList&lt;CPlayer&gt;();
-
-    CPlayerTableModel(LMain L) {
-        LM = L;
-        //this.cv = cv;
-    }
-
-    public void clear(){
-        players.clear();
-        fireTableDataChanged();
-    }
-    
-    public int getRowCount() {
-        return players.size();
-    }
-
-    public int getColumnCount() {
-        return columns.length;
-    }
-
-
-    @Override
-    public String getColumnName(int col) {
-        return columns[col];
-    }
-
-    CPlayer GetPlayerAt(int row) {
-        //synchronized(battles){
-        if (row &lt; players.size()) {
-            return players.get(row); //
-        } else {
-            return null;
-        }
-        //}
-    }
-
-    public Object getValueAt(int row, int col) {
-
-        if (row &gt; players.size()) {
-            return &quot;&quot;;
-        }
-
-        CPlayer b = GetPlayerAt(row);
-        if (b == null) {
-            return &quot;&quot;;
-        }
-
-        switch (col) {
-            case 0:
-                return CChannel.GetFlagIcon(b.getCountry());
-            case 1:
-                return CChannel.smallranks[b.rank];
-            case 2:
-                if(Misc.getBotModeFromStatus(b.getStatus())){
-                    return CChannel.botimg;
-                }else if (Misc.getAccessFromStatus(b.getStatus())&gt;0){
-                    return CChannel.adminimg;
-                }else{
-                    return null;
-                }
-            case 3:
-                return b.name;
-            case 4:
-                return b.statString;
-            default:
-                break;
-        }
-
-        return &quot;&quot;;
-    }
-
-    /**
-     * 
-     * @param p
-     */
-    public void AddPlayer(CPlayer p) {
-        if(p == null){
-            return;
-        }
-        
-        if(players.contains(p)){
-            return;
-        }
-        
-        players.add(p);
-        fireTableDataChanged();
-    }
-
-    public void RemovePlayer(CPlayer b) {
-        synchronized (players) {
-            Iterator&lt;CPlayer&gt; i = players.iterator();
-            while(i.hasNext()){
-                CPlayer ba = i.next();
-                if(ba == b){
-                    i.remove();
-                }
-            }
-        }
-        fireTableDataChanged();
-//        synchronized (battles) {
-//            battles.remove(b);
-//        }
-//        fireTableDataChanged();
-//        return b;
-    }
-
-    @Override
-    public boolean isCellEditable(int rowIndex, int columnIndex) {
-        return false;
-    }
-    
-    @Override
-    public Class getColumnClass(int column) {
-        if(column &lt;3){
-            return ImageIcon.class;
-        }else{
-            return String.class;
-        }
-        /*Class returnValue;
-        if ((column &gt;= 0) &amp;&amp; (column &lt; getColumnCount())) {
-            returnValue = getValueAt(0, column).getClass();
-        } else {
-            returnValue = Object.class;
-        }
-        return returnValue;*/
-     }
-
-}
\ No newline at end of file

Modified: trunk/Lobby/AFLobby/src/aflobby/CSettings.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/CSettings.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/CSettings.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -72,15 +72,15 @@
      */
     public CSettings(LMain LM, final boolean fullview) {
         this.LM = LM;
-        this.setTitle(&quot;CSettings&quot;);
+        setTitle(&quot;CSettings&quot;);
         
         
-        Runnable doWorkRunnable1 = new Runnable() {
-            public void run() {
+        //Runnable doWorkRunnable1 = new Runnable() {
+        //    public void run() {
                 initComponents();
-            }
-        };
-        SwingUtilities.invokeLater(doWorkRunnable1);
+        //    }
+        //};
+        //SwingUtilities.invokeLater(doWorkRunnable1);
         
         
         Runnable doWorkRunnable = new Runnable() {

Modified: trunk/Lobby/AFLobby/src/aflobby/IView.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/IView.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/IView.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -13,7 +13,7 @@
  *
  * @author Tom
  */
-public class IView{
+public class IView {
     public String Title;
     public String UserTitle;
     public LMain LM;

Modified: trunk/Lobby/AFLobby/src/aflobby/LMain.form
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/LMain.form	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/LMain.form	2008-01-07 12:37:31 UTC (rev 5288)
@@ -1,94 +1,32 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
 
-&lt;Form version=&quot;1.5&quot; maxVersion=&quot;1.5&quot; type=&quot;org.netbeans.modules.form.forminfo.FrameFormInfo&quot;&gt;
-  &lt;NonVisualComponents&gt;
-    &lt;Container class=&quot;javax.swing.JInternalFrame&quot; name=&quot;jInternalFrame1&quot;&gt;
-      &lt;Properties&gt;
-        &lt;Property name=&quot;visible&quot; type=&quot;boolean&quot; value=&quot;true&quot;/&gt;
-      &lt;/Properties&gt;
-
-      &lt;Layout&gt;
-        &lt;DimensionLayout dim=&quot;0&quot;&gt;
-          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace min=&quot;0&quot; pref=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-          &lt;/Group&gt;
-        &lt;/DimensionLayout&gt;
-        &lt;DimensionLayout dim=&quot;1&quot;&gt;
-          &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-              &lt;EmptySpace min=&quot;0&quot; pref=&quot;0&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-          &lt;/Group&gt;
-        &lt;/DimensionLayout&gt;
-      &lt;/Layout&gt;
-    &lt;/Container&gt;
-  &lt;/NonVisualComponents&gt;
+&lt;Form version=&quot;1.3&quot; maxVersion=&quot;1.5&quot; type=&quot;org.netbeans.modules.form.forminfo.JFrameFormInfo&quot;&gt;
   &lt;Properties&gt;
-    &lt;Property name=&quot;font&quot; type=&quot;java.awt.Font&quot; editor=&quot;org.netbeans.beaninfo.editors.FontEditor&quot;&gt;
-      &lt;Font name=&quot;Arial&quot; size=&quot;12&quot; style=&quot;0&quot;/&gt;
-    &lt;/Property&gt;
+    &lt;Property name=&quot;defaultCloseOperation&quot; type=&quot;int&quot; value=&quot;2&quot;/&gt;
     &lt;Property name=&quot;iconImage&quot; type=&quot;java.awt.Image&quot; editor=&quot;org.netbeans.modules.form.RADConnectionPropertyEditor&quot;&gt;
       &lt;Connection code=&quot;CUISettings.GetWindowIcon()&quot; type=&quot;code&quot;/&gt;
     &lt;/Property&gt;
     &lt;Property name=&quot;minimumSize&quot; type=&quot;java.awt.Dimension&quot; editor=&quot;org.netbeans.beaninfo.editors.DimensionEditor&quot;&gt;
-      &lt;Dimension value=&quot;[860, 650]&quot;/&gt;
+      &lt;Dimension value=&quot;[600, 500]&quot;/&gt;
     &lt;/Property&gt;
-    &lt;Property name=&quot;title&quot; type=&quot;java.lang.String&quot; editor=&quot;org.netbeans.modules.i18n.form.FormI18nStringEditor&quot;&gt;
-      &lt;ResourceString bundle=&quot;aflobby/languages.properties&quot; key=&quot;AFLobby&quot; replaceFormat=&quot;java.util.ResourceBundle.getBundle(&quot;{bundleNameSlashes}&quot;).getString(&quot;{sourceFileName}.{key}&quot;)&quot;/&gt;
-    &lt;/Property&gt;
   &lt;/Properties&gt;
   &lt;SyntheticProperties&gt;
     &lt;SyntheticProperty name=&quot;formSizePolicy&quot; type=&quot;int&quot; value=&quot;1&quot;/&gt;
   &lt;/SyntheticProperties&gt;
   &lt;Events&gt;
-    &lt;EventHandler event=&quot;mouseClicked&quot; listener=&quot;java.awt.event.MouseListener&quot; parameters=&quot;java.awt.event.MouseEvent&quot; handler=&quot;formMouseClicked&quot;/&gt;
-    &lt;EventHandler event=&quot;mousePressed&quot; listener=&quot;java.awt.event.MouseListener&quot; parameters=&quot;java.awt.event.MouseEvent&quot; handler=&quot;formMousePressed&quot;/&gt;
-    &lt;EventHandler event=&quot;windowClosing&quot; listener=&quot;java.awt.event.WindowListener&quot; parameters=&quot;java.awt.event.WindowEvent&quot; handler=&quot;exitForm&quot;/&gt;
+    &lt;EventHandler event=&quot;windowClosing&quot; listener=&quot;java.awt.event.WindowListener&quot; parameters=&quot;java.awt.event.WindowEvent&quot; handler=&quot;formWindowClosing&quot;/&gt;
     &lt;EventHandler event=&quot;windowOpened&quot; listener=&quot;java.awt.event.WindowListener&quot; parameters=&quot;java.awt.event.WindowEvent&quot; handler=&quot;formWindowOpened&quot;/&gt;
-    &lt;EventHandler event=&quot;mouseDragged&quot; listener=&quot;java.awt.event.MouseMotionListener&quot; parameters=&quot;java.awt.event.MouseEvent&quot; handler=&quot;formMouseDragged&quot;/&gt;
   &lt;/Events&gt;
   &lt;AuxValues&gt;
-    &lt;AuxValue name=&quot;FormSettings_autoResourcing&quot; type=&quot;java.lang.Integer&quot; value=&quot;1&quot;/&gt;
-    &lt;AuxValue name=&quot;FormSettings_formBundle&quot; type=&quot;java.lang.String&quot; value=&quot;aflobby/languages&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_autoResourcing&quot; type=&quot;java.lang.Integer&quot; value=&quot;0&quot;/&gt;
     &lt;AuxValue name=&quot;FormSettings_generateMnemonicsCode&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
-    &lt;AuxValue name=&quot;FormSettings_i18nAutoMode&quot; type=&quot;java.lang.Boolean&quot; value=&quot;true&quot;/&gt;
+    &lt;AuxValue name=&quot;FormSettings_i18nAutoMode&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
     &lt;AuxValue name=&quot;FormSettings_layoutCodeTarget&quot; type=&quot;java.lang.Integer&quot; value=&quot;1&quot;/&gt;
     &lt;AuxValue name=&quot;FormSettings_listenerGenerationStyle&quot; type=&quot;java.lang.Integer&quot; value=&quot;0&quot;/&gt;
     &lt;AuxValue name=&quot;FormSettings_variablesLocal&quot; type=&quot;java.lang.Boolean&quot; value=&quot;false&quot;/&gt;
     &lt;AuxValue name=&quot;FormSettings_variablesModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;2&quot;/&gt;
+    &lt;AuxValue name=&quot;designerSize&quot; type=&quot;java.awt.Dimension&quot; value=&quot;-84,-19,0,5,115,114,0,18,106,97,118,97,46,97,119,116,46,68,105,109,101,110,115,105,111,110,65,-114,-39,-41,-84,95,68,20,2,0,2,73,0,6,104,101,105,103,104,116,73,0,5,119,105,100,116,104,120,112,0,0,2,2,0,0,2,-111&quot;/&gt;
   &lt;/AuxValues&gt;
 
-  &lt;Layout&gt;
-    &lt;DimensionLayout dim=&quot;0&quot;&gt;
-      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-          &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; pref=&quot;862&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-      &lt;/Group&gt;
-    &lt;/DimensionLayout&gt;
-    &lt;DimensionLayout dim=&quot;1&quot;&gt;
-      &lt;Group type=&quot;103&quot; groupAlignment=&quot;0&quot; attributes=&quot;0&quot;&gt;
-          &lt;Component id=&quot;jPanel1&quot; alignment=&quot;0&quot; pref=&quot;624&quot; max=&quot;32767&quot; attributes=&quot;0&quot;/&gt;
-      &lt;/Group&gt;
-    &lt;/DimensionLayout&gt;
-  &lt;/Layout&gt;
-  &lt;SubComponents&gt;
-    &lt;Container class=&quot;javax.swing.JPanel&quot; name=&quot;jPanel1&quot;&gt;
-      &lt;Properties&gt;
-        &lt;Property name=&quot;alignmentX&quot; type=&quot;float&quot; value=&quot;0.0&quot;/&gt;
-        &lt;Property name=&quot;alignmentY&quot; type=&quot;float&quot; value=&quot;0.0&quot;/&gt;
-        &lt;Property name=&quot;maximumSize&quot; type=&quot;java.awt.Dimension&quot; editor=&quot;org.netbeans.beaninfo.editors.DimensionEditor&quot;&gt;
-          &lt;Dimension value=&quot;[8400, 5700]&quot;/&gt;
-        &lt;/Property&gt;
-        &lt;Property name=&quot;minimumSize&quot; type=&quot;java.awt.Dimension&quot; editor=&quot;org.netbeans.beaninfo.editors.DimensionEditor&quot;&gt;
-          &lt;Dimension value=&quot;[840, 570]&quot;/&gt;
-        &lt;/Property&gt;
-        &lt;Property name=&quot;preferredSize&quot; type=&quot;java.awt.Dimension&quot; editor=&quot;org.netbeans.beaninfo.editors.DimensionEditor&quot;&gt;
-          &lt;Dimension value=&quot;[840, 575]&quot;/&gt;
-        &lt;/Property&gt;
-      &lt;/Properties&gt;
-      &lt;AuxValues&gt;
-        &lt;AuxValue name=&quot;JavaCodeGenerator_VariableModifier&quot; type=&quot;java.lang.Integer&quot; value=&quot;1&quot;/&gt;
-        &lt;AuxValue name=&quot;JavaCodeGenerator_allCodePost&quot; type=&quot;java.lang.String&quot; value=&quot;ColorChooser = new javax.swing.JColorChooser();&quot;/&gt;
-      &lt;/AuxValues&gt;
-
-      &lt;Layout class=&quot;org.netbeans.modules.form.compat2.layouts.DesignBorderLayout&quot;/&gt;
-    &lt;/Container&gt;
-  &lt;/SubComponents&gt;
+  &lt;Layout class=&quot;org.netbeans.modules.form.compat2.layouts.DesignBoxLayout&quot;/&gt;
 &lt;/Form&gt;

Modified: trunk/Lobby/AFLobby/src/aflobby/LMain.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/LMain.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/LMain.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -1,606 +1,486 @@
-/*
- * LMain.java
- *
- * Created on 22 May 2006, 18:44
- */
-
-package aflobby;
-import aflobby.UI.CUISettings;
-import aflobby.UI.CUserSettings;
-import aflobby.UI.CView;
-import aflobby.framework.CCore;
-import aflobby.framework.IModule;
-import aflobby.protocol.tasserver.ui.CAgree;
-import aflobby.protocol.IProtocol;
-import java.awt.Color;
-import java.awt.Component;
-import java.util.ArrayList;
-import java.util.Iterator;
-import java.util.Timer;
-import java.util.TimerTask;
-import javax.swing.SwingUtilities;
-
-/**
- *
- * @author  AF
- */
-
-class UpdateTask extends TimerTask {
-    public LMain LM;
-    UpdateTask (LMain L){
-        LM = L;
-    }
-    public void run () {
-        //if(LM.updatedone){
-            LM.core.Update ();
-        //}
-    }
-}
-
-
-public class LMain extends java.awt.Frame implements IModule {
-    public boolean Registering = false;
-    //public boolean nextvalidate = false;
-    public boolean timerdo;
-    public boolean pageview=false;
-    
-    public CToast Toasts = null;
-    public CPlayers playermanager;
-    public IProtocol protocol;
-    public CAgree Agree = new CAgree ();
-    
-    private ArrayList&lt;CView&gt; views = new ArrayList&lt;CView&gt;();
-
-    public CUserCommandHandler command_handler;
-    public CUserSettings UserSettings;
-    
-    
-    public IBattleModel battleModel;
-    //public Vector&lt;JChannelWindow&gt; channels = new Vector&lt;JChannelWindow&gt;();
-    //public ArrayList&lt;String&gt; joined = new ArrayList&lt;String&gt;();
-    private ArrayList&lt;CEvent&gt; GUIeventqueue = new ArrayList&lt;CEvent&gt;();
-    private ArrayList&lt;CEvent&gt; eventqueue = new ArrayList&lt;CEvent&gt;();
-    public javax.swing.JColorChooser ColorChooser = null;
-    
-    public CCore core = null;
-    
-    public LMain () {
-        
-        core = new CCore();
-        //Runnable doWorkRunnable = new Runnable () {
-        //    public void run () {
-        initComponents ();
-        //    }
-        //};
-        //SwingUtilities.invokeLater (doWorkRunnable);
-
-        LMain LM = this;
-        core.AddModule(LM);
-        
-        playermanager = new CPlayers ();
-        playermanager.Init(this);
-        core.AddModule(playermanager);
-        
-        command_handler = new CUserCommandHandler ();
-        command_handler.Init(this);
-        core.AddModule(command_handler);
-        
-        Toasts = new CToast();
-        core.AddModule(Toasts);
-        
-        UserSettings = new CUserSettings ();
-        
-        
-        // test glest support
-        if(aflobby.UI.CUserSettings.GetValue(&quot;glest.command&quot;, &quot;foobar&quot;).equals(&quot;foobar&quot;)==false){
-            CContentManager.installed_engines.add(&quot;glest&quot;);
-        }
-    }
-    
-    
-    public void start (){
-        setVisible (true);
-        
-        //protocol = new CTASServerProtocol ();
-        //protocol.Init (this);
-
-        new Timer ().schedule (new UpdateTask (this),
-            10,        //initial delay
-            30);  //subsequent rate
-        Toasts.Init (&quot;&quot;);
-        Agree.Init (this);
-        DoValidate ();
-    }
-    
-    void ChangeSize (int x, int y){
-        int dx = x;
-        int dy = y;
-        if((dx &lt; 860)&amp;&amp;(dy &lt;650)){
-            return;
-        }
-        if(dx &lt; 860){
-            dx = 860;
-        }
-        if(dy &lt; 650){
-            dy = 650;
-        }
-        final int dx1 = dx;
-        final int dy1 = dy;
-        Runnable doWorkRunnable = new Runnable () {
-            public void run () { setBounds(getLocation().x, getLocation().y, dx1, dy1);/*DoChangeSize ();*/ }
-        };
-        SwingUtilities.invokeLater (doWorkRunnable);
-    }
-    
-    public Color lastColor = Color.blue;
-    @SuppressWarnings(&quot;static-access&quot;)
-    public Color ShowColorDialog(Component component, String title){
-        //
-        lastColor = ColorChooser.showDialog(component, title, lastColor);
-        return lastColor;
-    }
-    //int dx,dy;
-    /*void DoChangeSize (){
-        setSize (dx,dy);
-        DoValidate ();
-        //dx = this.getWidth ();
-        //dy = this.getHeight ();
-        //this.jPanel1.setSize (dx,dy-40);//);//(int)(int)
-        //this.jPanel2.setSize ((int)x,20);
-        //this.jPanel3.setSize ((int)x,20);
-        //this.jPanel3.setLocation (0,(int)y-20);
-        //this.corner.setLocation (dx-20,dy-20);//setSize ((int)x,20);//.setLocation((int)x-25,0/*(int)y-20*///);
-        //jTextPane1.setLocation (x-25,0);
-        
-        
-    //}*/
-    
-    /** Creates new form LMain */
-    /** This method is called from within the constructor to
-     * initialize the form.
-     * WARNING: Do NOT modify this code. The content of this method is
-     * always regenerated by the Form Editor.
-     */
-    // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot;Generated Code&quot;&gt;//GEN-BEGIN:initComponents
-    private void initComponents() {
-
-        jInternalFrame1 = new javax.swing.JInternalFrame();
-        jPanel1 = new javax.swing.JPanel();
-
-        jInternalFrame1.setVisible(true);
-
-        javax.swing.GroupLayout jInternalFrame1Layout = new javax.swing.GroupLayout(jInternalFrame1.getContentPane());
-        jInternalFrame1.getContentPane().setLayout(jInternalFrame1Layout);
-        jInternalFrame1Layout.setHorizontalGroup(
-            jInternalFrame1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
-            .addGap(0, 0, Short.MAX_VALUE)
-        );
-        jInternalFrame1Layout.setVerticalGroup(
-            jInternalFrame1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
-            .addGap(0, 0, Short.MAX_VALUE)
-        );
-
-        setFont(new java.awt.Font(&quot;Arial&quot;, 0, 12));
-        setIconImage(CUISettings.GetWindowIcon());
-        setMinimumSize(new java.awt.Dimension(860, 650));
-        java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;); // NOI18N
-        setTitle(bundle.getString(&quot;LMain.AFLobby&quot;)); // NOI18N
-        addMouseListener(new java.awt.event.MouseAdapter() {
-            public void mouseClicked(java.awt.event.MouseEvent evt) {
-                formMouseClicked(evt);
-            }
-            public void mousePressed(java.awt.event.MouseEvent evt) {
-                formMousePressed(evt);
-            }
-        });
-        addWindowListener(new java.awt.event.WindowAdapter() {
-            public void windowClosing(java.awt.event.WindowEvent evt) {
-                exitForm(evt);
-            }
-            public void windowOpened(java.awt.event.WindowEvent evt) {
-                formWindowOpened(evt);
-            }
-        });
-        addMouseMotionListener(new java.awt.event.MouseMotionAdapter() {
-            public void mouseDragged(java.awt.event.MouseEvent evt) {
-                formMouseDragged(evt);
-            }
-        });
-
-        jPanel1.setAlignmentX(0.0F);
-        jPanel1.setAlignmentY(0.0F);
-        jPanel1.setMaximumSize(new java.awt.Dimension(8400, 5700));
-        jPanel1.setMinimumSize(new java.awt.Dimension(840, 570));
-        jPanel1.setPreferredSize(new java.awt.Dimension(840, 575));
-        jPanel1.setLayout(new java.awt.BorderLayout());
-
-        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
-        this.setLayout(layout);
-        layout.setHorizontalGroup(
-            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
-            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 862, Short.MAX_VALUE)
-        );
-        layout.setVerticalGroup(
-            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
-            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 624, Short.MAX_VALUE)
-        );
-
-        ColorChooser = new javax.swing.JColorChooser();
-
-        pack();
-    }// &lt;/editor-fold&gt;//GEN-END:initComponents
-    
-    private void formMouseClicked (java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
-        if(evt.getClickCount () == 2){
-            if((getExtendedState () &amp; LMain.MAXIMIZED_BOTH) != 0){
-                setExtendedState (LMain.NORMAL);
-            }else{
-                setExtendedState (MAXIMIZED_BOTH);
-            }
-            int x = getWidth ();
-            int y = getHeight ();
-            this.ChangeSize (x,y);
-        }
-    }//GEN-LAST:event_formMouseClicked
-                        
-    private void formMouseDragged(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseDragged
-
-    }//GEN-LAST:event_formMouseDragged
-    
-    
-    private void formMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMousePressed
-
-        //this.repaint ();
-    }//GEN-LAST:event_formMousePressed
-    
-    
-    
-    
-    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
-        //JLoginPanel LP = new JLoginPanel(this);
-        //AddView(LP,false);
-        final LMain LM = this;
-        Runnable doWorkRunnable = new Runnable () {
-            public void run () {
-                if(Boolean.valueOf(CUserSettings.GetValue(&quot;autologin&quot;, &quot;false&quot;))){
-                    CLoginProgress l = new CLoginProgress(LM);
-                    AddView(l,true);
-                }else{
-                    CSplashScreen jk = new CSplashScreen (LM);
-                    AddView (jk,true);
-                }
-                ChangeSize (860,631);
-                jPanel1.validate ();//ValidateNow ();
-            }
-        };
-        SwingUtilities.invokeLater (doWorkRunnable);
-        
-    }//GEN-LAST:event_formWindowOpened
-    
-    
-    /** Exit the Application */
-    private void exitForm(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_exitForm
-        this.setVisible(false);
-        protocol.Disconnect();
-        System.exit (0);
-    }//GEN-LAST:event_exitForm
-    
-    public boolean updatedone=true;
-    public void Update (){
-
-        updatedone=false;
-        
-        
-        
-        ProcessEvents ();
-        
-        /*if(views.isEmpty ()==false){
-            Iterator&lt;CView&gt; i = views.iterator ();
-            while(i.hasNext ()){
-                CView n = i.next ();
-                n.Update ();
-            }
-        }*/
-        
-        //if(battleModel != null){
-        //    battleModel.Update ();
-        //}
-        
-        //this.playermanager.Update ();
-        //this.command_handler.Update ();
-        //core.Update();
-        
-        updatedone=true;
-        
-//        Iterator&lt;JChannelWindow&gt; i = channels.iterator();
-//        while(i.hasNext()){
-//            JChannelWindow j = i.next();
-//            j.Update();
-//        }
-        
-    }
-    
-    
-    /**
-     * @param args the command line arguments
-     */
-    public static void main (String args[]) {
-        java.awt.EventQueue.invokeLater (new Runnable () {
-            public void run () {
-                new LMain ().setVisible (true);
-            }
-        });
-    }
-    
-    
-    public void NewEvent (CEvent e){
-        eventqueue.add (e);
-        //core.NewEvent(e);
-    }
-    
-    
-    public void NewGUIEvent (CEvent e){
-        GUIeventqueue.add (e);
-        //core.NewGUIEvent(e);
-    }
-    
-    
-    public void ProcessEvents (){
-        if(eventqueue.isEmpty ()==false){
-            ArrayList&lt;CEvent&gt; temp = new ArrayList&lt;CEvent&gt;();
-            temp.addAll (eventqueue);
-            eventqueue.clear ();
-            
-            Iterator&lt;CEvent&gt; k = temp.iterator ();
-            while(k.hasNext ()==true){
-                final CEvent e = k.next ();
-                //command_handler.NewEvent (e);
-                //System.out.println (&quot;ProcEvent&quot; + e.data[0]);
-//                if(e.data[0].equalsIgnoreCase(&quot;JOIN&quot;)){
-//                    // create a new channel object
-//                    JChannelWindow ch = new JChannelWindow();
-//                    ch.Init(this,e.data[1],e.connection);
-//                    ch.setVisible(true);
-//                    joined.add(e.data[1]);
-//                    channels.add(ch);
-//                }else
-                if(e.IsEvent (&quot;ACCEPTED&quot;)){
-                    DoValidate ();
-                } else if(e.IsEvent (&quot;DENIED&quot;)){
-                    String s = java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;LMain.Login_Failed_&quot;) +Misc.makeSentence (e.data,1);
-                    Toasts.AddMessage (s);
-                    SetFocus (&quot;LoginPanel&quot;);
-                } else if(e.IsEvent (&quot;AGREEMENT&quot;)){
-                    Agree.AddLine (Misc.makeSentence (e.data,1));
-                } else if(e.IsEvent (&quot;AGREEMENTEND&quot;)){
-                    Runnable doWorkRunnable = new Runnable () {
-                        public void run () { Agree.setVisible (true); }
-                    };
-                    SwingUtilities.invokeLater (doWorkRunnable);
-                } else if(e.IsEvent (&quot;BROADCAST&quot;)){
-                    this.Toasts.AddMessage (Misc.makeSentence (e.data,1));
-                } else if(e.IsEvent (CEvent.DISCONNECTED)){
-                    SetFocus (&quot;LoginPanel&quot;);
-                    
-                }
-//                if(channels.isEmpty()==false){
-//                    Iterator&lt;JChannelWindow&gt; p = channels.iterator();
-//                    while(p.hasNext()){
-//                        JChannelWindow j = p.next();
-//                        j.NewEvent(e);
-//                    }
-//                }
-                /*ArrayList&lt;CView&gt; vtemp = new ArrayList&lt;CView&gt;();
-                vtemp.addAll (views);
-                vtemp.addAll(nondisplayedviews);
-                Iterator&lt;CView&gt; i = vtemp.iterator ();
-                while(i.hasNext ()){
-                    CView n = i.next ();
-                    if(n == null) continue;
-                    n.NewEvent (e);
-                }*/
-                
-                
-                //if(battleModel != null){
-                //    battleModel.NewEvent (e);
-                //}
-                
-            }
-        }
-        if(GUIeventqueue.isEmpty ()==false){
-            //System.out.println (&quot;procgui&quot;);
-            ArrayList&lt;CEvent&gt; temp2 = new ArrayList&lt;CEvent&gt;();
-            temp2.addAll (GUIeventqueue);
-            GUIeventqueue.clear ();
-            ArrayList&lt;CView&gt; temp3 = new ArrayList&lt;CView&gt;();
-            temp3.addAll (views);
-            Iterator&lt;CEvent&gt; q = temp2.iterator ();
-            while(q.hasNext ()==true){
-                CEvent e = q.next ();
-                //protocol.NewEvent (e);
-                
-                if(e.IsEvent (CEvent.LOGGEDOUT)||e.IsEvent (CEvent.LOGOUT)){
-                    SetFocus (&quot;LoginPanel&quot;);
-                }
-                //command_handler.NewGUIEvent (e);
-//                if(channels.isEmpty()==false){
-//                    Iterator&lt;JChannelWindow&gt; p = channels.iterator();
-//                    while(p.hasNext()){
-//                        JChannelWindow j = p.next();
-//                        j.NewEvent(e);
-//                    }
-//                }
-                //if(protocol != null){
-                    //connection.traffic.add (&quot;got event &quot; + Misc.makeSentence (e.data,0));
-                //    protocol.NewGUIEvent (e);
-                //}
-                /*ArrayList&lt;CView&gt; vtemp = new ArrayList&lt;CView&gt;();
-                vtemp.addAll (views);
-                vtemp.addAll(nondisplayedviews);
-                Iterator&lt;CView&gt; i = vtemp.iterator ();
-                while(i.hasNext ()){
-                    CView n = i.next ();
-                    n.NewGUIEvent (e);
-                }*/
-                
-                //if(battleModel != null){
-                //    battleModel.NewGUIEvent (e);
-                //}
-                
-            }
-        }
-    }
-    
-    public boolean ViewExists (String s){
-        //
-        Iterator&lt;CView&gt; i = views.iterator ();
-        while(i.hasNext ()){
-            CView n =  i.next ();
-            if(n.getTitle().equalsIgnoreCase (s)){
-                return true;
-            }
-        }
-        return false;
-    }
-    
-    public void AddView (final CView v,final boolean setfocus){
-        //v.setVisible(setfocus);
-        core.AddModule(v);
-        
-        Runnable doWorkRunnable = new Runnable () {
-            public void run () {
-                v.setVisible (setfocus);
-                jPanel1.add (v);
-                if(setfocus){
-                    SetFocus (v);
-                }
-            }
-        };
-        SwingUtilities.invokeLater (doWorkRunnable);
-        
-        
-        views.add (v);
-        //DoValidate();
-//        else{
-//            this.ValidateNow ();
-//            //DoValidate ();
-//        }
-    }
-
-    
-    public void RemoveView (final CView v){
-        
-        core.RemoveModule(v);
-        views.remove(v);
-        Runnable doWorkRunnable = new Runnable () {
-            public void run () {
-                jPanel1.remove ((Component)v);
-            }
-        };
-        SwingUtilities.invokeLater (doWorkRunnable);
-    }
-    
-    
-    public void RemoveView (String s){
-        //synchronized(views){
-        for(int i = 0; i&lt; views.size (); i++){
-            final CView v = views.get (i);
-            if(v.getTitle().equals (s)){
-                RemoveView(v);
-                i--; //decrement so that we then get incremented and handle the same index again
-            }
-        }
-
-    }
-    
-    public void SetFocus (final CView v){
-        
-        //synchronized(views){
-        if(views.contains (v)){
-            Runnable doWorkRunnable = new Runnable () {
-                public void run () {
-                    if(jPanel1.getComponentZOrder (v)!= -1){
-                        jPanel1.setComponentZOrder (v,0);
-                    }
-                }
-            };
-            SwingUtilities.invokeLater (doWorkRunnable);
-            Iterator&lt;CView&gt; i = views.iterator ();
-            while(i.hasNext ()){
-                final CView n =  i.next ();
-                Runnable doWorkRunnable2 = new Runnable () {
-                    public void run () {
-                        n.setVisible (n == v);
-                    }
-                };
-                SwingUtilities.invokeLater (doWorkRunnable2);
-            }
-            
-        }
-        //}
-        
-        Runnable doWorkRunnable = new Runnable () {
-            public void run () {
-                jPanel1.validate ();
-            }
-        };
-        SwingUtilities.invokeLater (doWorkRunnable);
-        
-    }
-    
-    public void SetFocus (String s){
-        //v.setVisible(true);
-        Iterator&lt;CView&gt; i = views.iterator ();
-        while(i.hasNext ()){
-            CView n =  i.next ();
-            if(n == null){
-                System.out.println (java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;LMain.n_==_null_in_LMain&quot;));
-                continue;
-            }
-            if(n.getTitle().equalsIgnoreCase (s)){
-                SetFocus (n);
-                return;
-            }
-        }
-    }
-    
-    public void DoValidate (){
-        jPanel1.revalidate ();
-        //nextvalidate = true;
-    }
-    
-    public void ValidateNow (){
-        Runnable doWorkRunnable = new Runnable () {
-            public void run () { jPanel1.validate (); }
-        };
-        SwingUtilities.invokeLater (doWorkRunnable);
-        //nextvalidate = false;
-    }
-    
-    
-    // Variables declaration - do not modify//GEN-BEGIN:variables
-    private javax.swing.JInternalFrame jInternalFrame1;
-    public javax.swing.JPanel jPanel1;
-    // End of variables declaration//GEN-END:variables
-
-    /**
-     * This function is here in order to support the IModule interface. Because
-     * this class is somewhat old and more of a kludge than a design decisions,
-     * one should never call this function.
-     * 
-     * In time this class will be replaced with a cleaner pice of code or the
-     * nature of this function will change, probably because the parameter will
-     * change to an instance of CCore.
-     * 
-     * @param L is a reference to the LMain class instance, which is pointless
-     * because we have the 'this' keyword tot hat job here!
-     */
-    public void Init(LMain L) {
-        throw new UnsupportedOperationException(&quot;This should never happen!&quot;);
-    }
-
-    public void OnRemove() {
-        
-    }
-    
-}
+/*
+ * LMain.java
+ *
+ * Created on 07 January 2008, 11:51
+ */
+
+package aflobby;
+
+import aflobby.UI.CUISettings;
+import aflobby.UI.CUserSettings;
+import aflobby.UI.CView;
+import aflobby.framework.CCore;
+import aflobby.framework.IModule;
+import aflobby.protocol.IProtocol;
+import aflobby.protocol.tasserver.ui.CAgree;
+import java.awt.Color;
+import java.awt.Component;
+import java.util.ArrayList;
+import java.util.Iterator;
+import java.util.Timer;
+import java.util.TimerTask;
+import javax.swing.SwingUtilities;
+
+
+class UpdateTask extends TimerTask {
+    public LMain LM;
+    UpdateTask (LMain L){
+        LM = L;
+    }
+    public void run () {
+        //if(LM.updatedone){
+            LM.core.Update ();
+        //}
+    }
+}
+
+/**
+ *
+ * @author  tarendai-std
+ */
+public class LMain extends javax.swing.JFrame implements IModule{
+    
+    public boolean Registering = false;
+    //public boolean nextvalidate = false;
+    public boolean timerdo;
+    public boolean pageview=false;
+    
+    public CToast Toasts = null;
+    public CPlayers playermanager;
+    public IProtocol protocol;
+    public CAgree Agree = new CAgree ();
+    
+    private ArrayList&lt;CView&gt; views = new ArrayList&lt;CView&gt;();
+
+    public CUserCommandHandler command_handler;
+    public CUserSettings UserSettings;
+    
+    
+    public IBattleModel battleModel;
+    //public Vector&lt;JChannelWindow&gt; channels = new Vector&lt;JChannelWindow&gt;();
+    //public ArrayList&lt;String&gt; joined = new ArrayList&lt;String&gt;();
+    private ArrayList&lt;CEvent&gt; GUIeventqueue = new ArrayList&lt;CEvent&gt;();
+    private ArrayList&lt;CEvent&gt; eventqueue = new ArrayList&lt;CEvent&gt;();
+    public javax.swing.JColorChooser ColorChooser = null;
+    
+    public CCore core = null;
+    
+    /** Creates new form LMain */
+    public LMain() {
+        core = new CCore();
+        //Runnable doWorkRunnable = new Runnable () {
+        //    public void run () {
+        initComponents ();
+        //    }
+        //};
+        //SwingUtilities.invokeLater (doWorkRunnable);
+
+        LMain LM = this;
+        core.AddModule(LM);
+        
+        playermanager = new CPlayers ();
+        playermanager.Init(this);
+        core.AddModule(playermanager);
+        
+        command_handler = new CUserCommandHandler ();
+        command_handler.Init(this);
+        core.AddModule(command_handler);
+        
+        Toasts = new CToast();
+        core.AddModule(Toasts);
+        
+        UserSettings = new CUserSettings ();
+        
+        
+        // test glest support
+        if(aflobby.UI.CUserSettings.GetValue(&quot;glest.command&quot;, &quot;foobar&quot;).equals(&quot;foobar&quot;)==false){
+            CContentManager.installed_engines.add(&quot;glest&quot;);
+        }
+    }
+    
+    
+    public void start (){
+        setVisible (true);
+        
+        //protocol = new CTASServerProtocol ();
+        //protocol.Init (this);
+
+        new Timer ().schedule (new UpdateTask (this),
+            10,        //initial delay
+            30);  //subsequent rate
+        Toasts.Init (&quot;&quot;);
+        Agree.Init (this);
+        DoValidate ();
+    }
+    
+    void ChangeSize (int x, int y){
+        int dx = x;
+        int dy = y;
+        if((dx &lt; 860)&amp;&amp;(dy &lt;650)){
+            return;
+        }
+        if(dx &lt; 860){
+            dx = 860;
+        }
+        if(dy &lt; 650){
+            dy = 650;
+        }
+        final int dx1 = dx;
+        final int dy1 = dy;
+        Runnable doWorkRunnable = new Runnable () {
+            public void run () { setBounds(getLocation().x, getLocation().y, dx1, dy1);/*DoChangeSize ();*/ }
+        };
+        SwingUtilities.invokeLater (doWorkRunnable);
+    }
+    
+    public Color lastColor = Color.blue;
+    @SuppressWarnings(&quot;static-access&quot;)
+    public Color ShowColorDialog(Component component, String title){
+        //
+        lastColor = ColorChooser.showDialog(component, title, lastColor);
+        return lastColor;
+    }
+    
+    /** This method is called from within the constructor to
+     * initialize the form.
+     * WARNING: Do NOT modify this code. The content of this method is
+     * always regenerated by the Form Editor.
+     */
+    // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot;Generated Code&quot;&gt;//GEN-BEGIN:initComponents
+    private void initComponents() {
+
+        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
+        setIconImage(CUISettings.GetWindowIcon());
+        setMinimumSize(new java.awt.Dimension(600, 500));
+        addWindowListener(new java.awt.event.WindowAdapter() {
+            public void windowClosing(java.awt.event.WindowEvent evt) {
+                formWindowClosing(evt);
+            }
+            public void windowOpened(java.awt.event.WindowEvent evt) {
+                formWindowOpened(evt);
+            }
+        });
+        getContentPane().setLayout(new javax.swing.BoxLayout(getContentPane(), javax.swing.BoxLayout.LINE_AXIS));
+
+        pack();
+    }// &lt;/editor-fold&gt;//GEN-END:initComponents
+
+    private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
+        this.setVisible(false);
+        if(protocol != null){
+            protocol.Disconnect();
+        }
+        System.exit (0);
+    }//GEN-LAST:event_formWindowClosing
+
+    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
+        final LMain LM = this;
+        Runnable doWorkRunnable = new Runnable () {
+            public void run () {
+                if(Boolean.valueOf(CUserSettings.GetValue(&quot;autologin&quot;, &quot;false&quot;))){
+                    CLoginProgress l = new CLoginProgress(LM);
+                    AddView(l,true);
+                }else{
+                    CSplashScreen jk = new CSplashScreen (LM);
+                    AddView (jk,true);
+                }
+                ChangeSize (860,631);
+                /*jPanel1.*/validate ();//ValidateNow ();
+            }
+        };
+        SwingUtilities.invokeLater (doWorkRunnable);
+    }//GEN-LAST:event_formWindowOpened
+    
+    public boolean updatedone=true;
+    public void Update (){
+
+        updatedone=false;
+        
+        ProcessEvents ();
+        
+        updatedone=true;
+        
+    }
+    
+    
+    /**
+     * @param args the command line arguments
+     */
+    public static void main (String args[]) {
+        java.awt.EventQueue.invokeLater (new Runnable () {
+            public void run () {
+                new LMain ().setVisible (true);
+            }
+        });
+    }
+    
+    
+    public void NewEvent (CEvent e){
+        eventqueue.add (e);
+        //core.NewEvent(e);
+    }
+    
+    
+    public void NewGUIEvent (CEvent e){
+        GUIeventqueue.add (e);
+        //core.NewGUIEvent(e);
+    }
+    
+    
+    public void ProcessEvents (){
+        if(eventqueue.isEmpty ()==false){
+            ArrayList&lt;CEvent&gt; temp = new ArrayList&lt;CEvent&gt;();
+            temp.addAll (eventqueue);
+            eventqueue.clear ();
+            
+            Iterator&lt;CEvent&gt; k = temp.iterator ();
+            while(k.hasNext ()==true){
+                final CEvent e = k.next ();
+                //command_handler.NewEvent (e);
+                //System.out.println (&quot;ProcEvent&quot; + e.data[0]);
+//                if(e.data[0].equalsIgnoreCase(&quot;JOIN&quot;)){
+//                    // create a new channel object
+//                    JChannelWindow ch = new JChannelWindow();
+//                    ch.Init(this,e.data[1],e.connection);
+//                    ch.setVisible(true);
+//                    joined.add(e.data[1]);
+//                    channels.add(ch);
+//                }else
+                if(e.IsEvent (&quot;ACCEPTED&quot;)){
+                    DoValidate ();
+                } else if(e.IsEvent (&quot;DENIED&quot;)){
+                    String s = java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;LMain.Login_Failed_&quot;) +Misc.makeSentence (e.data,1);
+                    Toasts.AddMessage (s);
+                    SetFocus (&quot;LoginPanel&quot;);
+                } else if(e.IsEvent (&quot;AGREEMENT&quot;)){
+                    Agree.AddLine (Misc.makeSentence (e.data,1));
+                } else if(e.IsEvent (&quot;AGREEMENTEND&quot;)){
+                    Runnable doWorkRunnable = new Runnable () {
+                        public void run () { Agree.setVisible (true); }
+                    };
+                    SwingUtilities.invokeLater (doWorkRunnable);
+                } else if(e.IsEvent (&quot;BROADCAST&quot;)){
+                    this.Toasts.AddMessage (Misc.makeSentence (e.data,1));
+                } else if(e.IsEvent (CEvent.DISCONNECTED)){
+                    SetFocus (&quot;LoginPanel&quot;);
+                    
+                }
+//                if(channels.isEmpty()==false){
+//                    Iterator&lt;JChannelWindow&gt; p = channels.iterator();
+//                    while(p.hasNext()){
+//                        JChannelWindow j = p.next();
+//                        j.NewEvent(e);
+//                    }
+//                }
+                /*ArrayList&lt;CView&gt; vtemp = new ArrayList&lt;CView&gt;();
+                vtemp.addAll (views);
+                vtemp.addAll(nondisplayedviews);
+                Iterator&lt;CView&gt; i = vtemp.iterator ();
+                while(i.hasNext ()){
+                    CView n = i.next ();
+                    if(n == null) continue;
+                    n.NewEvent (e);
+                }*/
+                
+                
+                //if(battleModel != null){
+                //    battleModel.NewEvent (e);
+                //}
+                
+            }
+        }
+        if(GUIeventqueue.isEmpty ()==false){
+            //System.out.println (&quot;procgui&quot;);
+            ArrayList&lt;CEvent&gt; temp2 = new ArrayList&lt;CEvent&gt;();
+            temp2.addAll (GUIeventqueue);
+            GUIeventqueue.clear ();
+            ArrayList&lt;CView&gt; temp3 = new ArrayList&lt;CView&gt;();
+            temp3.addAll (views);
+            Iterator&lt;CEvent&gt; q = temp2.iterator ();
+            while(q.hasNext ()==true){
+                CEvent e = q.next ();
+                //protocol.NewEvent (e);
+                
+                if(e.IsEvent (CEvent.LOGGEDOUT)||e.IsEvent (CEvent.LOGOUT)){
+                    SetFocus (&quot;LoginPanel&quot;);
+                }
+                //command_handler.NewGUIEvent (e);
+//                if(channels.isEmpty()==false){
+//                    Iterator&lt;JChannelWindow&gt; p = channels.iterator();
+//                    while(p.hasNext()){
+//                        JChannelWindow j = p.next();
+//                        j.NewEvent(e);
+//                    }
+//                }
+                //if(protocol != null){
+                    //connection.traffic.add (&quot;got event &quot; + Misc.makeSentence (e.data,0));
+                //    protocol.NewGUIEvent (e);
+                //}
+                /*ArrayList&lt;CView&gt; vtemp = new ArrayList&lt;CView&gt;();
+                vtemp.addAll (views);
+                vtemp.addAll(nondisplayedviews);
+                Iterator&lt;CView&gt; i = vtemp.iterator ();
+                while(i.hasNext ()){
+                    CView n = i.next ();
+                    n.NewGUIEvent (e);
+                }*/
+                
+                //if(battleModel != null){
+                //    battleModel.NewGUIEvent (e);
+                //}
+                
+            }
+        }
+    }
+    
+    public boolean ViewExists (String s){
+        //
+        Iterator&lt;CView&gt; i = views.iterator ();
+        while(i.hasNext ()){
+            CView n =  i.next ();
+            if(n.getTitle().equalsIgnoreCase (s)){
+                return true;
+            }
+        }
+        return false;
+    }
+    
+    public void AddView (final CView v,final boolean setfocus){
+        //v.setVisible(setfocus);
+        core.AddModule(v);
+        
+        Runnable doWorkRunnable = new Runnable () {
+            public void run () {
+                v.setVisible (setfocus);
+                /*jPanel1.*/add (v);
+                if(setfocus){
+                    SetFocus (v);
+                }
+                validate();
+            }
+        };
+        SwingUtilities.invokeLater (doWorkRunnable);
+        
+        
+        views.add (v);
+        //DoValidate();
+//        else{
+//            this.ValidateNow ();
+//            //DoValidate ();
+//        }
+    }
+
+    
+    public void RemoveView (final CView v){
+        
+        core.RemoveModule(v);
+        views.remove(v);
+        Runnable doWorkRunnable = new Runnable () {
+            public void run () {
+                /*jPanel1.*/remove ((Component)v);
+            }
+        };
+        SwingUtilities.invokeLater (doWorkRunnable);
+    }
+    
+    
+    public void RemoveView (String s){
+        //synchronized(views){
+        for(int i = 0; i&lt; views.size (); i++){
+            final CView v = views.get (i);
+            if(v.getTitle().equals (s)){
+                RemoveView(v);
+                i--; //decrement so that we then get incremented and handle the same index again
+            }
+        }
+
+    }
+    
+    public void SetFocus (final CView v){
+        
+        //synchronized(views){
+        if(views.contains (v)){
+            Runnable doWorkRunnable = new Runnable () {
+                public void run () {
+                    if(/*jPanel1.*/getComponentZOrder (v)!= -1){
+                        /*jPanel1.*/setComponentZOrder (v,0);
+                    }
+                }
+            };
+            SwingUtilities.invokeLater (doWorkRunnable);
+            Iterator&lt;CView&gt; i = views.iterator ();
+            while(i.hasNext ()){
+                final CView n =  i.next ();
+                Runnable doWorkRunnable2 = new Runnable () {
+                    public void run () {
+                        n.setVisible (n == v);
+                    }
+                };
+                SwingUtilities.invokeLater (doWorkRunnable2);
+            }
+            
+        }
+        //}
+        
+        Runnable doWorkRunnable = new Runnable () {
+            public void run () {
+                /*jPanel1.*/validate ();
+            }
+        };
+        SwingUtilities.invokeLater (doWorkRunnable);
+        
+    }
+    
+    public void SetFocus (String s){
+        //v.setVisible(true);
+        Iterator&lt;CView&gt; i = views.iterator ();
+        while(i.hasNext ()){
+            CView n =  i.next ();
+            if(n == null){
+                System.out.println (java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;LMain.n_==_null_in_LMain&quot;));
+                continue;
+            }
+            if(n.getTitle().equalsIgnoreCase (s)){
+                SetFocus (n);
+                return;
+            }
+        }
+    }
+    
+    public void DoValidate (){
+        /*jPanel1.revalidate ();*/
+        //nextvalidate = true;
+    }
+    
+    public void ValidateNow (){
+        Runnable doWorkRunnable = new Runnable () {
+            public void run () { /*jPanel1.*/validate (); }
+        };
+        SwingUtilities.invokeLater (doWorkRunnable);
+        //nextvalidate = false;
+    }
+
+    /**
+     * This function is here in order to support the IModule interface. Because
+     * this class is somewhat old and more of a kludge than a design decisions,
+     * one should never call this function.
+     * 
+     * In time this class will be replaced with a cleaner pice of code or the
+     * nature of this function will change, probably because the parameter will
+     * change to an instance of CCore.
+     * 
+     * @param L is a reference to the LMain class instance, which is pointless
+     * because we have the 'this' keyword tot hat job here!
+     */
+    public void Init(LMain L) {
+        //
+    }
+
+    public void OnRemove() {
+        //
+    }
+    
+    // Variables declaration - do not modify//GEN-BEGIN:variables
+    // End of variables declaration//GEN-END:variables
+    
+}

Added: trunk/Lobby/AFLobby/src/aflobby/UI/CPlayerTableModel.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/UI/CPlayerTableModel.java	                        (rev 0)
+++ trunk/Lobby/AFLobby/src/aflobby/UI/CPlayerTableModel.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -0,0 +1,155 @@
+/*
+ * CBattleTableModel.java
+ *
+ * Created on 17 September 2006, 02:19
+ *
+ * To change this template, choose Tools | Template Manager
+ * and open the template in the editor.
+ */
+
+package aflobby.UI;
+
+import aflobby.*;
+import java.util.ArrayList;
+import java.util.Iterator;
+import javax.swing.ImageIcon;
+import javax.swing.table.AbstractTableModel;
+
+/**
+ *
+ * @author AF
+ */
+public class CPlayerTableModel extends AbstractTableModel {
+
+    
+    LMain LM;
+    //CChannelView cv;
+    private String[] columns = {&quot;Flag&quot;,&quot;Rank&quot;,&quot;...&quot;,&quot;Username&quot;,&quot;Status&quot;};//{java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Description&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Status&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Map&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Mod&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Host&quot;), java.util.ResourceBundle.getBundle(&quot;aflobby/languages&quot;).getString(&quot;CBattleTableModel.Players&quot;)}; //,&quot;ID&quot;&quot;Private?&quot;,
+    public ArrayList&lt;CPlayer&gt; players = new ArrayList&lt;CPlayer&gt;();
+
+    public CPlayerTableModel(LMain L) {
+        LM = L;
+        //this.cv = cv;
+    }
+
+    public void clear(){
+        players.clear();
+        fireTableDataChanged();
+    }
+    
+    public int getRowCount() {
+        return players.size();
+    }
+
+    public int getColumnCount() {
+        return columns.length;
+    }
+
+
+    @Override
+    public String getColumnName(int col) {
+        return columns[col];
+    }
+
+    CPlayer GetPlayerAt(int row) {
+        //synchronized(battles){
+        if (row &lt; players.size()) {
+            return players.get(row); //
+        } else {
+            return null;
+        }
+        //}
+    }
+
+    public Object getValueAt(int row, int col) {
+
+        if (row &gt; players.size()) {
+            return &quot;&quot;;
+        }
+
+        CPlayer b = GetPlayerAt(row);
+        if (b == null) {
+            return &quot;&quot;;
+        }
+
+        switch (col) {
+            case 0:
+                return CChannel.GetFlagIcon(b.getCountry());
+            case 1:
+                return CChannel.smallranks[b.rank];
+            case 2:
+                if(Misc.getBotModeFromStatus(b.getStatus())){
+                    return CChannel.botimg;
+                }else if (Misc.getAccessFromStatus(b.getStatus())&gt;0){
+                    return CChannel.adminimg;
+                }else{
+                    return null;
+                }
+            case 3:
+                return b.name;
+            case 4:
+                return b.statString;
+            default:
+                break;
+        }
+
+        return &quot;&quot;;
+    }
+
+    /**
+     * 
+     * @param p
+     */
+    public void AddPlayer(CPlayer p) {
+        if(p == null){
+            return;
+        }
+        
+        if(players.contains(p)){
+            return;
+        }
+        
+        players.add(p);
+        fireTableDataChanged();
+    }
+
+    public void RemovePlayer(CPlayer b) {
+        synchronized (players) {
+            Iterator&lt;CPlayer&gt; i = players.iterator();
+            while(i.hasNext()){
+                CPlayer ba = i.next();
+                if(ba == b){
+                    i.remove();
+                }
+            }
+        }
+        fireTableDataChanged();
+//        synchronized (battles) {
+//            battles.remove(b);
+//        }
+//        fireTableDataChanged();
+//        return b;
+    }
+
+    @Override
+    public boolean isCellEditable(int rowIndex, int columnIndex) {
+        return false;
+    }
+    
+    @Override
+    public Class getColumnClass(int column) {
+        if(column &lt;3){
+            return ImageIcon.class;
+        }else{
+            return String.class;
+        }
+        /*Class returnValue;
+        if ((column &gt;= 0) &amp;&amp; (column &lt; getColumnCount())) {
+            returnValue = getValueAt(0, column).getClass();
+        } else {
+            returnValue = Object.class;
+        }
+        return returnValue;*/
+     }
+
+}
\ No newline at end of file

Modified: trunk/Lobby/AFLobby/src/aflobby/UI/CView.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/UI/CView.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/UI/CView.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -76,4 +76,5 @@
     public void Init(LMain L) {
         throw new UnsupportedOperationException(&quot;Not supported yet.&quot;);
     }
+
 }

Modified: trunk/Lobby/AFLobby/src/aflobby/framework/CBaseModule.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/framework/CBaseModule.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/framework/CBaseModule.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -9,9 +9,11 @@
 
 package aflobby.framework;
 
-import aflobby.*;
-import aflobby.framework.IModule;
+import aflobby.CEvent;
+import aflobby.LMain;
 
+
+
 /**
  *
  * @author Tom

Modified: trunk/Lobby/AFLobby/src/aflobby/languages.properties
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/languages.properties	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/languages.properties	2008-01-07 12:37:31 UTC (rev 5288)
@@ -354,3 +354,4 @@
 CChannel.jButton2.toolTipText=Join this channel on login
 CChannel.jButton1.toolTipText=Exit this channel
 CChannel.jButton5.toolTipText=Channel Options
+AFLobby=

Modified: trunk/Lobby/AFLobby/src/aflobby/protocol/IProtocol.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/protocol/IProtocol.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/protocol/IProtocol.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -19,10 +19,6 @@
  * @author Tom
  */
 public interface IProtocol extends IModule {
-    void Init (LMain L);
-    void NewEvent (final CEvent e);
-    void NewGUIEvent (final CEvent e);
-    void Update ();
     
     String GetProtocolName();
     int GetProtocolVersion();

Modified: trunk/Lobby/AFLobby/src/aflobby/protocol/tasserver/CTASServerProtocol.java
===================================================================
--- trunk/Lobby/AFLobby/src/aflobby/protocol/tasserver/CTASServerProtocol.java	2008-01-07 11:24:55 UTC (rev 5287)
+++ trunk/Lobby/AFLobby/src/aflobby/protocol/tasserver/CTASServerProtocol.java	2008-01-07 12:37:31 UTC (rev 5288)
@@ -425,4 +425,5 @@
         
     }
 
+
 }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000095.html">[Taspring-linux-commit] r5287 - in trunk/Lobby/AFLobby/src/aflobby:	. framework protocol/tasserver
</A></li>
	<LI>Next message: <A HREF="000097.html">[Taspring-linux-commit] r5289 - in branches/testserver: ChanServ	WebInterface WebInterface/inc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96">[ date ]</a>
              <a href="thread.html#96">[ thread ]</a>
              <a href="subject.html#96">[ subject ]</a>
              <a href="author.html#96">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
