<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6074 - in trunk/Lobby/TASClient: .	Interface Interface/images Interface/slider	Interface/slider/css Interface/slider/css/bluecurve	Interface/slider/css/luna Interface/slider/css/swing	Interface/slider/js Interface/spincontrol
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6074%20-%20in%20trunk/Lobby/TASClient%3A%20.%0A%09Interface%20Interface/images%20Interface/slider%0A%09Interface/slider/css%20Interface/slider/css/bluecurve%0A%09Interface/slider/css/luna%20Interface/slider/css/swing%0A%09Interface/slider/js%20Interface/spincontrol&In-Reply-To=%3C20080625200039.CBFB94420%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000853.html">
   <LINK REL="Next"  HREF="000855.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6074 - in trunk/Lobby/TASClient: .	Interface Interface/images Interface/slider	Interface/slider/css Interface/slider/css/bluecurve	Interface/slider/css/luna Interface/slider/css/swing	Interface/slider/js Interface/spincontrol</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6074%20-%20in%20trunk/Lobby/TASClient%3A%20.%0A%09Interface%20Interface/images%20Interface/slider%0A%09Interface/slider/css%20Interface/slider/css/bluecurve%0A%09Interface/slider/css/luna%20Interface/slider/css/swing%0A%09Interface/slider/js%20Interface/spincontrol&In-Reply-To=%3C20080625200039.CBFB94420%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6074 - in trunk/Lobby/TASClient: .	Interface Interface/images Interface/slider	Interface/slider/css Interface/slider/css/bluecurve	Interface/slider/css/luna Interface/slider/css/swing	Interface/slider/js Interface/spincontrol">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Wed Jun 25 22:00:39 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000853.html">[Taspring-linux-commit] r6073 - in trunk: rts rts/System	rts/lib/gml tools/DedicatedServer
</A></li>
        <LI>Next message: <A HREF="000855.html">[Taspring-linux-commit] r6075 - trunk/Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#854">[ date ]</a>
              <a href="thread.html#854">[ thread ]</a>
              <a href="subject.html#854">[ subject ]</a>
              <a href="author.html#854">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2008-06-25 22:00:37 +0200 (Wed, 25 Jun 2008)
New Revision: 6074

Added:
   trunk/Lobby/TASClient/Interface/
   trunk/Lobby/TASClient/Interface/Campaign/
   trunk/Lobby/TASClient/Interface/CriosSpinEdit.js
   trunk/Lobby/TASClient/Interface/Mission/
   trunk/Lobby/TASClient/Interface/aiItem.html
   trunk/Lobby/TASClient/Interface/botItem.html
   trunk/Lobby/TASClient/Interface/botItemBox.html
   trunk/Lobby/TASClient/Interface/button.wav
   trunk/Lobby/TASClient/Interface/campaignItem.html
   trunk/Lobby/TASClient/Interface/campaigns.html
   trunk/Lobby/TASClient/Interface/default.css
   trunk/Lobby/TASClient/Interface/default.js
   trunk/Lobby/TASClient/Interface/defaultCampaignSkin.html
   trunk/Lobby/TASClient/Interface/defaultMissionBriefing.html
   trunk/Lobby/TASClient/Interface/defaultMissionSkin.html
   trunk/Lobby/TASClient/Interface/images/
   trunk/Lobby/TASClient/Interface/images/background.jpg
   trunk/Lobby/TASClient/Interface/images/boxgrandiant_bot.gif
   trunk/Lobby/TASClient/Interface/images/boxgrandiant_player.gif
   trunk/Lobby/TASClient/Interface/images/campaigns.gif
   trunk/Lobby/TASClient/Interface/images/campaigns.png
   trunk/Lobby/TASClient/Interface/images/campaigns_over.png
   trunk/Lobby/TASClient/Interface/images/cross.gif
   trunk/Lobby/TASClient/Interface/images/cross.png
   trunk/Lobby/TASClient/Interface/images/cross_over.png
   trunk/Lobby/TASClient/Interface/images/missions.gif
   trunk/Lobby/TASClient/Interface/images/missions.png
   trunk/Lobby/TASClient/Interface/images/missions_over.png
   trunk/Lobby/TASClient/Interface/images/multiplayer.gif
   trunk/Lobby/TASClient/Interface/images/multiplayer.png
   trunk/Lobby/TASClient/Interface/images/multiplayer_over.png
   trunk/Lobby/TASClient/Interface/images/quit.gif
   trunk/Lobby/TASClient/Interface/images/quit.png
   trunk/Lobby/TASClient/Interface/images/quit_over.png
   trunk/Lobby/TASClient/Interface/images/settings.gif
   trunk/Lobby/TASClient/Interface/images/settings.png
   trunk/Lobby/TASClient/Interface/images/settings_over.png
   trunk/Lobby/TASClient/Interface/images/skirmish.gif
   trunk/Lobby/TASClient/Interface/images/skirmish.png
   trunk/Lobby/TASClient/Interface/images/skirmish_over.png
   trunk/Lobby/TASClient/Interface/images/title.gif
   trunk/Lobby/TASClient/Interface/images/title.png
   trunk/Lobby/TASClient/Interface/loading.html
   trunk/Lobby/TASClient/Interface/luaBoolOption.html
   trunk/Lobby/TASClient/Interface/luaListItem.html
   trunk/Lobby/TASClient/Interface/luaListOption.html
   trunk/Lobby/TASClient/Interface/luaNumberOption.html
   trunk/Lobby/TASClient/Interface/luaStringOption.html
   trunk/Lobby/TASClient/Interface/main.html
   trunk/Lobby/TASClient/Interface/mapItem.html
   trunk/Lobby/TASClient/Interface/missionItem.html
   trunk/Lobby/TASClient/Interface/missions.html
   trunk/Lobby/TASClient/Interface/modItem.html
   trunk/Lobby/TASClient/Interface/playerItem.html
   trunk/Lobby/TASClient/Interface/playerItemBox.html
   trunk/Lobby/TASClient/Interface/selectmap.html
   trunk/Lobby/TASClient/Interface/sideItem.html
   trunk/Lobby/TASClient/Interface/skirmish.html
   trunk/Lobby/TASClient/Interface/slider/
   trunk/Lobby/TASClient/Interface/slider/css/
   trunk/Lobby/TASClient/Interface/slider/css/bluecurve/
   trunk/Lobby/TASClient/Interface/slider/css/bluecurve/bluecurve.css
   trunk/Lobby/TASClient/Interface/slider/css/bluecurve/handle.horizontal.png
   trunk/Lobby/TASClient/Interface/slider/css/bluecurve/handle.vertical.png
   trunk/Lobby/TASClient/Interface/slider/css/bluecurve/horizontal.gif
   trunk/Lobby/TASClient/Interface/slider/css/bluecurve/vertical.gif
   trunk/Lobby/TASClient/Interface/slider/css/boxsizing.htc
   trunk/Lobby/TASClient/Interface/slider/css/luna/
   trunk/Lobby/TASClient/Interface/slider/css/luna/handle.horizontal.hover.png
   trunk/Lobby/TASClient/Interface/slider/css/luna/handle.horizontal.png
   trunk/Lobby/TASClient/Interface/slider/css/luna/handle.vertical.hover.png
   trunk/Lobby/TASClient/Interface/slider/css/luna/handle.vertical.png
   trunk/Lobby/TASClient/Interface/slider/css/luna/luna.css
   trunk/Lobby/TASClient/Interface/slider/css/swing/
   trunk/Lobby/TASClient/Interface/slider/css/swing/handle.horizontal.png
   trunk/Lobby/TASClient/Interface/slider/css/swing/handle.vertical.png
   trunk/Lobby/TASClient/Interface/slider/css/swing/swing.css
   trunk/Lobby/TASClient/Interface/slider/css/winclassic.css
   trunk/Lobby/TASClient/Interface/slider/js/
   trunk/Lobby/TASClient/Interface/slider/js/range.js
   trunk/Lobby/TASClient/Interface/slider/js/slider.js
   trunk/Lobby/TASClient/Interface/slider/js/timer.js
   trunk/Lobby/TASClient/Interface/slider/license.txt
   trunk/Lobby/TASClient/Interface/spin_control_buttons.gif
   trunk/Lobby/TASClient/Interface/spin_control_buttons_box.gif
   trunk/Lobby/TASClient/Interface/spincontrol/
   trunk/Lobby/TASClient/Interface/spincontrol/javascript.js
   trunk/Lobby/TASClient/Interface/spincontrol/spin_control_buttons.gif
   trunk/Lobby/TASClient/Interface/spincontrol/spin_control_buttons_box.gif
   trunk/Lobby/TASClient/Interface/spincontrol/style.css
   trunk/Lobby/TASClient/Interface/unitItem.html
   trunk/Lobby/TASClient/IntfDocHostUIHandler.pas
   trunk/Lobby/TASClient/MenuFormUnit.ddp
   trunk/Lobby/TASClient/MenuFormUnit.dfm
   trunk/Lobby/TASClient/MenuFormUnit.pas
   trunk/Lobby/TASClient/UContainer.pas
   trunk/Lobby/TASClient/UNulContainer.pas
   trunk/Lobby/TASClient/UWebBrowserWrapper.pas
   trunk/Lobby/TASClient/class_TIntegerList.pas
Modified:
   trunk/Lobby/TASClient/AddBotUnit.dfm
   trunk/Lobby/TASClient/BattleFormUnit.dfm
   trunk/Lobby/TASClient/BattleFormUnit.pas
   trunk/Lobby/TASClient/MainUnit.dfm
   trunk/Lobby/TASClient/MainUnit.pas
   trunk/Lobby/TASClient/MapListFormUnit.dfm
   trunk/Lobby/TASClient/MapListFormUnit.pas
   trunk/Lobby/TASClient/MinimapZoomedFormUnit.pas
   trunk/Lobby/TASClient/Misc.pas
   trunk/Lobby/TASClient/PreferencesFormUnit.dfm
   trunk/Lobby/TASClient/ReplaysUnit.pas
   trunk/Lobby/TASClient/TASClient.dof
   trunk/Lobby/TASClient/TASClient.dpr
   trunk/Lobby/TASClient/TASClient.res
   trunk/Lobby/TASClient/Utility.pas
Log:
- Single Player Mode added
- Start button not always greyed on non host player in ladder battle bug fixed

Modified: trunk/Lobby/TASClient/AddBotUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/AddBotUnit.dfm	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/AddBotUnit.dfm	2008-06-25 20:00:37 UTC (rev 6074)
@@ -1,6 +1,6 @@
 object AddBotForm: TAddBotForm
-  Left = 627
-  Top = 287
+  Left = 998
+  Top = 312
   BorderStyle = bsDialog
   Caption = 'Add bot dialog'
   ClientHeight = 246

Modified: trunk/Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/BattleFormUnit.dfm	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/BattleFormUnit.dfm	2008-06-25 20:00:37 UTC (rev 6074)
@@ -1,6 +1,6 @@
 object BattleForm: TBattleForm
-  Left = 464
-  Top = 195
+  Left = 598
+  Top = 220
   Width = 787
   Height = 586
   Caption = 'Battle window'

Modified: trunk/Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/BattleFormUnit.pas	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/BattleFormUnit.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -503,6 +503,7 @@
 
     FMyReadyStatus: Boolean;
     FCurrentMapIndex: Integer; // index of currently loaded map. -1 for none.
+    FCurrentModName: string; // index of currently loaded map. -1 for none.
     procedure SetMyReadyStatus(Status: Boolean); // sets FMyReadyStatus
   public
     ModOptionsList: TList;
@@ -514,6 +515,7 @@
     end;
     LogFile: TFileStream; // use the same way as TMyTabSheet.LogFile is used
     property CurrentMapIndex: Integer read FCurrentMapIndex; // only ChangeMap method may change it!
+    property CurrentModName: String read FCurrentModName; // only ChangeMap method may change it!
     property AmIReady: Boolean read FMyReadyStatus write SetMyReadyStatus;
     procedure RefreshTeamNbr;
     procedure SaveModOptionsAsDefault;
@@ -973,6 +975,8 @@
 
   LoadMod(ModArchiveList[ModList.IndexOf(ModName)]);
 
+  FCurrentModName := ModName;
+
   Side1 := MySideButton.Caption;
   Side2 := AddBotForm.BotSideButton.Caption;
   ReloadSides;
@@ -2097,7 +2101,7 @@
   // now let's write the script file:
 
   Script.AddOrChangeKeyValue('GAME/Mapname',BattleState.Battle.Map);
-  //Script.AddOrChangeKeyValue('GAME/Maphash',Utility.MapChecksums[Utility.MapList.indexOf(BattleState.Battle.Map)]);
+  Script.AddOrChangeKeyValue('GAME/Maphash',Utility.MapChecksums[Utility.MapList.indexOf(BattleState.Battle.Map)]);
   Script.AddOrChangeKeyValue('GAME/StartMetal',IntToStr(MetalTracker.Value));
   Script.AddOrChangeKeyValue('GAME/StartEnergy',IntToStr(EnergyTracker.Value));
   Script.AddOrChangeKeyValue('GAME/MaxUnits',IntToStr(UnitsTracker.Value));
@@ -2566,7 +2570,7 @@
 
   MinimapZoomedForm.Image1.Canvas.StretchDraw(Rect(0, 0, MinimapZoomedForm.Image1.Width, MinimapZoomedForm.Image1.Height), MapImage.Picture.Bitmap);
   MinimapZoomedForm.DrawBoxes;
-  MinimapZoomedForm.DrawStartPositions(GetMapItem(CurrentMapIndex).MapInfo);
+  MinimapZoomedForm.DrawStartPositions(GetMapItem(CurrentMapIndex).MapInfo,MinimapZoomedForm.Image1);
   MinimapZoomedForm.Caption := 'Minimap (' + Utility.MapList[CurrentMapIndex] + ', ' + IntToStr(GetMapItem(CurrentMapIndex).MapInfo.Width div 64) + ' x ' + IntToStr(GetMapItem(CurrentMapIndex).MapInfo.Height div 64) + ')';
   MinimapZoomedForm.Position := poScreenCenter;
   MinimapZoomedForm.ShowModal;
@@ -5644,6 +5648,7 @@
     Synchronize(BattleForm.PopulatePopupMenuMapList);
 
     if BattleState.Status = Hosting then
+    begin
       if MapsPopupStringList.Strings.Count &gt; 0 then
       begin
         Synchronize(ChangeMapToFirstOne);
@@ -5671,9 +5676,9 @@
         Exit;
       end;
 
-    Finalize(BattleState.Battle.AreAllClientsReady and BattleState.Battle.AreAllClientsSynced and BattleForm.LadderTeamReady);
+      Finalize(BattleState.Battle.AreAllClientsReady and BattleState.Battle.AreAllClientsSynced and BattleForm.LadderTeamReady);
   end;
-
+ end;
 end;
 
 procedure TLadderMapThread.OnTerminateProcedure(Sender: TObject);

Added: trunk/Lobby/TASClient/Interface/CriosSpinEdit.js
===================================================================
--- trunk/Lobby/TASClient/Interface/CriosSpinEdit.js	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/CriosSpinEdit.js	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,174 @@
+/*CRIOSSpinEdit 0.8 - advanced javascript SpinEdit visual control
+Copyright (c) 2005-2008 Lucian SABO (<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">luciansabo at gmail.com</A>);
+<A HREF="http://luci.criosweb.ro">http://luci.criosweb.ro</A>
+
+Licensed under CreativeCommons LGPL <A HREF="http://creativecommons.org/licenses/LGPL/2.1/">http://creativecommons.org/licenses/LGPL/2.1/</A>
+For commercial use please contact me.
+=================================
+*/
+
+function CriosSpinEdit(EditId)
+{
+//properties
+this.EditId=EditId;//deprecated
+this.ObjectRef=[];
+this.ObjectId=[];
+this.ObjectId['Edit']=EditId;
+this.ObjectId['UpArrow']=&quot;up&quot;+EditId;
+this.ObjectId['DownArrow']=&quot;down&quot;+EditId;
+this.DefaultValue=0;
+this.MinValue=0;
+this.MaxValue=10;
+this.Step=1;
+this.Size=2; //no effect after WriteControl
+this.BackgroundColor='white';
+this.Style='vert'; //no effect after WriteControl
+this.ReadOnly=false; //read-only property
+
+
+//public methods
+CriosSpinEdit.prototype.up=up;
+CriosSpinEdit.prototype.down=down;
+CriosSpinEdit.prototype.WriteControl=WriteControl;
+CriosSpinEdit.prototype.GetValue=GetValue;
+CriosSpinEdit.prototype.SetValue=SetValue;
+CriosSpinEdit.prototype.Validate=Validate;
+CriosSpinEdit.prototype.Disable=Disable;
+CriosSpinEdit.prototype.Enable=Enable;
+CriosSpinEdit.prototype.ResetValue=ResetValue;
+
+
+//internal event handlers; there is not need to call them directly
+CriosSpinEdit.prototype.HandleChange=HandleChange;
+
+//private function members
+var FixJSFloatBug=function FixJSFloatBug(n){return Math.round(n*100)/100;}
+
+//events
+CriosSpinEdit.prototype.OnChange=function OnChange(){};
+CriosSpinEdit.prototype.OnValidateError=function OnValidateError(){};
+
+//-----------------------------------------------------------------
+function Validate(theValue)
+{
+if(theValue==='' || theValue==null || theValue&gt;this.MaxValue || theValue&lt;this.MinValue || isFinite(theValue)==0 || /*theValue%this.Step!=0*/ String(FixJSFloatBug(theValue/this.Step)).indexOf('.')!=-1) {this.OnValidateError();return false;}
+else {
+	//prevent bug when user enters '07' for example in the edit field
+	this.ObjectRef['Edit'].value=FixJSFloatBug(theValue*1); //little trick to convert to numeric and prevent JS Floating point operation bugs
+	return true;
+	}
+}
+//-----------------------------------------------------------------
+	function up()
+	{
+	if(this.n&lt;this.MaxValue &amp;&amp; !this.ObjectRef['Edit'].disabled)
+		{
+		this.n=FixJSFloatBug(this.n+this.Step);
+		this.ObjectRef['Edit'].value=this.n;
+		this.OnChange();
+		}
+	}
+//-----------------------------------------------------------------	
+	function down()
+	{
+	if(this.n&gt;this.MinValue &amp;&amp; !this.ObjectRef['Edit'].disabled)
+		{
+		this.n=FixJSFloatBug(this.n-this.Step);
+		this.ObjectRef['Edit'].value=this.n;
+		//trigger OnChange event
+		this.OnChange();
+		}
+	}
+//-----------------------------------------------------------------
+	function WriteControl(SpinName)
+	{
+	this.n=this.DefaultValue;
+	var readonly_str='';
+	if(this.ReadOnly)	readonly_str='readonly=&quot;readonly&quot;';
+	document.write('&lt;table border=&quot;0&quot; summary=&quot;&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;display:inline;vertical-align:middle&quot;&gt;');
+	document.write('&lt;tr&gt;');
+if(this.Style==&quot;vert&quot;)
+{
+		document.write('&lt;td style=&quot;width:10px;height:24px;&quot; rowspan=&quot;2&quot;&gt;&lt;input size=&quot;'+this.Size+'&quot; id=&quot;'+this.ObjectId['Edit']+'&quot; name=&quot;'+this.ObjectId['Edit']+'&quot; type=&quot;text&quot; value=&quot;'+this.DefaultValue+'&quot; onchange=&quot;'+SpinName+'.HandleChange()&quot; '+readonly_str+' /&gt;&lt;/td&gt;');
+		document.write('&lt;td&gt;&lt;input type=&quot;button&quot; style=&quot;font-size:8px;color:black;width:16px;height:14px;vertical-align:bottom;padding:0px;&quot; id=&quot;'+this.ObjectId['UpArrow']+'&quot; value=&quot;&#9650;&quot; onclick=&quot;this.blur();'+SpinName+'.up()&quot; /&gt;&lt;/td&gt;');
+	document.write('&lt;/tr&gt;');
+	document.write('&lt;tr&gt;');
+		document.write('&lt;td&gt;&lt;input type=&quot;button&quot; style=&quot;font-size:8px;color:black;width:16px;height:14px;vertical-align:top;padding:0px;&quot; id=&quot;'+this.ObjectId['DownArrow']+'&quot; value=&quot;&#9660;&quot; onclick=&quot;this.blur();'+SpinName+'.down()&quot; /&gt;&lt;/td&gt;');
+}
+else	//horizontal
+{
+		document.write('&lt;td style=&quot;width:10px;height:24px;&quot; rowspan=&quot;2&quot;&gt;&lt;input size=&quot;'+this.Size+'&quot; id=&quot;'+this.ObjectId['Edit']+'&quot; name=&quot;'+this.ObjectId['Edit']+'&quot; type=&quot;text&quot; value=&quot;'+this.DefaultValue+'&quot;  onchange=&quot;'+SpinName+'.HandleChange()&quot; '+readonly_str+' /&gt;&lt;/td&gt;');
+		document.write('&lt;td&gt;&lt;input type=&quot;button&quot; style=&quot;font-size:11px;color:black;width:18px;height:24px;padding:0px;&quot; id=&quot;'+this.ObjectId['UpArrow']+'&quot; value=&quot;&#9650;&quot; onclick=&quot;this.blur();'+SpinName+'.up()&quot; /&gt;&lt;/td&gt;');
+		document.write('&lt;td&gt;&lt;input type=&quot;button&quot; style=&quot;font-size:11px;color:black;width:18px;height:24px;padding:0px;&quot; id=&quot;'+this.ObjectId['DownArrow']+'&quot; value=&quot;&#9660;&quot; onclick=&quot;this.blur();'+SpinName+'.down()&quot; /&gt;&lt;/td&gt;');
+}
+	document.write('&lt;/tr&gt;');
+	document.write('&lt;/table&gt;');
+
+//store objects references for faster access 
+this.ObjectRef['Edit']=document.getElementById(this.ObjectId['Edit']);
+this.ObjectRef['UpArrow']=document.getElementById(this.ObjectId['UpArrow']);
+this.ObjectRef['DownArrow']=document.getElementById(this.ObjectId['DownArrow']);	
+	}
+	
+//-----------------------------------------------------------------
+	//GetValue
+	function GetValue()
+	{
+	return this.n;
+	}
+//-----------------------------------------------------------------
+	//SetValue
+	function SetValue(newValue)
+	{
+	//validation
+	if(!this.Validate(newValue) || this.ObjectRef['Edit'].disabled) return false;
+	
+	this.n=newValue*1;
+	this.ObjectRef['Edit'].value=this.n;
+	//trigger OnChange event
+	this.OnChange();
+	}
+//-----------------------------------------------------------------
+	//ResetValue
+	function ResetValue()
+	{
+	this.n=this.DefaultValue;
+	this.ObjectRef['Edit'].value=this.n;
+	//trigger OnChange event
+	this.OnChange();
+	}		
+
+//-----------------------------------------------------------------
+function HandleChange()
+{
+this.ObjectRef['Edit'].style.backgroundColor=this.BackgroundColor;
+if(!this.Validate(this.ObjectRef['Edit'].value)) 
+	{
+	this.ObjectRef['Edit'].value=this.n;
+	this.ObjectRef['Edit'].style.backgroundColor='yellow';
+	this.ObjectRef['Edit'].focus();	//set focus warn user
+	return false;
+	}
+	else
+		this.n=FixJSFloatBug(this.ObjectRef['Edit'].value*1);	//little trick to convert to numeric and prevent JS Floating point operation bugs
+
+this.OnChange();
+
+	return true;
+}
+//-----------------------------------------------------------------
+function Disable()
+{
+this.ObjectRef['Edit'].disabled=true;
+this.ObjectRef['UpArrow'].disabled=true;
+this.ObjectRef['DownArrow'].disabled=true;
+}
+//-----------------------------------------------------------------
+function Enable()
+{
+this.ObjectRef['Edit'].disabled=false;
+this.ObjectRef['UpArrow'].disabled=false;
+this.ObjectRef['DownArrow'].disabled=false;
+}
+
+}

Added: trunk/Lobby/TASClient/Interface/aiItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/aiItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/aiItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1 @@
+&lt;option value =&quot;[aiName]&quot;&gt;[aiName]&lt;/option&gt;

Added: trunk/Lobby/TASClient/Interface/botItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/botItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/botItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,54 @@
+&lt;tr&gt;
+	&lt;td&gt;&lt;a href=&quot;lobby:removebot:[PlayerId]&quot;&gt;&lt;div class=&quot;cross&quot;&gt;&nbsp;&lt;/div&gt;&lt;/a&gt;&lt;div style=&quot;float:left;padding-left: 10px&quot;&gt;[PlayerName]&lt;/div&gt;&lt;/td&gt;
+	&lt;td&gt;
+		&lt;select id=&quot;team[PlayerId]&quot; onchange=&quot;sendData('changeteam:[PlayerId]:'+getSelectedValue('team[PlayerId]'));selectedTeamList[[PlayerId]-1] = getSelectedValue('team[PlayerId]');selectTeams();&quot;&gt;
+			&lt;option value=&quot;0&quot;&gt;1&lt;/option&gt;
+			&lt;option value=&quot;1&quot;&gt;2&lt;/option&gt;
+			&lt;option value=&quot;2&quot;&gt;3&lt;/option&gt;
+			&lt;option value=&quot;3&quot;&gt;4&lt;/option&gt;
+			&lt;option value=&quot;4&quot;&gt;5&lt;/option&gt;
+			&lt;option value=&quot;5&quot;&gt;6&lt;/option&gt;
+			&lt;option value=&quot;6&quot;&gt;7&lt;/option&gt;
+			&lt;option value=&quot;7&quot;&gt;8&lt;/option&gt;
+			&lt;option value=&quot;8&quot;&gt;9&lt;/option&gt;
+			&lt;option value=&quot;9&quot;&gt;10&lt;/option&gt;
+			&lt;option value=&quot;10&quot;&gt;11&lt;/option&gt;
+			&lt;option value=&quot;11&quot;&gt;12&lt;/option&gt;
+			&lt;option value=&quot;12&quot;&gt;13&lt;/option&gt;
+			&lt;option value=&quot;13&quot;&gt;14&lt;/option&gt;
+			&lt;option value=&quot;14&quot;&gt;15&lt;/option&gt;
+			&lt;option value=&quot;15&quot;&gt;16&lt;/option&gt;
+		&lt;/select&gt;
+	&lt;/td&gt;
+	&lt;td&gt;
+		&lt;select id=&quot;side[PlayerId]&quot; onchange=&quot;sendData('changeside:[PlayerId]:'+getSelectedValue('side[PlayerId]'));selectedSideList[[PlayerId]-1] = getSelectedValue('side[PlayerId]');selectSides();&quot;&gt;
+			[SideList]
+		&lt;/select&gt;
+	&lt;/td&gt;
+	&lt;td&gt;
+		&lt;div id=&quot;handicapContainer[PlayerId]&quot;&gt;
+	&lt;/td&gt;
+	&lt;td&gt;[AIType]&lt;/td&gt;
+&lt;/tr&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+	function handicapSpinChanged[PlayerId](sender, newVal)
+	{
+		sendData('changehandicap:[PlayerId]:'+newVal);
+		handicapSpinBoxCtrl[PlayerId].SetCurrentValue(newVal);
+	}
+
+	var handicapSpinCtrl[PlayerId] = new SpinControl();
+	handicapSpinCtrl[PlayerId].SetMaxValue(100);
+	handicapSpinCtrl[PlayerId].SetMinValue(0);
+	handicapSpinCtrl[PlayerId].SetIncrement(1);
+	handicapSpinCtrl[PlayerId].SetCurrentValue([Handicap]);
+	handicapSpinCtrl[PlayerId].GetAccelerationCollection().Add(new SpinControlAcceleration(1, 500));
+	handicapSpinCtrl[PlayerId].GetAccelerationCollection().Add(new SpinControlAcceleration(10, 1750));
+	handicapSpinCtrl[PlayerId].AttachValueChangedListener(handicapSpinChanged[PlayerId]);
+	document.getElementById('handicapContainer[PlayerId]').appendChild(handicapSpinCtrl[PlayerId].GetContainer());
+	handicapSpinCtrl[PlayerId].StartListening();
+
+
+	selectedSideList.push([SelectedSide]);
+	selectedTeamList.push([SelectedTeam]);
+&lt;/script&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/botItemBox.html
===================================================================
--- trunk/Lobby/TASClient/Interface/botItemBox.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/botItemBox.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,82 @@
+&lt;div id=&quot;box[PlayerId]&quot; onmouseover=&quot;boxOver('box[PlayerId]')&quot; onmouseout=&quot;boxOut('box[PlayerId]')&quot; style=&quot;border:3px solid #4d533d; overflow:hidden;color:black;position: absolute;background-color: #78835a;width: 26px; height: 26px; left: [LOBBY:LOADPARAM:box[PlayerId]:0:0]px; top: [LOBBY:LOADPARAM:box[PlayerId]:1:0]px;&quot;&gt;
+	&lt;div style=&quot;width:130px;height: 26px; background-image: url(images/boxgrandiant_bot.gif); background-repeat: repeat-x;&quot;&gt;
+		&lt;div class=&quot;nameSpan&quot; style=&quot;width:30px;height:30px;padding:2px;float:left;cursor: move;&quot; onmousedown=&quot;startMovingBox('box[PlayerId]',[PlayerId]);&quot;&gt;&lt;b&gt;[PlayerName]&lt;/b&gt;&lt;/div&gt;
+		&lt;div style=&quot;float:right;&quot; onmousedown=&quot;startMovingBox('box[PlayerId]',[PlayerId]);&quot;&gt;&lt;a class=&quot;boxCross&quot; href=&quot;#&quot; onmousedown=&quot;sendData('removebot:[PlayerId]');&quot;&gt;&lt;b&gt;X&lt;/b&gt;&lt;/a&gt;&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div&gt;
+		&lt;span class=&quot;bottype&quot;&gt;[AIType]&lt;/span&gt;
+	&lt;/div&gt;
+	&lt;div&gt;
+		&lt;table cellpadding=&quot;2&quot; cellspacing=&quot;2&quot; style=&quot;border: 0&quot;&gt;
+			&lt;tr&gt;
+				&lt;td&gt;Team :&lt;/td&gt;
+				&lt;td&gt;
+					&lt;select style=&quot;width:70px;&quot; id=&quot;teamBox[PlayerId]&quot; onfocus=&quot;suspendBoxOut();&quot; onblur=&quot;enableBoxOut();boxOut('box[PlayerId]');&quot; onchange=&quot;boxOut('box[PlayerId]');sendData('changeteam:[PlayerId]:'+getSelectedValue('teamBox[PlayerId]'));selectedTeamList[[PlayerId]-1] = getSelectedValue('teamBox[PlayerId]');selectTeams();&quot;&gt;
+						&lt;option value=&quot;0&quot;&gt;1&lt;/option&gt;
+						&lt;option value=&quot;1&quot;&gt;2&lt;/option&gt;
+						&lt;option value=&quot;2&quot;&gt;3&lt;/option&gt;
+						&lt;option value=&quot;3&quot;&gt;4&lt;/option&gt;
+						&lt;option value=&quot;4&quot;&gt;5&lt;/option&gt;
+						&lt;option value=&quot;5&quot;&gt;6&lt;/option&gt;
+						&lt;option value=&quot;6&quot;&gt;7&lt;/option&gt;
+						&lt;option value=&quot;7&quot;&gt;8&lt;/option&gt;
+						&lt;option value=&quot;8&quot;&gt;9&lt;/option&gt;
+						&lt;option value=&quot;9&quot;&gt;10&lt;/option&gt;
+						&lt;option value=&quot;10&quot;&gt;11&lt;/option&gt;
+						&lt;option value=&quot;11&quot;&gt;12&lt;/option&gt;
+						&lt;option value=&quot;12&quot;&gt;13&lt;/option&gt;
+						&lt;option value=&quot;13&quot;&gt;14&lt;/option&gt;
+						&lt;option value=&quot;14&quot;&gt;15&lt;/option&gt;
+						&lt;option value=&quot;15&quot;&gt;16&lt;/option&gt;
+					&lt;/select&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td&gt;Side:&lt;/td&gt;
+				&lt;td&gt;
+					&lt;select style=&quot;width:70px;&quot; id=&quot;sideBox[PlayerId]&quot; onfocus=&quot;suspendBoxOut();&quot; onblur=&quot;enableBoxOut();boxOut('box[PlayerId]');&quot; onchange=&quot;boxOut('box[PlayerId]');sendData('changeside:[PlayerId]:'+getSelectedValue('sideBox[PlayerId]'));selectedSideList[[PlayerId]-1] = getSelectedValue('sideBox[PlayerId]');selectSides();&quot;&gt;
+						[SideList]
+					&lt;/select&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td&gt;Bonus:&lt;/td&gt;
+				&lt;td&gt;
+					&lt;div id=&quot;handicapContainerBox[PlayerId]&quot; class=&quot;spinBox&quot;&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/table&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+	function handicapSpinBoxChanged[PlayerId](sender, newVal)
+	{
+		sendData('changehandicap:[PlayerId]:'+newVal);
+		handicapSpinCtrl[PlayerId].SetCurrentValue(newVal);
+	}
+
+	function inputFocus[PlayerId](){
+		suspendBoxOut();
+	}
+	function inputBlur[PlayerId](){
+		enableBoxOut();
+		boxOut('box[PlayerId]');
+	}
+
+	var handicapSpinBoxCtrl[PlayerId] = new SpinControl();
+	handicapSpinBoxCtrl[PlayerId].SetMaxValue(100);
+	handicapSpinBoxCtrl[PlayerId].SetMinValue(0);
+	handicapSpinBoxCtrl[PlayerId].SetIncrement(1);
+	handicapSpinBoxCtrl[PlayerId].SetCurrentValue([Handicap]);
+	handicapSpinBoxCtrl[PlayerId].GetAccelerationCollection().Add(new SpinControlAcceleration(1, 500));
+	handicapSpinBoxCtrl[PlayerId].GetAccelerationCollection().Add(new SpinControlAcceleration(10, 1750));
+	handicapSpinBoxCtrl[PlayerId].AttachValueChangedListener(handicapSpinBoxChanged[PlayerId]);
+	document.getElementById('handicapContainerBox[PlayerId]').appendChild(handicapSpinBoxCtrl[PlayerId].GetContainer());
+	handicapSpinBoxCtrl[PlayerId].StartListening();
+
+	x = handicapSpinBoxCtrl[PlayerId].GetInputBox();
+
+	x.onfocus = inputFocus[PlayerId];
+	x.onblur = inputBlur[PlayerId];
+
+&lt;/script&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/button.wav
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/button.wav
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/campaignItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/campaignItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/campaignItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,4 @@
+&lt;div&gt;
+	&lt;a href=&quot;lobby:selectcampaign:[CampaignId]&quot;&gt;&lt;b&gt;[CampaignName]&lt;/b&gt;&lt;/a&gt;&lt;br&gt;
+	[CampaignDescription]&lt;br&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/campaigns.html
===================================================================
--- trunk/Lobby/TASClient/Interface/campaigns.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/campaigns.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,52 @@
+&lt;html&gt;
+&lt;head&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;script type=&quot;text/javascript&quot;&gt;
+		currentOpacityFadeOff = 100;
+
+		function resizeBar(){
+			x = document.getElementById('bar');
+			if (getPercentValue(x.style.width) &gt; 26) {
+				x.style.width = (getPercentValue(x.style.width) - 4) + '%';
+				x.style.left = (getPercentValue(x.style.left) + 0.82) + '%'
+				setTimeout(&quot;resizeBar()&quot;,40);
+			}else{
+				sendData('main');
+			}
+		}
+
+		function fadeOff(){
+			currentOpacityFadeOff = currentOpacityFadeOff - 25;
+			document.getElementById('contentBlock').style.filter = &quot;alpha(opacity=&quot;+currentOpacityFadeOff+&quot;)&quot;;
+			if (currentOpacityFadeOff &gt; 0) {
+				setTimeout(&quot;fadeOff()&quot;,40);
+			}else{
+				document.getElementById('contentBlock').style.visibility = 'hidden';
+				resizeBar();
+			}
+		}
+	&lt;/script&gt;
+	&lt;style type=&quot;text/css&quot;&gt;
+		@import &quot;default.css&quot;;
+
+		a img{
+			border: 0;
+		}
+	&lt;/style&gt;
+&lt;/head&gt;
+&lt;body style=&quot;background-color: #[clBtnFace]&quot;&gt;
+	&lt;img src=&quot;images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
+	&lt;div id=&quot;contentBlock&quot; style=&quot;border: 0;position:absolute;left:10%;top:0;width:80%;height:100%;&quot;&gt;
+		&lt;div style=&quot;margin:10px 10px 20px 10px;&quot;&gt;
+			&lt;h1&gt;Campaigns&lt;/h1&gt;
+		&lt;/div&gt;
+		&lt;div style=&quot;margin:10px&quot;&gt;
+			[CampaignList]
+		&lt;/div&gt;
+		&lt;div class=&quot;footer&quot;&gt;
+			&lt;a href=&quot;#&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;fadeOff();&quot;&gt;Return to main menu&lt;/a&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/default.css
===================================================================
--- trunk/Lobby/TASClient/Interface/default.css	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/default.css	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,161 @@
+body, div {
+	scrollbar-base-color: #2B1D15;
+	scrollbar-arrow-color: #6c4a36;
+	scrollbar-3dlight-color: #2B1D15;
+	scrollbar-darkshadow-color: #2B1D15;
+	scrollbar-face-color: #2B1D15;
+	scrollbar-highlight-color: #6c4a36;
+	scrollbar-shadow-color: #6c4a36;
+}
+
+a,a:active, a:visited, a:hover{
+	text-decoration: none;
+	cursor: default;
+	color: #a26949;
+}
+
+a:hover{
+	color: #ffa573;
+}
+
+ul {
+	text-decoration: none;
+	list-style-type: none ;
+}
+
+li {
+	margin: 10px;
+}
+
+body {
+	overflow: hidden;
+	font-family: arial, verdana,sans-serif;
+	margin:0;
+	padding:0;
+	color: #a26949;
+	background-color: #4f3526;
+}
+
+form {
+	margin: 0;
+	padding:0;
+}
+
+h1 {
+	font-size: 3em;
+	font-style: italic;
+}
+
+div.footer {
+	position: absolute;
+	left: 0;
+	top: 100%;
+	width: 100%;
+	margin-top: -35px;
+	height: 35px;
+	margin-left:10px;
+}
+
+.luaOptionContainer {
+	margin-bottom: 15px;
+}
+
+.luaOptionDescription {
+	padding-left:20px;
+}
+
+.luaOptionName {
+	font-weight:bold;
+}
+
+select {
+	background-color: #2B1D15;
+	color: #6c4a36;
+}
+option {
+	background-color: #ffa573;
+	color: black;
+}
+
+input {
+	background-color:transparent;
+	border:1px solid #a26949;
+	color: #a26949;
+}
+
+input[type=radio],input[type=checkbox] {
+background-color:transparent;
+border:none;
+}
+
+.button {
+	border: 2px solid #a26949;
+	color: #a26949;
+	margin: 2px;
+	padding: 2px;
+}
+
+.button:hover {
+	border: 2px solid #ffa573;
+	color: #ffa573;
+	margin: 2px;
+	padding: 2px;
+	top: 2px;
+}
+
+.mapItem{
+	border: 1px solid #6c4a36;
+	color: #6c4a36;
+	width:400px;
+	height:180px;
+	margin:10px;
+	padding:10px;
+	float: left;
+	overflow: hidden;
+}
+a:hover .mapItem{
+	border: 1px solid #ffa573;
+}
+.mapMinimap{
+	margin-right: 15px;
+}
+.mapName{
+	font-weight: bold;
+}
+a:hover .mapName{
+	color: #ffa573;
+}
+.mapDescription{
+
+}
+.mapTidalStrength{
+
+}
+.mapGravity{
+
+}
+.mapExtractorRadius{
+
+}
+.mapWind{
+
+}
+.mapSize{
+
+}
+.mapPosCount{
+	visibility: hidden;
+}
+
+.sortType {
+	color: #6c4a36;
+	padding: 5px;
+}
+.sortType:hover {
+	color: #ffa573;
+	padding: 5px;
+}
+.sortTypeSelected {
+	color: #ffa573;
+	padding: 5px;
+}

Added: trunk/Lobby/TASClient/Interface/default.js
===================================================================
--- trunk/Lobby/TASClient/Interface/default.js	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/default.js	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,22 @@
+function sendData(str)
+{
+	document.location.href=&quot;lobby:&quot;+str;
+}
+function saveParam(str)
+{
+	sendData(&quot;saveParam:&quot;+str);
+}
+
+function getSelectedValue(selectId){
+	return document.getElementById(selectId).options[document.getElementById(selectId).selectedIndex].value;
+}
+
+function getPixelValue(str)
+{
+	return str.substr(0,str.length-2)*1;
+}
+
+function getPercentValue(str)
+{
+	return str.substr(0,str.length-1)*1;
+}
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/defaultCampaignSkin.html
===================================================================
--- trunk/Lobby/TASClient/Interface/defaultCampaignSkin.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/defaultCampaignSkin.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,27 @@
+&lt;html&gt;
+&lt;head&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;style type=&quot;text/css&quot;&gt;
+		@import &quot;../default.css&quot;;
+
+		a img{
+			border: 0;
+		}
+	&lt;/style&gt;
+&lt;/head&gt;
+&lt;body&gt;
+	&lt;img src=&quot;..\images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
+	&lt;div style=&quot;border: 0;position:absolute;left:10%;top:0;width:80%;height:100%;&quot;&gt;
+		&lt;div id=&quot;briefing&quot; style=&quot;margin: 20px;width: 100%;height: 20px;overflow: auto;padding: 10px;color: #ffa573&quot;&gt;
+			[CampaignContent]
+		&lt;/div&gt;
+		&lt;div class=&quot;footer&quot;&gt;
+			&lt;a href=&quot;lobby:back&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:..\button.wav');&quot;&gt;Back&lt;/a&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+	document.getElementById('briefing').style.height = document.getElementById('bar').style.pixelHeight - 45 + 'px';
+&lt;/script&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/defaultMissionBriefing.html
===================================================================
--- trunk/Lobby/TASClient/Interface/defaultMissionBriefing.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/defaultMissionBriefing.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,32 @@
+&lt;html&gt;
+&lt;head&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;style type=&quot;text/css&quot;&gt;
+		@import &quot;default.css&quot;;
+
+		a img{
+			border: 0;
+		}
+	&lt;/style&gt;
+&lt;/head&gt;
+&lt;body&gt;
+	&lt;img src=&quot;images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
+	&lt;div style=&quot;border: 0;position:absolute;left:10%;top:0;width:80%;height:100%;&quot;&gt;
+		&lt;div style=&quot;margin-bottom:20px;margin:10px;&quot;&gt;
+			&lt;h1&gt;[MissionName]&lt;/h1&gt;
+		&lt;/div&gt;
+		&lt;div id=&quot;briefing&quot; style=&quot;margin: 20px;width: 100%;height: 60%;background-color: black;border: 1px solid #6c4a36;filter : alpha(opacity=44);overflow: auto;padding: 10px;color: #ffa573&quot;&gt;
+			&lt;h2&gt;Briefing&lt;/h2&gt;
+			[MissionBriefing]
+		&lt;/div&gt;
+		&lt;div class=&quot;footer&quot;&gt;
+			&lt;a href=&quot;lobby:back&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot;&gt;Back&lt;/a&gt;
+			&lt;a href=&quot;lobby:startmission&quot; class=&quot;button&quot; style=&quot;float: right;margin-right:20px;&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot;&gt;START&lt;/a&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+	document.getElementById('briefing').style.height = document.getElementById('bar').style.pixelHeight - 130 + 'px';
+&lt;/script&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/defaultMissionSkin.html
===================================================================
--- trunk/Lobby/TASClient/Interface/defaultMissionSkin.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/defaultMissionSkin.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,28 @@
+&lt;html&gt;
+&lt;head&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;style type=&quot;text/css&quot;&gt;
+		@import &quot;../default.css&quot;;
+
+		a img{
+			border: 0;
+		}
+	&lt;/style&gt;
+&lt;/head&gt;
+&lt;body&gt;
+	&lt;img src=&quot;..\images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
+	&lt;div style=&quot;border: 0;position:absolute;left:10%;top:0;width:80%;height:100%;&quot;&gt;
+		&lt;div id=&quot;briefing&quot; style=&quot;margin: 20px;width: 100%;height: 20px;overflow: auto;padding: 10px;color: #ffa573&quot;&gt;
+			[MissionContent]
+		&lt;/div&gt;
+		&lt;div class=&quot;footer&quot;&gt;
+			&lt;a href=&quot;lobby:back&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:..\button.wav');&quot;&gt;Back&lt;/a&gt;
+			&lt;a href=&quot;lobby:startmission&quot; class=&quot;button&quot; style=&quot;float: right;margin-right:20px;&quot; onmouseover=&quot;sendData('playsound:..\button.wav');&quot;&gt;START&lt;/a&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+	document.getElementById('briefing').style.height = document.getElementById('bar').style.pixelHeight - 45 + 'px';
+&lt;/script&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/images/background.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/background.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/boxgrandiant_bot.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/boxgrandiant_bot.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/boxgrandiant_player.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/boxgrandiant_player.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/campaigns.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/campaigns.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/campaigns.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/campaigns.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/campaigns_over.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/campaigns_over.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/cross.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/cross.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/cross.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/cross.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/cross_over.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/cross_over.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/missions.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/missions.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/missions.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/missions.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/missions_over.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/missions_over.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/multiplayer.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/multiplayer.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/multiplayer.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/multiplayer.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/multiplayer_over.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/multiplayer_over.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/quit.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/quit.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/quit.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/quit.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/quit_over.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/quit_over.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/settings.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/settings.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/settings.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/settings.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/settings_over.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/settings_over.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/skirmish.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/skirmish.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/skirmish.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/skirmish.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/skirmish_over.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/skirmish_over.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/title.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/title.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/images/title.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/images/title.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/loading.html
===================================================================
--- trunk/Lobby/TASClient/Interface/loading.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/loading.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,19 @@
+&lt;html&gt;
+&lt;head&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;style type=&quot;text/css&quot;&gt;
+		@import &quot;default.css&quot;;
+
+		a img{
+			border: 0;
+		}
+	&lt;/style&gt;
+&lt;/head&gt;
+&lt;body style=&quot;background-color: #[clBtnFace]&quot;&gt;
+	&lt;img src=&quot;images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
+	&lt;div style=&quot;border: 0;position:absolute;left:10%;top:50%;width:80%;margin:0;padding:-0.5em;text-align: center;&quot;&gt;
+		&lt;b&gt;[Msg]&lt;/b&gt;
+	&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/luaBoolOption.html
===================================================================
--- trunk/Lobby/TASClient/Interface/luaBoolOption.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/luaBoolOption.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,6 @@
+&lt;div class=&quot;luaOptionContainer&quot;&gt;
+	&lt;span class=&quot;luaOptionName&quot;&gt;[luaOptionName] :&lt;/span&gt;&lt;input type=&quot;checkbox&quot;  style=&quot;border: 0&quot; id=&quot;luaOption[luaOptionId]&quot; onclick=&quot;if ( document.getElementById('luaOption[luaOptionId]').checked ) { sendData('changeluaoption:[luaOptionId]:1');}else{ sendData('changeluaoption:[luaOptionId]:0'); }&quot; [luaOptionValue] /&gt;&lt;br/&gt;
+	&lt;div class=&quot;luaOptionDescription&quot;&gt;
+		[luaOptionDescription]
+	&lt;/div&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/luaListItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/luaListItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/luaListItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1 @@
+&lt;option value =&quot;[luaOptionItemKey]&quot; title=&quot;[luaOptionItemDescription]&quot; &gt;[luaOptionItemName]&lt;/option&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/luaListOption.html
===================================================================
--- trunk/Lobby/TASClient/Interface/luaListOption.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/luaListOption.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,13 @@
+&lt;div class=&quot;luaOptionContainer&quot;&gt;
+	&lt;span class=&quot;luaOptionName&quot;&gt;[luaOptionName] :&lt;/span&gt;
+	&lt;select id=&quot;luaOption[luaOptionId]&quot; onchange=&quot;sendData('changeluaoption:[luaOptionId]:'+getSelectedValue('luaOption[luaOptionId]'));&quot;&gt;
+		[luaOptionList]
+	&lt;/select&gt;
+	&lt;div class=&quot;luaOptionDescription&quot;&gt;
+		[luaOptionDescription]
+	&lt;/div&gt;
+&lt;/div&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+	LuaListOptionList.push('luaOption[luaOptionId]');
+	selectedLuaOptionList.push('[luaOptionValue]');
+&lt;/script&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/luaNumberOption.html
===================================================================
--- trunk/Lobby/TASClient/Interface/luaNumberOption.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/luaNumberOption.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,26 @@
+&lt;div class=&quot;luaOptionContainer&quot;&gt;
+	&lt;div style=&quot;width:90%;&quot;&gt;
+		&lt;span class=&quot;luaOptionName&quot; style=&quot;float:left&quot;&gt;[luaOptionName] :&lt;/span&gt;
+		&lt;div id=&quot;spin[luaOptionId]&quot; style=&quot;float:left&quot;&gt;&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;script type=&quot;text/javascript&quot;&gt;
+		function spinChanged[luaOptionId](sender, newVal)
+		{
+			sendData('changeluaoption:[luaOptionId]:'+newVal);
+		}
+
+		var spinCtrl[luaOptionId] = new SpinControl();
+		spinCtrl[luaOptionId].SetMaxValue([luaOptionMaxValue]);
+		spinCtrl[luaOptionId].SetMinValue([luaOptionMinValue]);
+		spinCtrl[luaOptionId].SetIncrement([luaOptionStep]);
+		spinCtrl[luaOptionId].SetCurrentValue([luaOptionValue]);
+		spinCtrl[luaOptionId].GetAccelerationCollection().Add(new SpinControlAcceleration([luaOptionStep], 500));
+		spinCtrl[luaOptionId].GetAccelerationCollection().Add(new SpinControlAcceleration([luaOptionStep]*10, 1750));
+		spinCtrl[luaOptionId].AttachValueChangedListener(spinChanged[luaOptionId]);
+		document.getElementById('spin[luaOptionId]').appendChild(spinCtrl[luaOptionId].GetContainer());
+		spinCtrl[luaOptionId].StartListening();
+	&lt;/script&gt;
+	&lt;div class=&quot;luaOptionDescription&quot;&gt;
+		[luaOptionDescription]
+	&lt;/div&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/luaStringOption.html
===================================================================
--- trunk/Lobby/TASClient/Interface/luaStringOption.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/luaStringOption.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,6 @@
+&lt;div class=&quot;luaOptionContainer&quot;&gt;
+	&lt;span class=&quot;luaOptionName&quot;&gt;[luaOptionName] :&lt;/span&gt;&lt;input type=&quot;text&quot; id=&quot;luaOption[luaOptionId]&quot; onchange=&quot;sendData('changeluaoption:[luaOptionId]:'+document.getElementById('luaOption[luaOptionId]').value);&quot; value=&quot;[luaOptionValue]&quot; /&gt;&lt;br/&gt;
+	&lt;div class=&quot;luaOptionDescription&quot;&gt;
+		[luaOptionDescription]
+&lt;/div&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/main.html
===================================================================
--- trunk/Lobby/TASClient/Interface/main.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/main.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,168 @@
+&lt;html&gt;
+&lt;head&gt;
+	&lt;link type=&quot;text/css&quot; rel=&quot;StyleSheet&quot; href=&quot;default.css&quot; /&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;script type=&quot;text/javascript&quot;&gt;
+		currentOpacityFadeOff = 100;
+
+		goPage = '';
+
+		function fadeOff(){
+			currentOpacityFadeOff = currentOpacityFadeOff - 25;
+			document.getElementById('menu').style.filter = &quot;alpha(opacity=&quot;+currentOpacityFadeOff+&quot;)&quot;;
+			document.getElementById('title').style.filter = &quot;alpha(opacity=&quot;+currentOpacityFadeOff+&quot;)&quot;;
+			document.getElementById('springVersion').style.filter = &quot;alpha(opacity=&quot;+currentOpacityFadeOff+&quot;)&quot;;
+			if (currentOpacityFadeOff &gt; 0) {
+				setTimeout(&quot;fadeOff()&quot;,40);
+			}else{
+				document.getElementById('menu').style.visibility = 'hidden';
+				document.getElementById('title').style.visibility = 'hidden';
+				document.getElementById('springVersion').style.visibility = 'hidden';
+				resizeBar();
+			}
+		}
+
+		function resizeBar(){
+			x = document.getElementById('bar');
+			if (getPercentValue(x.style.width) &lt; 77) {
+				x.style.width = (getPercentValue(x.style.width) + 4) + '%';
+				x.style.left = (getPercentValue(x.style.left) - 0.82) + '%'
+				setTimeout(&quot;resizeBar()&quot;,40);
+			}else{
+				sendData(goPage);
+			}
+		}
+
+		sendData('playmusic:music.mp3');
+	&lt;/script&gt;
+	&lt;style type=&quot;text/css&quot;&gt;
+
+		a,a:hover{
+			cursor: arrow;
+			text-decoration: none;
+			border: 0;
+		}
+		a img {
+			border: 0;
+		}
+
+		#website {
+			position: absolute;
+			width: 22%;
+			left:22%;
+			top: 95%;
+			text-align: center;
+		}
+
+		#website a{
+			color: #a26949;
+		}
+
+		#website a:hover{
+			color: white;
+		}
+
+		#title {
+			position: absolute;
+			top:0;
+			left:8%;
+			width: 50%;
+			z-index:1000;
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/title.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+
+		#springVersion {
+			position: absolute;
+			top:25%;
+			left:22%;
+			width: 22%;
+			z-index:1001;
+			text-align: center;
+			font-size: 20px;
+			color: #a26949;
+		}
+
+		#campaigns {
+			position: absolute;
+			top:30%;
+			left:22.75%;
+			width: 21%;
+			z-index:1000;
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/campaigns.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		a:hover #campaigns {
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/campaigns_over.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		#missions {
+			position: absolute;
+			top:40%;
+			left:22.75%;
+			width: 21%;
+			z-index:1000;
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/missions.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		a:hover #missions {
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/missions_over.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		#skirmish {
+			position: absolute;
+			top:50%;
+			left:22.75%;
+			width: 21%;
+			z-index:1000;
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/skirmish.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		a:hover #skirmish {
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/skirmish_over.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		#multiplayer {
+			position: absolute;
+			top:60%;
+			left:22.75%;
+			width: 21%;
+			z-index:1000;
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/multiplayer.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		a:hover #multiplayer {
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/multiplayer_over.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		#settings {
+			position: absolute;
+			top:70%;
+			left:22.75%;
+			width: 21%;
+			z-index:1000;
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/settings.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		a:hover #settings {
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/settings_over.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		#quit {
+			position: absolute;
+			top:80%;
+			left:22.75%;
+			width: 21%;
+			z-index:1000;
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/quit.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+		a:hover #quit {
+			filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/quit_over.png&quot;, sizingMethod=&quot;scale&quot;);
+		}
+	&lt;/style&gt;
+&lt;/head&gt;
+&lt;body&gt;
+	&lt;img id=&quot;title&quot; src=&quot;images/title.gif&quot;&gt;&lt;/img&gt;
+	&lt;img src=&quot;images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:22%;width:22%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
+	&lt;div id=&quot;springVersion&quot;&gt;v[SpringVersion]&lt;/div&gt;
+	&lt;div id=&quot;menu&quot; style=&quot;position: absolute;width:100%;height:100%;top:0;left:0&quot;&gt;
+	&lt;a href=&quot;#&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot;  onclick=&quot;goPage='campaigns';fadeOff();&quot;&gt;&lt;img id=&quot;campaigns&quot; src=&quot;images/campaigns.gif&quot;&gt;&lt;/img&gt;&lt;/a&gt;
+	&lt;a href=&quot;#&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;goPage='missions';fadeOff();&quot;&gt;&lt;img id=&quot;missions&quot; src=&quot;images/missions.gif&quot;&gt;&lt;/img&gt;&lt;/a&gt;
+	&lt;a href=&quot;#&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;goPage='skirmish';fadeOff();&quot;&gt;&lt;img id=&quot;skirmish&quot; src=&quot;images/skirmish.gif&quot;&gt;&lt;/img&gt;&lt;/a&gt;
+	&lt;a href=&quot;lobby:showMultiplayerLobby&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot;&gt;&lt;img id=&quot;multiplayer&quot; src=&quot;images/multiplayer.gif&quot;&gt;&lt;/img&gt;&lt;/a&gt;
+	&lt;a href=&quot;lobby:gamesettings&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot;&gt;&lt;img id=&quot;settings&quot; src=&quot;images/settings.gif&quot;&gt;&lt;/img&gt;&lt;/a&gt;
+	&lt;a href=&quot;lobby:quit&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot;&gt;&lt;img id=&quot;quit&quot; src=&quot;images/quit.gif&quot;&gt;&lt;/img&gt;&lt;/a&gt;
+	&lt;div id=&quot;website&quot;&gt;&lt;a href=&quot;<A HREF="http://taspring.clan-sy.com">http://taspring.clan-sy.com</A>&quot;&gt;Official Website&lt;/a&gt;&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/mapItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/mapItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/mapItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,13 @@
+&lt;a href=&quot;#&quot; onclick=&quot;sendData('selectmap:[MapID]');sendData('localfile:skirmish.html');&quot;&gt;
+&lt;div class=&quot;mapItem&quot;&gt;
+	&lt;div class=&quot;mapMinimap&quot; style=&quot;float:left;&quot;&gt;&lt;img src=&quot;[MapMiniMapUrl]&quot; /&gt;&lt;/div&gt;
+	&lt;div style=&quot;float:left;&quot;&gt;
+	&lt;span class=&quot;mapName&quot;&gt;[MapName]&lt;/span&gt;&lt;span class=&quot;mapSize&quot;&gt;([MapWidth]x[MapHeight])&lt;/span&gt;&lt;br/&gt;
+	&lt;span class=&quot;mapDescription&quot;&gt;&lt;i&gt;Description:&lt;/i&gt; [MapDescription]&lt;/span&gt;&lt;br/&gt;
+	&lt;span class=&quot;mapTidalStrength&quot;&gt;Tidal strenght: [MapTidalStrength]&lt;/span&gt;&lt;br/&gt;
+	&lt;span class=&quot;mapGravity&quot;&gt;Gravity: [MapGravity]&lt;/span&gt;&lt;br/&gt;
+	&lt;span class=&quot;mapExtractorRadius&quot;&gt;Extractor radius: [MapExtractorRadius]&lt;/span&gt;&lt;br/&gt;
+	&lt;span class=&quot;mapWind&quot;&gt;Wind: [MapMinWind]-[MapMaxWind]&lt;/span&gt;&lt;br/&gt;
+	&lt;span class=&quot;mapPosCount&quot;&gt;[MapPosCount]&lt;/span&gt;
+&lt;/div&gt;
+&lt;/div&gt;&lt;/a&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/missionItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/missionItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/missionItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,4 @@
+&lt;div&gt;
+	&lt;a href=&quot;lobby:selectmission:[MissionId]&quot;&gt;&lt;b&gt;[MissionName]&lt;/b&gt;&lt;/a&gt;&lt;br&gt;
+	[MissionDescription]&lt;br&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/missions.html
===================================================================
--- trunk/Lobby/TASClient/Interface/missions.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/missions.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,52 @@
+&lt;html&gt;
+&lt;head&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;script type=&quot;text/javascript&quot;&gt;
+		currentOpacityFadeOff = 100;
+
+		function resizeBar(){
+			x = document.getElementById('bar');
+			if (getPercentValue(x.style.width) &gt; 26) {
+				x.style.width = (getPercentValue(x.style.width) - 4) + '%';
+				x.style.left = (getPercentValue(x.style.left) + 0.82) + '%'
+				setTimeout(&quot;resizeBar()&quot;,40);
+			}else{
+				sendData('back');
+			}
+		}
+
+		function fadeOff(){
+			currentOpacityFadeOff = currentOpacityFadeOff - 25;
+			document.getElementById('contentBlock').style.filter = &quot;alpha(opacity=&quot;+currentOpacityFadeOff+&quot;)&quot;;
+			if (currentOpacityFadeOff &gt; 0) {
+				setTimeout(&quot;fadeOff()&quot;,40);
+			}else{
+				document.getElementById('contentBlock').style.visibility = 'hidden';
+				resizeBar();
+			}
+		}
+	&lt;/script&gt;
+	&lt;style type=&quot;text/css&quot;&gt;
+		@import &quot;default.css&quot;;
+
+		a img{
+			border: 0;
+		}
+	&lt;/style&gt;
+&lt;/head&gt;
+&lt;body style=&quot;background-color: #[clBtnFace]&quot;&gt;
+	&lt;img src=&quot;images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
+	&lt;div id=&quot;contentBlock&quot; style=&quot;border: 0;position:absolute;left:10%;top:0;width:80%;height:100%;&quot;&gt;
+		&lt;div style=&quot;margin:10px 10px 20px 10px;&quot;&gt;
+			&lt;h1&gt;Missions&lt;/h1&gt;
+		&lt;/div&gt;
+		&lt;div style=&quot;margin:10px&quot;&gt;
+			[MissionList]
+		&lt;/div&gt;
+		&lt;div class=&quot;footer&quot;&gt;
+			&lt;a href=&quot;#&quot; class=&quot;button&quot; style=&quot;float: left;&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;fadeOff();&quot;&gt;Return to main menu&lt;/a&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/modItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/modItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/modItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1 @@
+&lt;option value =&quot;[modId]&quot;&gt;[modName]&lt;/option&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/playerItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/playerItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/playerItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,54 @@
+&lt;tr id=&quot;PlayerLine&quot;&gt;
+	&lt;td&gt;[PlayerName]&lt;/td&gt;
+	&lt;td&gt;
+		&lt;select id=&quot;team[PlayerId]&quot; onchange=&quot;sendData('changeteam:[PlayerId]:'+getSelectedValue('team[PlayerId]'));selectedTeamList[[PlayerId]-1] = getSelectedValue('team[PlayerId]');selectTeams();&quot;&gt;
+			&lt;option value=&quot;0&quot;&gt;1&lt;/option&gt;
+			&lt;option value=&quot;1&quot;&gt;2&lt;/option&gt;
+			&lt;option value=&quot;2&quot;&gt;3&lt;/option&gt;
+			&lt;option value=&quot;3&quot;&gt;4&lt;/option&gt;
+			&lt;option value=&quot;4&quot;&gt;5&lt;/option&gt;
+			&lt;option value=&quot;5&quot;&gt;6&lt;/option&gt;
+			&lt;option value=&quot;6&quot;&gt;7&lt;/option&gt;
+			&lt;option value=&quot;7&quot;&gt;8&lt;/option&gt;
+			&lt;option value=&quot;8&quot;&gt;9&lt;/option&gt;
+			&lt;option value=&quot;9&quot;&gt;10&lt;/option&gt;
+			&lt;option value=&quot;10&quot;&gt;11&lt;/option&gt;
+			&lt;option value=&quot;11&quot;&gt;12&lt;/option&gt;
+			&lt;option value=&quot;12&quot;&gt;13&lt;/option&gt;
+			&lt;option value=&quot;13&quot;&gt;14&lt;/option&gt;
+			&lt;option value=&quot;14&quot;&gt;15&lt;/option&gt;
+			&lt;option value=&quot;15&quot;&gt;16&lt;/option&gt;
+		&lt;/select&gt;
+	&lt;/td&gt;
+	&lt;td&gt;
+		&lt;select id=&quot;side[PlayerId]&quot; onchange=&quot;sendData('changeside:[PlayerId]:'+getSelectedValue('side[PlayerId]'));selectedSideList[[PlayerId]-1] = getSelectedValue('side[PlayerId]');selectSides();&quot;&gt;
+			[SideList]
+		&lt;/select&gt;
+	&lt;/td&gt;
+	&lt;td&gt;
+		&lt;div id=&quot;handicapContainer[PlayerId]&quot;&gt;
+	&lt;/td&gt;
+	&lt;td&gt;&nbsp;&lt;/td&gt;
+&lt;/tr&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+	function handicapSpinChanged[PlayerId](sender, newVal)
+	{
+		sendData('changehandicap:[PlayerId]:'+newVal);
+		handicapSpinBoxCtrl[PlayerId].SetCurrentValue(newVal);
+	}
+
+	var handicapSpinCtrl[PlayerId] = new SpinControl();
+	handicapSpinCtrl[PlayerId].SetMaxValue(100);
+	handicapSpinCtrl[PlayerId].SetMinValue(0);
+	handicapSpinCtrl[PlayerId].SetIncrement(1);
+	handicapSpinCtrl[PlayerId].SetCurrentValue([Handicap]);
+	handicapSpinCtrl[PlayerId].GetAccelerationCollection().Add(new SpinControlAcceleration(1, 500));
+	handicapSpinCtrl[PlayerId].GetAccelerationCollection().Add(new SpinControlAcceleration(10, 1750));
+	handicapSpinCtrl[PlayerId].AttachValueChangedListener(handicapSpinChanged[PlayerId]);
+	document.getElementById('handicapContainer[PlayerId]').appendChild(handicapSpinCtrl[PlayerId].GetContainer());
+	handicapSpinCtrl[PlayerId].StartListening();
+
+	selectedSideList.push([SelectedSide]);
+	selectedIdList.push([SelectedId]);
+	selectedTeamList.push([SelectedTeam]);
+&lt;/script&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/playerItemBox.html
===================================================================
--- trunk/Lobby/TASClient/Interface/playerItemBox.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/playerItemBox.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,79 @@
+&lt;div id=&quot;box[PlayerId]&quot; onmouseover=&quot;boxOver('box[PlayerId]');&quot; onmouseout=&quot;boxOut('box[PlayerId]');&quot; style=&quot;border:3px solid black; overflow:hidden;color:black;position: absolute;background-color: #5a835a;width: 26px; height: 26px; left: [LOBBY:LOADPARAM:box[PlayerId]:0:0]px; top: [LOBBY:LOADPARAM:box[PlayerId]:1:0]px;&quot;&gt;
+	&lt;div style=&quot;width:130px;height: 26px; background-image: url(images/boxgrandiant_player.gif);background-repeat: repeat-x; &quot;&gt;
+		&lt;div class=&quot;nameSpan&quot; style=&quot;width:26px;height:26px;padding: 2px;cursor: move;&quot; onmousedown=&quot;startMovingBox('box[PlayerId]',[PlayerId]);&quot;&gt;&lt;b&gt;[PlayerName]&lt;/b&gt;&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div&gt;
+		&lt;table cellpadding=&quot;2&quot; cellspacing=&quot;2&quot; style=&quot;border: 0&quot;&gt;
+			&lt;tr&gt;
+				&lt;td&gt;Team:&lt;/td&gt;
+				&lt;td&gt;
+					&lt;select style=&quot;width:70px;&quot; id=&quot;idBox[PlayerId]&quot; onfocus=&quot;suspendBoxOut();&quot; onblur=&quot;enableBoxOut();boxOut('box[PlayerId]');&quot; onchange=&quot;boxOut('box[PlayerId]');sendData('changeid:[PlayerId]:'+getSelectedValue('idBox[PlayerId]'));selectedIdList[[PlayerId]-1] = getSelectedValue('idBox[PlayerId]');selectTeams();&quot;&gt;
+						&lt;option value=&quot;0&quot;&gt;1&lt;/option&gt;
+						&lt;option value=&quot;1&quot;&gt;2&lt;/option&gt;
+						&lt;option value=&quot;2&quot;&gt;3&lt;/option&gt;
+						&lt;option value=&quot;3&quot;&gt;4&lt;/option&gt;
+						&lt;option value=&quot;4&quot;&gt;5&lt;/option&gt;
+						&lt;option value=&quot;5&quot;&gt;6&lt;/option&gt;
+						&lt;option value=&quot;6&quot;&gt;7&lt;/option&gt;
+						&lt;option value=&quot;7&quot;&gt;8&lt;/option&gt;
+						&lt;option value=&quot;8&quot;&gt;9&lt;/option&gt;
+						&lt;option value=&quot;9&quot;&gt;10&lt;/option&gt;
+						&lt;option value=&quot;10&quot;&gt;11&lt;/option&gt;
+						&lt;option value=&quot;11&quot;&gt;12&lt;/option&gt;
+						&lt;option value=&quot;12&quot;&gt;13&lt;/option&gt;
+						&lt;option value=&quot;13&quot;&gt;14&lt;/option&gt;
+						&lt;option value=&quot;14&quot;&gt;15&lt;/option&gt;
+						&lt;option value=&quot;15&quot;&gt;16&lt;/option&gt;
+					&lt;/select&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td&gt;Side:&lt;/td&gt;
+				&lt;td&gt;
+					&lt;select style=&quot;width:70px;&quot; id=&quot;sideBox[PlayerId]&quot; onfocus=&quot;suspendBoxOut();&quot; onblur=&quot;enableBoxOut();boxOut('box[PlayerId]');&quot; onchange=&quot;boxOut('box[PlayerId]');sendData('changeside:[PlayerId]:'+getSelectedValue('sideBox[PlayerId]'));selectedSideList[[PlayerId]-1] = getSelectedValue('sideBox[PlayerId]');selectSides();&quot;&gt;
+						[SideList]
+					&lt;/select&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td&gt;Bonus:&lt;/td&gt;
+				&lt;td&gt;
+					&lt;div id=&quot;handicapContainerBox[PlayerId]&quot; class=&quot;spinBox&quot;&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/table&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
+
+&lt;script type=&quot;text/javascript&quot;&gt;
+	function handicapSpinBoxChanged[PlayerId](sender, newVal)
+	{
+		sendData('changehandicap:[PlayerId]:'+newVal);
+		handicapSpinCtrl[PlayerId].SetCurrentValue(newVal);
+	}
+
+	function inputFocus[PlayerId](){
+		suspendBoxOut();
+	}
+	function inputBlur[PlayerId](){
+		enableBoxOut();
+		boxOut('box[PlayerId]');
+	}
+
+	var handicapSpinBoxCtrl[PlayerId] = new SpinControl();
+	handicapSpinBoxCtrl[PlayerId].SetMaxValue(100);
+	handicapSpinBoxCtrl[PlayerId].SetMinValue(0);
+	handicapSpinBoxCtrl[PlayerId].SetIncrement(1);
+	handicapSpinBoxCtrl[PlayerId].SetCurrentValue([Handicap]);
+	handicapSpinBoxCtrl[PlayerId].GetAccelerationCollection().Add(new SpinControlAcceleration(1, 500));
+	handicapSpinBoxCtrl[PlayerId].GetAccelerationCollection().Add(new SpinControlAcceleration(10, 1750));
+	handicapSpinBoxCtrl[PlayerId].AttachValueChangedListener(handicapSpinBoxChanged[PlayerId]);
+	document.getElementById('handicapContainerBox[PlayerId]').appendChild(handicapSpinBoxCtrl[PlayerId].GetContainer());
+	handicapSpinBoxCtrl[PlayerId].StartListening();
+
+	x = handicapSpinBoxCtrl[PlayerId].GetInputBox();
+
+	x.onfocus = inputFocus[PlayerId];
+	x.onblur = inputBlur[PlayerId];
+
+&lt;/script&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/selectmap.html
===================================================================
--- trunk/Lobby/TASClient/Interface/selectmap.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/selectmap.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,34 @@
+&lt;html&gt;
+&lt;head&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+	&lt;style type=&quot;text/css&quot;&gt;
+		@import &quot;default.css&quot;;
+
+		a img{
+			border: 0;
+		}
+	&lt;/style&gt;
+&lt;/head&gt;
+&lt;body style=&quot;background-color: #[clBtnFace]&quot;&gt;
+	&lt;img src=&quot;images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
+	&lt;div style=&quot;border: 0;position:absolute;left:10%;top:0;width:80%;height:100%;margin:0;padding:0;&quot;&gt;
+		&lt;div style=&quot;height: 30px;&quot;&gt;
+			&lt;a href=&quot;lobby:localfile:skirmish.html&quot; class=&quot;button&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; style=&quot;float: left&quot;&gt;Cancel&lt;/a&gt;
+			&lt;a href=&quot;lobby:sortmapsby:name&quot; style=&quot;float: right&quot; class=&quot;sortType&quot; id=&quot;SortByName&quot;&gt;Sort by name&lt;/a&gt;&lt;a href=&quot;lobby:sortmapsby:size&quot; style=&quot;float: right&quot; class=&quot;sortType&quot; id=&quot;SortBySize&quot;&gt;Sort by size&lt;/a&gt;&lt;br/&gt;
+		&lt;/div&gt;
+		&lt;div style=&quot;width:100%;height:100%;margin:0;padding:0;overflow: auto&quot;&gt;
+			[MAPLIST]
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;
+
+&lt;script type=&quot;text/javascript&quot;&gt;
+	if ('[MAPSORT]' == 'size') {
+		document.getElementById('SortBySize').className = 'sortTypeSelected';
+	}
+	if ('[MAPSORT]' == 'name') {
+		document.getElementById('SortByName').className = 'sortTypeSelected';
+	}
+&lt;/script&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/sideItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/sideItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/sideItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1 @@
+&lt;option value =&quot;[sideId]&quot;&gt;[sideName]&lt;/option&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/skirmish.html
===================================================================
--- trunk/Lobby/TASClient/Interface/skirmish.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/skirmish.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,570 @@
+&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;
+            &quot;<A HREF="http://www.w3.org/TR/html4/loose.dtd">http://www.w3.org/TR/html4/loose.dtd</A>&quot;&gt;
+
+&lt;html&gt;
+&lt;head&gt;
+&lt;link type=&quot;text/css&quot; rel=&quot;StyleSheet&quot; href=&quot;slider/css/winclassic.css&quot; /&gt;
+&lt;link type=&quot;text/css&quot; rel=&quot;StyleSheet&quot; href=&quot;spincontrol/style.css&quot; /&gt;
+&lt;link type=&quot;text/css&quot; rel=&quot;StyleSheet&quot; href=&quot;default.css&quot; /&gt;
+&lt;style type=&quot;text/css&quot;&gt;
+	.Panel {
+		overflow: hidden;
+		visibility: hidden;
+	}
+
+	#PlayerList {
+		width: 100%;
+	}
+
+	#PlayerList td,#PlayerList th {
+		border-right: 1px solid #6c4a36;
+		text-align: center;
+	}
+
+	#PlayerList th {
+		border-bottom: 1px solid #6c4a36;
+	}
+
+	#PlayerLine td {
+		background-color: black;
+		color: #6c4a36;
+	}
+
+	.cross {
+		width:16px;
+		height: 16px;
+		float: left;
+		filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/cross.png&quot;, sizingMethod=&quot;scale&quot;);
+	}
+
+	a:hover .cross {
+		filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;images/cross_over.png&quot;, sizingMethod=&quot;scale&quot;);
+	}
+
+	#tabs td {
+		background-color: #6c4a36;
+		margin: 10px;
+		padding: 2px;
+	}
+
+	.tab a, .tab a:active, .tab a:visited {
+		float: left;
+		margin-right: 10px;
+		padding: 4px;
+		background-color: #6c4a36;
+		font-size: 20px;
+		color: black;
+		border: 0;
+	}
+
+	.tab a:hover {
+		background-color: #ffa573;
+		color: black;
+	}
+
+	.tabSelected a, .tabSelected a:active, .tabSelected a:visited, .tabSelected a:hover {
+		float: left;
+		margin-right: 10px;
+		padding: 4px;
+		background-color: #a26949;
+		font-size: 20px;
+		color: black;
+	}
+
+	.boxCross {
+		color: black;
+		text-decoration: none;
+	}
+
+	.boxCross:hover {
+		color: red;
+	}
+
+&lt;/style&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;default.js&quot;&gt;&lt;/script&gt;
+
+&lt;script type=&quot;text/javascript&quot;&gt;
+	currentOpacityFadeOff = 100;
+
+	function resizeBar(){
+		x = document.getElementById('bar');
+		if (getPercentValue(x.style.width) &gt; 26) {
+			x.style.width = (getPercentValue(x.style.width) - 4) + '%';
+			x.style.left = (getPercentValue(x.style.left) + 0.82) + '%'
+			setTimeout(&quot;resizeBar()&quot;,40);
+		}else{
+			sendData('main');
+		}
+	}
+
+	function fadeOff(){
+		currentOpacityFadeOff = currentOpacityFadeOff - 25;
+		document.getElementById('tableId').style.filter = &quot;alpha(opacity=&quot;+currentOpacityFadeOff+&quot;)&quot;;
+		if (currentOpacityFadeOff &gt; 0) {
+			setTimeout(&quot;fadeOff()&quot;,40);
+		}else{
+			document.getElementById('tableId').style.visibility = 'hidden';
+			resizeBar();
+		}
+	}
+
+	movingBox = null;
+	startX = 0;
+	startY = 0;
+	lastX = 0;
+	lastY = 0;
+	curBoxId = '';
+	curPlayerId = '';
+
+
+	function debug(str){
+		document.getElementById('debugspan').innerHTML += '&lt;br/&gt;'+str;
+	}
+
+	function startMovingBox(boxId,playerId)
+	{
+		if(!isBoxOutSuspended)
+		{
+			movingBox=document.getElementById(boxId);
+			curBoxId = boxId;
+			curPlayerId = playerId;
+			movingBox.style.overflow = 'hidden';
+			box.style.width = '26px';
+			box.style.height = '26px'
+		}
+	}
+	function endMovingBox()
+	{
+		if(movingBox != null)
+		{
+			saveParam(curBoxId+&quot;:&quot;+getPixelValue(movingBox.style.left)+&quot;:&quot;+getPixelValue(movingBox.style.top));
+			sendData('changestartpos:'+curPlayerId+':'+(getPixelValue(movingBox.style.left)+(getPixelValue(movingBox.style.width)+2*getPixelValue(movingBox.style.borderWidth))/2)/(getPixelValue(document.getElementById('minimap').style.width)*[MAP%WIDTH]/100)+':'+(getPixelValue(movingBox.style.top)+(getPixelValue(movingBox.style.height)/2+2*getPixelValue(movingBox.style.borderWidth)))/(getPixelValue(document.getElementById('minimap').style.height)*[MAP%HEIGHT]/100));
+		}
+		movingBox=null;
+	}
+	function mouseMove()
+	{
+		x = window.event.clientX;
+		y = window.event.clientY;
+
+		if(movingBox != null &amp;&amp; lastX != 0)
+		{
+			maxLeft = getPixelValue(document.getElementById('minimap').style.width)-getPixelValue(movingBox.style.width)-getPixelValue(movingBox.style.borderWidth)*2;
+			maxTop = getPixelValue(document.getElementById('minimap').style.height)-getPixelValue(movingBox.style.height)-getPixelValue(movingBox.style.borderWidth)*2;
+			movingBox.style.left = Math.min(maxLeft,Math.max(0,getPixelValue(movingBox.style.left)+x-lastX))+'px';
+			movingBox.style.top = Math.min(maxTop,Math.max(0,getPixelValue(movingBox.style.top)+y-lastY))+'px';
+		}
+		lastX = x;
+		lastY = y;
+	}
+	function boxOver(boxId){
+		if(movingBox == null)
+		{
+			box = document.getElementById(boxId);
+			box.style.overflow = '';
+			box.style.width = '130px';
+			box.style.height = '136px';
+		}
+	}
+	isBoxOutSuspended = false;
+	function boxOut(boxId){
+		if(!isBoxOutSuspended)
+		{
+			box = document.getElementById(boxId);
+			box.style.overflow = 'hidden';
+			box.style.width = '26px';
+			box.style.height = '26px';
+		}
+	}
+	function switchSuspendBoxOut(){
+		isBoxOutSuspended = !isBoxOutSuspended;
+	}
+	function suspendBoxOut(){
+		isBoxOutSuspended = true;
+	}
+	function enableBoxOut(){
+		isBoxOutSuspended = false;
+	}
+
+	function checkBoxes(){
+		for(i=1;i&lt;=[NbPlayers];i++)
+		{
+			movingBox = document.getElementById('box'+i);
+			curBoxId = 'box'+i;
+			curPlayerId = i;
+			maxLeft = getPixelValue(document.getElementById('minimap').style.width)*[MAP%WIDTH]/100-getPixelValue(movingBox.style.width)-getPixelValue(movingBox.style.borderWidth)*2;
+			maxTop = getPixelValue(document.getElementById('minimap').style.height)*[MAP%HEIGHT]/100-getPixelValue(movingBox.style.height)-getPixelValue(movingBox.style.borderWidth)*2;
+			movingBox.style.left = Math.min(maxLeft,Math.max(0,getPixelValue(movingBox.style.left)))+'px';
+			movingBox.style.top = Math.min(maxTop,Math.max(0,getPixelValue(movingBox.style.top)))+'px';
+			endMovingBox();
+		}
+	}
+
+	function selectMod(id){
+		document.getElementById('modList').selectedIndex = id+1;
+	}
+
+	var selectedSideList = new Array();
+	var selectedIdList = new Array();
+	var selectedTeamList = new Array();
+	var LuaListOptionList = new Array();
+	var selectedLuaOptionList = new Array();
+
+	function selectSides(){
+		for(i=1;i&lt;=[NbPlayers];i++)
+		{
+			x = document.getElementById('side'+i);
+			if (x != null) {
+				x.selectedIndex = selectedSideList[i-1];
+			}
+			x = document.getElementById('sideBox'+i);
+			if (x != null) {
+				x.selectedIndex = selectedSideList[i-1];
+			}
+		}
+	}
+	function selectIds(){
+		for(i=1;i&lt;=[NbPlayers];i++)
+		{
+			x = document.getElementById('id'+i);
+			if (x != null) {
+				x.selectedIndex = selectedIdList[i-1];
+			}
+			x = document.getElementById('idBox'+i);
+			if (x != null) {
+				x.selectedIndex = selectedIdList[i-1];
+			}
+		}
+	}
+	function selectTeams(){
+		for(i=1;i&lt;=[NbPlayers];i++)
+		{
+			x = document.getElementById('team'+i);
+			if (x != null) {
+				x.selectedIndex = selectedTeamList[i-1];
+			}
+			x = document.getElementById('teamBox'+i);
+			if (x != null) {
+				x.selectedIndex = selectedTeamList[i-1];
+			}
+		}
+	}
+
+	function selectLuaListOptions(){
+		for(i=0;i&lt;LuaListOptionList.length;i++)
+		{
+			x = document.getElementById(LuaListOptionList[i]);
+			for(j=0;j&lt;x.options.length;j++)
+			{
+				if(x.options[j].value == selectedLuaOptionList[i])
+				{
+					x.selectedIndex = j;
+					break;
+				}
+			}
+		}
+	}
+
+	function selecAI(dll){
+			x = document.getElementById('aiType');
+			x.selectedIndex = 0;
+			for(i=0;i&lt;x.options.length;i++)
+			{
+				if(x.options[i].value == dll)
+				{
+					x.selectedIndex = i;
+					break;
+				}
+			}
+	}
+
+	function hideBoxes(){
+		document.getElementById('playerBoxList').style.visibility = 'hidden';
+	}
+
+	function showBoxes(){
+		document.getElementById('playerBoxList').style.visibility = '';
+	}
+
+	function afterLoading(){
+		checkBoxes();
+		selectMod([SelectedModId]);
+		selectSides();
+		//selectIds();
+		selectTeams();
+		selecAI('[LOBBY:LOADPARAM:aiType:0:0]');
+		selectLuaListOptions();
+		if (document.getElementsByName('gamemode')[0].checked) {
+			showBoxes();
+		}else{
+			hideBoxes();
+		}
+	}
+
+	function hidePanel(panelId,tabId){
+		document.getElementById(panelId).style.height = '0';
+		document.getElementById(panelId).style.visibility = 'hidden';
+		document.getElementById(tabId).className = 'tab';
+	}
+
+	function showPanel(panelId,tabId){
+		document.getElementById(panelId).style.visibility = 'visible';
+		document.getElementById(panelId).style.height = '';
+		document.getElementById(tabId).className = 'tabSelected';
+	}
+
+	function switchToPanel(panelId,tabId){
+		hidePanel('GameoptionsPanel','Tab1');
+		hidePanel('MapPanel','Tab2');
+		hidePanel('UnitsPanel','Tab3');
+		hidePanel('ModOptionsPanel','Tab4');
+		hidePanel('MapOptionsPanel','Tab5');
+
+		showPanel(panelId,tabId);
+		saveParam(&quot;activePanel:'&quot;+panelId+&quot;','&quot;+tabId+&quot;'&quot;);
+	}
+
+	sendData('changeMinimapStartPosSize:12');
+
+	document.onmousemove = mouseMove;
+&lt;/script&gt;
+
+&lt;script type=&quot;text/javascript&quot; src=&quot;slider/js/range.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;slider/js/timer.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;slider/js/slider.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;spincontrol/javascript.js&quot;&gt;&lt;/script&gt;
+
+&lt;/head&gt;
+&lt;body style=&quot;background-color: #4f3526;height:100%&quot; onmouseup=&quot;endMovingBox();boxOut();&quot; onload=&quot;afterLoading();&quot;&gt;
+	&lt;img src=&quot;images\background.jpg&quot; style=&quot;height:100%;position: absolute; top:0;left:0;z-index:-1&quot;  /&gt;
+	&lt;div id=&quot;bar&quot; style=&quot;position:absolute;left:10%;top:0;width:80%;height:100%;filter : alpha(opacity=44);background-color: black&quot;&gt;&lt;/div&gt;
+		&lt;span style=&quot;font-size;40px; color:red;background-color:black;&quot; id=&quot;debugspan&quot;&gt;&lt;/span&gt;
+		&lt;!--[if IE 7]&gt;
+		&lt;div style=&quot;position:absolute;left:0;top:0;width:100%;height:100%;&quot;&gt;
+		&lt;![endif]--&gt;
+		&lt;table id=&quot;tableId&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: 0;position:absolute;left:10%;top:0;width:80%;height:100%;margin:0;padding:0;&quot;&gt;
+			&lt;tr style=&quot;height:30px&quot;&gt;
+				&lt;td&gt;
+					&lt;form action=&quot;&quot; method=&quot;POST&quot;&gt;
+						Select the mod :
+						&lt;select id=&quot;modList&quot; onchange=&quot;sendData('selectmod:'+getSelectedValue('modList'));&quot;&gt;
+							&lt;option value=&quot;&quot;&gt;-Select a mod-&lt;/option&gt;
+							[ModList]
+						&lt;/select&gt;
+					&lt;/form&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr id=&quot;tabContainer&quot; valign=&quot;top&quot;&gt;
+				&lt;td style=&quot;margin:0;padding:0;&quot;&gt;
+					&lt;table id=&quot;changeHeight1&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: 0;margin-left: 12px;margin-right: 12px;margin-top: 12px; padding: 0;&quot;&gt;
+					&lt;tr valign=&quot;bottom&quot;&gt;&lt;td&gt;
+						&lt;div id=&quot;Tab1&quot; class=&quot;tab&quot;&gt;&lt;a href=&quot;#&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;switchToPanel('GameoptionsPanel','Tab1');&quot;&gt;Game options&lt;/a&gt;&lt;/div&gt;
+						&lt;div id=&quot;Tab2&quot; class=&quot;tab&quot;&gt;&lt;a href=&quot;#&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;switchToPanel('MapPanel','Tab2');&quot;&gt;Map&lt;/a&gt;&lt;/div&gt;
+						&lt;div id=&quot;Tab3&quot; class=&quot;tab&quot;&gt;&lt;a href=&quot;#&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;switchToPanel('MapOptionsPanel','Tab3');&quot;&gt;Map options&lt;/a&gt;&lt;/div&gt;
+						&lt;div id=&quot;Tab4&quot; class=&quot;tab&quot;&gt;&lt;a href=&quot;#&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;switchToPanel('ModOptionsPanel','Tab4');&quot;&gt;Mod options&lt;/a&gt;&lt;/div&gt;
+						&lt;div id=&quot;Tab5&quot; class=&quot;tab&quot;&gt;&lt;a href=&quot;#&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;switchToPanel('UnitsPanel','Tab5');&quot;&gt;Units&lt;/a&gt;&lt;/div&gt;
+					&lt;/td&gt;&lt;/tr&gt;
+					&lt;tr id=&quot;changeHeight2&quot; valign=&quot;top&quot;&gt;&lt;td style=&quot;border: 1px solid #6c4a36;width: 90%;&quot;&gt;
+						&lt;div id=&quot;GameoptionsPanel&quot; class=&quot;Panel&quot;&gt;
+							&lt;table id=&quot;changeWidth1&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: 0;margin: 10px 10px 0 10px;&quot;&gt;
+							&lt;tr&gt;
+								&lt;td&gt;
+									&lt;div style=&quot;float:left;&quot;&gt;
+										&lt;form method=&quot;POST&quot; action=&quot;&quot;&gt;
+											Game type : &lt;br/&gt;
+											&lt;input type=&quot;radio&quot; name=&quot;gametype&quot; value=&quot;0&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gametype0:checked');saveParam('gametype1:');saveParam('gametype2:');sendData('changegametype:0');&quot; [LOBBY:LOADPARAM:gametype0:0:checked] /&gt; Game continues if commander dies &lt;br/&gt;
+											&lt;input type=&quot;radio&quot; name=&quot;gametype&quot; value=&quot;1&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gametype0:');saveParam('gametype1:checked');saveParam('gametype2:');sendData('changegametype:1');&quot; [LOBBY:LOADPARAM:gametype1:0] /&gt; Game ends if commander dies &lt;br/&gt;
+											&lt;input type=&quot;radio&quot; name=&quot;gametype&quot; value=&quot;2&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gametype0:');saveParam('gametype1:');saveParam('gametype2:checked');sendData('changegametype:2');&quot; [LOBBY:LOADPARAM:gametype2:0] /&gt; Lineage mode &lt;br/&gt;
+											Start pos : &lt;br/&gt;
+											&lt;input type=&quot;radio&quot; name=&quot;gamemode&quot; value=&quot;0&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gamemode0:checked');saveParam('gamemode1:');saveParam('gamemode2:');sendData('changegamemode:0');showBoxes();&quot; [LOBBY:LOADPARAM:gamemode0:0:checked] /&gt; Choose &lt;br/&gt;
+											&lt;input type=&quot;radio&quot; name=&quot;gamemode&quot; value=&quot;1&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gamemode0:');saveParam('gamemode1:checked');saveParam('gamemode2:');sendData('changegamemode:1');hideBoxes();&quot; [LOBBY:LOADPARAM:gamemode1:0] /&gt; Random &lt;br/&gt;
+											&lt;input type=&quot;radio&quot; name=&quot;gamemode&quot; value=&quot;2&quot; style=&quot;border: 0&quot; onclick=&quot;saveParam('gamemode0:');saveParam('gamemode1:');saveParam('gamemode2:checked');sendData('changegamemode:2');hideBoxes();&quot; [LOBBY:LOADPARAM:gamemode2:0] /&gt; Fixed &lt;br/&gt;
+
+											&lt;input type=&quot;checkbox&quot; id=&quot;LimitDGun&quot; style=&quot;border: 0&quot; onclick=&quot;if ( document.getElementById('LimitDGun').checked ) { saveParam('LimitDGun:checked');sendData('changelimitdgun:1');}else{ saveParam('LimitDGun:');sendData('changelimitdgun:0'); }&quot; [LOBBY:LOADPARAM:LimitDGun:0] /&gt; Limit D-Gun &lt;br/&gt;
+											&lt;input type=&quot;checkbox&quot; id=&quot;GhostedB&quot; style=&quot;border: 0&quot; onclick=&quot;if ( document.getElementById('GhostedB').checked ) { saveParam('GhostedB:checked');sendData('changeGhostedB:1');}else{ saveParam('GhostedB:');sendData('changeGhostedB:0'); }&quot; [LOBBY:LOADPARAM:GhostedB:0:checked] /&gt; Ghosted buildings &lt;br/&gt;
+											&lt;input type=&quot;checkbox&quot; id=&quot;DiminishMM&quot; style=&quot;border: 0&quot; onclick=&quot;if ( document.getElementById('DiminishMM').checked ) { saveParam('DiminishMM:checked');sendData('changeDiminishMM:1');}else{ saveParam('DiminishMM:');sendData('changeDiminishMM:0'); }&quot; [LOBBY:LOADPARAM:DiminishMM:0] /&gt; Diminishing metal makers &lt;br/&gt;
+										&lt;/form&gt;
+									&lt;/div&gt;
+									&lt;div style=&quot;float:left;margin-left: 30px;&quot;&gt;
+										&lt;div style=&quot;float:left;width: 100px;&quot;&gt;
+											Start Metal :
+											&lt;div class=&quot;slider&quot; id=&quot;metal-slider&quot; style=&quot;height: 170px&quot;&gt;
+												&lt;input class=&quot;slider-input&quot; id=&quot;metal-slider-input&quot; /&gt;
+											&lt;/div&gt;
+											&lt;input id=&quot;metal-input&quot; maxlength=&quot;5&quot; style=&quot;width: 40px;&quot; /&gt;
+										&lt;/div&gt;
+										&lt;div style=&quot;float:left;width: 100px;&quot;&gt;
+											Start Energy :
+											&lt;div class=&quot;slider&quot; id=&quot;energy-slider&quot; style=&quot;height: 170px&quot;&gt;
+												&lt;input class=&quot;slider-input&quot; id=&quot;energy-slider-input&quot; /&gt;
+											&lt;/div&gt;
+											&lt;input id=&quot;energy-input&quot; maxlength=&quot;5&quot; style=&quot;width: 40px;&quot; /&gt;
+										&lt;/div&gt;
+										&lt;div style=&quot;float:left;width: 80px;&quot;&gt;
+											Max Units:
+											&lt;div class=&quot;slider&quot; id=&quot;units-slider&quot; style=&quot;height: 170px&quot;&gt;
+												&lt;input class=&quot;slider-input&quot; id=&quot;units-slider-input&quot; /&gt;
+											&lt;/div&gt;
+											&lt;input id=&quot;units-input&quot; maxlength=&quot;4&quot; style=&quot;width: 40px;&quot; /&gt;
+										&lt;/div&gt;
+									&lt;div&gt;
+								&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;
+									&lt;div id=&quot;playerList&quot; style=&quot;margin-top: 20px;overflow-y: auto;overflow-x:hidden&quot;&gt;
+										&lt;table id=&quot;PlayerList&quot; cellspacing=&quot;0&quot; cellpadding=&quot;2&quot;&gt;
+											&lt;tr&gt;
+												&lt;th width=&quot;100&quot;&gt;Name&lt;/th&gt;
+												&lt;th&gt;Team&lt;/th&gt;
+												&lt;th&gt;Side&lt;/th&gt;
+												&lt;th&gt;Bonus&lt;/th&gt;
+												&lt;th width=&quot;150&quot;&gt;AI Type&lt;/th&gt;
+											&lt;/tr&gt;
+											[PlayerList]
+										&lt;/table&gt;
+									&lt;/div&gt;
+									&lt;div&gt;
+										&lt;form id=&quot;addBotForm&quot; style=&quot;margin-top: 20px;float:left;&quot; method=&quot;POST&quot; action=&quot;lobby:addbot&quot; onsubmit=&quot;&quot; &gt;
+											Add AI :
+											&lt;select id=&quot;aiType&quot; onchange=&quot;saveParam('aiType:'+getSelectedValue('aiType'));&quot;&gt;
+												[AILIST]
+											&lt;/select&gt;
+										&lt;/form&gt;
+										&lt;a onmouseover=&quot;sendData('playsound:button.wav');&quot; onclick=&quot;document.getElementById('addBotForm').action = 'lobby:addbot:'+getSelectedValue('aiType');document.getElementById('addBotForm').submit();&quot; href=&quot;#&quot; style=&quot;float:left;margin-top: 20px;&quot; class=&quot;button&quot;&gt;Add&lt;/a&gt;
+									&lt;/div&gt;
+								&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;/table&gt;
+						&lt;/div&gt;
+						&lt;div id=&quot;MapPanel&quot; class=&quot;Panel&quot;&gt;
+							&lt;div style=&quot;margin: 12px&quot;&gt;
+							&lt;a onmouseover=&quot;sendData('playsound:button.wav');&quot; href=&quot;lobby:localfile:selectmap.html&quot; class=&quot;button&quot; id=&quot;SelectMapButton&quot;&gt;Select map&lt;/a&gt;: [SELECTEDMAPNAME]( [MAPWIDTH] x [MAPHEIGHT] )
+							&lt;/div&gt;
+							&lt;div id=&quot;minimap&quot; style=&quot;width:0; height:0;position:relative;margin: 15px;&quot; &gt;
+								&lt;img id=&quot;minimapImg&quot; width=&quot;10&quot; height=&quot;10&quot; src=&quot;minimap.bmp&quot;/&gt;
+								&lt;div id=&quot;playerBoxList&quot; style=&quot;position:absolute;width:98%;height:100%;top:0;left:0&quot;&gt;
+								[PlayerBoxList]
+								&lt;/div&gt;
+							&lt;/div&gt;
+						&lt;/div&gt;
+						&lt;div id=&quot;UnitsPanel&quot; class=&quot;Panel&quot;&gt;
+							&lt;div style=&quot;margin: 5px;&quot;&gt;Disabled units :&lt;/div&gt;
+							&lt;div id=&quot;unitList&quot; style=&quot;margin-left:12px;overflow: auto;border:1px solid;border-color: #6c4a36;&quot;&gt;
+								&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
+									[unitList]
+								&lt;/form&gt;
+							&lt;/div&gt;
+						&lt;/div&gt;
+						&lt;div id=&quot;ModOptionsPanel&quot; class=&quot;Panel&quot;&gt;
+							&lt;div id=&quot;modOptions&quot; style=&quot;margin:12px;overflow:auto;&quot;&gt;
+								&lt;form&gt;
+									[MODOPTIONLIST]
+								&lt;/form&gt;
+							&lt;/div&gt;
+						&lt;/div&gt;
+						&lt;div id=&quot;MapOptionsPanel&quot; class=&quot;Panel&quot;&gt;
+							&lt;div id=&quot;mapOptions&quot; style=&quot;margin:12px;overflow:auto;&quot;&gt;
+								&lt;form&gt;
+									[MAPOPTIONLIST]
+								&lt;/form&gt;
+							&lt;/div&gt;
+						&lt;/div&gt;
+					&lt;/td&gt;&lt;/tr&gt;
+					&lt;/table&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr style=&quot;height:40px&quot;&gt;
+				&lt;td&gt;&lt;div style=&quot;margin: 5px&quot;&gt;&lt;a onclick=&quot;sendData('resetparams');fadeOff();&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; href=&quot;#&quot; class=&quot;button&quot; style=&quot;float: left&quot;&gt;Return to main menu&lt;/a&gt;&lt;a onclick=&quot;sendData('start');&quot; onmouseover=&quot;sendData('playsound:button.wav');&quot; href=&quot;#&quot; class=&quot;button&quot; style=&quot;float:right&quot;&gt;START&lt;/a&lt;/div&gt;&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/table&gt;
+		&lt;!--[if IE 7]&gt;
+		&lt;/div&gt;
+		&lt;![endif]--&gt;
+	&lt;script type=&quot;text/javascript&quot;&gt;
+		// hide the blocks to fix issues on IE6
+		switchToPanel([LOBBY:LOADPARAM:activePanel:0:'GameoptionsPanel','Tab1']);
+
+
+		// resize the minima
+		availableW = (document.getElementById('tableId').style.pixelWidth-54);
+		availableH = document.getElementById('tableId').style.pixelHeight-190;
+
+		forceWidth = availableH*[MAP%WIDTH]/[MAP%HEIGHT];
+		forceHeight = availableW*[MAP%HEIGHT]/[MAP%WIDTH];
+
+		if((([MAP%WIDTH] &gt; [MAP%HEIGHT]) &amp;&amp; (forceHeight &lt; availableH)) || (forceWidth &gt; availableW)){
+			document.getElementById('minimap').style.width = availableW + 'px';
+			document.getElementById('minimap').style.height = forceHeight + 'px';
+		}else{
+			document.getElementById('minimap').style.width = forceWidth + 'px';
+			document.getElementById('minimap').style.height = availableH + 'px';
+		}
+
+		document.getElementById('minimapImg').width = document.getElementById('minimap').style.pixelWidth;
+		document.getElementById('minimapImg').height = document.getElementById('minimap').style.pixelHeight;
+
+		// resize crappy stuff because % with IE = PHAIL
+		document.getElementById('changeHeight1').style.height = document.getElementById('tableId').style.pixelHeight-100 + 'px';
+		document.getElementById('changeHeight2').style.height = document.getElementById('tableId').style.pixelHeight-120 + 'px';
+		document.getElementById('unitList').style.height = document.getElementById('tableId').style.pixelHeight-150 + 'px';
+		document.getElementById('modOptions').style.height = document.getElementById('tableId').style.pixelHeight-144 + 'px';
+		document.getElementById('mapOptions').style.height = document.getElementById('tableId').style.pixelHeight-144 + 'px';
+		document.getElementById('playerList').style.height = document.getElementById('tableId').style.pixelHeight-415 + 'px';
+
+		document.getElementById('changeHeight1').style.width = document.getElementById('tableId').style.pixelWidth-24 + 'px';
+		document.getElementById('changeWidth1').style.width = document.getElementById('tableId').style.pixelWidth-48 + 'px';
+		document.getElementById('playerList').style.width = document.getElementById('tableId').style.pixelWidth-48 + 'px';
+		document.getElementById('unitList').style.width = document.getElementById('tableId').style.pixelWidth-60 + 'px';
+		document.getElementById('mapOptions').style.width = document.getElementById('tableId').style.pixelWidth-60 + 'px';
+		document.getElementById('modOptions').style.width = document.getElementById('tableId').style.pixelWidth-60 + 'px';
+
+		document.getElementById('SelectMapButton').onmouseover();
+		// init code
+		var m = new Slider(document.getElementById(&quot;metal-slider&quot;), document.getElementById(&quot;metal-slider-input&quot;), &quot;vertical&quot;);
+		var e = new Slider(document.getElementById(&quot;energy-slider&quot;), document.getElementById(&quot;energy-slider-input&quot;), &quot;vertical&quot;);
+		var u = new Slider(document.getElementById(&quot;units-slider&quot;), document.getElementById(&quot;units-slider-input&quot;), &quot;vertical&quot;);
+		m.setMaximum(10000);
+		e.setMaximum(10000);
+		u.setMaximum(5000);
+
+		var mi = document.getElementById(&quot;metal-input&quot;);
+		mi.onchange = function () {
+			m.setValue(parseInt(this.value));
+		};
+		m.onchange = function () {
+			mi.value = m.getValue();
+			sendData('changemetal:'+m.getValue());
+
+			if (typeof window.onchange == &quot;function&quot;)
+				window.onchange();
+		};
+		var ei = document.getElementById(&quot;energy-input&quot;);
+		ei.onchange = function () {
+			e.setValue(parseInt(this.value));
+		};
+		e.onchange = function () {
+			ei.value = e.getValue();
+			sendData('changeenergy:'+parseInt(e.getValue()));
+
+			if (typeof window.onchange == &quot;function&quot;)
+				window.onchange();
+		};
+		var ui = document.getElementById(&quot;units-input&quot;);
+		ui.onchange = function () {
+			u.setValue(parseInt(this.value));
+		};
+		u.onchange = function () {
+			ui.value = u.getValue();
+			sendData('changemaxunits:'+parseInt(u.getValue()));
+
+			if (typeof window.onchange == &quot;function&quot;)
+				window.onchange();
+		};
+
+		m.setValue([StartMetal]);
+		e.setValue([StartEnergy]);
+		u.setValue([MaxUnits]);
+	&lt;/script&gt;
+&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/slider/css/bluecurve/bluecurve.css
===================================================================
--- trunk/Lobby/TASClient/Interface/slider/css/bluecurve/bluecurve.css	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/slider/css/bluecurve/bluecurve.css	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,80 @@
+/*
+	back:	rgb(230,230,230)
+	dark:	rgb(90,97,90)
+	medium	rgb(189,190,189)
+	*/
+
+.dynamic-slider-control {
+	position:			relative;
+	background-color:	rgb(230,230,230);
+	-moz-user-focus:	normal;
+	-moz-user-select:	none;
+	cursor:				default;
+}
+
+.horizontal {
+	width:				200px;
+	height:				27px;
+}
+
+.vertical {
+	width:				29px;
+	height:				200px;
+}
+
+.dynamic-slider-control input {
+	display:	none;
+}
+
+.dynamic-slider-control .handle {
+	position:			absolute;	
+	font-size:			1px;
+	overflow:			hidden;
+	-moz-user-select:	none;
+	cursor:				default;
+}
+
+.dynamic-slider-control.horizontal .handle {
+	width:				31px;
+	height:				14px;
+	background-image:	url(&quot;handle.horizontal.png&quot;);
+}
+
+.dynamic-slider-control.horizontal .handle div {}
+.dynamic-slider-control.horizontal .handle.hover {}
+
+.dynamic-slider-control.vertical .handle {
+	width:				15px;
+	height:				31px;
+	background-image:	url(&quot;handle.vertical.png&quot;);
+}
+
+.dynamic-slider-control.vertical .handle.hover {}
+
+.dynamic-slider-control .line {
+	position:			absolute;
+	font-size:			0.01mm;
+	overflow:			hidden;
+	border:				1px solid rgb(90,97,90);
+	background:			rgb(189,190,189);
+	
+	behavior:			url(&quot;css/boxsizing.htc&quot;); /* ie path bug */
+	box-sizing:			content-box;
+	-moz-box-sizing:	content-box;
+}
+.dynamic-slider-control.vertical .line {
+	width:				3px;
+}
+
+.dynamic-slider-control.horizontal .line {
+	height:				3px;
+}
+
+.dynamic-slider-control .line div {
+	width:		1px;
+	height:		1px;
+	
+	border:				1px solid;
+	border-color:		rgb(230,230,230) rgb(189,190,189)
+						rgb(189,190,189) rgb(230,230,230);
+}
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/slider/css/bluecurve/handle.horizontal.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/bluecurve/handle.horizontal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/bluecurve/handle.vertical.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/bluecurve/handle.vertical.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/bluecurve/horizontal.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/bluecurve/horizontal.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/bluecurve/vertical.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/bluecurve/vertical.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/boxsizing.htc
===================================================================
--- trunk/Lobby/TASClient/Interface/slider/css/boxsizing.htc	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/slider/css/boxsizing.htc	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,157 @@
+&lt;component lightWeight=&quot;true&quot;&gt;
+&lt;attach event=&quot;onpropertychange&quot; onevent=&quot;checkPropertyChange()&quot; /&gt;
+&lt;attach event=&quot;ondetach&quot; onevent=&quot;restore()&quot; /&gt;
+&lt;script&gt;
+//&lt;![CDATA[
+
+var doc = element.document;
+
+function init() {
+	updateBorderBoxWidth();
+	updateBorderBoxHeight();
+}
+
+function restore() {
+	element.runtimeStyle.width = &quot;&quot;;
+	element.runtimeStyle.height = &quot;&quot;;
+}
+
+/* border width getters */
+function getBorderWidth(sSide) {
+	if (element.currentStyle[&quot;border&quot; + sSide + &quot;Style&quot;] == &quot;none&quot;)
+		return 0;
+	var n = parseInt(element.currentStyle[&quot;border&quot; + sSide + &quot;Width&quot;]);
+	return n || 0;
+}
+
+function getBorderLeftWidth() { return getBorderWidth(&quot;Left&quot;); }
+function getBorderRightWidth() { return getBorderWidth(&quot;Right&quot;); }
+function getBorderTopWidth() { return getBorderWidth(&quot;Top&quot;); }
+function getBorderBottomWidth() { return getBorderWidth(&quot;Bottom&quot;); }
+/* end border width getters */
+
+/* padding getters */
+function getPadding(sSide) {
+	var n = parseInt(element.currentStyle[&quot;padding&quot; + sSide]);
+	return n || 0;
+}
+
+function getPaddingLeft() { return getPadding(&quot;Left&quot;); }
+function getPaddingRight() { return getPadding(&quot;Right&quot;); }
+function getPaddingTop() { return getPadding(&quot;Top&quot;); }
+function getPaddingBottom() { return getPadding(&quot;Bottom&quot;); }
+/* end padding getters */
+
+function getBoxSizing() {
+	var s = element.style;
+	var cs = element.currentStyle
+
+	if (typeof s.boxSizing != &quot;undefined&quot; &amp;&amp; s.boxSizing != &quot;&quot;)
+		return s.boxSizing;
+	if (typeof s[&quot;box-sizing&quot;] != &quot;undefined&quot; &amp;&amp; s[&quot;box-sizing&quot;] != &quot;&quot;)
+		return s[&quot;box-sizing&quot;];
+	if (typeof cs.boxSizing != &quot;undefined&quot; &amp;&amp; cs.boxSizing != &quot;&quot;)
+		return cs.boxSizing;
+	if (typeof cs[&quot;box-sizing&quot;] != &quot;undefined&quot; &amp;&amp; cs[&quot;box-sizing&quot;] != &quot;&quot;)
+		return cs[&quot;box-sizing&quot;];
+	return getDocumentBoxSizing();
+}
+
+function getDocumentBoxSizing() {
+	if (doc.compatMode == null || doc.compatMode == &quot;BackCompat&quot;)
+		return &quot;border-box&quot;;
+	return &quot;content-box&quot;
+}
+
+/* width and height setters */
+function setBorderBoxWidth(n) {
+	element.runtimeStyle.width = Math.max(0, n - getBorderLeftWidth() -
+		getPaddingLeft() - getPaddingRight() - getBorderRightWidth()) + &quot;px&quot;;
+}
+
+function setBorderBoxHeight(n) {
+	element.runtimeStyle.height = Math.max(0, n - getBorderTopWidth() -
+		getPaddingTop() - getPaddingBottom() - getBorderBottomWidth()) + &quot;px&quot;;
+}
+
+function setContentBoxWidth(n) {
+	element.runtimeStyle.width = Math.max(0, n + getBorderLeftWidth() +
+		getPaddingLeft() + getPaddingRight() + getBorderRightWidth()) + &quot;px&quot;;
+}
+
+function setContentBoxHeight(n) {
+	element.runtimeStyle.height = Math.max(0, n + getBorderTopWidth() +
+		getPaddingTop() + getPaddingBottom() + getBorderBottomWidth()) + &quot;px&quot;;
+}
+/* end width and height setters */
+
+function updateBorderBoxWidth() {
+	element.runtimeStyle.width = &quot;&quot;;
+	if (getDocumentBoxSizing() == getBoxSizing())
+		return;
+	var csw = element.currentStyle.width;
+	if (csw != &quot;auto&quot; &amp;&amp; csw.indexOf(&quot;px&quot;) != -1) {
+		if (getBoxSizing() == &quot;border-box&quot;)
+			setBorderBoxWidth(parseInt(csw));
+		else
+			setContentBoxWidth(parseInt(csw));
+	}
+}
+
+function updateBorderBoxHeight() {
+	element.runtimeStyle.height = &quot;&quot;;	
+	if (getDocumentBoxSizing() == getBoxSizing())
+		return;
+	var csh = element.currentStyle.height;
+	if (csh != &quot;auto&quot; &amp;&amp; csh.indexOf(&quot;px&quot;) != -1) {
+		if (getBoxSizing() == &quot;border-box&quot;)
+			setBorderBoxHeight(parseInt(csh));
+		else
+			setContentBoxHeight(parseInt(csh));
+	}
+}
+
+function checkPropertyChange() {
+	var pn = event.propertyName;
+	var undef;
+
+	if (pn == &quot;style.boxSizing&quot; &amp;&amp; element.style.boxSizing == &quot;&quot;) {
+		element.style.removeAttribute(&quot;boxSizing&quot;);
+		element.runtimeStyle.boxSizing = undef;		
+	}
+
+
+	switch (pn) {
+		case &quot;style.width&quot;:
+		case &quot;style.borderLeftWidth&quot;:
+		case &quot;style.borderLeftStyle&quot;:
+		case &quot;style.borderRightWidth&quot;:
+		case &quot;style.borderRightStyle&quot;:
+		case &quot;style.paddingLeft&quot;:
+		case &quot;style.paddingRight&quot;:
+			updateBorderBoxWidth();
+			break;
+		
+		case &quot;style.height&quot;:
+		case &quot;style.borderTopWidth&quot;:
+		case &quot;style.borderTopStyle&quot;:
+		case &quot;style.borderBottomWidth&quot;:
+		case &quot;style.borderBottomStyle&quot;:
+		case &quot;style.paddingTop&quot;:
+		case &quot;style.paddingBottom&quot;:
+			updateBorderBoxHeight();
+			break;
+		
+		case &quot;className&quot;:
+		case &quot;style.boxSizing&quot;:
+			updateBorderBoxWidth();
+			updateBorderBoxHeight();
+			break;
+	}
+}
+
+init();
+
+//]]&gt;
+&lt;/script&gt;
+&lt;/component&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/slider/css/luna/handle.horizontal.hover.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/luna/handle.horizontal.hover.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/luna/handle.horizontal.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/luna/handle.horizontal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/luna/handle.vertical.hover.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/luna/handle.vertical.hover.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/luna/handle.vertical.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/luna/handle.vertical.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/luna/luna.css
===================================================================
--- trunk/Lobby/TASClient/Interface/slider/css/luna/luna.css	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/slider/css/luna/luna.css	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,75 @@
+.dynamic-slider-control {
+	position:			relative;
+	background-color:	ThreeDFace;
+	-moz-user-focus:	normal;
+	-moz-user-select:	none;
+	cursor:				default;
+}
+
+.horizontal {
+	width:				200px;
+	height:				27px;
+}
+
+.vertical {
+	width:				29px;
+	height:				200px;
+}
+
+.dynamic-slider-control input {
+	display:	none;
+}
+
+.dynamic-slider-control .handle {
+	position:			absolute;	
+	font-size:			1px;
+	overflow:			hidden;
+	-moz-user-select:	none;
+	cursor:				default;
+}
+
+.dynamic-slider-control.horizontal .handle {
+	width:				11px;
+	height:				21px;
+	background-image:	url(&quot;handle.horizontal.png&quot;);
+}
+
+.dynamic-slider-control.horizontal .handle div {}
+.dynamic-slider-control.horizontal .handle.hover {
+	background-image:	url(&quot;handle.horizontal.hover.png&quot;);
+}
+
+.dynamic-slider-control.vertical .handle {
+	width:				25px;
+	height:				13px;
+	background-image:	url(&quot;handle.vertical.png&quot;);
+}
+
+.dynamic-slider-control.vertical .handle.hover {
+	background-image:	url(&quot;handle.vertical.hover.png&quot;);
+}
+
+.dynamic-slider-control .line {
+	position:			absolute;
+	font-size:			0.01mm;
+	overflow:			hidden;
+	border:				1px solid;
+	border-color:		ThreeDShadow ThreeDHighlight
+						ThreeDHighlight ThreeDShadow;
+	-moz-border-radius:	50%;
+	
+	behavior:			url(&quot;css/boxsizing.htc&quot;); /* ie path bug */
+	box-sizing:			content-box;
+	-moz-box-sizing:	content-box;
+}
+.dynamic-slider-control.vertical .line {
+	width:				2px;
+}
+
+.dynamic-slider-control.horizontal .line {
+	height:				2px;
+}
+
+.dynamic-slider-control .line div {
+	display:	none;
+}
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/slider/css/swing/handle.horizontal.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/swing/handle.horizontal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/swing/handle.vertical.png
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/slider/css/swing/handle.vertical.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/slider/css/swing/swing.css
===================================================================
--- trunk/Lobby/TASClient/Interface/slider/css/swing/swing.css	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/slider/css/swing/swing.css	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,82 @@
+/*
+	dark rgb(102,102,102)
+	medium	rgb(152,153,153)
+	gray:	rgb(204,204,204)
+	bright: white;
+	*/
+
+.dynamic-slider-control {
+	position:			relative;
+	background-color:	rgb(204,204,204);
+	-moz-user-focus:	normal;
+	-moz-user-select:	none;
+	cursor:				default;
+}
+
+.horizontal {
+	width:				200px;
+	height:				27px;
+}
+
+.vertical {
+	width:				29px;
+	height:				200px;
+}
+
+.dynamic-slider-control input {
+	display:	none;
+}
+
+.dynamic-slider-control .handle {
+	position:			absolute;	
+	font-size:			1px;
+	overflow:			hidden;
+	-moz-user-select:	none;
+	cursor:				default;
+}
+
+.dynamic-slider-control.horizontal .handle {
+	width:				15px;
+	height:				16px;
+	background-image:	url(&quot;handle.horizontal.png&quot;);
+}
+
+.dynamic-slider-control.horizontal .handle div {}
+.dynamic-slider-control.horizontal .handle.hover {}
+
+.dynamic-slider-control.vertical .handle {
+	width:				16px;
+	height:				15px;
+	background-image:	url(&quot;handle.vertical.png&quot;);
+}
+
+.dynamic-slider-control.vertical .handle.hover {}
+
+.dynamic-slider-control .line {
+	position:			absolute;
+	font-size:			0.01mm;
+	overflow:			hidden;
+	border:				1px solid;
+	border-color:		rgb(102,102,102) white
+						white rgb(102,102,102);
+	
+	behavior:			url(&quot;css/boxsizing.htc&quot;); /* ie path bug */
+	box-sizing:			content-box;
+	-moz-box-sizing:	content-box;
+}
+.dynamic-slider-control.vertical .line {
+	width:				4px;
+}
+
+.dynamic-slider-control.horizontal .line {
+	height:				4px;
+}
+
+.dynamic-slider-control .line div {
+	width:		2px;
+	height:		2px;
+	
+	border:				1px solid;
+	border-color:		rgb(152,153,153) rgb(102,102,102)
+						rgb(102,102,102) rgb(152,153,153);
+}
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/slider/css/winclassic.css
===================================================================
--- trunk/Lobby/TASClient/Interface/slider/css/winclassic.css	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/slider/css/winclassic.css	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,95 @@
+.dynamic-slider-control {
+	position:			relative;
+	-moz-user-focus:	normal;
+	-moz-user-select:	none;
+	cursor:				default;
+}
+
+.horizontal {
+	width:				200px;
+	height:				29px;
+}
+
+.vertical {
+	width:				29px;
+	height:				200px;
+}
+
+.dynamic-slider-control input {
+	display:	none;
+}
+
+.dynamic-slider-control .handle {
+	position:			absolute;
+	-moz-user-select:	none;
+	cursor:				default;
+	border:				1px solid;
+	border-color:		#6c4a36;
+	background-color: #6c4a36;
+}
+
+/* inner border */
+.dynamic-slider-control .handle div {
+	font-size:			1px;
+	border:				0px solid;
+	border-color:		#6c4a36;	
+
+	behavior:			url(&quot;css/boxsizing.htc&quot;);	/* ie path bug */
+	box-sizing:			content-box;
+	-moz-box-sizing:	content-box;
+}
+
+/*	inner sets size
+.dynamic-slider-control.horizontal .handle {
+	width:				12px;
+	height:				22px;
+}
+*/
+
+.dynamic-slider-control.horizontal .handle div {
+	width:				8px;
+	height:				18px;
+}
+
+.dynamic-slider-control.horizontal .handle.hover {}
+
+/* inner sets size
+.dynamic-slider-control.vertical .handle {
+	width:				22px;
+	height:				12px;
+}
+*/
+
+.dynamic-slider-control.vertical .handle div {
+	width:				18px;
+	height:				8px;
+}
+
+.dynamic-slider-control.vertical .handle.hover {}
+
+.dynamic-slider-control .line {
+	
+	behavior:			url(&quot;css/boxsizing.htc&quot;); /* ie path bug */
+	box-sizing:			content-box;
+	-moz-box-sizing:	content-box;
+		
+	position:			absolute;
+	font-size:			0.01mm;
+	overflow:			hidden;
+	border:				1px solid;
+	border-color:		#6c4a36;
+	background:			ThreeDDarkShadow;
+}
+
+.dynamic-slider-control.vertical .line {
+	width:				1px;
+	
+}
+
+.dynamic-slider-control.horizontal .line {
+	height:				1px;
+}
+
+.dynamic-slider-control .line div {
+	display:	none;
+}
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/slider/js/range.js
===================================================================
--- trunk/Lobby/TASClient/Interface/slider/js/range.js	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/slider/js/range.js	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,132 @@
+/*----------------------------------------------------------------------------\
+|                                Range Class                                  |
+|-----------------------------------------------------------------------------|
+|                         Created by Erik Arvidsson                           |
+|                  (<A HREF="http://webfx.eae.net/contact.html#erik">http://webfx.eae.net/contact.html#erik</A>)                   |
+|                      For WebFX (<A HREF="http://webfx.eae.net/">http://webfx.eae.net/</A>)                      |
+|-----------------------------------------------------------------------------|
+| Used to  model the data  used  when working  with  sliders,  scrollbars and |
+| progress bars.  Based  on  the  ideas of  the javax.swing.BoundedRangeModel |
+| interface  defined  by  Sun  for  Java;   <A HREF="http://java.sun.com/products/jfc/">http://java.sun.com/products/jfc/</A> |
+| swingdoc-api-1.0.3/com/sun/java/swing/BoundedRangeModel.html                |
+|-----------------------------------------------------------------------------|
+|                Copyright (c) 2002, 2005, 2006 Erik Arvidsson                |
+|-----------------------------------------------------------------------------|
+| Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not |
+| use this file except in compliance with the License.  You may obtain a copy |
+| of the License at <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>                |
+| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
+| Unless  required  by  applicable law or  agreed  to  in  writing,  software |
+| distributed under the License is distributed on an  &quot;AS IS&quot; BASIS,  WITHOUT |
+| WARRANTIES OR  CONDITIONS OF ANY KIND,  either express or implied.  See the |
+| License  for the  specific language  governing permissions  and limitations |
+| under the License.                                                          |
+|-----------------------------------------------------------------------------|
+| 2002-10-14 | Original version released                                      |
+| 2005-10-27 | Use Math.round instead of Math.floor                           |
+| 2006-05-28 | Changed license to Apache Software License 2.0.                |
+|-----------------------------------------------------------------------------|
+| Created 2002-10-14 | All changes are in the log above. | Updated 2006-05-28 |
+\----------------------------------------------------------------------------*/
+
+
+function Range() {
+	this._value = 0;
+	this._minimum = 0;
+	this._maximum = 100;
+	this._extent = 0;
+
+	this._isChanging = false;
+}
+
+Range.prototype.setValue = function (value) {
+	value = Math.round(parseFloat(value));
+	if (isNaN(value)) return;
+	if (this._value != value) {
+		if (value + this._extent &gt; this._maximum)
+			this._value = this._maximum - this._extent;
+		else if (value &lt; this._minimum)
+			this._value = this._minimum;
+		else
+			this._value = value;
+		if (!this._isChanging &amp;&amp; typeof this.onchange == &quot;function&quot;)
+			 this.onchange();
+	}
+};
+
+Range.prototype.getValue = function () {
+	return this._value;
+};
+
+Range.prototype.setExtent = function (extent) {
+	if (this._extent != extent) {
+		if (extent &lt; 0)
+			this._extent = 0;
+		else if (this._value + extent &gt; this._maximum)
+			this._extent = this._maximum - this._value;
+		else
+			this._extent = extent;
+		if (!this._isChanging &amp;&amp; typeof this.onchange == &quot;function&quot;)
+			this.onchange();
+	}
+};
+
+Range.prototype.getExtent = function () {
+	return this._extent;
+};
+
+Range.prototype.setMinimum = function (minimum) {
+	if (this._minimum != minimum) {
+		var oldIsChanging = this._isChanging;
+		this._isChanging = true;
+
+		this._minimum = minimum;
+
+		if (minimum &gt; this._value)
+			this.setValue(minimum);
+		if (minimum &gt; this._maximum) {
+			this._extent = 0;
+			this.setMaximum(minimum);
+			this.setValue(minimum)
+		}
+		if (minimum + this._extent &gt; this._maximum)
+			this._extent = this._maximum - this._minimum;
+
+		this._isChanging = oldIsChanging;
+		if (!this._isChanging &amp;&amp; typeof this.onchange == &quot;function&quot;)
+			this.onchange();
+	}
+};
+
+Range.prototype.getMinimum = function () {
+	return this._minimum;
+};
+
+Range.prototype.setMaximum = function (maximum) {
+	if (this._maximum != maximum) {
+		var oldIsChanging = this._isChanging;
+		this._isChanging = true;
+
+		this._maximum = maximum;
+
+		if (maximum &lt; this._value)
+			this.setValue(maximum - this._extent);
+		if (maximum &lt; this._minimum) {
+			this._extent = 0;
+			this.setMinimum(maximum);
+			this.setValue(this._maximum);
+		}
+		if (maximum &lt; this._minimum + this._extent)
+			this._extent = this._maximum - this._minimum;
+		if (maximum &lt; this._value + this._extent)
+			this._extent = this._maximum - this._value;
+
+		this._isChanging = oldIsChanging;
+		if (!this._isChanging &amp;&amp; typeof this.onchange == &quot;function&quot;)
+			this.onchange();
+	}
+};
+
+Range.prototype.getMaximum = function () {
+	return this._maximum;
+};

Added: trunk/Lobby/TASClient/Interface/slider/js/slider.js
===================================================================
--- trunk/Lobby/TASClient/Interface/slider/js/slider.js	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/slider/js/slider.js	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,489 @@
+/*----------------------------------------------------------------------------\
+|                                Slider 1.02                                  |
+|-----------------------------------------------------------------------------|
+|                         Created by Erik Arvidsson                           |
+|                  (<A HREF="http://webfx.eae.net/contact.html#erik">http://webfx.eae.net/contact.html#erik</A>)                   |
+|                      For WebFX (<A HREF="http://webfx.eae.net/">http://webfx.eae.net/</A>)                      |
+|-----------------------------------------------------------------------------|
+| A  slider  control that  degrades  to an  input control  for non  supported |
+| browsers.                                                                   |
+|-----------------------------------------------------------------------------|
+|                Copyright (c) 2002, 2003, 2006 Erik Arvidsson                |
+|-----------------------------------------------------------------------------|
+| Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not |
+| use this file except in compliance with the License.  You may obtain a copy |
+| of the License at <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>                |
+| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
+| Unless  required  by  applicable law or  agreed  to  in  writing,  software |
+| distributed under the License is distributed on an  &quot;AS IS&quot; BASIS,  WITHOUT |
+| WARRANTIES OR  CONDITIONS OF ANY KIND,  either express or implied.  See the |
+| License  for the  specific language  governing permissions  and limitations |
+| under the License.                                                          |
+|-----------------------------------------------------------------------------|
+| Dependencies: timer.js - an OO abstraction of timers                        |
+|               range.js - provides the data model for the slider             |
+|               winclassic.css or any other css file describing the look      |
+|-----------------------------------------------------------------------------|
+| 2002-10-14 | Original version released                                      |
+| 2003-03-27 | Added a test in the constructor for missing oElement arg       |
+| 2003-11-27 | Only use mousewheel when focused                               |
+| 2006-05-28 | Changed license to Apache Software License 2.0.                |
+|-----------------------------------------------------------------------------|
+| Created 2002-10-14 | All changes are in the log above. | Updated 2006-05-28 |
+\----------------------------------------------------------------------------*/
+
+Slider.isSupported = typeof document.createElement != &quot;undefined&quot; &amp;&amp;
+	typeof document.documentElement != &quot;undefined&quot; &amp;&amp;
+	typeof document.documentElement.offsetWidth == &quot;number&quot;;
+
+
+function Slider(oElement, oInput, sOrientation) {
+	if (!oElement) return;
+	this._orientation = sOrientation || &quot;horizontal&quot;;
+	this._range = new Range();
+	this._range.setExtent(0);
+	this._blockIncrement = 10;
+	this._unitIncrement = 1;
+	this._timer = new Timer(100);
+
+
+	if (Slider.isSupported &amp;&amp; oElement) {
+
+		this.document = oElement.ownerDocument || oElement.document;
+
+		this.element = oElement;
+		this.element.slider = this;
+		this.element.unselectable = &quot;on&quot;;
+
+		// add class name tag to class name
+		this.element.className = this._orientation + &quot; &quot; + this.classNameTag + &quot; &quot; + this.element.className;
+
+		// create line
+		this.line = this.document.createElement(&quot;DIV&quot;);
+		this.line.className = &quot;line&quot;;
+		this.line.unselectable = &quot;on&quot;;
+		this.line.appendChild(this.document.createElement(&quot;DIV&quot;));
+		this.element.appendChild(this.line);
+
+		// create handle
+		this.handle = this.document.createElement(&quot;DIV&quot;);
+		this.handle.className = &quot;handle&quot;;
+		this.handle.unselectable = &quot;on&quot;;
+		this.handle.appendChild(this.document.createElement(&quot;DIV&quot;));
+		this.handle.firstChild.appendChild(
+			this.document.createTextNode(String.fromCharCode(160)));
+		this.element.appendChild(this.handle);
+	}
+
+	this.input = oInput;
+
+	// events
+	var oThis = this;
+	this._range.onchange = function () {
+		oThis.recalculate();
+		if (typeof oThis.onchange == &quot;function&quot;)
+			oThis.onchange();
+	};
+
+	if (Slider.isSupported &amp;&amp; oElement) {
+		this.element.onfocus		= Slider.eventHandlers.onfocus;
+		this.element.onblur			= Slider.eventHandlers.onblur;
+		this.element.onmousedown	= Slider.eventHandlers.onmousedown;
+		this.element.onmouseover	= Slider.eventHandlers.onmouseover;
+		this.element.onmouseout		= Slider.eventHandlers.onmouseout;
+		this.element.onkeydown		= Slider.eventHandlers.onkeydown;
+		this.element.onkeypress		= Slider.eventHandlers.onkeypress;
+		this.element.onmousewheel	= Slider.eventHandlers.onmousewheel;
+		this.handle.onselectstart	=
+		this.element.onselectstart	= function () { return false; };
+
+		this._timer.ontimer = function () {
+			oThis.ontimer();
+		};
+
+		// extra recalculate for ie
+		window.setTimeout(function() {
+			oThis.recalculate();
+		}, 1);
+	}
+	else {
+		this.input.onchange = function (e) {
+			oThis.setValue(oThis.input.value);
+		};
+	}
+}
+
+Slider.eventHandlers = {
+
+	// helpers to make events a bit easier
+	getEvent:	function (e, el) {
+		if (!e) {
+			if (el)
+				e = el.document.parentWindow.event;
+			else
+				e = window.event;
+		}
+		if (!e.srcElement) {
+			var el = e.target;
+			while (el != null &amp;&amp; el.nodeType != 1)
+				el = el.parentNode;
+			e.srcElement = el;
+		}
+		if (typeof e.offsetX == &quot;undefined&quot;) {
+			e.offsetX = e.layerX;
+			e.offsetY = e.layerY;
+		}
+
+		return e;
+	},
+
+	getDocument:	function (e) {
+		if (e.target)
+			return e.target.ownerDocument;
+		return e.srcElement.document;
+	},
+
+	getSlider:	function (e) {
+		var el = e.target || e.srcElement;
+		while (el != null &amp;&amp; el.slider == null)	{
+			el = el.parentNode;
+		}
+		if (el)
+			return el.slider;
+		return null;
+	},
+
+	getLine:	function (e) {
+		var el = e.target || e.srcElement;
+		while (el != null &amp;&amp; el.className != &quot;line&quot;)	{
+			el = el.parentNode;
+		}
+		return el;
+	},
+
+	getHandle:	function (e) {
+		var el = e.target || e.srcElement;
+		var re = /handle/;
+		while (el != null &amp;&amp; !re.test(el.className))	{
+			el = el.parentNode;
+		}
+		return el;
+	},
+	// end helpers
+
+	onfocus:	function (e) {
+		var s = this.slider;
+		s._focused = true;
+		s.handle.className = &quot;handle hover&quot;;
+	},
+
+	onblur:	function (e) {
+		var s = this.slider
+		s._focused = false;
+		s.handle.className = &quot;handle&quot;;
+	},
+
+	onmouseover:	function (e) {
+		e = Slider.eventHandlers.getEvent(e, this);
+		var s = this.slider;
+		if (e.srcElement == s.handle)
+			s.handle.className = &quot;handle hover&quot;;
+	},
+
+	onmouseout:	function (e) {
+		e = Slider.eventHandlers.getEvent(e, this);
+		var s = this.slider;
+		if (e.srcElement == s.handle &amp;&amp; !s._focused)
+			s.handle.className = &quot;handle&quot;;
+	},
+
+	onmousedown:	function (e) {
+		e = Slider.eventHandlers.getEvent(e, this);
+		var s = this.slider;
+		if (s.element.focus)
+			s.element.focus();
+
+		Slider._currentInstance = s;
+		var doc = s.document;
+
+		if (doc.addEventListener) {
+			doc.addEventListener(&quot;mousemove&quot;, Slider.eventHandlers.onmousemove, true);
+			doc.addEventListener(&quot;mouseup&quot;, Slider.eventHandlers.onmouseup, true);
+		}
+		else if (doc.attachEvent) {
+			doc.attachEvent(&quot;onmousemove&quot;, Slider.eventHandlers.onmousemove);
+			doc.attachEvent(&quot;onmouseup&quot;, Slider.eventHandlers.onmouseup);
+			doc.attachEvent(&quot;onlosecapture&quot;, Slider.eventHandlers.onmouseup);
+			s.element.setCapture();
+		}
+
+		if (Slider.eventHandlers.getHandle(e)) {	// start drag
+			Slider._sliderDragData = {
+				screenX:	e.screenX,
+				screenY:	e.screenY,
+				dx:			e.screenX - s.handle.offsetLeft,
+				dy:			e.screenY - s.handle.offsetTop,
+				startValue:	s.getValue(),
+				slider:		s
+			};
+		}
+		else {
+			var lineEl = Slider.eventHandlers.getLine(e);
+			s._mouseX = e.offsetX + (lineEl ? s.line.offsetLeft : 0);
+			s._mouseY = e.offsetY + (lineEl ? s.line.offsetTop : 0);
+			s._increasing = null;
+			s.ontimer();
+		}
+	},
+
+	onmousemove:	function (e) {
+		e = Slider.eventHandlers.getEvent(e, this);
+
+		if (Slider._sliderDragData) {	// drag
+			var s = Slider._sliderDragData.slider;
+
+			var boundSize = s.getMaximum() - s.getMinimum();
+			var size, pos, reset;
+
+			if (s._orientation == &quot;horizontal&quot;) {
+				size = s.element.offsetWidth - s.handle.offsetWidth;
+				pos = e.screenX - Slider._sliderDragData.dx;
+				reset = Math.abs(e.screenY - Slider._sliderDragData.screenY) &gt; 100;
+			}
+			else {
+				size = s.element.offsetHeight - s.handle.offsetHeight;
+				pos = s.element.offsetHeight - s.handle.offsetHeight -
+					(e.screenY - Slider._sliderDragData.dy);
+				reset = Math.abs(e.screenX - Slider._sliderDragData.screenX) &gt; 100;
+			}
+			s.setValue(reset ? Slider._sliderDragData.startValue :
+						s.getMinimum() + boundSize * pos / size);
+			return false;
+		}
+		else {
+			var s = Slider._currentInstance;
+			if (s != null) {
+				var lineEl = Slider.eventHandlers.getLine(e);
+				s._mouseX = e.offsetX + (lineEl ? s.line.offsetLeft : 0);
+				s._mouseY = e.offsetY + (lineEl ? s.line.offsetTop : 0);
+			}
+		}
+
+	},
+
+	onmouseup:	function (e) {
+		e = Slider.eventHandlers.getEvent(e, this);
+		var s = Slider._currentInstance;
+		var doc = s.document;
+		if (doc.removeEventListener) {
+			doc.removeEventListener(&quot;mousemove&quot;, Slider.eventHandlers.onmousemove, true);
+			doc.removeEventListener(&quot;mouseup&quot;, Slider.eventHandlers.onmouseup, true);
+		}
+		else if (doc.detachEvent) {
+			doc.detachEvent(&quot;onmousemove&quot;, Slider.eventHandlers.onmousemove);
+			doc.detachEvent(&quot;onmouseup&quot;, Slider.eventHandlers.onmouseup);
+			doc.detachEvent(&quot;onlosecapture&quot;, Slider.eventHandlers.onmouseup);
+			s.element.releaseCapture();
+		}
+
+		if (Slider._sliderDragData) {	// end drag
+			Slider._sliderDragData = null;
+		}
+		else {
+			s._timer.stop();
+			s._increasing = null;
+		}
+		Slider._currentInstance = null;
+	},
+
+	onkeydown:	function (e) {
+		e = Slider.eventHandlers.getEvent(e, this);
+		//var s = Slider.eventHandlers.getSlider(e);
+		var s = this.slider;
+		var kc = e.keyCode;
+		switch (kc) {
+			case 33:	// page up
+				s.setValue(s.getValue() + s.getBlockIncrement());
+				break;
+			case 34:	// page down
+				s.setValue(s.getValue() - s.getBlockIncrement());
+				break;
+			case 35:	// end
+				s.setValue(s.getOrientation() == &quot;horizontal&quot; ?
+					s.getMaximum() :
+					s.getMinimum());
+				break;
+			case 36:	// home
+				s.setValue(s.getOrientation() == &quot;horizontal&quot; ?
+					s.getMinimum() :
+					s.getMaximum());
+				break;
+			case 38:	// up
+			case 39:	// right
+				s.setValue(s.getValue() + s.getUnitIncrement());
+				break;
+
+			case 37:	// left
+			case 40:	// down
+				s.setValue(s.getValue() - s.getUnitIncrement());
+				break;
+		}
+
+		if (kc &gt;= 33 &amp;&amp; kc &lt;= 40) {
+			return false;
+		}
+	},
+
+	onkeypress:	function (e) {
+		e = Slider.eventHandlers.getEvent(e, this);
+		var kc = e.keyCode;
+		if (kc &gt;= 33 &amp;&amp; kc &lt;= 40) {
+			return false;
+		}
+	},
+
+	onmousewheel:	function (e) {
+		e = Slider.eventHandlers.getEvent(e, this);
+		var s = this.slider;
+		if (s._focused) {
+			s.setValue(s.getValue() + e.wheelDelta / 120 * s.getUnitIncrement());
+			// windows inverts this on horizontal sliders. That does not
+			// make sense to me
+			return false;
+		}
+	}
+};
+
+
+
+Slider.prototype.classNameTag = &quot;dynamic-slider-control&quot;,
+
+Slider.prototype.setValue = function (v) {
+	this._range.setValue(v);
+	this.input.value = this.getValue();
+};
+
+Slider.prototype.getValue = function () {
+	return this._range.getValue();
+};
+
+Slider.prototype.setMinimum = function (v) {
+	this._range.setMinimum(v);
+	this.input.value = this.getValue();
+};
+
+Slider.prototype.getMinimum = function () {
+	return this._range.getMinimum();
+};
+
+Slider.prototype.setMaximum = function (v) {
+	this._range.setMaximum(v);
+	this.input.value = this.getValue();
+};
+
+Slider.prototype.getMaximum = function () {
+	return this._range.getMaximum();
+};
+
+Slider.prototype.setUnitIncrement = function (v) {
+	this._unitIncrement = v;
+};
+
+Slider.prototype.getUnitIncrement = function () {
+	return this._unitIncrement;
+};
+
+Slider.prototype.setBlockIncrement = function (v) {
+	this._blockIncrement = v;
+};
+
+Slider.prototype.getBlockIncrement = function () {
+	return this._blockIncrement;
+};
+
+Slider.prototype.getOrientation = function () {
+	return this._orientation;
+};
+
+Slider.prototype.setOrientation = function (sOrientation) {
+	if (sOrientation != this._orientation) {
+		if (Slider.isSupported &amp;&amp; this.element) {
+			// add class name tag to class name
+			this.element.className = this.element.className.replace(this._orientation,
+									sOrientation);
+		}
+		this._orientation = sOrientation;
+		this.recalculate();
+
+	}
+};
+
+Slider.prototype.recalculate = function() {
+	if (!Slider.isSupported || !this.element) return;
+
+	var w = this.element.offsetWidth;
+	var h = this.element.offsetHeight;
+	var hw = this.handle.offsetWidth;
+	var hh = this.handle.offsetHeight;
+	var lw = this.line.offsetWidth;
+	var lh = this.line.offsetHeight;
+
+	// this assumes a border-box layout
+
+	if (this._orientation == &quot;horizontal&quot;) {
+		this.handle.style.left = (w - hw) * (this.getValue() - this.getMinimum()) /
+			(this.getMaximum() - this.getMinimum()) + &quot;px&quot;;
+		this.handle.style.top = (h - hh) / 2 + &quot;px&quot;;
+
+		this.line.style.top = (h - lh) / 2 + &quot;px&quot;;
+		this.line.style.left = hw / 2 + &quot;px&quot;;
+		//this.line.style.right = hw / 2 + &quot;px&quot;;
+		this.line.style.width = Math.max(0, w - hw - 2)+ &quot;px&quot;;
+		this.line.firstChild.style.width = Math.max(0, w - hw - 4)+ &quot;px&quot;;
+	}
+	else {
+		this.handle.style.left = (w - hw) / 2 + &quot;px&quot;;
+		this.handle.style.top = h - hh - (h - hh) * (this.getValue() - this.getMinimum()) /
+			(this.getMaximum() - this.getMinimum()) + &quot;px&quot;;
+
+		this.line.style.left = (w - lw) / 2 + &quot;px&quot;;
+		this.line.style.top = hh / 2 + &quot;px&quot;;
+		this.line.style.height = Math.max(0, h - hh - 2) + &quot;px&quot;;	//hard coded border width
+		//this.line.style.bottom = hh / 2 + &quot;px&quot;;
+		this.line.firstChild.style.height = Math.max(0, h - hh - 4) + &quot;px&quot;;	//hard coded border width
+	}
+};
+
+Slider.prototype.ontimer = function () {
+	var hw = this.handle.offsetWidth;
+	var hh = this.handle.offsetHeight;
+	var hl = this.handle.offsetLeft;
+	var ht = this.handle.offsetTop;
+
+	if (this._orientation == &quot;horizontal&quot;) {
+		if (this._mouseX &gt; hl + hw &amp;&amp;
+			(this._increasing == null || this._increasing)) {
+			this.setValue(this.getValue() + this.getBlockIncrement());
+			this._increasing = true;
+		}
+		else if (this._mouseX &lt; hl &amp;&amp;
+			(this._increasing == null || !this._increasing)) {
+			this.setValue(this.getValue() - this.getBlockIncrement());
+			this._increasing = false;
+		}
+	}
+	else {
+		if (this._mouseY &gt; ht + hh &amp;&amp;
+			(this._increasing == null || !this._increasing)) {
+			this.setValue(this.getValue() - this.getBlockIncrement());
+			this._increasing = false;
+		}
+		else if (this._mouseY &lt; ht &amp;&amp;
+			(this._increasing == null || this._increasing)) {
+			this.setValue(this.getValue() + this.getBlockIncrement());
+			this._increasing = true;
+		}
+	}
+
+	this._timer.start();
+};
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/slider/js/timer.js
===================================================================
--- trunk/Lobby/TASClient/Interface/slider/js/timer.js	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/slider/js/timer.js	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,62 @@
+/*----------------------------------------------------------------------------\
+|                                 Timer Class                                 |
+|-----------------------------------------------------------------------------|
+|                         Created by Erik Arvidsson                           |
+|                  (<A HREF="http://webfx.eae.net/contact.html#erik">http://webfx.eae.net/contact.html#erik</A>)                   |
+|                      For WebFX (<A HREF="http://webfx.eae.net/">http://webfx.eae.net/</A>)                      |
+|-----------------------------------------------------------------------------|
+| Object Oriented Encapsulation  of setTimeout  fires ontimer when the  timer |
+| is triggered. Does not work in IE 5.00                                      |
+|-----------------------------------------------------------------------------|
+|                   Copyright (c) 2002, 2006 Erik Arvidsson                   |
+|-----------------------------------------------------------------------------|
+| Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not |
+| use this file except in compliance with the License.  You may obtain a copy |
+| of the License at <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>                |
+| - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - |
+| Unless  required  by  applicable law or  agreed  to  in  writing,  software |
+| distributed under the License is distributed on an  &quot;AS IS&quot; BASIS,  WITHOUT |
+| WARRANTIES OR  CONDITIONS OF ANY KIND,  either express or implied.  See the |
+| License  for the  specific language  governing permissions  and limitations |
+| under the License.                                                          |
+|-----------------------------------------------------------------------------|
+| 2002-10-14 | Original version released                                      |
+| 2006-05-28 | Changed license to Apache Software License 2.0.                |
+|-----------------------------------------------------------------------------|
+| Created 2002-10-14 | All changes are in the log above. | Updated 2006-05-28 |
+\----------------------------------------------------------------------------*/
+
+function Timer(nPauseTime) {
+	this._pauseTime = typeof nPauseTime == &quot;undefined&quot; ? 1000 : nPauseTime;
+	this._timer = null;
+	this._isStarted = false;
+}
+
+Timer.prototype.start = function () {
+	if (this.isStarted())
+		this.stop();
+	var oThis = this;
+	this._timer = window.setTimeout(function () {
+		if (typeof oThis.ontimer == &quot;function&quot;)
+			oThis.ontimer();
+	}, this._pauseTime);
+	this._isStarted = false;
+};
+
+Timer.prototype.stop = function () {
+	if (this._timer != null)
+		window.clearTimeout(this._timer);
+	this._isStarted = false;
+};
+
+Timer.prototype.isStarted = function () {
+	return this._isStarted;
+};
+
+Timer.prototype.getPauseTime = function () {
+	return this._pauseTime;
+};
+
+Timer.prototype.setPauseTime = function (nPauseTime) {
+	this._pauseTime = nPauseTime;
+};
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/slider/license.txt
===================================================================
--- trunk/Lobby/TASClient/Interface/slider/license.txt	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/slider/license.txt	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,202 @@
+
+                                 Apache License
+                           Version 2.0, January 2004
+                        <A HREF="http://www.apache.org/licenses/">http://www.apache.org/licenses/</A>
+
+   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
+
+   1. Definitions.
+
+      &quot;License&quot; shall mean the terms and conditions for use, reproduction,
+      and distribution as defined by Sections 1 through 9 of this document.
+
+      &quot;Licensor&quot; shall mean the copyright owner or entity authorized by
+      the copyright owner that is granting the License.
+
+      &quot;Legal Entity&quot; shall mean the union of the acting entity and all
+      other entities that control, are controlled by, or are under common
+      control with that entity. For the purposes of this definition,
+      &quot;control&quot; means (i) the power, direct or indirect, to cause the
+      direction or management of such entity, whether by contract or
+      otherwise, or (ii) ownership of fifty percent (50%) or more of the
+      outstanding shares, or (iii) beneficial ownership of such entity.
+
+      &quot;You&quot; (or &quot;Your&quot;) shall mean an individual or Legal Entity
+      exercising permissions granted by this License.
+
+      &quot;Source&quot; form shall mean the preferred form for making modifications,
+      including but not limited to software source code, documentation
+      source, and configuration files.
+
+      &quot;Object&quot; form shall mean any form resulting from mechanical
+      transformation or translation of a Source form, including but
+      not limited to compiled object code, generated documentation,
+      and conversions to other media types.
+
+      &quot;Work&quot; shall mean the work of authorship, whether in Source or
+      Object form, made available under the License, as indicated by a
+      copyright notice that is included in or attached to the work
+      (an example is provided in the Appendix below).
+
+      &quot;Derivative Works&quot; shall mean any work, whether in Source or Object
+      form, that is based on (or derived from) the Work and for which the
+      editorial revisions, annotations, elaborations, or other modifications
+      represent, as a whole, an original work of authorship. For the purposes
+      of this License, Derivative Works shall not include works that remain
+      separable from, or merely link (or bind by name) to the interfaces of,
+      the Work and Derivative Works thereof.
+
+      &quot;Contribution&quot; shall mean any work of authorship, including
+      the original version of the Work and any modifications or additions
+      to that Work or Derivative Works thereof, that is intentionally
+      submitted to Licensor for inclusion in the Work by the copyright owner
+      or by an individual or Legal Entity authorized to submit on behalf of
+      the copyright owner. For the purposes of this definition, &quot;submitted&quot;
+      means any form of electronic, verbal, or written communication sent
+      to the Licensor or its representatives, including but not limited to
+      communication on electronic mailing lists, source code control systems,
+      and issue tracking systems that are managed by, or on behalf of, the
+      Licensor for the purpose of discussing and improving the Work, but
+      excluding communication that is conspicuously marked or otherwise
+      designated in writing by the copyright owner as &quot;Not a Contribution.&quot;
+
+      &quot;Contributor&quot; shall mean Licensor and any individual or Legal Entity
+      on behalf of whom a Contribution has been received by Licensor and
+      subsequently incorporated within the Work.
+
+   2. Grant of Copyright License. Subject to the terms and conditions of
+      this License, each Contributor hereby grants to You a perpetual,
+      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
+      copyright license to reproduce, prepare Derivative Works of,
+      publicly display, publicly perform, sublicense, and distribute the
+      Work and such Derivative Works in Source or Object form.
+
+   3. Grant of Patent License. Subject to the terms and conditions of
+      this License, each Contributor hereby grants to You a perpetual,
+      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
+      (except as stated in this section) patent license to make, have made,
+      use, offer to sell, sell, import, and otherwise transfer the Work,
+      where such license applies only to those patent claims licensable
+      by such Contributor that are necessarily infringed by their
+      Contribution(s) alone or by combination of their Contribution(s)
+      with the Work to which such Contribution(s) was submitted. If You
+      institute patent litigation against any entity (including a
+      cross-claim or counterclaim in a lawsuit) alleging that the Work
+      or a Contribution incorporated within the Work constitutes direct
+      or contributory patent infringement, then any patent licenses
+      granted to You under this License for that Work shall terminate
+      as of the date such litigation is filed.
+
+   4. Redistribution. You may reproduce and distribute copies of the
+      Work or Derivative Works thereof in any medium, with or without
+      modifications, and in Source or Object form, provided that You
+      meet the following conditions:
+
+      (a) You must give any other recipients of the Work or
+          Derivative Works a copy of this License; and
+
+      (b) You must cause any modified files to carry prominent notices
+          stating that You changed the files; and
+
+      (c) You must retain, in the Source form of any Derivative Works
+          that You distribute, all copyright, patent, trademark, and
+          attribution notices from the Source form of the Work,
+          excluding those notices that do not pertain to any part of
+          the Derivative Works; and
+
+      (d) If the Work includes a &quot;NOTICE&quot; text file as part of its
+          distribution, then any Derivative Works that You distribute must
+          include a readable copy of the attribution notices contained
+          within such NOTICE file, excluding those notices that do not
+          pertain to any part of the Derivative Works, in at least one
+          of the following places: within a NOTICE text file distributed
+          as part of the Derivative Works; within the Source form or
+          documentation, if provided along with the Derivative Works; or,
+          within a display generated by the Derivative Works, if and
+          wherever such third-party notices normally appear. The contents
+          of the NOTICE file are for informational purposes only and
+          do not modify the License. You may add Your own attribution
+          notices within Derivative Works that You distribute, alongside
+          or as an addendum to the NOTICE text from the Work, provided
+          that such additional attribution notices cannot be construed
+          as modifying the License.
+
+      You may add Your own copyright statement to Your modifications and
+      may provide additional or different license terms and conditions
+      for use, reproduction, or distribution of Your modifications, or
+      for any such Derivative Works as a whole, provided Your use,
+      reproduction, and distribution of the Work otherwise complies with
+      the conditions stated in this License.
+
+   5. Submission of Contributions. Unless You explicitly state otherwise,
+      any Contribution intentionally submitted for inclusion in the Work
+      by You to the Licensor shall be under the terms and conditions of
+      this License, without any additional terms or conditions.
+      Notwithstanding the above, nothing herein shall supersede or modify
+      the terms of any separate license agreement you may have executed
+      with Licensor regarding such Contributions.
+
+   6. Trademarks. This License does not grant permission to use the trade
+      names, trademarks, service marks, or product names of the Licensor,
+      except as required for reasonable and customary use in describing the
+      origin of the Work and reproducing the content of the NOTICE file.
+
+   7. Disclaimer of Warranty. Unless required by applicable law or
+      agreed to in writing, Licensor provides the Work (and each
+      Contributor provides its Contributions) on an &quot;AS IS&quot; BASIS,
+      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
+      implied, including, without limitation, any warranties or conditions
+      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
+      PARTICULAR PURPOSE. You are solely responsible for determining the
+      appropriateness of using or redistributing the Work and assume any
+      risks associated with Your exercise of permissions under this License.
+
+   8. Limitation of Liability. In no event and under no legal theory,
+      whether in tort (including negligence), contract, or otherwise,
+      unless required by applicable law (such as deliberate and grossly
+      negligent acts) or agreed to in writing, shall any Contributor be
+      liable to You for damages, including any direct, indirect, special,
+      incidental, or consequential damages of any character arising as a
+      result of this License or out of the use or inability to use the
+      Work (including but not limited to damages for loss of goodwill,
+      work stoppage, computer failure or malfunction, or any and all
+      other commercial damages or losses), even if such Contributor
+      has been advised of the possibility of such damages.
+
+   9. Accepting Warranty or Additional Liability. While redistributing
+      the Work or Derivative Works thereof, You may choose to offer,
+      and charge a fee for, acceptance of support, warranty, indemnity,
+      or other liability obligations and/or rights consistent with this
+      License. However, in accepting such obligations, You may act only
+      on Your own behalf and on Your sole responsibility, not on behalf
+      of any other Contributor, and only if You agree to indemnify,
+      defend, and hold each Contributor harmless for any liability
+      incurred by, or claims asserted against, such Contributor by reason
+      of your accepting any such warranty or additional liability.
+
+   END OF TERMS AND CONDITIONS
+
+   APPENDIX: How to apply the Apache License to your work.
+
+      To apply the Apache License to your work, attach the following
+      boilerplate notice, with the fields enclosed by brackets &quot;[]&quot;
+      replaced with your own identifying information. (Don't include
+      the brackets!)  The text should be enclosed in the appropriate
+      comment syntax for the file format. We also recommend that a
+      file or class name and description of purpose be included on the
+      same &quot;printed page&quot; as the copyright notice for easier
+      identification within third-party archives.
+
+   Copyright [yyyy] [name of copyright owner]
+
+   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
+   you may not use this file except in compliance with the License.
+   You may obtain a copy of the License at
+
+       <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.

Added: trunk/Lobby/TASClient/Interface/spin_control_buttons.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/spin_control_buttons.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/spin_control_buttons_box.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/spin_control_buttons_box.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/spincontrol/javascript.js
===================================================================
--- trunk/Lobby/TASClient/Interface/spincontrol/javascript.js	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/spincontrol/javascript.js	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,527 @@
+function hookEvent(element, eventName, callback)
+{
+  if(typeof(element) == &quot;string&quot;)
+    element = document.getElementById(element);
+  if(element == null)
+    return;
+  if(element.addEventListener)
+  {
+    element.addEventListener(eventName, callback, false);
+  }
+  else if(element.attachEvent)
+    element.attachEvent(&quot;on&quot; + eventName, callback);
+}
+
+function unhookEvent(element, eventName, callback)
+{
+  if(typeof(element) == &quot;string&quot;)
+    element = document.getElementById(element);
+  if(element == null)
+    return;
+  if(element.removeEventListener)
+    element.removeEventListener(eventName, callback, false);
+  else if(element.detachEvent)
+    element.detachEvent(&quot;on&quot; + eventName, callback);
+}
+
+function getEventTarget(e)
+{
+  e = e ? e : window.event;
+  return e.target ? e.target : e.srcElement;
+}
+
+function cancelEvent(e)
+{
+  e = e ? e : window.event;
+  if(e.stopPropagation)
+    e.stopPropagation();
+  if(e.preventDefault)
+    e.preventDefault();
+  e.cancelBubble = true;
+  e.cancel = true;
+  e.returnValue = false;
+  return false;
+}
+
+function SpinControlAcceleration(increment, milliseconds)
+{
+  increment = parseFloat(increment);
+  if(isNaN(increment) || increment &lt; 0)
+    increment = 0;
+
+  milliseconds = parseInt(milliseconds);
+  if(isNaN(milliseconds) || milliseconds &lt; 0)
+    milliseconds = 0;
+
+  this.GetIncrement = function()
+  { return increment; }
+
+  this.GetMilliseconds = function()
+  { return milliseconds; }
+}
+
+function SpinControlAccelerationCollection()
+{
+  var _array = new Array();
+
+  this.GetCount = function()
+  { return _array.length; }
+
+  this.GetIndex = function(index)
+  {
+    if(index &lt; 0 || index &gt;= _array.length)
+      return null;
+
+    return _array[index];
+  }
+
+  this.RemoveIndex = function(index)
+  {
+    if(index &lt; 0 || index &gt;= _array.length)
+      return;
+
+    newArray = new Array();
+    for(var i=0; i&lt;_array.length; i++)
+    {
+      if(i == index)
+        continue;
+      newArray.push(_array[i]);
+    }
+    _array = newArray;
+  }
+
+  this.Clear = function()
+  {
+    _array = new Array();
+  }
+
+  this.Add = function(spa)
+  {
+    if(spa.constructor != SpinControlAcceleration)
+      return;
+
+    if(_array.length == 0)
+    {
+      _array.push(spa);
+      return;
+    }
+
+    var newSec = spa.GetMilliseconds();
+    if(newSec &gt; _array[_array.length-1].GetMilliseconds())
+    {
+      _array.push(spa);
+      return;
+    }
+
+    var added = false;
+    var newArray = new Array();
+    var indexSec;
+    for(var i=0; i&lt;_array.length; i++)
+    {
+      if(added)
+      {
+        newArray.push(_array[i]);
+      }
+      else
+      {
+        indexSec = _array[i].GetMilliseconds();
+        if(indexSec &lt; newSec)
+        {
+          newArray.push(_array[i]);
+        }
+        else if(indexSec == newSec)
+        {
+          newArray.push(spa);
+          added = true;
+        }
+        else
+        {
+          newArray.push(_array[i]);
+          newArray.push(spa);
+          added = true;
+        }
+      }
+    }
+    _array = newArray;
+    return;
+  }
+}
+
+function SpinControl()
+{
+  var _this = this;
+
+  var _accelerationCollection = new SpinControlAccelerationCollection();
+  var _callbackArray = new Array();
+  var _currentValue = 1;
+  var _maximumVal = 100;
+  var _minimumVal = 0;
+  var _increment = 1;
+  var _width = 50;
+
+  var _running = 0;
+  var _interval = -1;
+  var _timeStart = 0;
+
+  var _bodyEventHooked = false;
+
+  var _container = document.createElement(&quot;DIV&quot;);
+  _container.className = 'spinContainer';
+
+  var _textBox = document.createElement(&quot;INPUT&quot;);
+  _textBox.type = 'text';
+  _textBox.className = 'spinInput';
+  _textBox.value = _currentValue;
+
+  var _upButton = document.createElement(&quot;DIV&quot;);
+  _upButton.className = 'spinUpBtn';
+
+  var _downButton = document.createElement(&quot;DIV&quot;);
+  _downButton.className = 'spinDownBtn';
+
+  /*
+   * Because IE 6 and lower don't support the transparent png background
+   * mask that we use for the buttons.
+   * So we use a regular old gif instead.
+   * This means that, sadly, the button coloring does not work in IE6 and lower.
+   */
+  var canChangeBtnColors = true;
+  if(document.body.filters)
+  {
+    var arVersion = navigator.appVersion.split(&quot;MSIE&quot;);
+    var version = parseFloat(arVersion[1]);
+    if(version &lt; 7)
+    {
+      canChangeBtnColors = false;
+      _downButton.style.backgroundColor = '#FFFFFF';
+      _upButton.style.backgroundColor = '#FFFFFF';
+    }
+  }
+
+  _container.appendChild(_textBox);
+  _container.appendChild(_upButton);
+  _container.appendChild(_downButton);
+
+  function Run()
+  {
+    if(_running == 0)
+      return;
+
+    var elapsed = new Date().getTime() - _timeStart;
+    var inc = _increment;
+
+    if(_accelerationCollection.GetCount() != 0)
+    {
+      inc = 0;
+      for(var i = 0; i&lt;_accelerationCollection.GetCount(); i++)
+      {
+        if(elapsed &lt; _accelerationCollection.GetIndex(i).GetMilliseconds())
+          break;
+
+        inc = _accelerationCollection.GetIndex(i).GetIncrement();
+      }
+    }
+    else if(elapsed &lt; 600)
+    {
+      return;
+    }
+
+    DoChange(inc);
+  }
+
+  function CancelRunning()
+  {
+    _running = 0;
+    if(_interval != -1)
+    {
+      clearInterval(_interval);
+      _interval = -1;
+    }
+  }
+
+  function DoChange(inc)
+  {
+    var newVal = _currentValue + inc * _running;
+    UpdateCurrentValue(newVal);
+  }
+
+  function StartRunning(newState)
+  {
+    if(_running != 0)
+      CancelRunning();
+
+    _running = newState;
+
+    DoChange(_increment);
+
+    _timeStart = new Date().getTime();
+    _interval = setInterval(Run, 150);
+  }
+
+  function UpdateCurrentValue(newVal)
+  {
+    if(newVal &lt;_minimumVal)
+      newVal = _minimumVal;
+    if(newVal &gt; _maximumVal)
+      newVal = _maximumVal;
+
+    newVal = Math.round(1000*newVal)/1000;
+
+    _textBox.value = newVal;
+    if(newVal == _currentValue)
+      return;
+
+    _currentValue = newVal;
+
+    for(var i=0; i&lt;_callbackArray.length; i++)
+      _callbackArray[i](_this, _currentValue);
+  }
+
+  function UpPress(e)
+  {
+    _upButton.className = 'spinUpBtnPress';
+    _downButton.className = 'spinDownBtn';
+    StartRunning(1);
+    _textBox.focus();
+    return cancelEvent(e);
+  }
+
+  function DownPress(e)
+  {
+    _upButton.className = 'spinUpBtn';
+    _downButton.className = 'spinDownBtnPress';
+    StartRunning(-1);
+    _textBox.focus();
+    return cancelEvent(e);
+  }
+
+  function UpHover(e)
+  {
+    if(!_bodyEventHooked)
+      hookEvent(document.body, 'mouseover', ClearBtns);
+
+    _upButton.className = 'spinUpBtnHover';
+    _downButton.className = 'spinDownBtn';
+    CancelRunning();
+    //return cancelEvent(e);
+  }
+
+  function DownHover(e)
+  {
+    if(!_bodyEventHooked)
+      hookEvent(document.body, 'mouseover', ClearBtns);
+
+    _upButton.className = 'spinUpBtn';
+    _downButton.className = 'spinDownBtnHover';
+    CancelRunning();
+    //return cancelEvent(e);
+  }
+
+  function ClearBtns(e)
+  {
+    var target = getEventTarget(e);
+    if(target == _upButton || target == _downButton)
+      return;
+    _upButton.className = 'spinUpBtn';
+    _downButton.className = 'spinDownBtn';
+    CancelRunning();
+
+    if(_bodyEventHooked)
+    {
+      unhookEvent(document.body, 'mouseover', ClearBtns);
+      _bodyEventHooked = false;
+    }
+    return cancelEvent(e);
+  }
+
+  function BoxChange()
+  {
+    var val = parseFloat(_textBox.value);
+    if(isNaN(val))
+      val = _currentValue;
+
+    UpdateCurrentValue(val);
+  }
+
+  function MouseWheel(e)
+  {
+    e = e ? e : window.event;
+    var movement = e.detail ? e.detail / -3 : e.wheelDelta/120;
+    UpdateCurrentValue(_currentValue + _increment * movement);
+    return cancelEvent(e);
+  }
+
+  function TextFocused(e)
+  {
+    hookEvent(window, 'DOMMouseScroll', MouseWheel);
+    hookEvent(document, 'mousewheel', MouseWheel);
+    return cancelEvent(e);
+  }
+
+  function TextBlur(e)
+  {
+    unhookEvent(window, 'DOMMouseScroll', MouseWheel);
+    unhookEvent(document, 'mousewheel', MouseWheel);
+    return cancelEvent(e);
+  }
+
+  this.StartListening = function()
+  {
+    hookEvent(_upButton, 'mousedown', UpPress);
+    hookEvent(_upButton, 'mouseup', UpHover);
+    hookEvent(_upButton, 'mouseover', UpHover);
+
+    hookEvent(_downButton, 'mousedown', DownPress);
+    hookEvent(_downButton, 'mouseup', DownHover);
+    hookEvent(_downButton, 'mouseover', DownHover);
+
+    hookEvent(_textBox, 'change', BoxChange);
+    hookEvent(_textBox, 'focus', TextFocused);
+    hookEvent(_textBox, 'blur', TextBlur);
+  }
+
+  this.StopListening = function()
+  {
+    unhookEvent(_upButton, 'mousedown', UpPress);
+    unhookEvent(_upButton, 'mouseup', UpHover);
+    unhookEvent(_upButton, 'mouseover', UpHover);
+
+    unhookEvent(_downButton, 'mousedown', DownPress);
+    unhookEvent(_downButton, 'mouseup', DownHover);
+    unhookEvent(_downButton, 'mouseover', DownHover);
+
+    unhookEvent(_textBox, 'change', BoxChange);
+    unhookEvent(_textBox, 'focus', TextFocused);
+    unhookEvent(_textBox, 'blur', TextBlur);
+
+    if(_bodyEventHooked)
+    {
+      unhookEvent(document.body, 'mouseover', ClearBtns);
+      _bodyEventHooked = false;
+    }
+  }
+
+  this.SetMaxValue = function(value)
+  {
+     value = parseFloat(value);
+     if(isNaN(value))
+       value = 1;
+     _maximumVal = value;
+
+    UpdateCurrentValue(_currentValue);
+  }
+
+  this.SetMinValue = function(value)
+  {
+     value = parseFloat(value);
+     if(isNaN(value))
+       value = 0;
+     _minimumVal = value;
+
+    UpdateCurrentValue(_currentValue);
+  }
+
+  this.SetCurrentValue = function(value)
+  {
+    value = parseFloat(value);
+    if(isNaN(value))
+      value = 0;
+
+    UpdateCurrentValue(value);
+  }
+
+  this.SetWidth = function(value)
+  {
+    value = parseInt(value);
+    if(isNaN(value) || value &lt; 25)
+      value = 25;
+
+    _width = value;
+
+    _container.style.width = _width + 'px';
+    _textBox.style.width = (_width - 20) + 'px';
+  }
+
+  this.SetIncrement = function(value)
+  {
+    value = parseFloat(value);
+    if(isNaN(value))
+      value = 0;
+    if(value &lt; 0)
+      value = -value;
+
+    _increment = value;
+  }
+
+  this.SetBackgroundColor = function(color)
+  {
+    _container.style.backgroundColor = color;
+    _textBox.style.backgroundColor = color;
+  }
+
+  this.SetButtonColor = function(color)
+  {
+    if(!canChangeBtnColors)
+      return;
+
+    _upButton.style.backgroundColor = color;
+    _downButton.style.backgroundColor = color;
+  }
+
+  this.SetFontColor = function(color)
+  {
+    _textBox.style.color = color;
+  }
+
+  this.SetBorderColor = function(color)
+  {
+  }
+
+  this.AttachValueChangedListener = function(listener)
+  {
+    for(var i=0; i&lt;_callbackArray.length; i++)
+      if(_callbackArray[i] == listener)
+        return;
+
+    _callbackArray.push(listener);
+  }
+
+  this.DetachValueChangedListener = function(listener)
+  {
+    newArray = new Array();
+    for(var i=0; i&lt;_callbackArray.length; i++)
+      if(_callbackArray[i] != listener)
+        newArray.push(_callbackArray[i]);
+
+    _callbackArray = newArray;
+  }
+
+  this.GetUpButton = function()
+  { return _upButton; }
+
+  this.GetInputBox = function()
+  { return _textBox; }
+
+  this.GetContainer = function()
+  { return _container; }
+
+  this.GetCurrentValue = function()
+  { return _currentValue; }
+
+  this.GetMaxValue = function()
+  { return _maximumVal; }
+
+  this.GetMinValue = function()
+  { return _minimumVal; }
+
+  this.GetWidth = function()
+  { return _width; }
+
+  this.GetIncrement = function()
+  { return _increment; }
+
+  this.GetAccelerationCollection = function()
+  { return _accelerationCollection; }
+
+  _this.SetWidth(_width);
+}
\ No newline at end of file

Added: trunk/Lobby/TASClient/Interface/spincontrol/spin_control_buttons.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/spincontrol/spin_control_buttons.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/spincontrol/spin_control_buttons_box.gif
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/Interface/spincontrol/spin_control_buttons_box.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/Interface/spincontrol/style.css
===================================================================
--- trunk/Lobby/TASClient/Interface/spincontrol/style.css	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/spincontrol/style.css	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,95 @@
+.spinInput, .spinContainer
+{
+  /* Change this to modify the default spin control background color*/
+  background-color: transparent;
+  border: 1px solid #6c4a36;
+  margin: 1px;
+  padding: 0;
+}
+
+.spinBox .spinInput, .spinBox .spinContainer
+{
+  border: 1px solid black;
+}
+
+.spinContainer
+{
+  font-size: 0px;
+  height: 18px;
+}
+
+.spinInput
+{
+  float:left;
+  top: 1px;
+  left: 2px;
+  height: 17px;
+  border: 0px;
+  /* Change this to modify the default spin control font, font color, and font size*/
+  color: #6c4a36;
+  font-size: 9pt;
+  font-family: Arial;
+}
+
+.spinBox .spinInput
+{
+  color: black;
+  border: 0px;
+}
+
+.spinUpBtn, .spinUpBtnHover, .spinUpBtnPress, .spinDownBtn, .spinDownBtnHover, .spinDownBtnPress
+{
+  float:left;
+  width: 15px;
+  height: 8px;
+  right: 2px;
+  background-image: url('spin_control_buttons.gif');
+  background-repeat: no-repeat;
+  /* Change this to modify the default button color*/
+  background-color: #000000;
+}
+
+.spinBox .spinUpBtn, .spinBox .spinUpBtnHover, .spinBox .spinUpBtnPress, .spinBox .spinDownBtn, .spinBox .spinDownBtnHover, .spinBox .spinDownBtnPress
+{
+  background-image: url('spin_control_buttons_box.gif');
+}
+
+.spinUpBtn, .spinUpBtnHover, .spinUpBtnPress
+{
+  top: 2px;
+}
+
+.spinDownBtn, .spinDownBtnHover, .spinDownBtnPress
+{
+  top: 10px;
+}
+
+.spinUpBtn
+{
+  background-position:0px 0px;
+}
+
+.spinUpBtnHover
+{
+  background-position:0px -16px;
+}
+
+.spinUpBtnPress
+{
+  background-position:0px -32px;
+}
+
+.spinDownBtn
+{
+  background-position:0px -8px;
+}
+
+.spinDownBtnHover
+{
+  background-position:0px -24px;
+}
+
+.spinDownBtnPress
+{
+  background-position:0px -40px;
+}

Added: trunk/Lobby/TASClient/Interface/unitItem.html
===================================================================
--- trunk/Lobby/TASClient/Interface/unitItem.html	                        (rev 0)
+++ trunk/Lobby/TASClient/Interface/unitItem.html	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1 @@
+&lt;input type=&quot;checkbox&quot; id=&quot;unitItem[unitId]&quot; onclick=&quot;if ( document.getElementById('unitItem[unitId]').checked ) {sendData('disableunit:[unitId]');}else{ sendData('enableunit:[unitId]'); }&quot; [luaOptionValue] /&gt; [unitName] &lt;br/&gt;
\ No newline at end of file

Added: trunk/Lobby/TASClient/IntfDocHostUIHandler.pas
===================================================================
--- trunk/Lobby/TASClient/IntfDocHostUIHandler.pas	                        (rev 0)
+++ trunk/Lobby/TASClient/IntfDocHostUIHandler.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,375 @@
+{
+  This demo application accompanies the article
+  &quot;How to customise the TWebBrowser user interface&quot; on
+  <A HREF="http://www.delphidabbler.com/articles?article=18.">http://www.delphidabbler.com/articles?article=18.</A>
+
+  The demo implements the 2nd phase of the sample application presented in the
+  article. It mimics a dialog box that uses the web browser control. The browser
+  takes on the appearance of the dialog box.
+
+  This code is copyright (c) P D Johnson (www.delphidabbler.com), 2004-2006.
+
+  v1.0 of 2004/11/30 - original version
+  v1.1 of 2006/02/06 - tweaked code layout
+}
+
+
+{$A8,B-,C+,D+,E-,F-,G+,H+,I+,J-,K-,L+,M-,N+,O+,P+,Q-,R-,S-,T-,U-,V+,W-,X+,Y+,Z1}
+{$WARN UNSAFE_TYPE OFF}
+
+
+unit IntfDocHostUIHandler;
+
+interface
+
+uses
+  // Delphi
+  Windows, ActiveX;
+
+
+const
+
+  {
+    Set of flags that indicate the capabilities of an IDocHostUIHandler
+    implementation and are used in a TDocHostUIInfo record.
+  }
+  DOCHOSTUIFLAG_DIALOG                      = $00000001;
+    {Disables selection of text in form}
+  DOCHOSTUIFLAG_DISABLE_HELP_MENU           = $00000002;
+    {MSHTML does not add the Help menu item to the container's menu}
+  DOCHOSTUIFLAG_NO3DBORDER                  = $00000004;
+    {MSHTML does not use 3-D borders on any frames or framesets. To turn the
+    border off on only the outer frameset use DOCHOSTUIFLAG_NO3DOUTERBORDER}
+  DOCHOSTUIFLAG_SCROLL_NO                   = $00000008;
+    {MSHTML does not have scroll bars}
+  DOCHOSTUIFLAG_DISABLE_SCRIPT_INACTIVE     = $00000010;
+    {MSHTML does not execute any script when loading pages}
+  DOCHOSTUIFLAG_OPENNEWWIN                  = $00000020;
+    {MSHTML opens a site in a new window when a link is clicked rather than
+    browse to the new site using the same browser window}
+  DOCHOSTUIFLAG_DISABLE_OFFSCREEN           = $00000040;
+    {Not implemented}
+  DOCHOSTUIFLAG_FLAT_SCROLLBAR              = $00000080;
+    {MSHTML uses flat scroll bars for any user interface (UI) it displays}
+  DOCHOSTUIFLAG_DIV_BLOCKDEFAULT            = $00000100;
+    {MSHTML inserts the div tag if a return is entered in edit mode. Without
+    this flag, MSHTML will use the p tag}
+  DOCHOSTUIFLAG_ACTIVATE_CLIENTHIT_ONLY     = $00000200;
+    {MSHTML only becomes UI active if the mouse is clicked in the client area of
+    the window. It does not become UI active if the mouse is clicked on a
+    nonclient area, such as a scroll bar}
+  DOCHOSTUIFLAG_OVERRIDEBEHAVIORFACTORY     = $00000400;
+    {MSHTML consults the host before retrieving a behavior from the URL
+    specified on the page. If the host does not support the behavior, MSHTML
+    does not proceed to query other hosts or instantiate the behavior itself,
+    even for behaviors developed in script (HTML Components (HTCs))}
+  DOCHOSTUIFLAG_CODEPAGELINKEDFONTS         = $00000800;
+    {IE5 or later. Provides font selection compatibility for Outlook Express. If
+    the flag is enabled, the displayed characters are inspected to determine
+    whether the current font supports the code page. If disabled, the current
+    font is used, even if it does not contain a glyph for the character. This
+    flag assumes that the user is using IE5 and OE4.0}
+  DOCHOSTUIFLAG_URL_ENCODING_DISABLE_UTF8   = $00001000;
+    {IE5 or later. Controls how nonnative URLs are transmitted over the
+    Internet. Nonnative refers to characters outside the multibyte encoding of
+    the URL. If this flag is set, the URL is not submitted to the server in
+    UTF-8 encoding}
+  DOCHOSTUIFLAG_URL_ENCODING_ENABLE_UTF8    = $00002000;
+    {IE5 or later. Controls how nonnative URLs are transmitted over the
+    Internet. Nonnative refers to characters outside the multibyte encoding of
+    the URL. If this flag is set, the URL is submitted to the server in
+    UTF-8 encoding}
+  DOCHOSTUIFLAG_ENABLE_FORMS_AUTOCOMPLETE   = $00004000;
+    {IE5 or later. This flag enables the AutoComplete feature for forms in the
+    hosted browser. The Intelliforms feature is only turned on if the user has
+    previously enabled it. If the user has turned the AutoComplete feature off
+    for forms, it is off whether this flag is specified or not}
+  DOCHOSTUIFLAG_ENABLE_INPLACE_NAVIGATION   = $00010000;
+    {IE5 or later. This flag enables the host to specify that navigation should
+    happen in place. This means that applications hosting MSHTML directly can
+    specify that navigation happen in the application's window. For instance,
+    if this flag is set, you can click a link in HTML mail and navigate in the
+    mail instead of opening a new IE window}
+  DOCHOSTUIFLAG_IME_ENABLE_RECONVERSION     = $00020000;
+    {IE5 or later. During initialization, the host can set this flag to enable
+    Input Method Editor (IME) reconversion, allowing computer users to employ
+    IME reconversion while browsing Web pages}
+  DOCHOSTUIFLAG_THEME                       = $00040000;
+    {IE6 or later. Specifies that the hosted browser should use themes for pages
+    it displays}
+  DOCHOSTUIFLAG_NOTHEME                     = $00080000;
+    {IE6 or later. Specifies that the hosted browser should not use themes for
+    pages it displays}
+  DOCHOSTUIFLAG_NOPICS                      = $00100000;
+    {IE6 or later. Disables PICS ratings for the hosted browser}
+  DOCHOSTUIFLAG_NO3DOUTERBORDER             = $00200000;
+    {IE6 or later. Turns off any 3-D border on the outermost frame or frameset
+    only. To turn borders off on all frame sets, use DOCHOSTUIFLAG_NO3DBORDER}
+  // *** query these values
+  DOCHOSTUIFLAG_DISABLE_EDIT_NS_FIXUP       = $1;
+    {IE6 or later. Disables the automatic correction of namespaces when editing
+    HTML elements}
+  DOCHOSTUIFLAG_LOCAL_MACHINE_ACCESS_CHECK  = $1;
+    {IE6 or later. Prevents Web sites in the Internet zone from accessing files
+    in the Local Machine zone}
+  DOCHOSTUIFLAG_DISABLE_UNTRUSTEDPROTOCOL   = $1;
+    {IE6 or later. Turns off untrusted protocols. Untrusted protocols include
+    ms-its, ms-itss, its, and mk:@msitstore}
+
+  {
+    Set of values used to indicate the proper action on a double-click event.
+    Used in a TDocHostUIInfo record.
+  }
+  DOCHOSTUIDBLCLK_DEFAULT         = 0;
+    {Perform the default action}
+  DOCHOSTUIDBLCLK_SHOWPROPERTIES  = 1;
+    {Show the item's properties}
+  DOCHOSTUIDBLCLK_SHOWCODE        = 2;
+    {Show the page's source}
+
+  {
+    Values that that indicate the type of user interface. Used in
+    IDocHostUIHandler.ShowUI method.
+  }
+  DOCHOSTUITYPE_BROWSE = 0;
+    {Indicates the user interface is for browsing}
+  DOCHOSTUITYPE_AUTHOR = 1;
+    {Value that indicates the user interface is for authoring}
+
+
+type
+
+  {
+  TDocHostUIInfo:
+    Used by the IDocHostUIHandler.GetHostInfo method to allow MSHTML to
+    retrieve information about the host's UI requirements.
+  }
+  TDocHostUIInfo = record
+    cbSize: ULONG;
+      {size of structure in bytes}
+    dwFlags: DWORD;
+      {one or more DOCHOSTUIFLAG_* flags that specify UI capabilitiess of host}
+    dwDoubleClick: DWORD;
+      {a DOCHOSTUIDBLCLK_* value that specifies operation in response to a
+      double-click}
+    pchHostCss: PWChar;
+      {pointer to set of CSS rules set by host}
+    pchHostNS: PWChar;
+      {pointer to a ';' delimited namespace list that allows declaration of
+      namespaces for custom tags on the page}
+  end;
+
+  {
+  PDocHostUIInfo:
+    Pointer to TDocHostUIInfo record.
+  }
+  PDocHostUIInfo = ^TDocHostUIInfo;
+
+  {
+  IDocHostUIHandler:
+    This custom interface enables an application hosting the WebBrowser Control
+    or automating IE to replace the menus, toolbars, and context menus used by
+    MSHTML.
+  }
+  IDocHostUIHandler = interface(IUnknown)
+    ['{bd3f23c0-d43e-11cf-893b-00aa00bdce1a}']
+    function ShowContextMenu(const dwID: DWORD; const ppt: PPOINT;
+      const pcmdtReserved: IUnknown; const pdispReserved: IDispatch): HResult;
+      stdcall;
+      {Called by MSHTML to display a shortcut menu.
+        @param dwID [in] specifies identifier of the shortcut menu to be
+          displayed. This identifier is a bitwise shift of the value 0x1 by the
+          shortcut menu values (e.g., CONTEXT_MENU_DEFAULT) defined in
+          Mshtmhst.h. Values are:
+            $02 value of (0x1 shl CONTEXT_MENU_DEFAULT)
+            $04 value of (0x1 shl CONTEXT_MENU_CONTROL)
+            $08 value of (0x1 shl CONTEXT_MENU_TABLE)
+            $10 value of (0x1 shl CONTEXT_MENU_TEXTSELECT)
+            $30 value of (0x1 shl CONTEXT_MENU_ANCHOR)
+            $20 value of (0x1 shl CONTEXT_MENU_UNKNOWN).
+        @param ppt [in] pointer to POINT structure containing screen coordinates
+          for the menu.
+        @param pcmdtReserved [in] IUnknown interface of an IOleCommandTarget
+          interface used to query command status and execute commands on this
+          object.
+        @param pdispReserved [in] IDispatch interface of the object at the
+          screen coordinates specified in ppt. This allows a host to
+          differentiate particular objects to provide more specific context. In
+          IE 4.0 this parameter supplied no information, but in IE5 and later
+          the parameter contains an IDispatch interface.
+        @return S_OK if host displayed its own user interface (UI). MSHTML will
+          not attempt to display its UI; S_FALSE if host did not display any UI.
+          MSHTML will display its UI pr DOCHOST_E_UNKNOWN Menu identifier is
+          unknown. MSHTML may attempt an alternative identifier from a previous
+          version.
+      }
+    function GetHostInfo(var pInfo: TDocHostUIInfo): HResult; stdcall;
+      {Called by MSHTML to retrieve the user interface (UI) capabilities and
+      requirement of the application that is hosting MSHTML. Various aspects of
+      MSHTML can be controlled. For example:
+        + The browser's 3-D border can be disabled.
+        + The browser's scroll bars can be disabled or change their appearance
+          can be changed.
+        + Scripts can be disabled.
+        + Handling of double-clicks can be modified.
+        @param pInfo [in, out] reference to a TDocHostUIInfo structure that
+          receives the host's UI capabilities.
+        @return S_OK if successful, or an error value otherwise or if we don't
+          make any changes to pInfo.
+      }
+    function ShowUI(const dwID: DWORD;
+      const pActiveObject: IOleInPlaceActiveObject;
+      const pCommandTarget: IOleCommandTarget; const pFrame: IOleInPlaceFrame;
+      const pDoc: IOleInPlaceUIWindow): HResult; stdcall;
+      {Called by MSHTML to enable the host to replace MSHTML menus and toolbars
+      etc. If the host uses any of the interfaces handed to it by this function,
+      the host should call the interface's AddRef method to save the interface
+      for later use. If the host calls the interface's AddRef method, the host
+      must also call the interface's Release method when the interface is no
+      longer required.
+        @param dwID [in] receives a DOCHOSTUITYPE_* value indicating the type of
+          user interface (UI).
+        @param pActiveObject [in] IOleInPlaceActiveObject interface reference
+          for the active object.
+        @param pCommandTarget [in] IOleCommandTarget interface for the object.
+        @pFrame [in] IOleInPlaceFrame interface for the object. Menus and
+          toolbars must use this parameter.
+        @param pDoc [in] an IOleInPlaceUIWindow interface for the object.
+          Toolbars must use this parameter.
+        @return S_OK if host displayed its own UI (MSHTML will not display its
+          UI); S_FALSE if host did not display its own UI (MSHTML will display
+          its UI) or DOCHOST_E_UNKNOWN if host did not recognize the UI
+          identifier. MSHTML will either try an alternative identifier for
+          compatibility with a previous version or display its own UI.
+      }
+    function HideUI: HResult; stdcall;
+      {Called when MSHTML removes its menus and toolbars. If a host displayed
+      menus and toolbars during the call to ShowUI, it should remove them when
+      this method is called. This method is called regardless of the return
+      value from ShowUI.
+        @return S_OK on success or error value on failure.
+      }
+    function UpdateUI: HResult; stdcall;
+      {Called by MSHTML to notify the host that the command state has changed.
+      The host should update the state of toolbar buttons in an implementation
+      of this method. This method is called regardless of the return value from
+      the IDocHostUIHandler.ShowUI method.
+        @return S_OK on success or error value on failure.
+      }
+    function EnableModeless(const fEnable: BOOL): HResult; stdcall;
+      {Called by the MSHTML implementation of IOleInPlaceActiveObject.
+      EnableModeless. Also called when MSHTML displays a modal UI.
+        @param fEnable [in] indicates if the host's modeless dialog boxes are
+          enabled (true) or disabled (false).
+        @return S_OK on success or error value on failure.
+      }
+    function OnDocWindowActivate(const fActivate: BOOL): HResult; stdcall;
+      {Called by the MSHTML implementation of IOleInPlaceActiveObject.
+      OnDocWindowActivate when the document window is activated or deactivated.
+        @param fActivate [in] indicates the state of the document window: true
+          if the window is being activated and false if the window is being
+          deactivated.
+        @return S_OK on success or error value on failure.
+      }
+    function OnFrameWindowActivate(const fActivate: BOOL): HResult; stdcall;
+      {Called by the MSHTML implementation of IOleInPlaceActiveObject.
+      OnFrameWindowActivate when the top-level frame window is activated or
+      deactivated.
+        @param fActivate [in] indicates the state of the container's top-level
+          frame window: true if the window is being activated and false if the
+          window is being deactivated.
+        @return S_OK on success or error value on failure.
+      }
+    function ResizeBorder(const prcBorder: PRECT;
+      const pUIWindow: IOleInPlaceUIWindow; const fFrameWindow: BOOL): HResult;
+      stdcall;
+      {Called by the MSHTML implementation of IOleInPlaceActiveObject.
+      ResizeBorder called when a frame or document's window's border is about to
+      be changed.
+        @param prcBorder [in] Constant pointer to a RECT for the new outer
+          rectangle of the border.
+        @param pUIWindow [in] reference to an IOleInPlaceUIWindow interface for
+          the frame or document window whose border is to be changed.
+        @param fFrameWindow [in] flag True if the frame window is calling
+          IDocHostUIHandler.ResizeBorder, or FALSE otherwise.
+        @return S_OK on success or error value on failure.
+      }
+    function TranslateAccelerator(const lpMsg: PMSG; const pguidCmdGroup: PGUID;
+      const nCmdID: DWORD): HResult; stdcall;
+      {Called by MSHTML when IOleInPlaceActiveObject.TranslateAccelerator or
+      IOleControlSite.TranslateAccelerator is called. When accelerator keys such
+      as TAB are used, the default host behavior may need to be overridden.
+        @param lpMsg [in] pointer to a MSG structure that specifies the message
+          to be translated.
+        @param pguidCmdGroup [in] pointer to a GUID for the command group
+          identifier.
+        @param nCmdID [in] specifies a command identifier.
+        @return S_OK on success or error value on failure. Return S_FALSE if
+          we override behaviour.
+      }
+    function GetOptionKeyPath(var pchKey: POLESTR; const dw: DWORD ): HResult;
+      stdcall;
+      {Called by the WebBrowser Control to retrieve a registry subkey path that
+      overrides the default IE registry settings. If S_FALSE is returned or if
+      the registry key path returned in pchKey is NULL or empty, the WebBrowser
+      Control reverts to the default Internet Explorer registry settings.
+        @param pchKey [out] POLESTR that receives the registry subkey string
+          where the host stores its registry settings.
+        @param dw [in] reserved. Always 0.
+        @return S_OK if successful, S_FALSE to use default registry setting,
+          or an error value otherwise.
+      }
+    function GetDropTarget(const pDropTarget: IDropTarget;
+      out ppDropTarget: IDropTarget): HResult; stdcall;
+      {Called by MSHTML when it is used as a drop target and enables the host to
+      supply an alternative IDropTarget interface.
+        @param pDropTarget [in] pointer to an IDropTarget interface for the
+          current drop target object supplied by MSHTML.
+        @param ppDropTarget [out] address of a pointer variable that receives an
+          IDropTarget interface pointer for the alternative drop target object
+          supplied by the host. If we don't provide an alternative drop target
+          we must return a failure code such as E_NOTIMPL or E_FAIL.
+        @return S_OK if successful, or an error value otherwise.
+      }
+    function GetExternal(out ppDispatch: IDispatch): HResult; stdcall;
+      {Called by MSHTML to obtain the host's IDispatch interface. If the host
+      exposes an automation interface, it can provide a reference to it to
+      MSHTML in this method. Used to enable the browser to call methods in the
+      host.
+        @param ppDispatch [out] address of a pointer to a variable that receives
+          an IDispatch interface pointer for the host application. Must be set
+          to not if we don't supply an IDispatch interface even if the method
+          fails or returns S_FALSE.
+        @return S_OK if successful, or an error value otherwise.
+      }
+    function TranslateUrl(const dwTranslate: DWORD; const pchURLIn: POLESTR;
+      var ppchURLOut: POLESTR): HResult; stdcall;
+      {Called by MSHTML to give the host an opportunity to modify the URL to be
+      loaded.
+        @param dwTranslate [in] reserved. Always 0.
+        @param pchURLIn [in] pointer to OLE string that specifies the current
+          URL for navigation.
+        @param ppchURLOut [out] address of a pointer variable that receives an
+          OLE string pointer containing the new URL. The buffer pointed to by
+          ppchURLOut should be allocated using CoTaskMemAlloc. If the
+          implementation of this method does not supply a URL, ppchURLOut should
+          be set to nil, even if the method fails or returns S_FALSE.
+        @return S_OK if URL was translated, or S_FALSE if not.
+      }
+    function FilterDataObject(const pDO: IDataObject;
+      out ppDORet: IDataObject): HResult; stdcall;
+      {Called by MSHTML to allow the host to replace the MSHTML data object. It
+      enables the host to block certain clipboard formats or support additional
+      clipboard formats.
+        @param pDO [in] pointer to an IDataObject interface supplied by MSHTML.
+        @param ppDORet [out] sddress of a pointer variable that receives an
+          IDataObject interface pointer supplied by the host. Must be set to nil
+          if we don't supply a IDataObject, even if we fail or return S_FALSE.
+        @return S_OK if the data object is replaced, or S_FALSE if not.
+      }
+    end;
+
+implementation
+
+end.
+

Modified: trunk/Lobby/TASClient/MainUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/MainUnit.dfm	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/MainUnit.dfm	2008-06-25 20:00:37 UTC (rev 6074)
@@ -1,6 +1,6 @@
 object MainForm: TMainForm
-  Left = 412
-  Top = 200
+  Left = 567
+  Top = 372
   Width = 808
   Height = 549
   Caption = '.'
@@ -1052,9 +1052,9 @@
           Visible = False
         end
         object OptionsSpeedButton: TSpTBXSpeedButton
-          Left = 288
+          Left = 328
           Top = 8
-          Width = 97
+          Width = 81
           Height = 25
           Caption = 'Options'
           OnClick = OptionsSpeedButtonClick
@@ -1067,7 +1067,7 @@
         object BattleScreenSpeedButton: TSpTBXSpeedButton
           Left = 64
           Top = 8
-          Width = 97
+          Width = 81
           Height = 25
           Caption = 'Host battle'
           DropDownMenu = HostBattlePopupMenu
@@ -1079,9 +1079,9 @@
           ThemeType = thtTBX
         end
         object HelpButton: TSpTBXSpeedButton
-          Left = 400
+          Left = 416
           Top = 8
-          Width = 97
+          Width = 81
           Height = 25
           Caption = 'Help / Links'
           DropDownMenu = HelpPopupMenu
@@ -1092,9 +1092,9 @@
           LinkFont.Style = [fsUnderline]
         end
         object ReplaysButton: TSpTBXSpeedButton
-          Left = 176
+          Left = 240
           Top = 8
-          Width = 97
+          Width = 81
           Height = 25
           Hint = 
             'Every game you play or spectate are saved so you can re watch th' +
@@ -1110,9 +1110,9 @@
           LinkFont.Style = [fsUnderline]
         end
         object SearchButton: TSpTBXSpeedButton
-          Left = 512
+          Left = 504
           Top = 8
-          Width = 97
+          Width = 81
           Height = 25
           Hint = 'Search for maps, mods and scripts'
           Caption = 'Search files'
@@ -1141,6 +1141,20 @@
           TabOrder = 5
           OnClick = ConnectButtonClick
         end
+        object SinglePlayerButton: TSpTBXButton
+          Left = 152
+          Top = 8
+          Width = 81
+          Height = 25
+          Caption = 'Single Player'
+          TabOrder = 6
+          OnClick = SinglePlayerButtonClick
+          LinkFont.Charset = DEFAULT_CHARSET
+          LinkFont.Color = clBlue
+          LinkFont.Height = -11
+          LinkFont.Name = 'MS Sans Serif'
+          LinkFont.Style = [fsUnderline]
+        end
       end
       object PageControl1: TPageControl
         Left = 2

Modified: trunk/Lobby/TASClient/MainUnit.pas
===================================================================
--- trunk/Lobby/TASClient/MainUnit.pas	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/MainUnit.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -200,7 +200,7 @@
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, ExtCtrls, StdCtrls, ComCtrls, Buttons, Menus, Grids, ValEdit,
-  VirtualTrees, ImgList, WSocket, StringParser, MMSystem, Utility, AppEvnts, Math,
+  VirtualTrees, ImgList, WSocket, StringParser, MMSystem, AppEvnts, Math,
   HttpProt, GraphicEx, Registry, JvComponent, JvBaseDlg, JvDesktopAlert,
   JvDesktopAlertForm, DateUtils, Winsock, TBXToolPals, SpTBXItem, TB2Item,
   TBX, SpTBXControls, TBXDkPanels, SpTBXFormPopupMenu,IniFiles,StrUtils,
@@ -830,7 +830,7 @@
     procedure NextHighlight;
   end;
 
-  TScript = class // note: any TScript's method will raise an exception if something goes wrong
+  TTDFParser = class
   protected
     FScript: string;
     CompleteKeyList: TStrings;
@@ -844,7 +844,23 @@
   public
     constructor Create(Script: string);
     destructor Destroy; override;
-    function DoesTokenExist(Token: string): Boolean;
+    procedure ParseScript;
+    function GetSubKeys(completeKey: string):TStrings;
+    function GetBruteScript:String; // DEBUG METHOD
+    function ReadKeyValue(completeKey: string):String;
+    procedure AddOrChangeKeyValue(completeKey: String; value: String);
+    procedure RemoveKey(completeKey: String);
+    function isCorrupted: boolean;
+
+    property Script: string read GetScript write SetScript;
+  end;
+
+  TScript = class(TTDFParser) // note: any TScript's method will raise an exception if something goes wrong
+  protected
+    { empty }
+  public
+    constructor Create(Script: string);
+    destructor Destroy; override;
     function ReadMapName: string;
     function ReadModName: string;
     function ReadStartMetal: Integer;
@@ -856,20 +872,11 @@
     function ReadDiminishingMMs: Boolean;
     function ReadGhostedBuildings: Boolean;
     function ReadDisabledUnits: TStringList;
-    procedure ParseScript;
-    function GetSubKeys(completeKey: string):TStrings;
-    function GetBruteScript:String; // DEBUG METHOD
-    function ReadKeyValue(completeKey: string):String;
     procedure ChangeHostIP(NewIP: string);
     procedure ChangeHostPort(NewPort: string);
     procedure ChangeMyPlayerNum(NewNum: Integer);
     procedure ChangeNumPlayers(NewNum: Integer);
-    procedure AddOrChangeKeyValue(completeKey: String; value: String);
-    procedure RemoveKey(completeKey: String);
     procedure TryToRemoveUDPSourcePort;
-    function isCorrupted: boolean;
-
-    property Script: string read GetScript write SetScript;
   end;
 
   TReplay = class
@@ -1083,6 +1090,7 @@
     btDeletePreset: TSpTBXButton;
     btSavePreset: TSpTBXButton;
     PresetNameTextbox: TSpTBXEdit;
+    SinglePlayerButton: TSpTBXButton;
     procedure mnuOpenPrivateChatClick(Sender: TObject);
     procedure mnuSelectBattleClick(Sender: TObject);
     procedure SpTBXItem1Click(Sender: TObject);
@@ -1205,6 +1213,7 @@
     procedure PresetListboxClick(Sender: TObject);
     procedure btDeletePresetClick(Sender: TObject);
     procedure btClearPresetClick(Sender: TObject);
+    procedure SinglePlayerButtonClick(Sender: TObject);
 
   published
     MainTitleBar: TSpTBXTitleBar;
@@ -1557,6 +1566,8 @@
   displayingNotificationList: TList;
 
   RunningUnderWine: Boolean = False; // set via -wine argument to the program
+  RunningWithMainMenu: Boolean = False; // set via -menu argument to the program
+
   MyInternetIp: String;
 
   JoinAsSpectator : Boolean;
@@ -1574,7 +1585,7 @@
   HostBattleFormUnit, AgreementUnit, PerformFormUnit, HighlightingUnit,
   IgnoreListUnit, MuteListFormUnit, MapListFormUnit, SplashScreenUnit,
   LoginProgressFormUnit, GpIFF, SearchFormUnit, ManageGroups, ColorPicker,
-  AwayMessageFormUnit,JclStrings, SearchPlayerFormUnit;
+  AwayMessageFormUnit,JclStrings, SearchPlayerFormUnit, MenuFormUnit, Utility;
 
 {$R *.dfm}
 
@@ -2774,6 +2785,11 @@
 
 constructor TScript.Create(Script: string);
 begin
+  inherited;
+end;
+
+constructor TTDFParser.Create(Script: string);
+begin
   inherited Create;
   FScript := Script;
   FUpperCaseScript := UpperCase(Script);
@@ -2786,27 +2802,27 @@
 
 destructor TScript.Destroy;
 begin
+  inherited;
+end;
+
+destructor TTDFParser.Destroy;
+begin
   CompleteKeyList.Free;
   CompleteOriginalKeyList.Free;
   KeyValueList.Free;
   inherited Destroy;
 end;
 
-procedure TScript.SetScript(Script: string);
+procedure TTDFParser.SetScript(Script: string);
 begin
   FScript := Script;
   FUpperCaseScript := UpperCase(Script);
+  CompleteKeyList.Clear;
+  CompleteOriginalKeyList.Clear;
+  KeyValueList.Clear;
   self.ParseScript;
 end;
 
-function TScript.DoesTokenExist(Token: string): Boolean;
-var
-  i: Integer;
-begin
-  i := Pos(UpperCase(Token), FUpperCaseScript);
-  Result := i &gt; 0;
-end;
-
 function TScript.ReadMapName: string;
 begin
   Result := ReadKeyValue('GAME/MAPNAME');
@@ -3023,7 +3039,7 @@
   KeyValueList[i] := IntToStr(NewNum);
 end;
 
-procedure TScript.AddOrChangeKeyValue(completeKey: String; value: String);
+procedure TTDFParser.AddOrChangeKeyValue(completeKey: String; value: String);
 var
   i: Integer;
 begin
@@ -3038,7 +3054,7 @@
   end;
 end;
 
-procedure TScript.RemoveKey(completeKey: String);
+procedure TTDFParser.RemoveKey(completeKey: String);
 var
   i: Integer;
   subKeys: TStrings;
@@ -3064,12 +3080,12 @@
   RemoveKey('GAME/SOURCEPORT');
 end;
 
-function TScript.isCorrupted: boolean;
+function TTDFParser.isCorrupted: boolean;
 begin
   Result := self.Corrupted;
 end;
 
-procedure TScript.ParseScript;
+procedure TTDFParser.ParseScript;
 var
   currentCompleteKey: TStrings;
   lineScript: TStrings;
@@ -3109,7 +3125,7 @@
   lineScript.Free;
 end;
 
-function TScript.GetSubKeys(completeKey: string):TStrings;
+function TTDFParser.GetSubKeys(completeKey: string):TStrings;
 var
   i,j: Integer;
   sl1: TStrings;
@@ -3128,7 +3144,7 @@
   sl2.Free;
 end;
 
-function TScript.GetBruteScript:String;// DEBUG METHOD
+function TTDFParser.GetBruteScript:String;// DEBUG METHOD
 var
   i: integer;
 begin
@@ -3137,7 +3153,7 @@
     Result := Result + CompleteKeyList[i]+'='+KeyValueList[i]+EOL;
 end;
 
-function TScript.GetScript:String;
+function TTDFParser.GetScript:String;
 var
   ScriptLines: TStrings;
   writtenKeys: TStrings;
@@ -3150,7 +3166,7 @@
   writtenKeys.Free;
 end;
 
-procedure TScript.WriteScriptKeys(f: TStrings; completeKey: String;writtenKeys: TStrings; headWrite: Boolean);
+procedure TTDFParser.WriteScriptKeys(f: TStrings; completeKey: String;writtenKeys: TStrings; headWrite: Boolean);
 var
   sl1: TStrings;
   sl2: TStrings;
@@ -3193,7 +3209,7 @@
   sl2.Free;
 end;
 
-function TScript.ReadKeyValue(completeKey: string):String;
+function TTDFParser.ReadKeyValue(completeKey: string):String;
 var
   i: integer;
 begin
@@ -3526,6 +3542,14 @@
     // finally apply post-initialization preferences:
     PreferencesForm.ApplyPostInitializationPreferences;
 
+    if RunningWithMainMenu then
+    begin
+      SplashScreenForm.UpdateText('loading menu ...');
+      HttpGetForm.SevenZip1.SZFileName := 'default.ssk';
+      HttpGetForm.SevenZip1.ExtrBaseDir := GetEnvironmentVariable('TEMP')+'\tasclientgui';
+      HttpGetForm.SevenZip1.Extract(false);
+    end;
+
     // hide splash screen:
     SplashScreenForm.Close;
     FreeAndNil(SplashScreenForm);
@@ -3538,7 +3562,7 @@
     SearchFormPopupMenu.PopupForm := SearchForm;
     SearchPlayerFormPopupMenu.PopupForm := SearchPlayerForm;
 
-    if Preferences.ConnectOnStartup then PostMessage(MainForm.Handle, WM_CONNECT, 0, 0);
+    if Preferences.ConnectOnStartup and  not RunningWithMainMenu then PostMessage(MainForm.Handle, WM_CONNECT, 0, 0);
 
     OnlineMapsUnit.TReadCacheThrd.Create(False); // start reading online maps from cache
     ReplaysUnit.TReadReplaysThrd.Create(False); // start reading replays from disk
@@ -3552,7 +3576,10 @@
     ReplaysForm.UpdateReplayFilters;
 
     // finally:
-    MainForm.Visible := True;
+    if RunningWithMainMenu then
+      MenuForm.Show
+    else
+      MainForm.Visible := True;
 
     // check new version
     if Preferences.CheckForNewVersion then
@@ -10156,4 +10183,11 @@
   PresetListbox.Selected[0] := true;
 end;
 
+procedure TMainForm.SinglePlayerButtonClick(Sender: TObject);
+begin
+  TryToDisconnect;
+  MainForm.Hide;
+  MenuForm.Show;
+end;
+
 end.

Modified: trunk/Lobby/TASClient/MapListFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/MapListFormUnit.dfm	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/MapListFormUnit.dfm	2008-06-25 20:00:37 UTC (rev 6074)
@@ -1,6 +1,6 @@
 object MapListForm: TMapListForm
-  Left = 386
-  Top = 459
+  Left = 688
+  Top = 354
   Width = 646
   Height = 400
   Caption = 'Map list'

Modified: trunk/Lobby/TASClient/MapListFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/MapListFormUnit.pas	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/MapListFormUnit.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -1171,8 +1171,13 @@
 end;
 
 procedure TMapListForm.FormShow(Sender: TObject);
+var
+  i: integer;
 begin
   txtSearch.Text := '';
+  BattleForm.SetRadioItem(SortStylePopupMenu, Preferences.MapSortStyle);
+  SortLabel.Caption := SortStylePopupMenu.Items[Preferences.MapSortStyle].Caption;
+
   FilterMapList('');
   txtSearch.SetFocus;
 end;

Added: trunk/Lobby/TASClient/MenuFormUnit.ddp
===================================================================
(Binary files differ)


Property changes on: trunk/Lobby/TASClient/MenuFormUnit.ddp
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/Lobby/TASClient/MenuFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/MenuFormUnit.dfm	                        (rev 0)
+++ trunk/Lobby/TASClient/MenuFormUnit.dfm	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,92 @@
+object MenuForm: TMenuForm
+  Left = 842
+  Top = 165
+  BorderStyle = bsNone
+  Caption = 'MenuForm'
+  ClientHeight = 671
+  ClientWidth = 907
+  Color = clBtnFace
+  Font.Charset = DEFAULT_CHARSET
+  Font.Color = clWindowText
+  Font.Height = -11
+  Font.Name = 'MS Sans Serif'
+  Font.Style = []
+  OldCreateOrder = False
+  Position = poDefault
+  Scaled = False
+  WindowState = wsMaximized
+  OnClose = FormClose
+  OnCreate = FormCreate
+  OnShow = FormShow
+  PixelsPerInch = 96
+  TextHeight = 13
+  object Minimap: TImage
+    Left = 24
+    Top = 40
+    Width = 73
+    Height = 97
+    Visible = False
+  end
+  object htmlBrowserControl: TWebBrowser
+    Left = 0
+    Top = 0
+    Width = 907
+    Height = 671
+    Align = alClient
+    TabOrder = 0
+    OnBeforeNavigate2 = htmlBrowserControlBeforeNavigate2
+    OnNewWindow2 = htmlBrowserControlNewWindow2
+    OnNavigateComplete2 = htmlBrowserControlNavigateComplete2
+    OnDocumentComplete = htmlBrowserControlDocumentComplete
+    ControlData = {
+      4C000000BE5D00005A4500000000000000000000000000000000000000000000
+      000000004C000000000000000000000001000000E0D057007335CF11AE690800
+      2B2E126208000000000000004C0000000114020000000000C000000000000046
+      8000000000000000000000000000000000000000000000000000000000000000
+      00000000000000000100000000000000000000000000000000000000}
+  end
+  object MP1: TMediaPlayer
+    Left = 184
+    Top = 176
+    Width = 253
+    Height = 33
+    Visible = False
+    TabOrder = 1
+  end
+  object MP2: TMediaPlayer
+    Left = 184
+    Top = 216
+    Width = 253
+    Height = 33
+    Visible = False
+    TabOrder = 2
+  end
+  object GameTimer: TTimer
+    Enabled = False
+    Interval = 200
+    OnTimer = GameTimerTimer
+    Left = 560
+    Top = 428
+  end
+  object tmrMusic: TTimer
+    Interval = 500
+    OnTimer = tmrMusicTimer
+    Left = 88
+    Top = 112
+  end
+  object SevenZip1: TSevenZip
+    SFXCreate = False
+    SFXModule = '7z.sfx'
+    AddOptions = []
+    ExtractOptions = []
+    LZMACompressType = LZMA
+    LZMACompressStrength = SAVE
+    LZMAStrength = 0
+    LPPMDmem = 0
+    LPPMDsize = 0
+    NumberOfFiles = -1
+    VolumeSize = 0
+    Left = 312
+    Top = 88
+  end
+end

Added: trunk/Lobby/TASClient/MenuFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/MenuFormUnit.pas	                        (rev 0)
+++ trunk/Lobby/TASClient/MenuFormUnit.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,1777 @@
+unit MenuFormUnit;
+
+interface
+
+uses
+  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
+  Dialogs, OleCtrls, SHDocVw,UWebBrowserWrapper,UContainer, StdCtrls,StrUtils,
+  ExtCtrls,class_TIntegerList, MPlayer,MainUnit, SevenZipVCL,Contnrs;
+
+type
+  TPageType = (Main, CampaignsMenu,Campaign, CampaignMission, MissionsMenu, Mission, Skirmish, Loading);
+
+  TMission =
+  record
+    FileName: string;
+    UseHTML: boolean;
+    descriptor: TTDFParser;
+  end;
+
+  TCampaign =
+  record
+    FileName: string;
+    descriptor: TTDFParser;
+  end;
+
+  TAIItem =
+  record
+    AIType: string;
+    Id: integer;
+    Team: integer;
+    Side: integer;
+    StartPosX: double;
+    StartPosY: double;
+    Handicap: integer;
+    Name: string;
+  end;
+
+  TBrowsePage =
+  record
+    PageName: string;
+    PageType: TPageType;
+  end;
+
+  TMenuForm = class(TForm)
+    htmlBrowserControl: TWebBrowser;
+    Minimap: TImage;
+    GameTimer: TTimer;
+    MP1: TMediaPlayer;
+    MP2: TMediaPlayer;
+    tmrMusic: TTimer;
+    SevenZip1: TSevenZip;
+    procedure CreateParams(var Params: TCreateParams); override;
+    procedure FormClose(Sender: TObject; var Action: TCloseAction);
+    procedure FormCreate(Sender: TObject);
+    procedure FormShow(Sender: TObject);
+    procedure htmlBrowserControlBeforeNavigate2(Sender: TObject;
+      const pDisp: IDispatch; var URL, Flags, TargetFrameName, PostData,
+      Headers: OleVariant; var Cancel: WordBool);
+    procedure htmlBrowserControlNavigateComplete2(Sender: TObject;
+      const pDisp: IDispatch; var URL: OleVariant);
+    procedure GameTimerTimer(Sender: TObject);
+    procedure tmrMusicTimer(Sender: TObject);
+    procedure htmlBrowserControlNewWindow2(Sender: TObject;
+      var ppDisp: IDispatch; var Cancel: WordBool);
+    procedure htmlBrowserControlDocumentComplete(Sender: TObject;
+      const pDisp: IDispatch; var URL: OleVariant);
+  private
+    HookID: THandle;
+    AutorisedURLFiles: TStringList;
+    MenuCurrentPath: String;
+    MissionCurrentPath: string;
+    CampaignCurrentPath: string;
+    CurrentPath: string;
+    CurrentMissionIndex: integer;
+    CurrentCampaignIndex: integer;
+    CurrentCampaignMission: TMission;
+    CurrentWinStep: string;
+    CurrentLostStep: string;
+    BrowseHistory: TStack;
+    soundValue: string;
+
+    springExeVersion: string;
+    mapListHtmlCode: string;
+    selectedMap: integer;
+    mapWidthPercent: integer;
+    mapHeightPercent: integer;
+    minimapFixedStartSize: integer;
+    paramName: TStringList;
+    paramValues: TStringList;
+    ColorsList: TStringList;
+    idBots: integer;
+    freeIds: TIntegerList;
+
+    StartMetal: integer;
+    StartEnergy: integer;
+    MaxUnits: integer;
+    GameMode: integer;
+    GameType: integer;
+    LimitDGun: Boolean;
+    GhostedB: Boolean;
+    DiminishMM: Boolean;
+    LoadingMessage: string;
+    DisabledUnitList: TStringList;
+
+    MissionList: TList;
+    CampaignList: TList;
+
+    MePlayer:
+    record
+      Id: integer;
+      Team: integer;
+      Side: integer;
+      StartPosX: double;
+      StartPosY: double;
+      Handicap: integer;
+    end;
+    AIPlayerList: TList;
+
+    Process: // we need this information when we launch game exe
+    record
+      proc_info: TProcessInformation;
+      startinfo: TStartupInfo;
+      ExitCode: LongWord;
+    end;
+
+    procedure SaveIERegistry;
+    function LoadMapListHtmlCode: string;
+    function GetLuaHtmlCode(options: TList): String;
+    procedure ColorCallBack(const AName: String);
+    function getBotIndex(id: integer): integer;
+    procedure LoadMissions;
+    procedure LoadCampaigns;
+  public
+    htmlBrowser: TWebBrowserWrapper;
+    htmlContainer: TWBContainer;
+
+    procedure LoadMenu(fileName: string;pageType: TPageType);
+    function replaceParams(code: string;fileName: string):string;
+    procedure SaveMinimapToFile;
+    procedure StartSkirmish;
+    procedure StartMission;
+    function GenerateScript(FileName: string):boolean;
+    procedure ExtractMissionFiles(FileName: string);
+    procedure ExtractCampaignFiles(FileName: string);
+    function playerHasWon(scriptFileName: string): boolean;
+  end;
+
+var
+  MenuForm: TMenuForm;
+
+implementation
+
+uses PreferencesFormUnit,Utility,Misc,MapListFormUnit,Registry,
+  BattleFormUnit, MinimapZoomedFormUnit, AddBotUnit, Math;
+
+{$R *.dfm}
+
+// disable the refresh on F5 on the webbrowser
+function KeyProc(nCode: Integer; wParam, lParam: Longint): Longint; stdcall;
+begin
+  case nCode &lt; 0 of
+    True:
+      Result := CallNextHookEx(MenuForm.HookID, nCode, wParam, lParam)
+      else
+        case wParam of
+          VK_F5:
+            begin
+              if MenuForm.Active and (MenuForm.ActiveControl = MenuForm.htmlBrowserControl) then
+                Result := HC_SKIP
+              else
+                Result := CallNextHookEx(MenuForm.HookID, nCode, wParam, lParam);
+            end
+            else
+              Result := CallNextHookEx(MenuForm.HookID, nCode, wParam, lParam);
+        end;
+  end;
+end;
+
+procedure TMenuForm.CreateParams(var Params: TCreateParams);
+begin
+  inherited CreateParams(Params);
+
+  with Params do
+  begin
+    ExStyle := ExStyle or WS_EX_APPWINDOW;
+    WndParent := GetDesktopWindow;
+  end;
+end;
+
+procedure TMenuForm.FormClose(Sender: TObject; var Action: TCloseAction);
+begin
+  SaveToRegOnExit := true;
+  MainForm.Close;
+end;
+
+procedure TMenuForm.FormCreate(Sender: TObject);
+var
+  i: integer;
+begin
+  paramName := TStringList.Create;
+  paramValues := TStringList.Create;
+  ColorsList := TStringList.Create;
+  AIPlayerList := TList.Create;
+  DisabledUnitList := TStringList.Create;
+  freeIds := TIntegerList.Create;
+  MissionList := TList.Create;
+  CampaignList := TList.Create;
+  CurrentCampaignMission.descriptor := TTDFParser.Create('');
+  BrowseHistory := TStack.Create;
+
+  for i:=1 to 15 do
+    freeIds.Add(i);
+
+  GetColorValues(ColorCallBack);
+
+  AddBotForm.ReloadButtonClick(nil);
+
+  soundValue := Misc.GetRegistryData(HKEY_CURRENT_USER,'AppEvents\Schemes\Apps\Explorer\Navigating\.Current','');
+
+  htmlContainer := TWBContainer.Create(htmlBrowserControl);
+
+  htmlContainer.Show3DBorder := false;
+  htmlContainer.AllowTextSelection := false;
+  htmlContainer.UseCustomCtxMenu := true;
+  htmlContainer.ShowScrollBars := false;
+  htmlBrowserControl.Silent := true;
+  htmlBrowserControl.Offline := true;
+  minimapFixedStartSize := 10;
+  StartMetal := 1000;
+  StartEnergy := 1000;
+  MaxUnits := 5000;
+
+  
+
+  htmlBrowser := TWebBrowserWrapper.Create(htmlContainer.HostedBrowser);
+
+  MenuCurrentPath := GetLongPathName(GetEnvironmentVariable('TEMP'))+'\tasclientgui\';
+  //MenuCurrentPath := ExtractFilePath(Application.ExeName) + 'Interface\';
+  MissionCurrentPath := MenuCurrentPath+'Mission\';
+  CampaignCurrentPath := MenuCurrentPath+'Campaign\';
+
+  AutorisedURLFiles := TStringList.Create;
+  
+  MenuForm.HookID := SetWindowsHookEx(WH_KEYBOARD, KeyProc, 0, GetCurrentThreadId());
+end;
+
+procedure TMenuForm.SaveIERegistry;
+begin
+  Misc.SetRegistryData(HKEY_CURRENT_USER,'\Software\TASClient\IE\Main','Disable Script Debugger',rdString,'yes');
+  Misc.SetRegistryData(HKEY_CURRENT_USER,'\Software\TASClient\IE\Main','DisableScriptDebuggerIE',rdString,'yes');
+  Misc.SetRegistryData(HKEY_CURRENT_USER,'\Software\TASClient\IE\Main','Display Inline Images',rdString,'yes');
+  Misc.SetRegistryData(HKEY_CURRENT_USER,'\Software\TASClient\IE\Main','Play_Animations',rdString,'yes');
+  Misc.SetRegistryData(HKEY_CURRENT_USER,'\Software\TASClient\IE\Main','SmoothScroll',rdInteger,1);
+  Misc.SetRegistryData(HKEY_CURRENT_USER,'\Software\TASClient\IE\Main','UseClearType',rdString,'no');
+end;
+
+function TMenuForm.LoadMapListHtmlCode: string;
+var
+  templateStr,tmp: string;
+  i: integer;
+begin
+    Result := '';
+    templateStr := ReadFile2(MenuCurrentPath+'mapItem.html');
+    for i := 0 to MapListForm.SortedMaps.Count -1  do
+    begin
+      tmp := templateStr;
+      with TMapItem(MapListForm.SortedMaps[i]) do
+      begin
+        tmp := StringReplace(tmp,'[MapID]',IntToStr(Index),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapMiniMapUrl]',ExtractFilePath(Application.ExeName)+MAPS_CACHE_FOLDER+'\'+MapHash+'.mini',[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapName]',MapName,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapDescription]',MapInfo.Description,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapTidalStrength]',IntToStr(MapInfo.TidalStrength),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapGravity]',IntToStr(MapInfo.Gravity),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapExtractorRadius]',IntToStr(MapInfo.ExtractorRadius),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapMinWind]',IntToStr(MapInfo.MinWind),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapMaxWind]',IntToStr(MapInfo.MaxWind),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapWidth]',IntToStr(Round(MapInfo.Width/64)),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapHeight]',IntToStr(Round(MapInfo.Height/64)),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[MapPosCount]',IntToStr(MapInfo.PosCount),[rfReplaceAll,rfIgnoreCase]);
+      end;
+      Result := Result + tmp;
+    end;
+end;
+
+function TMenuForm.GetLuaHtmlCode(options: TList): String;
+var
+  tmpStr,tmp,varHtmlCode3,tmp2: string;
+  i,j: integer;
+begin
+    Result := '';
+    for i := 0 to options.Count-1  do
+    begin
+      tmpStr := TLuaOption(options[i]).ClassName;
+      tmp := '';
+      if tmpStr = 'TLuaOptionBool' then
+      begin
+        tmp := ReadFile2(MenuCurrentPath+'luaBoolOption.html');
+        tmp := StringReplace(tmp,'[luaOptionId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionName]',TLuaOptionBool(options[i]).Name,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionDescription]',TLuaOptionBool(options[i]).Description,[rfReplaceAll,rfIgnoreCase]);
+        if TLuaOptionBool(options[i]).toString &lt;&gt; '0' then
+          tmp := StringReplace(tmp,'[luaOptionValue]','checked',[rfReplaceAll,rfIgnoreCase])
+        else
+          tmp := StringReplace(tmp,'[luaOptionValue]','',[rfReplaceAll,rfIgnoreCase]);
+      end;
+      if tmpStr = 'TLuaOptionString' then
+      begin
+        tmp := ReadFile2(MenuCurrentPath+'luaStringOption.html');
+        tmp := StringReplace(tmp,'[luaOptionId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionName]',TLuaOptionString(options[i]).Name,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionDescription]',TLuaOptionString(options[i]).Description,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionValue]',TLuaOptionString(options[i]).toString,[rfReplaceAll,rfIgnoreCase]);
+      end;
+      if tmpStr = 'TLuaOptionNumber' then
+      begin
+        tmp := ReadFile2(MenuCurrentPath+'luaNumberOption.html');
+        tmp := StringReplace(tmp,'[luaOptionId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionName]',TLuaOptionNumber(options[i]).Name,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionDescription]',TLuaOptionNumber(options[i]).Description,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionValue]',TLuaOptionNumber(options[i]).toString,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionMinValue]',FloatToStr(TLuaOptionNumber(options[i]).MinValue),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionMaxValue]',FloatToStr(TLuaOptionNumber(options[i]).MaxValue),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionStep]',FloatToStr(TLuaOptionNumber(options[i]).StepValue),[rfReplaceAll,rfIgnoreCase]);
+      end;
+      if tmpStr = 'TLuaOptionList' then
+      begin
+        tmp := ReadFile2(MenuCurrentPath+'luaListOption.html');
+        tmp := StringReplace(tmp,'[luaOptionId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionName]',TLuaOptionList(options[i]).Name,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionDescription]',TLuaOptionList(options[i]).Description,[rfReplaceAll,rfIgnoreCase]);
+        varHtmlCode3 := '';
+        for j := 0 to TLuaOptionList(options[i]).NameList.Count-1 do
+        begin
+          tmp2 := ReadFile2(MenuCurrentPath+'luaListItem.html');
+          tmp2 := StringReplace(tmp2,'[luaOptionItemId]',IntToStr(j),[rfReplaceAll,rfIgnoreCase]);
+          tmp2 := StringReplace(tmp2,'[luaOptionItemName]',TLuaOptionList(options[i]).NameList[j],[rfReplaceAll,rfIgnoreCase]);
+          tmp2 := StringReplace(tmp2,'[luaOptionItemKey]',TLuaOptionList(options[i]).KeyList[j],[rfReplaceAll,rfIgnoreCase]);
+          tmp2 := StringReplace(tmp2,'[luaOptionItemDescription]',TLuaOptionList(options[i]).DescriptionList[j],[rfReplaceAll,rfIgnoreCase]);
+          varHtmlCode3 := varHtmlCode3 + tmp2;
+        end;
+        tmp := StringReplace(tmp,'[luaOptionList]',varHtmlCode3,[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[luaOptionValue]',TLuaOptionList(options[i]).toString,[rfReplaceAll,rfIgnoreCase]);
+      end;
+      Result := Result + tmp;
+    end;
+end;
+
+procedure TMenuForm.ColorCallBack(const AName: String);
+begin
+  ColorsList.Add(AName);
+end;
+
+procedure TMenuForm.LoadMenu(fileName: string;pageType: TPageType);
+var
+  htmlCode: string;
+  varHtmlCode,varHtmlCode2,varHtmlCode3,tmp,tmp2: string;
+  i,j: integer;
+  tmpStr: string;
+  templateStr: string;
+  sl: TStringList;
+  tmpMission: TMission;
+  browsepage: ^TBrowsePage;
+begin
+  sl := TStringList.Create;
+
+  New(browsepage);
+  browsepage^.PageName := fileName;
+  browsepage^.PageType := pageType;
+  BrowseHistory.Push(browsepage);
+
+  if pageType = CampaignMission then
+    tmpMission := CurrentCampaignMission
+  else if pageType = Mission then
+    tmpMission := TMission(MissionList[CurrentMissionIndex]^);
+
+  if ((pageType = Mission) or (pageType = CampaignMission)) and tmpMission.UseHTML then
+    CurrentPath := MissionCurrentPath
+  else if (pageType = Campaign) then
+    CurrentPath := CampaignCurrentPath
+  else
+    CurrentPath := MenuCurrentPath;
+
+  // get the html code
+  htmlCode := Misc.ReadFile2(CurrentPath+fileName);
+
+  htmlCode := StringReplace(htmlCode,'[SpringVersion]',springExeVersion,[rfIgnoreCase,rfReplaceAll]);
+
+  if (pageType = Loading) then // [MSG]
+  begin
+    htmlCode := StringReplace(htmlCode,'[MSG]',LoadingMessage,[rfIgnoreCase,rfReplaceAll]);
+  end;
+
+  if (pageType = Campaign) then
+  begin
+    with TCampaign(CampaignList[CurrentCampaignIndex]^) do
+    begin
+      htmlCode := StringReplace(htmlCode,'[CampaignId]',IntToStr(CurrentCampaignIndex),[rfIgnoreCase,rfReplaceAll]);
+      htmlCode := StringReplace(htmlCode,'[CampaignName]',descriptor.ReadKeyValue('campaign/name'),[rfIgnoreCase,rfReplaceAll]);
+
+      if descriptor.ReadKeyValue('campaign/IncludeHtml') = '1' then
+      begin
+        varHtmlCode := htmlCode;
+
+        htmlCode := Misc.ReadFile2(CurrentPath+'defaultCampaignSkin.html');
+
+        htmlCode := StringReplace(htmlCode,'[CampaignContent]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+      end;
+    end;
+  end;
+
+  if (pageType = Mission) or (pageType = CampaignMission) then
+  begin
+    with tmpMission do
+    begin
+      htmlCode := StringReplace(htmlCode,'[MissionId]',IntToStr(CurrentMissionIndex),[rfIgnoreCase,rfReplaceAll]);
+      htmlCode := StringReplace(htmlCode,'[MissionName]',descriptor.ReadKeyValue('mission/name'),[rfIgnoreCase,rfReplaceAll]);
+      htmlCode := StringReplace(htmlCode,'[MissionDescription]',descriptor.ReadKeyValue('mission/description'),[rfIgnoreCase,rfReplaceAll]);
+      htmlCode := StringReplace(htmlCode,'[MissionBriefing]',descriptor.ReadKeyValue('mission/briefing'),[rfIgnoreCase,rfReplaceAll]);
+
+      if UseHTML and (descriptor.ReadKeyValue('mission/IncludeHtml') = '1') then
+      begin
+        varHtmlCode := htmlCode;
+
+        htmlCode := Misc.ReadFile2(CurrentPath+'defaultMissionSkin.html');
+
+        htmlCode := StringReplace(htmlCode,'[MissionContent]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+      end;
+    end;
+  end;
+
+  if (pageType = CampaignsMenu) then // [CampaignList]
+  begin
+    templateStr := ReadFile2(CurrentPath+'campaignItem.html');
+    varHtmlCode := '';
+    for i := 0 to CampaignList.Count-1  do
+    begin
+      tmp := templateStr;
+      tmp := StringReplace(tmp,'[CampaignId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[CampaignName]',TCampaign(CampaignList[i]^).descriptor.ReadKeyValue('campaign/name'),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[CampaignDescription]',TCampaign(CampaignList[i]^).descriptor.ReadKeyValue('campaign/description'),[rfReplaceAll,rfIgnoreCase]);
+      varHtmlCode := varHtmlCode + tmp;
+    end;
+    htmlCode := StringReplace(htmlCode,'[CampaignList]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+  end;
+
+  if (pageType = MissionsMenu) then // [MissionList]
+  begin
+    templateStr := ReadFile2(CurrentPath+'missionItem.html');
+    varHtmlCode := '';
+    for i := 0 to MissionList.Count-1  do
+    begin
+      tmp := templateStr;
+      tmp := StringReplace(tmp,'[MissionId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[MissionName]',TMission(MissionList[i]^).descriptor.ReadKeyValue('mission/name'),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[MissionDescription]',TMission(MissionList[i]^).descriptor.ReadKeyValue('mission/description'),[rfReplaceAll,rfIgnoreCase]);
+      varHtmlCode := varHtmlCode + tmp;
+    end;
+    htmlCode := StringReplace(htmlCode,'[MissionList]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+  end;
+
+  if (pageType = Skirmish) then // [MAPLIST]
+  begin
+    // map html code is cached and refreshed only when needed to save cpu time
+    htmlCode := StringReplace(htmlCode,'[MAPLIST]',mapListHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+    if Preferences.MapSortStyle = 1 then
+      htmlCode := StringReplace(htmlCode,'[MAPSORT]','name',[rfIgnoreCase,rfReplaceAll])
+    else
+      htmlCode := StringReplace(htmlCode,'[MAPSORT]','size',[rfIgnoreCase,rfReplaceAll])
+  end;
+  if (pageType = Skirmish) then // [SELECTEDMAPNAME] [MAP%WIDTH] [MAP%HEIGHT]
+  begin
+    templateStr := ReadFile2(CurrentPath+'mapItem.html');
+    varHtmlCode := '';
+
+    htmlCode := StringReplace(htmlCode,'[SELECTEDMAPNAME]',TMapItem(MapListForm.Maps[BattleForm.CurrentMapIndex]).MapName,[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MAP%WIDTH]',IntToStr(mapWidthPercent),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MAP%HEIGHT]',IntToStr(mapHeightPercent),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MAPWIDTH]',IntToStr(Round(TMapItem(MapListForm.Maps[BattleForm.CurrentMapIndex]).MapInfo.Width/64)),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MAPHEIGHT]',IntToStr(Round(TMapItem(MapListForm.Maps[BattleForm.CurrentMapIndex]).MapInfo.Height/64)),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[STARTMETAL]',IntToStr(StartMetal),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[STARTENERGY]',IntToStr(StartEnergy),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MAXUNITS]',IntToStr(MaxUnits),[rfIgnoreCase,rfReplaceAll]);
+  end;
+  if (pageType = Skirmish) then // [MODLIST]
+  begin
+    templateStr := ReadFile2(CurrentPath+'modItem.html');
+    varHtmlCode := '';
+    for i := 0 to Utility.ModList.Count-1  do
+    begin
+      tmp := templateStr;
+      tmp := StringReplace(tmp,'[modId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[modName]',Utility.ModList[i],[rfReplaceAll,rfIgnoreCase]);
+      varHtmlCode := varHtmlCode + tmp;
+    end;
+    htmlCode := StringReplace(htmlCode,'[MODLIST]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[SelectedModId]',IntToStr(Utility.ModList.IndexOf(BattleForm.CurrentModName)),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[SelectedModName]',BattleForm.CurrentModName,[rfIgnoreCase,rfReplaceAll]);
+  end;
+  if (pageType = Skirmish) then // [MODOPTIONLIST] [MAPOPTIONLIST]
+  begin
+    htmlCode := StringReplace(htmlCode,'[MODOPTIONLIST]',GetLuaHtmlCode(BattleForm.ModOptionsList),[rfIgnoreCase,rfReplaceAll]);
+    htmlCode := StringReplace(htmlCode,'[MAPOPTIONLIST]',GetLuaHtmlCode(BattleForm.MapOptionsList),[rfIgnoreCase,rfReplaceAll]);
+  end;
+  if (pageType = Skirmish) then // [AILIST]
+  begin
+    varHtmlCode := '';
+    templateStr := ReadFile2(CurrentPath+'aiItem.html');
+    for i := 0 to AddBotForm.AIComboBox.Items.Count-1 do
+    begin
+      tmp := templateStr;
+      tmp := StringReplace(tmp,'[aiName]',AddBotForm.AIComboBox.Items[i],[rfReplaceAll,rfIgnoreCase]);
+
+      varHtmlCode := varHtmlCode + tmp;
+    end;
+
+    htmlCode := StringReplace(htmlCode,'[AILIST]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+  end;
+  if (pageType = Skirmish) then // [UNITLIST]
+  begin
+    varHtmlCode := '';
+    templateStr := ReadFile2(CurrentPath+'unitItem.html');
+    sl.Clear;
+    sl.AddStrings(Utility.UnitNames);
+    sl.Sort;
+    for i := 0 to sl.Count-1 do
+    begin
+      tmp := templateStr;
+      tmp := StringReplace(tmp,'[unitId]',IntToStr(Utility.UnitNames.IndexOf(sl[i])),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[unitName]',sl[i],[rfReplaceAll,rfIgnoreCase]);
+      varHtmlCode := varHtmlCode + tmp;
+    end;
+
+    htmlCode := StringReplace(htmlCode,'[UNITLIST]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+  end;
+  if (pageType = Skirmish) then // [PlayerList] [PlayerBoxList] [NbPlayers]
+  begin
+    // sides
+    varHtmlCode2 := '';
+    if BattleForm.CurrentModName &lt;&gt; '' then
+    begin
+      templateStr := ReadFile2(CurrentPath+'sideItem.html');
+      for i := 0 to Utility.SideList.Count-1 do
+      begin
+        tmp := templateStr;
+        tmp := StringReplace(tmp,'[SideId]',IntToStr(i),[rfReplaceAll,rfIgnoreCase]);
+        tmp := StringReplace(tmp,'[SideName]',Utility.SideList[i],[rfReplaceAll,rfIgnoreCase]);
+        varHtmlCode2 := varHtmlCode2 + tmp;
+      end;
+    end;
+
+    varHtmlCode := '';
+
+    //me
+    templateStr := ReadFile2(CurrentPath+'playerItemBox.html');
+    tmp := templateStr;
+    tmp := StringReplace(tmp,'[SideList]',varHtmlCode2,[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[PlayerId]','0',[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[PlayerName]','Me',[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[SelectedSide]',IntToStr(MePlayer.Side),[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[SelectedId]',IntToStr(MePlayer.Id),[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[SelectedTeam]',IntToStr(MePlayer.Team),[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[Handicap]',IntToStr(MePlayer.Handicap),[rfReplaceAll,rfIgnoreCase]);
+    varHtmlCode := varHtmlCode + tmp;
+
+    //AIs
+    templateStr := ReadFile2(CurrentPath+'botItemBox.html');
+    for i := 0 to AIPlayerList.Count-1 do
+    begin
+      tmp := templateStr;
+      tmp := StringReplace(tmp,'[SideList]',varHtmlCode2,[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[PlayerId]',IntToStr(TAIItem(AIPlayerList[i]^).Id),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[PlayerName]',TAIItem(AIPlayerList[i]^).Name,[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[AIType]',TAIItem(AIPlayerList[i]^).AIType,[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[SelectedSide]',IntToStr(TAIItem(AIPlayerList[i]^).Side),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[SelectedId]',IntToStr(TAIItem(AIPlayerList[i]^).Id),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[SelectedTeam]',IntToStr(TAIItem(AIPlayerList[i]^).Team),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[Handicap]',IntToStr(TAIItem(AIPlayerList[i]^).Handicap),[rfReplaceAll,rfIgnoreCase]);
+      varHtmlCode := varHtmlCode + tmp;
+    end;
+
+    htmlCode := StringReplace(htmlCode,'[PlayerBoxList]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+
+    varHtmlCode := '';
+
+    //me
+    templateStr := ReadFile2(CurrentPath+'playerItem.html');
+    tmp := templateStr;
+    tmp := StringReplace(tmp,'[SideList]',varHtmlCode2,[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[PlayerId]','0',[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[PlayerName]','Me',[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[SelectedSide]',IntToStr(MePlayer.Side),[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[SelectedId]',IntToStr(MePlayer.Id),[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[SelectedTeam]',IntToStr(MePlayer.Team),[rfReplaceAll,rfIgnoreCase]);
+    tmp := StringReplace(tmp,'[Handicap]',IntToStr(MePlayer.Handicap),[rfReplaceAll,rfIgnoreCase]);
+    varHtmlCode := varHtmlCode + tmp;
+
+    //AIs
+    templateStr := ReadFile2(CurrentPath+'botItem.html');
+    for i := 0 to AIPlayerList.Count-1 do
+    begin
+      tmp := templateStr;
+      tmp := StringReplace(tmp,'[SideList]',varHtmlCode2,[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[PlayerId]',IntToStr(TAIItem(AIPlayerList[i]^).Id),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[PlayerName]',TAIItem(AIPlayerList[i]^).Name,[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[AIType]',TAIItem(AIPlayerList[i]^).AIType,[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[SelectedSide]',IntToStr(TAIItem(AIPlayerList[i]^).Side),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[SelectedId]',IntToStr(TAIItem(AIPlayerList[i]^).Id),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[SelectedTeam]',IntToStr(TAIItem(AIPlayerList[i]^).Team),[rfReplaceAll,rfIgnoreCase]);
+      tmp := StringReplace(tmp,'[Handicap]',IntToStr(TAIItem(AIPlayerList[i]^).Handicap),[rfReplaceAll,rfIgnoreCase]);
+      varHtmlCode := varHtmlCode + tmp;
+    end;
+
+    htmlCode := StringReplace(htmlCode,'[PlayerList]',varHtmlCode,[rfIgnoreCase,rfReplaceAll]);
+
+    htmlCode := StringReplace(htmlCode,'[NbPlayers]',IntToStr(1+AIPlayerList.Count),[rfIgnoreCase,rfReplaceAll]);
+  end;
+
+
+  for i:=0 to ColorsList.Count-1 do
+    htmlCode := StringReplace(htmlCode,'['+ColorsList[i]+']',IntToHex(Misc.ColorToStandardRGB(ColorToRGB(StringToColor(ColorsList[i]))),6),[rfIgnoreCase,rfReplaceAll]);
+
+  htmlCode := replaceParams(htmlCode,fileName);
+
+  // save new html file and open it
+  SaveFile(CurrentPath+'temp654dsq.html',htmlCode);
+  htmlBrowser.NavigateToLocalFile(CurrentPath+'temp654dsq.html');
+  sl.Free;
+end;
+
+// replace[LOBBY:LOADPARAM:id:default]
+function TMenuForm.replaceParams(code: string;fileName: string):string;
+var
+    pos1,pos2,pos3,pos4: integer;
+    tmpInt: integer;
+    sl: TStringList;
+    defaultValue: string;
+    paramNameExtracted: string;
+    arrayId: integer;
+    varHtmlCode,tmpStr: string;
+begin
+    sl := TStringList.Create;
+
+    varHtmlCode := code;
+    Result := '';
+    pos1 := Pos('[lobby:loadparam:',LowerCase(varHtmlCode));
+    while pos1 &lt;&gt; 0 do
+    begin
+      // extract the param name and its default value
+      pos2 := PosEx(']',varHtmlCode,pos1+17);
+      tmpStr := MidStr(varHtmlCode,pos1+17,pos2-pos1-17);
+
+      // check if there an array id
+      pos3 := Pos(':',tmpStr);
+
+      if pos3 = -1 then
+      begin
+        MessageDlg('En error occured while parsing ''' + fileName + ''' at char ' + IntToStr(pos1)+EOL+'Usage : [Lobby:LoadParam:paramName:index:default(Optional)]',mtError,[mbOk],0);
+        Break;
+      end;
+
+      // check if there is a default value
+      pos4 := PosEx(':',tmpStr,pos3+1);
+
+      try
+        if pos4 &gt; 0 then // if there is a default value : extract it
+        begin
+          defaultValue := MidStr(tmpStr,pos4+1,999999);
+          arrayId := StrToInt(MidStr(tmpStr,pos3+1,pos4-pos3-1));
+          paramNameExtracted := LeftStr(tmpStr,pos3-1);
+        end
+        else
+        begin
+          defaultValue := '';
+          paramNameExtracted := LeftStr(tmpStr,pos3-1);
+          arrayId := StrToInt(MidStr(tmpStr,pos3+1,999999));
+        end;
+      except
+        MessageDlg('En error occured while parsing ''' + fileName + ''' at char ' + IntToStr(pos1)+EOL+'Usage : [Lobby:LoadParam:paramName:index:default(Optional)]',mtError,[mbOk],0);
+        Break;
+      end;
+
+      tmpInt := paramName.IndexOf(paramNameExtracted);
+      if tmpInt = -1 then
+        Result := Result + LeftStr(varHtmlCode,pos1-1)+defaultValue
+      else
+      begin
+        Misc.ParseDelimited(sl,paramValues[tmpInt],':','');
+        if sl.Count-1 &lt; arrayId then
+        begin
+          MessageDlg('En error occured while parsing ''' + fileName + ''' at char ' + IntToStr(pos1)+EOL+'Array id incorrect: '+IntToStr(arrayId),mtError,[mbOk],0);
+          Break;
+        end;
+        Result := Result + LeftStr(varHtmlCode,pos1-1)+sl[arrayId];
+      end;
+      varHtmlCode := MidStr(varHtmlCode,pos2+1,MaxInt);
+
+      pos1 := Pos('[lobby:loadparam:',LowerCase(varHtmlCode));
+    end;
+
+    Result := Result + varHtmlCode;
+
+    sl.Free;
+end;
+
+procedure TMenuForm.SaveMinimapToFile;
+var
+  newWidth,newHeight: integer;
+begin
+  with TMapItem(MapListForm.Maps[BattleForm.CurrentMapIndex]) do
+  begin
+    if MapInfo.Width &gt; MapInfo.Height then
+    begin
+      newWidth := 1024;
+      newHeight := Round(1024*MapInfo.Height/MapInfo.Width);
+      mapWidthPercent := 100;
+      mapHeightPercent := Round(100*MapInfo.Height/MapInfo.Width);
+    end
+    else
+    begin
+      newHeight := 1024;
+      newWidth := Round(1024*MapInfo.Width/MapInfo.Height);
+      mapHeightPercent := 100;
+      mapWidthPercent := Round(100*MapInfo.Width/MapInfo.Height);
+    end;
+
+    Minimap.Picture.Bitmap.Width := newWidth;
+    Minimap.Picture.Bitmap.Height := newHeight;
+    Minimap.Canvas.StretchDraw(Rect(0,0,newWidth,newHeight),BattleForm.MapImage.Picture.Bitmap);
+    MinimapZoomedForm.DrawStartPositions(MapInfo,Minimap,minimapFixedStartSize);
+    Minimap.Picture.SaveToFile(MenuCurrentPath+'minimap.bmp');
+  end;
+end;
+
+procedure TMenuForm.FormShow(Sender: TObject);
+begin
+  tmrMusic.Enabled := true;
+  SaveIERegistry;
+  springExeVersion := Misc.GetSpringVersionFromEXE;
+  
+  AutorisedURLFiles.Add(MenuCurrentPath+'main.html');
+  AutorisedURLFiles.Add(MenuCurrentPath+'temp654dsq.html');
+  AutorisedURLFiles.Add(MissionCurrentPath+'temp654dsq.html');
+  AutorisedURLFiles.Add(CampaignCurrentPath+'temp654dsq.html');
+
+  if (Preferences.MapSortStyle &lt;&gt; 1) and (Preferences.MapSortStyle &lt;&gt; 2) then
+  begin
+    Preferences.MapSortStyle := 1;
+    MapListForm.SortMapList(1);
+  end;
+    
+  mapListHtmlCode := LoadMapListHtmlCode;
+
+  SaveMinimapToFile;
+
+  htmlBrowser.NavigateToURL(MenuCurrentPath+'main.html');
+  LoadMenu('main.html',Main);
+end;
+
+procedure TMenuForm.StartSkirmish;
+begin
+  if not GenerateScript(ExtractFilePath(Application.ExeName)+'script.txt') then
+    Exit;
+
+  FillChar(Process.proc_info, sizeof(TProcessInformation), 0);
+  FillChar(Process.startinfo, sizeof(TStartupInfo), 0);
+  Process.startinfo.cb := sizeof(TStartupInfo);
+
+  if CreateProcess(nil, PChar(ExtractFilePath(Application.ExeName) + 'spring.exe script.txt'), nil, nil, false, CREATE_DEFAULT_ERROR_MODE + NORMAL_PRIORITY_CLASS,
+                   nil, PChar(ExtractFilePath(Application.ExeName)), Process.startinfo, Process.proc_info) then
+  begin
+    GameTimer.Enabled := True;
+  end
+  else
+  begin
+    CloseHandle(Process.proc_info.hProcess);
+    Application.MessageBox('Couldn''t execute the application', 'Error', MB_ICONEXCLAMATION);
+  end;
+end;
+
+procedure TMenuForm.StartMission;
+var
+  mapIndex: integer;
+  tmp: string;
+  tmpMission: TMission;
+begin
+  if TBrowsePage(BrowseHistory.Peek^).PageType = CampaignMission then
+    tmpMission := CurrentCampaignMission
+  else
+    tmpMission := TMission(MissionList[CurrentMissionIndex]^);
+  with tmpMission do
+  begin
+    mapIndex := Utility.MapList.IndexOf(descriptor.ReadKeyValue('mission/MapFile'));
+    if mapIndex = -1 then
+    begin
+      MessageDlg('To play this mission, you need that map : '+descriptor.ReadKeyValue('mission/MapFile'),mtWarning,[mbOk],0);
+      Exit;
+    end
+    else if Utility.ModArchiveList.IndexOf(descriptor.ReadKeyValue('mission/ModFile')) = -1 then
+    begin
+      MessageDlg('To play this mission, you need that mod : '+descriptor.ReadKeyValue('mission/ModFile'),mtWarning,[mbOk],0);
+      Exit;
+    end
+    else if Utility.GetModHash2(descriptor.ReadKeyValue('mission/ModFile')) &lt;&gt; StrToInt(descriptor.ReadKeyValue('mission/ModHash')) then
+    begin
+      MessageDlg('Your mod files differ from the required one.',mtWarning,[mbOk],0);
+      Exit;
+    end
+    else if Utility.MapChecksums[mapIndex] &lt;&gt; descriptor.ReadKeyValue('mission/MapHash') then
+    begin
+      MessageDlg('Your map file differs from the required one.',mtWarning,[mbOk],0);
+      Exit;
+    end;
+  end;
+
+  FillChar(Process.proc_info, sizeof(TProcessInformation), 0);
+  FillChar(Process.startinfo, sizeof(TStartupInfo), 0);
+  Process.startinfo.cb := sizeof(TStartupInfo);
+
+  try
+    CopyFile(PChar(MissionCurrentPath+'script.txt'),PChar(ExtractFilePath(Application.ExeName)+'script.txt'),true);
+    CopyFile(Pchar(MissionCurrentPath+'MissionMutator.sd7'),PChar(ExtractFilePath(Application.ExeName)+'mods\MissionMutator.sd7'),true);
+
+    if CreateProcess(nil, PChar(ExtractFilePath(Application.ExeName) + 'spring.exe &quot;'+MissionCurrentPath+'script.txt&quot;'), nil, nil, false, CREATE_DEFAULT_ERROR_MODE + NORMAL_PRIORITY_CLASS,
+                   nil, PChar(ExtractFilePath(Application.ExeName)), Process.startinfo, Process.proc_info) then
+    begin
+      GameTimer.Enabled := True;
+    end
+    else
+    begin
+      CloseHandle(Process.proc_info.hProcess);
+      Application.MessageBox('Couldn''t execute the application', 'Error', MB_ICONEXCLAMATION);
+    end;
+  except
+    Application.MessageBox('An error occured while starting the mission.', 'Error', MB_ICONEXCLAMATION);
+  end;
+end;
+
+function TMenuForm.GenerateScript(FileName: string):boolean;
+var
+  script: TScript;
+  i: integer;
+  tmpInt: integer;
+  il: TIntegerList;
+  sl: TStringList;
+  TeamAllyCounter: TIntegerList;
+  Colors: TStringList;
+  tryToRewriteScript: boolean;
+  f: TextFile;
+begin
+  sl := TStringList.Create;
+  il := TIntegerList.Create;
+  TeamAllyCounter := TIntegerList.Create;
+  Colors := TStringList.Create;
+  script := TScript.Create('');
+
+  script.AddOrChangeKeyValue('GAME/Mapname',Utility.MapList[BattleForm.CurrentMapIndex]);
+  if BattleForm.CurrentModName = '' then
+  begin
+    MessageDlg('You must select a mod first.',mtWarning,[mbOk],0);
+    Script.Free;
+    il.Free;
+    Exit;
+  end;
+  script.AddOrChangeKeyValue('GAME/GameType',Utility.ModArchiveList[Utility.ModList.IndexOf(BattleForm.CurrentModName)]);
+  script.AddOrChangeKeyValue('GAME/ModHash',IntToStr(Utility.GetModHash(BattleForm.CurrentModName)));
+  script.AddOrChangeKeyValue('GAME/diminishingmms',IntToStr(BoolToInt(DiminishMM)));
+  script.AddOrChangeKeyValue('GAME/ghostedbuildings',IntToStr(BoolToInt(GhostedB)));
+  script.AddOrChangeKeyValue('GAME/limitdgun',IntToStr(BoolToInt(LimitDGun)));
+  script.AddOrChangeKeyValue('GAME/gamemode',IntToStr(GameType));
+  if GameMode = 0 then
+    script.AddOrChangeKeyValue('GAME/startpostype','3')
+  else
+    script.AddOrChangeKeyValue('GAME/startpostype',IntToStr(GameMode));
+  script.AddOrChangeKeyValue('GAME/maxunits',IntToStr(MaxUnits));
+  script.AddOrChangeKeyValue('GAME/startenergy',IntToStr(StartEnergy));
+  script.AddOrChangeKeyValue('GAME/startmetal',IntToStr(StartMetal));
+  script.AddOrChangeKeyValue('GAME/HostIP','localhost');
+  script.AddOrChangeKeyValue('GAME/HostPort','8452');
+  script.AddOrChangeKeyValue('GAME/MyPlayerNum','0');
+  script.AddOrChangeKeyValue('GAME/NumPlayers','1');
+
+  il.Clear;
+  il.Add(MePlayer.Id);
+  for i:=0 to AIPlayerList.Count-1 do
+    if il.IndexOf(TAIItem(AIPlayerList[i]^).Id) = -1 then
+      il.Add(TAIItem(AIPlayerList[i]^).Id);
+  script.AddOrChangeKeyValue('GAME/NumTeams',IntToStr(il.Count));
+
+  if il.Count &lt; AIPlayerList.Count then
+  begin
+    MessageDlg('Two or more bots share the same id, please change that.',mtWarning,[mbOk],0);
+    Script.Free;
+    il.Free;
+    Exit;
+  end;
+
+  il.Clear;
+  il.Add(MePlayer.Team);
+  for i:=0 to AIPlayerList.Count-1 do
+    if il.IndexOf(TAIItem(AIPlayerList[i]^).Team) = -1 then
+      il.Add(TAIItem(AIPlayerList[i]^).Team);
+  script.AddOrChangeKeyValue('GAME/NumAllyTeams',IntToStr(il.Count));
+
+  script.AddOrChangeKeyValue('GAME/PLAYER0/name','Player');
+  script.AddOrChangeKeyValue('GAME/PLAYER0/Spectator','0');
+  script.AddOrChangeKeyValue('GAME/PLAYER0/team',IntToStr(MePlayer.Id));
+
+  Colors.Add(ColorToScriptString(clBlue));
+  Colors.Add(ColorToScriptString(clBlack));
+  Colors.Add(ColorToScriptString(clWhite));
+  Colors.Add(ColorToScriptString(clGreen));
+  Colors.Add(ColorToScriptString(clGray));
+  Colors.Add(ColorToScriptString(clYellow));
+  Colors.Add(ColorToScriptString(clRed));
+  Colors.Add(ColorToScriptString(clPurple));
+  Colors.Add(ColorToScriptString(clMaroon));
+  Colors.Add(ColorToScriptString(PackRGB(255,186,0))); // orange
+  Colors.Add(ColorToScriptString(PackRGB(255,187,227))); // pink
+  Colors.Add(ColorToScriptString(PackRGB(140,0,0))); // dark red
+  Colors.Add(ColorToScriptString(PackRGB(112,255,173))); // light blue green
+  Colors.Add(ColorToScriptString(PackRGB(106,0,97))); // dark purple
+  Colors.Add(ColorToScriptString(PackRGB(0,21,151))); // dark blue
+  Colors.Add(ColorToScriptString(PackRGB(0,115,115))); // dark cyan ?
+
+  for i:=0 to 15 do
+    TeamAllyCounter.Add(0);
+
+  script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(MePlayer.Id)+'/TeamLeader','0');
+  script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(MePlayer.Id)+'/AllyTeam',IntToStr(MePlayer.Team));
+  tmpInt := RandomRange(0,Colors.Count-1);
+  script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(MePlayer.Id)+'/RGBColor',Colors[tmpInt]);
+  Colors.Delete(tmpInt);
+  script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(MePlayer.Id)+'/Side',Utility.SideList[MePlayer.Side]);
+  script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(MePlayer.Id)+'/Handicap',IntToStr(MePlayer.Handicap));
+  if GameMode = 0 then
+  begin
+    script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(MePlayer.Id)+'/StartPosX',IntToStr(Round(MePlayer.StartPosX*TMapItem(MapListForm.Maps[BattleForm.CurrentMapIndex]).MapInfo.Width*8)));
+    script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(MePlayer.Id)+'/StartPosZ',IntToStr(Round(MePlayer.StartPosY*TMapItem(MapListForm.Maps[BattleForm.CurrentMapIndex]).MapInfo.Height*8)));
+  end;
+
+  TeamAllyCounter.Items[MePlayer.Id] := 1;
+
+  for i:=0 to AIPlayerList.Count-1 do
+  begin
+    if script.ReadKeyValue('GAME/TEAM'+IntToStr(TAIItem(AIPlayerList[i]^).Id)+'/TeamLeader') = '' then
+    begin
+      script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(TAIItem(AIPlayerList[i]^).Id)+'/TeamLeader','0');
+      script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(TAIItem(AIPlayerList[i]^).Id)+'/AllyTeam',IntToStr(TAIItem(AIPlayerList[i]^).Team));
+      tmpInt := RandomRange(0,Colors.Count-1);
+      script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(TAIItem(AIPlayerList[i]^).Id)+'/RGBColor',Colors[tmpInt]);
+      Colors.Delete(tmpInt);
+      script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(TAIItem(AIPlayerList[i]^).Id)+'/Side',Utility.SideList[TAIItem(AIPlayerList[i]^).Side]);
+      script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(TAIItem(AIPlayerList[i]^).Id)+'/Handicap',IntToStr(TAIItem(AIPlayerList[i]^).Handicap));
+
+      if GameMode = 0 then
+      begin
+        script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(TAIItem(AIPlayerList[i]^).Id)+'/StartPosX',IntToStr(Round(TAIItem(AIPlayerList[i]^).StartPosX*TMapItem(MapListForm.Maps[BattleForm.CurrentMapIndex]).MapInfo.Width*8)));
+        script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(TAIItem(AIPlayerList[i]^).Id)+'/StartPosZ',IntToStr(Round(TAIItem(AIPlayerList[i]^).StartPosY*TMapItem(MapListForm.Maps[BattleForm.CurrentMapIndex]).MapInfo.Height*8)));
+      end;
+
+      TeamAllyCounter.Items[TAIItem(AIPlayerList[i]^).Team] := TeamAllyCounter.Items[TAIItem(AIPlayerList[i]^).Team]+1;
+    end;
+    script.AddOrChangeKeyValue('GAME/TEAM'+IntToStr(TAIItem(AIPlayerList[i]^).Id)+'/AIDLL',AIDLL_FOLDER + '/'+ TAIItem(AIPlayerList[i]^).AIType);
+  end;
+
+  for i:=0 to TeamAllyCounter.Count-1 do
+    if TeamAllyCounter.Items[i] &gt; 0 then
+      script.AddOrChangeKeyValue('GAME/ALLYTEAM'+IntToStr(i)+'/NumAllies','0');  //IntToStr(TeamAllyCounter.Items[i]-1)
+
+  script.AddOrChangeKeyValue('GAME/NumRestrictions',IntToStr(DisabledUnitList.Count));
+  for i:=0 to DisabledUnitList.Count-1 do
+  begin
+    script.AddOrChangeKeyValue('GAME/RESTRICT/Unit'+IntToStr(i),DisabledUnitList[i]);
+    script.AddOrChangeKeyValue('GAME/RESTRICT/Limit'+IntToStr(i),'0');
+  end;
+
+  with BattleForm do
+  begin
+     // mod options:
+     for i:=0 to ModOptionsList.Count -1 do
+      script.AddOrChangeKeyValue(TLuaOption(ModOptionsList[i]).KeyPrefix + TLuaOption(ModOptionsList[i]).Key,TLuaOption(ModOptionsList[i]).toString);
+
+     // map options:
+     for i:=0 to MapOptionsList.Count -1 do
+      script.AddOrChangeKeyValue(TLuaOption(MapOptionsList[i]).KeyPrefix + TLuaOption(MapOptionsList[i]).Key,TLuaOption(MapOptionsList[i]).toString);
+  end;
+
+  sl.Text := script.Script;
+  script.Free;
+  il.Free;
+
+  // write down the script
+  repeat
+  try
+    AssignFile(f, FileName);
+    Rewrite(f);
+    for i := 0 to sl.Count-1 do Writeln(f, sl[i]);
+    sl.Free;
+    CloseFile(f);
+    tryToRewriteScript := False;
+    Result := True;
+  except
+    Result := False;
+    try
+      CloseFile(f);
+    except
+      //
+    end;
+    tryToRewriteScript := MessageDlg('Could''nt write the start script file ''script.txt'', try again ?',mtError,[mbYes,mbNo],0) = mrYes;
+  end;
+  until not tryToRewriteScript;
+end;
+
+function TMenuForm.getBotIndex(id: integer): integer;
+var
+  i: integer;
+begin
+  Result := -1;
+  for i:=0 to AIPlayerList.Count-1 do
+    if TAIItem(AIPlayerList[i]^).Id = id then
+    begin
+      Result := i;
+      Exit;
+    end;
+end;
+
+procedure TMenuForm.htmlBrowserControlBeforeNavigate2(Sender: TObject;
+  const pDisp: IDispatch; var URL, Flags, TargetFrameName, PostData,
+  Headers: OleVariant; var Cancel: WordBool);
+var
+  command: String;
+  localFile: String;
+  i:integer;
+  tmp: integer;
+  tmpStr: string;
+  sl: TStringList;
+  bot: ^TAIItem;
+  browsePage: ^TBrowsePage;
+begin
+  if AutorisedURLFiles.IndexOf(URL) &gt;= 0 then
+  begin
+    // to avoid white flashes
+    LockWindowUpdate(Handle);
+    Exit;
+  end;
+
+  sl := TStringList.Create;
+
+  Cancel := true;
+  // disable the click sound
+  Misc.SetRegistryData(HKEY_CURRENT_USER,'AppEvents\Schemes\Apps\Explorer\Navigating\.Current','',rdExpandString,'');
+
+  if Pos('lobby:',URL) &lt;&gt; 0 then
+    command := MidStr(URL,Pos('lobby:',URL)+6,99999);
+  if command &lt;&gt; '' then
+  begin
+    if LowerCase(command) = 'quit' then
+    begin
+      SaveToRegOnExit := true;
+      MainForm.Close;
+      Exit;
+    end;
+    if LowerCase(command) = 'showmultiplayerlobby' then
+    begin
+      if MP1.Mode = mpPlaying then
+      begin
+        MP1.Stop;
+        MP1.Close;
+      end;
+      if MP2.Mode = mpPlaying then
+      begin
+        MP2.Stop;
+        MP2.Close;
+      end;
+      tmrMusic.Enabled := false;
+      BattleForm.ResetBattleScreen;
+      MainForm.Show;
+      MenuForm.Hide;
+      if Preferences.ConnectOnStartup then PostMessage(MainForm.Handle, WM_CONNECT, 0, 0);
+      Exit;
+    end;
+    if LowerCase(command) = 'gamesettings' then
+    begin
+      PreferencesForm.GameSettingsButtonClick(nil);
+      Exit;
+    end;
+    if LowerCase(command) = 'main' then
+    begin
+      LoadMenu('main.html',Main);
+      Exit;
+    end;
+    if LowerCase(command) = 'campaigns' then
+    begin
+      LoadCampaigns;
+      LoadMenu('campaigns.html',CampaignsMenu);
+      Exit;
+    end;
+    if LowerCase(command) = 'missions' then
+    begin
+      LoadMissions;
+      LoadMenu('missions.html',MissionsMenu);
+      Exit;
+    end;
+    if LowerCase(command) = 'skirmish' then
+    begin
+      AIPlayerList.Clear;
+      MePlayer.Id := 0;
+      MePlayer.Team := 0;
+      MePlayer.Side := 0;
+      MePlayer.Handicap :=  0;
+      idBots := 0;
+      LoadMenu('skirmish.html',Skirmish);
+      Exit;
+    end;
+    if LowerCase(command) = 'back' then
+    begin
+      browsePage := BrowseHistory.Pop;
+      browsePage := BrowseHistory.Pop;
+      LoadMissions;
+      LoadMenu(browsePage^.PageName,browsePage^.PageType);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),10) = 'playsound:' then
+    begin
+      tmpStr := MidStr(command,11,99999);
+      MP2.FileName := MenuCurrentPath + tmpStr;
+      MP2.Open;
+      MP2.Play;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),10) = 'playmusic:' then
+    begin
+      tmpStr := MidStr(command,11,99999);
+      if (MP1.FileName = MenuCurrentPath + tmpStr) and (MP1.Mode = mpPlaying) then // already playing the music
+        Exit;
+      MP1.FileName := MenuCurrentPath + tmpStr;
+      MP1.Open;
+      MP1.Play;
+      Exit;
+    end;
+    if LowerCase(command) = 'stopmusic' then
+    begin
+      if MP1.FileName = '' then Exit;
+      MP1.FileName := '';
+      MP1.Stop;
+      MP1.Close;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),14) = 'selectmission:' then
+    begin
+      tmp := StrToInt(MidStr(command,15,99999));
+      with TMission(MissionList[tmp]^) do
+      begin
+        ExtractMissionFiles(FileName);
+        CurrentMissionIndex := tmp;
+        if UseHTML then
+          LoadMenu(descriptor.ReadKeyValue('mission/htmlbriefing'),Mission)
+        else
+          LoadMenu('defaultMissionBriefing.html',Mission);
+      end;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),15) = 'selectcampaign:' then
+    begin
+      tmp := StrToInt(MidStr(command,16,99999));
+      with TCampaign(CampaignList[tmp]^) do
+      begin
+        ExtractCampaignFiles(FileName);
+        CurrentCampaignIndex := tmp;
+        LoadMenu(descriptor.ReadKeyValue('campaign/step1'),Campaign)
+      end;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),12) = 'pickmission:' then
+    begin
+      tmpStr := MidStr(command,13,99999);
+
+      Misc.ParseDelimited(sl,tmpStr,':','');
+
+      if (sl.Count &lt;&gt; 2) and (sl.Count &lt;&gt; 3) then
+      begin
+        MessageDlg('Invalid pickmission usage : '+command,mtError,[mbOk],0);
+        Exit;
+      end;
+
+      CurrentWinStep := sl[1];
+      if (sl.Count = 3) then
+        CurrentLostStep := sl[2]
+      else
+        CurrentLostStep := '';
+
+      CurrentCampaignMission.FileName := CampaignCurrentPath+sl[0];
+      CurrentCampaignMission.descriptor.Script :=  Utility.GetArchiveDescriptor(CurrentCampaignMission.FileName);
+      CurrentCampaignMission.UseHTML := CurrentCampaignMission.descriptor.ReadKeyValue('mission/htmlbriefing') &lt;&gt; '';
+
+      with CurrentCampaignMission do
+      begin
+        ExtractMissionFiles(FileName);
+        if UseHTML then
+          LoadMenu(descriptor.ReadKeyValue('mission/htmlbriefing'),CampaignMission)
+        else
+          LoadMenu('defaultMissionBriefing.html',CampaignMission);
+      end;
+
+      sl.Free;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),10) = 'selectmap:' then
+    begin
+      tmp := StrToInt(MidStr(command,11,99999));
+      BattleForm.ChangeMap(tmp);
+      SaveMinimapToFile;
+      browsePage := BrowseHistory.Peek;
+      LoadMenu(TBrowsePage(browsePage^).PageName,TBrowsePage(browsePage^).PageType);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),11) = 'sortmapsby:' then
+    begin
+      tmpStr := MidStr(command,12,99999);
+      if LowerCase(tmpStr) = 'size' then
+      begin
+        MapListForm.SortMapList(2);
+        Preferences.MapSortStyle := 2;
+        mapListHtmlCode := LoadMapListHtmlCode;
+      end
+      else if LowerCase(tmpStr) = 'name' then
+      begin
+        MapListForm.SortMapList(1);
+        Preferences.MapSortStyle := 1;
+        mapListHtmlCode := LoadMapListHtmlCode;
+      end
+      else
+      begin
+        MessageDlg('Invalid sortmapsby usage : '+command,mtError,[mbOk],0);
+        Exit
+      end;
+      browsePage := BrowseHistory.Peek;
+      LoadMenu(TBrowsePage(browsePage^).PageName,TBrowsePage(browsePage^).PageType);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),10) = 'selectmod:' then
+    begin
+      browsePage := BrowseHistory.Peek;
+      if MidStr(command,11,99999) = '' then Exit;
+      tmp := StrToInt(MidStr(command,11,99999));
+      LoadingMessage := 'Loading mod '''+Utility.ModList[tmp]+''', please wait ...';
+
+      LoadMenu('loading.html',TBrowsePage(browsePage^).PageType);
+      BattleForm.ChangeCurrentMod(Utility.ModList[tmp]);
+      Utility.ReloadUnitList;
+
+      MePlayer.Side := 0;
+      for i:=0 to AIPlayerList.Count-1 do
+        TAIItem(AIPlayerList[i]^).Side := 0;
+
+      LoadMenu(TBrowsePage(browsePage^).PageName,TBrowsePage(browsePage^).PageType);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),10) = 'saveparam:' then
+    begin
+      tmpStr := MidStr(command,11,99999);
+      Misc.ParseDelimited(sl,tmpStr,':','');
+      if sl.Count &lt; 2 then
+      begin
+        MessageDlg('Invalid saveparam usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+      tmp := paramName.IndexOf(sl[0]);
+      if tmp = -1 then
+      begin
+        paramName.Add(sl[0]);
+        paramValues.Add(Misc.JoinStringList(sl,':',1));
+      end
+      else
+        paramValues[tmp] := Misc.JoinStringList(sl,':',1);
+      sl.Free;
+      Exit;
+    end;
+    if LowerCase(command) = 'resetparams' then
+    begin
+      paramName.Clear;
+      paramValues.Clear;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),12) = 'changemetal:' then
+    begin
+      tmpStr := MidStr(command,13,99999);
+      StartMetal := StrToInt(tmpStr);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),13) = 'changeenergy:' then
+    begin
+      tmpStr := MidStr(command,14,99999);
+      StartEnergy := StrToInt(tmpStr);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),15) = 'changemaxunits:' then
+    begin
+      tmpStr := MidStr(command,16,99999);
+      MaxUnits := StrToInt(tmpStr);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),15) = 'changegametype:' then
+    begin
+      tmpStr := MidStr(command,16,99999);
+      GameType := StrToInt(tmpStr);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),15) = 'changegamemode:' then
+    begin
+      tmpStr := MidStr(command,16,99999);
+      GameMode := StrToInt(tmpStr);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),16) = 'changelimitdgun:' then
+    begin
+      tmpStr := MidStr(command,17,99999);
+      LimitDGun := StrToBool(tmpStr);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),15) = 'changeghostedb:' then
+    begin
+      tmpStr := MidStr(command,16,99999);
+      GhostedB := StrToBool(tmpStr);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),17) = 'changediminishmm:' then
+    begin
+      tmpStr := MidStr(command,18,99999);
+      DiminishMM := StrToBool(tmpStr);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),26) = 'changeminimapstartpossize:' then
+    begin
+      tmpStr := MidStr(command,27,99999);
+      minimapFixedStartSize := StrToInt(tmpStr);
+      SaveMinimapToFile;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),12) = 'disableunit:' then
+    begin
+      tmpStr := MidStr(command,13,99999);
+      tmp := StrToInt(tmpstr);
+
+      if DisabledUnitList.IndexOf(Utility.UnitList[tmp]) &lt; 0 then
+        DisabledUnitList.Add(Utility.UnitList[tmp]);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),11) = 'enableunit:' then
+    begin
+      tmpStr := MidStr(command,12,99999);
+      tmp := StrToInt(tmpstr);
+
+      tmp := DisabledUnitList.IndexOf(Utility.UnitList[tmp]);
+      if tmp &gt;= 0 then
+        DisabledUnitList.Delete(tmp);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),16) = 'changeluaoption:' then
+    begin
+      tmpStr := MidStr(command,17,99999);
+
+      Misc.ParseDelimited(sl,tmpStr,':','');
+
+      if (sl.Count &lt;&gt; 2) then
+      begin
+        MessageDlg('Invalid changeluaoption usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      try
+        tmp := StrToInt(sl[0]);
+        if tmp &lt; BattleForm.ModOptionsList.Count then // mods
+        begin
+          TLuaOption(BattleForm.ModOptionsList[tmp]).SetValue(sl[1]);
+        end
+        else // maps
+        begin
+          TLuaOption(BattleForm.MapOptionsList[tmp-BattleForm.ModOptionsList.Count]).SetValue(sl[1]);
+        end;
+      except
+        MessageDlg('Invalid changeluaoption usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      sl.Free;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),7) = 'addbot:' then
+    begin
+      tmpStr := MidStr(command,8,99999);
+
+      New(bot);
+
+      bot^.AIType := tmpStr;
+      bot^.Id := freeIds.Items[0];
+      freeIds.Delete(0);
+      bot^.Team := AIPlayerList.Count+1;
+      bot^.Side := 0;
+      bot^.Handicap := 0;
+      idBots := idBots + 1;
+      bot^.Name := 'T'+IntToStr(idBots);
+
+      AIPlayerList.Add(bot);
+
+      browsePage := BrowseHistory.Peek;
+      LoadMenu(TBrowsePage(browsePage^).PageName,TBrowsePage(browsePage^).PageType);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),10) = 'removebot:' then
+    begin
+      tmp := StrToInt(MidStr(command,11,99999));
+
+      AIPlayerList.Delete(getBotIndex(tmp));
+      freeIds.Add(tmp);
+
+      browsePage := BrowseHistory.Peek;
+      LoadMenu(TBrowsePage(browsePage^).PageName,TBrowsePage(browsePage^).PageType);
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),11) = 'changeside:' then
+    begin
+      tmpStr := MidStr(command,12,99999);
+
+      Misc.ParseDelimited(sl,tmpStr,':','');
+
+      if (sl.Count &lt;&gt; 2) then
+      begin
+        MessageDlg('Invalid changeside usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      try
+        tmp := StrToInt(sl[0]);
+        if tmp = 0 then
+        begin
+          MePlayer.Side := StrToInt(sl[1]);
+        end
+        else
+        begin
+          TAIItem(AIPlayerList[getBotIndex(tmp)]^).Side := StrToInt(sl[1]);
+        end;
+      except
+        MessageDlg('Invalid changeside usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      sl.Free;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),9) = 'changeid:' then
+    begin
+      tmpStr := MidStr(command,10,99999);
+
+      Misc.ParseDelimited(sl,tmpStr,':','');
+
+      if (sl.Count &lt;&gt; 2) then
+      begin
+        MessageDlg('Invalid changeid usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      try
+        tmp := StrToInt(sl[0]);
+        if tmp = 1 then
+        begin
+          MePlayer.Id := StrToInt(sl[1]);
+        end
+        else
+        begin
+          TAIItem(AIPlayerList[getBotIndex(tmp)]^).Id := StrToInt(sl[1]);
+        end;
+      except
+        MessageDlg('Invalid changeid usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      sl.Free;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),11) = 'changeteam:' then
+    begin
+      tmpStr := MidStr(command,12,99999);
+
+      Misc.ParseDelimited(sl,tmpStr,':','');
+
+      if (sl.Count &lt;&gt; 2) then
+      begin
+        MessageDlg('Invalid changeally usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      try
+        tmp := StrToInt(sl[0]);
+        if tmp = 1 then
+        begin
+          MePlayer.Team := StrToInt(sl[1]);
+        end
+        else
+        begin
+          TAIItem(AIPlayerList[getBotIndex(tmp)]^).Team := StrToInt(sl[1]);
+        end;
+      except
+        MessageDlg('Invalid changeally usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      sl.Free;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),15) = 'changehandicap:' then
+    begin
+      tmpStr := MidStr(command,16,99999);
+
+      Misc.ParseDelimited(sl,tmpStr,':','');
+
+      if (sl.Count &lt;&gt; 2) then
+      begin
+        MessageDlg('Invalid changehandicap usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      try
+        tmp := StrToInt(sl[0]);
+        if tmp = 1 then
+        begin
+          MePlayer.Handicap := StrToInt(sl[1]);
+        end
+        else
+        begin
+          TAIItem(AIPlayerList[getBotIndex(tmp)]^).Handicap := StrToInt(sl[1]);
+        end;
+      except
+        MessageDlg('Invalid changehandicap usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      sl.Free;
+      Exit;
+    end;
+    if LeftStr(LowerCase(command),15) = 'changestartpos:' then
+    begin
+      tmpStr := MidStr(command,16,99999);
+
+      Misc.ParseDelimited(sl,tmpStr,':','');
+
+      if (sl.Count &lt;&gt; 3) then
+      begin
+        MessageDlg('Invalid changestartpos usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      try
+        tmp := StrToInt(sl[0]);
+        if tmp = 0 then
+        begin
+          MePlayer.StartPosX := StrToFloat(sl[1]);
+          MePlayer.StartPosY := StrToFloat(sl[2]);
+        end
+        else
+        begin
+          TAIItem(AIPlayerList[getBotIndex(tmp)]^).StartPosX := StrToFloat(sl[1]);
+          TAIItem(AIPlayerList[getBotIndex(tmp)]^).StartPosY := StrToFloat(sl[2]);
+        end;
+      except
+        MessageDlg('Invalid changestartpos usage : '+command,mtError,[mbOk],0);
+        sl.Free;
+        Exit;
+      end;
+
+      sl.Free;
+      Exit;
+    end;
+    if LowerCase(command) = 'start' then
+    begin
+      StartSkirmish;
+      //Misc.VariantToString(PostData)
+      Exit;
+    end;
+    if LowerCase(command) = 'startmission' then
+    begin
+      StartMission;
+      //Misc.VariantToString(PostData)
+      Exit;
+    end;
+
+    if LeftStr(LowerCase(command),10) = 'localfile:' then
+    begin
+      //MessageDlg(Misc.VariantToString(PostData),mtInformation,[mbOk],0);
+      localFile := MidStr(command,11,99999);
+      browsePage := BrowseHistory.Peek;
+      LoadMenu(localFile,TBrowsePage(browsePage^).PageType);
+      Exit;
+    end;
+
+    MessageDlg('Unknown lobby command : ''' + command + '''',mtError,[mbOk],0);
+    Exit;
+  end;
+
+  if LeftStr(LowerCase(URL),7) = '<A HREF="http://">http://</A>' then
+    Misc.OpenURLInDefaultBrowser(URL);
+end;
+
+procedure TMenuForm.LoadMissions;
+var
+  sr: TSearchRec;
+  FileAttrs: Integer;
+  m: ^TMission;
+  d: string;
+begin
+  MissionList.Clear;
+
+  FileAttrs := faAnyFile;
+
+  if FindFirst(ExtractFilePath(Application.ExeName) + 'missions\*.sd7', FileAttrs, sr) = 0 then
+  begin
+    repeat
+      if (sr.Name &lt;&gt; '.') and (sr.Name &lt;&gt; '..') then
+      begin
+        d := Utility.GetArchiveDescriptor('.\missions\'+sr.Name);
+        if d &lt;&gt; '' then
+        begin
+          New(m);
+          m^.FileName := '.\missions\'+sr.Name;
+          m^.descriptor := TTDFParser.Create(d);
+          m^.UseHTML := m^.descriptor.ReadKeyValue('mission/htmlbriefing') &lt;&gt; '';
+          MissionList.Add(m);
+        end;
+        //else
+          //MessageDlg('Mission descriptor not found in '''+sr.Name+'''',mtWarning,[mbOk],0);
+      end;
+    until FindNext(sr) &lt;&gt; 0;
+    FindClose(sr);
+  end;
+end;
+
+procedure TMenuForm.LoadCampaigns;
+var
+  sr: TSearchRec;
+  FileAttrs: Integer;
+  m: ^TCampaign;
+  d: string;
+begin
+  CampaignList.Clear;
+
+  FileAttrs := faAnyFile;
+
+  if FindFirst(ExtractFilePath(Application.ExeName) + 'campaigns\*.sd7', FileAttrs, sr) = 0 then
+  begin
+    repeat
+      if (sr.Name &lt;&gt; '.') and (sr.Name &lt;&gt; '..') then
+      begin
+        d := Utility.GetArchiveDescriptor('.\campaigns\'+sr.Name);
+        if d &lt;&gt; '' then
+        begin
+          New(m);
+          m^.FileName := '.\campaigns\'+sr.Name;
+          m^.descriptor := TTDFParser.Create(d);
+          CampaignList.Add(m);
+        end;
+        //else
+          //MessageDlg('Mission descriptor not found in '''+sr.Name+'''',mtWarning,[mbOk],0);
+      end;
+    until FindNext(sr) &lt;&gt; 0;
+    FindClose(sr);
+  end;
+end;
+
+procedure TMenuForm.htmlBrowserControlNavigateComplete2(Sender: TObject;
+  const pDisp: IDispatch; var URL: OleVariant);
+begin
+  Misc.SetRegistryData(HKEY_CURRENT_USER,'AppEvents\Schemes\Apps\Explorer\Navigating\.Current','',rdExpandString,soundValue);
+end;
+
+procedure TMenuForm.GameTimerTimer(Sender: TObject);
+var
+  browsePage: ^TBrowsePage;
+begin
+  GameTimer.Enabled := False;
+  if GetExitCodeProcess(Process.proc_info.hProcess, Process.ExitCode)
+  then
+    if Process.ExitCode = STILL_ACTIVE then
+      GameTimer.Enabled := True
+    else
+    begin
+      CloseHandle(Process.proc_info.hProcess);
+      browsePage := BrowseHistory.Peek;
+      if (browsePage^.PageType = CampaignMission) then
+        if playerHasWon(ExtractFilePath(Application.ExeName)+'infolog.txt') then
+          LoadMenu(CurrentWinStep,Campaign)
+        else if CurrentLostStep &lt;&gt; '' then
+          LoadMenu(CurrentLostStep,Campaign);
+    end
+  else
+  begin
+    TerminateProcess(Process.proc_info.hProcess, 0);
+    CloseHandle(Process.proc_info.hProcess);
+    browsePage := BrowseHistory.Peek;
+    if (browsePage^.PageType = CampaignMission) then
+      if playerHasWon(ExtractFilePath(Application.ExeName)+'infolog.txt') then
+        LoadMenu(CurrentWinStep,Campaign)
+      else if CurrentLostStep &lt;&gt; '' then
+        LoadMenu(CurrentLostStep,Campaign);
+  end;
+end;
+
+procedure TMenuForm.ExtractMissionFiles(FileName: string);
+begin
+  if DirectoryExists(MissionCurrentPath) then
+    DelTree(MissionCurrentPath);
+  SevenZip1.SZFileName := FileName;
+  SevenZip1.ExtrBaseDir := MissionCurrentPath;
+  SevenZip1.Extract(false);
+
+  // copy the default skin into the mission dir
+  CopyFile(PChar(MenuCurrentPath+'defaultMissionSkin.html'),PChar(MissionCurrentPath+'defaultMissionSkin.html'),true)
+end;
+
+procedure TMenuForm.ExtractCampaignFiles(FileName: string);
+begin
+  if DirectoryExists(CampaignCurrentPath) then
+    DelTree(CampaignCurrentPath);
+  SevenZip1.SZFileName := FileName;
+  SevenZip1.ExtrBaseDir := CampaignCurrentPath;
+  SevenZip1.Extract(false);
+
+  // copy the default skin into the mission dir
+  CopyFile(PChar(MenuCurrentPath+'defaultCampaignSkin.html'),PChar(CampaignCurrentPath+'defaultCampaignSkin.html'),true)
+end;
+
+
+procedure TMenuForm.tmrMusicTimer(Sender: TObject);
+begin
+  if (MP1.FileName &lt;&gt; '') and not (MP1.Mode = mpPlaying) then
+    MP1.Play;
+end;
+
+procedure TMenuForm.htmlBrowserControlNewWindow2(Sender: TObject;
+  var ppDisp: IDispatch; var Cancel: WordBool);
+begin
+  Cancel := true;
+end;
+
+procedure TMenuForm.htmlBrowserControlDocumentComplete(Sender: TObject;
+  const pDisp: IDispatch; var URL: OleVariant);
+begin
+    // to avoid white flashes
+    LockWindowUpdate(0);
+end;
+
+function TMenuForm.playerHasWon(scriptFileName: string): boolean;
+var
+  sl: TStringList;
+begin
+  sl := TStringList.Create;
+
+  sl.Text := ReadFile2(scriptFileName);
+
+  Result := sl.IndexOf('You win!') &lt;&gt; -1;
+
+  sl.Free;
+end;
+
+end.

Modified: trunk/Lobby/TASClient/MinimapZoomedFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/MinimapZoomedFormUnit.pas	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/MinimapZoomedFormUnit.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -13,7 +13,7 @@
 
     procedure CreateParams(var Params: TCreateParams); override;
 
-    procedure DrawStartPositions(MapInfo: TMapInfo);
+    procedure DrawStartPositions(MapInfo: TMapInfo;Image: TImage; TextSize: integer = 9);
     procedure DrawBoxes;
 
     procedure FormKeyDown(Sender: TObject; var Key: Word;
@@ -48,18 +48,18 @@
   end;
 end;
 
-procedure TMinimapZoomedForm.DrawStartPositions(MapInfo: TMapInfo);
+procedure TMinimapZoomedForm.DrawStartPositions(MapInfo: TMapInfo;Image: TImage; TextSize: integer = 9);
 var
   x, y: Integer;
   i: Integer;
   s: string;
 begin
 
-  with Image1.Canvas do
+  with Image.Canvas do
   begin
     Font.Color := clYellow;
     Font.Name := 'Fixedsys';
-    Font.Size := Round(9);
+    Font.Size := Round(TextSize);
     Font.Style := [];
     Pen.Color := clBlack;
     Brush.Style := bsSolid;
@@ -69,13 +69,13 @@
 
   for i := 0 to MapInfo.PosCount-1 do
   begin
-    x := Round(MapInfo.Positions[i].x * Image1.Picture.Bitmap.Width / (MapInfo.Width * 8) );
-    y := Round(MapInfo.Positions[i].y * Image1.Picture.Bitmap.Height / (MapInfo.Height * 8));
+    x := Round(MapInfo.Positions[i].x * Image.Picture.Bitmap.Width / (MapInfo.Width * 8) );
+    y := Round(MapInfo.Positions[i].y * Image.Picture.Bitmap.Height / (MapInfo.Height * 8));
     s := IntToStr(i+1);
 
-    with Image1.Canvas do
+    with Image.Canvas do
     begin
-      Ellipse(x - 10, y - 10, x + 10, y + 10);
+      Ellipse(x - TextSize-1, y - TextSize-1, x + TextSize+1, y + TextSize+1);
       TextOut(x - TextWidth(s) div 2, y - TextHeight(s) div 2, s);
     end;
   end;

Modified: trunk/Lobby/TASClient/Misc.pas
===================================================================
--- trunk/Lobby/TASClient/Misc.pas	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/Misc.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -11,7 +11,7 @@
 
 uses
   SpTBXItem,JvSpin,Dialogs, Classes, ComCtrls, Windows, Graphics, MMSystem, Controls, Registry, SysUtils,
-  WSocket, Winsock, ESBDates, GpTimeZone, JvColorCombo, Forms,StdCtrls,HttpProt,TntComCtrls,JclUnicode,TntSysUtils,PreferencesFormUnit;
+  WSocket, Winsock, ESBDates, GpTimeZone, JvColorCombo, Forms,StdCtrls,HttpProt,TntComCtrls,JclUnicode,TntSysUtils,PreferencesFormUnit,Variants;
 
 type
   TVerticalAlign=(alVTop,alVCenter,alVBottom);
@@ -32,7 +32,7 @@
 
 procedure ParseDelimited(const sl : TStrings; const value : string; const delimiter : string;const delimiter2: string) ;overload;
 procedure ParseDelimited(const sl : TWideStrings; const value : string; const delimiter : WideString;const delimiter2: WideString) ;overload;
-function JoinStringList(sl : TStrings;delimiter: String):String;
+function JoinStringList(sl : TStrings;delimiter: String;startIndex: integer = 0):String;
 function ShellExecuteAndWait(FileName: string; Params: string): Boolean;
 function MakeSentence(sl: TStringList; StartIndex: Integer): string;
 function MakeSentenceWS(sl: TWideStringList; StartIndex: Integer): WideString;
@@ -50,6 +50,8 @@
 function HashFile(FileName: string): Integer; // creates signed 32-bit hash code
 function VersionStringToFloat(Version: string): Single;
 function GetFileSize(FileName: string): Integer;
+function ReadFile2(FileName: string): string;
+procedure SaveFile(FileName: string;content: string);
 function VerifyName(Name: string): Boolean;
 function GetRegistryData(RootKey: HKEY; Key, Value: string): Variant;
 procedure SetRegistryData(RootKey: HKEY; Key, Value: string; RegDataType: TRegDataType; Data: Variant);
@@ -79,6 +81,8 @@
 function ColorToR(Color: Integer): Byte; // Color is in $00BBGGRR format
 function ColorToG(Color: Integer): Byte; // Color is in $00BBGGRR format
 function ColorToB(Color: Integer): Byte; // Color is in $00BBGGRR format
+function ColorToStandardRGB(Color: Integer): Integer;
+function ColorToScriptString(ColorC: TColor): string;
 function Color16BitsToR(Color: Word): Byte;
 function Color16BitsToG(Color: Word): Byte;
 function Color16BitsToB(Color: Word): Byte;
@@ -118,6 +122,10 @@
                        TextJustification:TJustify;
                        WordWrap:boolean);
 Function TextSize2(Text: string; AWidth: integer; Font: TFont = nil): TPoint;
+function VariantToString(AVar: OleVariant): string;
+function GetLongPathNameA(lpFileName:LPCTSTR;lpBuffer:LPTSTR;nBufferLength:DWORD): integer;stdcall; external 'Kernel32.dll';
+function  GetLongPathName(FileName: string): string;
+Function DelTree(DirName : string): Boolean;
 
 implementation
 
@@ -190,12 +198,12 @@
      sl.EndUpdate;
    end;
   end;
-function JoinStringList(sl : TStrings;delimiter: String):String;
+function JoinStringList(sl : TStrings;delimiter: String;startIndex: integer = 0):String;
 var
   i:integer;
 begin
   Result := '';
-  for i:=0 to sl.Count-1 do
+  for i:=startIndex to sl.Count-1 do
     if i = sl.Count-1 then
       Result := Result+sl[i]
     else
@@ -524,6 +532,25 @@
   if IOResult &lt;&gt; 0 then Result := -1;
 end;
 
+function ReadFile2(FileName: string): string;
+var
+  FileStream: TFileStream;
+begin
+  FileStream := TFileStream.Create(FileName, fmOpenRead or fmShareDenyNone);
+  SetLength(Result,FileStream.Size);
+  FileStream.ReadBuffer(Pointer(Result)^,FileStream.Size);
+  FileStream.Free;
+end;
+
+procedure SaveFile(FileName: string;content: string);
+var
+  FileStream: TFileStream;
+begin
+  FileStream := TFileStream.Create(FileName, fmOpenWrite or fmCreate);
+  FileStream.WriteBuffer(content[1],Length(content));
+  FileStream.Free;
+end;
+
 { --------------------------------------------------------------------------- }
 
 function VerifyName(Name: string): Boolean;
@@ -1073,6 +1100,23 @@
 
 { --------------------------------------------------------------------------- }
 
+function ColorToStandardRGB(Color: Integer): Integer;
+begin
+  Result := ((ColorToR(Color) shl 16) or ColorToG(Color) shl 8) or ColorToB(Color);
+end;
+
+{ --------------------------------------------------------------------------- }
+
+function ColorToScriptString(ColorC: TColor): string;
+var
+  Color: Integer;
+begin
+  Color := ColorToRGB(ColorC);
+  Result := FloatToStr(ColorToR(Color)/255)+' '+FloatToStr(ColorToG(Color)/255)+' '+FloatToStr(ColorToB(Color)/255)+' ';
+end;
+
+{ --------------------------------------------------------------------------- }
+
 function Color16BitsToR(Color: Word): Byte;
 begin
   Result := Color and $F800 shr 11;
@@ -1316,7 +1360,7 @@
 procedure OpenURLInDefaultBrowser(URL: string);
 begin
 //  ShellExecute(MainForm.Handle, nil, PChar(URL), '', '', SW_SHOW);
-  ShellExecute(MainForm.Handle, nil, PChar(AnsiString(URL)), '', '', SW_SHOWNORMAL);
+  ShellExecute(MainForm.Handle, 'open', PChar(AnsiString(URL)), '', '', SW_SHOWNORMAL);
 
 end;
 
@@ -1863,4 +1907,63 @@
   C.Free;
 end;
 
+function VariantToString(AVar: OleVariant): string;
+var
+  i: integer;
+  V: olevariant;
+begin
+  Result := '';
+  if VarType(AVar) = (varVariant or varByRef) then
+     V := Variant(TVarData(AVar).VPointer^)
+  else V := AVar;
+
+  if VarType(V) = (varByte or varArray) then
+      try
+        for i:=VarArrayLowBound(V,1) to VarArrayHighBound(V,1) do
+           Result := Result + Chr(Byte(V[i]));
+      except;
+      end
+    else Result := V;
+end;
+
+function  GetLongPathName(FileName: string): string;
+var
+  long:cardinal;
+  LongPath:array[0..max_path-1]of char;
+begin
+    long:=GetLongPathNameA(PChar(FileName),nil,0);
+    if long&gt;0 then
+    begin
+        GetLongPathNameA(PChar(FileName),LongPath,long);
+        Result:=LongPath;
+    end
+    else showmessage('IncorrectPath');
+end;
+
+Function DelTree(DirName : string): Boolean;
+var
+  SHFileOpStruct : TSHFileOpStruct;
+  DirBuf : array [0..255] of char;
+begin
+  if RightStr(DirName,1) = '\' then
+    DirName := LeftStr(DirName,Length(DirName)-1);
+  try
+   Fillchar(SHFileOpStruct,Sizeof(SHFileOpStruct),0) ;
+   FillChar(DirBuf, Sizeof(DirBuf), 0 ) ;
+   StrPCopy(DirBuf, DirName) ;
+   with SHFileOpStruct do begin
+    Wnd := 0;
+    pFrom := @DirBuf;
+    wFunc := FO_DELETE;
+    fFlags := FOF_ALLOWUNDO;
+    fFlags := fFlags or FOF_NOCONFIRMATION;
+    fFlags := fFlags or FOF_SILENT;
+   end;
+    Result := (SHFileOperation(SHFileOpStruct) = 0) ;
+   except
+    Result := False;
+  end;
+end;
+
+
 end.

Modified: trunk/Lobby/TASClient/PreferencesFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/PreferencesFormUnit.dfm	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/PreferencesFormUnit.dfm	2008-06-25 20:00:37 UTC (rev 6074)
@@ -37,7 +37,7 @@
       Width = 361
       Height = 305
       Color = clBtnFace
-      ActiveTabIndex = 1
+      ActiveTabIndex = 2
       TabAutofit = True
       HiddenItems = &lt;&gt;
       object SpTBXTabItem6: TSpTBXTabItem
@@ -46,11 +46,11 @@
       end
       object SpTBXTabItem5: TSpTBXTabItem
         Caption = 'Account'
-        Checked = True
         CustomWidth = 59
       end
       object SpTBXTabItem4: TSpTBXTabItem
         Caption = 'Program'
+        Checked = True
         CustomWidth = 59
       end
       object SpTBXTabItem3: TSpTBXTabItem
@@ -378,197 +378,6 @@
           end
         end
       end
-      object SpTBXTabSheet4: TSpTBXTabSheet
-        Left = 0
-        Top = 23
-        Width = 361
-        Height = 282
-        Caption = 'Program'
-        ImageIndex = -1
-        TabItem = 'SpTBXTabItem4'
-        object GroupBox3: TSpTBXGroupBox
-          Left = 16
-          Top = 8
-          Width = 329
-          Height = 257
-          Caption = 'Program settings'
-          Color = clNone
-          ParentColor = False
-          TabOrder = 0
-          object ResetRegistryButton: TSpTBXSpeedButton
-            Left = 200
-            Top = 224
-            Width = 113
-            Height = 22
-            Caption = 'Reset registry data'
-            OnClick = ResetRegistryButtonClick
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object GameSettingsButton: TSpTBXSpeedButton
-            Left = 200
-            Top = 96
-            Width = 113
-            Height = 22
-            Caption = 'Game settings'
-            OnClick = GameSettingsButtonClick
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object NotificationsButton: TSpTBXSpeedButton
-            Left = 200
-            Top = 48
-            Width = 113
-            Height = 22
-            Caption = 'Notifications ...'
-            OnClick = NotificationsButtonClick
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object HighlightingButton: TSpTBXSpeedButton
-            Left = 200
-            Top = 24
-            Width = 113
-            Height = 22
-            Caption = 'Highlighting ...'
-            OnClick = HighlightingButtonClick
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object IgnoreListButton: TSpTBXSpeedButton
-            Left = 200
-            Top = 72
-            Width = 113
-            Height = 22
-            Caption = 'Ignore list ...'
-            OnClick = IgnoreListButtonClick
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object Label6: TSpTBXLabel
-            Left = 16
-            Top = 32
-            Width = 46
-            Height = 13
-            Caption = 'Tab style:'
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object RadioButton4: TSpTBXRadioButton
-            Left = 16
-            Top = 56
-            Width = 38
-            Height = 15
-            Caption = 'tabs'
-            TabOrder = 0
-            TabStop = True
-            Checked = True
-          end
-          object RadioButton5: TSpTBXRadioButton
-            Left = 16
-            Top = 72
-            Width = 53
-            Height = 15
-            Caption = 'buttons'
-            TabOrder = 1
-          end
-          object RadioButton6: TSpTBXRadioButton
-            Left = 16
-            Top = 88
-            Width = 70
-            Height = 15
-            Caption = 'flat buttons'
-            TabOrder = 2
-          end
-          object CheckBox8: TSpTBXCheckBox
-            Left = 16
-            Top = 232
-            Width = 88
-            Height = 15
-            Caption = 'Enable logging'
-            TabOrder = 3
-            Checked = True
-            State = cbChecked
-          end
-          object CheckBox9: TSpTBXCheckBox
-            Left = 16
-            Top = 216
-            Width = 128
-            Height = 15
-            Caption = 'Use sound notifications'
-            TabOrder = 4
-            Checked = True
-            State = cbChecked
-          end
-          object KeyEditorButton: TSpTBXSpeedButton
-            Left = 200
-            Top = 120
-            Width = 113
-            Height = 22
-            Caption = 'Selection key editor'
-            OnClick = KeyEditorButtonClick
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object CheckForNewVersionCheckBox: TSpTBXCheckBox
-            Left = 16
-            Top = 200
-            Width = 168
-            Height = 15
-            Caption = 'Auto update lobby to latest beta'
-            TabOrder = 12
-          end
-          object ColorsButton: TSpTBXButton
-            Left = 200
-            Top = 144
-            Width = 113
-            Height = 22
-            Caption = 'Colors and font ...'
-            TabOrder = 13
-            OnClick = ColorsButtonClick
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-          object ManageGroupsButton: TSpTBXButton
-            Left = 200
-            Top = 168
-            Width = 113
-            Height = 22
-            Caption = 'Manage groups ...'
-            TabOrder = 14
-            OnClick = ManageGroupsButtonClick
-            LinkFont.Charset = DEFAULT_CHARSET
-            LinkFont.Color = clBlue
-            LinkFont.Height = -11
-            LinkFont.Name = 'MS Sans Serif'
-            LinkFont.Style = [fsUnderline]
-          end
-        end
-      end
       object SpTBXTabSheet3: TSpTBXTabSheet
         Left = 0
         Top = 23
@@ -846,6 +655,197 @@
           end
         end
       end
+      object SpTBXTabSheet4: TSpTBXTabSheet
+        Left = 0
+        Top = 23
+        Width = 361
+        Height = 282
+        Caption = 'Program'
+        ImageIndex = -1
+        TabItem = 'SpTBXTabItem4'
+        object GroupBox3: TSpTBXGroupBox
+          Left = 16
+          Top = 8
+          Width = 329
+          Height = 257
+          Caption = 'Program settings'
+          Color = clNone
+          ParentColor = False
+          TabOrder = 0
+          object ResetRegistryButton: TSpTBXSpeedButton
+            Left = 200
+            Top = 224
+            Width = 113
+            Height = 22
+            Caption = 'Reset registry data'
+            OnClick = ResetRegistryButtonClick
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object GameSettingsButton: TSpTBXSpeedButton
+            Left = 200
+            Top = 96
+            Width = 113
+            Height = 22
+            Caption = 'Game settings'
+            OnClick = GameSettingsButtonClick
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object NotificationsButton: TSpTBXSpeedButton
+            Left = 200
+            Top = 48
+            Width = 113
+            Height = 22
+            Caption = 'Notifications ...'
+            OnClick = NotificationsButtonClick
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object HighlightingButton: TSpTBXSpeedButton
+            Left = 200
+            Top = 24
+            Width = 113
+            Height = 22
+            Caption = 'Highlighting ...'
+            OnClick = HighlightingButtonClick
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object IgnoreListButton: TSpTBXSpeedButton
+            Left = 200
+            Top = 72
+            Width = 113
+            Height = 22
+            Caption = 'Ignore list ...'
+            OnClick = IgnoreListButtonClick
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object Label6: TSpTBXLabel
+            Left = 16
+            Top = 32
+            Width = 46
+            Height = 13
+            Caption = 'Tab style:'
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object RadioButton4: TSpTBXRadioButton
+            Left = 16
+            Top = 56
+            Width = 38
+            Height = 15
+            Caption = 'tabs'
+            TabOrder = 0
+            TabStop = True
+            Checked = True
+          end
+          object RadioButton5: TSpTBXRadioButton
+            Left = 16
+            Top = 72
+            Width = 53
+            Height = 15
+            Caption = 'buttons'
+            TabOrder = 1
+          end
+          object RadioButton6: TSpTBXRadioButton
+            Left = 16
+            Top = 88
+            Width = 70
+            Height = 15
+            Caption = 'flat buttons'
+            TabOrder = 2
+          end
+          object CheckBox8: TSpTBXCheckBox
+            Left = 16
+            Top = 232
+            Width = 88
+            Height = 15
+            Caption = 'Enable logging'
+            TabOrder = 3
+            Checked = True
+            State = cbChecked
+          end
+          object CheckBox9: TSpTBXCheckBox
+            Left = 16
+            Top = 216
+            Width = 128
+            Height = 15
+            Caption = 'Use sound notifications'
+            TabOrder = 4
+            Checked = True
+            State = cbChecked
+          end
+          object KeyEditorButton: TSpTBXSpeedButton
+            Left = 200
+            Top = 120
+            Width = 113
+            Height = 22
+            Caption = 'Selection key editor'
+            OnClick = KeyEditorButtonClick
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object CheckForNewVersionCheckBox: TSpTBXCheckBox
+            Left = 16
+            Top = 200
+            Width = 168
+            Height = 15
+            Caption = 'Auto update lobby to latest beta'
+            TabOrder = 12
+          end
+          object ColorsButton: TSpTBXButton
+            Left = 200
+            Top = 144
+            Width = 113
+            Height = 22
+            Caption = 'Colors and font ...'
+            TabOrder = 13
+            OnClick = ColorsButtonClick
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+          object ManageGroupsButton: TSpTBXButton
+            Left = 200
+            Top = 168
+            Width = 113
+            Height = 22
+            Caption = 'Manage groups ...'
+            TabOrder = 14
+            OnClick = ManageGroupsButtonClick
+            LinkFont.Charset = DEFAULT_CHARSET
+            LinkFont.Color = clBlue
+            LinkFont.Height = -11
+            LinkFont.Name = 'MS Sans Serif'
+            LinkFont.Style = [fsUnderline]
+          end
+        end
+      end
     end
     object ApplyAndCloseButton: TSpTBXButton
       Left = 24

Modified: trunk/Lobby/TASClient/ReplaysUnit.pas
===================================================================
--- trunk/Lobby/TASClient/ReplaysUnit.pas	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/ReplaysUnit.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -956,7 +956,12 @@
   SaveButton.Enabled := False;
 
   try
-    lblStartPos.Caption := 'Start pos : '+BattleForm.StartPosRadioGroup.Items[Replay.Script.ReadStartPosType];
+
+    if Replay.Script.ReadStartPosType = 3 then
+      lblStartPos.Caption := 'Start pos : Choose in lobby'
+    else
+      lblStartPos.Caption := 'Start pos : '+BattleForm.StartPosRadioGroup.Items[Replay.Script.ReadStartPosType];
+
     lblGameEnd.Caption := 'Game end condition: '+BattleForm.GameEndRadioGroup.Items[Replay.Script.ReadGameMode];
     lblMetal.Caption := 'Start metal : '+IntToStr(Replay.Script.ReadStartMetal);
     lblEnergy.Caption := 'Start energy : '+IntToStr(Replay.Script.ReadStartEnergy);

Modified: trunk/Lobby/TASClient/TASClient.dof
===================================================================
--- trunk/Lobby/TASClient/TASClient.dof	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/TASClient.dof	2008-06-25 20:00:37 UTC (rev 6074)
@@ -100,7 +100,7 @@
 DebugSourceDirs=
 UsePackages=0
 [Parameters]
-RunParams=
+RunParams=-menu
 HostApplication=C:\Program Files\Spring\TASClient.exe
 Launcher=
 UseLauncher=0
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=3
 Release=0
-Build=317
+Build=320
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=TA Spring lobby client
-FileVersion=0.3.0.317
+FileVersion=0.3.0.320
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: trunk/Lobby/TASClient/TASClient.dpr
===================================================================
--- trunk/Lobby/TASClient/TASClient.dpr	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/TASClient.dpr	2008-06-25 20:00:37 UTC (rev 6074)
@@ -100,7 +100,13 @@
   Classes,
   Dialogs,
   StrUtils,
-  SearchPlayerFormUnit in 'SearchPlayerFormUnit.pas' {SearchPlayerForm};
+  SearchPlayerFormUnit in 'SearchPlayerFormUnit.pas' {SearchPlayerForm},
+  MenuFormUnit in 'MenuFormUnit.pas' {MenuForm},
+  UWebBrowserWrapper in 'UWebBrowserWrapper.pas',
+  IntfDocHostUIHandler in 'IntfDocHostUIHandler.pas',
+  UContainer in 'UContainer.pas',
+  UNulContainer in 'UNulContainer.pas',
+  class_TIntegerList in 'class_TIntegerList.pas';
 
 var
   i: Integer;
@@ -117,7 +123,8 @@
   // read command line arguments:
   for i := 1 to ParamCount do
   begin
-    MainUnit.RunningUnderWine := MainUnit.RunningUnderWine or (UpperCase(ParamStr(i)) = 'WINE') or (UpperCase(ParamStr(i)) = '-WINE');
+    MainUnit.RunningUnderWine := MainUnit.RunningUnderWine or (UpperCase(ParamStr(i)) = '-WINE');
+    MainUnit.RunningWithMainMenu := MainUnit.RunningUnderWine or (UpperCase(ParamStr(i)) = '-MENU');
     if UpperCase(ParamStr(i)) = '-SERVER' then
       if (ParamCount = i) or (Pos(':',ParamStr(i+1)) = 0) then
         MessageDlg('Wrong -server usage : -server myserver.com:8200',mtWarning,[mbOk],0)
@@ -168,7 +175,6 @@
   else if IsWindowsVista then
     SpTBXItem.ActivateTitleBarsOnStartUp := False;
 
-
   Application.Title := 'TASClient';
   Application.CreateForm(TMainForm, MainForm);
   Application.CreateForm(TColorPickerForm, ColorPickerForm);
@@ -207,6 +213,7 @@
   Application.CreateForm(TAwayMessageForm, AwayMessageForm);
   Application.CreateForm(TColorsPreference, ColorsPreference);
   Application.CreateForm(TSearchPlayerForm, SearchPlayerForm);
+  Application.CreateForm(TMenuForm, MenuForm);
   SplashScreenForm.UpdateText('Initializing ...');
 
   Application.Run;

Modified: trunk/Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)

Added: trunk/Lobby/TASClient/UContainer.pas
===================================================================
--- trunk/Lobby/TASClient/UContainer.pas	                        (rev 0)
+++ trunk/Lobby/TASClient/UContainer.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,168 @@
+{
+  This demo application accompanies the article
+  &quot;How to customise the TWebBrowser user interface&quot; on
+  <A HREF="http://www.delphidabbler.com/articles?article=18.">http://www.delphidabbler.com/articles?article=18.</A>
+
+  The demo implements the 2nd phase of the sample application presented in the
+  article. It mimics a dialog box that uses the web browser control. The browser
+  takes on the appearance of the dialog box.
+
+  This code is copyright (c) P D Johnson (www.delphidabbler.com), 2004-2006.
+
+  v1.0 of 2006/02/06 - original version
+}
+
+
+{$A8,B-,C+,D+,E-,F-,G+,H+,I+,J-,K-,L+,M-,N+,O+,P+,Q-,R-,S-,T-,U-,V+,W-,X+,Y+,Z1}
+{$WARN UNSAFE_TYPE OFF}
+{$WARN UNSAFE_CODE OFF}
+
+
+unit UContainer;
+
+interface
+
+uses
+  Windows, ActiveX, ShDocVw,
+  UNulContainer, IntfDocHostUIHandler;
+
+type
+
+  TWBContainer = class(TNulWBContainer, IDocHostUIHandler, IOleClientSite)
+  private
+    fUseCustomCtxMenu: Boolean;
+    fShowScrollBars: Boolean;
+    fShow3DBorder: Boolean;
+    fAllowTextSelection: Boolean;
+    fCSS: string;
+  protected
+    { Re-implemented IDocHostUIHandler methods }
+    function ShowContextMenu(
+      const dwID: DWORD;
+      const ppt: PPOINT;
+      const pcmdtReserved: IUnknown;
+      const pdispReserved: IDispatch): HResult; stdcall;
+    function GetHostInfo(
+      var pInfo: TDocHostUIInfo): HResult; stdcall;
+      function GetOptionKeyPath(var pchKey: POLESTR; const dw: DWORD ): HResult;stdcall;
+  public
+    constructor Create(const HostedBrowser: TWebBrowser);
+    property UseCustomCtxMenu: Boolean
+      read fUseCustomCtxMenu write fUseCustomCtxMenu default False;
+    property Show3DBorder: Boolean
+      read fShow3DBorder write fShow3DBorder default True;
+    property ShowScrollBars: Boolean
+      read fShowScrollBars write fShowScrollBars default True;
+    property AllowTextSelection: Boolean
+      read fAllowTextSelection write fAllowTextSelection default True;
+    property CSS: string
+      read fCSS write fCSS;
+  end;
+
+implementation
+
+uses
+  SysUtils, Themes;
+
+{
+  TaskAllocWideString is taken from the CodeSnip database at
+  <A HREF="http://www.delphidabbler.com/codesnip">http://www.delphidabbler.com/codesnip</A>
+}
+
+function TaskAllocWideString(const S: string): PWChar;
+var
+  StrLen: Integer;  // length of string in bytes
+begin
+  // Store length of string in characters, allowing for terminal #0
+  StrLen := Length(S) + 1;
+  // Allocate buffer for wide string using task allocator
+  Result := CoTaskMemAlloc(StrLen * SizeOf(WideChar));
+  if Assigned(Result) then
+    // Convert string to wide string and store in buffer
+    StringToWideChar(S, Result, StrLen);
+end;
+
+{ TWBContainer }
+
+constructor TWBContainer.Create(const HostedBrowser: TWebBrowser);
+begin
+  inherited;
+  fUseCustomCtxMenu := False;
+  fShowScrollBars := True;
+  fShow3DBorder := True;
+  fAllowTextSelection := True;
+  fCSS := '';
+end;
+
+function TWBContainer.GetOptionKeyPath(var pchKey: POLESTR; const dw: DWORD ): HResult;
+var
+  ResultLen: Integer;
+begin
+    ResultLen := MultiByteToWideChar(CP_ACP, 0, PChar('Software\TASClient\IE'), -1, NIL, 0);
+    pchKey := CoTaskMemAlloc(ResultLen * SizeOf(WideChar));
+    if Assigned(pchKey) then
+      MultiByteToWideChar(CP_ACP, 0, PChar('Software\TASClient\IE'), -1,pchKey, ResultLen);
+    Result := S_OK;
+end;
+
+function TWBContainer.GetHostInfo(
+  var pInfo: TDocHostUIInfo): HResult;
+{These constants are defined in IntfUIHandlers
+const
+  DOCHOSTUIFLAG_SCROLL_NO = $00000008;
+  DOCHOSTUIFLAG_NO3DBORDER = $00000004;
+  DOCHOSTUIFLAG_DIALOG = $00000001;
+  DOCHOSTUIFLAG_THEME = $00040000;
+  DOCHOSTUIFLAG_NOTHEME = $00080000;
+}
+begin
+  try
+    // Clear structure and set size
+    ZeroMemory(@pInfo, SizeOf(TDocHostUIInfo));
+    pInfo.cbSize := SizeOf(TDocHostUIInfo);
+    // Set scroll bar visibility
+    if not fShowScrollBars then
+      pInfo.dwFlags := pInfo.dwFlags or DOCHOSTUIFLAG_SCROLL_NO;
+    // Set border visibility
+    if not fShow3DBorder then
+      pInfo.dwFlags := pInfo.dwFlags or DOCHOSTUIFLAG_NO3DBORDER;
+    // Decide if text can be selected
+    if not fAllowTextSelection then
+      pInfo.dwFlags := pInfo.dwFlags or DOCHOSTUIFLAG_DIALOG;
+    // Ensure browser uses XP themes if application is doing
+    if ThemeServices.ThemesEnabled then
+      pInfo.dwFlags := pInfo.dwFlags or DOCHOSTUIFLAG_THEME
+    else if ThemeServices.ThemesAvailable then
+      pInfo.dwFlags := pInfo.dwFlags or DOCHOSTUIFLAG_NOTHEME;
+    // Record default CSS as Unicode
+    pInfo.pchHostCss := TaskAllocWideString(fCSS);
+    if not Assigned(pInfo.pchHostCss) then
+      raise Exception.Create('Task allocator can''t allocate CSS string');
+    // Return S_OK to indicate we've made changes
+    Result := S_OK;
+  except
+    // Return E_FAIL on error
+    Result := E_FAIL;
+  end;
+end;
+
+function TWBContainer.ShowContextMenu(
+  const dwID: DWORD;
+  const ppt: PPOINT;
+  const pcmdtReserved: IInterface;
+  const pdispReserved: IDispatch): HResult;
+begin
+  if fUseCustomCtxMenu then
+  begin
+    // tell IE we're handling the context menu
+    Result := S_OK;
+    if Assigned(HostedBrowser.PopupMenu) then
+      // browser has a pop up menu so activate it
+      HostedBrowser.PopupMenu.Popup(ppt.X, ppt.Y);
+  end
+  else
+    // tell IE to use default action: display own menu
+    Result := S_FALSE;
+end;
+
+end.

Added: trunk/Lobby/TASClient/UNulContainer.pas
===================================================================
--- trunk/Lobby/TASClient/UNulContainer.pas	                        (rev 0)
+++ trunk/Lobby/TASClient/UNulContainer.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,304 @@
+{
+  This demo application accompanies the article
+  &quot;How to customise the TWebBrowser user interface&quot; on
+  <A HREF="http://www.delphidabbler.com/articles?article=18.">http://www.delphidabbler.com/articles?article=18.</A>
+
+  The demo implements the 2nd phase of the sample application presented in the
+  article. It mimics a dialog box that uses the web browser control. The browser
+  takes on the appearance of the dialog box.
+
+  This code is copyright (c) P D Johnson (www.delphidabbler.com), 2004-2006.
+
+  v1.0 of 2006/02/06 - original version
+}
+
+
+{$A8,B-,C+,D+,E-,F-,G+,H+,I+,J-,K-,L+,M-,N+,O+,P+,Q-,R-,S-,T-,U-,V+,W-,X+,Y+,Z1}
+{$WARN UNSAFE_TYPE OFF}
+
+
+unit UNulContainer;
+
+interface
+
+
+uses
+  Windows, ActiveX, SHDocVw,
+  IntfDocHostUIHandler;
+
+type
+
+  TNulWBContainer = class(TObject,
+    IUnknown, IOleClientSite, IDocHostUIHandler)
+  private
+    fHostedBrowser: TWebBrowser;
+    // Registration method
+    procedure SetBrowserOleClientSite(const Site: IOleClientSite);
+  protected
+    { IUnknown }
+    function QueryInterface(const IID: TGUID; out Obj): HResult; stdcall;
+    function _AddRef: Integer; stdcall;
+    function _Release: Integer; stdcall;
+    { IOleClientSite }
+    function SaveObject: HResult; stdcall;
+    function GetMoniker(dwAssign: Longint;
+      dwWhichMoniker: Longint;
+      out mk: IMoniker): HResult; stdcall;
+    function GetContainer(
+      out container: IOleContainer): HResult; stdcall;
+    function ShowObject: HResult; stdcall;
+    function OnShowWindow(fShow: BOOL): HResult; stdcall;
+    function RequestNewObjectLayout: HResult; stdcall;
+    { IDocHostUIHandler }
+    function ShowContextMenu(const dwID: DWORD; const ppt: PPOINT;
+      const pcmdtReserved: IUnknown; const pdispReserved: IDispatch): HResult;
+      stdcall;
+    function GetHostInfo(var pInfo: TDocHostUIInfo): HResult; stdcall;
+    function ShowUI(const dwID: DWORD;
+      const pActiveObject: IOleInPlaceActiveObject;
+      const pCommandTarget: IOleCommandTarget; const pFrame: IOleInPlaceFrame;
+      const pDoc: IOleInPlaceUIWindow): HResult; stdcall;
+    function HideUI: HResult; stdcall;
+    function UpdateUI: HResult; stdcall;
+    function EnableModeless(const fEnable: BOOL): HResult; stdcall;
+    function OnDocWindowActivate(const fActivate: BOOL): HResult; stdcall;
+    function OnFrameWindowActivate(const fActivate: BOOL): HResult; stdcall;
+    function ResizeBorder(const prcBorder: PRECT;
+      const pUIWindow: IOleInPlaceUIWindow; const fFrameWindow: BOOL): HResult;
+      stdcall;
+    function TranslateAccelerator(const lpMsg: PMSG; const pguidCmdGroup: PGUID;
+      const nCmdID: DWORD): HResult; stdcall;
+    function GetOptionKeyPath(var pchKey: POLESTR; const dw: DWORD ): HResult;
+      stdcall;
+    function GetDropTarget(const pDropTarget: IDropTarget;
+      out ppDropTarget: IDropTarget): HResult; stdcall;
+    function GetExternal(out ppDispatch: IDispatch): HResult; stdcall;
+    function TranslateUrl(const dwTranslate: DWORD; const pchURLIn: POLESTR;
+      var ppchURLOut: POLESTR): HResult; stdcall;
+    function FilterDataObject(const pDO: IDataObject;
+      out ppDORet: IDataObject): HResult; stdcall;
+  public
+    constructor Create(const HostedBrowser: TWebBrowser);
+    destructor Destroy; override;
+    property HostedBrowser: TWebBrowser read fHostedBrowser;
+  end;
+
+
+implementation
+
+uses
+  SysUtils;
+
+{ TNulWBContainer }
+
+constructor TNulWBContainer.Create(const HostedBrowser: TWebBrowser);
+begin
+  Assert(Assigned(HostedBrowser));
+  inherited Create;
+  fHostedBrowser := HostedBrowser;
+  SetBrowserOleClientSite(Self as IOleClientSite);
+end;
+
+destructor TNulWBContainer.Destroy;
+begin
+  SetBrowserOleClientSite(nil);
+  inherited;
+end;
+
+function TNulWBContainer.EnableModeless(const fEnable: BOOL): HResult;
+begin
+  { Return S_OK to indicate we handled (ignored) OK }
+  Result := S_OK;
+end;
+
+function TNulWBContainer.FilterDataObject(const pDO: IDataObject;
+  out ppDORet: IDataObject): HResult;
+begin
+  { Return S_FALSE to show no data object supplied.
+    We *must* also set ppDORet to nil }
+  ppDORet := nil;
+  Result := S_FALSE;
+end;
+
+function TNulWBContainer.GetContainer(
+  out container: IOleContainer): HResult;
+  {Returns a pointer to the container's IOleContainer
+  interface}
+begin
+  { We do not support IOleContainer.
+    However we *must* set container to nil }
+  container := nil;
+  Result := E_NOINTERFACE;
+end;
+
+function TNulWBContainer.GetDropTarget(const pDropTarget: IDropTarget;
+  out ppDropTarget: IDropTarget): HResult;
+begin
+  { Return E_FAIL since no alternative drop target supplied.
+    We *must* also set ppDropTarget to nil }
+  ppDropTarget := nil;
+  Result := E_FAIL;
+end;
+
+function TNulWBContainer.GetExternal(out ppDispatch: IDispatch): HResult;
+begin
+  { Return E_FAIL to indicate we failed to supply external object.
+    We *must* also set ppDispatch to nil }
+  ppDispatch := nil;
+  Result := E_FAIL;
+end;
+
+function TNulWBContainer.GetHostInfo(var pInfo: TDocHostUIInfo): HResult;
+begin
+  { Return S_OK to indicate UI is OK without changes }
+  Result := S_OK;
+end;
+
+function TNulWBContainer.GetMoniker(dwAssign, dwWhichMoniker: Integer;
+  out mk: IMoniker): HResult;
+  {Returns a moniker to an object's client site}
+begin
+  { We don't support monikers.
+    However we *must* set mk to nil }
+  mk := nil;
+  Result := E_NOTIMPL;
+end;
+
+function TNulWBContainer.GetOptionKeyPath(var pchKey: POLESTR;
+  const dw: DWORD): HResult;
+begin
+  { Return E_FAIL to indicate we failed to override
+    default registry settings }
+  Result := E_FAIL;
+end;
+
+function TNulWBContainer.HideUI: HResult;
+begin
+  { Return S_OK to indicate we handled (ignored) OK }
+  Result := S_OK;
+end;
+
+function TNulWBContainer.OnDocWindowActivate(
+  const fActivate: BOOL): HResult;
+begin
+  { Return S_OK to indicate we handled (ignored) OK }
+  Result := S_OK;
+end;
+
+function TNulWBContainer.OnFrameWindowActivate(
+  const fActivate: BOOL): HResult;
+begin
+  { Return S_OK to indicate we handled (ignored) OK }
+  Result := S_OK;
+end;
+
+function TNulWBContainer.OnShowWindow(fShow: BOOL): HResult;
+  {Notifies a container when an embedded object's window
+  is about to become visible or invisible}
+begin
+  { Return S_OK to pretend we've responded to this }
+  Result := S_OK;
+end;
+
+function TNulWBContainer.QueryInterface(const IID: TGUID; out Obj): HResult;
+begin
+  if GetInterface(IID, Obj) then
+    Result := S_OK
+  else
+    Result := E_NOINTERFACE;
+end;
+
+function TNulWBContainer.RequestNewObjectLayout: HResult;
+  {Asks container to allocate more or less space for
+  displaying an embedded object}
+begin
+  { We don't support requests for a new layout }
+  Result := E_NOTIMPL;
+end;
+
+function TNulWBContainer.ResizeBorder(const prcBorder: PRECT;
+  const pUIWindow: IOleInPlaceUIWindow; const fFrameWindow: BOOL): HResult;
+begin
+  { Return S_FALSE to indicate we did nothing in response }
+  Result := S_FALSE;
+end;
+
+function TNulWBContainer.SaveObject: HResult;
+  {Saves the object associated with the client site}
+begin
+  { Return S_OK to pretend we've done this }
+  Result := S_OK;
+end;
+
+procedure TNulWBContainer.SetBrowserOleClientSite(
+  const Site: IOleClientSite);
+var
+  OleObj: IOleObject;
+begin
+  Assert((Site = Self as IOleClientSite) or (Site = nil));
+  if not Supports(
+    fHostedBrowser.DefaultInterface, IOleObject, OleObj
+  ) then
+    raise Exception.Create(
+      'Browser''s Default interface does not support IOleObject'
+    );
+  OleObj.SetClientSite(Site);
+end;
+
+function TNulWBContainer.ShowContextMenu(const dwID: DWORD;
+  const ppt: PPOINT; const pcmdtReserved: IInterface;
+  const pdispReserved: IDispatch): HResult;
+begin
+  { Return S_FALSE to notify we didn't display a menu and to
+  let browser display its own menu }
+  Result := S_FALSE
+end;
+
+function TNulWBContainer.ShowObject: HResult;
+  {Tells the container to position the object so it is
+  visible to the user}
+begin
+  { Return S_OK to pretend we've done this }
+  Result := S_OK;
+end;
+
+function TNulWBContainer.ShowUI(const dwID: DWORD;
+  const pActiveObject: IOleInPlaceActiveObject;
+  const pCommandTarget: IOleCommandTarget; const pFrame: IOleInPlaceFrame;
+  const pDoc: IOleInPlaceUIWindow): HResult;
+begin
+  { Return S_OK to say we displayed own UI }
+  Result := S_OK;
+end;
+
+function TNulWBContainer.TranslateAccelerator(const lpMsg: PMSG;
+  const pguidCmdGroup: PGUID; const nCmdID: DWORD): HResult;
+begin
+  { Return S_FALSE to indicate no accelerators are translated }
+  Result := S_FALSE;
+end;
+
+function TNulWBContainer.TranslateUrl(const dwTranslate: DWORD;
+  const pchURLIn: POLESTR; var ppchURLOut: POLESTR): HResult;
+begin
+  { Return E_FAIL to indicate that no translations took place }
+  Result := E_FAIL;
+end;
+
+function TNulWBContainer.UpdateUI: HResult;
+begin
+  { Return S_OK to indicate we handled (ignored) OK }
+  Result := S_OK;
+end;
+
+function TNulWBContainer._AddRef: Integer;
+begin
+  Result := -1;
+end;
+
+function TNulWBContainer._Release: Integer;
+begin
+  Result := -1;
+end;
+
+end.

Added: trunk/Lobby/TASClient/UWebBrowserWrapper.pas
===================================================================
--- trunk/Lobby/TASClient/UWebBrowserWrapper.pas	                        (rev 0)
+++ trunk/Lobby/TASClient/UWebBrowserWrapper.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,346 @@
+{
+ * ***** BEGIN LICENSE BLOCK *****
+ * 
+ * Version: MPL 1.1
+ * 
+ * The contents of this file are subject to the Mozilla Public License Version
+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with the
+ * License. You may obtain a copy of the License at <A HREF="http://www.mozilla.org/MPL/">http://www.mozilla.org/MPL/</A>
+ * 
+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,
+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for
+ * the specific language governing rights and limitations under the License.
+ * 
+ * The Original Code is &quot;TWebBrowser IO Wrapper Class&quot;.
+ * 
+ * The Initial Developer of the Original Code is Peter Johnson
+ * (<A HREF="http://www.delphidabbler.com/">http://www.delphidabbler.com/</A>).
+ * 
+ * Portions created by the Initial Developer are Copyright (C) 2004 Peter
+ * Johnson. All Rights Reserved.
+ * 
+ * Contributor(s):
+ * 
+ * ***** END LICENSE BLOCK *****
+}
+
+
+{
+  IMPORTANT NOTE
+  --------------
+
+  The code presented here accompanies the article &quot;How to load and save
+  documents in TWebBrowser in a Delphi-like way&quot; which can be found at
+  <A HREF="http://www.delphidabbler.com/articles.php?article=14.">http://www.delphidabbler.com/articles.php?article=14.</A>
+
+  The code is presented for demonstration purposes only. It should not be used
+  in a production environment without thoroughly testing it first. No guarantee
+  or warranty as to the suitability of this code is provided and it is used at
+  your own risk.
+}
+
+
+{$A8,B-,C+,D+,E-,F-,G+,H+,I+,J-,K-,L+,M-,N+,O+,P+,Q-,R-,S-,T-,U-,V+,W-,X+,Y+,Z1}
+
+unit UWebBrowserWrapper;
+
+interface
+
+uses
+  // Delphi
+  Classes, SHDocVw;
+
+type
+  // Save &quot;style&quot; used in TWebBrowserWrapper.Save*** methods
+  TWebBrowserSaveStyle = (wbsAll, wbsBodyHTML, wbsBodyText);
+
+  // Wrapper class
+  TWebBrowserWrapper = class(TObject)
+  private
+    fWebBrowser: TWebBrowser;  // wrapped control
+  protected // &quot;Helper&quot; methods
+    procedure InternalLoadDocumentFromStream(const Stream: TStream);
+    procedure InternalSaveBodyHTMLToStream(const Stream: TStream);
+    procedure InternalSaveBodyTextToStream(const Stream: TStream);
+    procedure InternalSaveDocumentToStream(const Stream: TStream);
+  public
+    constructor Create(const WebBrowser: TWebBrowser);
+    procedure LoadFromFile(const FileName: string);
+    procedure LoadFromStream(const Stream: TStream);
+    procedure LoadFromString(const HTML: string);
+    function NavigateToLocalFile(const FileName: string): Boolean;
+    procedure NavigateToResource(const Module: HMODULE; const ResName: PChar;
+      const ResType: PChar = nil); overload;
+    procedure NavigateToResource(const ModuleName: string; const ResName: PChar;
+      const ResType: PChar = nil); overload;
+    procedure NavigateToURL(const URL: string);
+    function SaveToString(const Style: TWebBrowserSaveStyle = wbsAll): string;
+    procedure SaveToStream(const Stream: TStream;
+      const Style: TWebBrowserSaveStyle = wbsAll);
+    procedure SaveToFile(const FileName: string;
+      const Style: TWebBrowserSaveStyle = wbsAll);
+    property WebBrowser: TWebBrowser read fWebBrowser;
+  end;
+
+implementation
+
+uses
+  // Delphi
+  SysUtils, StrUtils, Windows, ActiveX, Forms, MSHTML;
+
+
+{ Help routines }
+
+{ 
+  Following function from DelphiDabbler CodeSnippets database at
+  <A HREF="http://www.delphidabbler.com/codensip.php">http://www.delphidabbler.com/codensip.php</A>
+}
+
+function URLEncode(const S: string): string;
+var
+  Idx: Integer; // loops thru characters in string
+begin
+  Result := '';
+  for Idx := 1 to Length(S) do
+  begin
+    case S[Idx] of
+      'A'..'Z', 'a'..'z', '0'..'9', '-', '_', '.': Result := Result + S[Idx];
+      ' ': Result := Result + '+';
+      else Result := Result + '%' + SysUtils.IntToHex(Ord(S[Idx]), 2);
+    end;
+  end;
+end;
+
+{
+  Following 2 functions from DelphiDabbler article &quot;How to create and use HTML
+  resource files&quot; at <A HREF="http://www.delphidabbler.com/articles.php?article=10">http://www.delphidabbler.com/articles.php?article=10</A>
+}
+
+function MakeResourceURL(const ModuleName: string; const ResName: PChar;
+  const ResType: PChar = nil): string; overload;
+  // ---------------------------------------------------------------------------
+  function ResNameOrTypeToString(R: PChar): string;
+  begin
+    if HiWord(LongWord(R)) = 0 then
+      // high word = 0 =&gt; numeric resource id
+      // numeric value is stored in low word
+      Result := Format('#%d', [LoWord(LongWord(R))])
+    else
+      // high word &lt;&gt; 0 =&gt; string value
+      // PChar is implicitly converted to string
+      Result := R;
+  end;
+  // ---------------------------------------------------------------------------
+begin
+  Assert(ModuleName &lt;&gt; '');
+  Assert(Assigned(ResName));
+  Result := '<A HREF="res://">res://</A>' + URLEncode(ModuleName);
+  if Assigned(ResType) then
+    Result := Result + '/' + URLEncode(ResNameOrTypeToString(ResType));
+  Result := Result + '/' + URLEncode(ResNameOrTypeToString(ResName));
+end;
+
+function MakeResourceURL(const Module: HMODULE; const ResName: PChar;
+  const ResType: PChar = nil): string; overload;
+begin
+  Result := MakeResourceURL(GetModuleName(Module), ResName, ResType);
+end;
+
+
+{ TWebBrowserWrapper }
+
+constructor TWebBrowserWrapper.Create(const WebBrowser: TWebBrowser);
+begin
+  inherited Create;
+  fWebBrowser := WebBrowser;
+end;
+
+procedure TWebBrowserWrapper.InternalLoadDocumentFromStream(
+  const Stream: TStream);
+var
+  PersistStreamInit: IPersistStreamInit;
+  StreamAdapter: IStream;
+begin
+  Assert(Assigned(WebBrowser.Document));
+  // Get IPersistStreamInit interface on document object
+  if WebBrowser.Document.QueryInterface(
+    IPersistStreamInit, PersistStreamInit
+  ) = S_OK then
+  begin
+    // Clear document
+    if PersistStreamInit.InitNew = S_OK then
+    begin
+      // Get IStream interface on stream
+      StreamAdapter:= TStreamAdapter.Create(Stream);
+      // Load data from Stream into WebBrowser
+      PersistStreamInit.Load(StreamAdapter);
+    end;
+  end;
+end;
+
+procedure TWebBrowserWrapper.InternalSaveBodyHTMLToStream(
+  const Stream: TStream);
+var
+  HTMLStr: string;
+  Doc: IHTMLDocument2;
+  BodyElement: IHTMLElement;
+begin
+  Assert(Assigned(WebBrowser.Document));
+  if WebBrowser.Document.QueryInterface(IHTMLDocument2, Doc) = S_OK then
+  begin
+    BodyElement := Doc.body;
+    if Assigned(BodyElement) then
+    begin
+      HTMLStr := BodyElement.innerHTML;
+      Stream.WriteBuffer(HTMLStr[1], Length(HTMLStr));
+    end;
+  end;
+end;
+
+procedure TWebBrowserWrapper.InternalSaveBodyTextToStream(
+  const Stream: TStream);
+var
+  TextStr: string;
+  Doc: IHTMLDocument2;
+  BodyElement: IHTMLElement;
+begin
+  Assert(Assigned(WebBrowser.Document));
+  if WebBrowser.Document.QueryInterface(IHTMLDocument2, Doc) = S_OK then
+  begin
+    BodyElement := Doc.body;
+    if Assigned(BodyElement) then
+    begin
+      TextStr := BodyElement.innerText;
+      Stream.WriteBuffer(TextStr[1], Length(TextStr));
+    end;
+  end;
+end;
+
+procedure TWebBrowserWrapper.InternalSaveDocumentToStream(
+  const Stream: TStream);
+var
+  StreamAdapter: IStream;
+  PersistStreamInit: IPersistStreamInit;
+begin
+  Assert(Assigned(WebBrowser.Document));
+  if WebBrowser.Document.QueryInterface(
+    IPersistStreamInit, PersistStreamInit
+  ) = S_OK then
+  begin
+    StreamAdapter := TStreamAdapter.Create(Stream);
+    PersistStreamInit.Save(StreamAdapter, True);
+  end;
+end;
+
+procedure TWebBrowserWrapper.LoadFromFile(const FileName: string);
+var
+  FileStream: TFileStream;
+begin
+  FileStream := TFileStream.Create(FileName, fmOpenRead or fmShareDenyNone);
+  try
+    LoadFromStream(FileStream);
+  finally
+    FileStream.Free;
+  end;
+end;
+
+procedure TWebBrowserWrapper.LoadFromStream(const Stream: TStream);
+begin
+  NavigateToURL('about:blank');
+  InternalLoadDocumentFromStream(Stream);
+end;
+
+procedure TWebBrowserWrapper.LoadFromString(const HTML: string);
+var
+  StringStream: TStringStream;
+begin
+  StringStream := TStringStream.Create(HTML);
+  try
+    LoadFromStream(StringStream);
+  finally
+    StringStream.Free;
+  end;
+end;
+
+function TWebBrowserWrapper.NavigateToLocalFile(const FileName: string): Boolean;
+begin
+  Result := FileExists(FileName);
+  if Result then
+    NavigateToURL('<A HREF="file://">file://</A>' + FileName)
+end;
+
+procedure TWebBrowserWrapper.NavigateToResource(const Module: HMODULE;
+  const ResName, ResType: PChar);
+begin
+  NavigateToURL(MakeResourceURL(Module, ResName, ResType));
+end;
+
+procedure TWebBrowserWrapper.NavigateToResource(const ModuleName: string;
+  const ResName, ResType: PChar);
+begin
+  NavigateToURL(MakeResourceURL(ModuleName, ResName, ResType));
+end;
+
+procedure TWebBrowserWrapper.NavigateToURL(const URL: string);
+var
+  Flags: OleVariant;  // flags that determine action
+begin
+  // Don't record in history
+  Flags := navNoHistory;
+  if AnsiStartsText('<A HREF="res://">res://</A>', URL) or AnsiStartsText('<A HREF="file://">file://</A>', URL)
+    or AnsiStartsText('about:', URL) or AnsiStartsText('javascript:', URL)
+    or AnsiStartsText('mailto:', URL) then
+    // don't use cache for local files
+    Flags := Flags or navNoReadFromCache or navNoWriteToCache;
+  // Do the navigation and wait for it to complete
+  WebBrowser.Navigate(WideString(URL), Flags);
+  while WebBrowser.ReadyState &lt;&gt; READYSTATE_COMPLETE do
+  begin
+    Application.ProcessMessages;
+    Sleep(0);
+  end;
+end;
+
+procedure TWebBrowserWrapper.SaveToFile(const FileName: string;
+  const Style: TWebBrowserSaveStyle);
+var
+  FileStream: TFileStream;
+begin
+  FileStream := TFileStream.Create(FileName, fmCreate);
+  try
+    SaveToStream(FileStream, Style);
+  finally
+    FileStream.Free;
+  end;
+end;
+
+procedure TWebBrowserWrapper.SaveToStream(const Stream: TStream;
+  const Style: TWebBrowserSaveStyle);
+begin
+  if Assigned(WebBrowser.Document) then
+  begin
+    case Style of
+      wbsAll:      InternalSaveDocumentToStream(Stream);
+      wbsBodyHTML: InternalSaveBodyHTMLToStream(Stream);
+      wbsBodyText: InternalSaveBodyTextToStream(Stream);
+    end;
+  end;
+end;
+
+function TWebBrowserWrapper.SaveToString(
+  const Style: TWebBrowserSaveStyle): string;
+var
+  StringStream: TStringStream;
+begin
+  // For BodyHTML and BodyText this has unnecessary string-&gt;stream-string
+  // conversion that we live with for the sake of clarity of coding
+  StringStream := TStringStream.Create('');
+  try
+    SaveToStream(StringStream, Style);
+    Result := StringStream.DataString;
+  finally
+    StringStream.Free;
+  end;
+end;
+
+end.

Modified: trunk/Lobby/TASClient/Utility.pas
===================================================================
--- trunk/Lobby/TASClient/Utility.pas	2008-06-25 18:01:22 UTC (rev 6073)
+++ trunk/Lobby/TASClient/Utility.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -8,7 +8,7 @@
 interface
 
 uses
-  Windows, Graphics, Classes, SyncObjs, Controls,Math;
+  Windows, Graphics, Classes, SyncObjs, Controls,Math,MainUnit;
 
 type
 
@@ -54,6 +54,7 @@
 function AcquireMapInfo(MapName: string): TMapInfo;
 procedure ReloadModList;
 function GetModHash(ModName: string): Integer;
+function GetModHash2(ModArchive: string): Integer;
 procedure LoadMod(ModName: string);
 procedure ReloadUnitList; // will populate UnitNames and UnitList lists
 procedure ReloadSides; // populates SideList list and loads side images into SideImageList
@@ -62,6 +63,7 @@
 function GetLuaAIList:TStrings;
 function GetModValidMapList: TStringList;
 function GetMapArchive(mapName: String):String;
+function GetArchiveDescriptor(FileName: string): String;
 
 var
   ModList: TStrings; // names of mods
@@ -83,7 +85,7 @@
 implementation
 
 uses
-  SysUtils, StrUtils, Dialogs, Forms, Misc, MainUnit, InitWaitFormUnit,
+  SysUtils, StrUtils, Dialogs, Forms, Misc, InitWaitFormUnit,
   MapListFormUnit, SplashScreenUnit, BattleFormUnit, PreferencesFormUnit;
 
 
@@ -428,7 +430,6 @@
 function GetModHash(ModName: string): Integer;
 var
   index: Integer;
-  i: Integer;
 begin
   Result := 0;
   index := ModList.IndexOf(ModName);
@@ -437,6 +438,17 @@
   Result := GetPrimaryModChecksum(index)
 end;
 
+function GetModHash2(ModArchive: string): Integer;
+var
+  index: Integer;
+begin
+  Result := 0;
+  index := ModArchiveList.IndexOf(ModArchive);
+  if index = -1 then Exit;
+  if Debug.Enabled then MainForm.AddMainLog('Hashing file: ' + ModList[index], Colors.MinorInfo);
+  Result := GetPrimaryModChecksum(index);
+end;
+
 { ------------------------------------------------------------------------ }
 
 { don't forget to reinit unitsync.dll each time you change mod (except for the first time)! }
@@ -690,7 +702,30 @@
   Result := GetMapArchiveName(0);
 end;
 
+function GetArchiveDescriptor(FileName: string): String;
+var
+  archiveHwd,fileHwd,size: integer;
+  fileContent: string;
+begin
+  Result := '';
+  archiveHwd := OpenArchive(PChar(FileName));
+  if archiveHwd &lt;&gt; 0 then
+  begin
+    fileHwd := OpenArchiveFile(archiveHwd,'descriptor.tdf');
+    if fileHwd &lt;&gt; 0 then
+    begin
+      size := SizeArchiveFile(archiveHwd, fileHwd);
+      fileContent := '';
+      SetLength(fileContent,size);
+      ReadArchiveFile(archiveHwd,fileHwd,PChar(fileContent),size);
+      Result := fileContent;
+      CloseArchiveFile(archiveHwd,fileHwd);
+    end;
+    CloseArchive(archiveHwd);
+  end;
+end;
 
+
 { ------------------------------------------------------------------------ }
 
 initialization

Added: trunk/Lobby/TASClient/class_TIntegerList.pas
===================================================================
--- trunk/Lobby/TASClient/class_TIntegerList.pas	                        (rev 0)
+++ trunk/Lobby/TASClient/class_TIntegerList.pas	2008-06-25 20:00:37 UTC (rev 6074)
@@ -0,0 +1,296 @@
+{ Nom        : TIntegerList
+Fonction     : Classe de list pour valeur Integer
+Auteur       : Khemi
+Date         : 18 mars 2003
+
+Modification : Add getnext modif first -&gt; Getfirst
+Date         : 31 mars 2003
+Par          : Khemi
+}
+
+unit class_TIntegerList;
+
+interface
+uses
+  Sysutils,classes;
+  
+type
+  TIntegerList =class(TList)
+  
+  {m&#233;thodes}
+  Protected
+  Fposition:Integer;             //position du item courant
+  function GetItem(Index: Integer): Integer;
+  procedure PutItem(Index: Integer; Item: Integer);
+  
+  Public
+  constructor Create;
+  destructor  Destroy; override;
+  
+  procedure Add(Item : Integer);              // ajout 1 item a la fin
+  procedure Clear;  override;                 // efface tout
+  procedure Delete(Index: Integer);           // efface 1 item position definie
+  procedure Insert(Index: Integer; Item : Integer); //ajout 1 item position definie
+  function  Remove(Item : Integer): Integer;       //supprime 1 item position definie
+  function  GetLast(var sample : Integer): Boolean;  //retourne le dernier
+  function  IndexOf(Item: Integer): Integer;           //retourne l'index de la premiere occurence
+  function  GetFirst(var sample : Integer):Boolean;   // retourne le premier
+  function  GetNext(var sample : Integer; var index : Integer):Boolean;   // retourne le suivant
+  
+  {propri&#233;t&#233;s}
+  property Items[Index: Integer]: Integer read GetItem write PutItem; // default;
+  
+end;
+
+implementation
+
+
+//------------------------------------------------------------------------------
+//constructeur
+constructor TIntegerList.Create();
+begin
+  try
+    inherited Create;
+    Fposition:=-1;
+  except
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//retourne l'index de la premiere occurence
+function TIntegerList.IndexOf(Item: Integer): Integer;
+var
+  ptr : ^Integer;
+  cpt : Integer;
+  
+begin
+  try
+    cpt:=0;
+    ptr:=  inherited Items[cpt];
+    while (Item&lt;&gt;ptr^) AND (cpt&lt;Count-1) do
+    begin
+      Inc(cpt);
+      ptr:=  inherited Items[cpt];
+    end;
+    if (Item=ptr^) then
+      IndexOf:=cpt
+    else
+      IndexOf:=-1;
+  except
+    IndexOf:=-1;
+    raise;
+  end;
+  
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//recupere la valeur a un index sp&#233;cifi&#233;
+function TIntegerList.GetItem(Index: Integer): Integer;
+var
+  ptr : ^Integer;
+  
+begin
+  try
+    ptr:= inherited Items[Index];
+    GetItem:=ptr^;
+  except
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//met une valeur a l'index sp&#233;cifi&#233;
+procedure TIntegerList.PutItem(Index: Integer; Item: Integer);
+var
+  ptr : ^Integer;
+  
+begin
+  try
+    ptr:= inherited Items[Index];
+    ptr^:=  Item;
+  except
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//efface tous les &#233;lements de la liste
+procedure TIntegerList.Clear;
+var
+  cpt  : Integer;
+  ptr  : ^Integer;
+  
+begin
+  try
+    for cpt:=0  to Count-1 do
+    begin
+      ptr:= inherited Items[cpt];
+      if (ptr&lt;&gt;nil) then Dispose(ptr);
+    end;
+    inherited Clear;
+  except
+    raise;
+  end;
+  
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//supprime la 1ere occurance dans le tableau renvoye 'lindex de l'element sup
+function TIntegerList.Remove(Item : Integer): Integer;
+var
+  cpt : Integer;
+  
+begin
+  try
+    cpt:=IndexOf(Item);
+    Delete(cpt);
+    Remove:=cpt;
+  except
+    Remove:=-1;
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//retourne le premier &#233;l&#233;ment du tableau
+function TIntegerList.GetFirst(var sample : Integer): Boolean;
+var
+  ptr : ^Integer;
+  
+begin
+  try
+    
+    ptr:= inherited Items[0];
+    sample:=ptr^;
+    GetFirst:=True;
+    Fposition:=1;
+  except
+    GetFirst:=False;
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//retourne le prochain &#233;l&#233;ment
+function  TIntegerList.GetNext(var sample : Integer; var index : Integer):Boolean;
+var
+  ptr : ^Integer;
+  
+begin
+  try
+    ptr:= inherited Items[Fposition];
+    sample:=ptr^;
+    index:=Fposition;
+    GetNext:=True;
+    Inc(Fposition);
+  except
+    GetNext:=False;
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//retourne la valeur du dernier
+function TIntegerList.GetLast(var sample: Integer):Boolean;
+var
+  ptr : ^Integer;
+  
+begin
+  try
+    ptr:= inherited Items[Count-1];
+    sample:=ptr^;
+    GetLast:=True;
+  except
+    GetLast:=False;
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//ajoute un element dans la liste a la fin
+procedure TIntegerList.Add(Item : Integer);
+var
+  ptr : ^Integer;
+  
+begin
+  try
+    New(ptr);
+    ptr^:= Item;
+    inherited Add(ptr);
+  except
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//supprime un &#233;l&#233;ment a un endroit pr&#233;cis
+procedure TIntegerList.Delete(Index: Integer);
+var
+  ptr : ^Integer;
+  
+begin
+  try
+    ptr:= inherited Items[Index];
+    dispose(ptr);
+    inherited Delete(Index);
+  except
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//ajoute un element &#224; un endroit precis
+procedure TIntegerList.Insert(Index: Integer; Item: Integer);
+var
+  ptr : ^Integer;
+  
+begin
+  try
+    New(ptr);
+    ptr^:= Item;
+    inherited Insert(Index,ptr);
+  except
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------------
+//destructeur de l'instance
+destructor TIntegerList.Destroy;
+begin
+  try
+    Clear;
+    inherited Destroy;
+  except
+    raise;
+  end;
+end;
+//------------------------------------------------------------------------------
+
+
+end.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000853.html">[Taspring-linux-commit] r6073 - in trunk: rts rts/System	rts/lib/gml tools/DedicatedServer
</A></li>
	<LI>Next message: <A HREF="000855.html">[Taspring-linux-commit] r6075 - trunk/Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#854">[ date ]</a>
              <a href="thread.html#854">[ thread ]</a>
              <a href="subject.html#854">[ subject ]</a>
              <a href="author.html#854">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
