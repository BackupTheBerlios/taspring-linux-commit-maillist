<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6006 - in trunk/Lobby/BattleHubFramework:	. src src/aflobby
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6006%20-%20in%20trunk/Lobby/BattleHubFramework%3A%0A%09.%20src%20src/aflobby&In-Reply-To=%3C20080609023540.9FF6A47CD%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000784.html">
   <LINK REL="Next"  HREF="000787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6006 - in trunk/Lobby/BattleHubFramework:	. src src/aflobby</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6006%20-%20in%20trunk/Lobby/BattleHubFramework%3A%0A%09.%20src%20src/aflobby&In-Reply-To=%3C20080609023540.9FF6A47CD%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6006 - in trunk/Lobby/BattleHubFramework:	. src src/aflobby">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Mon Jun  9 04:35:40 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000784.html">[Taspring-linux-commit] r6005 - in trunk/Lobby: .	BattleHubFramework BattleHubFramework/build	BattleHubFramework/nbproject	BattleHubFramework/nbproject/private BattleHubFramework/src	BattleHubFramework/src/org BattleHubFramework/src/org/darkstars	BattleHubFramework/src/org/darkstars/battlehub	BattleHubFramework/src/org/darkstars/battlehub/framework	BattleHubFramework/src/org/darkstars/battlehub/framework/protocol	BattleHubFramework/src/org/darkstars/battlehub/framework/protocol/tasserver
</A></li>
        <LI>Next message: <A HREF="000787.html">[Taspring-linux-commit] r6007 -	trunk/Lobby/BattleHubFramework/src/org/darkstars/battlehub/framework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#786">[ date ]</a>
              <a href="thread.html#786">[ thread ]</a>
              <a href="subject.html#786">[ subject ]</a>
              <a href="author.html#786">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: tnowell
Date: 2008-06-09 04:35:39 +0200 (Mon, 09 Jun 2008)
New Revision: 6006

Added:
   trunk/Lobby/BattleHubFramework/src/aflobby/
   trunk/Lobby/BattleHubFramework/src/aflobby/CUnitSyncJNIBindings.java
Removed:
   trunk/Lobby/BattleHubFramework/build/
   trunk/Lobby/BattleHubFramework/dist/
Log:
- removed dist and build folders, these will be auto-added by netbeans when a build begins
- moved unitsync bindings to framework

Added: trunk/Lobby/BattleHubFramework/src/aflobby/CUnitSyncJNIBindings.java
===================================================================
--- trunk/Lobby/BattleHubFramework/src/aflobby/CUnitSyncJNIBindings.java	                        (rev 0)
+++ trunk/Lobby/BattleHubFramework/src/aflobby/CUnitSyncJNIBindings.java	2008-06-09 02:35:39 UTC (rev 6006)
@@ -0,0 +1,223 @@
+/*
+ * CUnitSyncJNIBindings.java
+ *
+ * Created on 31 May 2006, 14:43
+ *
+ * To change this template, choose Tools | Template Manager
+ * and open the template in the editor.
+ */
+
+package aflobby;
+
+/**
+ * CUnitSyncJNIBindings.java
+ *
+ *
+ *
+ * @author AF
+ */
+
+class OptionType {
+	public static int opt_error  = 0;
+	public static int opt_bool   = 1;
+	public static int opt_list   = 2;
+	public static int opt_number = 3;
+	public static int opt_string = 4;
+};
+
+//CUnitSyncJNIBindings
+public class CUnitSyncJNIBindings {
+
+    /**
+     * Creates a new instance of CUnitSyncJNIBindings
+     */
+    public CUnitSyncJNIBindings() {
+    }
+
+    // load up the UnitSync.dll/UnitSync.so library
+    /**
+     * A boolean signifying if the library is loaded. If the library is
+     */
+    public static boolean loaded = false;
+
+    public static void LoadUnitSync(String libpath) throws UnsatisfiedLinkError{
+
+//        try {
+            /*if (Misc.isWindows()) {
+                System.loadLibrary(&quot;unitsync&quot;);
+//                java.lang.Runtime.getRuntime ().load (intendedpath+System.getProperty (&quot;file.separator&quot;)+&quot;unitsync.dll&quot;);
+            } else {*/
+                //;
+                System.load(libpath);
+            //}
+
+            //if(Misc.isWindows() &amp;&amp; (!Main.dev_environment)){
+            //    Misc.getURLContent(&quot;<A HREF="http://www.darkstars.co.uk/linkcounter.php">http://www.darkstars.co.uk/linkcounter.php</A>&quot;,&quot;&quot;);
+            //}
+            
+//            if(CContentManager.installed_engines.contains(&quot;spring&quot;)==false){
+//                CContentManager.installed_engines.add(&quot;spring&quot;);
+//            }
+//            loaded=true;
+//        } catch (final java.lang.UnsatisfiedLinkError e) {
+//            if(Misc.isWindows()&amp;&amp; (!Misc.dev_environment)){
+//                Misc.getURLContent(&quot;<A HREF="http://www.darkstars.co.uk/ulinkcounter.php">http://www.darkstars.co.uk/ulinkcounter.php</A>&quot;,&quot;&quot;);
+//            }
+//            java.awt.EventQueue.invokeLater(new Runnable() {
+//
+//                @Override
+//                public void run() {
+//                    new WarningWindow(&quot;&lt;font face=\&quot;Arial\&quot; color=\&quot;&quot; + ColourHelper.ColourToHex(Color.BLACK) + &quot;\&quot;&gt;&lt;font size=20&gt; Unsatisfied link error&lt;/font&gt;&lt;br&gt;&lt;br&gt; Make sure you have a JNI aware UnitSync library, and that it is compiled correctly. Such a library should come as standard with spring 0.75+. If under linux, check that you've correctly edited the tags in settings.tdf to point to unitsync.so and spring.&lt;br&gt;&lt;br&gt; AFlobby needs the unitsync library to be able to use spring.&lt;br&gt;&lt;br&gt;Linux users need unitsync.so&lt;br&gt;&lt;br&gt; Windows users need unitsync.dll&lt;br&gt;&lt;br&gt; Apple Mac users need unitsync.dylib (Mac is not entirely supported and upto date mac builds of unitsync arent included due to time restrictions)&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot; + e.getLocalizedMessage() + &quot;&lt;br&gt;&lt;br&gt;&lt;b&gt; path variable =&lt;/b&gt; &lt;i&gt;&quot; + System.getProperty(&quot;user.dir&quot;) + &quot;&lt;/i&gt;&lt;br&gt; &lt;b&gt; library path = &lt;/b&gt;&lt;i&gt;&quot; + System.getProperty(&quot;java.library.path&quot;) +&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;+e.toString()+ &quot;&lt;/i&gt;&lt;/font&gt;&quot;, &quot;JNI Error&quot;).setVisible
 (true);
+//                }
+//            });
+//            e.printStackTrace();
+//            loaded=false;
+//        } /*catch (Exception e){
+        //            java.awt.EventQueue.invokeLater (new Runnable () {
+        //                public void run () {
+        //                    new WarningWindow (&quot;&lt;font face=\&quot;Arial\&quot; color=\&quot;&quot;+ColourHelper.ColourToHex (Color.WHITE)+&quot;\&quot;&gt;&lt;font size=20&gt;UnitSync Exception error&lt;/font&gt;&lt;br&gt;&lt;br&gt; Make sure you have a JNI aware UnitSync library in the same folder as AFLobby, and that it is compiled correctly using the latest java bindings.&lt;br&gt;&lt;br&gt; AFlobby needs the unitsync library to be able to use spring.&lt;br&gt;&lt;br&gt;Linux users need libjavaunitsync.so&lt;br&gt;&lt;br&gt; Windows users need javaunitsync.dll&lt;br&gt;&lt;br&gt; Apple Mac users need libjavaunitsync.dylib (Mac is not entirely supported and upto date mac builds of unitsync arent included due to time restrictions)&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt; path variable =&lt;/b&gt; &lt;i&gt;&quot;+ System.getProperty (&quot;user.dir&quot;)+&quot;&lt;/i&gt;&lt;br&gt; &lt;b&gt; library path = &lt;/b&gt;&lt;i&gt;&quot;+System.getProperty(&quot;java.library.path&quot;)+&quot;&lt;/i&gt;&lt;/font&gt;&quot;,
+        //                        &quot;UnitSync Error&quot;
+        //                        ).setVisible (true);
+        //                }
+        //            });
+        //        }*/
+        //return loaded;
+    }
+
+
+    public static native String     GetSpringVersion        ();
+
+    public static native void       Message                 (String p_szMessage);
+
+    public static native int        Init                    (boolean isServer, int id);
+    public static native void       UnInit                  ();
+
+    public static native int        ProcessUnits            ();
+    public static native int        ProcessUnitsNoChecksum  ();
+
+    public static native String     GetCurrentList          ();
+
+    public static native void       AddClient               (int id, String unitList);
+    public static native void       RemoveClient            (int id);
+
+    public static native String     GetClientDiff           (int id);
+    public static native void       InstallClientDiff       (String diff);
+
+    public static native int        GetUnitCount            ();
+    public static native String     GetUnitName             (int unit);
+    public static native String     GetFullUnitName         (int unit);
+    public static native int        IsUnitDisabled          (int unit);
+    public static native int        IsUnitDisabledByClient  (int unit, int clientId);
+
+
+    public static native void       AddArchive              (String name);
+    public static native void       AddAllArchives          (String root);
+
+    public static native String     GetArchiveChecksum      (String arname); //unsigned integer
+
+    public static native int        GetMapCount             ();
+    public static native String     GetMapName              (int index);
+
+    //public static native int      GetMapInfoEx(String name, MapInfo outInfo, int version);
+
+    //public static native void*    GetMinimap(String filename, int miplevel);
+    
+    public static native int        GetMapArchiveCount      (String mapName);
+    public static native String     GetMapArchiveName       (int index);
+    public static native String     GetMapChecksum          (int index); // unsigned
+
+    public static native int        GetPrimaryModCount      ();
+
+    public static native String     GetPrimaryModName       (int index);
+    public static native String     GetPrimaryModArchive    (int index);
+    public static native int        GetPrimaryModArchiveCount(int index);
+    public static native String     GetPrimaryModArchiveList(int arnr);
+
+    public static native int        GetPrimaryModIndex      (String name);
+
+    public static native String     GetPrimaryModChecksum   (int index); //unsigned
+    public static native String     GetPrimaryModChecksumFromName(String name);
+    
+    public static native String     GetPrimaryModDescription(int index);
+    public static native String     GetPrimaryModMutator    (int index);
+    public static native String     GetPrimaryModVersion    (int index);
+    public static native String     GetPrimaryModShortGame  (int index);
+    public static native String     GetPrimaryModGame       (int index);
+    public static native String     GetPrimaryModShortName  (int index);
+
+    public static native int        GetSideCount            ();
+    public static native String     GetSideName             (int side);
+
+
+    public static native int        OpenFileVFS             (String name);
+    public static native void       CloseFileVFS            (int handle);
+    public static native String     ReadFileVFS             (int handle);
+    public static native int        FileSizeVFS             (int handle);
+
+    public static native int        InitFindVFS             ();
+    public static native String     SearchVFS               (String pattern);
+    
+    public static native int        OpenArchive             (String name);
+    public static native void       CloseArchive            (int archive);
+    public static native int        FindFilesArchive        (int archive, int cur, String nameBuf, int size);
+
+    public static native int        OpenArchiveFile         (int archive, String name);
+    public static native String     ReadArchiveFile         (int archive, int handle);
+    public static native void       CloseArchiveFile        (int archive, int handle);
+    public static native int        SizeArchiveFile         (int archive, int handle);
+
+    public static native String     GetDataDirs             (boolean write);
+
+    public static native boolean    WriteMiniMap            (String mapfile, String imagename, int miplevel);
+    
+    // 0.76b1+ additions
+    
+    public static native String     GetMapInfo();
+    
+    
+    // Spring settings and configuration options
+    
+    public static native void       SetSpringConfigFloat    (String name, float value);
+    public static native void       SetSpringConfigInt      (String name, int value);
+    public static native void       SetSpringConfigString   (String name, String value);
+    
+    public static native float      GetSpringConfigFloat    (String name, float defvalue);
+    public static native int        GetSpringConfigInt      (String name, int defvalue);
+    public static native String     GetSpringConfigString   (String name, String defvalue);
+    
+    
+    // lua custom lobby settings
+    
+    public static native int        GetMapOptionCount       (String mapName);
+    public static native int        GetModOptionCount       ();
+    
+    public static native String     GetOptionKey            (int optIndex);
+    public static native String     GetOptionName           (int optIndex);
+    public static native String     GetOptionDesc           (int optIndex);
+    public static native int        GetOptionType           (int optIndex);
+    
+    
+    // boolean options
+    
+    public static native int        GetOptionBoolDef        (int optIndex);
+    
+    
+    // Number Options
+    public static native float      GetOptionNumberDef      (int optIndex);
+    public static native float      GetOptionNumberMin      (int optIndex);
+    public static native float      GetOptionNumberMax      (int optIndex);
+    public static native float      GetOptionNumberStep     (int optIndex);
+    
+    // String options
+    public static native String     GetOptionStringDef      (int optIndex);
+    public static native int        GetOptionStringMaxLen   (int optIndex);
+    
+    // List options
+    public static native int        GetOptionListCount      (int optIndex);
+    public static native String     GetOptionListDef        (int optIndex);
+    public static native String     GetOptionListItemKey    (int optIndex, int itemIndex);
+    public static native String     GetOptionListItemName   (int optIndex, int itemIndex);
+    public static native String     GetOptionListItemDesc   (int optIndex, int itemIndex);
+    
+    
+}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000784.html">[Taspring-linux-commit] r6005 - in trunk/Lobby: .	BattleHubFramework BattleHubFramework/build	BattleHubFramework/nbproject	BattleHubFramework/nbproject/private BattleHubFramework/src	BattleHubFramework/src/org BattleHubFramework/src/org/darkstars	BattleHubFramework/src/org/darkstars/battlehub	BattleHubFramework/src/org/darkstars/battlehub/framework	BattleHubFramework/src/org/darkstars/battlehub/framework/protocol	BattleHubFramework/src/org/darkstars/battlehub/framework/protocol/tasserver
</A></li>
	<LI>Next message: <A HREF="000787.html">[Taspring-linux-commit] r6007 -	trunk/Lobby/BattleHubFramework/src/org/darkstars/battlehub/framework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#786">[ date ]</a>
              <a href="thread.html#786">[ thread ]</a>
              <a href="subject.html#786">[ subject ]</a>
              <a href="author.html#786">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
