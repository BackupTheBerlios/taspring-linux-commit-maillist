<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6052 - in trunk/AI/Global/NTai/AI/NTai:	Agents Core Engine Helpers Helpers/Terrain Helpers/Units	Helpers/grid Units Units/Behaviours
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6052%20-%20in%20trunk/AI/Global/NTai/AI/NTai%3A%0A%09Agents%20Core%20Engine%20Helpers%20Helpers/Terrain%20Helpers/Units%0A%09Helpers/grid%20Units%20Units/Behaviours&In-Reply-To=%3C20080620143841.11765452D%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000831.html">
   <LINK REL="Next"  HREF="000833.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6052 - in trunk/AI/Global/NTai/AI/NTai:	Agents Core Engine Helpers Helpers/Terrain Helpers/Units	Helpers/grid Units Units/Behaviours</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6052%20-%20in%20trunk/AI/Global/NTai/AI/NTai%3A%0A%09Agents%20Core%20Engine%20Helpers%20Helpers/Terrain%20Helpers/Units%0A%09Helpers/grid%20Units%20Units/Behaviours&In-Reply-To=%3C20080620143841.11765452D%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6052 - in trunk/AI/Global/NTai/AI/NTai:	Agents Core Engine Helpers Helpers/Terrain Helpers/Units	Helpers/grid Units Units/Behaviours">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Fri Jun 20 16:38:40 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000831.html">[Taspring-linux-commit] r6051 - trunk/rts/Lua
</A></li>
        <LI>Next message: <A HREF="000833.html">[Taspring-linux-commit] r6053 - trunk/rts/ExternalAI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#832">[ date ]</a>
              <a href="thread.html#832">[ thread ]</a>
              <a href="subject.html#832">[ subject ]</a>
              <a href="author.html#832">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: tnowell
Date: 2008-06-20 16:38:38 +0200 (Fri, 20 Jun 2008)
New Revision: 6052

Modified:
   trunk/AI/Global/NTai/AI/NTai/Agents/CManufacturer.cpp
   trunk/AI/Global/NTai/AI/NTai/Core/CMessage.cpp
   trunk/AI/Global/NTai/AI/NTai/Engine/COrderRouter.cpp
   trunk/AI/Global/NTai/AI/NTai/Helpers/CEconomy.cpp
   trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/CBuildingPlacer.cpp
   trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/CBuildingPlacer.h
   trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/DTHandler.cpp
   trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/DTHandler.h
   trunk/AI/Global/NTai/AI/NTai/Helpers/Units/CUnitDefLoader.cpp
   trunk/AI/Global/NTai/AI/NTai/Helpers/grid/CGridManager.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/AttackBehaviour.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CDGunBehaviour.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CKamikazeBehaviour.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CMoveFailReclaimBehaviour.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CRetreatBehaviour.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CStaticDefenceBehaviour.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/MetalMakerBehaviour.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/CConfigTaskManager.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/CUnit.cpp
   trunk/AI/Global/NTai/AI/NTai/Units/CUnit.h
   trunk/AI/Global/NTai/AI/NTai/Units/CUnitTypeData.cpp
Log:
- some code cleanup, comments removed, top of file comment specifying licence, some formatting changed around etc

Modified: trunk/AI/Global/NTai/AI/NTai/Agents/CManufacturer.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Agents/CManufacturer.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Agents/CManufacturer.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,8 +1,10 @@
-//-------------------------------------------------------------------------
-// NTai
-// Copyright 2004-2007 AF
-// Released under GPL 2 license
-//-------------------------------------------------------------------------
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
 
 // CManufacturer
 #include &quot;../Core/include.h&quot;

Modified: trunk/AI/Global/NTai/AI/NTai/Core/CMessage.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Core/CMessage.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Core/CMessage.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,5 +1,9 @@
 /*
-AF 2007
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
 */
 
 #include &quot;../Core/include.h&quot;

Modified: trunk/AI/Global/NTai/AI/NTai/Engine/COrderRouter.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Engine/COrderRouter.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Engine/COrderRouter.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,4 +1,11 @@
-// COrderRouter
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
 #include &quot;../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Helpers/CEconomy.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Helpers/CEconomy.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Helpers/CEconomy.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,10 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
 #include &quot;../Core/include.h&quot;
 
 /*

Modified: trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/CBuildingPlacer.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/CBuildingPlacer.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/CBuildingPlacer.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,11 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {
@@ -60,11 +68,7 @@
 								}else if(G-&gt;UnitDefLoader-&gt;HasUnit(&quot;bit&quot;)!= 0){
 									G-&gt;cb-&gt;DrawUnit(&quot;bit&quot;, pos, 1, 35, 0, true, false, 0);
 								}
-								//G-&gt;cb-&gt;DrawUnit(&quot;armpw&quot;,pos,1,35,0,false,false,0);
-								//G-&gt;cb-&gt;DrawUnit(&quot;arm_peewee&quot;,pos,1,35,0,false,false,0);
 							}
-							//int k = G-&gt;cb-&gt;CreateLineFigure(pos,pos+float3(16,50,0),10,1,10,0);
-							//G-&gt;cb-&gt;SetFigureColor(k,1,0,0,0.5);
 						}
 					}
 				}
@@ -97,208 +101,169 @@
 				}
 			}
 		}
-		/*slopemap.Initialize(mapdim,float3(32,0,32),true);
-		 slopemap.SetDefaultGridValue(0);
-		 slopemap.SetMinimumValue(0);
-		 slopemap.UseArray(slope,smaxW*smaxH,smaxH,smaxW);*/
 
-		/*	geomap.Initialize(mapdim,float3(124,0,124),true);
-		 geomap.SetDefaultGridValue(0);
-		 geomap.SetMinimumValue(0);*/
-
-		/*const float* heightmaparray = G-&gt;cb-&gt;GetHeightMap();
-		lowheightmap.Initialize(mapdim, float3(32, 0, 32), true);
-		lowheightmap.SetDefaultGridValue(0);
-		lowheightmap.SetMinimumValue(0);
-		lowheightmap.UseArrayLowValues(heightmaparray, smaxW*smaxH*2, smaxH*2, smaxW*2);
-
-		highheightmap.Initialize(mapdim, float3(32, 0, 32), true);
-		highheightmap.SetDefaultGridValue(0);
-		highheightmap.SetMinimumValue(0);
-		highheightmap.UseArrayHighValues(heightmaparray, smaxW*smaxH*2, smaxH*2, smaxW*2);*/
-
 		blockingmap.Initialize(mapdim, float3(32, 0, 32), true);
 		blockingmap.SetDefaultGridValue(0);
 		blockingmap.SetMinimumValue(1);
 
-		/*G-&gt;RegisterMessageHandler(&quot;unitcreated&quot;, me);
-		G-&gt;RegisterMessageHandler(&quot;unitdestroyed&quot;, me);
-		G-&gt;RegisterMessageHandler(&quot;unitidle&quot;, me);
-		G-&gt;RegisterMessageHandler(&quot;update&quot;, me);*/
 		return true;
 	}
 
-	/*float3 CBuildingPlacer::GetBuildPos(float3 builderpos, const UnitDef* builder, const UnitDef* building, float freespace){
-		if(G-&gt;UnitDefHelper-&gt;IsFactory(builder)&amp;&amp;(!G-&gt;UnitDefHelper-&gt;IsHub(builder))){
-			if(G-&gt;UnitDefHelper-&gt;IsMobile(building)){
-				return builderpos;
-			}
-		}
-		return findfreespace(building, builderpos, freespace, 1000);
-	}*/
 
-	class CBuildAlgorithm : public IModule{
-	public:
-		CBuildAlgorithm(CBuildingPlacer* buildalgorithm, IModule* reciever, float3 builderpos, CUnitTypeData* wbuilder, CUnitTypeData* wbuilding, float freespace, CGridManager* blockingmap, const float* heightmap, float3 mapdim, Global* G):
-			buildalgorithm(buildalgorithm),
-			reciever(reciever),
-			builderpos(builderpos),
-			builder(wbuilder),
-			building(wbuilding),
-			freespace(freespace),
-			blockingmap(blockingmap),
-			heightmap(heightmap),
-			mapdim(mapdim),
-			valid(true),
-			G(G){ }
+	CBuildAlgorithm::CBuildAlgorithm(CBuildingPlacer* buildalgorithm, IModule* reciever, float3 builderpos, CUnitTypeData* wbuilder, CUnitTypeData* wbuilding, float freespace, CGridManager* blockingmap, const float* heightmap, float3 mapdim, Global* G):
+		buildalgorithm(buildalgorithm),
+		reciever(reciever),
+		builderpos(builderpos),
+		builder(wbuilder),
+		building(wbuilding),
+		freespace(freespace),
+		blockingmap(blockingmap),
+		heightmap(heightmap),
+		mapdim(mapdim),
+		valid(true),
+		G(G)
+	{
+		//
+	}
 
-		void RecieveMessage(CMessage &amp;message){}
-		bool Init(){ return true;}
-		void operator()(){
-			//boost::mutex::scoped_lock lock(io_mutex[building-&gt;id]);
-			if(!reciever-&gt;IsValid()) return;
-			float3 bestPosition = UpVector;
-			float bestDistance = 500000.0f;
-			if(G-&gt;L.IsVerbose()){
-				AIHCAddMapPoint ac;
-				ac.label=new char[11];
-				ac.label=&quot;build algo&quot;;
-				ac.pos = builderpos;
-				G-&gt;cb-&gt;HandleCommand(AIHCAddMapPointId,&amp;ac);
-			}
+	void CBuildAlgorithm::RecieveMessage(CMessage &amp;message){
+		//
+	}
 
-			float search_radius = freespace+3000;
-			if(builder-&gt;IsHub()){
-				search_radius = builder-&gt;GetUnitDef()-&gt;buildDistance;
-			}
-			CUBuild b;
-			b.Init(G, builder, 0);
-			int e=0;
-			vector&lt;float3&gt; cells = blockingmap-&gt;GetCellsInRadius(builderpos, search_radius, e);
+	bool CBuildAlgorithm::Init(){
+		return true;
+	}
 
-			if(!cells.empty()){
+	void CBuildAlgorithm::operator()(){
+		//boost::mutex::scoped_lock lock(io_mutex[building-&gt;id]);
+		if(!reciever-&gt;IsValid()) return;
+		float3 bestPosition = UpVector;
+		float bestDistance = 500000.0f;
+		if(G-&gt;L.IsVerbose()){
+			AIHCAddMapPoint ac;
+			ac.label=new char[11];
+			ac.label=&quot;build algo&quot;;
+			ac.pos = builderpos;
+			G-&gt;cb-&gt;HandleCommand(AIHCAddMapPointId,&amp;ac);
+		}
 
-				bestDistance = freespace+2001;
+		float search_radius = freespace+3000;
+		if(builder-&gt;IsHub()){
+			search_radius = builder-&gt;GetUnitDef()-&gt;buildDistance;
+		}
+		CUBuild b;
+		b.Init(G, builder, 0);
+		int e=0;
+		vector&lt;float3&gt; cells = blockingmap-&gt;GetCellsInRadius(builderpos, search_radius, e);
 
-				for(vector&lt;float3&gt;::iterator i = cells.begin(); i != cells.end(); ++i){// for each cell
+		if(!cells.empty()){
 
-					if(!valid){
-						bestPosition = UpVector;
-						break;
-					}
+			bestDistance = freespace+2001;
 
-					// check the reciever is still valid
-					// The reciever may have died during this threads running so we need to stop if its
-					// invalid to prevent running overtime
-					if(reciever-&gt;IsValid()==false){
-						break;
-					}
+			for(vector&lt;float3&gt;::iterator i = cells.begin(); i != cells.end(); ++i){// for each cell
 
-					float3 gpos = *i;
+				if(!valid){
+					bestPosition = UpVector;
+					break;
+				}
 
-					if(blockingmap-&gt;ValidGridPos(gpos)==false){
-						continue;
-					}
+				// check the reciever is still valid
+				// The reciever may have died during this threads running so we need to stop if its
+				// invalid to prevent running overtime
+				if(reciever-&gt;IsValid()==false){
+					break;
+				}
 
-					float3 mpos = blockingmap-&gt;GridtoMap(gpos);
+				float3 gpos = *i;
 
-					if(blockingmap-&gt;ValidMapPos(mpos)==false){
-						continue;
-					}
+				if(blockingmap-&gt;ValidGridPos(gpos)==false){
+					continue;
+				}
 
-					float distance = mpos.distance2D(builderpos);
+				float3 mpos = blockingmap-&gt;GridtoMap(gpos);
 
-					if(distance &lt; bestDistance){
-						bool good = true;
+				if(blockingmap-&gt;ValidMapPos(mpos)==false){
+					continue;
+				}
 
-						// check our blocking map
-						vector&lt;float3&gt; cells2 = blockingmap-&gt;GetCellsInRadius(mpos, freespace);
+				float distance = mpos.distance2D(builderpos);
 
-						if(!cells2.empty()){
+				if(distance &lt; bestDistance){
+					bool good = true;
 
-							//for each cell
-							for(vector&lt;float3&gt;::iterator i2 = cells2.begin(); i2 != cells2.end(); ++i2){
+					// check our blocking map
+					vector&lt;float3&gt; cells2 = blockingmap-&gt;GetCellsInRadius(mpos, freespace);
 
-								if (blockingmap-&gt;GetValuebyGrid(*i2) == 3){
+					if(!cells2.empty()){
 
-									good = false;
-									break;
-								}
-							}
+						//for each cell
+						for(vector&lt;float3&gt;::iterator i2 = cells2.begin(); i2 != cells2.end(); ++i2){
 
-						}else{
+							if (blockingmap-&gt;GetValuebyGrid(*i2) == 3){
 
-							good = false;//continue;
+								good = false;
+								break;
+							}
 						}
 
-						// if good == false then the previous check gave a negative result so exit
-						if(!good){
-							continue;
-						}
+					}else{
 
-						// Check if the engine says we can build here
-						// This incorporates checking the terrain
-						if(G-&gt;cb-&gt;CanBuildAt(building-&gt;GetUnitDef(), mpos)==false){
-							continue;
-						}
+						good = false;//continue;
+					}
 
-						// update best position/distance
-						bestPosition = gpos;
-						bestDistance = distance;
-					}else{
+					// if good == false then the previous check gave a negative result so exit
+					if(!good){
 						continue;
 					}
-				}
 
-				if(!b.OkBuildSelection(building-&gt;GetName())){
-					bestPosition = UpVector;
+					// Check if the engine says we can build here
+					// This incorporates checking the terrain
+					if(G-&gt;cb-&gt;CanBuildAt(building-&gt;GetUnitDef(), mpos)==false){
+						continue;
+					}
+
+					// update best position/distance
+					bestPosition = gpos;
+					bestDistance = distance;
+				}else{
+					continue;
 				}
+			}
 
-			}else{
-
-				// no surrounding cells?! assign an error value
-				string es = &quot;no cells: &quot;+to_string(e);
-				G-&gt;L.iprint(es);
-
-				bestPosition= UpVector;
+			if(!b.OkBuildSelection(building-&gt;GetName())){
+				bestPosition = UpVector;
 			}
 
-			e = blockingmap-&gt;ValidGridPosE(bestPosition);
+		}else{
 
-			// check if the grid position is valid
-			if(e==0){
-				// its valid so convert to a map position
-				bestPosition = blockingmap-&gt;GridtoMap(bestPosition);
-			}else{
-				string es = &quot;bad pos(1)&quot;+to_string(e);
-				G-&gt;L.iprint(es);
+			// no surrounding cells?! assign an error value
+			string es = &quot;no cells: &quot;+to_string(e);
+			G-&gt;L.iprint(es);
 
-				// its invalid so assign an error value
-				bestPosition = UpVector;
-			}
+			bestPosition= UpVector;
+		}
 
-			CMessage m(&quot;buildposition&quot;);
-			m.AddParameter(bestPosition);
+		e = blockingmap-&gt;ValidGridPosE(bestPosition);
 
-			reciever-&gt;RecieveMessage(m);
+		// check if the grid position is valid
+		if(e==0){
+			// its valid so convert to a map position
+			bestPosition = blockingmap-&gt;GridtoMap(bestPosition);
+		}else{
+			string es = &quot;bad pos(1)&quot;+to_string(e);
+			G-&gt;L.iprint(es);
 
+			// its invalid so assign an error value
+			bestPosition = UpVector;
 		}
 
-		Global* G;
-		const float* heightmap;
-		float bestDistance;
-		float3 mapdim;
+		CMessage m(&quot;buildposition&quot;);
+		m.AddParameter(bestPosition);
 
-		bool valid;
-		CGridManager* blockingmap;
-		CBuildingPlacer* buildalgorithm;
-		IModule* reciever;
-		float3 builderpos;
-		CUnitTypeData* builder;
-		CUnitTypeData* building;
-		float freespace;
-	};
+		reciever-&gt;RecieveMessage(m);
 
+	}
+
 	void CBuildingPlacer::GetBuildPosMessage(IModule* reciever, int builderID, float3 builderpos, CUnitTypeData* builder, CUnitTypeData* building, float freespace){
 		/*if(G-&gt;UnitDefHelper-&gt;IsFactory(builder)&amp;&amp;(!G-&gt;UnitDefHelper-&gt;IsHub(builder))){
 		 if(G-&gt;UnitDefHelper-&gt;IsMobile(building)){

Modified: trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/CBuildingPlacer.h
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/CBuildingPlacer.h	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/CBuildingPlacer.h	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,11 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
 namespace ntai {
 	class CBuildingPlacer : public IModule {
 	public:
@@ -22,4 +30,27 @@
 
 	protected:
 	};
-}
+
+	class CBuildAlgorithm : public IModule{
+	public:
+		CBuildAlgorithm(CBuildingPlacer* buildalgorithm, IModule* reciever, float3 builderpos, CUnitTypeData* wbuilder, CUnitTypeData* wbuilding, float freespace, CGridManager* blockingmap, const float* heightmap, float3 mapdim, Global* G);
+
+		void RecieveMessage(CMessage &amp;message);
+		bool Init();
+		void operator()();
+
+		Global* G;
+		const float* heightmap;
+		float bestDistance;
+		float3 mapdim;
+
+		bool valid;
+		CGridManager* blockingmap;
+		CBuildingPlacer* buildalgorithm;
+		IModule* reciever;
+		float3 builderpos;
+		CUnitTypeData* builder;
+		CUnitTypeData* building;
+		float freespace;
+	};
+}

Modified: trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/DTHandler.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/DTHandler.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/DTHandler.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,11 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/DTHandler.h
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/DTHandler.h	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Helpers/Terrain/DTHandler.h	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,4 +1,18 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
+/*
+This was originally taken from OTAI and heavily modified
+credits go to veylon the coder and maintainer of that AI.
+*/
+
 namespace ntai {
+
 	// Dragon's Teeth
 	#define DT_SIZE             32
 	#define DT_NUM_GAPS         6

Modified: trunk/AI/Global/NTai/AI/NTai/Helpers/Units/CUnitDefLoader.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Helpers/Units/CUnitDefLoader.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Helpers/Units/CUnitDefLoader.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,10 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Helpers/grid/CGridManager.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Helpers/grid/CGridManager.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Helpers/grid/CGridManager.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,5 +1,11 @@
-// Grid class written by AF
-// GPL 2
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
 #include &quot;../../SDK/AI.h&quot;
 #include &quot;CGridManager.h&quot;
 

Modified: trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/AttackBehaviour.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/AttackBehaviour.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/AttackBehaviour.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,11 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CDGunBehaviour.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CDGunBehaviour.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CDGunBehaviour.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,11 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CKamikazeBehaviour.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CKamikazeBehaviour.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CKamikazeBehaviour.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,11 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CMoveFailReclaimBehaviour.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CMoveFailReclaimBehaviour.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CMoveFailReclaimBehaviour.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,11 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
+
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CRetreatBehaviour.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CRetreatBehaviour.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CRetreatBehaviour.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,10 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CStaticDefenceBehaviour.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CStaticDefenceBehaviour.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/CStaticDefenceBehaviour.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,10 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/MetalMakerBehaviour.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/MetalMakerBehaviour.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/Behaviours/MetalMakerBehaviour.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,10 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
 #include &quot;../../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Units/CConfigTaskManager.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/CConfigTaskManager.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/CConfigTaskManager.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,10 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
 #include &quot;../Core/include.h&quot;
 
 namespace ntai {

Modified: trunk/AI/Global/NTai/AI/NTai/Units/CUnit.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/CUnit.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/CUnit.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,10 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
 
 #include &quot;../Core/include.h&quot;
 
@@ -3,4 +10,9 @@
 namespace ntai {
 
+	CUnit::CUnit(){
+		G = 0;
+		valid=false;
+	}
+
 	CUnit::CUnit(Global* GL, int uid){
 		G = GL;
@@ -88,6 +100,7 @@
 				}
 
 			}
+
 		}else if(message.GetType() == string(&quot;&quot;)){
 			return;
 		}else if(message.GetType() == string(&quot;unitfinished&quot;)){
@@ -114,17 +127,10 @@
 				return;
 			}
 		}
-		if(under_construction) return;
-		/*if(!nolist){
-			if(tasks.empty()){
-				if(LoadTaskList()){
-					boost::shared_ptr&lt;IModule&gt; t = tasks.front();
-					t-&gt;Init();
-					G-&gt;RegisterMessageHandler(t);
-				}
-				//executenext = !tasks.empty();
-			}
-		}*/
+		if(under_construction){
+			return;
+		}
+
 	}
 
 	int CUnit::GetAge(){
@@ -139,7 +145,9 @@
 
 	bool CUnit::operator==(int unit){
 		NLOG(&quot;CUnit::operator==&quot;);
-		if(valid == false) return false;
+		if(valid == false){
+			return false;
+		}
 		if(unit == uid){
 			return true;
 		}else{
@@ -152,137 +160,6 @@
 		return uid;
 	}
 
-	/*bool CUnit::AddTask(boost::shared_ptr&lt;IModule&gt; &amp;t){
-		NLOG(&quot;CBuilder::AddTask&quot;);
-		//if(t-&gt;IsValid()){
-			//t-&gt;AddListener(me);
-			tasks.push_back(t);
-			return true;
-		//}
-		//return false;
-	}
-
-	bool CUnit::LoadTaskList(){
-		NLOG(&quot;CUnit::LoadTaskList&quot;);
-
-
-		vector&lt;string&gt; vl;
-		string sl;
-		if(G-&gt;Cached-&gt;cheating){
-			sl= G-&gt;Get_mod_tdf()-&gt;SGetValueMSG(string(&quot;TASKLISTS\\CHEAT\\&quot;)+utd-&gt;GetName());
-		}else{
-			sl = G-&gt;Get_mod_tdf()-&gt;SGetValueMSG(string(&quot;TASKLISTS\\NORMAL\\&quot;)+utd-&gt;GetName());
-		}
-
-		tolowercase(sl);
-		trim(sl);
-		string u = utd-&gt;GetName();
-		if(sl != string(&quot;&quot;)){
-			CTokenizer&lt;CIsComma&gt;::Tokenize(vl, sl, CIsComma());
-			//vl = bds::set_cont(vl,sl.c_str());
-			if(vl.empty() == false){
-				int randnum = G-&gt;mrand()%vl.size();
-				u = vl.at(min(randnum,max(int(vl.size()-1),1)));
-			}
-		}
-
-		string s = G-&gt;Get_mod_tdf()-&gt;SGetValueMSG(string(&quot;TASKLISTS\\LISTS\\&quot;)+u);
-
-		if(s.empty() == true){
-			G-&gt;L.print(&quot; error loading tasklist for unit :: \&quot;&quot; + u + &quot;\&quot; :: buffer empty, most likely because of an empty list&quot;);
-			nolist=true;
-			return false;
-		}
-
-		tolowercase(s);
-		trim(s);
-
-		vector&lt;string&gt; v;
-
-		CTokenizer&lt;CIsComma&gt;::Tokenize(v, s, CIsComma());
-		//v = bds::set_cont(v,s.c_str());
-
-		if(v.empty() == false){
-			G-&gt;L.print(&quot;loading contents of  tasklist :: &quot; + u + &quot; :: filling tasklist with #&quot; + to_string(v.size()) + &quot; items&quot;);
-			bool polate=false;
-			bool polation = G-&gt;info-&gt;rule_extreme_interpolate;
-			btype bt = G-&gt;Manufacturer-&gt;GetTaskType(G-&gt;Get_mod_tdf()-&gt;SGetValueDef(&quot;b_na&quot;,&quot;AI\\interpolate_tag&quot;));
-			if(utd-&gt;IsFactory()){
-				polation = false;
-			}
-			if(bt == B_NA){
-				polation = false;
-			}
-
-
-			// TASKS LOADING
-			
-			for(vector&lt;string&gt;::iterator vi = v.begin(); vi != v.end(); ++vi){
-				if(polation){
-					if(polate){
-						boost::shared_ptr&lt;IModule&gt; t(new CKeywordConstructionTask(G,uid,bt));
-						AddTask(t);
-					}
-					polate = !polate;
-				}
-				string q = *vi;
-				trim(q);
-				tolowercase(q);
-				CUnitTypeData* b = G-&gt;UnitDefLoader-&gt;GetUnitTypeDataByName(q);
-				if(b != 0){
-					boost::shared_ptr&lt;IModule&gt; t(new CUnitConstructionTask(G,uid,utd,b));
-					AddTask(t);
-				}else if(q == string(&quot;&quot;)){
-					continue;
-				}else if(q == string(&quot;b_na&quot;)){
-					continue;
-				} else if(q == string(&quot;no_rule_interpolation&quot;)){
-					polation=false;
-				} else if(q == string(&quot;rule_interpolate&quot;)){
-					polation=true;
-				}else if(q == string(&quot;base_pos&quot;)){
-					G-&gt;Map-&gt;base_positions.push_back(G-&gt;GetUnitPos(GetID()));
-				} else if(q == string(&quot;gaia&quot;)){
-					G-&gt;info-&gt;gaia = true;
-				} else if(q == string(&quot;not_gaia&quot;)){
-					G-&gt;info-&gt;gaia = false;
-				} else if(q == string(&quot;switch_gaia&quot;)){
-					G-&gt;info-&gt;gaia = !G-&gt;info-&gt;gaia;
-				} else if(q == string(&quot;b_factory&quot;)){
-					boost::shared_ptr&lt;IModule&gt; t(new CKeywordConstructionTask(G,uid,B_FACTORY));
-					AddTask(t);
-				} else if(q == string(&quot;b_power&quot;)){
-					boost::shared_ptr&lt;IModule&gt; t(new CKeywordConstructionTask(G,uid,B_POWER));
-					AddTask(t);
-				} else if(q == string(&quot;b_defence&quot;)){
-					boost::shared_ptr&lt;IModule&gt; t(new CKeywordConstructionTask(G,uid,B_DEFENCE));
-					AddTask(t);
-				}  else if(q == string(&quot;b_mex&quot;)){
-					boost::shared_ptr&lt;IModule&gt; t(new CKeywordConstructionTask(G,uid,B_MEX));
-					AddTask(t);
-				} else{
-					btype x = G-&gt;Manufacturer-&gt;GetTaskType(q);
-					if( x != B_NA){
-						boost::shared_ptr&lt;IModule&gt; t(new CKeywordConstructionTask(G,this-&gt;uid,x));
-						AddTask(t);
-					}else{
-						G-&gt;L.print(&quot;error :: a value :: &quot; + *vi +&quot; :: was parsed in :: &quot;+u + &quot; :: this does not have a valid UnitDef according to the engine, and is not a Task keyword such as repair or b_mex&quot;);
-					}
-				}
-
-			}
-			if(utd-&gt;GetUnitDef()-&gt;isCommander){
-				G-&gt;Map-&gt;basepos = G-&gt;GetUnitPos(GetID());
-			}
-
-			G-&gt;L.print(&quot;loaded contents of  tasklist :: &quot; + u + &quot; :: loaded tasklist at &quot; + to_string(tasks.size()) + &quot; items&quot;);
-			return !tasks.empty();
-		} else{
-			G-&gt;L.print(&quot; error loading contents of  tasklist :: &quot; + u + &quot; :: buffer empty, most likely because of an empty tasklist&quot;);
-			return false;
-		}
-	}*/
-
 	bool CUnit::LoadBehaviours(){
 		string d = G-&gt;Get_mod_tdf()-&gt;SGetValueDef(&quot;auto&quot;,&quot;AI\\behaviours\\&quot;+utd-&gt;GetName());
 

Modified: trunk/AI/Global/NTai/AI/NTai/Units/CUnit.h
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/CUnit.h	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/CUnit.h	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,51 +1,46 @@
 /*
-AF 2004+
-LGPL 2
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
 */
 
 namespace ntai {
 
 	class CUnit : public IModule{
 	public:
-		CUnit(){
-			G = 0;
-			valid=false;
-		}
-		CUnit(Global* GL);
+		CUnit();
 		CUnit(Global* GL, int uid);
 		virtual ~CUnit();
+		
+		bool operator==(int unit);
 
-		void RecieveMessage(CMessage &amp;message);
 		bool Init();
+		void RecieveMessage(CMessage &amp;message);
+		
 		CUnitTypeData* GetUnitDataType();
-		bool operator==(int unit);
+		
+
 		int GetID();
-		/*void SetRepeat(bool n){
-			repeat = n;
-		}
-		bool GetRepeat(){
-			return repeat;
-		}*/
 		int GetAge();
-		//bool AddTask(boost::shared_ptr&lt;IModule&gt; &amp;t);
-		//bool LoadTaskList();
+
 		bool LoadBehaviours();
 
-		bool doingplan;
-		uint curplan;
+		
 
 		void SetTaskManager(boost::shared_ptr&lt;ITaskManager&gt; taskManager);
 		boost::shared_ptr&lt;ITaskManager&gt; GetTaskManager();
 	protected:
+		
+		bool doingplan;
+		uint curplan;
 		boost::shared_ptr&lt;ITaskManager&gt; taskManager;
 		bool under_construction;
 		boost::shared_ptr&lt;IModule&gt; currentTask;
-		//list&lt; boost::shared_ptr&lt;IModule&gt; &gt; tasks;
 		list&lt; boost::shared_ptr&lt;IBehaviour&gt; &gt; behaviours;
 		CUnitTypeData* utd;
 		int uid;
-		//bool repeat;
 		int birth;
-		//bool nolist;
 	};
 }

Modified: trunk/AI/Global/NTai/AI/NTai/Units/CUnitTypeData.cpp
===================================================================
--- trunk/AI/Global/NTai/AI/NTai/Units/CUnitTypeData.cpp	2008-06-20 09:00:15 UTC (rev 6051)
+++ trunk/AI/Global/NTai/AI/NTai/Units/CUnitTypeData.cpp	2008-06-20 14:38:38 UTC (rev 6052)
@@ -1,3 +1,10 @@
+/*
+NTai
+Tom J Nowell
<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">+tarendai at darkstars.co.uk</A>
+www.darkstars.co.uk
+LGPL 2 licence 2004+
+*/
 #include &quot;../Core/include.h&quot;
 
 namespace ntai {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000831.html">[Taspring-linux-commit] r6051 - trunk/rts/Lua
</A></li>
	<LI>Next message: <A HREF="000833.html">[Taspring-linux-commit] r6053 - trunk/rts/ExternalAI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#832">[ date ]</a>
              <a href="thread.html#832">[ thread ]</a>
              <a href="subject.html#832">[ subject ]</a>
              <a href="author.html#832">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
