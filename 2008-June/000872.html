<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6092 - trunk/Lobby/TASClient
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6092%20-%20trunk/Lobby/TASClient&In-Reply-To=%3C20080629222824.C61EF4716%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000871.html">
   <LINK REL="Next"  HREF="000873.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6092 - trunk/Lobby/TASClient</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6092%20-%20trunk/Lobby/TASClient&In-Reply-To=%3C20080629222824.C61EF4716%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6092 - trunk/Lobby/TASClient">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Mon Jun 30 00:28:24 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000871.html">[Taspring-linux-commit] r6091 - in trunk: rts/Game	rts/Game/StartScripts rts/Lua rts/Rendering/UnitModels	rts/System/FileSystem rts/System/Platform	rts/System/Platform/Linux tools/DedicatedServer tools/unitsync
</A></li>
        <LI>Next message: <A HREF="000873.html">[Taspring-linux-commit] r6093 - trunk/Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#872">[ date ]</a>
              <a href="thread.html#872">[ thread ]</a>
              <a href="subject.html#872">[ subject ]</a>
              <a href="author.html#872">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2008-06-30 00:28:22 +0200 (Mon, 30 Jun 2008)
New Revision: 6092

Added:
   trunk/Lobby/TASClient/openil.pas
Modified:
   trunk/Lobby/TASClient/BattleFormUnit.dfm
   trunk/Lobby/TASClient/BattleFormUnit.pas
   trunk/Lobby/TASClient/DisableUnitsFormUnit.dfm
   trunk/Lobby/TASClient/DisableUnitsFormUnit.pas
   trunk/Lobby/TASClient/HostBattleFormUnit.dfm
   trunk/Lobby/TASClient/HostBattleFormUnit.pas
   trunk/Lobby/TASClient/MainUnit.dfm
   trunk/Lobby/TASClient/MainUnit.pas
   trunk/Lobby/TASClient/Misc.pas
   trunk/Lobby/TASClient/ReplaysUnit.dfm
   trunk/Lobby/TASClient/TASClient.dof
   trunk/Lobby/TASClient/TASClient.dpr
   trunk/Lobby/TASClient/TASClient.res
   trunk/Lobby/TASClient/Utility.pas
Log:
- disabled unit now display the unit icon, the selection list is sortable (sorted by name by default) and the icon size depends on the icon column width
- dblclick on a nick in the battleroom chat open a PM tab
- if windows skin is selected the sptbxtitlebar are disabled
- menu form completely disabled in wine mode

Modified: trunk/Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/BattleFormUnit.dfm	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/BattleFormUnit.dfm	2008-06-29 22:28:22 UTC (rev 6092)
@@ -1,6 +1,6 @@
 object BattleForm: TBattleForm
-  Left = 598
-  Top = 220
+  Left = 390
+  Top = 307
   Width = 787
   Height = 586
   Caption = 'Battle window'
@@ -3979,6 +3979,7 @@
         ReadOnly = True
         ScrollBars = ssVertical
         TabOrder = 1
+        OnDblClick = ChatRichEditDblClick
         OnMouseDown = ChatRichEditMouseDown
         OnURLClick = ChatRichEditURLClick
       end
@@ -4116,56 +4117,6 @@
               end
             end
           end
-          object SpTBXTabSheet1: TSpTBXTabSheet
-            Left = 0
-            Top = 23
-            Width = 419
-            Height = 250
-            Caption = 'Disabled Units (0)'
-            ImageIndex = -1
-            DesignSize = (
-              419
-              250)
-            TabItem = 'DisabledUnitsTab'
-            object UnitsGroupBox: TSpTBXGroupBox
-              Left = 8
-              Top = 4
-              Width = 249
-              Height = 237
-              Caption = 'Disabled units'
-              Anchors = [akLeft, akTop, akBottom]
-              Color = clNone
-              ParentColor = False
-              TabOrder = 0
-              DesignSize = (
-                249
-                237)
-              object AddUnitsSpeedButton: TSpeedButton
-                Left = 120
-                Top = 10
-                Width = 121
-                Height = 22
-                Caption = 'Add more units'
-                OnClick = AddUnitsSpeedButtonClick
-              end
-              object DisabledUnitsListBox: TListBox
-                Left = 8
-                Top = 32
-                Width = 233
-                Height = 193
-                Anchors = [akLeft, akTop, akBottom]
-                Font.Charset = DEFAULT_CHARSET
-                Font.Color = clWindowText
-                Font.Height = -11
-                Font.Name = 'Fixedsys'
-                Font.Style = []
-                ItemHeight = 15
-                MultiSelect = True
-                ParentFont = False
-                TabOrder = 0
-              end
-            end
-          end
           object ModTabSheet: TSpTBXTabSheet
             Left = 0
             Top = 23
@@ -4246,6 +4197,75 @@
               end
             end
           end
+          object SpTBXTabSheet1: TSpTBXTabSheet
+            Left = 0
+            Top = 23
+            Width = 419
+            Height = 250
+            Caption = 'Disabled Units (0)'
+            ImageIndex = -1
+            DesignSize = (
+              419
+              250)
+            TabItem = 'DisabledUnitsTab'
+            object UnitsGroupBox: TSpTBXGroupBox
+              Left = 8
+              Top = 4
+              Width = 401
+              Height = 237
+              Caption = 'Disabled units'
+              Anchors = [akLeft, akTop, akBottom]
+              Color = clNone
+              ParentColor = False
+              TabOrder = 0
+              DesignSize = (
+                401
+                237)
+              object AddUnitsSpeedButton: TSpeedButton
+                Left = 264
+                Top = 10
+                Width = 121
+                Height = 22
+                Caption = 'Add more units'
+                OnClick = AddUnitsSpeedButtonClick
+              end
+              object VDTDisabledUnits: TVirtualDrawTree
+                Left = 16
+                Top = 32
+                Width = 369
+                Height = 193
+                Anchors = [akLeft, akTop, akRight, akBottom]
+                DefaultNodeHeight = 64
+                Header.AutoSizeIndex = 1
+                Header.Font.Charset = DEFAULT_CHARSET
+                Header.Font.Color = clWindowText
+                Header.Font.Height = -11
+                Header.Font.Name = 'MS Sans Serif'
+                Header.Font.Style = []
+                Header.Options = [hoAutoResize, hoColumnResize, hoDrag]
+                TabOrder = 0
+                TreeOptions.PaintOptions = [toHideFocusRect, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
+                TreeOptions.SelectionOptions = [toFullRowSelect]
+                OnDrawNode = VDTDisabledUnitsDrawNode
+                Columns = &lt;
+                  item
+                    Position = 0
+                    Width = 64
+                    WideText = 'Icon'
+                  end
+                  item
+                    Position = 1
+                    Width = 201
+                    WideText = 'FullName'
+                  end
+                  item
+                    Position = 2
+                    Width = 100
+                    WideText = 'Code name'
+                  end&gt;
+              end
+            end
+          end
           object SpTBXTabSheet2: TSpTBXTabSheet
             Left = 0
             Top = 23

Modified: trunk/Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/BattleFormUnit.pas	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/BattleFormUnit.pas	2008-06-29 22:28:22 UTC (rev 6092)
@@ -250,7 +250,6 @@
     SpTBXTabSheet1: TSpTBXTabSheet;
     UnitsGroupBox: TSpTBXGroupBox;
     AddUnitsSpeedButton: TSpeedButton;
-    DisabledUnitsListBox: TListBox;
     SpTBXTabSheet2: TSpTBXTabSheet;
     LimitDGunCheckBox: TSpTBXCheckBox;
     GhostedBuildingsCheckBox: TSpTBXCheckBox;
@@ -289,6 +288,7 @@
     SpTBXSeparatorItem7: TSpTBXSeparatorItem;
     SpTBXItem12: TSpTBXItem;
     SpTBXSeparatorItem8: TSpTBXSeparatorItem;
+    VDTDisabledUnits: TVirtualDrawTree;
 
     procedure CreateParams(var Params: TCreateParams); override;
 
@@ -493,6 +493,9 @@
     procedure KeepRatioItemClick(Sender: TObject);
     procedure MapPanelResize(Sender: TObject);
     procedure SpTBXItem12Click(Sender: TObject);
+    procedure VDTDisabledUnitsDrawNode(Sender: TBaseVirtualTree;
+      const PaintInfo: TVTPaintInfo);
+    procedure ChatRichEditDblClick(Sender: TObject);
   private
     History: TWideStringList;
     HistoryIndex: Integer;
@@ -523,6 +526,7 @@
     procedure SaveMapOptionsAsDefault;
     procedure LoadMapOptionsDefault;
     procedure DisconnectButtonClick;overload;
+    procedure PopulateDisabledUnitsVDT;
   end;
 
   TBattleParticipation = (None, Hosting, Joined);
@@ -608,7 +612,8 @@
     ResizingY : ShortInt;
     SelectedStartRect: Shortint; // if -1, no start rect is selected
     BanList:TStringList;
-    TryingToJoinLadderBattle: boolean;
+    DisabledUnits: TStringList;
+    TryingToJoinLadderBattle: Boolean;
   end;
 
   BattleReplayInfo: // used only when battle is of &quot;battle replay&quot; type
@@ -1341,7 +1346,8 @@
 
   BattleState.Battle := Battle;
 
-  DisabledUnitsListBox.Clear;
+  BattleState.DisabledUnits.Clear;
+  PopulateDisabledUnitsVDT;
 
   StartPosRadioGroup.Enabled := False;
   GameEndRadioGroup.Enabled := False;
@@ -1452,7 +1458,8 @@
 
   BattleState.Battle := Battle;
 
-  DisabledUnitsListBox.Clear;
+  BattleState.DisabledUnits.Clear;
+  PopulateDisabledUnitsVDT;
 
   StartPosRadioGroup.Enabled := False;
   GameEndRadioGroup.Enabled := False;
@@ -1542,15 +1549,16 @@
   BattleState.Battle := Battle;
   BattleState.BanList := TStringList.Create;
 
-  DisabledUnitsListBox.Clear;
+  BattleState.DisabledUnits.Clear;
+  PopulateDisabledUnitsVDT;
 
   if BattleState.LadderIndex &gt; -1 then begin
     disabledUnits := '';
-    for i:=0 to TLadder(LadderList[BattleState.LadderIndex]).Restricted.Count-1 do begin
-      DisabledUnitsListBox.Items.Add(TLadder(LadderList[BattleState.LadderIndex]).Restricted[i]);
-      disabledUnits := disabledUnits + ' ' + TLadder(LadderList[BattleState.LadderIndex]).Restricted[i];
-    end;
+    BattleState.DisabledUnits.Assign(TLadder(LadderList[BattleState.LadderIndex]).Restricted);
+    VDTDisabledUnits.RootNodeCount := BattleState.DisabledUnits.Count;
+    disabledUnits := JoinStringList(BattleState.DisabledUnits,' ');
 
+
     MainForm.TryToSendCommand('ENABLEALLUNITS');
     Delete(disabledUnits, 1, 1); // remove first space character
     MainForm.TryToSendCommand('DISABLEUNITS', disabledUnits);
@@ -1660,7 +1668,8 @@
   BattleState.Battle := Battle;
   BattleState.BanList := TStringList.Create;
 
-  DisabledUnitsListBox.Clear;
+  BattleState.DisabledUnits.Clear;
+  PopulateDisabledUnitsVDT;
 
   StartPosRadioGroup.Enabled := False;
   GameEndRadioGroup.Enabled := False;
@@ -1765,8 +1774,8 @@
 
   BattleState.Status := None;
 
-  DisabledUnitsListBox.Clear;
-  DisabledUnitsTab.Caption := 'Disabled Units (0)';
+  BattleState.DisabledUnits.Clear;
+  PopulateDisabledUnitsVDT;
 
   StartPosRadioGroup.Enabled := False;
   GameEndRadioGroup.Enabled := False;
@@ -2217,10 +2226,10 @@
         end;
   end;
   // restrictions:
-  Script.AddOrChangeKeyValue('GAME/NumRestrictions',IntToStr(BattleForm.DisabledUnitsListBox.Items.Count));
-  for i := 0 to BattleForm.DisabledUnitsListBox.Items.Count-1 do
+  Script.AddOrChangeKeyValue('GAME/NumRestrictions',IntToStr(BattleState.DisabledUnits.Count));
+  for i := 0 to BattleState.DisabledUnits.Count-1 do
   begin
-    Script.AddOrChangeKeyValue('GAME/RESTRICT/Unit' + IntToStr(i),BattleForm.DisabledUnitsListBox.Items[i]);
+    Script.AddOrChangeKeyValue('GAME/RESTRICT/Unit' + IntToStr(i),BattleState.DisabledUnits[i]);
     Script.AddOrChangeKeyValue('GAME/RESTRICT/Limit' + IntToStr(i),'0');
   end;
   
@@ -2356,6 +2365,7 @@
 begin
   Left := 10;
   Top := 10;
+  BattleState.DisabledUnits := TStringList.Create;
 
   FCurrentMapIndex := -1;
 
@@ -3354,31 +3364,21 @@
   s: string;
 begin
   if DisableUnitsForm.ShowModal &lt;&gt; mrOK then Exit;
-  DisabledUnitsListBox.Clear;
+  BattleState.DisabledUnits.Clear;
+  for i:=0 to UnitNodes.Count-1 do
+    if ( PVirtualNode(UnitNodes[i]).CheckState = csCheckedNormal) or (PVirtualNode(UnitNodes[i]).CheckState = csCheckedPressed) then
+      BattleState.DisabledUnits.Add(UnitList[i]);
 
-  i := 0;
-  node := DisableUnitsForm.VDTUnits.GetFirst;
-  while node &lt;&gt; nil do
-  begin
-    if (node.CheckState = csCheckedNormal) or (node.CheckState = csCheckedPressed) then
-      DisabledUnitsListBox.Items.Add(UnitList[i]);
 
-    node := node.NextSibling;
-    Inc(i);
-  end;
-
   // for the sake of simplicity we send the entire list each time it is changed
   // (we could also generate diff list and update it with ENABLEUNITS/DISABLEUNITS commands)
-  DisabledUnitsTab.Caption := 'Disabled Units ('+IntToStr(DisabledUnitsListBox.Items.Count)+')';
+  BattleForm.PopulateDisabledUnitsVDT;
+
   MainForm.TryToSendCommand('ENABLEALLUNITS');
-  if DisabledUnitsListBox.Items.Count &gt; 0 then
+  if BattleState.DisabledUnits.Count &gt; 0 then
   begin
-    s := '';
-    for i := 0 to DisabledUnitsListBox.Items.Count-1 do
-      s := s + ' ' + DisabledUnitsListBox.Items[i];
-    Delete(s, 1, 1); // remove first space character
+    s := JoinStringList(BattleState.DisabledUnits,' ');
     MainForm.TryToSendCommand('DISABLEUNITS', s);
-    DisabledUnitsTab.Caption := 'Disabled Units ('+IntToStr(DisabledUnitsListBox.Items.Count)+')';
   end;
 end;
 
@@ -6458,4 +6458,111 @@
   Misc.OpenURLInDefaultBrowser('<A HREF="http://springladder.no-ip.org/">http://springladder.no-ip.org/</A>');
 end;
 
+procedure TBattleForm.PopulateDisabledUnitsVDT;
+begin
+  VDTDisabledUnits.Clear;
+  VDTDisabledUnits.RootNodeCount := BattleState.DisabledUnits.Count;
+  DisabledUnitsTab.Caption := 'Disabled Units ('+IntToStr(BattleState.DisabledUnits.Count)+')';
+end;
+
+procedure TBattleForm.VDTDisabledUnitsDrawNode(Sender: TBaseVirtualTree;
+  const PaintInfo: TVTPaintInfo);
+var
+  s: WideString;
+  R: TRect;
+  availableWidth: integer;
+  availableHeight: integer;
+  forceWidth: integer;
+  forceHeight: integer;
+  nodeIndex : integer;
+begin
+  with Sender as TVirtualDrawTree, PaintInfo do
+  begin
+    nodeIndex := UnitList.IndexOf(BattleState.DisabledUnits[Node.index]);
+
+    if (Node = FocusedNode) and Focused then
+      Canvas.Font.Color := clHighlightText
+    else
+      Canvas.Font.Color := clWindowText;
+
+    R := ContentRect;
+    if Column &lt;&gt; 0 then
+    begin
+      InflateRect(R, -TextMargin, 0);
+      Dec(R.Right);
+      Dec(R.Bottom);
+    end;
+    s := '';
+
+    case Column of
+      0:
+      begin
+        if TBitmap(UnitBitmaps[Node.Index]).Width &gt; 0 then
+        begin
+          availableWidth := R.Right-R.Left;
+          availableHeight := R.Bottom-R.Top;
+          forceHeight := Round(availableWidth*TBitmap(UnitBitmaps[nodeIndex]).Height/TBitmap(UnitBitmaps[nodeIndex]).Width);
+          forceWidth := Round(availableHeight*TBitmap(UnitBitmaps[nodeIndex]).Width/TBitmap(UnitBitmaps[nodeIndex]).Height);
+
+          if ((TBitmap(UnitBitmaps[nodeIndex]).Width &gt; TBitmap(UnitBitmaps[nodeIndex]).Height) and (forceHeight &lt; availableHeight)) or (forceWidth &gt; availableWidth) then
+            Canvas.StretchDraw(Rect(R.Left,R.Top,R.Right,R.Top+forceHeight),TBitmap(UnitBitmaps[nodeIndex]))
+          else
+            Canvas.StretchDraw(Rect(R.Left,R.Top,R.Left+forceWidth,R.Bottom),TBitmap(UnitBitmaps[nodeIndex]));
+        end;
+      end;
+      1: s := UnitNames[nodeIndex]; // unit name
+      2: s := UnitList[nodeIndex]; // unit &quot;code name&quot;
+    end; // case
+
+    if Length(s) &gt; 0 then
+    begin
+       with R do
+         if (NodeWidth - 2 * Margin) &gt; (Right - Left) then
+           s := ShortenString(Canvas.Handle, s, Right - Left, 0);
+       DrawTextW(Canvas.Handle, PWideChar(S), Length(S), R, DT_TOP or DT_LEFT or DT_VCENTER or DT_SINGLELINE, False);
+ //     Canvas.TextOut(ContentRect.Left, ContentRect.Top, s);
+    end;
+  end;
+end;
+
+procedure TBattleForm.ChatRichEditDblClick(Sender: TObject);
+var
+   ci, //Character Index
+   lix, //Line Index
+   co, //Character Offset
+   k, j: Integer;
+   Pt: TPoint;
+   s: string;
+   SelectedNick: string;
+   SelectedClient: TClient;
+begin
+   with TTntRichEdit(Sender) do
+   begin
+     GetCursorPos(pt);
+     pt := TTntRichEdit(Sender).ScreenToClient(pt);
+     //Pt := Point(X, Y) ;
+     ci := Perform(Messages.EM_CHARFROMPOS, 0, Integer(@Pt)) ;
+     if ci &lt; 0 then Exit;
+     lix := Perform(EM_EXLINEFROMCHAR, 0, ci) ;
+     co := ci - Perform(EM_LINEINDEX, lix, 0) ;
+     if -1 + Lines.Count &lt; lix then Exit;
+     s := Lines[lix];
+     Inc(co) ;
+     k := co;
+     while (k &gt; 0) and (s[k] &lt;&gt; ' ') and (s[k] &lt;&gt; '&lt;') do k:=k-1;
+     Inc(k);
+     Inc(co) ;
+     j := co;
+     while (j &lt;= Length(s)) and (s[j] &lt;&gt; ' ') and (s[j] &lt;&gt; '&gt;') do Inc(j) ;
+     SelectedNick := Copy(s, k, j - k) ;
+
+     SelectedClient := MainForm.GetClient(SelectedNick);
+
+     if SelectedClient &lt;&gt; nil then
+     begin
+       MainForm.OpenPrivateChat(SelectedNick);
+     end;
+   end;
+end;
+
 end.

Modified: trunk/Lobby/TASClient/DisableUnitsFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/DisableUnitsFormUnit.dfm	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/DisableUnitsFormUnit.dfm	2008-06-29 22:28:22 UTC (rev 6092)
@@ -1,10 +1,9 @@
 object DisableUnitsForm: TDisableUnitsForm
-  Left = 885
-  Top = 232
-  BorderStyle = bsDialog
+  Left = 769
+  Top = 204
+  Width = 600
+  Height = 483
   Caption = 'Disable units dialog'
-  ClientHeight = 456
-  ClientWidth = 592
   Color = clBtnFace
   Constraints.MaxHeight = 1000
   Constraints.MaxWidth = 1680
@@ -25,10 +24,11 @@
     Width = 592
     Height = 456
     Caption = 'Disable units dialog'
-    FixedSize = True
     Options.Minimize = False
-    Options.Maximize = False
     TBXStyleBackground = True
+    DesignSize = (
+      592
+      456)
     object Label1: TSpTBXLabel
       Left = 8
       Top = 40
@@ -47,6 +47,7 @@
       Width = 73
       Height = 22
       Caption = 'Clear all'
+      Anchors = [akTop, akRight]
       OnClick = SpeedButton1Click
       LinkFont.Charset = DEFAULT_CHARSET
       LinkFont.Color = clBlue
@@ -60,6 +61,7 @@
       Width = 73
       Height = 22
       Caption = 'Save ...'
+      Anchors = [akTop, akRight]
       OnClick = SpeedButton2Click
       LinkFont.Charset = DEFAULT_CHARSET
       LinkFont.Color = clBlue
@@ -73,6 +75,7 @@
       Width = 73
       Height = 22
       Caption = 'Open ...'
+      Anchors = [akTop, akRight]
       OnClick = SpeedButton3Click
       LinkFont.Charset = DEFAULT_CHARSET
       LinkFont.Color = clBlue
@@ -81,11 +84,12 @@
       LinkFont.Style = [fsUnderline]
     end
     object Button1: TSpTBXButton
-      Left = 176
+      Left = 368
       Top = 416
       Width = 105
       Height = 25
       Caption = 'Close'
+      Anchors = [akRight, akBottom]
       TabOrder = 5
       OnClick = Button1Click
       Cancel = True
@@ -100,20 +104,27 @@
       Top = 64
       Width = 577
       Height = 337
+      Anchors = [akLeft, akTop, akRight, akBottom]
       CheckImageKind = ckSystem
+      DefaultNodeHeight = 70
       Header.AutoSizeIndex = 2
       Header.Font.Charset = DEFAULT_CHARSET
       Header.Font.Color = clWindowText
       Header.Font.Height = -11
       Header.Font.Name = 'MS Sans Serif'
       Header.Font.Style = []
-      Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoVisible]
+      Header.Options = [hoAutoResize, hoColumnResize, hoDrag, hoShowSortGlyphs, hoVisible]
+      Header.SortColumn = 2
       Header.Style = hsFlatButtons
       TabOrder = 6
+      TreeOptions.AutoOptions = [toAutoDropExpand, toAutoScrollOnExpand, toAutoSort, toAutoTristateTracking, toAutoDeleteMovedNodes]
       TreeOptions.MiscOptions = [toAcceptOLEDrop, toCheckSupport, toFullRepaintOnResize, toInitOnSave, toToggleOnDblClick, toWheelPanning]
       TreeOptions.PaintOptions = [toHideFocusRect, toShowButtons, toShowDropmark, toThemeAware, toUseBlendedImages]
       TreeOptions.SelectionOptions = [toFullRowSelect]
+      OnColumnResize = VDTUnitsColumnResize
+      OnCompareNodes = VDTUnitsCompareNodes
       OnDrawNode = VDTUnitsDrawNode
+      OnHeaderClick = VDTUnitsHeaderClick
       OnInitNode = VDTUnitsInitNode
       Columns = &lt;
         item
@@ -123,21 +134,27 @@
         end
         item
           Position = 1
-          Width = 300
+          Width = 70
+          WideText = 'Icon'
+        end
+        item
+          Position = 2
+          Width = 280
           WideText = 'Unit name'
         end
         item
-          Position = 2
-          Width = 240
+          Position = 3
+          Width = 190
           WideText = 'Code name'
         end&gt;
     end
     object Button2: TSpTBXButton
-      Left = 312
+      Left = 480
       Top = 416
       Width = 105
       Height = 25
       Caption = 'Update selection'
+      Anchors = [akRight, akBottom]
       TabOrder = 7
       OnClick = Button2Click
       LinkFont.Charset = DEFAULT_CHARSET

Modified: trunk/Lobby/TASClient/DisableUnitsFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/DisableUnitsFormUnit.pas	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/DisableUnitsFormUnit.pas	2008-06-29 22:28:22 UTC (rev 6092)
@@ -13,7 +13,7 @@
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, VirtualTrees, StdCtrls, Buttons, SpTBXControls, TBXDkPanels,
-  SpTBXItem,Misc;
+  SpTBXItem,Misc,ExtCtrls;
 
 type
   TDisableUnitsForm = class(TForm)
@@ -43,10 +43,16 @@
     procedure FormCreate(Sender: TObject);
     procedure SpeedButton2Click(Sender: TObject);
     procedure SpeedButton3Click(Sender: TObject);
+    procedure VDTUnitsColumnResize(Sender: TVTHeader;
+      Column: TColumnIndex);
+    procedure VDTUnitsCompareNodes(Sender: TBaseVirtualTree; Node1,
+      Node2: PVirtualNode; Column: TColumnIndex; var Result: Integer);
+    procedure VDTUnitsHeaderClick(Sender: TVTHeader; Column: TColumnIndex;
+      Button: TMouseButton; Shift: TShiftState; X, Y: Integer);
   private
     { Private declarations }
   public
-    { Public declarations }
+    procedure PopulateUnitList;
   end;
 
 var
@@ -79,15 +85,19 @@
   Node.Dummy := 0; // we use dummy to store selection status. See VirtualTreeView's docs on what Dummy actually is
 end;
 
-procedure TDisableUnitsForm.VDTUnitsDrawNode(Sender: TBaseVirtualTree;
-  const PaintInfo: TVTPaintInfo);
+procedure TDisableUnitsForm.VDTUnitsDrawNode(Sender: TBaseVirtualTree;const PaintInfo: TVTPaintInfo);
 var
   s: WideString;
   R: TRect;
-
+  availableWidth: integer;
+  availableHeight: integer;
+  forceWidth: integer;
+  forceHeight: integer;
+  nodeIndex : integer;
 begin
   with Sender as TVirtualDrawTree, PaintInfo do
   begin
+    nodeIndex := UnitNodes.IndexOf(Node);
 
     if (Node = FocusedNode) and Focused then
       Canvas.Font.Color := clHighlightText
@@ -95,15 +105,33 @@
       Canvas.Font.Color := clWindowText;
 
     R := ContentRect;
-    InflateRect(R, -TextMargin, 0);
-    Dec(R.Right);
-    Dec(R.Bottom);
+    if Column &lt;&gt; 1 then
+    begin
+      InflateRect(R, -TextMargin, 0);
+      Dec(R.Right);
+      Dec(R.Bottom);
+    end;
     s := '';
 
     case Column of
       0: ; // enabled
-      1: s := UnitNames[Node.Index]; // unit name
-      2: s := UnitList[Node.Index]; // unit &quot;code name&quot;
+      1:
+      begin
+        if TBitmap(UnitBitmaps[Node.Index]).Width &gt; 0 then
+        begin
+          availableWidth := R.Right-R.Left;
+          availableHeight := R.Bottom-R.Top;
+          forceHeight := Round(availableWidth*TBitmap(UnitBitmaps[nodeIndex]).Height/TBitmap(UnitBitmaps[nodeIndex]).Width);
+          forceWidth := Round(availableHeight*TBitmap(UnitBitmaps[nodeIndex]).Width/TBitmap(UnitBitmaps[nodeIndex]).Height);
+
+          if ((TBitmap(UnitBitmaps[nodeIndex]).Width &gt; TBitmap(UnitBitmaps[nodeIndex]).Height) and (forceHeight &lt; availableHeight)) or (forceWidth &gt; availableWidth) then
+            Canvas.StretchDraw(Rect(R.Left,R.Top,R.Right,R.Top+forceHeight),TBitmap(UnitBitmaps[nodeIndex]))
+          else
+            Canvas.StretchDraw(Rect(R.Left,R.Top,R.Left+forceWidth,R.Bottom),TBitmap(UnitBitmaps[nodeIndex]));
+        end;
+      end;
+      2: s := UnitNames[nodeIndex]; // unit name
+      3: s := UnitList[nodeIndex]; // unit &quot;code name&quot;
     end; // case
 
     if Length(s) &gt; 0 then
@@ -133,10 +161,7 @@
   i: Integer;
 begin
   // the simplest way to clear all checkboxes is to clear all nodes :)
-
-  i := VDTUnits.RootNodeCount;
-  VDTUnits.RootNodeCount := 0;
-  VDTUnits.RootNodeCount := i;
+  PopulateUnitList;
 end;
 
 procedure TDisableUnitsForm.LoadSelectionFromFile(FileName: string);
@@ -176,20 +201,14 @@
 
     // let's select the units (this will take O(m*n) since we don't keep pointers to the nodes ... but nevermind):
     // but first let's clear current selection:
-    i := VDTUnits.RootNodeCount;
-    VDTUnits.RootNodeCount := 0;
-    VDTUnits.RootNodeCount := i;
+    //VDTUnits.RootNodeCount := i;
+    DisableUnitsForm.PopulateUnitList;
+
     // mark units:
     for i := 0 to Selection.Count-1 do
     begin
       index := UnitList.IndexOf(Selection[i]);
-      node := VDTUnits.GetFirst;
-      while index &gt; 0 do
-      begin
-        node := node.NextSibling;
-        Dec(Index);
-      end;
-
+      node := UnitNodes[index];
       node.CheckState := csCheckedNormal;
     end;
 
@@ -214,17 +233,10 @@
     AssignFile(f, FileName);
     Rewrite(f);
 
-    i := 0;
-    node := VDTUnits.GetFirst;
-    while node &lt;&gt; nil do
-    begin
-      if (node.CheckState = csCheckedNormal) or (node.CheckState = csCheckedPressed) then
+    for i:=0 to UnitNodes.Count-1 do
+      if (PVirtualNode(UnitNodes[i]).CheckState = csCheckedNormal) or (PVirtualNode(UnitNodes[i]).CheckState = csCheckedPressed) then
         Writeln(f, UnitList[i]);
 
-      node := node.NextSibling;
-      Inc(i);
-    end;
-
     CloseFile(f);
 
   except
@@ -236,8 +248,7 @@
 
 procedure TDisableUnitsForm.FormCreate(Sender: TObject);
 begin
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
+  FixFormSizeConstraints(BattleForm);
   SaveDialog1.InitialDir := ExtractFilePath(Application.ExeName) + VAR_FOLDER;
   OpenDialog1.InitialDir := ExtractFilePath(Application.ExeName) + VAR_FOLDER;
 end;
@@ -254,4 +265,82 @@
   LoadSelectionFromFile(OpenDialog1.FileName);
 end;
 
+procedure TDisableUnitsForm.VDTUnitsColumnResize(Sender: TVTHeader;
+  Column: TColumnIndex);
+var
+  Node: PVirtualNode;
+begin
+  if Column = 1 then
+  begin
+    VDTUnits.DefaultNodeHeight := VDTUnits.Header.Columns[1].Width;
+    Node := VDTUnits.GetFirst;
+    while Node &lt;&gt; nil do
+    begin
+      Node.NodeHeight := VDTUnits.Header.Columns[1].Width;
+      Node.TotalHeight := VDTUnits.Header.Columns[1].Width;
+      Node := VDTUnits.GetNext(Node);
+    end;
+  end;
+end;
+
+procedure TDisableUnitsForm.PopulateUnitList;
+var
+  i: integer;
+  node: PVirtualNode;
+begin
+  VDTUnits.Clear;
+  UnitNodes.Clear;
+  VDTUnits.BeginUpdate;
+
+  VDTUnits.RootNodeCount := UnitList.Count;
+  node := VDTUnits.GetFirst;
+  for i:=0 to UnitList.Count-1 do
+  begin
+    if UnitNodes.IndexOf(node) = -1 then
+      UnitNodes.Add(node);
+    node := VDTUnits.GetNext(node);
+  end;
+
+  VDTUnits.EndUpdate;
+end;
+
+procedure TDisableUnitsForm.VDTUnitsCompareNodes(Sender: TBaseVirtualTree;
+  Node1, Node2: PVirtualNode; Column: TColumnIndex; var Result: Integer);
+var
+  node1Index: integer;
+  node2Index: integer;
+begin
+  node1Index := UnitNodes.IndexOf(Node1);
+  node2Index := UnitNodes.IndexOf(Node2);
+
+    case Column of
+      0:
+        if Node1.CheckState = Node2.CheckState  then
+          Result := 0
+        else if Node1.CheckState = csCheckedNormal then
+          Result := -1
+        else
+          Result := 1;
+      1:;
+      2:Result := CompareStr(UnitNames[node1Index],UnitNames[node2Index]);
+      3:Result := CompareStr(UnitList[node1Index],UnitList[node2Index]);
+    end;
+end;
+
+procedure TDisableUnitsForm.VDTUnitsHeaderClick(Sender: TVTHeader;
+  Column: TColumnIndex; Button: TMouseButton; Shift: TShiftState; X,
+  Y: Integer);
+begin
+  if VDTUnits.Header.SortColumn = Column then
+    if VDTUnits.Header.SortDirection = sdDescending then
+      VDTUnits.Header.SortDirection := sdAscending
+    else
+      VDTUnits.Header.SortDirection := sdDescending
+  else
+  begin
+    VDTUnits.Header.SortColumn := Column;
+    VDTUnits.Header.SortDirection := sdAscending
+  end;
+end;
+
 end.

Modified: trunk/Lobby/TASClient/HostBattleFormUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/HostBattleFormUnit.dfm	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/HostBattleFormUnit.dfm	2008-06-29 22:28:22 UTC (rev 6092)
@@ -192,6 +192,7 @@
       Width = 201
       Height = 21
       Style = csDropDownList
+      DropDownCount = 32
       ItemHeight = 13
       TabOrder = 14
     end

Modified: trunk/Lobby/TASClient/HostBattleFormUnit.pas
===================================================================
--- trunk/Lobby/TASClient/HostBattleFormUnit.pas	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/HostBattleFormUnit.pas	2008-06-29 22:28:22 UTC (rev 6092)
@@ -192,7 +192,8 @@
   InitWaitForm.ChangeCaption(MSG_GETUNITS);
   InitWaitForm.TakeAction := 1; // load unit lists
   InitWaitForm.ShowModal; // this loads unit lists (see OnFormActivate event)
-  DisableUnitsForm.VDTUnits.RootNodeCount := UnitNames.Count;
+  //DisableUnitsForm.VDTUnits.RootNodeCount := UnitNames.Count;
+  DisableUnitsForm.PopulateUnitList;
 
   with BattleForm do begin
     MetalTracker.Minimum := 0;
@@ -357,7 +358,8 @@
   InitWaitForm.ChangeCaption(MSG_GETUNITS);
   InitWaitForm.TakeAction := 1; // load unit lists
   InitWaitForm.ShowModal; // this loads unit lists (see OnFormActivate event)
-  DisableUnitsForm.VDTUnits.RootNodeCount := UnitNames.Count;
+  //DisableUnitsForm.VDTUnits.RootNodeCount := UnitNames.Count;
+  DisableUnitsForm.PopulateUnitList;
   // change map in battle window to the one used in this replay:
 
   replay := ReplaysForm.GetReplayFromNode(ReplaysForm.VDTReplays.FocusedNode);

Modified: trunk/Lobby/TASClient/MainUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/MainUnit.dfm	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/MainUnit.dfm	2008-06-29 22:28:22 UTC (rev 6092)
@@ -1,6 +1,6 @@
 object MainForm: TMainForm
-  Left = 567
-  Top = 372
+  Left = 770
+  Top = 425
   Width = 808
   Height = 549
   Caption = '.'

Modified: trunk/Lobby/TASClient/MainUnit.pas
===================================================================
--- trunk/Lobby/TASClient/MainUnit.pas	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/MainUnit.pas	2008-06-29 22:28:22 UTC (rev 6092)
@@ -510,7 +510,7 @@
 
 const
   VERSION_NUMBER = '0.38'; // Must be float value! (with a period as a decimal seperator)
-  BETA_NUMBER = 326;
+  BETA_NUMBER = 328;
   CHECK_BETA_LOBBY_URL = '<A HREF="http://tasclient.no-ip.org/TASClient.txt">http://tasclient.no-ip.org/TASClient.txt</A>';
   PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER + ' beta';
   KEEP_ALIVE_INTERVAL = 10000; // in milliseconds. Tells us what should be the maximum &quot;silence&quot; time before we send a ping to the server.
@@ -3284,6 +3284,8 @@
   Left := 10;
   Top := 10;
 
+  SinglePlayerButton.Enabled := not RunningUnderWine;
+
   try
     if FileExists(Application.ExeName + '.old') then
       DeleteFile(Application.ExeName + '.old');
@@ -6187,9 +6189,10 @@
         Exit;
       end;
 
-      BattleForm.DisabledUnitsListBox.Items.Clear;
-      for i := 1 to sl.Count-1 do BattleForm.DisabledUnitsListBox.Items.Add(sl[i]);
-      BattleForm.DisabledUnitsTab.Caption := 'Disabled Units ('+IntToStr(BattleForm.DisabledUnitsListBox.Items.Count)+')';
+      BattleState.DisabledUnits.Clear;
+
+      for i := 1 to sl.Count-1 do BattleState.DisabledUnits.Add(sl[i]);
+      BattleForm.PopulateDisabledUnitsVDT;
     end
     else if sl[0] = 'ENABLEUNITS' then
     begin
@@ -6208,11 +6211,11 @@
 
       for i := 1 to sl.Count-1 do
       begin
-        j := BattleForm.DisabledUnitsListBox.Items.IndexOf(sl[i]);
+        j := BattleState.DisabledUnits.IndexOf(sl[i]);
         if j = -1 then Continue;
-        BattleForm.DisabledUnitsListBox.Items.Delete(j);
+        BattleState.DisabledUnits.Delete(j);
       end;
-      BattleForm.DisabledUnitsTab.Caption := 'Disabled Units ('+IntToStr(BattleForm.DisabledUnitsListBox.Items.Count)+')';
+      BattleForm.PopulateDisabledUnitsVDT;
     end
     else if sl[0] = 'ENABLEALLUNITS' then
     begin
@@ -6229,8 +6232,8 @@
         Exit;
       end;
 
-      BattleForm.DisabledUnitsListBox.Items.Clear;
-      BattleForm.DisabledUnitsTab.Caption := 'Disabled Units (0)';
+      BattleState.DisabledUnits.Clear;
+      BattleForm.PopulateDisabledUnitsVDT;
     end
     else if sl[0] = 'RING' then
     begin
@@ -6508,6 +6511,7 @@
    Pt: TPoint;
    s: string;
    SelectedNick: string;
+   SelectedClient: TClient;
 begin
    with TTntRichEdit(Sender) do
    begin
@@ -6529,9 +6533,9 @@
      while (j &lt;= Length(s)) and (s[j] &lt;&gt; ' ') and (s[j] &lt;&gt; '&gt;') do Inc(j) ;
      SelectedNick := Copy(s, k, j - k) ;
 
-     RichEditSelectedClient := GetClient(SelectedNick);
+     SelectedClient := GetClient(SelectedNick);
 
-     if RichEditSelectedClient &lt;&gt; nil then
+     if SelectedClient &lt;&gt; nil then
      begin
        OpenPrivateChat(SelectedNick);
      end;

Modified: trunk/Lobby/TASClient/Misc.pas
===================================================================
--- trunk/Lobby/TASClient/Misc.pas	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/Misc.pas	2008-06-29 22:28:22 UTC (rev 6092)
@@ -14,6 +14,9 @@
   WSocket, Winsock, ESBDates, GpTimeZone, JvColorCombo, Forms,StdCtrls,HttpProt,TntComCtrls,JclUnicode,TntSysUtils,PreferencesFormUnit,Variants;
 
 type
+  TColorData = Array[0..128000] Of TRGBTriple;
+  pColorData = ^TColorData;
+
   TVerticalAlign=(alVTop,alVCenter,alVBottom);
   THorizontalAlign=(alHLeft,alHCenter,alHRight);
   TJustify=(JustLeft,JustCenter,JustRight);
@@ -126,6 +129,7 @@
 function GetLongPathNameA(lpFileName:LPCTSTR;lpBuffer:LPTSTR;nBufferLength:DWORD): integer;stdcall; external 'Kernel32.dll';
 function  GetLongPathName(FileName: string): string;
 Function DelTree(DirName : string): Boolean;
+Function BitmapFlip(Const Vertical : Boolean;Const Horizontal : Boolean;var BitmapIn : TBitmap;out BitmapOut : TBitmap): Boolean;
 
 implementation
 
@@ -1965,5 +1969,50 @@
   end;
 end;
 
+Function BitmapFlip(Const Vertical : Boolean;Const Horizontal : Boolean;var BitmapIn : TBitmap;out BitmapOut : TBitmap): Boolean;
+Var
+   DataIn : pColorData;
+   DataOut : pColorData;
+   inRow : Integer;
+   inCol : Integer;
+Begin
+   Result := False;
+   Try
+     If BitmapIn.PixelFormat &lt;&gt; pf24bit Then Exit;
+     With BitmapOut Do
+     Begin
+       Width := BitmapIn.Width;
+       Height := BitmapIn.Height;
+       PixelFormat := BitmapIn.PixelFormat;
+     End;
+     For inRow := 0 To BitmapIn.Height - 1 Do
+     Begin
+       DataIn := BitmapIn.Scanline[inRow];
+       If Vertical Then
+       Begin
+         DataOut := BitmapOut.ScanLine
+                    [BitmapIn.Height - 1 - inRow];
+       End
+       Else
+       Begin
+         DataOut := BitmapOut.ScanLine[inRow];
+       End;
+       If Horizontal Then
+       Begin
+         For inCol := 0 To BitmapIn.Width-1 Do
+             DataOut[inCol] := DataIn
+                    [BitmapIn.Width-1-inCol];
+       End
+       Else
+       Begin
+         For inCol := 0 To BitmapIn.Width-1 Do
+             DataOut[inCol] := DataIn[inCol];
+       End;
+     End;
+     Result := True;
+   Except
+   End;
+End;
 
+
 end.

Modified: trunk/Lobby/TASClient/ReplaysUnit.dfm
===================================================================
--- trunk/Lobby/TASClient/ReplaysUnit.dfm	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/ReplaysUnit.dfm	2008-06-29 22:28:22 UTC (rev 6092)
@@ -1,6 +1,6 @@
 object ReplaysForm: TReplaysForm
-  Left = 542
-  Top = 105
+  Left = 421
+  Top = 86
   Width = 809
   Height = 640
   Caption = 'Replays'

Modified: trunk/Lobby/TASClient/TASClient.dof
===================================================================
--- trunk/Lobby/TASClient/TASClient.dof	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/TASClient.dof	2008-06-29 22:28:22 UTC (rev 6092)
@@ -100,7 +100,7 @@
 DebugSourceDirs=
 UsePackages=0
 [Parameters]
-RunParams=-menu -menudev
+RunParams=
 HostApplication=C:\Program Files\Spring\TASClient.exe
 Launcher=
 UseLauncher=0
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=3
 Release=0
-Build=326
+Build=328
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=TA Spring lobby client
-FileVersion=0.3.0.326
+FileVersion=0.3.0.328
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: trunk/Lobby/TASClient/TASClient.dpr
===================================================================
--- trunk/Lobby/TASClient/TASClient.dpr	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/TASClient.dpr	2008-06-29 22:28:22 UTC (rev 6092)
@@ -106,7 +106,8 @@
   IntfDocHostUIHandler in 'IntfDocHostUIHandler.pas',
   UContainer in 'UContainer.pas',
   UNulContainer in 'UNulContainer.pas',
-  class_TIntegerList in 'class_TIntegerList.pas';
+  class_TIntegerList in 'class_TIntegerList.pas',
+  OpenIL in 'openil.pas';
 
 var
   i: Integer;
@@ -169,13 +170,12 @@
   MainUnit.displayingNotificationList := TList.Create;
 
   // disable title bars if program is running under Wine:
-  if MainUnit.RunningUnderWine then
+  if MainUnit.RunningUnderWine or (Preferences.ThemeType &lt;&gt; thtTBX) or IsWindowsVista then
   begin
     SpTBXItem.ActivateTitleBarsOnStartUp := False;
-    MainForm.AddNotification('Wine detected!', 'All title bars have been disabled since they are not supported under Wine', 5000);
-  end
-  else if IsWindowsVista then
-    SpTBXItem.ActivateTitleBarsOnStartUp := False;
+    if MainUnit.RunningUnderWine then
+      MainForm.AddNotification('Wine detected!', 'All title bars have been disabled since they are not supported under Wine', 5000);
+  end;
 
   Application.Title := 'TASClient';
   Application.CreateForm(TMainForm, MainForm);
@@ -215,7 +215,8 @@
   Application.CreateForm(TAwayMessageForm, AwayMessageForm);
   Application.CreateForm(TColorsPreference, ColorsPreference);
   Application.CreateForm(TSearchPlayerForm, SearchPlayerForm);
-  Application.CreateForm(TMenuForm, MenuForm);
+  if not MainUnit.RunningUnderWine then
+    Application.CreateForm(TMenuForm, MenuForm);
   SplashScreenForm.UpdateText('Initializing ...');
 
   Application.Run;

Modified: trunk/Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)

Modified: trunk/Lobby/TASClient/Utility.pas
===================================================================
--- trunk/Lobby/TASClient/Utility.pas	2008-06-29 05:22:50 UTC (rev 6091)
+++ trunk/Lobby/TASClient/Utility.pas	2008-06-29 22:28:22 UTC (rev 6092)
@@ -8,7 +8,7 @@
 interface
 
 uses
-  Windows, Graphics, Classes, SyncObjs, Controls,Math,MainUnit;
+  Windows, Graphics, Classes, SyncObjs, Controls,Math,MainUnit,OpenIL;
 
 type
 
@@ -56,6 +56,7 @@
 function GetModHash(ModName: string): Integer;
 function GetModHash2(ModArchive: string): Integer;
 procedure LoadMod(ModName: string);
+function GetUnitBitmap(unitName: string):TBitmap;
 procedure ReloadUnitList; // will populate UnitNames and UnitList lists
 procedure ReloadSides; // populates SideList list and loads side images into SideImageList
 procedure LoadLuaOptions(modOptions: Boolean; mapName: String);
@@ -71,6 +72,8 @@
 
   UnitNames: TStrings; // list of unit names
   UnitList: TStrings; // list of &quot;code names&quot; of units
+  UnitBitmaps: TList; // list of TBitmap icon of units
+  UnitNodes: TList; // node associated in the disable form list
 
   ModValidMaps: TStringList; //
 
@@ -460,6 +463,52 @@
 
 { ------------------------------------------------------------------------ }
 
+function GetUnitBitmap(unitName: string):TBitmap;
+var
+  s,picture: string;
+  size: integer;
+  res: Integer;
+  imgWidth,imgHeight: integer;
+  tmp: TBitmap;
+  imgType: Cardinal;
+begin
+  Result := TBitmap.Create;
+  res := InitFindVFS(PChar('unitpics\'+unitName+'.*'));
+  SetLength(s, 255);
+  res := FindFilesVFS(res, PChar(s), 255);
+  if res &lt;&gt; 0 then
+  begin
+    res := OpenFileVFS(PChar(s));
+    size := FileSizeVFS(res);
+    SetLength(picture, size);
+    ReadFileVFS(res, PChar(picture), size);
+    CloseFileVFS(res);
+
+    if RightStr(LowerCase(Trim(s)),4) = '.dds' then
+      imgType := IL_DDS
+    else if RightStr(LowerCase(Trim(s)),4) = '.png' then
+      imgType := IL_PNG
+    else
+      imgType := IL_JPG;
+
+    if ilLoadL(imgType,Pointer(picture),size) = IL_TRUE then
+    begin
+      tmp := TBitmap.Create;
+
+      imgWidth := ilGetInteger(IL_IMAGE_WIDTH);
+      imgHeight := ilGetInteger(IL_IMAGE_HEIGHT);
+
+      tmp.Width := imgWidth;
+      tmp.Height := imgHeight;
+      tmp.PixelFormat := pf24bit;
+
+      ilCopyPixels(0,0,0,imgWidth,imgHeight,1,IL_BGR,IL_UNSIGNED_BYTE,tmp.ScanLine[imgHeight-1]);
+
+      BitmapFlip(True,True,tmp,Result);
+    end;
+  end;
+end;
+
 procedure ReloadUnitList; // will populate UnitNames and UnitList lists
 var
   i: Integer;
@@ -474,6 +523,7 @@
   begin
     UnitNames.Add(GetFullUnitName(i));
     UnitList.Add(GetUnitName(i));
+    UnitBitmaps.Add(GetUnitBitmap(GetUnitName(i)));
   end;
 end;
 
@@ -575,7 +625,9 @@
         AddBitmapToImageList(SideImageList, s[1], size);
       except
         LoadDefaultSideImage(UpperCase(SideList[i]));
-     end;
+      end;
+
+      CloseFileVFS(res);
     end;
   end; // for
 
@@ -736,6 +788,8 @@
   ModArchiveList := TStringList.Create;
   UnitList := TStringList.Create;
   UnitNames := TStringList.Create;
+  UnitBitmaps := TList.Create;
+  UnitNodes := TList.Create;
   SideList := TStringList.Create; // we will load side list when needed
   SideList.CaseSensitive := False;
   SideImageList := TImageList.CreateSize(16, 16);

Added: trunk/Lobby/TASClient/openil.pas
===================================================================
--- trunk/Lobby/TASClient/openil.pas	                        (rev 0)
+++ trunk/Lobby/TASClient/openil.pas	2008-06-29 22:28:22 UTC (rev 6092)
@@ -0,0 +1,518 @@
+unit OpenIL;
+
+//------------------------------------------------------------------------------
+//
+// ImageLib Sources
+// Copyright (C) 2000-2003 by Denton Woods
+// Last modified: 06/23/2002 &lt;--Y2K Compliant! =]
+//
+// Filename: il/il.h
+//
+// Description:  The main include file for DevIL
+//
+//------------------------------------------------------------------------------
+
+{******************************************************************************}
+{ Converted to Delphi by Alexander Blach (<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">alexander at abee.de</A>)                   }
+{   Version:       DevIL v1.6.6                                                }
+{   Last modified: 08/08/2003                                                  }
+{******************************************************************************}
+
+interface
+uses
+  Windows;
+
+//{$DEFINE IL_NO_BMP}
+//{$DEFINE IL_NO_CUT}
+//{$DEFINE IL_NO_CHEAD}
+//{$DEFINE IL_NO_DCX}
+//{$DEFINE IL_NO_DDS}
+//{$DEFINE IL_NO_DOOM}
+//{$DEFINE IL_NO_GIF}
+//{$DEFINE IL_NO_ICO}
+//{$DEFINE IL_NO_JPG}
+//{$DEFINE IL_NO_LIF}
+//{$DEFINE IL_NO_LBM}
+//{$DEFINE IL_NO_MDL}
+//{$DEFINE IL_NO_PCD}
+//{$DEFINE IL_NO_PCX}
+//{$DEFINE IL_NO_PIC}
+//{$DEFINE IL_NO_PNG}
+//{$DEFINE IL_NO_PNM}
+//{$DEFINE IL_NO_PSD}
+//{$DEFINE IL_NO_RAW}
+//{$DEFINE IL_NO_SGI}
+//{$DEFINE IL_NO_TGA}
+//{$DEFINE IL_NO_TIF}
+//{$DEFINE IL_NO_WAL}
+
+//{$DEFINE IL_USE_IJL}
+
+type
+  TILenum = LongWord;
+  TILboolean = Byte;
+  TILbitfield = LongWord;
+  TILbyte = ShortInt;
+  TILshort = SmallInt;
+  TILint = Integer;
+  TILsizei = Integer;
+  TILubyte = Byte;
+  TILushort = Word;
+  TILuint = LongWord;
+  TILfloat = Single;
+  TILclampf = Single;
+  TILdouble = Double;
+  TILclampd = Double;
+
+  PILboolean = ^Byte;
+  PILbitfield = ^LongWord;
+  PILbyte = ^ShortInt;
+  PILshort = ^SmallInt;
+  PILint = ^Integer;
+  PILsizei = ^Integer;
+  PILubyte = ^Byte;
+  PILushort = ^Word;
+  PILuint = ^LongWord;
+  PILfloat = ^Single;
+  PILclampf = ^Single;
+  PILdouble = ^Double;
+  PILclampd = ^Double;
+
+const
+  IL_FALSE = 0;
+  IL_TRUE = 1;
+
+
+  // Matches OpenGL's right now.
+  IL_COLOUR_INDEX = $1900;
+  IL_COLOR_INDEX = $1900;
+  IL_RGB = $1907;
+  IL_RGBA = $1908;
+  IL_BGR = $80E0;
+  IL_BGRA = $80E1;
+  IL_LUMINANCE = $1909;
+
+
+  IL_BYTE = $1400;
+  IL_UNSIGNED_BYTE = $1401;
+  IL_SHORT = $1402;
+  IL_UNSIGNED_SHORT = $1403;
+  IL_INT = $1404;
+  IL_UNSIGNED_INT = $1405;
+  IL_FLOAT = $1406;
+  IL_DOUBLE = $140A;
+
+
+  IL_VENDOR = $1F00;
+
+
+//
+// IL-specific 's
+//
+
+  IL_VERSION_1_5_6 = 1;
+  IL_VERSION = 156;
+  IL_LOAD_EXT = $1F01;
+  IL_SAVE_EXT = $1F02;
+
+
+
+// Attribute Bits
+  IL_ORIGIN_BIT = $00000001;
+  IL_FILE_BIT = $00000002;
+  IL_PAL_BIT = $00000004;
+  IL_FORMAT_BIT = $00000008;
+  IL_TYPE_BIT = $00000010;
+  IL_COMPRESS_BIT = $00000020;
+  IL_LOADFAIL_BIT = $00000040;
+  IL_FORMAT_SPECIFIC_BIT = $00000080;
+  IL_ALL_ATTRIB_BITS = $000FFFFF;
+
+
+// Palette types
+  IL_PAL_NONE = $0400;
+  IL_PAL_RGB24 = $0401;
+  IL_PAL_RGB32 = $0402;
+  IL_PAL_RGBA32 = $0403;
+  IL_PAL_BGR24 = $0404;
+  IL_PAL_BGR32 = $0405;
+  IL_PAL_BGRA32 = $0406;
+
+
+// Image types
+  IL_TYPE_UNKNOWN = $0000;
+  IL_BMP = $0420;
+  IL_CUT = $0421;
+  IL_DOOM = $0422;
+  IL_DOOM_FLAT = $0423;
+  IL_ICO = $0424;
+  IL_JPG = $0425;
+  IL_LBM = $0426;
+  IL_PCD = $0427;
+  IL_PCX = $0428;
+  IL_PIC = $0429;
+  IL_PNG = $042A;
+  IL_PNM = $042B;
+  IL_SGI = $042C;
+  IL_TGA = $042D;
+  IL_TIF = $042E;
+  IL_CHEAD = $042F;
+  IL_RAW = $0430;
+  IL_MDL = $0431;
+  IL_WAL = $0432;
+  IL_LIF = $0434;
+  IL_MNG = $0435;
+  IL_JNG = $0435;
+  IL_GIF = $0436;
+  IL_DDS = $0437;
+  IL_DCX = $0438;
+  IL_PSD = $0439;
+  IL_EXIF = $043A;
+  IL_PSP = $043B;
+  IL_PIX = $043C;
+  IL_PXR = $043D;
+  IL_XPM = $043E;
+
+  IL_JASC_PAL = $0475;
+
+
+// Error Types
+  IL_NO_ERROR = $0000;
+  IL_INVALID_ENUM = $0501;
+  IL_OUT_OF_MEMORY = $0502;
+  IL_FORMAT_NOT_SUPPORTED = $0503;
+  IL_INTERNAL_ERROR = $0504;
+  IL_INVALID_VALUE = $0505;
+  IL_ILLEGAL_OPERATION = $0506;
+  IL_ILLEGAL_FILE_VALUE = $0507;
+  IL_INVALID_FILE_HEADER = $0508;
+  IL_INVALID_PARAM = $0509;
+  IL_COULD_NOT_OPEN_FILE = $050A;
+  IL_INVALID_EXTENSION = $050B;
+  IL_FILE_ALREADY_EXISTS = $050C;
+  IL_OUT_FORMAT_SAME = $050D;
+  IL_STACK_OVERFLOW = $050E;
+  IL_STACK_UNDERFLOW = $050F;
+  IL_INVALID_CONVERSION = $0510;
+  IL_BAD_DIMENSIONS = $0511;
+  IL_FILE_READ_ERROR = $0512;
+
+  IL_LIB_GIF_ERROR = $05E1;
+  IL_LIB_JPEG_ERROR = $05E2;
+  IL_LIB_PNG_ERROR = $05E3;
+  IL_LIB_TIFF_ERROR = $05E4;
+  IL_LIB_MNG_ERROR = $05E5;
+  IL_UNKNOWN_ERROR = $05FF;
+
+
+// Origin Definitions
+  IL_ORIGIN_SET = $0600;
+  IL_ORIGIN_LOWER_LEFT = $0601;
+  IL_ORIGIN_UPPER_LEFT = $0602;
+  IL_ORIGIN_MODE = $0603;
+
+
+// Format and Type Mode Definitions
+  IL_FORMAT_SET = $0610;
+  IL_FORMAT_MODE = $0611;
+  IL_TYPE_SET = $0612;
+  IL_TYPE_MODE = $0613;
+
+
+// File definitions
+  IL_FILE_OVERWRITE = $0620;
+  IL_FILE_MODE = $0621;
+
+
+// Palette definitions
+  IL_CONV_PAL = $0630;
+
+
+// Load fail definitions
+  IL_DEFAULT_ON_FAIL = $0632;
+
+
+// Key colour definitions
+  IL_USE_KEY_COLOUR = $0635;
+  IL_USE_KEY_COLOR = $0635;
+
+
+// Interlace definitions
+  IL_SAVE_INTERLACED = $0639;
+  IL_INTERLACE_MODE = $063A;
+
+
+// Quantization definitions
+  IL_QUANTIZATION_MODE = $0640;
+  IL_WU_QUANT = $0641;
+  IL_NEU_QUANT = $0642;
+  IL_NEU_QUANT_SAMPLE = $0643;
+
+
+// Hints
+  IL_FASTEST = $0660;
+  IL_LESS_MEM = $0661;
+  IL_DONT_CARE = $0662;
+  IL_MEM_SPEED_HINT = $0665;
+  IL_USE_COMPRESSION = $0666;
+  IL_NO_COMPRESSION = $0667;
+  IL_COMPRESSION_HINT = $0668;
+
+
+// Subimage
+  IL_SUB_NEXT = $0680;
+  IL_SUB_MIPMAP = $0681;
+  IL_SUB_LAYER = $0682;
+
+
+// Compression definitions (mostly for .oil)
+  IL_COMPRESS_MODE = $0700;
+  IL_COMPRESS_NONE = $0701;
+  IL_COMPRESS_RLE = $0702;
+  IL_COMPRESS_LZO = $0703;
+  IL_COMPRESS_ZLIB = $0704;
+
+
+// File format-specific values
+  IL_TGA_CREATE_STAMP = $0710;
+  IL_JPG_QUALITY = $0711;
+  IL_PNG_INTERLACE = $0712;
+  IL_TGA_RLE = $0713;
+  IL_BMP_RLE = $0714;
+  IL_SGI_RLE = $0715;
+  IL_TGA_ID_STRING = $0717;
+  IL_TGA_AUTHNAME_STRING = $0718;
+  IL_TGA_AUTHCOMMENT_STRING = $0719;
+  IL_PNG_AUTHNAME_STRING = $071A;
+  IL_PNG_TITLE_STRING = $071B;
+  IL_PNG_DESCRIPTION_STRING = $071C;
+  IL_TIF_DESCRIPTION_STRING = $071D;
+  IL_TIF_HOSTCOMPUTER_STRING = $071E;
+  IL_TIF_DOCUMENTNAME_STRING = $071F;
+  IL_TIF_AUTHNAME_STRING = $0720;
+  IL_JPG_SAVE_FORMAT = $0721;
+  IL_CHEAD_HEADER_STRING = $0722;
+  IL_PCD_PICNUM = $0723;
+
+
+// DXTC definitions
+  IL_DXTC_FORMAT = $0705;
+  IL_DXT1 = $0706;
+  IL_DXT2 = $0707;
+  IL_DXT3 = $0708;
+  IL_DXT4 = $0709;
+  IL_DXT5 = $070A;
+  IL_DXT_NO_COMP = $070B;
+  IL_KEEP_DXTC_DATA = $070C;
+  IL_DXTC_DATA_FORMAT = $070D;
+
+
+// Cube map definitions
+  IL_CUBEMAP_POSITIVEX = $00000400;
+  IL_CUBEMAP_NEGATIVEX = $00000800;
+  IL_CUBEMAP_POSITIVEY = $00001000;
+  IL_CUBEMAP_NEGATIVEY = $00002000;
+  IL_CUBEMAP_POSITIVEZ = $00004000;
+  IL_CUBEMAP_NEGATIVEZ = $00008000;
+
+
+// Values
+  IL_VERSION_NUM = $0DE2;
+  IL_IMAGE_WIDTH = $0DE4;
+  IL_IMAGE_HEIGHT = $0DE5;
+  IL_IMAGE_DEPTH = $0DE6;
+  IL_IMAGE_SIZE_OF_DATA = $0DE7;
+  IL_IMAGE_BPP = $0DE8;
+  IL_IMAGE_BYTES_PER_PIXEL = $0DE8;
+  IL_IMAGE_BITS_PER_PIXEL = $0DE9;
+  IL_IMAGE_FORMAT = $0DEA;
+  IL_IMAGE_TYPE = $0DEB;
+  IL_PALETTE_TYPE = $0DEC;
+  IL_PALETTE_SIZE = $0DED;
+  IL_PALETTE_BPP = $0DEE;
+  IL_PALETTE_NUM_COLS = $0DEF;
+  IL_PALETTE_BASE_TYPE = $0DF0;
+  IL_NUM_IMAGES = $0DF1;
+  IL_NUM_MIPMAPS = $0DF2;
+  IL_NUM_LAYERS = $0DF3;
+  IL_ACTIVE_IMAGE = $0DF4;
+  IL_ACTIVE_MIPMAP = $0DF5;
+  IL_ACTIVE_LAYER = $0DF6;
+  IL_CUR_IMAGE = $0DF7;
+  IL_IMAGE_DURATION = $0DF8;
+  IL_IMAGE_PLANESIZE = $0DF9;
+  IL_IMAGE_BPC = $0DFA;
+  IL_IMAGE_OFFX = $0DFB;
+  IL_IMAGE_OFFY = $0DFC;
+  IL_IMAGE_CUBEFLAGS = $0DFD;
+
+
+const
+{$IFDEF OPENIL_DEBUG}
+  OPENILDLL = 'DevIL-d.DLL';
+{$ELSE}
+  OPENILDLL = 'DevIL.DLL';
+{$ENDIF}
+
+  IL_SEEK_SET = 0;
+  IL_SEEK_CUR = 1;
+  IL_SEEK_END = 2;
+  IL_EOF = -1;
+
+// Callback functions for file reading
+type
+  TILHandle = Pointer;
+// Callback functions for file reading
+  TfCloseRProc = procedure(Handle: TILHandle); stdcall;
+  TfEofProc   = function(Handle: TILHandle): TILboolean; stdcall;
+  TfGetcProc  = function(Handle: TILHandle): TILint; stdcall;
+  TfOpenRProc  = function(FileName: PChar): TILHandle; stdcall;
+  TfReadProc  = function(Buffer: Pointer; Size, Count: TILint;
+    Handle: TILHandle): TILint; stdcall;
+  TfSeekRProc  = function(Handle: TILHandle; Offset, Origin: TILint): TILint;
+    stdcall;
+  TfTellRProc  = function(Handle: TILHandle): TILint; stdcall;
+
+// Callback function for file writing
+  TfCloseWProc = procedure(Handle: TILHandle); stdcall;
+  TfOpenWProc  = function(FileName: PChar): TILHandle; stdcall;
+  TfPutcProc   = function(c: TILubyte; Handle: TILHandle): TILint; stdcall;
+  TfSeekWProc  = function(Handle: TILHandle; Offset, Origin: TILint): TILint;
+    stdcall;
+  TfTellWProc  = function(Handle: TILHandle): TILint; stdcall;
+  TfWriteProc  = function(Buffer: Pointer; Size: TILuint; Count: TILuint;
+    Handle: TILHandle): TILint; stdcall;
+
+// Registered format procedures
+  TIL_LOADPROC = function(FileName: PChar): TILboolean; stdcall;
+  TIL_SAVEPROC = function(FileName: PChar): TILboolean; stdcall;
+
+
+// ImageLib Functions
+function ilActiveImage(Number: TILuint): TILboolean; stdcall;
+  external OPENILDLL;
+function ilActiveLayer(Number: TILuint): TILboolean; stdcall;
+  external OPENILDLL;
+function ilActiveMipmap(Number: TILuint): TILboolean; stdcall;
+  external OPENILDLL;
+function ilApplyPal(FileName: PChar): TILboolean; stdcall; external OPENILDLL;
+function ilApplyProfile(InProfile, OutProfile: PChar): TILboolean; stdcall; external OPENILDLL;
+procedure ilBindImage(Image: TILuint); stdcall; external
+  OPENILDLL;
+function ilBlit(Src: TILuint; DestX, DestY, DestZ: TILint; SrcX, SrcY, SrcZ, Width, Height, Depth: TILuint): TILboolean; stdcall; external OPENILDLL;
+procedure ilClearColour(Red, Green, Blue, Alpha: TILclampf); stdcall; external OPENILDLL;
+procedure ilClearColor(Red, Green, Blue, Alpha: TILclampf); stdcall; external OPENILDLL name 'ilClearColour';
+function ilClearImage: TILboolean; stdcall; external OPENILDLL;
+function ilCloneCurImage: TILuint; stdcall; external OPENILDLL;
+function ilCompressFunc(Mode: TILenum): TILboolean; stdcall; external OPENILDLL;
+function ilConvertImage(DestFormat, DestType: TILenum): TILboolean; stdcall; external
+  OPENILDLL;
+function ilConvertPal(DestFormat: TILenum): TILboolean; stdcall; external
+  OPENILDLL;
+function ilCopyImage(Src: TILuint): TILboolean; stdcall; external OPENILDLL;
+procedure ilCopyPixels(XOff, YOff, ZOff, Width, Height, Depth: TILuint;
+  Format, _Type: TILenum; Data: Pointer); stdcall; external OPENILDLL;
+procedure ilCreateSubImage(SubType: TILenum; Num: TILuint); stdcall; external OPENILDLL;
+procedure ilDefaultImage; stdcall; external OPENILDLL;
+procedure ilDeleteImages(Num: TILsizei; const Images: PILuint); stdcall;
+  external OPENILDLL;
+function ilDisable(Mode: TILenum): TILboolean; stdcall; external OPENILDLL;
+function ilEnable(Mode: TILenum): TILboolean; stdcall; external OPENILDLL;
+function ilFormatFunc(Mode: TILenum): TILboolean; stdcall; external OPENILDLL;
+procedure ilGenImages(Num: TILsizei; Images: PILuint); stdcall; external
+  OPENILDLL;
+function ilGetAlpha(_Type: TILenum): PILubyte; stdcall; external OPENILDLL;
+function ilGetBoolean(Mode: TILenum): TILboolean; stdcall; external OPENILDLL;
+procedure ilGetBooleanv(Mode: TILenum; Param: PILboolean); stdcall; external
+  OPENILDLL;
+function ilGetData: PILubyte; stdcall; external OPENILDLL;
+function ilGetDXTCData(Buffer: PILubyte; BufferSize: TILuint; DXTCFormat: TILenum):
+  TILuint; stdcall; external OPENILDLL;
+function ilGetError: TILenum; stdcall; external OPENILDLL;
+function ilGetInteger(Mode: TILenum): TILint; stdcall; external OPENILDLL;
+procedure ilGetIntegerv(Mode: TILenum; Param: PILint); stdcall; external
+  OPENILDLL;
+function ilGetLumpPos: TILuint; stdcall; external OPENILDLL;
+function ilGetPalette: PILubyte; stdcall; external OPENILDLL;
+function ilGetString(StringName: TILenum): PChar; stdcall; external OPENILDLL;
+procedure ilHint(Target, Mode: TILenum); stdcall; external OPENILDLL;
+procedure ilInit; stdcall; external OPENILDLL;
+function ilIsDisabled(Mode: TILenum): TILboolean; stdcall; external OPENILDLL;
+function ilIsEnabled(Mode: TILenum): TILboolean; stdcall; external OPENILDLL;
+function ilIsImage(Image: TILuint): TILboolean; stdcall; external OPENILDLL;
+function ilIsValid(_Type: TILenum; FileName: PChar): TILboolean; stdcall;
+  external OPENILDLL;
+function ilIsValidF(_Type: TILenum; _File: TILHandle): TILboolean; stdcall;
+  external OPENILDLL;
+function ilIsValidL(_Type: TILenum; Lump: Pointer; Size: TILuint): TILboolean;
+  stdcall; external OPENILDLL;
+procedure ilKeyColor(Red: TILubyte; Green: TILubyte; Blue: TILubyte; PalNum: TILubyte);
+  stdcall; external OPENILDLL name 'ilKeyColour';
+procedure ilKeyColour(Red: TILubyte; Green: TILubyte; Blue: TILubyte; PalNum: TILubyte);
+  stdcall; external OPENILDLL;
+function ilLoad(_Type: TILenum; FileName: PChar): TILboolean; stdcall;
+  external OPENILDLL;
+function ilLoadF(_Type: TILenum; _File: TILHandle): TILboolean; stdcall;
+  external OPENILDLL;
+function ilLoadImage(FileName: PChar): TILboolean; stdcall; external OPENILDLL;
+function ilLoadL(_Type: TILenum; Lump: Pointer; Size: TILuint): TILboolean; stdcall;
+  external OPENILDLL;
+function ilLoadPal(FileName: PChar): TILboolean; stdcall; external OPENILDLL;
+function ilOriginFunc(Mode: TILenum): TILboolean; stdcall; external OPENILDLL;
+function ilOverlayImage(Src: TILuint; XCoord, YCoord, ZCoord: TILint):
+  TILboolean; stdcall; external OPENILDLL;
+procedure ilPopAttrib; stdcall; external OPENILDLL;
+procedure ilPushAttrib(Bits: TILuint); stdcall; external OPENILDLL;
+procedure ilRegisterFormat(Format: TILenum); stdcall; external OPENILDLL;
+function ilRegisterLoad(Ext: PChar; Load: TIL_LOADPROC): TILboolean; stdcall;
+  external OPENILDLL;
+function ilRegisterMipNum(Num: TILuint): TILboolean; stdcall; external OPENILDLL;
+function ilRegisterNumImages(Num: TILuint): TILboolean;  stdcall;
+  external OPENILDLL;
+procedure ilRegisterOrigin(Origin: TILenum); stdcall; external OPENILDLL;
+procedure ilRegisterPal(Pal: Pointer; Size: TILuint; _Type: TILenum); stdcall;
+  external OPENILDLL;
+function ilRegisterSave(Ext: PChar; Save: TIL_SAVEPROC): TILboolean; stdcall;
+  external OPENILDLL;
+procedure ilRegisterType(_Type: TILenum); stdcall; external OPENILDLL;
+function ilRemoveLoad(Ext: PChar): TILboolean; stdcall; external OPENILDLL;
+function ilRemoveSave(Ext: PChar): TILboolean; stdcall; external OPENILDLL;
+procedure ilResetRead; stdcall; external OPENILDLL;
+procedure ilResetWrite; stdcall; external OPENILDLL;
+function ilSave(_Type: TILenum; FileName: PChar): TILboolean; stdcall;
+  external OPENILDLL;
+function ilSaveF(_Type: TILenum; _File: TILHandle): TILboolean; stdcall;
+  external OPENILDLL;
+function ilSaveImage(FileName: PChar): TILboolean; stdcall; external OPENILDLL;
+function ilSaveL(_Type: TILenum; Lump: Pointer; Size: TILuint): TILboolean;
+  stdcall; external OPENILDLL;
+function ilSavePal(FileName: PChar): TILboolean; stdcall; external
+  OPENILDLL;
+function ilSetData(Data: Pointer): TILboolean; stdcall; external OPENILDLL;
+function ilSetDuration(Duration: TILuint): TILboolean; stdcall;
+  external OPENILDLL;
+procedure ilSetInteger(Mode: TILenum; Param: TILint); stdcall; external OPENILDLL;
+procedure ilSetPixels(XOff, YOff, ZOff, Width, Height, Depth: TILuint;
+  Format, _Type: TILenum; Data: Pointer); stdcall; external OPENILDLL;
+procedure ilSetRead(Open: TfOpenRProc; Close: TfCloseRProc;
+  Eof: TfEofProc; Getc: TfGetcProc; Read: TfReadProc; Seek: TfSeekRProc;
+  Tell: TfTellRProc); stdcall; external OPENILDLL;
+procedure ilSetString(Mode: TILenum; Param: PChar); stdcall; external OPENILDLL; 
+procedure ilSetWrite(Open: TfOpenWProc; Close: TfCloseWProc;
+  Putc: TfPutcProc; Seek: TfSeekWProc;
+  Tell: TfTellWProc; Write: TfWriteProc); stdcall; external OPENILDLL;
+function ilTexImage(Width, Height, Depth: TILuint; Bpp: TILubyte; Format, _Type:
+  TILenum; Data: Pointer): TILboolean; stdcall; external OPENILDLL;
+function ilTypeFunc(Mode: TILenum): TILboolean; stdcall; external OPENILDLL;
+function ilLoadData(FileName: PChar; Width, Height, Depth: TILuint;
+  Bpp: TILubyte): TILboolean; stdcall; external OPENILDLL;
+function ilLoadDataF(_File: TILHandle; Width, Height, Depth: TILuint;
+  Bpp: TILubyte): TILboolean; stdcall; external OPENILDLL;
+function ilLoadDataL(Lump: Pointer; Size: TILuint; Width, Height, Depth: TILuint;
+  Bpp: TILubyte): TILboolean; stdcall; external OPENILDLL;
+function ilSaveData(FileName: PChar): TILboolean; stdcall; external OPENILDLL;
+
+implementation
+
+end.
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000871.html">[Taspring-linux-commit] r6091 - in trunk: rts/Game	rts/Game/StartScripts rts/Lua rts/Rendering/UnitModels	rts/System/FileSystem rts/System/Platform	rts/System/Platform/Linux tools/DedicatedServer tools/unitsync
</A></li>
	<LI>Next message: <A HREF="000873.html">[Taspring-linux-commit] r6093 - trunk/Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#872">[ date ]</a>
              <a href="thread.html#872">[ thread ]</a>
              <a href="subject.html#872">[ subject ]</a>
              <a href="author.html#872">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
