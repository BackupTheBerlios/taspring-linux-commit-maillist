<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7483 - in Lobby/TASClient: .	Python/modules Python/modules/encodings Python/scripts
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2010-May/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7483%20-%20in%20Lobby/TASClient%3A%20.%0A%09Python/modules%20Python/modules/encodings%20Python/scripts&In-Reply-To=%3C20100502010107.268B928812%40it-l.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="002254.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7483 - in Lobby/TASClient: .	Python/modules Python/modules/encodings Python/scripts</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7483%20-%20in%20Lobby/TASClient%3A%20.%0A%09Python/modules%20Python/modules/encodings%20Python/scripts&In-Reply-To=%3C20100502010107.268B928812%40it-l.eu%3E"
       TITLE="[Taspring-linux-commit] r7483 - in Lobby/TASClient: .	Python/modules Python/modules/encodings Python/scripts">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sun May  2 03:01:06 CEST 2010</I>
    <P><UL>
        
        <LI>Next message: <A HREF="002254.html">[Taspring-linux-commit] r7484 - in Lobby/TASClient: . Python/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2253">[ date ]</a>
              <a href="thread.html#2253">[ thread ]</a>
              <a href="subject.html#2253">[ subject ]</a>
              <a href="author.html#2253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2010-05-02 03:01:06 +0200 (Sun, 02 May 2010)
New Revision: 7483

Added:
   Lobby/TASClient/Python/modules/encodings/
   Lobby/TASClient/Python/modules/encodings/__init__.py
   Lobby/TASClient/Python/modules/encodings/aliases.py
   Lobby/TASClient/Python/modules/encodings/ascii.py
   Lobby/TASClient/Python/modules/encodings/cp1252.py
   Lobby/TASClient/Python/modules/encodings/latin_1.py
   Lobby/TASClient/Python/modules/encodings/utf_8.py
Modified:
   Lobby/TASClient/AddBotUnit.dfm
   Lobby/TASClient/AutoJoinFormUnit.dfm
   Lobby/TASClient/BattleFormUnit.dfm
   Lobby/TASClient/BattleFormUnit.pas
   Lobby/TASClient/ChannelsListFormUnit.dfm
   Lobby/TASClient/ColorsPreferenceUnit.dfm
   Lobby/TASClient/CustomizeGUIFormUnit.dfm
   Lobby/TASClient/HostInfoUnit.dfm
   Lobby/TASClient/LobbyScriptUnit.pas
   Lobby/TASClient/LogonFormUnit.dfm
   Lobby/TASClient/MainUnit.dfm
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/Minimap3DPreviewUnit.dfm
   Lobby/TASClient/Minimap3DPreviewUnit.pas
   Lobby/TASClient/PreferencesFormUnit.dfm
   Lobby/TASClient/Python/scripts/SubmitCrashReport.py
   Lobby/TASClient/Python/scripts/forumIt.py
   Lobby/TASClient/Python/scripts/googleIt.py
   Lobby/TASClient/PythonScriptDebugFormUnit.dfm
   Lobby/TASClient/SpringDownloaderFormUnit.dfm
   Lobby/TASClient/SpringDownloaderFormUnit.pas
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.dpr
   Lobby/TASClient/TASClient.res
   Lobby/TASClient/TemplateEditorFormUnit.dfm
   Lobby/TASClient/Utility.pas
Log:
* AI Options are now supported
* few small skin bugs fixed
* PYTHON : SubmitCrashReport updated by Zydox
* PYTHON : googleIt.py context menu translation now works with non latin characters
* PYTHON : googleIt.py : sending &quot;!translate languageCode message&quot; will automatically google translate the message and send it (works anywhare, in PM, channels and battle chat) example : &quot;!translate es how are you ?&quot;
* PYTHON : googleIt.py : new &quot;auto translate&quot; context menu for players, every message you will receive from them will be automatically translated in the chosen language

Modified: Lobby/TASClient/AddBotUnit.dfm
===================================================================
--- Lobby/TASClient/AddBotUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/AddBotUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -1,10 +1,9 @@
 object AddBotForm: TAddBotForm
-  Left = 1347
-  Top = 184
-  BorderStyle = bsDialog
+  Left = 1019
+  Top = 243
+  Width = 464
+  Height = 509
   Caption = 'Add bot dialog'
-  ClientHeight = 482
-  ClientWidth = 456
   Color = clBtnFace
   Font.Charset = DEFAULT_CHARSET
   Font.Color = clWindowText

Modified: Lobby/TASClient/AutoJoinFormUnit.dfm
===================================================================
--- Lobby/TASClient/AutoJoinFormUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/AutoJoinFormUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -15,6 +15,7 @@
   Font.Style = []
   OldCreateOrder = False
   Position = poMainFormCenter
+  Scaled = False
   OnCreate = FormCreate
   OnShow = FormShow
   PixelsPerInch = 96

Modified: Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/BattleFormUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/BattleFormUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -1,6 +1,6 @@
 object BattleForm: TBattleForm
-  Left = 767
-  Top = 133
+  Left = 686
+  Top = 165
   Width = 923
   Height = 736
   Caption = 'Battle window'
@@ -12748,7 +12748,7 @@
         Align = alClient
         BiDiMode = bdLeftToRight
         ParentBiDiMode = False
-        ActiveTabIndex = 1
+        ActiveTabIndex = 3
         OnActiveTabChange = SpTBXTabControl1ActiveTabChange
         HiddenItems = &lt;&gt;
         object QuickLookTab: TSpTBXTabItem
@@ -12759,7 +12759,6 @@
         object GameOptionsTab: TSpTBXTabItem
           Caption = 'Game options'
           Wrapping = twWrap
-          Checked = True
           CustomWidth = 80
           CustomHeight = 35
         end
@@ -12771,6 +12770,7 @@
         object MapTab: TSpTBXTabItem
           Caption = 'Map options'
           Wrapping = twWrap
+          Checked = True
           CustomWidth = 94
         end
         object ModTab: TSpTBXTabItem
@@ -12801,138 +12801,6 @@
             OnMouseMove = QuickLookRichEditMouseMove
           end
         end
-        object ModTabSheet: TSpTBXTabSheet
-          Left = 0
-          Top = 39
-          Width = 417
-          Height = 234
-          Caption = 'Mod options'
-          ImageIndex = -1
-          DesignSize = (
-            417
-            234)
-          TabItem = 'ModTab'
-          object ModOptionsScrollBox: TTntScrollBox
-            Left = 8
-            Top = 48
-            Width = 401
-            Height = 177
-            VertScrollBar.Smooth = True
-            VertScrollBar.Tracking = True
-            Anchors = [akLeft, akTop, akBottom]
-            BiDiMode = bdLeftToRight
-            BorderStyle = bsNone
-            Color = clBtnFace
-            Ctl3D = False
-            ParentBiDiMode = False
-            ParentBackground = True
-            ParentColor = False
-            ParentCtl3D = False
-            TabOrder = 0
-          end
-          object panelModOptionsDefault: TSpTBXPanel
-            Left = 8
-            Top = 4
-            Width = 402
-            Height = 41
-            Align = alCustom
-            TabOrder = 1
-            TBXStyleBackground = True
-            object btLoadDefaultMDO: TSpTBXButton
-              Left = 137
-              Top = 8
-              Width = 128
-              Height = 25
-              Caption = 'Load default'
-              TabOrder = 0
-              OnClick = btLoadDefaultMDOClick
-            end
-            object btSetAsDefaultMDO: TSpTBXButton
-              Left = 269
-              Top = 8
-              Width = 128
-              Height = 25
-              Caption = 'Set as default'
-              TabOrder = 1
-              OnClick = btSetAsDefaultMDOClick
-            end
-            object btLoadModsDefaultMDO: TSpTBXButton
-              Left = 5
-              Top = 8
-              Width = 128
-              Height = 25
-              Caption = 'Load mod'#39's default'
-              TabOrder = 2
-              OnClick = btLoadModsDefaultMDOClick
-            end
-          end
-        end
-        object MapTabSheet: TSpTBXTabSheet
-          Left = 0
-          Top = 39
-          Width = 417
-          Height = 234
-          Caption = 'Map options'
-          ImageIndex = -1
-          DesignSize = (
-            417
-            234)
-          TabItem = 'MapTab'
-          object MapOptionsScrollBox: TTntScrollBox
-            Left = 8
-            Top = 48
-            Width = 401
-            Height = 177
-            VertScrollBar.Smooth = True
-            VertScrollBar.Tracking = True
-            Anchors = [akLeft, akTop, akBottom]
-            BiDiMode = bdLeftToRight
-            BorderStyle = bsNone
-            Color = clBtnFace
-            Ctl3D = False
-            ParentBiDiMode = False
-            ParentBackground = True
-            ParentColor = False
-            ParentCtl3D = False
-            TabOrder = 0
-          end
-          object panelMapOptionsDefault: TSpTBXPanel
-            Left = 8
-            Top = 4
-            Width = 402
-            Height = 41
-            Align = alCustom
-            TabOrder = 1
-            TBXStyleBackground = True
-            object btLoadMapsDefaultMPO: TSpTBXButton
-              Left = 5
-              Top = 8
-              Width = 128
-              Height = 25
-              Caption = 'Load map'#39's default'
-              TabOrder = 2
-              OnClick = btLoadMapsDefaultMPOClick
-            end
-            object btLoadDefaultMPO: TSpTBXButton
-              Left = 137
-              Top = 8
-              Width = 128
-              Height = 25
-              Caption = 'Load default'
-              TabOrder = 0
-              OnClick = btLoadDefaultMPOClick
-            end
-            object btSetAsDefaultMPO: TSpTBXButton
-              Left = 269
-              Top = 8
-              Width = 128
-              Height = 25
-              Caption = 'Set as default'
-              TabOrder = 1
-              OnClick = btSetAsDefaultMPOClick
-            end
-          end
-        end
         object SpTBXTabSheet1: TSpTBXTabSheet
           Left = 0
           Top = 39
@@ -13197,6 +13065,140 @@
             OnClick = SetDefaultButtonClick
           end
         end
+        object ModTabSheet: TSpTBXTabSheet
+          Left = 0
+          Top = 39
+          Width = 417
+          Height = 234
+          Caption = 'Mod options'
+          ImageIndex = -1
+          DesignSize = (
+            417
+            234)
+          TabItem = 'ModTab'
+          object ModOptionsScrollBox: TTntScrollBox
+            Left = 8
+            Top = 48
+            Width = 401
+            Height = 177
+            VertScrollBar.Smooth = True
+            VertScrollBar.Tracking = True
+            Anchors = [akLeft, akTop, akRight, akBottom]
+            BiDiMode = bdLeftToRight
+            BorderStyle = bsNone
+            Color = clBtnFace
+            Ctl3D = False
+            ParentBiDiMode = False
+            ParentBackground = True
+            ParentColor = False
+            ParentCtl3D = False
+            TabOrder = 0
+          end
+          object panelModOptionsDefault: TSpTBXPanel
+            Left = 8
+            Top = 4
+            Width = 402
+            Height = 41
+            Align = alCustom
+            Anchors = [akLeft, akTop, akRight]
+            TabOrder = 1
+            TBXStyleBackground = True
+            object btLoadDefaultMDO: TSpTBXButton
+              Left = 137
+              Top = 8
+              Width = 128
+              Height = 25
+              Caption = 'Load default'
+              TabOrder = 0
+              OnClick = btLoadDefaultMDOClick
+            end
+            object btSetAsDefaultMDO: TSpTBXButton
+              Left = 269
+              Top = 8
+              Width = 128
+              Height = 25
+              Caption = 'Set as default'
+              TabOrder = 1
+              OnClick = btSetAsDefaultMDOClick
+            end
+            object btLoadModsDefaultMDO: TSpTBXButton
+              Left = 5
+              Top = 8
+              Width = 128
+              Height = 25
+              Caption = 'Load mod'#39's default'
+              TabOrder = 2
+              OnClick = btLoadModsDefaultMDOClick
+            end
+          end
+        end
+        object MapTabSheet: TSpTBXTabSheet
+          Left = 0
+          Top = 39
+          Width = 417
+          Height = 234
+          Caption = 'Map options'
+          ImageIndex = -1
+          DesignSize = (
+            417
+            234)
+          TabItem = 'MapTab'
+          object MapOptionsScrollBox: TTntScrollBox
+            Left = 8
+            Top = 48
+            Width = 401
+            Height = 177
+            VertScrollBar.Smooth = True
+            VertScrollBar.Tracking = True
+            Anchors = [akLeft, akTop, akRight, akBottom]
+            BiDiMode = bdLeftToRight
+            BorderStyle = bsNone
+            Color = clBtnFace
+            Ctl3D = False
+            ParentBiDiMode = False
+            ParentBackground = True
+            ParentColor = False
+            ParentCtl3D = False
+            TabOrder = 0
+          end
+          object panelMapOptionsDefault: TSpTBXPanel
+            Left = 8
+            Top = 4
+            Width = 402
+            Height = 41
+            Align = alCustom
+            Anchors = [akLeft, akTop, akRight]
+            TabOrder = 1
+            TBXStyleBackground = True
+            object btLoadMapsDefaultMPO: TSpTBXButton
+              Left = 5
+              Top = 8
+              Width = 128
+              Height = 25
+              Caption = 'Load map'#39's default'
+              TabOrder = 2
+              OnClick = btLoadMapsDefaultMPOClick
+            end
+            object btLoadDefaultMPO: TSpTBXButton
+              Left = 137
+              Top = 8
+              Width = 128
+              Height = 25
+              Caption = 'Load default'
+              TabOrder = 0
+              OnClick = btLoadDefaultMPOClick
+            end
+            object btSetAsDefaultMPO: TSpTBXButton
+              Left = 269
+              Top = 8
+              Width = 128
+              Height = 25
+              Caption = 'Set as default'
+              TabOrder = 1
+              OnClick = btSetAsDefaultMPOClick
+            end
+          end
+        end
       end
     end
   end
@@ -13233,6 +13235,11 @@
     OnPopup = PlayerControlPopupMenuPopup
     Left = 304
     Top = 352
+    object BotOptionsItem: TSpTBXItem
+      Caption = 'Options'
+      OnClick = BotOptionsItemClick
+      FontSettings.Style = [fsBold]
+    end
     object ForceTeamSpin: TSpTBXEditItem
       Caption = 'Set Id'
       CustomWidth = -1
@@ -13256,6 +13263,7 @@
       end
       object SpTBXItem7: TSpTBXItem
         Caption = 'Customize ...'
+        Images = MainForm.ArrowList
         OnClick = SpTBXItem7Click
       end
       object SpTBXSeparatorItem2: TSpTBXSeparatorItem

Modified: Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- Lobby/TASClient/BattleFormUnit.pas	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/BattleFormUnit.pas	2010-05-02 01:01:06 UTC (rev 7483)
@@ -34,131 +34,6 @@
   TJvXPCustomButtonHack = class(TJvXPCustomButton); // another hack to expose Color property
 
   TClientNodeType = (NodeError, NormalClient, NormalBot, OriginalClient,Separator); // used to differentiate between &quot;types&quot; of nodes in the visual battle clients list, so for example we can decided what to paint on OnPaint event etc. NodeError is used to indicate that certain node has invalid position.
-
-  TLuaOption = class
-  protected
-    LabelName: TSpTBXLabel;
-    DescriptionButton: TSpTBXButton;
-    procedure MakeDescriptionButton(AOwner: TWinControl);
-    procedure OnDescriptionButtonClick(Sender: TObject);virtual;
-    function GetSectionPanel(luaOptionList: TList): TSpTBXGroupBox;
-
-  public
-    Value: String;
-    DefaultValue: String;
-    KeyPrefix: String;
-    Key: String;
-    Name: String;
-    Description: String;
-    Section: String;
-    hasChanged: Boolean;
-    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;virtual;
-    procedure SetValue(v: String);virtual;
-    procedure OnChange(Sender: TObject);virtual;
-    procedure Enable;virtual;
-    procedure Disable;virtual;
-    procedure setToDefault();virtual;
-    function isDefault:Boolean;virtual;
-    function toString:String;virtual;
-    function toSetScriptTagsString:String;virtual;
-    function getDescription:string;virtual;
-    destructor Destroy; override;
-  end;
-
-  TLuaOptionSection = class(TLuaOption)
-  private
-
-  protected
-    Panel: TSpTBXGroupBox;
-  public
-    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
-    procedure SetValue(v: String);override;
-    procedure Enable;override;
-    procedure Disable;override;
-    procedure setToDefault();override;
-     function isDefault:Boolean;override;
-    function toString:String;override;
-    destructor Destroy; override;
-  end;
-
-  TLuaOptionBool = class(TLuaOption)
-  private
-
-  protected
-    Panel: TSpTBXPanel;
-    CheckBox: TSpTBXCheckBox;
-  public
-    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
-    procedure SetValue(v: String);override;
-    procedure Enable;override;
-    procedure Disable;override;
-    procedure setToDefault();override;
-    function isDefault:Boolean;override;
-    function toString:String;override;
-    destructor Destroy; override;
-  end;
-
-  TLuaOptionString = class(TLuaOption)
-  private
-
-  protected
-    Panel: TSpTBXPanel;
-    InputEdit: TSpTBXEdit;
-  public
-    MaxStringLength: Integer;
-    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
-    procedure SetValue(v: String);override;
-    procedure Enable;override;
-    procedure Disable;override;
-    procedure setToDefault();override;
-    function isDefault:Boolean;override;
-    function toString:String;override;
-    destructor Destroy; override;
-  end;
-
-  TLuaOptionNumber = class(TLuaOption)
-  private
-
-  protected
-    Panel: TSpTBXPanel;
-    InputEdit: TJvSpinEdit;
-  public
-    MinValue: Double;
-    MaxValue: Double;
-    StepValue: Double;
-    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
-    procedure SetValue(v: String);override;
-    procedure Enable;override;
-    procedure Disable;override;
-    procedure setToDefault();override;
-    function isDefault:Boolean;override;
-    procedure OnChange(Sender: TObject);override;
-    function toSetScriptTagsString:String;override;
-    function toString:String;override;
-    destructor Destroy; override;
-  end;
-
-  TLuaOptionList = class(TLuaOption)
-  private
-    Panel: TSpTBXPanel;
-    ComboBox: TSpTBXComboBox;
-
-  public
-    NameList: TStringList;
-    KeyList: TStringList;
-    DescriptionList: TStringList;
-    constructor Create;
-    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
-    procedure SetValue(v: String);override;
-    procedure Enable;override;
-    procedure Disable;override;
-    procedure setToDefault();override;
-    function isDefault:Boolean;override;
-    function toString:String;override;
-    function nameToString:String;
-    function getDescription:string;override;
-    destructor Destroy; override;
-  end;
   
   TBattleForm = class(TForm)
     GameTimer: TTimer;
@@ -434,6 +309,7 @@
     mnuTeamColorPalette: TSpTBXColorPalette;
     mnuForceTeamColorPalette: TSpTBXColorPalette;
     ReadyButton: TSpTBXSpeedButton;
+    BotOptionsItem: TSpTBXItem;
 
     procedure CreateParams(var Params: TCreateParams); override;
 
@@ -588,9 +464,6 @@
     procedure lblMetalClick(Sender: TObject);
     procedure lblEnergyClick(Sender: TObject);
     procedure lblUnitsClick(Sender: TObject);
-
-    procedure DisplayLuaOptions(luaOptionList: TList; tabSheet: TWinControl);
-    function GetLuaOption(optList: TList;key: string): TLuaOption;
     procedure ChangeScriptTagValue(completeKey: String; value: String);
     procedure SendLuaOptionsDetailsToServer;
     procedure FormResize(Sender: TObject);
@@ -741,6 +614,7 @@
       ARow: Integer; var Color: TColor; var Name: WideString);
     procedure mnuForceTeamColorPaletteCellClick(Sender: TObject; ACol,
       ARow: Integer; var Allow: Boolean);
+    procedure BotOptionsItemClick(Sender: TObject);
   private
     History: TWideStringList;
     HistoryIndex: Integer;
@@ -1312,7 +1186,7 @@
   AddBotForm.ChangeSide(Min(Max(0, SideList.IndexOf(Side2)), SideList.Count-1));
 
   // load mod options
-  LoadLuaOptions(True,'');
+  Utility.LoadModOptions;
   DisplayLuaOptions(ModOptionsList,ModOptionsScrollBox);
   LoadModOptionsDefault(ModName);
   panelModOptionsDefault.Visible := ModOptionsList.Count &gt; 0;
@@ -1552,7 +1426,7 @@
   MapImage.Hint := GetMapItem(MapIndex).MapName + '. '+_('Use Shift+Click/Drag to draw a new box, Ctrl+Click/Drag to move an existing box, 1-2-3-... over a box to change its id and DEL over a box to delete it.');
 
   // load map options
-  LoadLuaOptions(False,GetMapItem(MapIndex).MapName);
+  Utility.LoadMapOptions(GetMapItem(MapIndex).MapName);
   DisplayLuaOptions(BattleForm.MapOptionsList,BattleForm.MapOptionsScrollBox);
   LoadMapOptionsDefault;
   // UnknownScriptTagList.ValueList[UnknownScriptTagList.CompleteKeyList.IndexOf(LowerCase(completeKey))] := value
@@ -2051,7 +1925,7 @@
     if (Utility.ModValidMaps&lt;&gt;nil) and (Utility.ModValidMaps.Count &gt; 0) and (Utility.ModValidMaps.IndexOf(Utility.MapList[CurrentMapIndex]) = -1) then
       ChangeMap(Utility.MapList.IndexOf(MapSelectionForm.MapListBox.Items[0]));
 
-    LoadLuaOptions(False,TMapItem(MapListForm.Maps[CurrentMapIndex]).MapName);
+    Utility.LoadMapOptions(TMapItem(MapListForm.Maps[CurrentMapIndex]).MapName);
     DisplayLuaOptions(BattleForm.MapOptionsList,BattleForm.MapOptionsScrollBox);
     LoadMapOptionsDefault;
     panelMapOptionsDefault.Visible := MapOptionsList.Count &gt; 0;
@@ -2141,7 +2015,7 @@
 
 
   // load map options
-  LoadLuaOptions(False,TMapItem(MapListForm.Maps[CurrentMapIndex]).MapName);
+  Utility.LoadMapOptions(TMapItem(MapListForm.Maps[CurrentMapIndex]).MapName);
   DisplayLuaOptions(BattleForm.MapOptionsList,BattleForm.MapOptionsScrollBox);
   LoadMapOptionsDefault;
   panelMapOptionsDefault.Visible := MapOptionsList.Count &gt; 0;
@@ -2710,17 +2584,25 @@
     if TLuaOption(ModOptionsList[i]).ClassType &lt;&gt; TLuaOptionSection then
       Script.AddOrChangeKeyValue(TLuaOption(ModOptionsList[i]).KeyPrefix + TLuaOption(ModOptionsList[i]).Key,TLuaOption(ModOptionsList[i]).toString);
 
-  // unknown setscripttags
-  for i:=0 to UnknownScriptTagList.CompleteKeyList.Count -1 do
-    Script.AddOrChangeKeyValue(UnknownScriptTagList.CompleteKeyList[i],UnknownScriptTagList.ValueList[i]);
-
   // map options:
   for i:=0 to MapOptionsList.Count -1 do
     if TLuaOption(MapOptionsList[i]).ClassType &lt;&gt; TLuaOptionSection then
       Script.AddOrChangeKeyValue(TLuaOption(MapOptionsList[i]).KeyPrefix + TLuaOption(MapOptionsList[i]).Key,TLuaOption(MapOptionsList[i]).toString);
 
+  // bot options:
+  for j:=0 to BattleState.Battle.Bots.Count-1 do
+    for i:=0 to TBot(BattleState.Battle.Bots[j]).OptionsList.Count -1 do
+      if TLuaOption(TBot(BattleState.Battle.Bots[j]).OptionsList[i]).ClassType &lt;&gt; TLuaOptionSection then
+        Script.AddOrChangeKeyValue(TLuaOption(TBot(BattleState.Battle.Bots[j]).OptionsList[i]).KeyPrefix + TLuaOption(TBot(BattleState.Battle.Bots[j]).OptionsList[i]).Key,TLuaOption(TBot(BattleState.Battle.Bots[j]).OptionsList[i]).toString);
 
+  // unknown setscripttags
+  for i:=0 to UnknownScriptTagList.CompleteKeyList.Count -1 do
+    Script.AddOrChangeKeyValue(UnknownScriptTagList.CompleteKeyList[i],UnknownScriptTagList.ValueList[i]);
 
+
+
+
+
   //MainForm.AddMainLog(Script.GetBruteScript,Colors.Info);
 
   // write down the script
@@ -5387,6 +5269,11 @@
     if WhatToDraw = NormalClient then
     begin
       MainForm.OpenPrivateChat(TClient(BattleState.Battle.Clients[RealIndex]));
+    end
+    else if WhatToDraw = NormalBot then
+    begin
+      if TBot(BattleState.Battle.Bots[RealIndex]).OptionsForm &lt;&gt; nil then
+        TBot(BattleState.Battle.Bots[RealIndex]).OptionsForm.Show;
     end;
   end;
 end;
@@ -6223,643 +6110,7 @@
   UnitsTrackerChange(nil);
 end;
 
-constructor TLuaOptionList.Create;
-begin
-    NameList := TStringList.Create;
-    DescriptionList := TStringList.Create;
-    KeyList := TStringList.Create;
-end;
 
-procedure TBattleForm.DisplayLuaOptions(luaOptionList: TList; tabSheet: TWinControl);
-var
-  i: Integer;
-  c: TWinControl;
-begin
-  for i:=0 to luaOptionList.Count -1 do
-  begin
-    c := TLuaOption(luaOptionList[i]).GetComponent(tabSheet,luaOptionList);
-    c.Align := alBottom;
-    c.Align := alTop;
-    if (BattleState.Status = Joined) then
-      TLuaOption(luaOptionList[i]).Disable
-    else
-      TLuaOption(luaOptionList[i]).Enable;
-  end;
-  // hide empty sections
-  for i:=0 to luaOptionList.Count-1 do
-    if TLuaOption(luaOptionList[i]).ClassType = TLuaOptionSection then
-      TLuaOptionSection(luaOptionList[i]).Panel.Visible := TLuaOptionSection(luaOptionList[i]).Panel.ControlCount &gt; 0;
-end;
-
-procedure TLuaOption.MakeDescriptionButton(AOwner: TWinControl);
-begin
-  if DescriptionButton = nil then
-  begin
-    DescriptionButton := TSpTBXButton.Create(AOwner);
-    DescriptionButton.Parent := AOwner;
-    DescriptionButton.Caption := '?';
-    DescriptionButton.Width := 17;
-    DescriptionButton.Height := 20;
-    DescriptionButton.Left := 365;
-    DescriptionButton.ParentColor := false;
-    DescriptionButton.OnClick := OnDescriptionButtonClick;
-  end;
-end;
-function TLuaOption.GetSectionPanel(luaOptionList: TList): TSpTBXGroupBox;
-var
-  i : integer;
-begin
-  Result := nil;
-  if Section = '' then
-    Section := '__defaultSection__';
-
-  for i:=0 to luaOptionList.Count-1 do
-  begin
-    if TLuaOption(luaOptionList[i]).ClassType = TLuaOptionSection then
-      if LowerCase(TLuaOptionSection(luaOptionList[i]).Key) = LowerCase(Section) then
-      begin
-        Result := TLuaOptionSection(luaOptionList[i]).Panel;
-        Exit;
-      end;
-    if TLuaOption(luaOptionList[i]).ClassType = TLuaOptionSection then
-      if LowerCase(TLuaOptionSection(luaOptionList[i]).Key) = LowerCase('__defaultSection__') then
-        Result := TLuaOptionSection(luaOptionList[i]).Panel;
-  end;
-end;
-procedure TLuaOption.OnDescriptionButtonClick(Sender: TObject);
-begin
-  MessageDlg(Self.Name + ' : ' + Self.getDescription,mtInformation,[mbOk],0);
-end;
-function TLuaOption.getDescription:string;
-begin
-  result := Self.Description;
-end;
-
-function TLuaOptionList.getDescription:string;
-var
-  msg: String;
-  i: integer;
-begin
-  for i:=0 to DescriptionList.Count-1 do
-    msg := msg + EOL + '     ' + NameList[i] + ' = ' + DescriptionList[i];
-  Result := Self.Description+EOL+msg;
-end;
-
-function TLuaOption.GetComponent(AOwner: TWinControl;luaOptionList: TList): TWinControl;
-var
-  sec: TSpTBXGroupBox;
-begin
-  if LabelName = nil then
-  begin
-    sec := GetSectionPanel(luaOptionList);
-
-    if sec &lt;&gt; nil then
-    begin
-      AOwner := sec;
-    end;
-
-    AOwner.Height := AOwner.Height + 18;
-
-    LabelName := TSpTBXLabel.Create(AOwner);
-    LabelName.Parent := AOwner;
-    LabelName.Caption := Name + ' : Unknown option type';
-    LabelName.Font.Color := Colors.Error;
-    LabelName.AutoSize := True;
-    LabelName.Font.Style := [];
-  end;
-  Result := LabelName;
-end;
-
-function TLuaOptionString.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
-var
-  sec: TSpTBXGroupBox;
-begin
-  if Panel = nil then
-  begin
-    sec := GetSectionPanel(luaOptionList);
-
-    if sec &lt;&gt; nil then
-    begin
-      AOwner := sec;
-    end;
-
-    AOwner.Height := AOwner.Height + 23;
-
-    Panel := TSpTBXPanel.Create(AOwner);
-    Panel.Parent := AOwner;
-    Panel.Borders := False;
-    Panel.AutoSize := True;
-    Panel.Height := 23;
-
-    LabelName := TSpTBXLabel.Create(Panel);
-    LabelName.Parent := Panel;
-    LabelName.Caption := Name + ' :';
-    LabelName.AutoSize := True;
-    LabelName.Left := 8;
-    LabelName.Top := 3;
-    LabelName.Width := 180;
-    LabelName.Hint := Description;
-    LabelName.ShowHint := True;
-    LabelName.ParentFont := False;
-    LabelName.Font.Style := [];
-
-    InputEdit := TSpTBXEdit.Create(Panel);
-    InputEdit.Parent := Panel;
-    InputEdit.Left := 188;
-    InputEdit.Top := 0;
-    InputEdit.MaxLength := MaxStringLength;
-    InputEdit.Hint := Description;
-    InputEdit.ShowHint := True;
-    InputEdit.Width := 170;
-    InputEdit.Text := DefaultValue;
-    InputEdit.OnExit := self.OnChange;
-
-    MakeDescriptionButton(Panel);
-  end;
-  Result := Panel;
-end;
-
-function TLuaOptionNumber.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
-var
-  sec: TSpTBXGroupBox;
-begin
-  if Panel = nil then
-  begin
-    sec := GetSectionPanel(luaOptionList);
-
-    if sec &lt;&gt; nil then
-    begin
-      AOwner := sec;
-    end;
-
-    AOwner.Height := AOwner.Height + 20;
-
-    Panel := TSpTBXPanel.Create(AOwner);
-    Panel.Parent := AOwner;
-    Panel.Borders := False;
-    Panel.AutoSize := True;
-    Panel.Height := 23;
-
-    LabelName := TSpTBXLabel.Create(Panel);
-    LabelName.Parent := Panel;
-    LabelName.Caption := Name + ' :';
-    LabelName.AutoSize := True;
-    LabelName.Left := 8;
-    LabelName.Top := 3;
-    LabelName.Width := 180;
-    LabelName.Hint := Description;
-    LabelName.ShowHint := True;
-    LabelName.ParentFont := False;
-    LabelName.Font.Style := [];
-
-    InputEdit := TJvSpinEdit.Create(Panel);
-    InputEdit.Parent := Panel;
-    InputEdit.ButtonKind := bkStandard;
-    InputEdit.BorderStyle := bsSingle;
-    InputEdit.ValueType := vtFloat;
-    InputEdit.CheckMinValue := True;
-    InputEdit.CheckMaxValue := True;
-    InputEdit.CheckOptions := [coCheckOnExit,coCropBeyondLimit];
-    InputEdit.MaxValue := MaxValue;
-    InputEdit.MinValue := MinValue;
-    if StepValue &lt;= 0 then
-    begin
-      InputEdit.ShowButton := False;
-      InputEdit.Increment := 0.0000000001;
-      InputEdit.Decimal := 10;
-    end
-    else
-    begin
-      InputEdit.Increment := StepValue;
-      InputEdit.Decimal := 4;
-    end;
-    InputEdit.Value := StrToFloat(DefaultValue);
-    InputEdit.Hint := Description;
-    InputEdit.ShowHint := True;
-    InputEdit.Width := 170;
-    InputEdit.OnExit := self.OnChange;
-    InputEdit.Left := 188;
-    InputEdit.Top := 0;
-    InputEdit.Color := SkinManager.CurrentSkin.Options(skncEditFrame,sknsNormal).Body.Color1;
-    InputEdit.Font.Color := SkinManager.CurrentSkin.GetTextColor(skncEditFrame,sknsNormal);
-
-    MakeDescriptionButton(Panel);
-  end;
-  Result := Panel;
-end;
-
-function TLuaOptionBool.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
-var
-  sec: TSpTBXGroupBox;
-begin
-  if Panel = nil then
-  begin
-    sec := GetSectionPanel(luaOptionList);
-
-    if sec &lt;&gt; nil then
-    begin
-      AOwner := sec;
-    end;
-
-    AOwner.Height := AOwner.Height + 20;
-
-    Panel := TSpTBXPanel.Create(AOwner);
-    Panel.Parent := AOwner;
-    Panel.Borders := False;
-    Panel.AutoSize := True;
-    Panel.Height := 23;
-
-    LabelName := TSpTBXLabel.Create(Panel);
-    LabelName.Parent := Panel;
-    LabelName.Caption := Name + ' :';
-    LabelName.Left := 8;
-    LabelName.Top := 3;
-    LabelName.Width := 180;
-    LabelName.Hint := Description;
-    LabelName.ShowHint := True;
-    LabelName.ParentFont := False;
-    LabelName.Font.Style := [];
-  
-    CheckBox := TSpTBXCheckBox.Create(Panel);
-    CheckBox.Parent := Panel;
-    CheckBox.Left := 188;
-    CheckBox.Top := 3;
-    CheckBox.AutoSize := False;
-    CheckBox.Caption := '';
-    CheckBox.Height := 15;
-    CheckBox.Hint := Description;
-    CheckBox.ShowHint := True;
-    CheckBox.Checked := StrToBool(DefaultValue);
-    CheckBox.OnClick := self.OnChange;
-
-    MakeDescriptionButton(Panel);
-  end;
-  Result := Panel;
-end;
-
-function TLuaOptionSection.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
-begin
-  if Panel = nil then
-  begin
-    Panel := TSpTBXGroupBox.Create(AOwner);
-    Panel.Parent := AOwner;
-    Panel.Height := 23;
-    Panel.Caption := Name;
-    Panel.ShowHint := True;
-    Panel.Hint := Description;
-    Panel.Font.Style := [fsBold];
-    Panel.TBXStyleBackground := True;
-    //MakeDescriptionButton(Panel);
-  end;
-  Result := Panel;
-end;
-
-function TLuaOptionList.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
-var
-  i: integer;
-  sec: TSpTBXGroupBox;
-begin
-  if Panel = nil then
-  begin
-    sec := GetSectionPanel(luaOptionList);
-
-    if sec &lt;&gt; nil then
-    begin
-      AOwner := sec;
-    end;
-
-    AOwner.Height := AOwner.Height + 23;
-
-    Panel := TSpTBXPanel.Create(AOwner);
-    Panel.Parent := AOwner;
-    Panel.Borders := False;
-    Panel.AutoSize := True;
-    Panel.Height := 23;
-
-    LabelName := TSpTBXLabel.Create(Panel);
-    LabelName.Parent := Panel;
-    LabelName.Caption := Name + ' :';
-    LabelName.Align := alNone;
-    LabelName.AutoSize := True;
-    LabelName.Left := 8;
-    LabelName.Top := 3;
-    LabelName.Width := 180;
-    LabelName.Hint := Description;
-    LabelName.ShowHint := True;
-    LabelName.ParentFont := False;
-    LabelName.Font.Style := [];
-
-    ComboBox := TSpTBXComboBox.Create(Panel);
-    ComboBox.Parent := Panel;
-    ComboBox.Style := csDropDownList;
-    ComboBox.Top := 0;
-    ComboBox.Width := 170;
-    ComboBox.Height := 21;
-    ComboBox.Items.Assign(NameList);
-    ComboBox.ItemIndex := Max(0,KeyList.IndexOf(DefaultValue));
-    ComboBox.Left := 188;
-    ComboBox.Hint := Description;
-    ComboBox.ShowHint := True;
-    ComboBox.Color := SkinManager.CurrentSkin.Options(skncEditFrame,sknsNormal).Body.Color1;
-    ComboBox.Font.Color := SkinManager.CurrentSkin.GetTextColor(skncEditFrame,sknsNormal);
-    ComboBox.OnChange := self.OnChange;
-
-    MakeDescriptionButton(Panel);
-  end;
-  Result := Panel;
-end;
-
-function TLuaOption.toString:String;
-begin
-  Result := Value;
-end;
-
-function TLuaOptionNumber.toString:String;
-begin
-  Result := InputEdit.Text;
-end;
-
-function TLuaOptionString.toString:String;
-begin
-  Result := InputEdit.Text;
-end;
-
-function TLuaOptionList.toString:String;
-begin
-  Result := KeyList[ComboBox.ItemIndex];
-end;
-function TLuaOptionList.nameToString:String;
-begin
-  Result := NameList[ComboBox.ItemIndex];
-end;
-
-function TLuaOptionBool.toString:String;
-begin
-  Result := IntToStr(BoolToInt(CheckBox.Checked));
-end;
-
-function TLuaOptionSection.toString:String;
-begin
-  Result := '';
-end;
-
-procedure TLuaOption.OnChange(Sender: TObject);
-begin
-  if (BattleState.Status = Hosting) and AllowBattleDetailsUpdate then
-  begin
-    MainForm.TryToSendCommand('SETSCRIPTTAGS', KeyPrefix+Key+'='+Self.toString);
-  end;
-  Value := Self.toString;
-end;
-
-function TLuaOption.toSetScriptTagsString:String;
-begin
-  Result := KeyPrefix+Key+'='+Self.toString;
-end;
-
-procedure TLuaOptionNumber.OnChange(Sender: TObject);
-begin
-  if StepValue &lt;= 0 then
-  begin
-    inherited OnChange(Sender)
-  end
-  else
-  begin
-    InputEdit.Text := FloatToStr(Round(StrToFloat(InputEdit.Text) / StepValue)*StepValue);
-    inherited OnChange(Sender);
-  end;
-end;
-
-function TLuaOptionNumber.toSetScriptTagsString:String;
-begin
-  if StepValue &lt;= 0 then
-  begin
-    inherited toSetScriptTagsString;
-  end
-  else
-  begin
-    InputEdit.Text := FloatToStr(Round(StrToFloat(InputEdit.Text) / StepValue)*StepValue);
-    inherited toSetScriptTagsString;
-  end;
-end;
-
-procedure TLuaOption.SetValue(v: String);
-begin
-  hasChanged := hasChanged or (Value &lt;&gt; v);
-  Value := v;
-  if hasChanged then
-    BattleForm.RefreshQuickLookText;
-end;
-
-procedure TLuaOption.setToDefault;
-begin
-  hasChanged := hasChanged or (Value &lt;&gt; DefaultValue);
-  Value := DefaultValue;
-  if hasChanged then
-    BattleForm.RefreshQuickLookText;
-end;
-
-function TLuaOption.isDefault:Boolean;
-begin
-  Result := DefaultValue = Value;
-end;
-
-procedure TLuaOptionString.SetValue(v: String);
-begin
-  inherited;
-  InputEdit.Text := v;
-end;
-
-procedure TLuaOptionString.setToDefault;
-begin
-  inherited;
-  InputEdit.Text := DefaultValue;
-end;
-
-function TLuaOptionString.isDefault:Boolean;
-begin
-  Result := InputEdit.Text = DefaultValue;
-end;
-
-procedure TLuaOptionList.SetValue(v: String);
-begin
-  inherited;
-  ComboBox.ItemIndex := Max(0,KeyList.IndexOf(v));
-end;
-
-procedure TLuaOptionList.setToDefault;
-begin
-  inherited;
-  ComboBox.ItemIndex := Max(0,KeyList.IndexOf(DefaultValue));
-end;
-
-function TLuaOptionList.isDefault:Boolean;
-begin
-  Result := Max(0,KeyList.IndexOf(DefaultValue)) = ComboBox.ItemIndex;
-end;
-
-procedure TLuaOptionBool.SetValue(v: String);
-begin
-  inherited;
-  CheckBox.Checked := StrToBool(v);
-end;
-
-procedure TLuaOptionSection.setToDefault;
-begin
-end;
-
-function TLuaOptionSection.isDefault:Boolean;
-begin
-  Result := True;
-end;
-
-procedure TLuaOptionSection.SetValue(v: String);
-begin
-end;
-
-procedure TLuaOptionBool.setToDefault;
-begin
-  inherited;
-  CheckBox.Checked := StrToBool(DefaultValue);
-end;
-
-function TLuaOptionBool.isDefault:Boolean;
-begin
-  Result := StrToBool(DefaultValue) = CheckBox.Checked;
-end;
-
-
-procedure TLuaOptionNumber.SetValue(v: String);
-begin
-  inherited;
-  InputEdit.Text := v;
-end;
-
-procedure TLuaOptionNumber.setToDefault;
-begin
-  inherited;
-  InputEdit.Value := StrToFloat(DefaultValue);
-end;
-
-function TLuaOptionNumber.isDefault:Boolean;
-begin
-  Result := RoundTo(InputEdit.Value,-5) = RoundTo(StrToFloat(DefaultValue),-5);
-end;
-
-procedure TLuaOption.Enable;
-begin
-  // nothing
-end;
-procedure TLuaOption.Disable;
-begin
-  // nothing
-end;
-
-procedure TLuaOptionString.Enable;
-begin
-  LabelName.Enabled := True;
-  InputEdit.Enabled := True;
-end;
-procedure TLuaOptionString.Disable;
-begin
-  LabelName.Enabled := False;
-  InputEdit.Enabled := False;
-end;
-
-procedure TLuaOptionList.Enable;
-begin
-  LabelName.Enabled := True;
-  ComboBox.Enabled := True;
-end;
-procedure TLuaOptionList.Disable;
-begin
-  LabelName.Enabled := False;
-  ComboBox.Enabled := False;
-end;
-
-procedure TLuaOptionBool.Enable;
-begin
-  LabelName.Enabled := True;
-  CheckBox.Enabled := True;
-end;
-procedure TLuaOptionBool.Disable;
-begin
-  LabelName.Enabled := False;
-  CheckBox.Enabled := False;
-end;
-
-procedure TLuaOptionSection.Enable;
-begin
-  //Panel.Enabled := True;
-end;
-procedure TLuaOptionSection.Disable;
-begin
-  //Panel.Enabled := False;
-end;
-
-procedure TLuaOptionNumber.Enable;
-begin
-  LabelName.Enabled := True;
-  InputEdit.Enabled := True;
-end;
-procedure TLuaOptionNumber.Disable;
-begin
-  LabelName.Enabled := False;
-  InputEdit.Enabled := False;
-end;
-
-destructor TLuaOption.Destroy;
-begin
-  inherited Destroy;
-end;
-
-destructor TLuaOptionList.Destroy;
-begin
-  NameList.Free;
-  DescriptionList.Free;
-  inherited Destroy;
-  Panel.Destroy;
-end;
-
-destructor TLuaOptionString.Destroy;
-begin
-  inherited Destroy;
-  Panel.Destroy;
-end;
-
-destructor TLuaOptionNumber.Destroy;
-begin
-  inherited Destroy;
-  Panel.Destroy;
-end;
-
-destructor TLuaOptionBool.Destroy;
-begin
-  inherited Destroy;
-  Panel.Destroy;
-end;
-
-destructor TLuaOptionSection.Destroy;
-begin
-  inherited Destroy;
-  Panel.Destroy;
-end;
-
-function TBattleForm.GetLuaOption(optList: TList;key: string): TLuaOption;
-var
-  i: Integer;
-begin
-  Result := nil;
-  for i:=0 to optList.Count-1 do
-  begin
-    if LowerCase(TLuaOption(optList[i]).Key) = LowerCase(key) then
-    begin
-      Result := TLuaOption(optList[i]);
-      Exit;
-    end;
-  end;
-end;
-
 procedure TBattleForm.ChangeScriptTagValue(completeKey: String; value: String);
 begin
   if UnknownScriptTagList.CompleteKeyList.IndexOf(LowerCase(completeKey)) &gt; 0 then
@@ -8213,6 +7464,7 @@
 begin
   GetNodeClient(VDTBattleClients.FocusedNode.Index,RealIndex,WhatToDraw);
 
+  BotOptionsItem.Visible := (WhatToDraw = NormalBot) and (TBot(BattleState.Battle.Bots[RealIndex]).OptionsForm &lt;&gt; nil);
   ForceTeamSpin.Visible := ((WhatToDraw &lt;&gt; OriginalClient) and (BattleState.Status = Hosting) ) or ((WhatToDraw = NormalBot) and ((BattleState.Status = Hosting) or (TBot(BattleState.Battle.Bots[RealIndex]).OwnerName = Status.Username)));
   ForceAllySpin.Visible := ForceTeamSpin.Visible;
   SetTeamColorItem.Visible := ForceTeamSpin.Visible;
@@ -8481,5 +7733,14 @@
   end;
 end;
 
+procedure TBattleForm.BotOptionsItemClick(Sender: TObject);
+var
+  RealIndex: Integer;
+  WhatToDraw: TClientNodeType;
+begin
+  GetNodeClient(VDTBattleClients.FocusedNode.Index,RealIndex,WhatToDraw);
+  TBot(BattleState.Battle.Bots[RealIndex]).OptionsForm.Show;
+end;
+
 end.
 

Modified: Lobby/TASClient/ChannelsListFormUnit.dfm
===================================================================
--- Lobby/TASClient/ChannelsListFormUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/ChannelsListFormUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -14,6 +14,7 @@
   Font.Style = []
   OldCreateOrder = False
   Position = poMainFormCenter
+  Scaled = False
   OnCreate = FormCreate
   PixelsPerInch = 96
   TextHeight = 13
@@ -25,10 +26,10 @@
     Caption = 'Channels list'
     Active = False
     object VDTChannels: TVirtualStringTree
-      Left = 4
-      Top = 26
-      Width = 708
-      Height = 398
+      Left = 0
+      Top = 22
+      Width = 716
+      Height = 406
       Align = alClient
       Header.AutoSizeIndex = 2
       Header.DefaultHeight = 17
@@ -63,7 +64,7 @@
         end
         item
           Position = 2
-          Width = 504
+          Width = 512
           WideText = 'Topic'
         end&gt;
     end

Modified: Lobby/TASClient/ColorsPreferenceUnit.dfm
===================================================================
--- Lobby/TASClient/ColorsPreferenceUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/ColorsPreferenceUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -14,6 +14,7 @@
   Font.Style = []
   OldCreateOrder = False
   Position = poScreenCenter
+  Scaled = False
   OnCreate = FormCreate
   OnShow = FormShow
   PixelsPerInch = 96

Modified: Lobby/TASClient/CustomizeGUIFormUnit.dfm
===================================================================
--- Lobby/TASClient/CustomizeGUIFormUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/CustomizeGUIFormUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -13,6 +13,7 @@
   Menu = TopMenu
   OldCreateOrder = False
   Position = poMainFormCenter
+  Scaled = False
   OnClose = FormClose
   OnCreate = FormCreate
   PixelsPerInch = 96

Modified: Lobby/TASClient/HostInfoUnit.dfm
===================================================================
--- Lobby/TASClient/HostInfoUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/HostInfoUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -1,10 +1,9 @@
 object HostInfoForm: THostInfoForm
-  Left = 741
-  Top = 289
-  BorderStyle = bsDialog
+  Left = 1185
+  Top = 563
+  Width = 592
+  Height = 435
   Caption = 'Help'
-  ClientHeight = 408
-  ClientWidth = 584
   Color = clBtnFace
   Constraints.MaxHeight = 1150
   Constraints.MaxWidth = 1920

Modified: Lobby/TASClient/LobbyScriptUnit.pas
===================================================================
--- Lobby/TASClient/LobbyScriptUnit.pas	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/LobbyScriptUnit.pas	2010-05-02 01:01:06 UTC (rev 7483)
@@ -1692,11 +1692,11 @@
                 PyList_SetItem(m.args,0,PyString_FromString('$battle'))
               else
                 PyList_SetItem(m.args,0,PyString_FromString(PChar(MainForm.lastActiveTab.Caption)));
-              PyList_SetItem(m.args,1,PyString_FromString(PChar(Lines[lix])));
+              PyList_SetItem(m.args,1,PyString_FromString(PChar(UTF8Encode(WideLines[lix]))));
               PyList_SetItem(m.args,2,PyLong_FromLong(co));
             end;
           end;
-          PyList_SetItem(m.args,3,PyString_FromString(PChar(SelText)));
+          PyList_SetItem(m.args,3,PyString_FromString(PChar(UTF8Encode(WideSelText))));
         end;
         break;
       end

Modified: Lobby/TASClient/LogonFormUnit.dfm
===================================================================
--- Lobby/TASClient/LogonFormUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/LogonFormUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -15,6 +15,7 @@
   FormStyle = fsStayOnTop
   OldCreateOrder = False
   Position = poMainFormCenter
+  Scaled = False
   OnCreate = FormCreate
   OnShow = FormShow
   PixelsPerInch = 96

Modified: Lobby/TASClient/MainUnit.dfm
===================================================================
--- Lobby/TASClient/MainUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/MainUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -1,6 +1,6 @@
 object MainForm: TMainForm
-  Left = 940
-  Top = 563
+  Left = 387
+  Top = 490
   Width = 901
   Height = 521
   Caption = '.'
@@ -6044,6 +6044,10 @@
       Caption = 'Help to translate TASClient'
       OnClick = SpTBXItem6Click
     end
+    object SpTBXItem1: TSpTBXItem
+      Caption = 'Spring Bash'
+      OnClick = SpTBXItem1Click
+    end
     object SpTBXItem3: TSpTBXItem
       Caption = 'Beta lobby changelog'
       OnClick = SpTBXItem3Click

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/MainUnit.pas	2010-05-02 01:01:06 UTC (rev 7483)
@@ -27,7 +27,7 @@
   RegExpr,TntGraphics,SpTBXDkPanels, TB2Dock, UWebBrowserWrapper,TypInfo,TntForms,
   Clipbrd,SyncObjs, JvExStdCtrls, JvBehaviorLabel, OleCtrls, SHDocVw,
   JvWinampLabel, JvExControls, JvLinkLabel, ActnList, JvgHint, OpenGL1x,
-  SpTBXSkins,pngimage, SpTBXExtEditors;
+  SpTBXSkins,pngimage, SpTBXExtEditors, BotOptionsFormUnit;
 
 const
   RelayedCommands : array[0..17] of string =
@@ -411,7 +411,7 @@
   );
 
 const
-  VERSION_NUMBER = '0.73'; // Must be float value! (with a period as a decimal seperator)
+  VERSION_NUMBER = '0.74'; // Must be float value! (with a period as a decimal seperator)
   AUTOUPDATE_URL = '<A HREF="http://tasclient.no-ip.org/TASClient_update_v3.txt">http://tasclient.no-ip.org/TASClient_update_v3.txt</A>';
   PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER;
   KEEP_ALIVE_INTERVAL = 10000; // in milliseconds. Tells us what should be the maximum &quot;silence&quot; time before we send a ping to the server.
@@ -843,6 +843,8 @@
     AIShortName: string;
     BattleStatus: Integer;
     TeamColor: Integer; // $00BBGGRR where B = blue, G = green, R = red
+    OptionsList: TList;
+    OptionsForm: TBotOptionsForm;
 
     procedure Assign(Bot: TBot); // copies all properties of Bot to this Bot
     constructor Create(Name: string; OwnerName: string; AIShortName: string);
@@ -852,6 +854,8 @@
     function GetAllyNo: Integer;
     function GetHandicap: Integer;
     function GetSide: Integer;
+    procedure SetBattleStatus(bs: integer);
+    procedure SetTeamColor(c: integer);
 
     function isComSharing: Boolean;
 
@@ -1249,6 +1253,7 @@
     PlayersLabel: TSpTBXLabel;
     SortLabel: TSpTBXButton;
     ConnectButton: TSpTBXLabel;
+    SpTBXItem1: TSpTBXItem;
     procedure mnuOpenPrivateChatClick(Sender: TObject);
     procedure mnuSelectBattleClick(Sender: TObject);
     procedure mnuPlayWithClick(Sender: TObject);
@@ -1429,6 +1434,7 @@
       var DefaultDraw: Boolean);
     procedure ConnectButtonMouseEnter(Sender: TObject);
     procedure ConnectButtonMouseLeave(Sender: TObject);
+    procedure SpTBXItem1Click(Sender: TObject);
   published
     MainTitleBar: TSpTBXTitleBar;
     ButtonImageList: TImageList;
@@ -2957,12 +2963,29 @@
 end;
 
 constructor TBot.Create(Name: string; OwnerName: string; AIShortName: string);
+var
+  i,j:integer;
 begin
   Self.Name := Name;
   Self.OwnerName := OwnerName;
   Self.AIShortName := AIShortName;
   Self.BattleStatus := 0;
   Self.TeamColor := 0;
+  OptionsList := TList.Create;
+  if OwnerName = Status.Me.Name then
+    for i:=0 to Utility.GetSkirmishAICount-1 do
+      for j:=0 to Utility.GetSkirmishAIInfoCount(i)-1 do
+        if (LowerCase(Utility.GetInfoKey(j)) = 'shortname') and (LowerCase(Utility.GetInfoValue(j)) = LowerCase(AIShortName)) then
+        begin
+          Utility.LoadLuaOptions(OptionsList,Utility.GetSkirmishAIOptionCount(i),'GAME/AI'+IntToStr(BattleState.Battle.Bots.Count)+'/OPTIONS/',False);
+          Application.CreateForm(TBotOptionsForm, OptionsForm);
+          Utility.DisplayLuaOptions(OptionsList,OptionsForm.AIOptionsScrollBox);
+          OptionsForm.Caption := OptionsForm.Caption + ' - ' + Name;
+          OptionsForm.SpTBXTitleBar1.Caption := OptionsForm.Caption;
+          OptionsForm.BotSideButton.Images := Utility.SideImageList;
+          OptionsForm.BotSideButton.ImageIndex := 0;
+          OptionsForm.Bot := Self;
+        end;
 end;
 
 function TBot.GetTeamNo: Integer;
@@ -2988,11 +3011,15 @@
 procedure TBot.SetTeamNo(Team: Integer);
 begin
   BattleStatus := (BattleStatus and $FFFFFFC3) or ((Team and $F) shl 2);
+  if OptionsForm = nil then Exit;
+  OptionsForm.BotTeamButton.SpinOptions.ValueAsInteger := Team+1;
 end;
 
 procedure TBot.SetAllyNo(Ally: Integer);
 begin
   BattleStatus := (BattleStatus and $FFFFFC3F) or ((Ally and $F) shl 6);
+  if OptionsForm = nil then Exit;
+  OptionsForm.BotAllyButton.SpinOptions.ValueAsInteger := Ally+1;
 end;
 
 procedure TBot.SetHandicap(Handicap: Integer);
@@ -3003,8 +3030,28 @@
 procedure TBot.SetSide(Side: Integer);
 begin
   BattleStatus := (BattleStatus and $F0FFFFFF) or (Side shl 24);
+  if OptionsForm = nil then Exit;
+  OptionsForm.BotSideButton.ImageIndex := Side;
+  OptionsForm.BotSideButton.Caption := Utility.SideList[Side];
 end;
 
+procedure TBot.SetBattleStatus(bs: integer);
+begin
+  BattleStatus := bs;
+  if OptionsForm = nil then Exit;
+  OptionsForm.BotSideButton.ImageIndex := GetSide;
+  OptionsForm.BotSideButton.Caption := Utility.SideList[GetSide];
+  OptionsForm.BotAllyButton.SpinOptions.ValueAsInteger := GetAllyNo+1;
+  OptionsForm.BotTeamButton.SpinOptions.ValueAsInteger := GetTeamNo+1;
+end;
+
+procedure TBot.SetTeamColor(c: integer);
+begin
+  TeamColor := c;
+  if OptionsForm = nil then Exit;
+  MainForm.UpdateColorImageList;
+end;
+
 function TBot.isComSharing: Boolean;
 var
   i:integer;
@@ -4440,7 +4487,7 @@
     bmp.Free;
   end;
 
-  // next bot form team color
+  // next new bot form team color
     bmp := TBitmap.Create;
     bmp.Width := 16;
     bmp.Height := 16;
@@ -4460,6 +4507,31 @@
     ColorImageList.AddMasked(bmp, TransparentColor);
 
     bmp.Free;
+
+  // next bots forms team color
+  if BattleState.Battle &lt;&gt; nil then
+    for i:=0 to BattleState.Battle.Bots.Count-1 do
+    begin
+      bmp := TBitmap.Create;
+      bmp.Width := 16;
+      bmp.Height := 16;
+
+      with bmp.Canvas do
+      begin
+        if TBot(BattleState.Battle.Bots[i]).TeamColor = clBlack then TransparentColor := clWhite else TransparentColor := clBlack;
+        Brush.Color := TransparentColor;
+        Pen.Color := TransparentColor;
+        Rectangle(0, 0, 16, 16);
+
+        Brush.Color := TBot(BattleState.Battle.Bots[i]).TeamColor;
+        Pen.Color := clGray;
+        RoundRect(1, 1, 14, 14, 4, 4);
+      end;
+
+      ColorImageList.AddMasked(bmp, TransparentColor);
+
+      bmp.Free;
+    end;
 end;
 
 { ChatTextPos is a position in the line where chat text begins. We need this when we are searching for keywords to highlight
@@ -5808,8 +5880,8 @@
       end;
 
       Bot := TBot.Create(sl[2], sl[3], MakeSentenceWS(sl, 6));
-      Bot.BattleStatus := tmpInt2;
-      Bot.TeamColor := teamcolor;
+      Bot.SetBattleStatus(tmpInt2);
+      Bot.SetTeamColor(teamcolor);
 
       Battle.Bots.Add(Bot);
       if Battle.Visible then
@@ -5916,8 +5988,8 @@
         Exit;
       end;
 
-      Bot.BattleStatus := tmpInt;
-      Bot.TeamColor := teamcolor;
+      Bot.SetBattleStatus(tmpInt);
+      Bot.SetTeamColor(teamcolor);
 
       BattleForm.SortBotList(Preferences.BattleClientSortStyle,Preferences.BattleClientSortDirection,True);
       BattleForm.UpdateClientsListBox;
@@ -7338,7 +7410,7 @@
           begin
             if sl3[1] = 'mapoptions' then
             begin
-              luaOpt := BattleForm.GetLuaOption(BattleForm.MapOptionsList,sl3[2]);
+              luaOpt := Utility.GetLuaOption(BattleForm.MapOptionsList,sl3[2]);
               if (BattleForm.SpTBXTabControl1.ActivePage.Item.Name &lt;&gt; 'MapTab') and (BattleState.Status &lt;&gt; Hosting) then
               begin
                 //BattleForm.MapTab.FontSettings.Bold := tsTrue;
@@ -7346,7 +7418,7 @@
             end
             else
             begin
-              luaOpt := BattleForm.GetLuaOption(BattleForm.ModOptionsList,sl3[2]);
+              luaOpt := Utility.GetLuaOption(BattleForm.ModOptionsList,sl3[2]);
               if (BattleForm.SpTBXTabControl1.ActivePage.Item.Name &lt;&gt; 'ModTab') and (BattleState.Status &lt;&gt; Hosting) then
               begin
                 //BattleForm.ModTab.FontSettings.Bold := tsTrue;
@@ -7877,7 +7949,7 @@
       channel := TMyTabSheet(TExRichEdit(Sender).Parent).Caption;
 
      AcquireMainThread;
-     try if not Preferences.ScriptsDisabled then r := handlers.onChatDblClick(channel,charPosOnLine,Lines[lix]); except end;
+     try if not Preferences.ScriptsDisabled then r := handlers.onChatDblClick(channel,charPosOnLine,UTF8Encode(WideLines[lix])); except end;
      ReleaseMainThread;
 
      if r then Exit;
@@ -13899,4 +13971,9 @@
   ConnectButton.ImageIndex := Ord(Status.ConnectionState);
 end;
 
+procedure TMainForm.SpTBXItem1Click(Sender: TObject);
+begin
+  Misc.OpenURLInDefaultBrowser('<A HREF="http://quotes.springlobby.info/">http://quotes.springlobby.info/</A>');
+end;
+
 end.

Modified: Lobby/TASClient/Minimap3DPreviewUnit.dfm
===================================================================
--- Lobby/TASClient/Minimap3DPreviewUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/Minimap3DPreviewUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -1,10 +1,9 @@
 object Minimap3DPreview: TMinimap3DPreview
   Left = 304
   Top = 200
-  BorderStyle = bsDialog
+  Width = 593
+  Height = 536
   Caption = 'Minimap3DPreview'
-  ClientHeight = 509
-  ClientWidth = 585
   Color = clBtnFace
   Font.Charset = DEFAULT_CHARSET
   Font.Color = clWindowText
@@ -26,16 +25,16 @@
     Active = False
     Options.Minimize = False
     object GLSceneViewer: TGLSceneViewer
-      Left = 4
-      Top = 26
-      Width = 577
-      Height = 479
+      Left = 0
+      Top = 22
+      Width = 585
+      Height = 487
       Camera = Camera
       VSync = vsmSync
       Buffer.BackgroundColor = clBackground
       Buffer.FaceCulling = False
       Buffer.AntiAliasing = aa2x
-      FieldOfView = 138.317642211914100000
+      FieldOfView = 138.944839477539100000
       Align = alClient
       OnMouseDown = GLSceneViewerMouseDown
       OnMouseMove = GLSceneViewerMouseMove

Modified: Lobby/TASClient/Minimap3DPreviewUnit.pas
===================================================================
--- Lobby/TASClient/Minimap3DPreviewUnit.pas	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/Minimap3DPreviewUnit.pas	2010-05-02 01:01:06 UTC (rev 7483)
@@ -6,7 +6,7 @@
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, GLCadencer, GLTexture, jpeg, GLHeightData, GLScene,
   GLTerrainRenderer, GLObjects, GLMisc, GLWin32Viewer, GLVectorFileObjects,
-  GLPortal,VectorTypes,VectorGeometry, SpTBXItem;
+  GLPortal,VectorTypes,VectorGeometry, SpTBXItem,SpTBXSkins;
 
 type
   TMinimap3DPreview = class(TForm)
@@ -45,7 +45,7 @@
 
 implementation
 
-uses BattleFormUnit, MapListFormUnit;
+uses BattleFormUnit, MapListFormUnit, PreferencesFormUnit;
 
 {$R *.dfm}
 
@@ -89,17 +89,17 @@
     Exit;
   end;
   if not buttonDown then Exit;
-  if ssLeft in Shift then
+  if (ssLeft in Shift) and (ssCtrl in Shift) then
   begin
-    Camera.MoveAroundTarget((my-y)*0.5, (mx-x)*0.5);
+    Minimap.Scale.Z := Minimap.Scale.Z - (my-y)/10000;
+    Water.Position.Z := 128*Minimap.Scale.Z+256*Minimap.Scale.Z*GetMapItem(BattleForm.CurrentMapIndex).MinHeight/(GetMapItem(BattleForm.CurrentMapIndex).MaxHeight-GetMapItem(BattleForm.CurrentMapIndex).MinHeight);
     mx:=x;
     my:=y;
     Exit;
   end;
-  if (ssRight in Shift) and (ssCtrl in Shift) then
+  if ssLeft in Shift then
   begin
-    Minimap.Scale.Z := Minimap.Scale.Z - (my-y)/10000;
-    Water.Position.Z := 128*Minimap.Scale.Z+256*Minimap.Scale.Z*GetMapItem(BattleForm.CurrentMapIndex).MinHeight/(GetMapItem(BattleForm.CurrentMapIndex).MaxHeight-GetMapItem(BattleForm.CurrentMapIndex).MinHeight);
+    Camera.MoveAroundTarget((my-y)*0.5, (mx-x)*0.5);
     mx:=x;
     my:=y;
     Exit;
@@ -120,6 +120,12 @@
 var
   sector: TSectorMeshObject;
 begin
+  if Preferences.ThemeType = sknSkin then
+  begin
+    SpTBXTitleBar1.Active := True;
+    BorderStyle := bsNone;
+  end;
+
   buttonDown := False;
   GLScene.Objects.Remove(Minimap,False);
 end;

Modified: Lobby/TASClient/PreferencesFormUnit.dfm
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/PreferencesFormUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -77,11 +77,13 @@
       TabOrder = 2
     end
     object SpTBXLabel2: TSpTBXLabel
-      Left = 360
+      Left = 216
       Top = 34
-      Width = 54
+      Width = 198
       Height = 13
       Caption = 'Language :'
+      AutoSize = False
+      Alignment = taRightJustify
     end
     object SpTBXTabControl1: TSpTBXTabControl
       Left = 8

Added: Lobby/TASClient/Python/modules/encodings/__init__.py
===================================================================
--- Lobby/TASClient/Python/modules/encodings/__init__.py	                        (rev 0)
+++ Lobby/TASClient/Python/modules/encodings/__init__.py	2010-05-02 01:01:06 UTC (rev 7483)
@@ -0,0 +1,154 @@
+&quot;&quot;&quot; Standard &quot;encodings&quot; Package
+
+    Standard Python encoding modules are stored in this package
+    directory.
+
+    Codec modules must have names corresponding to normalized encoding
+    names as defined in the normalize_encoding() function below, e.g.
+    'utf-8' must be implemented by the module 'utf_8.py'.
+
+    Each codec module must export the following interface:
+
+    * getregentry() -&gt; codecs.CodecInfo object
+    The getregentry() API must a CodecInfo object with encoder, decoder,
+    incrementalencoder, incrementaldecoder, streamwriter and streamreader
+    atttributes which adhere to the Python Codec Interface Standard.
+
+    In addition, a module may optionally also define the following
+    APIs which are then used by the package's codec search function:
+
+    * getaliases() -&gt; sequence of encoding name strings to use as aliases
+
+    Alias names returned by getaliases() must be normalized encoding
+    names as defined by normalize_encoding().
+
+Written by Marc-Andre Lemburg (<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">mal at lemburg.com</A>).
+
+(c) Copyright CNRI, All Rights Reserved. NO WARRANTY.
+
+&quot;&quot;&quot;#&quot;
+
+import codecs, types
+from encodings import aliases
+
+_cache = {}
+_unknown = '--unknown--'
+_import_tail = ['*']
+_norm_encoding_map = ('                                              . '
+                      '0123456789       ABCDEFGHIJKLMNOPQRSTUVWXYZ     '
+                      ' abcdefghijklmnopqrstuvwxyz                     '
+                      '                                                '
+                      '                                                '
+                      '                ')
+_aliases = aliases.aliases
+
+class CodecRegistryError(LookupError, SystemError):
+    pass
+
+def normalize_encoding(encoding):
+
+    &quot;&quot;&quot; Normalize an encoding name.
+
+        Normalization works as follows: all non-alphanumeric
+        characters except the dot used for Python package names are
+        collapsed and replaced with a single underscore, e.g. '  -;#'
+        becomes '_'. Leading and trailing underscores are removed.
+
+        Note that encoding names should be ASCII only; if they do use
+        non-ASCII characters, these must be Latin-1 compatible.
+
+    &quot;&quot;&quot;
+    # Make sure we have an 8-bit string, because .translate() works
+    # differently for Unicode strings.
+    if hasattr(types, &quot;UnicodeType&quot;) and type(encoding) is types.UnicodeType:
+        # Note that .encode('latin-1') does *not* use the codec
+        # registry, so this call doesn't recurse. (See unicodeobject.c
+        # PyUnicode_AsEncodedString() for details)
+        encoding = encoding.encode('latin-1')
+    return '_'.join(encoding.translate(_norm_encoding_map).split())
+
+def search_function(encoding):
+
+    # Cache lookup
+    entry = _cache.get(encoding, _unknown)
+    if entry is not _unknown:
+        return entry
+
+    # Import the module:
+    #
+    # First try to find an alias for the normalized encoding
+    # name and lookup the module using the aliased name, then try to
+    # lookup the module using the standard import scheme, i.e. first
+    # try in the encodings package, then at top-level.
+    #
+    norm_encoding = normalize_encoding(encoding)
+    aliased_encoding = _aliases.get(norm_encoding) or \
+                       _aliases.get(norm_encoding.replace('.', '_'))
+    if aliased_encoding is not None:
+        modnames = [aliased_encoding,
+                    norm_encoding]
+    else:
+        modnames = [norm_encoding]
+    for modname in modnames:
+        if not modname or '.' in modname:
+            continue
+        try:
+            mod = __import__('encodings.' + modname,
+                             globals(), locals(), _import_tail)
+        except ImportError:
+            pass
+        else:
+            break
+    else:
+        mod = None
+
+    try:
+        getregentry = mod.getregentry
+    except AttributeError:
+        # Not a codec module
+        mod = None
+
+    if mod is None:
+        # Cache misses
+        _cache[encoding] = None
+        return None
+
+    # Now ask the module for the registry entry
+    entry = getregentry()
+    if not isinstance(entry, codecs.CodecInfo):
+        if not 4 &lt;= len(entry) &lt;= 7:
+            raise CodecRegistryError,\
+                 'module &quot;%s&quot; (%s) failed to register' % \
+                  (mod.__name__, mod.__file__)
+        if not callable(entry[0]) or \
+           not callable(entry[1]) or \
+           (entry[2] is not None and not callable(entry[2])) or \
+           (entry[3] is not None and not callable(entry[3])) or \
+           (len(entry) &gt; 4 and entry[4] is not None and not callable(entry[4])) or \
+           (len(entry) &gt; 5 and entry[5] is not None and not callable(entry[5])):
+            raise CodecRegistryError,\
+                'incompatible codecs in module &quot;%s&quot; (%s)' % \
+                (mod.__name__, mod.__file__)
+        if len(entry)&lt;7 or entry[6] is None:
+            entry += (None,)*(6-len(entry)) + (mod.__name__.split(&quot;.&quot;, 1)[1],)
+        entry = codecs.CodecInfo(*entry)
+
+    # Cache the codec registry entry
+    _cache[encoding] = entry
+
+    # Register its aliases (without overwriting previously registered
+    # aliases)
+    try:
+        codecaliases = mod.getaliases()
+    except AttributeError:
+        pass
+    else:
+        for alias in codecaliases:
+            if not _aliases.has_key(alias):
+                _aliases[alias] = modname
+
+    # Return the registry entry
+    return entry
+
+# Register the search_function in the Python codec registry
+codecs.register(search_function)

Added: Lobby/TASClient/Python/modules/encodings/aliases.py
===================================================================
--- Lobby/TASClient/Python/modules/encodings/aliases.py	                        (rev 0)
+++ Lobby/TASClient/Python/modules/encodings/aliases.py	2010-05-02 01:01:06 UTC (rev 7483)
@@ -0,0 +1,508 @@
+&quot;&quot;&quot; Encoding Aliases Support
+
+    This module is used by the encodings package search function to
+    map encodings names to module names.
+
+    Note that the search function normalizes the encoding names before
+    doing the lookup, so the mapping will have to map normalized
+    encoding names to module names.
+
+    Contents:
+
+        The following aliases dictionary contains mappings of all IANA
+        character set names for which the Python core library provides
+        codecs. In addition to these, a few Python specific codec
+        aliases have also been added.
+
+&quot;&quot;&quot;
+aliases = {
+
+    # Please keep this list sorted alphabetically by value !
+
+    # ascii codec
+    '646'                : 'ascii',
+    'ansi_x3.4_1968'     : 'ascii',
+    'ansi_x3_4_1968'     : 'ascii', # some email headers use this non-standard name
+    'ansi_x3.4_1986'     : 'ascii',
+    'cp367'              : 'ascii',
+    'csascii'            : 'ascii',
+    'ibm367'             : 'ascii',
+    'iso646_us'          : 'ascii',
+    'iso_646.irv_1991'   : 'ascii',
+    'iso_ir_6'           : 'ascii',
+    'us'                 : 'ascii',
+    'us_ascii'           : 'ascii',
+
+    # base64_codec codec
+    'base64'             : 'base64_codec',
+    'base_64'            : 'base64_codec',
+
+    # big5 codec
+    'big5_tw'            : 'big5',
+    'csbig5'             : 'big5',
+
+    # big5hkscs codec
+    'big5_hkscs'         : 'big5hkscs',
+    'hkscs'              : 'big5hkscs',
+
+    # bz2_codec codec
+    'bz2'                : 'bz2_codec',
+
+    # cp037 codec
+    '037'                : 'cp037',
+    'csibm037'           : 'cp037',
+    'ebcdic_cp_ca'       : 'cp037',
+    'ebcdic_cp_nl'       : 'cp037',
+    'ebcdic_cp_us'       : 'cp037',
+    'ebcdic_cp_wt'       : 'cp037',
+    'ibm037'             : 'cp037',
+    'ibm039'             : 'cp037',
+
+    # cp1026 codec
+    '1026'               : 'cp1026',
+    'csibm1026'          : 'cp1026',
+    'ibm1026'            : 'cp1026',
+
+    # cp1140 codec
+    '1140'               : 'cp1140',
+    'ibm1140'            : 'cp1140',
+
+    # cp1250 codec
+    '1250'               : 'cp1250',
+    'windows_1250'       : 'cp1250',
+
+    # cp1251 codec
+    '1251'               : 'cp1251',
+    'windows_1251'       : 'cp1251',
+
+    # cp1252 codec
+    '1252'               : 'cp1252',
+    'windows_1252'       : 'cp1252',
+
+    # cp1253 codec
+    '1253'               : 'cp1253',
+    'windows_1253'       : 'cp1253',
+
+    # cp1254 codec
+    '1254'               : 'cp1254',
+    'windows_1254'       : 'cp1254',
+
+    # cp1255 codec
+    '1255'               : 'cp1255',
+    'windows_1255'       : 'cp1255',
+
+    # cp1256 codec
+    '1256'               : 'cp1256',
+    'windows_1256'       : 'cp1256',
+
+    # cp1257 codec
+    '1257'               : 'cp1257',
+    'windows_1257'       : 'cp1257',
+
+    # cp1258 codec
+    '1258'               : 'cp1258',
+    'windows_1258'       : 'cp1258',
+
+    # cp424 codec
+    '424'                : 'cp424',
+    'csibm424'           : 'cp424',
+    'ebcdic_cp_he'       : 'cp424',
+    'ibm424'             : 'cp424',
+
+    # cp437 codec
+    '437'                : 'cp437',
+    'cspc8codepage437'   : 'cp437',
+    'ibm437'             : 'cp437',
+
+    # cp500 codec
+    '500'                : 'cp500',
+    'csibm500'           : 'cp500',
+    'ebcdic_cp_be'       : 'cp500',
+    'ebcdic_cp_ch'       : 'cp500',
+    'ibm500'             : 'cp500',
+
+    # cp775 codec
+    '775'                : 'cp775',
+    'cspc775baltic'      : 'cp775',
+    'ibm775'             : 'cp775',
+
+    # cp850 codec
+    '850'                : 'cp850',
+    'cspc850multilingual' : 'cp850',
+    'ibm850'             : 'cp850',
+
+    # cp852 codec
+    '852'                : 'cp852',
+    'cspcp852'           : 'cp852',
+    'ibm852'             : 'cp852',
+
+    # cp855 codec
+    '855'                : 'cp855',
+    'csibm855'           : 'cp855',
+    'ibm855'             : 'cp855',
+
+    # cp857 codec
+    '857'                : 'cp857',
+    'csibm857'           : 'cp857',
+    'ibm857'             : 'cp857',
+
+    # cp860 codec
+    '860'                : 'cp860',
+    'csibm860'           : 'cp860',
+    'ibm860'             : 'cp860',
+
+    # cp861 codec
+    '861'                : 'cp861',
+    'cp_is'              : 'cp861',
+    'csibm861'           : 'cp861',
+    'ibm861'             : 'cp861',
+
+    # cp862 codec
+    '862'                : 'cp862',
+    'cspc862latinhebrew' : 'cp862',
+    'ibm862'             : 'cp862',
+
+    # cp863 codec
+    '863'                : 'cp863',
+    'csibm863'           : 'cp863',
+    'ibm863'             : 'cp863',
+
+    # cp864 codec
+    '864'                : 'cp864',
+    'csibm864'           : 'cp864',
+    'ibm864'             : 'cp864',
+
+    # cp865 codec
+    '865'                : 'cp865',
+    'csibm865'           : 'cp865',
+    'ibm865'             : 'cp865',
+
+    # cp866 codec
+    '866'                : 'cp866',
+    'csibm866'           : 'cp866',
+    'ibm866'             : 'cp866',
+
+    # cp869 codec
+    '869'                : 'cp869',
+    'cp_gr'              : 'cp869',
+    'csibm869'           : 'cp869',
+    'ibm869'             : 'cp869',
+
+    # cp932 codec
+    '932'                : 'cp932',
+    'ms932'              : 'cp932',
+    'mskanji'            : 'cp932',
+    'ms_kanji'           : 'cp932',
+
+    # cp949 codec
+    '949'                : 'cp949',
+    'ms949'              : 'cp949',
+    'uhc'                : 'cp949',
+
+    # cp950 codec
+    '950'                : 'cp950',
+    'ms950'              : 'cp950',
+
+    # euc_jis_2004 codec
+    'jisx0213'           : 'euc_jis_2004',
+    'eucjis2004'         : 'euc_jis_2004',
+    'euc_jis2004'        : 'euc_jis_2004',
+
+    # euc_jisx0213 codec
+    'eucjisx0213'        : 'euc_jisx0213',
+
+    # euc_jp codec
+    'eucjp'              : 'euc_jp',
+    'ujis'               : 'euc_jp',
+    'u_jis'              : 'euc_jp',
+
+    # euc_kr codec
+    'euckr'              : 'euc_kr',
+    'korean'             : 'euc_kr',
+    'ksc5601'            : 'euc_kr',
+    'ks_c_5601'          : 'euc_kr',
+    'ks_c_5601_1987'     : 'euc_kr',
+    'ksx1001'            : 'euc_kr',
+    'ks_x_1001'          : 'euc_kr',
+
+    # gb18030 codec
+    'gb18030_2000'       : 'gb18030',
+
+    # gb2312 codec
+    'chinese'            : 'gb2312',
+    'csiso58gb231280'    : 'gb2312',
+    'euc_cn'             : 'gb2312',
+    'euccn'              : 'gb2312',
+    'eucgb2312_cn'       : 'gb2312',
+    'gb2312_1980'        : 'gb2312',
+    'gb2312_80'          : 'gb2312',
+    'iso_ir_58'          : 'gb2312',
+
+    # gbk codec
+    '936'                : 'gbk',
+    'cp936'              : 'gbk',
+    'ms936'              : 'gbk',
+
+    # hex_codec codec
+    'hex'                : 'hex_codec',
+
+    # hp_roman8 codec
+    'roman8'             : 'hp_roman8',
+    'r8'                 : 'hp_roman8',
+    'csHPRoman8'         : 'hp_roman8',
+
+    # hz codec
+    'hzgb'               : 'hz',
+    'hz_gb'              : 'hz',
+    'hz_gb_2312'         : 'hz',
+
+    # iso2022_jp codec
+    'csiso2022jp'        : 'iso2022_jp',
+    'iso2022jp'          : 'iso2022_jp',
+    'iso_2022_jp'        : 'iso2022_jp',
+
+    # iso2022_jp_1 codec
+    'iso2022jp_1'        : 'iso2022_jp_1',
+    'iso_2022_jp_1'      : 'iso2022_jp_1',
+
+    # iso2022_jp_2 codec
+    'iso2022jp_2'        : 'iso2022_jp_2',
+    'iso_2022_jp_2'      : 'iso2022_jp_2',
+
+    # iso2022_jp_2004 codec
+    'iso_2022_jp_2004'   : 'iso2022_jp_2004',
+    'iso2022jp_2004'     : 'iso2022_jp_2004',
+
+    # iso2022_jp_3 codec
+    'iso2022jp_3'        : 'iso2022_jp_3',
+    'iso_2022_jp_3'      : 'iso2022_jp_3',
+
+    # iso2022_jp_ext codec
+    'iso2022jp_ext'      : 'iso2022_jp_ext',
+    'iso_2022_jp_ext'    : 'iso2022_jp_ext',
+
+    # iso2022_kr codec
+    'csiso2022kr'        : 'iso2022_kr',
+    'iso2022kr'          : 'iso2022_kr',
+    'iso_2022_kr'        : 'iso2022_kr',
+
+    # iso8859_10 codec
+    'csisolatin6'        : 'iso8859_10',
+    'iso_8859_10'        : 'iso8859_10',
+    'iso_8859_10_1992'   : 'iso8859_10',
+    'iso_ir_157'         : 'iso8859_10',
+    'l6'                 : 'iso8859_10',
+    'latin6'             : 'iso8859_10',
+
+    # iso8859_11 codec
+    'thai'               : 'iso8859_11',
+    'iso_8859_11'        : 'iso8859_11',
+    'iso_8859_11_2001'   : 'iso8859_11',
+
+    # iso8859_13 codec
+    'iso_8859_13'        : 'iso8859_13',
+
+    # iso8859_14 codec
+    'iso_8859_14'        : 'iso8859_14',
+    'iso_8859_14_1998'   : 'iso8859_14',
+    'iso_celtic'         : 'iso8859_14',
+    'iso_ir_199'         : 'iso8859_14',
+    'l8'                 : 'iso8859_14',
+    'latin8'             : 'iso8859_14',
+
+    # iso8859_15 codec
+    'iso_8859_15'        : 'iso8859_15',
+
+    # iso8859_16 codec
+    'iso_8859_16'        : 'iso8859_16',
+    'iso_8859_16_2001'   : 'iso8859_16',
+    'iso_ir_226'         : 'iso8859_16',
+    'l10'                : 'iso8859_16',
+    'latin10'            : 'iso8859_16',
+
+    # iso8859_2 codec
+    'csisolatin2'        : 'iso8859_2',
+    'iso_8859_2'         : 'iso8859_2',
+    'iso_8859_2_1987'    : 'iso8859_2',
+    'iso_ir_101'         : 'iso8859_2',
+    'l2'                 : 'iso8859_2',
+    'latin2'             : 'iso8859_2',
+
+    # iso8859_3 codec
+    'csisolatin3'        : 'iso8859_3',
+    'iso_8859_3'         : 'iso8859_3',
+    'iso_8859_3_1988'    : 'iso8859_3',
+    'iso_ir_109'         : 'iso8859_3',
+    'l3'                 : 'iso8859_3',
+    'latin3'             : 'iso8859_3',
+
+    # iso8859_4 codec
+    'csisolatin4'        : 'iso8859_4',
+    'iso_8859_4'         : 'iso8859_4',
+    'iso_8859_4_1988'    : 'iso8859_4',
+    'iso_ir_110'         : 'iso8859_4',
+    'l4'                 : 'iso8859_4',
+    'latin4'             : 'iso8859_4',
+
+    # iso8859_5 codec
+    'csisolatincyrillic' : 'iso8859_5',
+    'cyrillic'           : 'iso8859_5',
+    'iso_8859_5'         : 'iso8859_5',
+    'iso_8859_5_1988'    : 'iso8859_5',
+    'iso_ir_144'         : 'iso8859_5',
+
+    # iso8859_6 codec
+    'arabic'             : 'iso8859_6',
+    'asmo_708'           : 'iso8859_6',
+    'csisolatinarabic'   : 'iso8859_6',
+    'ecma_114'           : 'iso8859_6',
+    'iso_8859_6'         : 'iso8859_6',
+    'iso_8859_6_1987'    : 'iso8859_6',
+    'iso_ir_127'         : 'iso8859_6',
+
+    # iso8859_7 codec
+    'csisolatingreek'    : 'iso8859_7',
+    'ecma_118'           : 'iso8859_7',
+    'elot_928'           : 'iso8859_7',
+    'greek'              : 'iso8859_7',
+    'greek8'             : 'iso8859_7',
+    'iso_8859_7'         : 'iso8859_7',
+    'iso_8859_7_1987'    : 'iso8859_7',
+    'iso_ir_126'         : 'iso8859_7',
+
+    # iso8859_8 codec
+    'csisolatinhebrew'   : 'iso8859_8',
+    'hebrew'             : 'iso8859_8',
+    'iso_8859_8'         : 'iso8859_8',
+    'iso_8859_8_1988'    : 'iso8859_8',
+    'iso_ir_138'         : 'iso8859_8',
+
+    # iso8859_9 codec
+    'csisolatin5'        : 'iso8859_9',
+    'iso_8859_9'         : 'iso8859_9',
+    'iso_8859_9_1989'    : 'iso8859_9',
+    'iso_ir_148'         : 'iso8859_9',
+    'l5'                 : 'iso8859_9',
+    'latin5'             : 'iso8859_9',
+
+    # johab codec
+    'cp1361'             : 'johab',
+    'ms1361'             : 'johab',
+
+    # koi8_r codec
+    'cskoi8r'            : 'koi8_r',
+
+    # latin_1 codec
+    #
+    # Note that the latin_1 codec is implemented internally in C and a
+    # lot faster than the charmap codec iso8859_1 which uses the same
+    # encoding. This is why we discourage the use of the iso8859_1
+    # codec and alias it to latin_1 instead.
+    #
+    '8859'               : 'latin_1',
+    'cp819'              : 'latin_1',
+    'csisolatin1'        : 'latin_1',
+    'ibm819'             : 'latin_1',
+    'iso8859'            : 'latin_1',
+    'iso8859_1'          : 'latin_1',
+    'iso_8859_1'         : 'latin_1',
+    'iso_8859_1_1987'    : 'latin_1',
+    'iso_ir_100'         : 'latin_1',
+    'l1'                 : 'latin_1',
+    'latin'              : 'latin_1',
+    'latin1'             : 'latin_1',
+
+    # mac_cyrillic codec
+    'maccyrillic'        : 'mac_cyrillic',
+
+    # mac_greek codec
+    'macgreek'           : 'mac_greek',
+
+    # mac_iceland codec
+    'maciceland'         : 'mac_iceland',
+
+    # mac_latin2 codec
+    'maccentraleurope'   : 'mac_latin2',
+    'maclatin2'          : 'mac_latin2',
+
+    # mac_roman codec
+    'macroman'           : 'mac_roman',
+
+    # mac_turkish codec
+    'macturkish'         : 'mac_turkish',
+
+    # mbcs codec
+    'dbcs'               : 'mbcs',
+
+    # ptcp154 codec
+    'csptcp154'          : 'ptcp154',
+    'pt154'              : 'ptcp154',
+    'cp154'              : 'ptcp154',
+    'cyrillic-asian'     : 'ptcp154',
+
+    # quopri_codec codec
+    'quopri'             : 'quopri_codec',
+    'quoted_printable'   : 'quopri_codec',
+    'quotedprintable'    : 'quopri_codec',
+
+    # rot_13 codec
+    'rot13'              : 'rot_13',
+
+    # shift_jis codec
+    'csshiftjis'         : 'shift_jis',
+    'shiftjis'           : 'shift_jis',
+    'sjis'               : 'shift_jis',
+    's_jis'              : 'shift_jis',
+
+    # shift_jis_2004 codec
+    'shiftjis2004'       : 'shift_jis_2004',
+    'sjis_2004'          : 'shift_jis_2004',
+    's_jis_2004'         : 'shift_jis_2004',
+
+    # shift_jisx0213 codec
+    'shiftjisx0213'      : 'shift_jisx0213',
+    'sjisx0213'          : 'shift_jisx0213',
+    's_jisx0213'         : 'shift_jisx0213',
+
+    # tactis codec
+    'tis260'             : 'tactis',
+
+    # tis_620 codec
+    'tis620'             : 'tis_620',
+    'tis_620_0'          : 'tis_620',
+    'tis_620_2529_0'     : 'tis_620',
+    'tis_620_2529_1'     : 'tis_620',
+    'iso_ir_166'         : 'tis_620',
+
+    # utf_16 codec
+    'u16'                : 'utf_16',
+    'utf16'              : 'utf_16',
+
+    # utf_16_be codec
+    'unicodebigunmarked' : 'utf_16_be',
+    'utf_16be'           : 'utf_16_be',
+
+    # utf_16_le codec
+    'unicodelittleunmarked' : 'utf_16_le',
+    'utf_16le'           : 'utf_16_le',
+
+    # utf_7 codec
+    'u7'                 : 'utf_7',
+    'utf7'               : 'utf_7',
+    'unicode_1_1_utf_7'  : 'utf_7',
+
+    # utf_8 codec
+    'u8'                 : 'utf_8',
+    'utf'                : 'utf_8',
+    'utf8'               : 'utf_8',
+    'utf8_ucs2'          : 'utf_8',
+    'utf8_ucs4'          : 'utf_8',
+
+    # uu_codec codec
+    'uu'                 : 'uu_codec',
+
+    # zlib_codec codec
+    'zip'                : 'zlib_codec',
+    'zlib'               : 'zlib_codec',
+
+}

Added: Lobby/TASClient/Python/modules/encodings/ascii.py
===================================================================
--- Lobby/TASClient/Python/modules/encodings/ascii.py	                        (rev 0)
+++ Lobby/TASClient/Python/modules/encodings/ascii.py	2010-05-02 01:01:06 UTC (rev 7483)
@@ -0,0 +1,50 @@
+&quot;&quot;&quot; Python 'ascii' Codec
+
+
+Written by Marc-Andre Lemburg (<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">mal at lemburg.com</A>).
+
+(c) Copyright CNRI, All Rights Reserved. NO WARRANTY.
+
+&quot;&quot;&quot;
+import codecs
+
+### Codec APIs
+
+class Codec(codecs.Codec):
+
+    # Note: Binding these as C functions will result in the class not
+    # converting them to methods. This is intended.
+    encode = codecs.ascii_encode
+    decode = codecs.ascii_decode
+
+class IncrementalEncoder(codecs.IncrementalEncoder):
+    def encode(self, input, final=False):
+        return codecs.ascii_encode(input, self.errors)[0]
+
+class IncrementalDecoder(codecs.IncrementalDecoder):
+    def decode(self, input, final=False):
+        return codecs.ascii_decode(input, self.errors)[0]
+
+class StreamWriter(Codec,codecs.StreamWriter):
+    pass
+
+class StreamReader(Codec,codecs.StreamReader):
+    pass
+
+class StreamConverter(StreamWriter,StreamReader):
+
+    encode = codecs.ascii_decode
+    decode = codecs.ascii_encode
+
+### encodings module API
+
+def getregentry():
+    return codecs.CodecInfo(
+        name='ascii',
+        encode=Codec.encode,
+        decode=Codec.decode,
+        incrementalencoder=IncrementalEncoder,
+        incrementaldecoder=IncrementalDecoder,
+        streamwriter=StreamWriter,
+        streamreader=StreamReader,
+    )

Added: Lobby/TASClient/Python/modules/encodings/cp1252.py
===================================================================
--- Lobby/TASClient/Python/modules/encodings/cp1252.py	                        (rev 0)
+++ Lobby/TASClient/Python/modules/encodings/cp1252.py	2010-05-02 01:01:06 UTC (rev 7483)
@@ -0,0 +1,307 @@
+&quot;&quot;&quot; Python Character Mapping Codec cp1252 generated from 'MAPPINGS/VENDORS/MICSFT/WINDOWS/CP1252.TXT' with gencodec.py.
+
+&quot;&quot;&quot;#&quot;
+
+import codecs
+
+### Codec APIs
+
+class Codec(codecs.Codec):
+
+    def encode(self,input,errors='strict'):
+        return codecs.charmap_encode(input,errors,encoding_table)
+
+    def decode(self,input,errors='strict'):
+        return codecs.charmap_decode(input,errors,decoding_table)
+
+class IncrementalEncoder(codecs.IncrementalEncoder):
+    def encode(self, input, final=False):
+        return codecs.charmap_encode(input,self.errors,encoding_table)[0]
+
+class IncrementalDecoder(codecs.IncrementalDecoder):
+    def decode(self, input, final=False):
+        return codecs.charmap_decode(input,self.errors,decoding_table)[0]
+
+class StreamWriter(Codec,codecs.StreamWriter):
+    pass
+
+class StreamReader(Codec,codecs.StreamReader):
+    pass
+
+### encodings module API
+
+def getregentry():
+    return codecs.CodecInfo(
+        name='cp1252',
+        encode=Codec().encode,
+        decode=Codec().decode,
+        incrementalencoder=IncrementalEncoder,
+        incrementaldecoder=IncrementalDecoder,
+        streamreader=StreamReader,
+        streamwriter=StreamWriter,
+    )
+
+
+### Decoding Table
+
+decoding_table = (
+    u'\x00'     #  0x00 -&gt; NULL
+    u'\x01'     #  0x01 -&gt; START OF HEADING
+    u'\x02'     #  0x02 -&gt; START OF TEXT
+    u'\x03'     #  0x03 -&gt; END OF TEXT
+    u'\x04'     #  0x04 -&gt; END OF TRANSMISSION
+    u'\x05'     #  0x05 -&gt; ENQUIRY
+    u'\x06'     #  0x06 -&gt; ACKNOWLEDGE
+    u'\x07'     #  0x07 -&gt; BELL
+    u'\x08'     #  0x08 -&gt; BACKSPACE
+    u'\t'       #  0x09 -&gt; HORIZONTAL TABULATION
+    u'\n'       #  0x0A -&gt; LINE FEED
+    u'\x0b'     #  0x0B -&gt; VERTICAL TABULATION
+    u'\x0c'     #  0x0C -&gt; FORM FEED
+    u'\r'       #  0x0D -&gt; CARRIAGE RETURN
+    u'\x0e'     #  0x0E -&gt; SHIFT OUT
+    u'\x0f'     #  0x0F -&gt; SHIFT IN
+    u'\x10'     #  0x10 -&gt; DATA LINK ESCAPE
+    u'\x11'     #  0x11 -&gt; DEVICE CONTROL ONE
+    u'\x12'     #  0x12 -&gt; DEVICE CONTROL TWO
+    u'\x13'     #  0x13 -&gt; DEVICE CONTROL THREE
+    u'\x14'     #  0x14 -&gt; DEVICE CONTROL FOUR
+    u'\x15'     #  0x15 -&gt; NEGATIVE ACKNOWLEDGE
+    u'\x16'     #  0x16 -&gt; SYNCHRONOUS IDLE
+    u'\x17'     #  0x17 -&gt; END OF TRANSMISSION BLOCK
+    u'\x18'     #  0x18 -&gt; CANCEL
+    u'\x19'     #  0x19 -&gt; END OF MEDIUM
+    u'\x1a'     #  0x1A -&gt; SUBSTITUTE
+    u'\x1b'     #  0x1B -&gt; ESCAPE
+    u'\x1c'     #  0x1C -&gt; FILE SEPARATOR
+    u'\x1d'     #  0x1D -&gt; GROUP SEPARATOR
+    u'\x1e'     #  0x1E -&gt; RECORD SEPARATOR
+    u'\x1f'     #  0x1F -&gt; UNIT SEPARATOR
+    u' '        #  0x20 -&gt; SPACE
+    u'!'        #  0x21 -&gt; EXCLAMATION MARK
+    u'&quot;'        #  0x22 -&gt; QUOTATION MARK
+    u'#'        #  0x23 -&gt; NUMBER SIGN
+    u'$'        #  0x24 -&gt; DOLLAR SIGN
+    u'%'        #  0x25 -&gt; PERCENT SIGN
+    u'&amp;'        #  0x26 -&gt; AMPERSAND
+    u&quot;'&quot;        #  0x27 -&gt; APOSTROPHE
+    u'('        #  0x28 -&gt; LEFT PARENTHESIS
+    u')'        #  0x29 -&gt; RIGHT PARENTHESIS
+    u'*'        #  0x2A -&gt; ASTERISK
+    u'+'        #  0x2B -&gt; PLUS SIGN
+    u','        #  0x2C -&gt; COMMA
+    u'-'        #  0x2D -&gt; HYPHEN-MINUS
+    u'.'        #  0x2E -&gt; FULL STOP
+    u'/'        #  0x2F -&gt; SOLIDUS
+    u'0'        #  0x30 -&gt; DIGIT ZERO
+    u'1'        #  0x31 -&gt; DIGIT ONE
+    u'2'        #  0x32 -&gt; DIGIT TWO
+    u'3'        #  0x33 -&gt; DIGIT THREE
+    u'4'        #  0x34 -&gt; DIGIT FOUR
+    u'5'        #  0x35 -&gt; DIGIT FIVE
+    u'6'        #  0x36 -&gt; DIGIT SIX
+    u'7'        #  0x37 -&gt; DIGIT SEVEN
+    u'8'        #  0x38 -&gt; DIGIT EIGHT
+    u'9'        #  0x39 -&gt; DIGIT NINE
+    u':'        #  0x3A -&gt; COLON
+    u';'        #  0x3B -&gt; SEMICOLON
+    u'&lt;'        #  0x3C -&gt; LESS-THAN SIGN
+    u'='        #  0x3D -&gt; EQUALS SIGN
+    u'&gt;'        #  0x3E -&gt; GREATER-THAN SIGN
+    u'?'        #  0x3F -&gt; QUESTION MARK
+    u'@'        #  0x40 -&gt; COMMERCIAL AT
+    u'A'        #  0x41 -&gt; LATIN CAPITAL LETTER A
+    u'B'        #  0x42 -&gt; LATIN CAPITAL LETTER B
+    u'C'        #  0x43 -&gt; LATIN CAPITAL LETTER C
+    u'D'        #  0x44 -&gt; LATIN CAPITAL LETTER D
+    u'E'        #  0x45 -&gt; LATIN CAPITAL LETTER E
+    u'F'        #  0x46 -&gt; LATIN CAPITAL LETTER F
+    u'G'        #  0x47 -&gt; LATIN CAPITAL LETTER G
+    u'H'        #  0x48 -&gt; LATIN CAPITAL LETTER H
+    u'I'        #  0x49 -&gt; LATIN CAPITAL LETTER I
+    u'J'        #  0x4A -&gt; LATIN CAPITAL LETTER J
+    u'K'        #  0x4B -&gt; LATIN CAPITAL LETTER K
+    u'L'        #  0x4C -&gt; LATIN CAPITAL LETTER L
+    u'M'        #  0x4D -&gt; LATIN CAPITAL LETTER M
+    u'N'        #  0x4E -&gt; LATIN CAPITAL LETTER N
+    u'O'        #  0x4F -&gt; LATIN CAPITAL LETTER O
+    u'P'        #  0x50 -&gt; LATIN CAPITAL LETTER P
+    u'Q'        #  0x51 -&gt; LATIN CAPITAL LETTER Q
+    u'R'        #  0x52 -&gt; LATIN CAPITAL LETTER R
+    u'S'        #  0x53 -&gt; LATIN CAPITAL LETTER S
+    u'T'        #  0x54 -&gt; LATIN CAPITAL LETTER T
+    u'U'        #  0x55 -&gt; LATIN CAPITAL LETTER U
+    u'V'        #  0x56 -&gt; LATIN CAPITAL LETTER V
+    u'W'        #  0x57 -&gt; LATIN CAPITAL LETTER W
+    u'X'        #  0x58 -&gt; LATIN CAPITAL LETTER X
+    u'Y'        #  0x59 -&gt; LATIN CAPITAL LETTER Y
+    u'Z'        #  0x5A -&gt; LATIN CAPITAL LETTER Z
+    u'['        #  0x5B -&gt; LEFT SQUARE BRACKET
+    u'\\'       #  0x5C -&gt; REVERSE SOLIDUS
+    u']'        #  0x5D -&gt; RIGHT SQUARE BRACKET
+    u'^'        #  0x5E -&gt; CIRCUMFLEX ACCENT
+    u'_'        #  0x5F -&gt; LOW LINE
+    u'`'        #  0x60 -&gt; GRAVE ACCENT
+    u'a'        #  0x61 -&gt; LATIN SMALL LETTER A
+    u'b'        #  0x62 -&gt; LATIN SMALL LETTER B
+    u'c'        #  0x63 -&gt; LATIN SMALL LETTER C
+    u'd'        #  0x64 -&gt; LATIN SMALL LETTER D
+    u'e'        #  0x65 -&gt; LATIN SMALL LETTER E
+    u'f'        #  0x66 -&gt; LATIN SMALL LETTER F
+    u'g'        #  0x67 -&gt; LATIN SMALL LETTER G
+    u'h'        #  0x68 -&gt; LATIN SMALL LETTER H
+    u'i'        #  0x69 -&gt; LATIN SMALL LETTER I
+    u'j'        #  0x6A -&gt; LATIN SMALL LETTER J
+    u'k'        #  0x6B -&gt; LATIN SMALL LETTER K
+    u'l'        #  0x6C -&gt; LATIN SMALL LETTER L
+    u'm'        #  0x6D -&gt; LATIN SMALL LETTER M
+    u'n'        #  0x6E -&gt; LATIN SMALL LETTER N
+    u'o'        #  0x6F -&gt; LATIN SMALL LETTER O
+    u'p'        #  0x70 -&gt; LATIN SMALL LETTER P
+    u'q'        #  0x71 -&gt; LATIN SMALL LETTER Q
+    u'r'        #  0x72 -&gt; LATIN SMALL LETTER R
+    u's'        #  0x73 -&gt; LATIN SMALL LETTER S
+    u't'        #  0x74 -&gt; LATIN SMALL LETTER T
+    u'u'        #  0x75 -&gt; LATIN SMALL LETTER U
+    u'v'        #  0x76 -&gt; LATIN SMALL LETTER V
+    u'w'        #  0x77 -&gt; LATIN SMALL LETTER W
+    u'x'        #  0x78 -&gt; LATIN SMALL LETTER X
+    u'y'        #  0x79 -&gt; LATIN SMALL LETTER Y
+    u'z'        #  0x7A -&gt; LATIN SMALL LETTER Z
+    u'{'        #  0x7B -&gt; LEFT CURLY BRACKET
+    u'|'        #  0x7C -&gt; VERTICAL LINE
+    u'}'        #  0x7D -&gt; RIGHT CURLY BRACKET
+    u'~'        #  0x7E -&gt; TILDE
+    u'\x7f'     #  0x7F -&gt; DELETE
+    u'\u20ac'   #  0x80 -&gt; EURO SIGN
+    u'\ufffe'   #  0x81 -&gt; UNDEFINED
+    u'\u201a'   #  0x82 -&gt; SINGLE LOW-9 QUOTATION MARK
+    u'\u0192'   #  0x83 -&gt; LATIN SMALL LETTER F WITH HOOK
+    u'\u201e'   #  0x84 -&gt; DOUBLE LOW-9 QUOTATION MARK
+    u'\u2026'   #  0x85 -&gt; HORIZONTAL ELLIPSIS
+    u'\u2020'   #  0x86 -&gt; DAGGER
+    u'\u2021'   #  0x87 -&gt; DOUBLE DAGGER
+    u'\u02c6'   #  0x88 -&gt; MODIFIER LETTER CIRCUMFLEX ACCENT
+    u'\u2030'   #  0x89 -&gt; PER MILLE SIGN
+    u'\u0160'   #  0x8A -&gt; LATIN CAPITAL LETTER S WITH CARON
+    u'\u2039'   #  0x8B -&gt; SINGLE LEFT-POINTING ANGLE QUOTATION MARK
+    u'\u0152'   #  0x8C -&gt; LATIN CAPITAL LIGATURE OE
+    u'\ufffe'   #  0x8D -&gt; UNDEFINED
+    u'\u017d'   #  0x8E -&gt; LATIN CAPITAL LETTER Z WITH CARON
+    u'\ufffe'   #  0x8F -&gt; UNDEFINED
+    u'\ufffe'   #  0x90 -&gt; UNDEFINED
+    u'\u2018'   #  0x91 -&gt; LEFT SINGLE QUOTATION MARK
+    u'\u2019'   #  0x92 -&gt; RIGHT SINGLE QUOTATION MARK
+    u'\u201c'   #  0x93 -&gt; LEFT DOUBLE QUOTATION MARK
+    u'\u201d'   #  0x94 -&gt; RIGHT DOUBLE QUOTATION MARK
+    u'\u2022'   #  0x95 -&gt; BULLET
+    u'\u2013'   #  0x96 -&gt; EN DASH
+    u'\u2014'   #  0x97 -&gt; EM DASH
+    u'\u02dc'   #  0x98 -&gt; SMALL TILDE
+    u'\u2122'   #  0x99 -&gt; TRADE MARK SIGN
+    u'\u0161'   #  0x9A -&gt; LATIN SMALL LETTER S WITH CARON
+    u'\u203a'   #  0x9B -&gt; SINGLE RIGHT-POINTING ANGLE QUOTATION MARK
+    u'\u0153'   #  0x9C -&gt; LATIN SMALL LIGATURE OE
+    u'\ufffe'   #  0x9D -&gt; UNDEFINED
+    u'\u017e'   #  0x9E -&gt; LATIN SMALL LETTER Z WITH CARON
+    u'\u0178'   #  0x9F -&gt; LATIN CAPITAL LETTER Y WITH DIAERESIS
+    u'\xa0'     #  0xA0 -&gt; NO-BREAK SPACE
+    u'\xa1'     #  0xA1 -&gt; INVERTED EXCLAMATION MARK
+    u'\xa2'     #  0xA2 -&gt; CENT SIGN
+    u'\xa3'     #  0xA3 -&gt; POUND SIGN
+    u'\xa4'     #  0xA4 -&gt; CURRENCY SIGN
+    u'\xa5'     #  0xA5 -&gt; YEN SIGN
+    u'\xa6'     #  0xA6 -&gt; BROKEN BAR
+    u'\xa7'     #  0xA7 -&gt; SECTION SIGN
+    u'\xa8'     #  0xA8 -&gt; DIAERESIS
+    u'\xa9'     #  0xA9 -&gt; COPYRIGHT SIGN
+    u'\xaa'     #  0xAA -&gt; FEMININE ORDINAL INDICATOR
+    u'\xab'     #  0xAB -&gt; LEFT-POINTING DOUBLE ANGLE QUOTATION MARK
+    u'\xac'     #  0xAC -&gt; NOT SIGN
+    u'\xad'     #  0xAD -&gt; SOFT HYPHEN
+    u'\xae'     #  0xAE -&gt; REGISTERED SIGN
+    u'\xaf'     #  0xAF -&gt; MACRON
+    u'\xb0'     #  0xB0 -&gt; DEGREE SIGN
+    u'\xb1'     #  0xB1 -&gt; PLUS-MINUS SIGN
+    u'\xb2'     #  0xB2 -&gt; SUPERSCRIPT TWO
+    u'\xb3'     #  0xB3 -&gt; SUPERSCRIPT THREE
+    u'\xb4'     #  0xB4 -&gt; ACUTE ACCENT
+    u'\xb5'     #  0xB5 -&gt; MICRO SIGN
+    u'\xb6'     #  0xB6 -&gt; PILCROW SIGN
+    u'\xb7'     #  0xB7 -&gt; MIDDLE DOT
+    u'\xb8'     #  0xB8 -&gt; CEDILLA
+    u'\xb9'     #  0xB9 -&gt; SUPERSCRIPT ONE
+    u'\xba'     #  0xBA -&gt; MASCULINE ORDINAL INDICATOR
+    u'\xbb'     #  0xBB -&gt; RIGHT-POINTING DOUBLE ANGLE QUOTATION MARK
+    u'\xbc'     #  0xBC -&gt; VULGAR FRACTION ONE QUARTER
+    u'\xbd'     #  0xBD -&gt; VULGAR FRACTION ONE HALF
+    u'\xbe'     #  0xBE -&gt; VULGAR FRACTION THREE QUARTERS
+    u'\xbf'     #  0xBF -&gt; INVERTED QUESTION MARK
+    u'\xc0'     #  0xC0 -&gt; LATIN CAPITAL LETTER A WITH GRAVE
+    u'\xc1'     #  0xC1 -&gt; LATIN CAPITAL LETTER A WITH ACUTE
+    u'\xc2'     #  0xC2 -&gt; LATIN CAPITAL LETTER A WITH CIRCUMFLEX
+    u'\xc3'     #  0xC3 -&gt; LATIN CAPITAL LETTER A WITH TILDE
+    u'\xc4'     #  0xC4 -&gt; LATIN CAPITAL LETTER A WITH DIAERESIS
+    u'\xc5'     #  0xC5 -&gt; LATIN CAPITAL LETTER A WITH RING ABOVE
+    u'\xc6'     #  0xC6 -&gt; LATIN CAPITAL LETTER AE
+    u'\xc7'     #  0xC7 -&gt; LATIN CAPITAL LETTER C WITH CEDILLA
+    u'\xc8'     #  0xC8 -&gt; LATIN CAPITAL LETTER E WITH GRAVE
+    u'\xc9'     #  0xC9 -&gt; LATIN CAPITAL LETTER E WITH ACUTE
+    u'\xca'     #  0xCA -&gt; LATIN CAPITAL LETTER E WITH CIRCUMFLEX
+    u'\xcb'     #  0xCB -&gt; LATIN CAPITAL LETTER E WITH DIAERESIS
+    u'\xcc'     #  0xCC -&gt; LATIN CAPITAL LETTER I WITH GRAVE
+    u'\xcd'     #  0xCD -&gt; LATIN CAPITAL LETTER I WITH ACUTE
+    u'\xce'     #  0xCE -&gt; LATIN CAPITAL LETTER I WITH CIRCUMFLEX
+    u'\xcf'     #  0xCF -&gt; LATIN CAPITAL LETTER I WITH DIAERESIS
+    u'\xd0'     #  0xD0 -&gt; LATIN CAPITAL LETTER ETH
+    u'\xd1'     #  0xD1 -&gt; LATIN CAPITAL LETTER N WITH TILDE
+    u'\xd2'     #  0xD2 -&gt; LATIN CAPITAL LETTER O WITH GRAVE
+    u'\xd3'     #  0xD3 -&gt; LATIN CAPITAL LETTER O WITH ACUTE
+    u'\xd4'     #  0xD4 -&gt; LATIN CAPITAL LETTER O WITH CIRCUMFLEX
+    u'\xd5'     #  0xD5 -&gt; LATIN CAPITAL LETTER O WITH TILDE
+    u'\xd6'     #  0xD6 -&gt; LATIN CAPITAL LETTER O WITH DIAERESIS
+    u'\xd7'     #  0xD7 -&gt; MULTIPLICATION SIGN
+    u'\xd8'     #  0xD8 -&gt; LATIN CAPITAL LETTER O WITH STROKE
+    u'\xd9'     #  0xD9 -&gt; LATIN CAPITAL LETTER U WITH GRAVE
+    u'\xda'     #  0xDA -&gt; LATIN CAPITAL LETTER U WITH ACUTE
+    u'\xdb'     #  0xDB -&gt; LATIN CAPITAL LETTER U WITH CIRCUMFLEX
+    u'\xdc'     #  0xDC -&gt; LATIN CAPITAL LETTER U WITH DIAERESIS
+    u'\xdd'     #  0xDD -&gt; LATIN CAPITAL LETTER Y WITH ACUTE
+    u'\xde'     #  0xDE -&gt; LATIN CAPITAL LETTER THORN
+    u'\xdf'     #  0xDF -&gt; LATIN SMALL LETTER SHARP S
+    u'\xe0'     #  0xE0 -&gt; LATIN SMALL LETTER A WITH GRAVE
+    u'\xe1'     #  0xE1 -&gt; LATIN SMALL LETTER A WITH ACUTE
+    u'\xe2'     #  0xE2 -&gt; LATIN SMALL LETTER A WITH CIRCUMFLEX
+    u'\xe3'     #  0xE3 -&gt; LATIN SMALL LETTER A WITH TILDE
+    u'\xe4'     #  0xE4 -&gt; LATIN SMALL LETTER A WITH DIAERESIS
+    u'\xe5'     #  0xE5 -&gt; LATIN SMALL LETTER A WITH RING ABOVE
+    u'\xe6'     #  0xE6 -&gt; LATIN SMALL LETTER AE
+    u'\xe7'     #  0xE7 -&gt; LATIN SMALL LETTER C WITH CEDILLA
+    u'\xe8'     #  0xE8 -&gt; LATIN SMALL LETTER E WITH GRAVE
+    u'\xe9'     #  0xE9 -&gt; LATIN SMALL LETTER E WITH ACUTE
+    u'\xea'     #  0xEA -&gt; LATIN SMALL LETTER E WITH CIRCUMFLEX
+    u'\xeb'     #  0xEB -&gt; LATIN SMALL LETTER E WITH DIAERESIS
+    u'\xec'     #  0xEC -&gt; LATIN SMALL LETTER I WITH GRAVE
+    u'\xed'     #  0xED -&gt; LATIN SMALL LETTER I WITH ACUTE
+    u'\xee'     #  0xEE -&gt; LATIN SMALL LETTER I WITH CIRCUMFLEX
+    u'\xef'     #  0xEF -&gt; LATIN SMALL LETTER I WITH DIAERESIS
+    u'\xf0'     #  0xF0 -&gt; LATIN SMALL LETTER ETH
+    u'\xf1'     #  0xF1 -&gt; LATIN SMALL LETTER N WITH TILDE
+    u'\xf2'     #  0xF2 -&gt; LATIN SMALL LETTER O WITH GRAVE
+    u'\xf3'     #  0xF3 -&gt; LATIN SMALL LETTER O WITH ACUTE
+    u'\xf4'     #  0xF4 -&gt; LATIN SMALL LETTER O WITH CIRCUMFLEX
+    u'\xf5'     #  0xF5 -&gt; LATIN SMALL LETTER O WITH TILDE
+    u'\xf6'     #  0xF6 -&gt; LATIN SMALL LETTER O WITH DIAERESIS
+    u'\xf7'     #  0xF7 -&gt; DIVISION SIGN
+    u'\xf8'     #  0xF8 -&gt; LATIN SMALL LETTER O WITH STROKE
+    u'\xf9'     #  0xF9 -&gt; LATIN SMALL LETTER U WITH GRAVE
+    u'\xfa'     #  0xFA -&gt; LATIN SMALL LETTER U WITH ACUTE
+    u'\xfb'     #  0xFB -&gt; LATIN SMALL LETTER U WITH CIRCUMFLEX
+    u'\xfc'     #  0xFC -&gt; LATIN SMALL LETTER U WITH DIAERESIS
+    u'\xfd'     #  0xFD -&gt; LATIN SMALL LETTER Y WITH ACUTE
+    u'\xfe'     #  0xFE -&gt; LATIN SMALL LETTER THORN
+    u'\xff'     #  0xFF -&gt; LATIN SMALL LETTER Y WITH DIAERESIS
+)
+
+### Encoding table
+encoding_table=codecs.charmap_build(decoding_table)

Added: Lobby/TASClient/Python/modules/encodings/latin_1.py
===================================================================
--- Lobby/TASClient/Python/modules/encodings/latin_1.py	                        (rev 0)
+++ Lobby/TASClient/Python/modules/encodings/latin_1.py	2010-05-02 01:01:06 UTC (rev 7483)
@@ -0,0 +1,50 @@
+&quot;&quot;&quot; Python 'latin-1' Codec
+
+
+Written by Marc-Andre Lemburg (<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">mal at lemburg.com</A>).
+
+(c) Copyright CNRI, All Rights Reserved. NO WARRANTY.
+
+&quot;&quot;&quot;
+import codecs
+
+### Codec APIs
+
+class Codec(codecs.Codec):
+
+    # Note: Binding these as C functions will result in the class not
+    # converting them to methods. This is intended.
+    encode = codecs.latin_1_encode
+    decode = codecs.latin_1_decode
+
+class IncrementalEncoder(codecs.IncrementalEncoder):
+    def encode(self, input, final=False):
+        return codecs.latin_1_encode(input,self.errors)[0]
+
+class IncrementalDecoder(codecs.IncrementalDecoder):
+    def decode(self, input, final=False):
+        return codecs.latin_1_decode(input,self.errors)[0]
+
+class StreamWriter(Codec,codecs.StreamWriter):
+    pass
+
+class StreamReader(Codec,codecs.StreamReader):
+    pass
+
+class StreamConverter(StreamWriter,StreamReader):
+
+    encode = codecs.latin_1_decode
+    decode = codecs.latin_1_encode
+
+### encodings module API
+
+def getregentry():
+    return codecs.CodecInfo(
+        name='iso8859-1',
+        encode=Codec.encode,
+        decode=Codec.decode,
+        incrementalencoder=IncrementalEncoder,
+        incrementaldecoder=IncrementalDecoder,
+        streamreader=StreamReader,
+        streamwriter=StreamWriter,
+    )

Added: Lobby/TASClient/Python/modules/encodings/utf_8.py
===================================================================
--- Lobby/TASClient/Python/modules/encodings/utf_8.py	                        (rev 0)
+++ Lobby/TASClient/Python/modules/encodings/utf_8.py	2010-05-02 01:01:06 UTC (rev 7483)
@@ -0,0 +1,42 @@
+&quot;&quot;&quot; Python 'utf-8' Codec
+
+
+Written by Marc-Andre Lemburg (<A HREF="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">mal at lemburg.com</A>).
+
+(c) Copyright CNRI, All Rights Reserved. NO WARRANTY.
+
+&quot;&quot;&quot;
+import codecs
+
+### Codec APIs
+
+encode = codecs.utf_8_encode
+
+def decode(input, errors='strict'):
+    return codecs.utf_8_decode(input, errors, True)
+
+class IncrementalEncoder(codecs.IncrementalEncoder):
+    def encode(self, input, final=False):
+        return codecs.utf_8_encode(input, self.errors)[0]
+
+class IncrementalDecoder(codecs.BufferedIncrementalDecoder):
+    _buffer_decode = codecs.utf_8_decode
+
+class StreamWriter(codecs.StreamWriter):
+    encode = codecs.utf_8_encode
+
+class StreamReader(codecs.StreamReader):
+    decode = codecs.utf_8_decode
+
+### encodings module API
+
+def getregentry():
+    return codecs.CodecInfo(
+        name='utf-8',
+        encode=encode,
+        decode=decode,
+        incrementalencoder=IncrementalEncoder,
+        incrementaldecoder=IncrementalDecoder,
+        streamreader=StreamReader,
+        streamwriter=StreamWriter,
+    )

Modified: Lobby/TASClient/Python/scripts/SubmitCrashReport.py
===================================================================
--- Lobby/TASClient/Python/scripts/SubmitCrashReport.py	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/Python/scripts/SubmitCrashReport.py	2010-05-02 01:01:06 UTC (rev 7483)
@@ -1,10 +1,10 @@
-	#######################################################################################################
-# SubmitCrashReport for TASClient by Zydox (2010-04-22)
+#######################################################################################################
+# SubmitCrashReport for TASClient by Zydox (2010-05-01)
 # 
 # If the infolog.txt contains &quot;has crashed.&quot;, this script will upload the
 # infolog.txt, script.txt, ext.txt, unitsync.log and demo to <A HREF="http://infologs.springrts.com/upload">http://infologs.springrts.com/upload</A>
 #
-# Version 1.0
+# Version 1.1
 # Requries: zipfile.py, pycurl.pyd, struct.py &amp; pycurl.pyd
 #
 # Many thanks to Satirik for all the help understanding the api &amp; gui and to Teutooni for testing
@@ -21,7 +21,7 @@
 api = lobbyscript.Callback()
 gui = lobbyscript.GUI()
 colors = gui.GetColors()
-version = '1.0'
+version = '1.1'
 
 
 def cmd_CrashReportWindow ():
@@ -93,6 +93,18 @@
 
 
 def SubmitCrashReport_SendCrashReport ():
+	global version
+	api.Print ('SubmitCrashReport: Submit')
+	info = gui.GetControlProperties ('MainForm.CrashReportForm.TitleBar.UserInformationInputBox', '')
+	file = open ('client.txt', 'w')
+	file.write ('TASClient ' + str (api.GetVersion ()) + '\nSubmitCrashReport ' + str (version))
+	file.close ()
+	api.Print ('SubmitCrashReport: client.txt created')
+	file = open ('information.txt', 'w')
+	file.write (&quot;\n&quot;.join (info['Lines']))
+	file.close ()
+	api.Print ('SubmitCrashReport: information.txt created')
+
 	Submit = SubmitCrashReport ()
 	Submit.start ()
 	SubmitCrashReport_HideSendForm ()
@@ -103,18 +115,11 @@
 		Thread.__init__(self)
 	
 	def run (self):
-		global version
 		api.Print ('SubmitCrashReport: Send crash file')
 		
-		file = open ('client.txt', 'w')
-		file.write ('TASClient ' + str (api.GetVersion ()) + '\nSubmitCrashReport ' + str (version))
-		file.close ()
-		info = gui.GetControlProperties ('MainForm.CrashReportForm.TitleBar.UserInformationInputBox', '')
-		file = open ('information.txt', 'w')
-		file.write (&quot;\n&quot;.join (info['Lines']))
-		file.close ()
+		settings = ''
+		demo = ''
 		
-		settings = demo = ''
 		file = open ('infolog.txt', 'r')
 		for line in file:
 			match = re.search ('^using( default|) configuration source ', line)
@@ -145,16 +150,21 @@
 		zip.close ()
 		
 		
-		c = pycurl.Curl()
-		c.setopt(c.POST, 1)
-		c.setopt(c.URL, &quot;<A HREF="http://infologs.springrts.com/upload">http://infologs.springrts.com/upload</A>&quot;)
-		c.setopt(c.HTTPPOST, [(&quot;file&quot;, (c.FORM_FILE, os.getcwd() + '\\CrashReport.zip'))])
+		c = pycurl.Curl ()
+		c.setopt (c.POST, 1)
+		c.setopt (c.URL, &quot;<A HREF="http://infologs.springrts.com/upload">http://infologs.springrts.com/upload</A>&quot;)
+		c.setopt (pycurl.HTTPHEADER, ['Expect:'])
 		try:
-			c.perform()
-			c.close()
+			c.setopt (c.HTTPPOST, [(&quot;file&quot;, (c.FORM_FILE, os.getcwd () + '\\CrashReport.zip'))])
+			c.perform ()
 			api.Print ('SubmitCrashReport: Completed')
 		except:
 			api.Print ('SubmitCrashReport: Upload failed')
-		os.remove (os.getcwd() + '\\CrashReport.zip')
-		os.remove (os.getcwd() + '\\client.txt')
-		os.remove (os.getcwd() + '\\information.txt')
\ No newline at end of file
+		c.close ()
+
+		try:
+			os.remove (os.getcwd () + '\\CrashReport.zip')
+			os.remove (os.getcwd () + '\\client.txt')
+			os.remove (os.getcwd () + '\\information.txt')
+		except:
+			api.Print ('SubmitCrashReport: Cleanup failed (CrashReport.zip, client.txt &amp; information.txt)')
\ No newline at end of file

Modified: Lobby/TASClient/Python/scripts/forumIt.py
===================================================================
--- Lobby/TASClient/Python/scripts/forumIt.py	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/Python/scripts/forumIt.py	2010-05-02 01:01:06 UTC (rev 7483)
@@ -6,7 +6,13 @@
 api = lobbyscript.Callback()
 gui = lobbyscript.GUI()
 
+def __go(url):
+	webbrowser.open(url)
+
+def webBrowserThreadedOpen(url):
+	thread.start_new_thread(__go,(url,))
+
 def cmd_forum(args):
-	webbrowser.open(&quot;<A HREF="http://springrts.com/phpbb/search.php?keywords=">http://springrts.com/phpbb/search.php?keywords=</A>&quot;+string.join(args, '' )+&quot;&amp;terms=all&amp;author=&amp;sc=1&amp;sf=all&amp;sk=t&amp;sd=d&amp;sr=topics&amp;st=0&amp;ch=300&amp;t=0&amp;submit=Search&quot;)
+	webBrowserThreadedOpen(&quot;<A HREF="http://springrts.com/phpbb/search.php?keywords=">http://springrts.com/phpbb/search.php?keywords=</A>&quot;+string.join(args, '' )+&quot;&amp;terms=all&amp;author=&amp;sc=1&amp;sf=all&amp;sk=t&amp;sd=d&amp;sr=topics&amp;st=0&amp;ch=300&amp;t=0&amp;submit=Search&quot;)
 	return True
 	
\ No newline at end of file

Modified: Lobby/TASClient/Python/scripts/googleIt.py
===================================================================
--- Lobby/TASClient/Python/scripts/googleIt.py	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/Python/scripts/googleIt.py	2010-05-02 01:01:06 UTC (rev 7483)
@@ -1,16 +1,75 @@
 import time,thread
 import lobbyscript
 import webbrowser
+import sys
+import pycurl
+import re
+from encodings import ascii
+from encodings import utf_8
 
 api = lobbyscript.Callback()
 gui = lobbyscript.GUI()
 
+autoTranslateNickList = dict()
+
+HexCharacters = &quot;0123456789abcdef&quot;
+
+def CleanCharHex(c):
+    o = ord(c)
+    r = HexCharacters[o / 16]
+    r += HexCharacters[o % 16]
+    return r
+
+def UrlEncode(s):
+	r = ''
+	for c in s:
+		o = ord(c)
+		if (o &gt;= 48 and o &lt;= 57) or \
+			(o &gt;= 97 and o &lt;= 122) or \
+			(o &gt;= 65 and o &lt;= 90) or \
+			o == 36 or o == 45 or o == 95 or \
+			o == 46 or o == 43 or o == 33 or \
+			o == 42 or o == 39 or o == 40 or \
+			o == 41 or o == 44:
+			r += c
+		else:
+			r += '%' + CleanCharHex(c)
+	return r
+
+class PageContent:
+    def __init__(self):
+        self.contents = ''
+
+    def body_callback(self, buf):
+        self.contents = self.contents + buf
+
+
+def translate(lang,text):
+	pc = PageContent()
+	c = pycurl.Curl()
+	c.setopt(c.URL, &quot;<A HREF="http://ajax.googleapis.com/ajax/services/language/translate?v=1.0&amp;langpair=|">http://ajax.googleapis.com/ajax/services/language/translate?v=1.0&amp;langpair=|</A>&quot;+lang.encode(&quot;utf-8&quot;)+&quot;&amp;q=&quot;+UrlEncode(text.encode(&quot;utf-8&quot;)))
+	c.setopt(c.WRITEFUNCTION, pc.body_callback)
+	c.perform()
+	c.close()
+	match = re.search('&quot;translatedText&quot;:&quot;([^&quot;]*)&quot;', pc.contents)
+	if match==None:
+		return text
+	else:
+		return match.groups()[0].decode(&quot;utf-8&quot;)
+
+def __go(url):
+	webbrowser.open(url)
+
+def webBrowserThreadedOpen(url):
+	thread.start_new_thread(__go,(url,))
+
 def onGoogleItClick(channel,line,charPosInLine,selectedText):
-	webbrowser.open(&quot;<A HREF="http://www.google.com/search?q=">http://www.google.com/search?q=</A>&quot;+selectedText)
+	if selectedText != '':
+		webBrowserThreadedOpen(&quot;<A HREF="http://www.google.com/search?q=">http://www.google.com/search?q=</A>&quot;+selectedText)
 	
 def onTranslateClick(channel,line,charPosInLine,selectedText,lang):
 	if selectedText != '':
-		webbrowser.open(&quot;<A HREF="http://translate.google.com/#auto|">http://translate.google.com/#auto|</A>&quot;+lang+&quot;|&quot;+selectedText)
+		webBrowserThreadedOpen(&quot;<A HREF="http://translate.google.com/#auto|">http://translate.google.com/#auto|</A>&quot;+lang.decode(&quot;utf-8&quot;)+&quot;|&quot;+selectedText.decode(&quot;utf-8&quot;))
     
 
 def _init():
@@ -20,5 +79,77 @@
 	gui.AddItemToMenu('Chat','Translate in german',('de',),'googleIt','onTranslateClick')
 	gui.AddItemToMenu('Chat','Translate in italian',('it',),'googleIt','onTranslateClick')
 	gui.AddItemToMenu('Chat','Translate in spanish',('es',),'googleIt','onTranslateClick')
+	gui.AddItemToMenu('Chat','Translate in russian',('ru',),'googleIt','onTranslateClick')
+	autoTransSubMenuId = gui.AddSubmenuToMenu('PlayerItem','Auto translate')
+	gui.AddItemToMenu(autoTransSubMenuId,'Disable',(),'googleIt','onStopAutoTranslation')
+	gui.AddItemToMenu(autoTransSubMenuId,'in english',('en',),'googleIt','onAutoTranslateClick')
+	gui.AddItemToMenu(autoTransSubMenuId,'in french',('fr',),'googleIt','onAutoTranslateClick')
+	gui.AddItemToMenu(autoTransSubMenuId,'in german',('de',),'googleIt','onAutoTranslateClick')
+	gui.AddItemToMenu(autoTransSubMenuId,'in italian',('it',),'googleIt','onAutoTranslateClick')
+	gui.AddItemToMenu(autoTransSubMenuId,'in spanish',('es',),'googleIt','onAutoTranslateClick')
+	gui.AddItemToMenu(autoTransSubMenuId,'in russian',('ru',),'googleIt','onAutoTranslateClick')
+	
+def onStopAutoTranslation(user):
+	global autoTranslateNickList
+	if user in autoTranslateNickList:
+		del autoTranslateNickList[user]
+def onAutoTranslateClick(user,lang):
+	cmd_autotranslate(user,lang)
 
-	
\ No newline at end of file
+def sendTranslation(command,lang,text):
+	api.SendProtocol(command+' '+translate(lang,text))
+	
+def outMessage(command,text):
+	words = text.split(' ')
+	if words[0] == '!translate':
+		sendTranslation(command,words[1],' '.join(words[2:]))
+		return True
+	else:
+		return False
+
+def out_SAY(channel,text):
+	if outMessage('SAY '+channel,text):
+		return ''
+
+def out_SAYPRIVATE(user,text):
+	if outMessage('SAYPRIVATE '+user,text):
+		return ''
+		
+def out_SAYEX(channel,text):
+	if outMessage('SAYEX '+channel,text):
+		return ''
+		
+def out_SAYBATTLE(text):
+	if outMessage('SAYBATTLE',text):
+		return ''
+		
+def out_SAYBATTLEEX(text):
+	if outMessage('SAYBATTLEEX',text):
+		return ''
+		
+def inMessage(command,user,text):
+	global autoTranslateNickList
+	if user in autoTranslateNickList:
+		return command+user+' '+translate(autoTranslateNickList[user],text)
+	else:
+		return command+user+' '+text
+		
+def in_SAID(channel,user,text):
+	return inMessage(channel+' ',user,text)
+	
+def in_SAIDEX(channel,user,text):
+	return inMessage(channel+' ',user,text)
+	
+def in_SAIDPRIVATE(user,text):
+	return inMessage('',user,text)
+	
+def in_SAIDBATTLE(user,text):
+	return inMessage('',user,text)
+	
+def in_SAIDBATTLEEX(user,text):
+	return inMessage('',user,text)
+
+def cmd_autotranslate(userNick,lang):
+	global autoTranslateNickList
+	autoTranslateNickList[userNick] = lang
+	return True

Modified: Lobby/TASClient/PythonScriptDebugFormUnit.dfm
===================================================================
--- Lobby/TASClient/PythonScriptDebugFormUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/PythonScriptDebugFormUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -1,6 +1,6 @@
 object PythonScriptDebugForm: TPythonScriptDebugForm
-  Left = 450
-  Top = 117
+  Left = 1135
+  Top = 311
   Width = 693
   Height = 284
   Caption = 'PythonScriptDebug'

Modified: Lobby/TASClient/SpringDownloaderFormUnit.dfm
===================================================================
--- Lobby/TASClient/SpringDownloaderFormUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/SpringDownloaderFormUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -14,6 +14,7 @@
   Font.Style = []
   OldCreateOrder = False
   Position = poMainFormCenter
+  Scaled = False
   OnClose = FormClose
   OnCreate = FormCreate
   PixelsPerInch = 96

Modified: Lobby/TASClient/SpringDownloaderFormUnit.pas
===================================================================
--- Lobby/TASClient/SpringDownloaderFormUnit.pas	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/SpringDownloaderFormUnit.pas	2010-05-02 01:01:06 UTC (rev 7483)
@@ -246,7 +246,10 @@
   TranslateComponent(self);
 
   if Preferences.ThemeType = sknSkin then
+  begin
     SpTBXTitleBar1.Active := True;
+    BorderStyle := bsNone;
+  end;
 
   FOnProgress := nil;
 end;

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/TASClient.dof	2010-05-02 01:01:06 UTC (rev 7483)
@@ -113,9 +113,9 @@
 IncludeVerInfo=1
 AutoIncBuild=1
 MajorVer=0
-MinorVer=73
+MinorVer=74
 Release=0
-Build=912
+Build=915
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=Spring RTS Engine lobby client
-FileVersion=0.73.0.912
+FileVersion=0.74.0.915
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.dpr
===================================================================
--- Lobby/TASClient/TASClient.dpr	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/TASClient.dpr	2010-05-02 01:01:06 UTC (rev 7483)
@@ -95,7 +95,8 @@
   GIFImage in 'GIFImage.pas',
   SetStringsUnit in 'SetStringsUnit.pas' {SetStringsForm},
   ChannelsListFormUnit in 'ChannelsListFormUnit.pas' {ChannelsListForm},
-  SpTBXSkins;
+  SpTBXSkins,
+  BotOptionsFormUnit in 'BotOptionsFormUnit.pas' {BotOptionsForm};
 
 var
   i: Integer;
@@ -231,6 +232,7 @@
   if MainUnit.Debug.Enabled then
     Misc.TryToAddLog(MainUnit.StartDebugLog,'Creating MainForm ...');
   Application.CreateForm(TMainForm, MainForm);
+  Application.CreateForm(TBotOptionsForm, BotOptionsForm);
   if MainUnit.Debug.Enabled then
     Misc.TryToAddLog(MainUnit.StartDebugLog,'Creating SetStringsForm ...');
   Application.CreateForm(TSetStringsForm, SetStringsForm);

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)

Modified: Lobby/TASClient/TemplateEditorFormUnit.dfm
===================================================================
--- Lobby/TASClient/TemplateEditorFormUnit.dfm	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/TemplateEditorFormUnit.dfm	2010-05-02 01:01:06 UTC (rev 7483)
@@ -12,6 +12,7 @@
   Font.Style = []
   OldCreateOrder = False
   Position = poMainFormCenter
+  Scaled = False
   PixelsPerInch = 96
   TextHeight = 13
   object GroupBox1: TGroupBox
@@ -120,7 +121,9 @@
       Height = 66
       Align = alTop
       Lines.Strings = (
-        #9'changeControlProp(&quot;$control&quot;,&quot;$subprop&quot;,&quot;$propname&quot;,$newvalue);')
+        
+          #9'gui.SetControlProperties ('#39'$control'#39', '#39'$subprop'#39', {'#39'$propname'#39':' +
+          '$newvalue})')
       TabOrder = 0
     end
   end

Modified: Lobby/TASClient/Utility.pas
===================================================================
--- Lobby/TASClient/Utility.pas	2010-04-27 19:30:24 UTC (rev 7482)
+++ Lobby/TASClient/Utility.pas	2010-05-02 01:01:06 UTC (rev 7483)
@@ -8,7 +8,8 @@
 interface
 
 uses
-  Windows, Graphics, Classes, SyncObjs, Controls,Math,MainUnit,OpenIL,gnugettext,class_TIntegerList;
+  Windows, Graphics, Classes, SyncObjs, Controls,Math,MainUnit,OpenIL,gnugettext,class_TIntegerList,
+  SpTBXEditors, SpTBXControls, SpTBXItem, SpTBXTabs, JvSpin, SpTBXSkins, StdCtrls;
 
 type
 
@@ -46,6 +47,131 @@
   TMapData = array of Char;
   PMapData = ^TMapData;
 
+TLuaOption = class
+  protected
+    LabelName: TSpTBXLabel;
+    DescriptionButton: TSpTBXButton;
+    procedure MakeDescriptionButton(AOwner: TWinControl);
+    procedure OnDescriptionButtonClick(Sender: TObject);virtual;
+    function GetSectionPanel(luaOptionList: TList): TSpTBXGroupBox;
+
+  public
+    Value: String;
+    DefaultValue: String;
+    KeyPrefix: String;
+    Key: String;
+    Name: String;
+    Description: String;
+    Section: String;
+    hasChanged: Boolean;
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;virtual;
+    procedure SetValue(v: String);virtual;
+    procedure OnChange(Sender: TObject);virtual;
+    procedure Enable;virtual;
+    procedure Disable;virtual;
+    procedure setToDefault();virtual;
+    function isDefault:Boolean;virtual;
+    function toString:String;virtual;
+    function toSetScriptTagsString:String;virtual;
+    function getDescription:string;virtual;
+    destructor Destroy; override;
+  end;
+
+  TLuaOptionSection = class(TLuaOption)
+  private
+
+  protected
+    Panel: TSpTBXGroupBox;
+  public
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
+    procedure SetValue(v: String);override;
+    procedure Enable;override;
+    procedure Disable;override;
+    procedure setToDefault();override;
+     function isDefault:Boolean;override;
+    function toString:String;override;
+    destructor Destroy; override;
+  end;
+
+  TLuaOptionBool = class(TLuaOption)
+  private
+
+  protected
+    Panel: TSpTBXPanel;
+    CheckBox: TSpTBXCheckBox;
+  public
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
+    procedure SetValue(v: String);override;
+    procedure Enable;override;
+    procedure Disable;override;
+    procedure setToDefault();override;
+    function isDefault:Boolean;override;
+    function toString:String;override;
+    destructor Destroy; override;
+  end;
+
+  TLuaOptionString = class(TLuaOption)
+  private
+
+  protected
+    Panel: TSpTBXPanel;
+    InputEdit: TSpTBXEdit;
+  public
+    MaxStringLength: Integer;
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
+    procedure SetValue(v: String);override;
+    procedure Enable;override;
+    procedure Disable;override;
+    procedure setToDefault();override;
+    function isDefault:Boolean;override;
+    function toString:String;override;
+    destructor Destroy; override;
+  end;
+
+  TLuaOptionNumber = class(TLuaOption)
+  private
+
+  protected
+    Panel: TSpTBXPanel;
+    InputEdit: TJvSpinEdit;
+  public
+    MinValue: Double;
+    MaxValue: Double;
+    StepValue: Double;
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
+    procedure SetValue(v: String);override;
+    procedure Enable;override;
+    procedure Disable;override;
+    procedure setToDefault();override;
+    function isDefault:Boolean;override;
+    procedure OnChange(Sender: TObject);override;
+    function toSetScriptTagsString:String;override;
+    function toString:String;override;
+    destructor Destroy; override;
+  end;
+
+  TLuaOptionList = class(TLuaOption)
+  private
+    Panel: TSpTBXPanel;
+    ComboBox: TSpTBXComboBox;
+
+  public
+    NameList: TStringList;
+    KeyList: TStringList;
+    DescriptionList: TStringList;
+    constructor Create;
+    function GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;override;
+    procedure SetValue(v: String);override;
+    procedure Enable;override;
+    procedure Disable;override;
+    procedure setToDefault();override;
+    function isDefault:Boolean;override;
+    function toString:String;override;
+    function nameToString:String;
+    function getDescription:string;override;
+    destructor Destroy; override;
+  end;
+
 function InitLib: Boolean;
 function ReInitLib: Boolean;
 function ReInitLibWithDialog: Boolean; // uses InitWaitForm to (re)initialize library
@@ -62,8 +188,12 @@
 function GetUnitBitmap(unitName: string):TBitmap;
 procedure ReloadUnitList; // will populate UnitNames and UnitList lists
 procedure ReloadSides; // populates SideList list and loads side images into SideImageList
-procedure LoadLuaOptions(modOptions: Boolean; mapName: String);
+procedure DisplayLuaOptions(luaOptionList: TList; tabSheet: TWinControl);
+procedure LoadModOptions;
+procedure LoadMapOptions(mapName: string);
+procedure LoadLuaOptions(var list:TList; nb: integer; keyPrefix: String; modOptions: bool=False);
 procedure UnLoadLuaOptions(luaOptionList: TList);
+function GetLuaOption(optList: TList;key: string): TLuaOption;
 {function GetLuaAIList:TStrings;}
 function GetModValidMapList: TStringList;
 function GetMapArchive(mapName: String):String;
@@ -143,7 +273,7 @@
 {since 0.79}function GetInfoKey(index: integer): PChar; stdcall; external 'UnitSync.dll' name 'GetInfoKey';
 {since 0.79}function GetInfoValue(index: integer): PChar; stdcall; external 'UnitSync.dll' name 'GetInfoValue';
 {since 0.79}function GetInfoDescription(index: integer): PChar; stdcall; external 'UnitSync.dll' name 'GetInfoDescription';
-{since 0.79}function GetSkirmishAIOptionCount(index: integer): PChar; stdcall; external 'UnitSync.dll' name 'GetSkirmishAIOptionCount';
+{since 0.79}function GetSkirmishAIOptionCount(index: integer): Integer; stdcall; external 'UnitSync.dll' name 'GetSkirmishAIOptionCount';
 {------------------------------------------------------------------------------}
 {since 0.76}function GetMapOptionCount(mapName: PChar): Integer; stdcall; external 'UnitSync.dll' name 'GetMapOptionCount';
 {since 0.76}function GetModOptionCount: Integer; stdcall; external 'UnitSync.dll' name 'GetModOptionCount';
@@ -759,45 +889,36 @@
   sl2.Free;
 end;
 
-procedure LoadLuaOptions(modOptions: Boolean; mapName: String);
+procedure DisplayLuaOptions(luaOptionList: TList; tabSheet: TWinControl);
 var
+  i: Integer;
+  c: TWinControl;
+begin
+  for i:=0 to luaOptionList.Count -1 do
+  begin
+    c := TLuaOption(luaOptionList[i]).GetComponent(tabSheet,luaOptionList);
+    c.Align := alBottom;
+    c.Align := alTop;
+    if (BattleState.Status = Joined) then
+      TLuaOption(luaOptionList[i]).Disable
+    else
+      TLuaOption(luaOptionList[i]).Enable;
+  end;
+  // hide empty sections
+  for i:=0 to luaOptionList.Count-1 do
+    if TLuaOption(luaOptionList[i]).ClassType = TLuaOptionSection then
+      TLuaOptionSection(luaOptionList[i]).Panel.Visible := TLuaOptionSection(luaOptionList[i]).Panel.ControlCount &gt; 0;
+end;
+
+procedure LoadLuaOptions(var list:TList; nb: integer; keyPrefix: String; modOptions: bool=False);
+var
   i,j:integer;
   o: ^TLuaOption;
-  nb: integer;
   lKey: string;
   tmp: string;
 begin
-  if modOptions then
+  if nb &gt; 0 then
   begin
-    UnLoadLuaOptions(BattleForm.ModOptionsList);
-    nb := GetModOptionCount;
-  end
-  else
-  begin
-    UnLoadLuaOptions(BattleForm.MapOptionsList);
-    nb := GetMapOptionCount(PChar(mapName));
-  end;
-
-
-  // first we hide the engine options
-  if modOptions then
-  begin
-    with BattleForm do
-    begin
-      lblMetal.Visible := False;
-      lblEnergy.Visible := False;
-      lblUnits.Visible := False;
-      MetalTracker.Visible := False;
-      EnergyTracker.Visible := False;
-      UnitsTracker.Visible := False;
-      ResourcesGroupBox.Visible := False;
-      GameEndRadioGroup.Visible := False;
-    end;
-  end;
-
-  // default section
-  if (nb &gt; 0) then
-  begin
     New(o);
     o^ := TLuaOptionSection.Create;
     o^.Key := '__defaultSection__';
@@ -805,17 +926,9 @@
     o^.Description := '';
     o^.Section := '';
     o^.hasChanged := False;
-    if modOptions then
-    begin
-      BattleForm.ModOptionsList.Add(o^);
-    end
-    else
-    begin
-      BattleForm.MapOptionsList.Add(o^);
-    end;
+    list.Add(o^);
   end;
 
-
   for i:=0 to nb-1 do
   begin
     if modOptions then
@@ -959,18 +1072,43 @@
     o^.Description := StrNew(GetOptionDesc(i));
     o^.Section := StrNew(GetOptionSection(i));
     o^.hasChanged := False;
-    if modOptions then
-    begin
-      o^.KeyPrefix := 'GAME/MODOPTIONS/';
-      BattleForm.ModOptionsList.Add(o^);
-    end
-    else
-    begin
-      o^.KeyPrefix := 'GAME/MAPOPTIONS/';
-      BattleForm.MapOptionsList.Add(o^);
-    end;
+    o^.KeyPrefix := keyPrefix;
+    list.Add(o^);
   end;
 end;
+
+procedure LoadModOptions;
+var
+  o: ^TLuaOption;
+  nb: integer;
+begin
+  // first we hide the engine options
+  with BattleForm do
+  begin
+    lblMetal.Visible := False;
+    lblEnergy.Visible := False;
+    lblUnits.Visible := False;
+    MetalTracker.Visible := False;
+    EnergyTracker.Visible := False;
+    UnitsTracker.Visible := False;
+    ResourcesGroupBox.Visible := False;
+    GameEndRadioGroup.Visible := False;
+  end;
+
+  UnLoadLuaOptions(BattleForm.ModOptionsList);
+
+  LoadLuaOptions(BattleForm.ModOptionsList,GetModOptionCount,'GAME/MODOPTIONS/',True);
+end;
+
+procedure LoadMapOptions(mapName: string);
+var
+  o: ^TLuaOption;
+begin
+  UnLoadLuaOptions(BattleForm.MapOptionsList);
+
+  LoadLuaOptions(BattleForm.MapOptionsList,GetMapOptionCount(PChar(mapName)),'GAME/MAPOPTIONS/',False);
+end;
+
 procedure UnLoadLuaOptions(luaOptionList: TList);
 var
   i: Integer;
@@ -1229,7 +1367,636 @@
   end;
 end;
 
+constructor TLuaOptionList.Create;
+begin
+    NameList := TStringList.Create;
+    DescriptionList := TStringList.Create;
+    KeyList := TStringList.Create;
+end;
 
+procedure TLuaOption.MakeDescriptionButton(AOwner: TWinControl);
+begin
+  if DescriptionButton = nil then
+  begin
+    DescriptionButton := TSpTBXButton.Create(AOwner);
+    DescriptionButton.Parent := AOwner;
+    DescriptionButton.Caption := '?';
+    DescriptionButton.Width := 17;
+    DescriptionButton.Height := 20;
+    DescriptionButton.Left := 365;
+    DescriptionButton.ParentColor := false;
+    DescriptionButton.Anchors := [akRight,akTop];
+    DescriptionButton.OnClick := OnDescriptionButtonClick;
+  end;
+end;
+function TLuaOption.GetSectionPanel(luaOptionList: TList): TSpTBXGroupBox;
+var
+  i : integer;
+begin
+  Result := nil;
+  if Section = '' then
+    Section := '__defaultSection__';
+
+  for i:=0 to luaOptionList.Count-1 do
+  begin
+    if TLuaOption(luaOptionList[i]).ClassType = TLuaOptionSection then
+      if LowerCase(TLuaOptionSection(luaOptionList[i]).Key) = LowerCase(Section) then
+      begin
+        Result := TLuaOptionSection(luaOptionList[i]).Panel;
+        Exit;
+      end;
+    if TLuaOption(luaOptionList[i]).ClassType = TLuaOptionSection then
+      if LowerCase(TLuaOptionSection(luaOptionList[i]).Key) = LowerCase('__defaultSection__') then
+        Result := TLuaOptionSection(luaOptionList[i]).Panel;
+  end;
+end;
+procedure TLuaOption.OnDescriptionButtonClick(Sender: TObject);
+begin
+  MessageDlg(Self.Name + ' : ' + Self.getDescription,mtInformation,[mbOk],0);
+end;
+function TLuaOption.getDescription:string;
+begin
+  result := Self.Description;
+end;
+
+function TLuaOptionList.getDescription:string;
+var
+  msg: String;
+  i: integer;
+begin
+  for i:=0 to DescriptionList.Count-1 do
+    msg := msg + EOL + '     ' + NameList[i] + ' = ' + DescriptionList[i];
+  Result := Self.Description+EOL+msg;
+end;
+
+function TLuaOption.GetComponent(AOwner: TWinControl;luaOptionList: TList): TWinControl;
+var
+  sec: TSpTBXGroupBox;
+begin
+  if LabelName = nil then
+  begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+    end;
+
+    AOwner.Height := AOwner.Height + 18;
+
+    LabelName := TSpTBXLabel.Create(AOwner);
+    LabelName.Parent := AOwner;
+    LabelName.Caption := Name + ' : Unknown option type';
+    LabelName.Font.Color := Colors.Error;
+    LabelName.AutoSize := True;
+    LabelName.Font.Style := [];
+  end;
+  Result := LabelName;
+end;
+
+function TLuaOptionString.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
+var
+  sec: TSpTBXGroupBox;
+begin
+  if Panel = nil then
+  begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+    end;
+
+    AOwner.Height := AOwner.Height + 23;
+
+    Panel := TSpTBXPanel.Create(AOwner);
+    Panel.Parent := AOwner;
+    Panel.Borders := False;
+    //Panel.AutoSize := True;
+    Panel.Height := 23;
+    Panel.Width := 386;
+
+    LabelName := TSpTBXLabel.Create(Panel);
+    LabelName.Parent := Panel;
+    LabelName.Caption := Name + ' :';
+    LabelName.AutoSize := True;
+    LabelName.Left := 8;
+    LabelName.Top := 3;
+    LabelName.Width := 180;
+    LabelName.Hint := Description;
+    LabelName.ShowHint := True;
+    LabelName.ParentFont := False;
+    LabelName.Font.Style := [];
+
+    InputEdit := TSpTBXEdit.Create(Panel);
+    InputEdit.Parent := Panel;
+    InputEdit.Left := 188;
+    InputEdit.Top := 0;
+    InputEdit.MaxLength := MaxStringLength;
+    InputEdit.Hint := Description;
+    InputEdit.ShowHint := True;
+    InputEdit.Width := 170;
+    InputEdit.Text := DefaultValue;
+    InputEdit.OnExit := self.OnChange;
+    InputEdit.Anchors := [akLeft,akTop,akRight];
+    InputEdit.SkinType := sknSkin;
+    InputEdit.Color := SkinManager.CurrentSkin.Options(skncEditFrame,sknsNormal).Body.Color1;
+    InputEdit.Font.Color := SkinManager.CurrentSkin.GetTextColor(skncEditFrame,sknsNormal);
+
+    
+
+    MakeDescriptionButton(Panel);
+  end;
+  Result := Panel;
+end;
+
+function TLuaOptionNumber.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
+var
+  sec: TSpTBXGroupBox;
+begin
+  if Panel = nil then
+  begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+    end;
+
+    AOwner.Height := AOwner.Height + 20;
+
+    Panel := TSpTBXPanel.Create(AOwner);
+    Panel.Parent := AOwner;
+    Panel.Borders := False;
+    //Panel.AutoSize := True;
+    Panel.Height := 23;
+    Panel.Width := 386;
+
+    LabelName := TSpTBXLabel.Create(Panel);
+    LabelName.Parent := Panel;
+    LabelName.Caption := Name + ' :';
+    LabelName.AutoSize := True;
+    LabelName.Left := 8;
+    LabelName.Top := 3;
+    LabelName.Width := 180;
+    LabelName.Hint := Description;
+    LabelName.ShowHint := True;
+    LabelName.ParentFont := False;
+    LabelName.Font.Style := [];
+
+    InputEdit := TJvSpinEdit.Create(Panel);
+    InputEdit.Parent := Panel;
+    InputEdit.ButtonKind := bkStandard;
+    InputEdit.BorderStyle := bsSingle;
+    InputEdit.ValueType := vtFloat;
+    InputEdit.CheckMinValue := True;
+    InputEdit.CheckMaxValue := True;
+    InputEdit.CheckOptions := [coCheckOnExit,coCropBeyondLimit];
+    InputEdit.MaxValue := MaxValue;
+    InputEdit.MinValue := MinValue;
+    if StepValue &lt;= 0 then
+    begin
+      InputEdit.ShowButton := False;
+      InputEdit.Increment := 0.0000000001;
+      InputEdit.Decimal := 10;
+    end
+    else
+    begin
+      InputEdit.Increment := StepValue;
+      InputEdit.Decimal := 4;
+    end;
+    InputEdit.Value := StrToFloat(DefaultValue);
+    InputEdit.Hint := Description;
+    InputEdit.ShowHint := True;
+    InputEdit.Width := 170;
+    InputEdit.OnExit := self.OnChange;
+    InputEdit.Left := 188;
+    InputEdit.Top := 0;
+    InputEdit.Color := SkinManager.CurrentSkin.Options(skncEditFrame,sknsNormal).Body.Color1;
+    InputEdit.Font.Color := SkinManager.CurrentSkin.GetTextColor(skncEditFrame,sknsNormal);
+    InputEdit.Anchors := [akLeft,akTop,akRight];
+
+    MakeDescriptionButton(Panel);
+  end;
+  Result := Panel;
+end;
+
+function TLuaOptionBool.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
+var
+  sec: TSpTBXGroupBox;
+begin
+  if Panel = nil then
+  begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+    end;
+
+    AOwner.Height := AOwner.Height + 20;
+
+    Panel := TSpTBXPanel.Create(AOwner);
+    Panel.Parent := AOwner;
+    Panel.Borders := False;
+    //Panel.AutoSize := True;
+    Panel.Height := 23;
+    Panel.Width := 386;
+
+    LabelName := TSpTBXLabel.Create(Panel);
+    LabelName.Parent := Panel;
+    LabelName.Caption := Name + ' :';
+    LabelName.Left := 8;
+    LabelName.Top := 3;
+    LabelName.Width := 180;
+    LabelName.Hint := Description;
+    LabelName.ShowHint := True;
+    LabelName.ParentFont := False;
+    LabelName.Font.Style := [];
+  
+    CheckBox := TSpTBXCheckBox.Create(Panel);
+    CheckBox.Parent := Panel;
+    CheckBox.Left := 188;
+    CheckBox.Top := 3;
+    CheckBox.AutoSize := False;
+    CheckBox.Caption := '';
+    CheckBox.Height := 15;
+    CheckBox.Hint := Description;
+    CheckBox.ShowHint := True;
+    CheckBox.Checked := StrToBool(DefaultValue);
+    CheckBox.OnClick := self.OnChange;
+
+    MakeDescriptionButton(Panel);
+  end;
+  Result := Panel;
+end;
+
+function TLuaOptionSection.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
+begin
+  if Panel = nil then
+  begin
+    Panel := TSpTBXGroupBox.Create(AOwner);
+    Panel.Parent := AOwner;
+    Panel.Height := 23;
+    Panel.Caption := Name;
+    Panel.ShowHint := True;
+    Panel.Hint := Description;
+    Panel.Font.Style := [fsBold];
+    Panel.TBXStyleBackground := True;
+    //MakeDescriptionButton(Panel);
+  end;
+  Result := Panel;
+end;
+
+function TLuaOptionList.GetComponent(AOwner: TWinControl;luaOptionList: TList):TWinControl;
+var
+  i: integer;
+  sec: TSpTBXGroupBox;
+begin
+  if Panel = nil then
+  begin
+    sec := GetSectionPanel(luaOptionList);
+
+    if sec &lt;&gt; nil then
+    begin
+      AOwner := sec;
+    end;
+
+    AOwner.Height := AOwner.Height + 23;
+
+    Panel := TSpTBXPanel.Create(AOwner);
+    Panel.Parent := AOwner;
+    Panel.Borders := False;
+    //Panel.AutoSize := True;
+    Panel.Height := 23;
+    Panel.Width := 386;
+
+    LabelName := TSpTBXLabel.Create(Panel);
+    LabelName.Parent := Panel;
+    LabelName.Caption := Name + ' :';
+    LabelName.Align := alNone;
+    LabelName.AutoSize := True;
+    LabelName.Left := 8;
+    LabelName.Top := 3;
+    LabelName.Width := 180;
+    LabelName.Hint := Description;
+    LabelName.ShowHint := True;
+    LabelName.ParentFont := False;
+    LabelName.Font.Style := [];
+
+    ComboBox := TSpTBXComboBox.Create(Panel);
+    ComboBox.Parent := Panel;
+    ComboBox.Style := csDropDownList;
+    ComboBox.Top := 0;
+    ComboBox.Width := 170;
+    ComboBox.Height := 21;
+    ComboBox.Items.Assign(NameList);
+    ComboBox.ItemIndex := Max(0,KeyList.IndexOf(DefaultValue));
+    ComboBox.Left := 188;
+    ComboBox.Hint := Description;
+    ComboBox.ShowHint := True;
+    ComboBox.Color := SkinManager.CurrentSkin.Options(skncEditFrame,sknsNormal).Body.Color1;
+    ComboBox.Font.Color := SkinManager.CurrentSkin.GetTextColor(skncEditFrame,sknsNormal);
+    ComboBox.OnChange := self.OnChange;
+    ComboBox.Anchors := [akLeft,akTop,akRight];
+
+    MakeDescriptionButton(Panel);
+  end;
+  Result := Panel;
+end;
+
+function TLuaOption.toString:String;
+begin
+  Result := Value;
+end;
+
+function TLuaOptionNumber.toString:String;
+begin
+  Result := InputEdit.Text;
+end;
+
+function TLuaOptionString.toString:String;
+begin
+  Result := InputEdit.Text;
+end;
+
+function TLuaOptionList.toString:String;
+begin
+  Result := KeyList[ComboBox.ItemIndex];
+end;
+function TLuaOptionList.nameToString:String;
+begin
+  Result := NameList[ComboBox.ItemIndex];
+end;
+
+function TLuaOptionBool.toString:String;
+begin
+  Result := IntToStr(BoolToInt(CheckBox.Checked));
+end;
+
+function TLuaOptionSection.toString:String;
+begin
+  Result := '';
+end;
+
+procedure TLuaOption.OnChange(Sender: TObject);
+begin
+  if (BattleState.Status = Hosting) and AllowBattleDetailsUpdate then
+  begin
+    MainForm.TryToSendCommand('SETSCRIPTTAGS', KeyPrefix+Key+'='+Self.toString);
+  end;
+  Value := Self.toString;
+end;
+
+function TLuaOption.toSetScriptTagsString:String;
+begin
+  Result := KeyPrefix+Key+'='+Self.toString;
+end;
+
+procedure TLuaOptionNumber.OnChange(Sender: TObject);
+begin
+  if StepValue &lt;= 0 then
+  begin
+    inherited OnChange(Sender)
+  end
+  else
+  begin
+    InputEdit.Text := FloatToStr(Round(StrToFloat(InputEdit.Text) / StepValue)*StepValue);
+    inherited OnChange(Sender);
+  end;
+end;
+
+function TLuaOptionNumber.toSetScriptTagsString:String;
+begin
+  if StepValue &lt;= 0 then
+  begin
+    inherited toSetScriptTagsString;
+  end
+  else
+  begin
+    InputEdit.Text := FloatToStr(Round(StrToFloat(InputEdit.Text) / StepValue)*StepValue);
+    inherited toSetScriptTagsString;
+  end;
+end;
+
+procedure TLuaOption.SetValue(v: String);
+begin
+  hasChanged := hasChanged or (Value &lt;&gt; v);
+  Value := v;
+  if hasChanged then
+    BattleForm.RefreshQuickLookText;
+end;
+
+procedure TLuaOption.setToDefault;
+begin
+  hasChanged := hasChanged or (Value &lt;&gt; DefaultValue);
+  Value := DefaultValue;
+  if hasChanged then
+    BattleForm.RefreshQuickLookText;
+end;
+
+function TLuaOption.isDefault:Boolean;
+begin
+  Result := DefaultValue = Value;
+end;
+
+procedure TLuaOptionString.SetValue(v: String);
+begin
+  inherited;
+  InputEdit.Text := v;
+end;
+
+procedure TLuaOptionString.setToDefault;
+begin
+  inherited;
+  InputEdit.Text := DefaultValue;
+end;
+
+function TLuaOptionString.isDefault:Boolean;
+begin
+  Result := InputEdit.Text = DefaultValue;
+end;
+
+procedure TLuaOptionList.SetValue(v: String);
+begin
+  inherited;
+  ComboBox.ItemIndex := Max(0,KeyList.IndexOf(v));
+end;
+
+procedure TLuaOptionList.setToDefault;
+begin
+  inherited;
+  ComboBox.ItemIndex := Max(0,KeyList.IndexOf(DefaultValue));
+end;
+
+function TLuaOptionList.isDefault:Boolean;
+begin
+  Result := Max(0,KeyList.IndexOf(DefaultValue)) = ComboBox.ItemIndex;
+end;
+
+procedure TLuaOptionBool.SetValue(v: String);
+begin
+  inherited;
+  CheckBox.Checked := StrToBool(v);
+end;
+
+procedure TLuaOptionSection.setToDefault;
+begin
+end;
+
+function TLuaOptionSection.isDefault:Boolean;
+begin
+  Result := True;
+end;
+
+procedure TLuaOptionSection.SetValue(v: String);
+begin
+end;
+
+procedure TLuaOptionBool.setToDefault;
+begin
+  inherited;
+  CheckBox.Checked := StrToBool(DefaultValue);
+end;
+
+function TLuaOptionBool.isDefault:Boolean;
+begin
+  Result := StrToBool(DefaultValue) = CheckBox.Checked;
+end;
+
+
+procedure TLuaOptionNumber.SetValue(v: String);
+begin
+  inherited;
+  InputEdit.Text := v;
+end;
+
+procedure TLuaOptionNumber.setToDefault;
+begin
+  inherited;
+  InputEdit.Value := StrToFloat(DefaultValue);
+end;
+
+function TLuaOptionNumber.isDefault:Boolean;
+begin
+  Result := RoundTo(InputEdit.Value,-5) = RoundTo(StrToFloat(DefaultValue),-5);
+end;
+
+procedure TLuaOption.Enable;
+begin
+  // nothing
+end;
+procedure TLuaOption.Disable;
+begin
+  // nothing
+end;
+
+procedure TLuaOptionString.Enable;
+begin
+  LabelName.Enabled := True;
+  InputEdit.Enabled := True;
+end;
+procedure TLuaOptionString.Disable;
+begin
+  LabelName.Enabled := False;
+  InputEdit.Enabled := False;
+end;
+
+procedure TLuaOptionList.Enable;
+begin
+  LabelName.Enabled := True;
+  ComboBox.Enabled := True;
+end;
+procedure TLuaOptionList.Disable;
+begin
+  LabelName.Enabled := False;
+  ComboBox.Enabled := False;
+end;
+
+procedure TLuaOptionBool.Enable;
+begin
+  LabelName.Enabled := True;
+  CheckBox.Enabled := True;
+end;
+procedure TLuaOptionBool.Disable;
+begin
+  LabelName.Enabled := False;
+  CheckBox.Enabled := False;
+end;
+
+procedure TLuaOptionSection.Enable;
+begin
+  //Panel.Enabled := True;
+end;
+procedure TLuaOptionSection.Disable;
+begin
+  //Panel.Enabled := False;
+end;
+
+procedure TLuaOptionNumber.Enable;
+begin
+  LabelName.Enabled := True;
+  InputEdit.Enabled := True;
+end;
+procedure TLuaOptionNumber.Disable;
+begin
+  LabelName.Enabled := False;
+  InputEdit.Enabled := False;
+end;
+
+destructor TLuaOption.Destroy;
+begin
+  inherited Destroy;
+end;
+
+destructor TLuaOptionList.Destroy;
+begin
+  NameList.Free;
+  DescriptionList.Free;
+  inherited Destroy;
+  Panel.Destroy;
+end;
+
+destructor TLuaOptionString.Destroy;
+begin
+  inherited Destroy;
+  Panel.Destroy;
+end;
+
+destructor TLuaOptionNumber.Destroy;
+begin
+  inherited Destroy;
+  Panel.Destroy;
+end;
+
+destructor TLuaOptionBool.Destroy;
+begin
+  inherited Destroy;
+  Panel.Destroy;
+end;
+
+destructor TLuaOptionSection.Destroy;
+begin
+  inherited Destroy;
+  Panel.Destroy;
+end;
+
+function GetLuaOption(optList: TList;key: string): TLuaOption;
+var
+  i: Integer;
+begin
+  Result := nil;
+  for i:=0 to optList.Count-1 do
+  begin
+    if LowerCase(TLuaOption(optList[i]).Key) = LowerCase(key) then
+    begin
+      Result := TLuaOption(optList[i]);
+      Exit;
+    end;
+  end;
+end;
+
+
 { ------------------------------------------------------------------------ }
 
 initialization


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="002254.html">[Taspring-linux-commit] r7484 - in Lobby/TASClient: . Python/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2253">[ date ]</a>
              <a href="thread.html#2253">[ thread ]</a>
              <a href="subject.html#2253">[ subject ]</a>
              <a href="author.html#2253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
