<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7458 - Lobby/TASClient
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2010-April/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7458%20-%20Lobby/TASClient&In-Reply-To=%3C20100404214342.1C8DB23D20%40it-l.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002227.html">
   <LINK REL="Next"  HREF="002229.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7458 - Lobby/TASClient</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7458%20-%20Lobby/TASClient&In-Reply-To=%3C20100404214342.1C8DB23D20%40it-l.eu%3E"
       TITLE="[Taspring-linux-commit] r7458 - Lobby/TASClient">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sun Apr  4 23:43:41 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002227.html">[Taspring-linux-commit] r7457 - in Lobby/TASClient: . Graphics
</A></li>
        <LI>Next message: <A HREF="002229.html">[Taspring-linux-commit] r7459 - in Lobby/TASClient: . Graphics	Python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2228">[ date ]</a>
              <a href="thread.html#2228">[ thread ]</a>
              <a href="subject.html#2228">[ subject ]</a>
              <a href="author.html#2228">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2010-04-04 23:43:41 +0200 (Sun, 04 Apr 2010)
New Revision: 7458

Modified:
   Lobby/TASClient/HostBattleFormUnit.dfm
   Lobby/TASClient/HostBattleFormUnit.pas
   Lobby/TASClient/HttpGetUnit.dfm
   Lobby/TASClient/LogonFormUnit.dfm
   Lobby/TASClient/LogonFormUnit.pas
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/PreferencesFormUnit.dfm
   Lobby/TASClient/PreferencesFormUnit.pas
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.res
Log:
* ladder code removed

Modified: Lobby/TASClient/HostBattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/HostBattleFormUnit.dfm	2010-04-04 21:03:19 UTC (rev 7457)
+++ Lobby/TASClient/HostBattleFormUnit.dfm	2010-04-04 21:43:41 UTC (rev 7458)
@@ -167,42 +167,13 @@
       Caption = 'Auto send description in battle when a player join'
       TabOrder = 17
     end
-    object LadderComboBox: TSpTBXComboBox
-      Left = 16
-      Top = 104
-      Width = 401
-      Height = 22
-      Style = csOwnerDrawFixed
-      ItemHeight = 16
-      TabOrder = 18
-      Visible = False
-      OnChange = LadderComboBoxChange
-    end
-    object SpTBXLabel1: TSpTBXLabel
-      Left = 16
-      Top = 88
-      Width = 39
-      Height = 13
-      Caption = 'Ladder :'
-      Visible = False
-    end
-    object RefreshButton: TSpTBXButton
-      Left = 312
-      Top = 128
-      Width = 105
-      Height = 25
-      Caption = 'Refresh'
-      TabOrder = 20
-      Visible = False
-      OnClick = RefreshButtonClick
-    end
     object RefreshModListButton: TSpTBXButton
       Left = 16
       Top = 200
       Width = 113
       Height = 21
       Caption = 'Refresh mod list'
-      TabOrder = 21
+      TabOrder = 18
       OnClick = RefreshModListButtonClick
     end
     object RelayHostCheckBox: TSpTBXCheckBox
@@ -211,14 +182,14 @@
       Width = 68
       Height = 15
       Caption = 'Relay host'
-      TabOrder = 22
+      TabOrder = 19
     end
     object PlayersTracker: TSpTBXSpinEdit
       Left = 16
       Top = 56
       Width = 49
       Height = 21
-      TabOrder = 23
+      TabOrder = 20
       SpinButton.Left = 30
       SpinButton.Top = 0
       SpinButton.Width = 15
@@ -232,7 +203,7 @@
       Width = 105
       Height = 25
       Caption = 'Host battle'
-      TabOrder = 24
+      TabOrder = 21
       OnClick = HostButtonClick
     end
     object HostTypeButton: TSpTBXButton
@@ -240,7 +211,7 @@
       Top = 344
       Width = 18
       Height = 25
-      TabOrder = 25
+      TabOrder = 22
       DropDownMenu = HostPopupMenu
     end
   end
@@ -272,13 +243,6 @@
       RadioItem = True
       OnClick = Host1Click
     end
-    object mnuHostLadder: TSpTBXItem
-      Caption = 'Host a ladder game'
-      GroupIndex = 1
-      RadioItem = True
-      Visible = False
-      OnClick = HostLadder1Click
-    end
     object mnuHostReplay: TSpTBXItem
       Caption = 'Host a replay'
       GroupIndex = 1

Modified: Lobby/TASClient/HostBattleFormUnit.pas
===================================================================
--- Lobby/TASClient/HostBattleFormUnit.pas	2010-04-04 21:03:19 UTC (rev 7457)
+++ Lobby/TASClient/HostBattleFormUnit.pas	2010-04-04 21:43:41 UTC (rev 7458)
@@ -30,10 +30,7 @@
     NATRadioGroup: TSpTBXRadioGroup;
     CancelButton: TSpTBXButton;
     AutoSendDescCheckbox: TSpTBXCheckBox;
-    LadderComboBox: TSpTBXComboBox;
-    SpTBXLabel1: TSpTBXLabel;
     HttpCli1: THttpCli;
-    RefreshButton: TSpTBXButton;
     RefreshModListButton: TSpTBXButton;
     RelayHostCheckBox: TSpTBXCheckBox;
     PlayersTracker: TSpTBXSpinEdit;
@@ -41,11 +38,10 @@
     HostTypeButton: TSpTBXButton;
     HostPopupMenu: TSpTBXPopupMenu;
     mnuHost: TSpTBXItem;
-    mnuHostLadder: TSpTBXItem;
     mnuHostReplay: TSpTBXItem;
 
     procedure CreateParams(var Params: TCreateParams); override;
-    procedure TryToHostBattle(ladderIndex: integer);
+    procedure TryToHostBattle;
     procedure TryToHostReplay;    
 
     procedure CancelButtonClick(Sender: TObject);
@@ -57,10 +53,6 @@
     procedure NATRadioGroupClick(Sender: TObject);
     procedure RefreshModListButtonClick(Sender: TObject);
     procedure HostButtonClick(Sender: TObject);
-    procedure HostLadder1Click(Sender: TObject);
-    procedure ApplyLadderParams(ladder: TLadder);
-    procedure RefreshButtonClick(Sender: TObject);
-    procedure LadderComboBoxChange(Sender: TObject);
     procedure RankComboBoxDrawItem(Sender: TObject; ACanvas: TCanvas;
       var ARect: TRect; Index: Integer; const State: TOwnerDrawState;
       const PaintStage: TSpTBXPaintStage; var PaintDefault: Boolean);
@@ -74,27 +66,6 @@
     relayHostPassword: string;
     replay: TReplay;
   end;
-  TLadderListThread = class(TTASClientThread)
-  private
-    DownloadLadderDetailsIndex : integer;
-    DownloadAllRulesAtOnce : boolean;
-    StatusMsg: string;
-    procedure Initialize;
-    procedure Finalize;
-    procedure PopulateMenu;
-    procedure Refresh;
-    function DownloadLadderDetails(ladderIndex : integer):boolean;
-    function DownloadAllLadderDetails: boolean;
-    procedure ShowMessageStatus;
-    procedure UpdateMessageStatus(msg : string);
-    procedure OnTerminateProcedure(Sender : TObject);
-
-  protected
-    procedure Execute; override;
-    
-  public
-    constructor Create(Suspended : Boolean;ladderIndex: integer; getAllRulesAtOnce: boolean);
-  end;
 var
   HostBattleForm: THostBattleForm;
   BattleReplayScript: string;
@@ -133,15 +104,13 @@
 procedure THostBattleForm.CancelButtonClick(Sender: TObject);
 begin
   HostButton.Enabled := True;
-  RefreshButton.Enabled := True;
   Close;
 end;
 
-procedure THostBattleForm.TryToHostBattle(ladderIndex: integer);
+procedure THostBattleForm.TryToHostBattle;
 var
   i,j: Integer;
   s: WideString;
-  CheckPasswordThread : TLadderCheckAccountThread;
 begin
   try
     i := StrToInt(Trim(PortEdit.Text));
@@ -262,10 +231,7 @@
   // NAT traversal method type:
   s := s + IntToStr(NATRadioGroup.ItemIndex) + ' ';
   // password (must be &quot;*&quot; for none):
-  if ladderIndex &gt; -1 then
-    s := s + LADDER_BATTLE_PASSWORD + ' '
-  else
-    if PasswordEdit.Text = '' then s := s + '* ' else s := s + PasswordEdit.Text + ' ';
+  if PasswordEdit.Text = '' then s := s + '* ' else s := s + PasswordEdit.Text + ' ';
   // port:
   if NATRadioGroup.ItemIndex = 1 then s := s + IntToStr(NATTraversal.MyPublicUDPSourcePort) + ' '
   else s := s + Trim(PortEdit.Text) + ' ';
@@ -301,9 +267,6 @@
   // map:
   s := s + Utility.MapList[BattleForm.CurrentMapIndex] + #9;
   // title (description):
-  if ladderIndex &gt;= 0 then
-    s := s + '(ladder '+IntToStr(TLadder(LadderList[ladderIndex]).id)+') '+TLadder(LadderList[ladderIndex]).Name+#9
-  else
     if TitleEdit.Text = '' then
       s := s + '(none)' + #9
     else
@@ -311,11 +274,6 @@
   // name of mod:
   s := s + ModsComboBox.Text;
 
-  BattleState.LadderIndex := ladderIndex;
-
-  if ladderIndex &gt;=0 then
-    CheckPasswordThread := TLadderCheckAccountThread.Create(False,Preferences.LadderPassword,true);
-
   // send the command:
   if RelayHostCheckBox.Checked then
   begin
@@ -508,8 +466,6 @@
   HostBattleForm.ModsComboBox.ItemIndex := Max(0, HostBattleForm.ModsComboBox.Items.IndexOf(s));
   if HostButtonMenuIndex = 0 then
     Host1Click(mnuHost)
-  else if HostButtonMenuIndex = 1 then
-    HostLadder1Click(mnuHostLadder)
   else if HostButtonMenuIndex = 2 then
     HostReplay1Click(mnuHostReplay);
   HostButtonMenuIndex := 0;
@@ -534,9 +490,6 @@
   Label4.Visible := True;
   AutoSendDescCheckbox.Visible := True;
   TitleEdit.Visible := True;
-  SpTBXLabel1.Visible := False;
-  LadderComboBox.Visible := False;
-  RefreshButton.Visible := False;
 
   PlayersTracker.SpinOptions.MinValue := 2;
   PlayersTracker.SpinOptions.MaxValue := MAX_TEAMS;
@@ -568,8 +521,6 @@
   Label4.Visible := True;
   AutoSendDescCheckbox.Visible := True;
   TitleEdit.Visible := True;
-  SpTBXLabel1.Visible := False;
-  LadderComboBox.Visible := False;
 
   PlayersTracker.SpinOptions.MinValue := 2;
   PlayersTracker.SpinOptions.MaxValue := 16;
@@ -685,498 +636,11 @@
   end;
 
   if mnuHost.Checked then
-    TryToHostBattle(-1)
-  else if mnuHostLadder.Checked then
-    if LadderList.Count = 0 then
-      MessageDlg(_('You must select a ladder first !'),mtWarning,[mbOk],0)
-    else
-      if Preferences.LadderPassword = '' then
-        MessageDlg(_('You must enter your ladder password in the Options/Account first !'),mtWarning,[mbOk],0)
-      else
-        TryToHostBattle(LadderComboBox.ItemIndex)
+    TryToHostBattle
   else
     TryToHostReplay;
 end;
 
-  
-procedure THostBattleForm.HostLadder1Click(Sender: TObject);
-var
-  ThreadLL : TLadderListThread;
-begin
-  replay := nil;
-
-  RelayHostCheckBox.Visible := False;
-
-  ModsComboBox.Enabled := True;
-  RankComboBox.Enabled := True;
-
-  AutoSendDescCheckbox.Checked := False;
-  AutoSendDescCheckbox.Enabled := False;
-  TitleEdit.Enabled := False;
-  Label4.Enabled := False;
-
-  Label4.Visible := False;
-  AutoSendDescCheckbox.Visible := False;
-  TitleEdit.Visible := False;
-  SpTBXLabel1.Visible := True;
-  LadderComboBox.Visible := True;
-  RefreshButton.Visible := True;
-
-  Label3.Visible := False;
-  Label8.Visible := False;
-  PasswordEdit.Visible := False;
-
-  (Sender as TSpTBXItem).Checked := True;
-  HostButton.Caption := _('Host Ladder');
-
-  if LadderComboBox.Items.Count =0 then
-    ThreadLL := TLadderListThread.Create(False,-1,true)
-  else
-    ApplyLadderParams(TLadder(LadderList[LadderComboBox.ItemIndex]));
-end;
-
-procedure THostBattleForm.ApplyLadderParams(ladder: TLadder);
-var
-  i:integer;
-begin
-  if ladder.ModName &lt;&gt; '' then begin
-    if ladder.MinPlayersPerAllyTeam = ladder.MaxPlayersPerAllyTeam then begin
-      PlayersTracker.SpinOptions.MinValue := 2;
-      PlayersTracker.SpinOptions.MaxValue := MAX_TEAMS;
-      PlayersTracker.Value := ladder.MinPlayersPerAllyTeam*2;
-      PlayersTracker.Enabled := False;
-    end
-    else
-    begin
-      PlayersTracker.Enabled := true;
-      PlayersTracker.SpinOptions.MinValue := ladder.MinPlayersPerAllyTeam*2;
-      PlayersTracker.SpinOptions.MaxValue := ladder.MaxPlayersPerAllyTeam*2;
-    end;
-    ModsComboBox.Clear;
-    for i:=0 to Utility.ModList.Count-1 do
-      if Pos(ladder.ModName,Utility.ModList[i]) &gt; 0 then
-        ModsComboBox.Items.Add(Utility.ModList[i]);
-    ModsComboBox.ItemIndex := ModsComboBox.Items.Count-1;
-  end;
-end;
-
-constructor TLadderListThread.Create(Suspended : Boolean;ladderIndex: integer; getAllRulesAtOnce: boolean);
-begin
-   FreeOnTerminate := True;
-   inherited Create(Suspended);
-   OnTerminate := OnTerminateProcedure;
-   DownloadLadderDetailsIndex := ladderIndex;
-   DownloadAllRulesAtOnce := getAllRulesAtOnce;
-end;
-
-procedure TLadderListThread.Execute;
-begin
-  if DownloadLadderDetailsIndex &gt; -1 then begin
-    DownloadLadderDetails(DownloadLadderDetailsIndex);
-  end
-  else if DownloadALlRulesAtOnce then
-    DownloadAllLadderDetails
-  else
-    Refresh;
-end;
-
-procedure TLadderListThread.Initialize;
-begin
-  HostBattleForm.LadderComboBox.Clear;
-  HostBattleForm.LadderComboBox.Items.Add(_('Loading ladder list ...'));
-  HostBattleForm.LadderComboBox.ItemIndex := 0;
-  HostBattleForm.HostButton.Enabled := False;
-  HostBattleForm.RefreshButton.Enabled := False;
-end;
-
-procedure TLadderListThread.Finalize;
-begin
-  HostBattleForm.RefreshButton.Enabled := True;
-  HostBattleForm.HostButton.Enabled := True;
-end;
-
-procedure TLadderListThread.PopulateMenu;
-var
-  j: integer;
-begin
-  with HostBattleForm do
-  begin
-    LadderComboBox.Clear;
-    for j:=0 to LadderList.Count -1 do
-      LadderComboBox.Items.Add(TLadder(LadderList[j]).Name);
-    LadderComboBox.ItemIndex := 0;
-    ApplyLadderParams(TLadder(LadderList[0]));
-  end;
-end;
-
-
-procedure TLadderListThread.Refresh;
-var
-  i,j,k:integer;
-  html,laddername,ladderid:string;
-  parse1 : TStrings;
-  parse2 : TStrings;
-  ladder : ^TLadder;
-begin
-  parse1 := TStringList.Create;
-  //parse2 := TStringList.Create;
-  LadderList.Clear;
-
-  with HostBattleForm do begin
-
-    Synchronize(Initialize);
-
-    if Preferences.UseProxy then
-    begin
-      HttpCli1.Proxy := Preferences.ProxyAddress;
-      HttpCli1.ProxyPort := IntToStr(Preferences.ProxyPort);
-      HttpCli1.ProxyUsername := Preferences.ProxyUsername;
-      HttpCli1.ProxyPassword := Preferences.ProxyPassword
-    end
-    else HttpCli1.Proxy := '';
-    HttpCli1.URL := LADDER_PREFIX_URL + 'ladderlist.php';
-    HttpCli1.RcvdStream := TMemoryStream.Create;
-    try
-      HttpCli1.Get;
-    except
-      MainForm.AddMainLog(_('Error: Ladder server unavailable.'), Colors.Error);
-      UpdateMessageStatus(_('Error: Ladder server unavailable.'));
-      Synchronize(Finalize);
-      LadderList.Clear;
-      Exit;
-    end;
-    HttpCli1.RcvdStream.Seek(0,0);
-    SetLength(html, HttpCli1.RcvdStream.Size-1);
-    HttpCli1.RcvdStream.ReadBuffer(Pointer(html)^, HttpCli1.RcvdStream.Size-1);
-    HttpCli1.RcvdStream.Free;
-
-    // parse the html result
-    Misc.ParseDelimited(parse1,html,' ','');
-    if (parse1[0] = 'error') or (parse1[0] = 'notice') then
-    begin
-      parse1.Delete(0);
-      MessageDlgThread(Misc.JoinStringList(parse1,' '),mtError,[mbOK],0)
-    end
-    else
-    begin
-      parse1.Clear;
-      Misc.ParseDelimited(parse1,html,#$A,'');
-      for i:= 0 to parse1.Count -1 do // for each ladder
-        if parse1[i] &lt;&gt; '' then begin
-          k := Pos(' ',PChar(parse1[i]));
-          laddername := MidStr(parse1[i],k+1,50000000);
-          ladderid := Copy(parse1[i],1,k-1);
-          j:= 0;
-          while (j &lt;= LadderList.Count-1) and (TLadder(LadderList[j]).id &lt;&gt; StrToInt(ladderid)) do
-            j := j+1;
-          if j &gt; LadderList.Count-1 then begin
-            New(ladder);
-            ladder^ := TLadder.Create(StrToInt(ladderid),laddername);
-            LadderList.Add(ladder^);
-            if not DownloadLadderDetails(LadderList.indexof(ladder^)) then begin
-              MainForm.AddMainLog(_('Error: Ladder details download failed : ')+IntToStr(ladder^.id)+'.', Colors.Error);
-              UpdateMessageStatus(_('Error: Ladder details download failed : ')+IntToStr(ladder^.id)+'.');
-              Synchronize(Finalize);
-              Exit;
-            end;
-          end;
-        end;
-    end;
-
-    Synchronize(PopulateMenu);
-    parse1.Clear;
-    Synchronize(Finalize);
-  end;
-end;
-
-function TLadderListThread.DownloadLadderDetails(ladderIndex : integer): boolean;
-var
-  html:string;
-  parse1,parse2 : TStrings;
-  i,j,k : integer;
-  paramName,paramValue: string;
-begin
-  Result := True;
-  TLadder(LadderList[ladderIndex]).Rules := _('Downloading ladder details ...');
-  parse1 := TStringList.Create;
-  parse2 := TStringList.Create;
-  with HostBattleForm do begin
-    if Preferences.UseProxy then
-    begin
-      HttpCli1.Proxy := Preferences.ProxyAddress;
-      HttpCli1.ProxyPort := IntToStr(Preferences.ProxyPort);
-      HttpCli1.ProxyUsername := Preferences.ProxyUsername;
-      HttpCli1.ProxyPassword := Preferences.ProxyPassword
-    end
-    else HttpCli1.Proxy := '';
-    HttpCli1.URL := LADDER_PREFIX_URL + 'rules.php?ladder='+IntToStr(TLadder(LadderList[ladderIndex]).id);
-    HttpCli1.RcvdStream := TMemoryStream.Create;
-    try
-      HttpCli1.Get;
-    except
-      MainForm.AddMainLog(_('Error: Ladder details not available : ')+IntToStr(TLadder(LadderList[ladderIndex]).id), Colors.Error);
-      Exit;
-    end;
-    HttpCli1.RcvdStream.Seek(0,0);
-    SetLength(html, HttpCli1.RcvdStream.Size);
-    HttpCli1.RcvdStream.ReadBuffer(Pointer(html)^, HttpCli1.RcvdStream.Size);
-    HttpCli1.RcvdStream.Free;
-
-    // parse the html result
-    Misc.ParseDelimited(parse1,html,' ','');
-    if (parse1[0] = 'error') or (parse1[0] = 'notice') then
-    begin
-      parse1.Delete(0);
-      MessageDlgThread(Misc.JoinStringList(parse1,' '),mtError,[mbOK],0)
-    end
-    else
-    begin
-      parse1.Clear;
-      Misc.ParseDelimited(parse1,html,#$A,'');
-      with TLadder(LadderList[ladderIndex]) do begin
-      for i:=0 to parse1.Count-1 do
-        if parse1[i] &lt;&gt; '' then begin
-        try
-          k := Pos(' ',PChar(parse1[i]));
-          paramValue := MidStr(parse1[i],k+1,5000000);
-          paramName := Copy(parse1[i],1,k-1);
-          if paramValue = 'any' then
-            paramValue := '-1';
-          if paramName = 'mod' then
-            ModName := paramValue
-          else if paramName = 'min_players_per_allyteam' then
-            MinPlayersPerAllyTeam := StrToInt(paramValue)
-          else if paramName = 'max_players_per_allyteam' then
-            MaxPlayersPerAllyTeam := StrToInt(paramValue)
-          else if paramName = 'startpos' then
-            StartPos := StrToInt(paramValue)
-          else if paramName = 'gamemode' then
-            GameMode := StrToInt(paramValue)
-          else if paramName = 'dgun' then
-            DGun := StrToInt(paramValue)
-          else if paramName = 'ghost' then
-            Ghost := StrToInt(paramValue)
-          else if paramName = 'diminish' then
-            Diminish := StrToInt(paramValue)
-          else if paramName = 'metal' then
-            if paramValue &lt;&gt; '-1' then begin
-              Misc.ParseDelimited(parse2,paramValue,' ','');
-              MetalMin := Max(0,StrToInt(parse2[0]));
-              MetalMax := Min(10000,StrToInt(parse2[1]));
-            end
-            else
-              MetalMin := StrToInt(paramValue)
-          else if paramName = 'energy' then
-            if paramValue &lt;&gt; '-1' then begin
-              Misc.ParseDelimited(parse2,paramValue,' ','');
-              EnergyMin := Max(0,StrToInt(parse2[0]));
-              EnergyMax := Min(10000,StrToInt(parse2[1]));
-            end
-            else
-              EnergyMin := StrToInt(paramValue)
-          else if paramName = 'units' then
-            if paramValue &lt;&gt; '-1' then begin
-              Misc.ParseDelimited(parse2,paramValue,' ','');
-              UnitsMin := Max(10,StrToInt(parse2[0]));
-              UnitsMax := Min(5000,StrToInt(parse2[1]));
-            end
-            else
-              UnitsMin := StrToInt(paramValue)
-          else if paramName = 'rules' then
-            begin
-              Rules := paramValue;
-              for j:=i+1 to parse1.Count-1 do
-                Rules := Rules + parse1[j];
-              break;
-            end
-          else if paramName = 'restricted' then
-              if paramValue &lt;&gt; 'none' then
-                Misc.ParseDelimited(Restricted,paramValue,',','')
-        Except
-          MessageDlgThread(_('An error occured while parsing the ladder details !'),mtError,[mbOk],0);
-          Result := False;
-          Exit;
-        end;
-        end;
-        end;
-    end;
-    if TLadder(LadderList[ladderIndex]).Rules = '' then
-      TLadder(LadderList[ladderIndex]).Rules := _('No rules set for this ladder.');
-  end;
-end;
-
-function TLadderListThread.DownloadAllLadderDetails: boolean;
-var
-  html:string;
-  parse1,parse2 : TStrings;
-  i,j,k,l : integer;
-  paramName,paramValue: string;
-  nbRulesLines: integer;
-  ladder : ^TLadder;
-  laddername,ladderid:string;
-begin
-  Result := True;
-  parse1 := TStringList.Create;
-  parse2 := TStringList.Create;
-  with HostBattleForm do begin
-
-    Synchronize(Initialize);
-
-    if Preferences.UseProxy then
-    begin
-      HttpCli1.Proxy := Preferences.ProxyAddress;
-      HttpCli1.ProxyPort := IntToStr(Preferences.ProxyPort);
-      HttpCli1.ProxyUsername := Preferences.ProxyUsername;
-      HttpCli1.ProxyPassword := Preferences.ProxyPassword
-    end
-    else HttpCli1.Proxy := '';
-    HttpCli1.URL := LADDER_PREFIX_URL + 'allrules.php';
-    HttpCli1.RcvdStream := TMemoryStream.Create;
-    try
-      HttpCli1.Get;
-    except
-      MainForm.AddMainLog(_('Error: Ladder server unavailable.'), Colors.Error);
-      UpdateMessageStatus(_('Error: Ladder server unavailable.'));
-      Synchronize(Finalize);
-      LadderList.Clear;
-      Exit;
-    end;
-    HttpCli1.RcvdStream.Seek(0,0);
-    SetLength(html, HttpCli1.RcvdStream.Size);
-    HttpCli1.RcvdStream.ReadBuffer(Pointer(html)^, HttpCli1.RcvdStream.Size);
-    HttpCli1.RcvdStream.Free;
-
-    // parse the html result
-    Misc.ParseDelimited(parse1,html,' ','');
-    if (parse1[0] = 'error') or (parse1[0] = 'notice') then
-    begin
-      parse1.Delete(0);
-      MessageDlgThread(Misc.JoinStringList(parse1,' '),mtError,[mbOK],0)
-    end
-    else
-    begin
-      parse1.Clear;
-      Misc.ParseDelimited(parse1,html,#$A,'');
-        for i:=0 to parse1.Count-1 do
-          if parse1[i] &lt;&gt; '' then begin
-          try
-            k := Pos(' ',PChar(parse1[i]));
-            paramValue := MidStr(parse1[i],k+1,5000000);
-            paramName := Copy(parse1[i],1,k-1);
-            if paramValue = 'any' then
-              paramValue := '-1';
-            if paramName = 'ladder' then
-            begin
-              Misc.ParseDelimited(parse2,paramValue,' ','');
-              ladderid := parse2[0];
-              parse2.Delete(0);
-              laddername := JoinStringList(parse2,' ');
-              New(ladder);
-              ladder^ := TLadder.Create(StrToInt(ladderid),laddername);
-            end
-            else if paramName = 'mod' then
-              ladder^.ModName := paramValue
-            else if paramName = 'min_players_per_allyteam' then
-              ladder^.MinPlayersPerAllyTeam := StrToInt(paramValue)
-            else if paramName = 'max_players_per_allyteam' then
-              ladder^.MaxPlayersPerAllyTeam := StrToInt(paramValue)
-            else if paramName = 'startpos' then
-              ladder^.StartPos := StrToInt(paramValue)
-            else if paramName = 'gamemode' then
-              ladder^.GameMode := StrToInt(paramValue)
-            else if paramName = 'dgun' then
-              ladder^.DGun := StrToInt(paramValue)
-            else if paramName = 'ghost' then
-              ladder^.Ghost := StrToInt(paramValue)
-            else if paramName = 'diminish' then
-              ladder^.Diminish := StrToInt(paramValue)
-            else if paramName = 'metal' then
-              if paramValue &lt;&gt; '-1' then begin
-                Misc.ParseDelimited(parse2,paramValue,' ','');
-                ladder^.MetalMin := Max(0,StrToInt(parse2[0]));
-                ladder^.MetalMax := Min(10000,StrToInt(parse2[1]));
-              end
-              else
-                ladder^.MetalMin := StrToInt(paramValue)
-            else if paramName = 'energy' then
-              if paramValue &lt;&gt; '-1' then begin
-                Misc.ParseDelimited(parse2,paramValue,' ','');
-                ladder^.EnergyMin := Max(0,StrToInt(parse2[0]));
-                ladder^.EnergyMax := Min(10000,StrToInt(parse2[1]));
-              end
-              else
-                ladder^.EnergyMin := StrToInt(paramValue)
-            else if paramName = 'units' then
-              if paramValue &lt;&gt; '-1' then begin
-                Misc.ParseDelimited(parse2,paramValue,' ','');
-                ladder^.UnitsMin := Max(10,StrToInt(parse2[0]));
-                ladder^.UnitsMax := Min(5000,StrToInt(parse2[1]));
-              end
-              else
-                ladder^.UnitsMin := StrToInt(paramValue)
-            else if paramName = 'rules' then
-              begin
-                Misc.ParseDelimited(parse2,paramValue,' ','');
-                nbRulesLines := StrToInt(parse2[0]);
-                parse2.Delete(0);
-                ladder^.Rules := JoinStringList(parse2,' ');
-                for j:=i+1 to i+nbRulesLines-1 do
-                  ladder^.Rules := ladder^.Rules + parse1[j];
-                if ladder^.Rules = '' then
-                  ladder^.Rules := _('No rules set for this ladder.');
-                LadderList.Add(ladder^);
-              end
-            else if paramName = 'restricted' then
-                if paramValue &lt;&gt; 'none' then
-                  Misc.ParseDelimited(ladder^.Restricted,paramValue,',','')
-          Except
-            MessageDlgThread(_('An error occured while parsing the ladder details !'),mtError,[mbOk],0);
-            Result := False;
-            UpdateMessageStatus(_('Error: Ladders details download failed.'));
-            Synchronize(Finalize);
-            LadderList.Clear;
-            Exit;
-          end;
-        end;
-    end;
-
-    Synchronize(PopulateMenu);
-    parse1.Clear;
-    Synchronize(Finalize);
-  end;
-end;
-
-procedure TLadderListThread.ShowMessageStatus;
-begin
-  HostBattleForm.LadderComboBox.Items.Strings[0] := StatusMsg;
-  HostBattleForm.LadderComboBox.ItemIndex := 0;
-end;
-
-procedure TLadderListThread.UpdateMessageStatus(msg : string);
-begin
-  StatusMsg := msg;
-  Synchronize(ShowMessageStatus);
-end;
-
-procedure TLadderListThread.OnTerminateProcedure(Sender: TObject);
-begin
-  // nothing
-end;
-
-procedure THostBattleForm.RefreshButtonClick(Sender: TObject);
-var
-  ThreadLL : TLadderListThread;
-begin
-  LadderList.Clear;
-  ThreadLL := TLadderListThread.Create(False,-1,true);
-end;
-
-procedure THostBattleForm.LadderComboBoxChange(Sender: TObject);
-begin
-  if LadderList.Count &gt; 0 then
-    ApplyLadderParams(TLadder(LadderList[LadderComboBox.ItemIndex]));
-end;
-
 procedure THostBattleForm.RankComboBoxDrawItem(Sender: TObject;
   ACanvas: TCanvas; var ARect: TRect; Index: Integer;
   const State: TOwnerDrawState; const PaintStage: TSpTBXPaintStage;

Modified: Lobby/TASClient/HttpGetUnit.dfm
===================================================================
--- Lobby/TASClient/HttpGetUnit.dfm	2010-04-04 21:03:19 UTC (rev 7457)
+++ Lobby/TASClient/HttpGetUnit.dfm	2010-04-04 21:43:41 UTC (rev 7458)
@@ -92,13 +92,13 @@
       Height = 17
       Caption = '0%'
       Font.Charset = DEFAULT_CHARSET
-      Font.Color = clWindowText
+      Font.Color = clWhite
       Font.Height = -11
       Font.Name = 'MS Sans Serif'
       Font.Style = [fsBold]
       ParentFont = False
       CaptionGlow = gldBottomRight
-      CaptionGlowColor = clWhite
+      CaptionGlowColor = clBlack
       Smooth = True
     end
   end

Modified: Lobby/TASClient/LogonFormUnit.dfm
===================================================================
--- Lobby/TASClient/LogonFormUnit.dfm	2010-04-04 21:03:19 UTC (rev 7457)
+++ Lobby/TASClient/LogonFormUnit.dfm	2010-04-04 21:43:41 UTC (rev 7458)
@@ -3,8 +3,8 @@
   Top = 430
   BorderStyle = bsDialog
   Caption = 'Logon'
-  ClientHeight = 348
-  ClientWidth = 375
+  ClientHeight = 325
+  ClientWidth = 377
   Color = clBtnFace
   Constraints.MaxHeight = 1150
   Constraints.MaxWidth = 1920
@@ -23,8 +23,8 @@
   object SpTBXTitleBar1: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 375
-    Height = 348
+    Width = 377
+    Height = 325
     Caption = 'Logon'
     FixedSize = True
     Options.Maximize = False
@@ -78,7 +78,7 @@
       Left = 16
       Top = 120
       Width = 345
-      Height = 121
+      Height = 105
       Caption = 'Account details'
       TabOrder = 2
       TBXStyleBackground = True
@@ -114,62 +114,28 @@
         Height = 13
         Caption = 'Password :'
       end
-      object SpTBXLabel1: TSpTBXLabel
-        Left = 16
-        Top = 72
-        Width = 87
-        Height = 13
-        Caption = 'Ladder password :'
-        Enabled = False
-      end
-      object beLadderPassword: TSpTBXButtonEdit
-        Left = 152
-        Top = 72
-        Width = 185
-        Height = 21
-        Enabled = False
-        ReadOnly = True
-        TabOrder = 5
-        EditButton.Left = 155
-        EditButton.Top = 0
-        EditButton.Width = 26
-        EditButton.Height = 17
-        EditButton.Caption = '...'
-        EditButton.Align = alRight
-        EditButton.Enabled = False
-        PasswordCharW = '*'
-      end
       object chkRememberPasswords: TSpTBXCheckBox
         Left = 152
-        Top = 96
+        Top = 72
         Width = 117
         Height = 15
         Caption = 'remember passwords'
-        TabOrder = 6
+        TabOrder = 4
       end
-      object SpTBXLabel2: TSpTBXLabel
-        Left = 16
-        Top = 88
-        Width = 43
-        Height = 13
-        Caption = '(optional)'
-        Enabled = False
-      end
     end
     object btRegisterLadder: TSpTBXButton
       Left = 16
       Top = 248
-      Width = 145
+      Width = 169
       Height = 25
       Caption = 'Register Ladder'
       Enabled = False
       TabOrder = 3
-      OnClick = btRegisterLadderClick
     end
     object btLogin: TSpTBXButton
-      Left = 168
+      Left = 192
       Top = 248
-      Width = 193
+      Width = 169
       Height = 57
       Caption = 'Login'
       Font.Charset = DEFAULT_CHARSET
@@ -183,22 +149,13 @@
       Images = MainForm.ConnectionStateImageList
       ImageIndex = 0
     end
-    object btRegister: TSpTBXButton
-      Left = 16
-      Top = 280
-      Width = 145
-      Height = 25
-      Caption = 'Register'
-      TabOrder = 5
-      OnClick = btRegisterClick
-    end
     object chkUseLogonForm: TSpTBXCheckBox
       Left = 16
-      Top = 314
+      Top = 282
       Width = 89
       Height = 15
       Caption = 'Use logon form'
-      TabOrder = 6
+      TabOrder = 5
     end
   end
 end

Modified: Lobby/TASClient/LogonFormUnit.pas
===================================================================
--- Lobby/TASClient/LogonFormUnit.pas	2010-04-04 21:03:19 UTC (rev 7457)
+++ Lobby/TASClient/LogonFormUnit.pas	2010-04-04 21:43:41 UTC (rev 7458)
@@ -19,21 +19,15 @@
     txtLogin: TSpTBXEdit;
     txtPassword: TSpTBXEdit;
     lblPassword: TSpTBXLabel;
-    SpTBXLabel1: TSpTBXLabel;
-    beLadderPassword: TSpTBXButtonEdit;
     chkRememberPasswords: TSpTBXCheckBox;
-    SpTBXLabel2: TSpTBXLabel;
     btRegisterLadder: TSpTBXButton;
     btLogin: TSpTBXButton;
-    btRegister: TSpTBXButton;
     chkUseLogonForm: TSpTBXCheckBox;
     procedure FormCreate(Sender: TObject);
     procedure btLoginClick(Sender: TObject);
     procedure FormShow(Sender: TObject);
     procedure txtPasswordChange(Sender: TObject);
-    procedure beLadderPasswordSubEditButton0Click(Sender: TObject);
     procedure btRegisterClick(Sender: TObject);
-    procedure btRegisterLadderClick(Sender: TObject);
     procedure txtLoginKeyPress(Sender: TObject; var Key: Char);
     procedure txtPasswordKeyPress(Sender: TObject; var Key: Char);
     procedure txtPortKeyPress(Sender: TObject; var Key: Char);
@@ -83,7 +77,6 @@
   Preferences.ServerPort := txtPort.Text;
   Preferences.Username := txtLogin.Text;
   Preferences.Password := txtPassword.Text;
-  Preferences.LadderPassword := beLadderPassword.Text;
   Preferences.RememberPasswords := chkRememberPasswords.Checked;
   Preferences.UseLogonForm := chkUseLogonForm.Checked;
 
@@ -114,12 +107,6 @@
   PasswordChanged := True;
 end;
 
-procedure TLogonForm.beLadderPasswordSubEditButton0Click(Sender: TObject);
-begin
-  PreferencesForm.UsernameEdit.Text := txtLogin.Text;
-  PreferencesForm.ChangeLadderPasswordButtonClick(nil);
-end;
-
 procedure TLogonForm.btRegisterClick(Sender: TObject);
 begin
   if Status.ConnectionState = Connected then
@@ -144,12 +131,6 @@
   PostMessage(MainForm.Handle, WM_DOREGISTER, 0, 0);
 end;
 
-procedure TLogonForm.btRegisterLadderClick(Sender: TObject);
-begin
-  PreferencesForm.UsernameEdit.Text := txtLogin.Text;
-  PreferencesForm.RegisterLadderAccountButtonClick(nil);
-end;
-
 procedure TLogonForm.txtLoginKeyPress(Sender: TObject; var Key: Char);
 begin
   if Key = #13 then

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2010-04-04 21:03:19 UTC (rev 7457)
+++ Lobby/TASClient/MainUnit.pas	2010-04-04 21:43:41 UTC (rev 7458)
@@ -5351,11 +5351,6 @@
   maphash: Integer;
   oldMapHash: integer;
   oldVisible: Boolean;
-  LadderListThread : TLadderListThread;
-  LMThread : TLadderMapThread;
-  CheckPasswordThread : TLadderCheckAccountThread;
-  Ladder : ^TLadder;
-  RenameThread : TLadderRenameAccountThread;
   luaOpt: TLuaOption;
   cTmp: TColor;
   tmpClientGroup: TClientGroup;
@@ -6677,32 +6672,7 @@
         end; // else the method which will receive the request will also send the battle status
 
         BattleState.LadderIndex := -1;
-        if Battle.IsLadderBattle then
-        begin
-          CheckPasswordThread := TLadderCheckAccountThread.Create(False,Preferences.LadderPassword,true);
-          if Battle.GetLadderId = -1 then
-            AddMainLog(_('Error: Battle ladder id not found.'), Colors.Error)
-          else
-          begin
-            for i:=0 to LadderList.Count -1 do
-              if TLadder(LadderList[i]).id = Battle.GetLadderId then begin
-                LadderListThread := TLadderListThread.Create(False,i,false);
-                BattleState.LadderIndex := i;
-                LMThread := TLadderMapThread.Create(False);
-                break;
-              end;
-            if BattleState.LadderIndex = -1 then begin
-              New(Ladder);
-              Ladder^ := TLadder.Create(Battle.GetLadderId,'');
-              LadderList.Add(Ladder^);
-              LadderListThread := TLadderListThread.Create(False,LadderList.IndexOf(Ladder^),false);
-              BattleState.LadderIndex := LadderList.IndexOf(Ladder^);
-              LMThread := TLadderMapThread.Create(False);
-              BattleForm.RefreshLadderRanks;
-            end;
-          end;
-        end;
-
+        
         BattleForm.SortBotList(Preferences.BattleClientSortStyle,Preferences.BattleClientSortDirection,True);
         BattleForm.SortClientList(Preferences.BattleClientSortStyle,Preferences.BattleClientSortDirection,True);
 

Modified: Lobby/TASClient/PreferencesFormUnit.dfm
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.dfm	2010-04-04 21:03:19 UTC (rev 7457)
+++ Lobby/TASClient/PreferencesFormUnit.dfm	2010-04-04 21:43:41 UTC (rev 7458)
@@ -90,19 +90,19 @@
       Top = 56
       Width = 553
       Height = 417
-      ActiveTabIndex = 0
+      ActiveTabIndex = 1
       TabAutofit = True
       HiddenItems = &lt;&gt;
       object SpTBXTabItem6: TSpTBXTabItem
         Caption = 'Server'
         Wrapping = twWrap
-        Checked = True
         CustomWidth = 78
         CustomHeight = 40
       end
       object SpTBXTabItem5: TSpTBXTabItem
         Caption = 'Account'
         Wrapping = twWrap
+        Checked = True
         CustomWidth = 78
       end
       object SpTBXTabItem4: TSpTBXTabItem
@@ -130,108 +130,6 @@
         Wrapping = twWrap
         CustomWidth = 78
       end
-      object SpTBXTabSheet5: TSpTBXTabSheet
-        Left = 0
-        Top = 44
-        Width = 553
-        Height = 373
-        Caption = 'Account'
-        ImageIndex = -1
-        TabItem = 'SpTBXTabItem5'
-        object GroupBox2: TSpTBXGroupBox
-          Left = 16
-          Top = 8
-          Width = 529
-          Height = 345
-          Caption = 'Account details'
-          TabOrder = 0
-          object RegisterAccountButton: TSpTBXSpeedButton
-            Left = 156
-            Top = 160
-            Width = 217
-            Height = 25
-            Caption = 'Create new account'
-            OnClick = RegisterAccountButtonClick
-          end
-          object Label4: TSpTBXLabel
-            Left = 24
-            Top = 40
-            Width = 51
-            Height = 13
-            Caption = 'Username:'
-          end
-          object Label5: TSpTBXLabel
-            Left = 24
-            Top = 72
-            Width = 49
-            Height = 13
-            Caption = 'Password:'
-          end
-          object UsernameEdit: TSpTBXEdit
-            Left = 160
-            Top = 40
-            Width = 185
-            Height = 21
-            TabOrder = 0
-            OnChange = UsernameEditChange
-          end
-          object PasswordEdit: TSpTBXEdit
-            Left = 160
-            Top = 72
-            Width = 185
-            Height = 21
-            TabOrder = 1
-            OnChange = PasswordEditChange
-            PasswordCharW = '*'
-          end
-          object LadderPasswordEdit: TSpTBXEdit
-            Left = 160
-            Top = 104
-            Width = 185
-            Height = 21
-            Enabled = False
-            TabOrder = 5
-            Visible = False
-            PasswordCharW = '*'
-          end
-          object SpTBXLabel1: TSpTBXLabel
-            Left = 24
-            Top = 104
-            Width = 87
-            Height = 13
-            Caption = 'Ladder password :'
-            Visible = False
-          end
-          object ChangeLadderPasswordButton: TSpTBXButton
-            Left = 352
-            Top = 104
-            Width = 81
-            Height = 21
-            Caption = 'Edit'
-            TabOrder = 7
-            Visible = False
-            OnClick = ChangeLadderPasswordButtonClick
-          end
-          object RegisterLadderAccountButton: TSpTBXButton
-            Left = 156
-            Top = 192
-            Width = 217
-            Height = 25
-            Caption = 'Create new ladder account'
-            TabOrder = 8
-            Visible = False
-            OnClick = RegisterLadderAccountButtonClick
-          end
-          object RememberPasswordsCheckBox: TSpTBXCheckBox
-            Left = 160
-            Top = 128
-            Width = 117
-            Height = 15
-            Caption = 'remember passwords'
-            TabOrder = 9
-          end
-        end
-      end
       object SpTBXTabSheet2: TSpTBXTabSheet
         Left = 0
         Top = 44
@@ -965,6 +863,69 @@
           end
         end
       end
+      object SpTBXTabSheet5: TSpTBXTabSheet
+        Left = 0
+        Top = 44
+        Width = 553
+        Height = 373
+        Caption = 'Account'
+        ImageIndex = -1
+        TabItem = 'SpTBXTabItem5'
+        object GroupBox2: TSpTBXGroupBox
+          Left = 16
+          Top = 8
+          Width = 529
+          Height = 345
+          Caption = 'Account details'
+          TabOrder = 0
+          object RegisterAccountButton: TSpTBXSpeedButton
+            Left = 156
+            Top = 136
+            Width = 217
+            Height = 25
+            Caption = 'Create new account'
+            OnClick = RegisterAccountButtonClick
+          end
+          object Label4: TSpTBXLabel
+            Left = 24
+            Top = 40
+            Width = 51
+            Height = 13
+            Caption = 'Username:'
+          end
+          object Label5: TSpTBXLabel
+            Left = 24
+            Top = 72
+            Width = 49
+            Height = 13
+            Caption = 'Password:'
+          end
+          object UsernameEdit: TSpTBXEdit
+            Left = 160
+            Top = 40
+            Width = 185
+            Height = 21
+            TabOrder = 0
+          end
+          object PasswordEdit: TSpTBXEdit
+            Left = 160
+            Top = 72
+            Width = 185
+            Height = 21
+            TabOrder = 1
+            OnChange = PasswordEditChange
+            PasswordCharW = '*'
+          end
+          object RememberPasswordsCheckBox: TSpTBXCheckBox
+            Left = 160
+            Top = 104
+            Width = 117
+            Height = 15
+            Caption = 'remember passwords'
+            TabOrder = 5
+          end
+        end
+      end
     end
     object ApplyAndCloseButton: TSpTBXButton
       Left = 119

Modified: Lobby/TASClient/PreferencesFormUnit.pas
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.pas	2010-04-04 21:03:19 UTC (rev 7457)
+++ Lobby/TASClient/PreferencesFormUnit.pas	2010-04-04 21:43:41 UTC (rev 7458)
@@ -135,10 +135,6 @@
     Label5: TSpTBXLabel;
     UsernameEdit: TSpTBXEdit;
     PasswordEdit: TSpTBXEdit;
-    LadderPasswordEdit: TSpTBXEdit;
-    SpTBXLabel1: TSpTBXLabel;
-    ChangeLadderPasswordButton: TSpTBXButton;
-    RegisterLadderAccountButton: TSpTBXButton;
     RememberPasswordsCheckBox: TSpTBXCheckBox;
     SpTBXTabSheet4: TSpTBXTabSheet;
     GroupBox3: TSpTBXGroupBox;
@@ -261,9 +257,6 @@
     procedure SpTBXRadioButton3Click(Sender: TObject);
     procedure IgnoreListButtonClick(Sender: TObject);
     procedure KeyEditorButtonClick(Sender: TObject);
-    procedure ChangeLadderPasswordButtonClick(Sender: TObject);
-    procedure UsernameEditChange(Sender: TObject);
-    procedure RegisterLadderAccountButtonClick(Sender: TObject);
     procedure ColorsButtonClick(Sender: TObject);
     procedure ManageGroupsButtonClick(Sender: TObject);
     procedure ChatLogsLimitTrackerChange(Sender: TObject);
@@ -295,41 +288,6 @@
     Port: string;
   end;
 
-  TLadderCheckAccountThread = class(TTASClientThread)
-  private
-    password : string;
-    isOnTheFlyCheck : boolean; // means it is check the actual saved password
-    procedure CheckAccount;
-    procedure OnTerminateProcedure(Sender : TObject);
-  protected
-    procedure Execute; override;
-    
-  public
-    constructor Create(Suspended: Boolean;passToCheck: string;onTheFlyCheck : boolean);
-  end;
-
-  TLadderCreateAccountThread = class(TTASClientThread)
-  private
-    procedure CreateAccount;
-    procedure OnTerminateProcedure(Sender : TObject);
-  protected
-    procedure Execute; override;
-  public
-    constructor Create(Suspended : Boolean);
-  end;
-
-  TLadderRenameAccountThread = class(TTASClientThread)
-  private
-    UserName : string;
-    procedure RenameAccount;
-    procedure OnTerminateProcedure(Sender : TObject);
-  protected
-    procedure Execute; override;
-
-  public
-    constructor Create(Suspended : Boolean;newUserName : string);
-  end;
-
 const
   DEFAULT_PREFERENCES: TPreferences = (ServerIP:'taspringmaster.clan-sy.com'; ServerPort:'8200'; TabStyle:0; TimeStamps: True; Username:''; Password:'';
                                         RememberPasswords: False; ConnectOnStartup: False; SortStyle: 1; BattleSortStyle: 1; BattleSortDirection: 0;
@@ -1129,7 +1087,6 @@
 
   p.Username := UsernameEdit.Text;
   p.Password := PasswordEdit.Text;
-  p.LadderPassword := LadderPasswordEdit.Text;
   p.RememberPasswords := RememberPasswordsCheckBox.Checked;
   p.UseLogonForm := UseLogonFormCheckBox.Checked;
 
@@ -1221,14 +1178,12 @@
 
   UsernameEdit.Text := p.Username;
   PasswordEdit.Text := p.Password;
-  LadderPasswordEdit.Text := p.LadderPassword;
   RememberPasswordsCheckBox.Checked := p.RememberPasswords;
   UseLogonFormCheckBox.Checked := p.UseLogonForm;
 
   LogonForm.txtLogin.Text := p.Username;
   LogonForm.txtPort.Text := p.ServerPort;
   LogonForm.beServer.Text := p.ServerIP;
-  LogonForm.beLadderPassword.Text := p.LadderPassword;
   LogonForm.txtPassword.Text := p.Password;
   LogonForm.chkRememberPasswords.Checked := p.RememberPasswords;
   LogonForm.chkUseLogonForm.Checked := p.UseLogonForm;
@@ -1610,320 +1565,6 @@
   if (tmp &gt; 0) and (tmp &lt; 32) then MessageDlg(_('Couldn''t find SelectionEditor.exe!'), mtWarning, [mbOK], 0);
 end;
 
-constructor TLadderCheckAccountThread.Create(Suspended: Boolean;passToCheck: string;onTheFlyCheck : boolean);
-begin
-   FreeOnTerminate := True;
-   inherited Create(Suspended);
-   OnTerminate := OnTerminateProcedure;
-   password := passToCheck;
-   isOnTheFlyCheck := onTheFlyCheck;
-end;
-
-procedure TLadderCheckAccountThread.Execute;
-begin
-  CheckAccount;
-end;
-
-procedure TLadderCheckAccountThread.CheckAccount;
-var
-  i,j,k:integer;
-  html:string;
-  parse1 : TStrings;
-begin
-  if password = '' then
-    Exit;
-    
-  if not VerifyName(password) then begin
-    MessageDlgThread(_('Your password consists of illegal characters!'),mtWarning,[mbOk],0);
-    Exit;
-  end;
-  parse1 := TStringList.Create;
-
-  with PreferencesForm do begin
-    if not isOnTheFlyCheck then
-    begin
-      LadderPasswordEdit.PasswordChar := #0;
-      LogonForm.beLadderPassword.PasswordChar := LadderPasswordEdit.PasswordChar;
-      LadderPasswordEdit.Text := _('Checking password ...');
-      LogonForm.beLadderPassword.Text := LadderPasswordEdit.Text;
-      ApplyAndCloseButton.Enabled := False;
-      LogonForm.btLogin.Enabled := False;
-      ChangeLadderPasswordButton.Enabled := False;
-      LogonForm.beLadderPassword.EditButton.Enabled := False;
-      RegisterLadderAccountButton.Enabled := False;
-      LogonForm.btRegisterLadder.Enabled := False;
-    end;
-
-    if Preferences.UseProxy then
-    begin
-      HttpCli1.Proxy := Preferences.ProxyAddress;
-      HttpCli1.ProxyPort := IntToStr(Preferences.ProxyPort);
-      HttpCli1.ProxyUsername := Preferences.ProxyUsername;
-      HttpCli1.ProxyPassword := Preferences.ProxyPassword
-    end
-    else HttpCli1.Proxy := '';
-    HttpCli1.URL := LADDER_PREFIX_URL + 'checkaccount.php?username='+UsernameEdit.Text+'&amp;password='+password;
-    HttpCli1.RcvdStream := TMemoryStream.Create;
-    try
-      HttpCli1.Get;
-    except
-      MainForm.AddMainLog(_('Error: Ladder server unavailable.'), Colors.Error);
-      MessageDlgThread(_('Error: Ladder server unavailable.'),mtError,[mbOK],0);
-      LadderPasswordEdit.Text := '';
-      ApplyAndCloseButton.Enabled := True;
-      LogonForm.btLogin.Enabled := True;
-      ChangeLadderPasswordButton.Enabled := True;
-      LogonForm.beLadderPassword.EditButton.Enabled := True;
-      RegisterLadderAccountButton.Enabled := True;
-      LogonForm.btRegisterLadder.Enabled := True;
-      Exit;
-    end;
-    HttpCli1.RcvdStream.Seek(0,0);
-    SetLength(html, HttpCli1.RcvdStream.Size-1);
-    HttpCli1.RcvdStream.ReadBuffer(Pointer(html)^, HttpCli1.RcvdStream.Size-1);
-    HttpCli1.RcvdStream.Free;
-
-    LadderPasswordEdit.PasswordChar := '*';
-    LogonForm.beLadderPassword.PasswordChar := LadderPasswordEdit.PasswordChar;
-    // parse the html result
-    Misc.ParseDelimited(parse1,html,' ','');
-    if (parse1[0] = 'error') then begin
-      if not isOnTheFlyCheck then
-      begin
-        LadderPasswordEdit.Text := '';
-        LogonForm.beLadderPassword.Text := LadderPasswordEdit.Text;
-      end
-      else
-        Preferences.LadderPassword := '';
-      parse1.Delete(0);
-      MessageDlgThread(Misc.JoinStringList(parse1,' '),mtError,[mbOK],0)
-    end
-    else
-    begin
-      if not isOnTheFlyCheck then
-      begin
-        LadderPasswordEdit.Text := password;
-        LogonForm.beLadderPassword.Text := LadderPasswordEdit.Text;
-      end;
-    end;
-    parse1.Clear;
-    if not isOnTheFlyCheck then
-    begin
-      ApplyAndCloseButton.Enabled := True;
-      LogonForm.btLogin.Enabled := True;
-      ChangeLadderPasswordButton.Enabled := True;
-      LogonForm.beLadderPassword.EditButton.Enabled := True;
-      RegisterLadderAccountButton.Enabled := True;
-      LogonForm.btRegisterLadder.Enabled := True;
-    end;
-  end;
-end;
-
-procedure TLadderCheckAccountThread.OnTerminateProcedure(Sender: TObject);
-begin
-  // nothing
-end;
-
-constructor TLadderCreateAccountThread.Create(Suspended: Boolean);
-begin
-   FreeOnTerminate := True;
-   inherited Create(Suspended);
-   OnTerminate := OnTerminateProcedure;
-end;
-
-procedure TLadderCreateAccountThread.Execute;
-begin
-  CreateAccount;
-end;
-
-procedure TLadderCreateAccountThread.CreateAccount;
-var
-  i,j,k:integer;
-  html:string;
-  parse1 : TStrings;
-  password : string;
-begin
-  password := InputBoxThread(_('Ladder password'),_('Enter your ladder password :'),'');
-
-  if password = '' then
-    Exit;
-
-  if not VerifyName(password) then begin
-    MessageDlgThread(_('Your password consists of illegal characters!'),mtWarning,[mbOk],0);
-    Exit;
-  end;
-
-  parse1 := TStringList.Create;
-
-  with PreferencesForm do begin
-    LadderPasswordEdit.PasswordChar := #0;
-    LogonForm.beLadderPassword.PasswordChar := LadderPasswordEdit.PasswordChar;
-    LadderPasswordEdit.Text := _('Registering acount ...');
-    LogonForm.beLadderPassword.Text := LadderPasswordEdit.Text;
-    ApplyAndCloseButton.Enabled := False;
-    LogonForm.btLogin.Enabled := False;
-    ChangeLadderPasswordButton.Enabled := False;
-    LogonForm.beLadderPassword.EditButton.Enabled := False;
-    RegisterLadderAccountButton.Enabled := False;
-    LogonForm.btRegisterLadder.Enabled := False;
-
-    if Preferences.UseProxy then
-    begin
-      HttpCli1.Proxy := Preferences.ProxyAddress;
-      HttpCli1.ProxyPort := IntToStr(Preferences.ProxyPort);
-      HttpCli1.ProxyUsername := Preferences.ProxyUsername;
-      HttpCli1.ProxyPassword := Preferences.ProxyPassword
-    end
-    else HttpCli1.Proxy := '';
-    HttpCli1.URL := LADDER_PREFIX_URL + 'registeraccount.php?username='+UsernameEdit.Text+'&amp;password='+password;
-    HttpCli1.RcvdStream := TMemoryStream.Create;
-    try
-      HttpCli1.Get;
-    except
-      MainForm.AddMainLog(_('Error: Ladder server unavailable.'), Colors.Error);
-      MessageDlgThread(_('Error: Ladder server unavailable.'),mtError,[mbOK],0);
-      LadderPasswordEdit.Text := '';
-      ApplyAndCloseButton.Enabled := True;
-      LogonForm.btLogin.Enabled := True;
-      ChangeLadderPasswordButton.Enabled := True;
-      LogonForm.beLadderPassword.EditButton.Enabled := True;
-      RegisterLadderAccountButton.Enabled := True;
-      LogonForm.btRegisterLadder.Enabled := True;
-      Exit;
-    end;
-    HttpCli1.RcvdStream.Seek(0,0);
-    SetLength(html, HttpCli1.RcvdStream.Size-1);
-    HttpCli1.RcvdStream.ReadBuffer(Pointer(html)^, HttpCli1.RcvdStream.Size-1);
-    HttpCli1.RcvdStream.Free;
-
-    LadderPasswordEdit.PasswordChar := '*';
-    LogonForm.beLadderPassword.PasswordChar := LadderPasswordEdit.PasswordChar;
-    // parse the html result
-    Misc.ParseDelimited(parse1,html,' ','');
-    if (parse1[0] = 'error') then begin
-      LadderPasswordEdit.Text := '';
-      LogonForm.beLadderPassword.Text := LadderPasswordEdit.Text;
-      parse1.Delete(0);
-      MessageDlgThread(Misc.JoinStringList(parse1,' '),mtError,[mbOK],0)
-    end
-    else
-    begin
-      LadderPasswordEdit.Text := password;
-      LogonForm.beLadderPassword.Text := LadderPasswordEdit.Text;
-    end;
-    parse1.Clear;
-    ApplyAndCloseButton.Enabled := True;
-    LogonForm.btLogin.Enabled := True;
-    ChangeLadderPasswordButton.Enabled := True;
-    LogonForm.beLadderPassword.EditButton.Enabled := True;
-    RegisterLadderAccountButton.Enabled := True;
-    LogonForm.btRegisterLadder.Enabled := True;
-  end;
-end;
-
-procedure TLadderCreateAccountThread.OnTerminateProcedure(Sender: TObject);
-begin
-  // nothing
-end;
-
-constructor TLadderRenameAccountThread.Create(Suspended : Boolean;newUserName : string);
-begin
-   FreeOnTerminate := True;
-   inherited Create(Suspended);
-   OnTerminate := OnTerminateProcedure;
-   UserName := newUserName;
-end;
-
-procedure TLadderRenameAccountThread.Execute;
-begin
-  RenameAccount;
-end;
-
-procedure TLadderRenameAccountThread.RenameAccount;
-var
-  i,j,k:integer;
-  html:string;
-  parse1 : TStrings;
-  password : string;
-begin
-  if MessageDlgThread(_('Do you want to rename your ladder account too ?'),mtConfirmation,[mbYes,mbNo],0) = mrNo then
-    Exit;
-
-  parse1 := TStringList.Create;
-
-  with PreferencesForm do begin
-    if Preferences.UseProxy then
-    begin
-      HttpCli1.Proxy := Preferences.ProxyAddress;
-      HttpCli1.ProxyPort := IntToStr(Preferences.ProxyPort);
-      HttpCli1.ProxyUsername := Preferences.ProxyUsername;
-      HttpCli1.ProxyPassword := Preferences.ProxyPassword
-    end
-    else HttpCli1.Proxy := '';
-    HttpCli1.URL := LADDER_PREFIX_URL + 'renameaccount.php?username='+Preferences.Username+'&amp;password='+Preferences.LadderPassword+'&amp;newUser='+UserName;
-    HttpCli1.RcvdStream := TMemoryStream.Create;
-    try
-      HttpCli1.Get;
-    except
-      MainForm.AddMainLog(_('Error: Ladder server unavailable.'), Colors.Error);
-      MessageDlgThread(_('Error: Ladder server unavailable.'),mtError,[mbOK],0);
-      LadderPasswordEdit.Text := '';
-      Exit;
-    end;
-    HttpCli1.RcvdStream.Seek(0,0);
-    SetLength(html, HttpCli1.RcvdStream.Size-1);
-    HttpCli1.RcvdStream.ReadBuffer(Pointer(html)^, HttpCli1.RcvdStream.Size-1);
-    HttpCli1.RcvdStream.Free;
-
-    // parse the html result
-    Misc.ParseDelimited(parse1,html,' ','');
-    if (parse1[0] = 'error') then begin
-      LadderPasswordEdit.Text := '';
-      parse1.Delete(0);
-      MessageDlgThread(Misc.JoinStringList(parse1,' '),mtError,[mbOK],0)
-    end
-    else
-    begin
-      parse1.Delete(0);
-      UsernameEdit.Text := UserName;
-      LadderPasswordEdit.Text := Preferences.LadderPassword;
-      UpdatePreferencesTo(Preferences); // save changes to p
-      UpdatePreferencesFrom(Preferences); // update changes from p
-      MessageDlgThread(Misc.JoinStringList(parse1,' '),mtInformation,[mbOK],0);
-    end;
-    parse1.Clear;
-  end;
-end;
-
-procedure TLadderRenameAccountThread.OnTerminateProcedure(Sender: TObject);
-begin
-  // nothing
-end;
-
-procedure TPreferencesForm.ChangeLadderPasswordButtonClick(
-  Sender: TObject);
-var
-  CheckPasswordThread : TLadderCheckAccountThread;
-  password : string;
-begin
-  password := InputBox(_('Ladder password'),_('Enter your ladder password :'),'');
-  CheckPasswordThread := TLadderCheckAccountThread.Create(False,password,false);
-end;
-
-procedure TPreferencesForm.UsernameEditChange(Sender: TObject);
-begin
-  LadderPasswordEdit.Text := '';
-end;
-
-procedure TPreferencesForm.RegisterLadderAccountButtonClick(
-  Sender: TObject);
-begin
-  //if Status.ConnectionState &lt;&gt; Connected then
-  //  MessageDlg('You must be logged in to register a new ladder account !',mtWarning,[mbOK],0)
-  //else
-  TLadderCreateAccountThread.Create(False);
-end;
-
 procedure TPreferencesForm.ColorsButtonClick(Sender: TObject);
 begin
   ColorsPreference.showmodal;

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2010-04-04 21:03:19 UTC (rev 7457)
+++ Lobby/TASClient/TASClient.dof	2010-04-04 21:43:41 UTC (rev 7458)
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=71
 Release=0
-Build=846
+Build=848
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=Spring RTS Engine lobby client
-FileVersion=0.71.0.846
+FileVersion=0.71.0.848
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002227.html">[Taspring-linux-commit] r7457 - in Lobby/TASClient: . Graphics
</A></li>
	<LI>Next message: <A HREF="002229.html">[Taspring-linux-commit] r7459 - in Lobby/TASClient: . Graphics	Python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2228">[ date ]</a>
              <a href="thread.html#2228">[ thread ]</a>
              <a href="subject.html#2228">[ subject ]</a>
              <a href="author.html#2228">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
