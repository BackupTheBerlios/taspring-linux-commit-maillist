<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7470 - in Lobby/TASClient: . Python
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2010-April/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7470%20-%20in%20Lobby/TASClient%3A%20.%20Python&In-Reply-To=%3C20100417233015.AB0E728810%40it-l.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002239.html">
   <LINK REL="Next"  HREF="002241.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7470 - in Lobby/TASClient: . Python</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7470%20-%20in%20Lobby/TASClient%3A%20.%20Python&In-Reply-To=%3C20100417233015.AB0E728810%40it-l.eu%3E"
       TITLE="[Taspring-linux-commit] r7470 - in Lobby/TASClient: . Python">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sun Apr 18 01:30:15 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002239.html">[Taspring-linux-commit] r7469 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="002241.html">[Taspring-linux-commit] r7471 - Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2240">[ date ]</a>
              <a href="thread.html#2240">[ thread ]</a>
              <a href="subject.html#2240">[ subject ]</a>
              <a href="author.html#2240">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2010-04-18 01:30:14 +0200 (Sun, 18 Apr 2010)
New Revision: 7470

Modified:
   Lobby/TASClient/AddBotUnit.dfm
   Lobby/TASClient/AddNotificationFormUnit.dfm
   Lobby/TASClient/AddNotificationFormUnit.pas
   Lobby/TASClient/AgreementUnit.dfm
   Lobby/TASClient/AgreementUnit.pas
   Lobby/TASClient/AutoJoinFormUnit.dfm
   Lobby/TASClient/AutoJoinFormUnit.pas
   Lobby/TASClient/AutoStartRectsUnit.dfm
   Lobby/TASClient/AutoStartRectsUnit.pas
   Lobby/TASClient/AutoTeamsUnit.dfm
   Lobby/TASClient/AutoTeamsUnit.pas
   Lobby/TASClient/AwayMessageFormUnit.dfm
   Lobby/TASClient/AwayMessageFormUnit.pas
   Lobby/TASClient/BattleFormUnit.dfm
   Lobby/TASClient/ChannelsListFormUnit.dfm
   Lobby/TASClient/ColorPicker.dfm
   Lobby/TASClient/ColorPicker.pas
   Lobby/TASClient/ColorsPreferenceUnit.dfm
   Lobby/TASClient/ColorsPreferenceUnit.pas
   Lobby/TASClient/DisableUnitsFormUnit.dfm
   Lobby/TASClient/DisableUnitsFormUnit.pas
   Lobby/TASClient/HelpUnit.dfm
   Lobby/TASClient/HelpUnit.pas
   Lobby/TASClient/HighlightingUnit.dfm
   Lobby/TASClient/HighlightingUnit.pas
   Lobby/TASClient/HostBattleFormUnit.dfm
   Lobby/TASClient/HostBattleFormUnit.pas
   Lobby/TASClient/HostInfoUnit.dfm
   Lobby/TASClient/HostInfoUnit.pas
   Lobby/TASClient/HttpGetUnit.pas
   Lobby/TASClient/IgnoreListUnit.dfm
   Lobby/TASClient/IgnoreListUnit.pas
   Lobby/TASClient/InitWaitFormUnit.dfm
   Lobby/TASClient/InitWaitFormUnit.pas
   Lobby/TASClient/LobbyScriptUnit.pas
   Lobby/TASClient/LoginProgressFormUnit.dfm
   Lobby/TASClient/LoginProgressFormUnit.pas
   Lobby/TASClient/LogonFormUnit.dfm
   Lobby/TASClient/LogonFormUnit.pas
   Lobby/TASClient/MainUnit.dfm
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/ManageGroups.dfm
   Lobby/TASClient/ManageGroups.pas
   Lobby/TASClient/MapListFormUnit.dfm
   Lobby/TASClient/MapListFormUnit.pas
   Lobby/TASClient/Minimap3DPreviewUnit.dfm
   Lobby/TASClient/MinimapZoomedFormUnit.pas
   Lobby/TASClient/Misc.pas
   Lobby/TASClient/NewAccountUnit.dfm
   Lobby/TASClient/NotificationsUnit.dfm
   Lobby/TASClient/NotificationsUnit.pas
   Lobby/TASClient/PerformFormUnit.dfm
   Lobby/TASClient/PerformFormUnit.pas
   Lobby/TASClient/PreferencesFormUnit.dfm
   Lobby/TASClient/PreferencesFormUnit.pas
   Lobby/TASClient/ProgressBarWindow.dfm
   Lobby/TASClient/ProgressBarWindow.pas
   Lobby/TASClient/Python/api.txt
   Lobby/TASClient/ReplaysUnit.dfm
   Lobby/TASClient/SpringDownloaderFormUnit.dfm
   Lobby/TASClient/SpringDownloaderFormUnit.pas
   Lobby/TASClient/SpringSettingsProfileFormUnit.dfm
   Lobby/TASClient/SpringSettingsProfileFormUnit.pas
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.dpr
   Lobby/TASClient/TASClient.res
   Lobby/TASClient/TipsFormUnit.dfm
   Lobby/TASClient/TipsFormUnit.pas
   Lobby/TASClient/UploadReplayUnit.dfm
   Lobby/TASClient/UploadReplayUnit.pas
   Lobby/TASClient/WaitForAckUnit.dfm
   Lobby/TASClient/WaitForAckUnit.pas
Log:
* skin/windows bugs fix
* PYTHON: GetVersion added
* PYTHON: skinEditBackground and skinEditText colors added to the list

Modified: Lobby/TASClient/AddBotUnit.dfm
===================================================================
--- Lobby/TASClient/AddBotUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AddBotUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -24,6 +24,7 @@
     Width = 456
     Height = 482
     Caption = 'Add bot dialog'
+    Active = False
     Options.Minimize = False
     DesignSize = (
       456

Modified: Lobby/TASClient/AddNotificationFormUnit.dfm
===================================================================
--- Lobby/TASClient/AddNotificationFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AddNotificationFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -25,6 +25,7 @@
     Width = 305
     Height = 236
     Caption = 'Add notification'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/AddNotificationFormUnit.pas
===================================================================
--- Lobby/TASClient/AddNotificationFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AddNotificationFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -56,8 +56,6 @@
 begin
   TranslateComponent(self);
 
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
   NotifsComboBox.ItemIndex := 0;
 end;
 

Modified: Lobby/TASClient/AgreementUnit.dfm
===================================================================
--- Lobby/TASClient/AgreementUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AgreementUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -28,6 +28,7 @@
     Width = 584
     Height = 451
     Caption = 'Agreement'
+    Active = False
     FixedSize = True
     Options.Close = False
     Options.Minimize = False

Modified: Lobby/TASClient/AgreementUnit.pas
===================================================================
--- Lobby/TASClient/AgreementUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AgreementUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -92,9 +92,6 @@
 procedure TAgreementForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 end.

Modified: Lobby/TASClient/AutoJoinFormUnit.dfm
===================================================================
--- Lobby/TASClient/AutoJoinFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AutoJoinFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -25,6 +25,7 @@
     Width = 698
     Height = 565
     Caption = 'AutoJoin'
+    Active = False
     FixedSize = True
     Options.Maximize = False
     object gbAutoPlay: TSpTBXGroupBox

Modified: Lobby/TASClient/AutoJoinFormUnit.pas
===================================================================
--- Lobby/TASClient/AutoJoinFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AutoJoinFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -106,9 +106,6 @@
 begin
   TranslateComponent(self);
 
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
-
   initPresets;
 end;
 

Modified: Lobby/TASClient/AutoStartRectsUnit.dfm
===================================================================
--- Lobby/TASClient/AutoStartRectsUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AutoStartRectsUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,10 +1,9 @@
 object AutoStartRectsForm: TAutoStartRectsForm
-  Left = 312
-  Top = 310
-  BorderStyle = bsToolWindow
+  Left = 788
+  Top = 370
+  Width = 393
+  Height = 301
   Caption = 'Start rectangles options'
-  ClientHeight = 279
-  ClientWidth = 394
   Color = clBtnFace
   Font.Charset = DEFAULT_CHARSET
   Font.Color = clWindowText
@@ -21,153 +20,145 @@
   object SpTBXTitleBar1: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 394
-    Height = 279
+    Width = 385
+    Height = 274
     Caption = 'Start rectangles options'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False
-    object SpTBXPanel1: TSpTBXPanel
-      Left = 4
-      Top = 26
-      Width = 386
-      Height = 249
-      Align = alClient
+    object SpTBXGroupBox2: TSpTBXGroupBox
+      Left = 8
+      Top = 32
+      Width = 185
+      Height = 193
+      Caption = 'Starting positions'
       TabOrder = 1
       TBXStyleBackground = True
-      object SpTBXGroupBox2: TSpTBXGroupBox
-        Left = 8
-        Top = 8
-        Width = 185
-        Height = 193
-        Caption = 'Starting positions'
+      object PosTypeComboBox: TSpTBXComboBox
+        Left = 48
+        Top = 30
+        Width = 121
+        Height = 21
+        Style = csDropDownList
+        ItemHeight = 13
+        ItemIndex = 0
         TabOrder = 0
-        TBXStyleBackground = True
-        object PosTypeComboBox: TSpTBXComboBox
-          Left = 48
-          Top = 30
-          Width = 121
-          Height = 21
-          Style = csDropDownList
-          ItemHeight = 13
-          ItemIndex = 0
-          TabOrder = 0
-          Text = 'North vs. south'
-          OnChange = PosTypeComboBoxChange
-          Items.Strings = (
-            'North vs. south'
-            'West vs. east')
-        end
-        object SpTBXLabel3: TSpTBXLabel
-          Left = 8
-          Top = 32
-          Width = 27
-          Height = 13
-          Caption = 'Type:'
-        end
-        object SpTBXLabel4: TSpTBXLabel
-          Left = 8
-          Top = 96
-          Width = 36
-          Height = 13
-          Caption = 'Length:'
-        end
-        object SpTBXLabel1: TSpTBXLabel
-          Left = 8
-          Top = 138
-          Width = 52
-          Height = 13
-          Caption = 'Thickness:'
-        end
-        object GroupsComboBox: TSpTBXComboBox
-          Left = 88
-          Top = 58
-          Width = 81
-          Height = 21
-          Style = csDropDownList
-          ItemHeight = 13
-          ItemIndex = 0
-          TabOrder = 4
-          Text = '2 ally teams'
-          OnChange = GroupsComboBoxChange
-          Items.Strings = (
-            '2 ally teams'
-            '4 ally teams')
-        end
-        object SpTBXLabel2: TSpTBXLabel
-          Left = 8
-          Top = 60
-          Width = 67
-          Height = 13
-          Caption = 'No. of groups:'
-        end
-        object LengthTracker: TSpTBXTrackBar
-          Left = 80
-          Top = 96
-          Width = 97
-          Height = 25
-          Max = 100
-          Frequency = 10
-          Position = 100
-          TabOrder = 6
-          ThumbLength = 15
-          OnChange = LengthTrackerChange
-        end
-        object ThicknessTracker: TSpTBXTrackBar
-          Left = 80
-          Top = 136
-          Width = 97
-          Height = 25
-          Max = 100
-          Frequency = 10
-          Position = 20
-          TabOrder = 7
-          ThumbLength = 15
-          OnChange = ThicknessTrackerChange
-        end
+        Text = 'North vs. south'
+        OnChange = PosTypeComboBoxChange
+        Items.Strings = (
+          'North vs. south'
+          'West vs. east')
       end
-      object SpTBXPanel2: TSpTBXPanel
-        Left = 208
-        Top = 14
-        Width = 169
-        Height = 187
-        Caption = 'SpTBXPanel2'
-        TabOrder = 1
-        TBXStyleBackground = True
-        object PreviewImage: TImage
-          Left = 8
-          Top = 24
-          Width = 150
-          Height = 150
-        end
-        object SpTBXLabel5: TSpTBXLabel
-          Left = 8
-          Top = 8
-          Width = 41
-          Height = 13
-          Caption = 'Preview:'
-        end
+      object SpTBXLabel3: TSpTBXLabel
+        Left = 8
+        Top = 32
+        Width = 27
+        Height = 13
+        Caption = 'Type:'
       end
-      object CloseButton: TSpTBXButton
-        Left = 208
-        Top = 216
+      object SpTBXLabel4: TSpTBXLabel
+        Left = 8
+        Top = 96
+        Width = 36
+        Height = 13
+        Caption = 'Length:'
+      end
+      object SpTBXLabel1: TSpTBXLabel
+        Left = 8
+        Top = 138
+        Width = 52
+        Height = 13
+        Caption = 'Thickness:'
+      end
+      object GroupsComboBox: TSpTBXComboBox
+        Left = 88
+        Top = 58
         Width = 81
+        Height = 21
+        Style = csDropDownList
+        ItemHeight = 13
+        ItemIndex = 0
+        TabOrder = 4
+        Text = '2 ally teams'
+        OnChange = GroupsComboBoxChange
+        Items.Strings = (
+          '2 ally teams'
+          '4 ally teams')
+      end
+      object SpTBXLabel2: TSpTBXLabel
+        Left = 8
+        Top = 60
+        Width = 67
+        Height = 13
+        Caption = 'No. of groups:'
+      end
+      object LengthTracker: TSpTBXTrackBar
+        Left = 80
+        Top = 96
+        Width = 97
         Height = 25
-        Caption = 'Close'
-        TabOrder = 2
-        OnClick = CloseButtonClick
-        Cancel = True
-        Default = True
+        Max = 100
+        Frequency = 10
+        Position = 100
+        TabOrder = 6
+        ThumbLength = 15
+        OnChange = LengthTrackerChange
       end
-      object SpTBXButton1: TSpTBXButton
-        Left = 112
-        Top = 216
-        Width = 81
+      object ThicknessTracker: TSpTBXTrackBar
+        Left = 80
+        Top = 136
+        Width = 97
         Height = 25
-        Caption = 'Apply'
-        TabOrder = 3
-        OnClick = SpTBXButton1Click
+        Max = 100
+        Frequency = 10
+        Position = 20
+        TabOrder = 7
+        ThumbLength = 15
+        OnChange = ThicknessTrackerChange
       end
     end
+    object SpTBXPanel2: TSpTBXPanel
+      Left = 208
+      Top = 38
+      Width = 169
+      Height = 187
+      Caption = 'SpTBXPanel2'
+      TabOrder = 2
+      TBXStyleBackground = True
+      object PreviewImage: TImage
+        Left = 8
+        Top = 24
+        Width = 150
+        Height = 150
+      end
+      object SpTBXLabel5: TSpTBXLabel
+        Left = 8
+        Top = 8
+        Width = 41
+        Height = 13
+        Caption = 'Preview:'
+      end
+    end
+    object SpTBXButton1: TSpTBXButton
+      Left = 112
+      Top = 240
+      Width = 81
+      Height = 25
+      Caption = 'Apply'
+      TabOrder = 3
+      OnClick = SpTBXButton1Click
+    end
+    object CloseButton: TSpTBXButton
+      Left = 208
+      Top = 240
+      Width = 81
+      Height = 25
+      Caption = 'Close'
+      TabOrder = 4
+      OnClick = CloseButtonClick
+      Cancel = True
+      Default = True
+    end
   end
 end

Modified: Lobby/TASClient/AutoStartRectsUnit.pas
===================================================================
--- Lobby/TASClient/AutoStartRectsUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AutoStartRectsUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -5,7 +5,7 @@
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, Menus, SpTBXFormPopupMenu, ComCtrls, SpTBXControls, StdCtrls,
-  TntStdCtrls, SpTBXEditors, ExtCtrls, SpTBXItem;
+  TntStdCtrls, SpTBXEditors, ExtCtrls, SpTBXItem, SpTBXSkins;
 
 type
   TStartRectangleInfo = class(TObject)
@@ -15,7 +15,6 @@
 
   TAutoStartRectsForm = class(TForm)
     SpTBXTitleBar1: TSpTBXTitleBar;
-    SpTBXPanel1: TSpTBXPanel;
     SpTBXGroupBox2: TSpTBXGroupBox;
     PosTypeComboBox: TSpTBXComboBox;
     SpTBXLabel3: TSpTBXLabel;
@@ -23,13 +22,13 @@
     SpTBXLabel1: TSpTBXLabel;
     GroupsComboBox: TSpTBXComboBox;
     SpTBXLabel2: TSpTBXLabel;
+    LengthTracker: TSpTBXTrackBar;
+    ThicknessTracker: TSpTBXTrackBar;
     SpTBXPanel2: TSpTBXPanel;
     PreviewImage: TImage;
     SpTBXLabel5: TSpTBXLabel;
-    CloseButton: TSpTBXButton;
     SpTBXButton1: TSpTBXButton;
-    LengthTracker: TSpTBXTrackBar;
-    ThicknessTracker: TSpTBXTrackBar;
+    CloseButton: TSpTBXButton;
 
     procedure CreateParams(var Params: TCreateParams); override;
 
@@ -68,7 +67,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := BattleForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 
@@ -85,8 +84,8 @@
     CenterX, CenterY: Integer;
   begin
     // draw the rectangle on the preview image:
-    PreviewImage.Picture.Bitmap.Canvas.Pen.Color := clBlue;
-    PreviewImage.Picture.Bitmap.Canvas.Brush.Color := clWhite;
+    PreviewImage.Picture.Bitmap.Canvas.Pen.Color := $00A2E0EB;
+    PreviewImage.Picture.Bitmap.Canvas.Brush.Color := clBlack;
     PreviewImage.Picture.Bitmap.Canvas.Rectangle(Round(Rect.Rect.TopLeft.X * ScaleX), Round(Rect.Rect.TopLeft.Y * ScaleY), Round(Rect.Rect.BottomRight.X * ScaleX), Round(Rect.Rect.BottomRight.Y * ScaleY));
 
     s := IntToStr(Rect.Ally);
@@ -94,7 +93,7 @@
     begin
       Brush.Style := bsClear;
       Font.Style := [fsBold];
-      Font.Color := clBlue;
+      Font.Color := $00A2E0EB;
       CenterX := Round((Rect.Rect.Left + (Rect.Rect.Right - Rect.Rect.Left) div 2) * ScaleX);
       CenterY := Round((Rect.Rect.Top + (Rect.Rect.Bottom - Rect.Rect.Top) div 2) * ScaleY);
       TextOut(CenterX - TextWidth(s) div 2, CenterY - TextHeight(s) div 2, s);

Modified: Lobby/TASClient/AutoTeamsUnit.dfm
===================================================================
--- Lobby/TASClient/AutoTeamsUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AutoTeamsUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 591
     Height = 309
     Caption = 'Auto-teams settings'
+    Active = False
     Options.Minimize = False
     object SpTBXPanel1: TSpTBXPanel
       Left = 4

Modified: Lobby/TASClient/AutoTeamsUnit.pas
===================================================================
--- Lobby/TASClient/AutoTeamsUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AutoTeamsUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -128,7 +128,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := BattleForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 

Modified: Lobby/TASClient/AwayMessageFormUnit.dfm
===================================================================
--- Lobby/TASClient/AwayMessageFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AwayMessageFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,11 +1,10 @@
 object AwayMessageForm: TAwayMessageForm
   Left = 566
   Top = 224
+  Width = 460
+  Height = 225
   BorderIcons = [biSystemMenu]
-  BorderStyle = bsSingle
   Caption = 'AwayMessageForm'
-  ClientHeight = 198
-  ClientWidth = 452
   Color = clBtnFace
   Constraints.MaxHeight = 1000
   Constraints.MaxWidth = 1680
@@ -26,6 +25,7 @@
     Width = 452
     Height = 198
     Caption = 'New away message ...'
+    Active = False
     FixedSize = True
     Options.Maximize = False
     object TitleEdit: TSpTBXEdit

Modified: Lobby/TASClient/AwayMessageFormUnit.pas
===================================================================
--- Lobby/TASClient/AwayMessageFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/AwayMessageFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -81,11 +81,6 @@
 procedure TAwayMessageForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  SpTBXTitleBar1.Active := Preferences.ThemeType=sknSkin;
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 end.

Modified: Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/BattleFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/BattleFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,6 +1,6 @@
 object BattleForm: TBattleForm
-  Left = 240
-  Top = 318
+  Left = 897
+  Top = 366
   Width = 923
   Height = 736
   Caption = 'Battle window'
@@ -28,11 +28,12 @@
     Width = 915
     Height = 709
     Caption = 'Battle window'
+    Active = False
     object BattleMiddlePanel: TDockPanel
-      Left = 4
-      Top = 26
-      Width = 907
-      Height = 638
+      Left = 0
+      Top = 22
+      Width = 915
+      Height = 646
       Align = alClient
       DockSite = True
       TabOrder = 5
@@ -4584,16 +4585,16 @@
       end
     end
     object Panel3: TSpTBXPanel
-      Left = 4
-      Top = 664
-      Width = 907
+      Left = 0
+      Top = 668
+      Width = 915
       Height = 41
       Align = alBottom
       TabOrder = 1
       BorderType = pbrRaised
       TBXStyleBackground = True
       DesignSize = (
-        907
+        915
         41)
       object StartButton: TSpTBXButton
         Left = 128

Modified: Lobby/TASClient/ChannelsListFormUnit.dfm
===================================================================
--- Lobby/TASClient/ChannelsListFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ChannelsListFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -23,6 +23,7 @@
     Width = 716
     Height = 428
     Caption = 'Channels list'
+    Active = False
     object VDTChannels: TVirtualStringTree
       Left = 4
       Top = 26

Modified: Lobby/TASClient/ColorPicker.dfm
===================================================================
--- Lobby/TASClient/ColorPicker.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ColorPicker.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -25,6 +25,7 @@
     Width = 497
     Height = 409
     Caption = 'Color Picker'
+    Active = False
     Options.Minimize = False
     Options.Maximize = False
     object SpTBXPanel1: TSpTBXPanel

Modified: Lobby/TASClient/ColorPicker.pas
===================================================================
--- Lobby/TASClient/ColorPicker.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ColorPicker.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -100,8 +100,6 @@
 begin
   TranslateComponent(self);
 
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
   isSndGradiantMouseDown := False;
   isMainGradiantMouseDown := False;
   curMainX := 0;

Modified: Lobby/TASClient/ColorsPreferenceUnit.dfm
===================================================================
--- Lobby/TASClient/ColorsPreferenceUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ColorsPreferenceUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,10 +1,9 @@
 object ColorsPreference: TColorsPreference
   Left = 1135
   Top = 85
-  BorderStyle = bsDialog
+  Width = 650
+  Height = 466
   Caption = 'Color Preferences'
-  ClientHeight = 439
-  ClientWidth = 642
   Color = clBtnFace
   Constraints.MaxHeight = 1150
   Constraints.MaxWidth = 1920
@@ -25,6 +24,7 @@
     Width = 642
     Height = 439
     Caption = 'Colors and Font Preference'
+    Active = False
     FixedSize = True
     Options.Maximize = False
     object btOk: TSpTBXButton

Modified: Lobby/TASClient/ColorsPreferenceUnit.pas
===================================================================
--- Lobby/TASClient/ColorsPreferenceUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ColorsPreferenceUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -128,16 +128,13 @@
 
 implementation
 
-uses ColorPicker, BattleFormUnit, gnugettext, PreferencesFormUnit;
+uses ColorPicker, BattleFormUnit, gnugettext, PreferencesFormUnit, SplashScreenUnit;
 
 {$R *.dfm}
 
 procedure TColorsPreference.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 procedure TColorsPreference.SpTBXButton0Click(Sender: TObject);
@@ -256,7 +253,7 @@
 var
   i : integer;
 begin
-  // ugly hack to set the battle form chat font
+  // hack to set the battle form chat font
   if not BattleForm.Visible then
   begin
     LockWindowUpdate(BattleForm.Handle);

Modified: Lobby/TASClient/DisableUnitsFormUnit.dfm
===================================================================
--- Lobby/TASClient/DisableUnitsFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/DisableUnitsFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -25,6 +25,7 @@
     Width = 592
     Height = 456
     Caption = 'Disable units dialog'
+    Active = False
     Options.Minimize = False
     DesignSize = (
       592

Modified: Lobby/TASClient/DisableUnitsFormUnit.pas
===================================================================
--- Lobby/TASClient/DisableUnitsFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/DisableUnitsFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -75,7 +75,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := BattleForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 

Modified: Lobby/TASClient/HelpUnit.dfm
===================================================================
--- Lobby/TASClient/HelpUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/HelpUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,10 +1,9 @@
 object HelpForm: THelpForm
-  Left = 1079
-  Top = 400
-  BorderStyle = bsDialog
+  Left = 663
+  Top = 405
+  Width = 793
+  Height = 501
   Caption = 'Help'
-  ClientHeight = 474
-  ClientWidth = 785
   Color = clBtnFace
   Constraints.MaxHeight = 1150
   Constraints.MaxWidth = 1920
@@ -25,6 +24,7 @@
     Width = 785
     Height = 474
     Caption = 'Help'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/HelpUnit.pas
===================================================================
--- Lobby/TASClient/HelpUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/HelpUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -5,7 +5,8 @@
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, StdCtrls, ExtCtrls, ComCtrls, JvExControls, JvComponent,
-  JvXPCore, JvXPButtons, SpTBXTabs, TB2Item, SpTBXItem, SpTBXControls, TntForms;
+  JvXPCore, JvXPButtons, SpTBXTabs, TB2Item, SpTBXItem, SpTBXControls, TntForms,
+  SpTBXSkins;
 
 type
   THelpForm = class(TForm)
@@ -151,7 +152,7 @@
 
 implementation
 
-uses MainUnit, Misc, gnugettext;
+uses MainUnit, Misc, gnugettext, PreferencesFormUnit;
 
 {$R *.dfm}
 
@@ -165,8 +166,6 @@
   TranslateComponent(self);
 
   PageControl1.ActiveTabIndex := 0;
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 procedure THelpForm.Button3Click(Sender: TObject);

Modified: Lobby/TASClient/HighlightingUnit.dfm
===================================================================
--- Lobby/TASClient/HighlightingUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/HighlightingUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 403
     Height = 407
     Caption = 'Highlights manager'
+    Active = False
     Options.Minimize = False
     Options.Maximize = False
     object Image1: TImage

Modified: Lobby/TASClient/HighlightingUnit.pas
===================================================================
--- Lobby/TASClient/HighlightingUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/HighlightingUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -247,9 +247,6 @@
 procedure THighlightingForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 procedure THighlightingForm.FormClose(Sender: TObject;

Modified: Lobby/TASClient/HostBattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/HostBattleFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/HostBattleFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,11 +1,9 @@
 object HostBattleForm: THostBattleForm
-  Left = 1347
-  Top = 333
-  BorderIcons = [biSystemMenu]
-  BorderStyle = bsSingle
+  Left = 443
+  Top = 211
+  Width = 442
+  Height = 410
   Caption = 'Host battle'
-  ClientHeight = 391
-  ClientWidth = 435
   Color = clBtnFace
   Constraints.MaxHeight = 1150
   Constraints.MaxWidth = 1920
@@ -24,9 +22,10 @@
   object SpTBXTitleBar1: TSpTBXTitleBar
     Left = 0
     Top = 0
-    Width = 435
-    Height = 391
+    Width = 434
+    Height = 383
     Caption = 'Host battle'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/HostBattleFormUnit.pas
===================================================================
--- Lobby/TASClient/HostBattleFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/HostBattleFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -86,7 +86,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := BattleForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 
@@ -434,11 +434,6 @@
 begin
   TranslateComponent(self);
 
-  SpTBXTitleBar1.Active := Preferences.ThemeType=sknSkin;
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
-    
   ModsComboBox.Items.Assign(Utility.ModList);
   ModsComboBox.ItemIndex := 0;
 

Modified: Lobby/TASClient/HostInfoUnit.dfm
===================================================================
--- Lobby/TASClient/HostInfoUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/HostInfoUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -25,6 +25,7 @@
     Width = 584
     Height = 408
     Caption = 'Help'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/HostInfoUnit.pas
===================================================================
--- Lobby/TASClient/HostInfoUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/HostInfoUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -48,7 +48,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := BattleForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 
@@ -70,9 +70,6 @@
 procedure THostInfoForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 end.

Modified: Lobby/TASClient/HttpGetUnit.pas
===================================================================
--- Lobby/TASClient/HttpGetUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/HttpGetUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -79,7 +79,7 @@
 
   {with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := MainForm.Handle;
+    WndParent := GetDesktopWindow;
   end;}
 
   {if not PreferencesFormUnit.Preferences.TaskbarButtons then Exit;
@@ -197,6 +197,9 @@
           // closes springdownloader
           CloseSpringDownloader;
 
+          // change translation to default
+          UseLanguage('en_us');
+
           // uninit unitsync
           Utility.DeInitLib;
 
@@ -267,9 +270,6 @@
 procedure THttpGetForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
   HttpCli1.SocksLevel := '5';
   DownloadStatus.Downloading := False;
   DownloadStatus.Success := False;

Modified: Lobby/TASClient/IgnoreListUnit.dfm
===================================================================
--- Lobby/TASClient/IgnoreListUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/IgnoreListUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 307
     Height = 393
     Caption = 'Ignore list'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/IgnoreListUnit.pas
===================================================================
--- Lobby/TASClient/IgnoreListUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/IgnoreListUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -206,9 +206,6 @@
 procedure TIgnoreListForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 procedure TIgnoreListForm.FormClose(Sender: TObject;

Modified: Lobby/TASClient/InitWaitFormUnit.dfm
===================================================================
--- Lobby/TASClient/InitWaitFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/InitWaitFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,10 +1,9 @@
 object InitWaitForm: TInitWaitForm
   Left = 264
   Top = 213
-  BorderStyle = bsSingle
+  Width = 254
+  Height = 115
   Caption = 'Loading ...'
-  ClientHeight = 88
-  ClientWidth = 246
   Color = clBtnFace
   Constraints.MaxHeight = 1000
   Constraints.MaxWidth = 1680
@@ -26,6 +25,7 @@
     Width = 246
     Height = 88
     Caption = 'Loading ...'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/InitWaitFormUnit.pas
===================================================================
--- Lobby/TASClient/InitWaitFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/InitWaitFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -62,7 +62,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := BattleForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 
@@ -162,11 +162,6 @@
 procedure TInitWaitForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  SpTBXTitleBar1.Active := Preferences.ThemeType=sknSkin;
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
     
   InitWaitForm.Font.Assign(InfoLabel.Font); // we need this because we call Canvas.GetTextWidth!
 end;

Modified: Lobby/TASClient/LobbyScriptUnit.pas
===================================================================
--- Lobby/TASClient/LobbyScriptUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/LobbyScriptUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -8,7 +8,7 @@
   WSocket,MainUnit, class_TIntegerList, RichEdit2, ExRichEdit,
   SyncObjs,SpTBXItem, TB2Item, JvDesktopAlert, GR32,
   SpTBXControls, SpTBXTabs,Forms, ComCtrls, pngimage,
-  Jpeg, Math, Dockpanel, RichEdit;
+  Jpeg, Math, Dockpanel, RichEdit, SpTBXSkins;
 
 type
   TScriptForm = class(TDockableForm)
@@ -185,6 +185,7 @@
       // tasclient special functions
       procedure ShowDebugWindow;
       procedure Print(data : string);
+      function GetVersion:String;
 
       // official api
       procedure ExitLobby;
@@ -370,6 +371,11 @@
   PythonScriptDebugForm.Show;
 end;
 
+function TCallback.GetVersion:String;
+begin
+  Result := VERSION_NUMBER+'.'+IntToStr(Misc.GetLobbyRevision);
+end;
+
 procedure TCallback.ExitLobby;
 begin
   MainForm.Close;
@@ -1554,6 +1560,16 @@
     PyDict_SetItemStringDecRef(pyColors,'BotText',Colors.BotText);
     PyDict_SetItemStringDecRef(pyColors,'MyText',Colors.MyText);
     PyDict_SetItemStringDecRef(pyColors,'AdminText',Colors.AdminText);
+    if SkinManager.GetSkinType=sknSkin then
+    begin
+      PyDict_SetItemStringDecRef(pyColors,'SkinEditBackground',SkinManager.CurrentSkin.Options(skncEditFrame).Body.Color1);
+      PyDict_SetItemStringDecRef(pyColors,'SkinEditText',SkinManager.CurrentSkin.GetTextColor(skncEditFrame,sknsNormal));
+    end
+    else
+    begin
+      PyDict_SetItemStringDecRef(pyColors,'SkinEditBackground',clWindow);
+      PyDict_SetItemStringDecRef(pyColors,'SkinEditText',clWindowText);
+    end;
   end;
 end;
 

Modified: Lobby/TASClient/LoginProgressFormUnit.dfm
===================================================================
--- Lobby/TASClient/LoginProgressFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/LoginProgressFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,11 +1,10 @@
 object LoginProgressForm: TLoginProgressForm
   Left = 399
   Top = 343
+  Width = 306
+  Height = 112
   BorderIcons = [biSystemMenu]
-  BorderStyle = bsSingle
   Caption = 'Logging in to the server ...'
-  ClientHeight = 93
-  ClientWidth = 298
   Color = clBtnFace
   Constraints.MaxHeight = 1000
   Constraints.MaxWidth = 1680
@@ -14,7 +13,6 @@
   Font.Height = -11
   Font.Name = 'MS Sans Serif'
   Font.Style = []
-  FormStyle = fsStayOnTop
   OldCreateOrder = False
   Position = poMainFormCenter
   Scaled = False
@@ -25,16 +23,16 @@
     Left = 0
     Top = 0
     Width = 298
-    Height = 93
+    Height = 85
     Caption = 'Logging in to the server ...'
+    Active = False
     FixedSize = True
     Options.Close = False
     Options.Minimize = False
     Options.Maximize = False
-    Options.SystemMenu = False
     DesignSize = (
       298
-      93)
+      85)
     object ProgressLabel: TSpTBXLabel
       Left = 68
       Top = 48

Modified: Lobby/TASClient/LoginProgressFormUnit.pas
===================================================================
--- Lobby/TASClient/LoginProgressFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/LoginProgressFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -36,7 +36,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := MainForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 
@@ -50,11 +50,6 @@
 procedure TLoginProgressForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  SpTBXTitleBar1.Active := Preferences.ThemeType=sknSkin;
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 end.

Modified: Lobby/TASClient/LogonFormUnit.dfm
===================================================================
--- Lobby/TASClient/LogonFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/LogonFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 377
     Height = 325
     Caption = 'Logon'
+    Active = False
     FixedSize = True
     Options.Maximize = False
     object gbServerSettings: TSpTBXGroupBox

Modified: Lobby/TASClient/LogonFormUnit.pas
===================================================================
--- Lobby/TASClient/LogonFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/LogonFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -49,9 +49,6 @@
 procedure TLogonForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-  
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 procedure TLogonForm.btLoginClick(Sender: TObject);

Modified: Lobby/TASClient/MainUnit.dfm
===================================================================
--- Lobby/TASClient/MainUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/MainUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,6 +1,6 @@
 object MainForm: TMainForm
-  Left = 796
-  Top = 199
+  Left = 333
+  Top = 532
   Width = 901
   Height = 521
   Caption = '.'
@@ -26,6 +26,7 @@
     Width = 893
     Height = 494
     Caption = 'TASClient'
+    Active = False
     object DefaultSideImage: TImage
       Left = 240
       Top = 72
@@ -202,10 +203,10 @@
       Visible = False
     end
     object Panel1: TSpTBXPanel
-      Left = 4
-      Top = 108
-      Width = 885
-      Height = 382
+      Left = 0
+      Top = 104
+      Width = 893
+      Height = 390
       Caption = 'Panel1'
       Align = alClient
       TabOrder = 1
@@ -214,18 +215,18 @@
       object MainDockPanel: TDockPanel
         Left = 0
         Top = 0
-        Width = 885
-        Height = 382
+        Width = 893
+        Height = 390
         Align = alClient
         BevelOuter = bvNone
         DockSite = True
         TabOrder = 0
         TabPosition = tpTop
         object PlayerListPanel: TSpTBXPanel
-          Left = 673
+          Left = 681
           Top = 0
           Width = 212
-          Height = 103
+          Height = 111
           Caption = 'Players'
           Align = alRight
           DragKind = dkDock
@@ -238,7 +239,7 @@
             Left = 0
             Top = 57
             Width = 212
-            Height = 46
+            Height = 54
             Style = lbOwnerDrawFixed
             Align = alClient
             DragMode = dmAutomatic
@@ -361,8 +362,8 @@
         end
         object BattlesPanel: TSpTBXPanel
           Left = 0
-          Top = 103
-          Width = 885
+          Top = 111
+          Width = 893
           Height = 279
           Caption = 'Battles'
           Align = alBottom
@@ -374,7 +375,7 @@
           object QuickJoinPanel: TSpTBXPanel
             Left = 0
             Top = 0
-            Width = 885
+            Width = 893
             Height = 25
             Hint = 'Quick join panel'
             Caption = 'QuickJoinPanel'
@@ -399,7 +400,7 @@
               ShowHint = True
             end
             object btSpecatateNow: TSpTBXButton
-              Left = 753
+              Left = 761
               Top = 0
               Width = 132
               Height = 25
@@ -430,7 +431,7 @@
           object VDTBattles: TVirtualDrawTree
             Left = 0
             Top = 25
-            Width = 885
+            Width = 893
             Height = 69
             Align = alClient
             BevelInner = bvNone
@@ -560,7 +561,7 @@
           object FilterGroup: TSpTBXPanel
             Left = 0
             Top = 106
-            Width = 885
+            Width = 893
             Height = 173
             Caption = 'FilterGroup'
             Align = alBottom
@@ -568,12 +569,12 @@
             OnResize = FilterGroupResize
             Borders = False
             DesignSize = (
-              885
+              893
               173)
             object FiltersTabs: TSpTBXTabControl
               Left = 0
               Top = 0
-              Width = 885
+              Width = 893
               Height = 173
               Align = alClient
               ActiveTabIndex = 0
@@ -589,12 +590,12 @@
               object SpTBXTabSheet2: TSpTBXTabSheet
                 Left = 0
                 Top = 0
-                Width = 885
+                Width = 893
                 Height = 150
                 Caption = 'Presets'
                 ImageIndex = -1
                 DesignSize = (
-                  885
+                  893
                   150)
                 TabItem = 'SpTBXTabItem2'
                 object PresetListbox: TSpTBXListBox
@@ -671,7 +672,7 @@
               object SpTBXTabSheet1: TSpTBXTabSheet
                 Left = 0
                 Top = 0
-                Width = 885
+                Width = 893
                 Height = 150
                 Caption = 'Filters'
                 ImageIndex = -1
@@ -1069,7 +1070,7 @@
           object FiltersButton: TSpTBXButton
             Left = 0
             Top = 94
-            Width = 885
+            Width = 893
             Height = 12
             Align = alBottom
             TabOrder = 3
@@ -1081,16 +1082,16 @@
       end
     end
     object Panel4: TSpTBXPanel
-      Left = 4
-      Top = 26
-      Width = 885
+      Left = 0
+      Top = 22
+      Width = 893
       Height = 41
       Align = alTop
       TabOrder = 2
       BorderType = pbrRaised
       TBXStyleBackground = True
       DesignSize = (
-        885
+        893
         41)
       object OptionsSpeedButton: TSpTBXSpeedButton
         Left = 456
@@ -1188,9 +1189,9 @@
       end
     end
     object NewsMainPanel: TSpTBXPanel
-      Left = 4
-      Top = 67
-      Width = 885
+      Left = 0
+      Top = 63
+      Width = 893
       Height = 41
       Caption = 'NewsMainPanel'
       Align = alTop
@@ -1199,7 +1200,7 @@
       object ExpandNewsButton: TSpTBXButton
         Left = 0
         Top = 29
-        Width = 885
+        Width = 893
         Height = 12
         Align = alBottom
         TabOrder = 0
@@ -1210,7 +1211,7 @@
       object ScrollingNewsPanel: TSpTBXPanel
         Left = 0
         Top = 0
-        Width = 885
+        Width = 893
         Height = 29
         Align = alClient
         TabOrder = 1

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/MainUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -411,7 +411,7 @@
   );
 
 const
-  VERSION_NUMBER = '0.72'; // Must be float value! (with a period as a decimal seperator)
+  VERSION_NUMBER = '0.73'; // Must be float value! (with a period as a decimal seperator)
   AUTOUPDATE_URL = '<A HREF="http://tasclient.no-ip.org/TASClient_update_v3.txt">http://tasclient.no-ip.org/TASClient_update_v3.txt</A>';
   PROGRAM_VERSION = 'TASClient ' + VERSION_NUMBER;
   KEEP_ALIVE_INTERVAL = 10000; // in milliseconds. Tells us what should be the maximum &quot;silence&quot; time before we send a ping to the server.
@@ -4068,7 +4068,7 @@
       Misc.TryToAddLog(MainUnit.StartDebugLog,'Applying theme ...');
 
     PreferencesForm.ApplyCurrentThemeType;
-    PreferencesForm.ApplyCurrentTheme;
+    //PreferencesForm.ApplyCurrentTheme;
 
     ColorsPreference.ApplyFont;
 
@@ -8919,6 +8919,13 @@
         except
         end;
 
+  // fuckin buggy delphi + sptbx need a fuckin hack for this fuckin form because of a fuckin random bug happening JUST ON THIS FUCKIN FORM
+  if Preferences.ThemeType &lt;&gt; sknSkin then
+  begin
+    MapListForm.SpTBXTitleBar1.Active := True;
+    MapListForm.SpTBXTitleBar1.Active := False;
+  end;
+
   MainForm.mnuLockViewClick(nil);
 
   if not Status.LoggedIn and Preferences.UseLogonForm and not RunningWithMainMenu and (SplashScreenForm = nil) then

Modified: Lobby/TASClient/ManageGroups.dfm
===================================================================
--- Lobby/TASClient/ManageGroups.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ManageGroups.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -29,6 +29,7 @@
     Width = 596
     Height = 441
     Caption = 'Manage groups'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/ManageGroups.pas
===================================================================
--- Lobby/TASClient/ManageGroups.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ManageGroups.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -261,9 +261,6 @@
   i: integer;
 begin
   TranslateComponent(self);
-  
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 
   for i := 0 to High(Ranks) do ReplaceRankCmb.Items.Add(Ranks[i]);
   ReplaceRankCmb.ItemIndex := 0;

Modified: Lobby/TASClient/MapListFormUnit.dfm
===================================================================
--- Lobby/TASClient/MapListFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/MapListFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,19 +1,17 @@
 object MapListForm: TMapListForm
-  Left = 602
-  Top = 591
-  BorderStyle = bsDialog
+  Left = 504
+  Top = 167
+  Width = 1139
+  Height = 800
   Caption = 'Map list'
-  ClientHeight = 773
-  ClientWidth = 1131
   Color = clBtnFace
-  Constraints.MinWidth = 650
   Font.Charset = DEFAULT_CHARSET
   Font.Color = clWindowText
   Font.Height = -11
   Font.Name = 'MS Sans Serif'
   Font.Style = []
   OldCreateOrder = False
-  Position = poScreenCenter
+  Position = poMainFormCenter
   Scaled = False
   OnClose = FormClose
   OnCreate = FormCreate
@@ -27,13 +25,13 @@
     Top = 0
     Width = 1131
     Height = 773
-    Caption = 'Map list'
-    Options.Minimize = False
+    Caption = 'Map List'
+    Active = False
     object ScrollBox1: TScrollBox
-      Left = 4
-      Top = 99
-      Width = 1123
-      Height = 670
+      Left = 0
+      Top = 89
+      Width = 1131
+      Height = 684
       HorzScrollBar.Increment = 57
       HorzScrollBar.Tracking = True
       VertScrollBar.Smooth = True
@@ -51,16 +49,16 @@
       TabOrder = 1
     end
     object TopPanel: TSpTBXPanel
-      Left = 4
-      Top = 26
-      Width = 1123
-      Height = 73
+      Left = 0
+      Top = 22
+      Width = 1131
+      Height = 67
       Align = alTop
       TabOrder = 2
       TBXStyleBackground = True
       DesignSize = (
-        1123
-        73)
+        1131
+        67)
       object NoPreviewImage: TImage
         Left = 432
         Top = 120
@@ -1018,7 +1016,7 @@
         Caption = 'Total maps: ?'
       end
       object CloseButton: TSpTBXButton
-        Left = 1017
+        Left = 1025
         Top = 8
         Width = 105
         Height = 21
@@ -1070,7 +1068,7 @@
         OnClick = SortLabelClick
       end
       object lblLoadMissingMinimaps: TSpTBXLabel
-        Left = 841
+        Left = 849
         Top = 40
         Width = 277
         Height = 13
@@ -1088,7 +1086,7 @@
         Alignment = taRightJustify
       end
       object lblSearch: TSpTBXLabel
-        Left = 809
+        Left = 817
         Top = 12
         Width = 89
         Height = 13
@@ -1098,7 +1096,7 @@
         Alignment = taRightJustify
       end
       object txtSearch: TSpTBXEdit
-        Left = 904
+        Left = 912
         Top = 8
         Width = 105
         Height = 21
@@ -1118,8 +1116,8 @@
   end
   object SortStylePopupMenu: TSpTBXPopupMenu
     AutoHotkeys = maManual
-    Left = 264
-    Top = 24
+    Left = 280
+    Top = 56
     object mnuNoSorting: TSpTBXItem
       Caption = 'No sorting'
       OnClick = SortStylePopupMenuItemClick

Modified: Lobby/TASClient/MapListFormUnit.pas
===================================================================
--- Lobby/TASClient/MapListFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/MapListFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -6,7 +6,7 @@
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, ExtCtrls, Buttons, StdCtrls, Menus, TB2Item, SpTBXItem,
   SpTBXControls,SpTBXTabs, ComCtrls, JvExComCtrls, JvComCtrls, Utility,
-  Misc, TntForms,Math,MainUnit, SpTBXEditors;
+  Misc, TntForms,Math,MainUnit, SpTBXEditors, SpTBXSkins;
 
 const
   MAP_ITEM_WIDTH = 355;
@@ -19,8 +19,6 @@
   TMapListForm = class;
 
   TMapListForm = class(TForm)
-    SpTBXTitleBar1: TSpTBXTitleBar;
-    ScrollBox1: TScrollBox;
     SyncTimeoutTimer: TTimer;
     SortStylePopupMenu: TSpTBXPopupMenu;
     mnuNoSorting: TSpTBXItem;
@@ -28,6 +26,8 @@
     mnuSortByMapSize: TSpTBXItem;
     mnuSortByAvgWind: TSpTBXItem;
     mnuSortByMaxMetal: TSpTBXItem;
+    SpTBXTitleBar1: TSpTBXTitleBar;
+    ScrollBox1: TScrollBox;
     TopPanel: TSpTBXPanel;
     NoPreviewImage: TImage;
     TotalMapsLabel: TSpTBXLabel;
@@ -173,13 +173,13 @@
 begin
   inherited CreateParams(Params);
 
-  if not Preferences.TaskbarButtons then Exit;
+  {if not Preferences.TaskbarButtons then Exit;
 
   with Params do
   begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := GetDesktopWindow; // note: don't assign BattleForm.Handle here since this form gets created BEFORE BattleForm and so the handle would be invalid!
-  end;
+    WndParent := GetDesktopWindow;
+  end;}
 end;
 
 function GetMapItem(Index: Integer): TMapItem;
@@ -775,10 +775,10 @@
 procedure TMapListForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-  
-  Left := 10;
-  Top := 10;
 
+  //Left := 10;
+  //Top := 10;
+
   Maps := TList.Create;
   SortedMaps := TList.Create;
 
@@ -1109,7 +1109,7 @@
 procedure TMapListForm.FormResize(Sender: TObject);
 begin
   try
-    FilterMapList(txtSearch.Text);
+    //FilterMapList(txtSearch.Text);
   except
   end;
 end;

Modified: Lobby/TASClient/Minimap3DPreviewUnit.dfm
===================================================================
--- Lobby/TASClient/Minimap3DPreviewUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/Minimap3DPreviewUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -23,6 +23,7 @@
     Width = 585
     Height = 509
     Caption = 'Minimap3DPreview'
+    Active = False
     Options.Minimize = False
     object GLSceneViewer: TGLSceneViewer
       Left = 4

Modified: Lobby/TASClient/MinimapZoomedFormUnit.pas
===================================================================
--- Lobby/TASClient/MinimapZoomedFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/MinimapZoomedFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -44,7 +44,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := BattleForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 

Modified: Lobby/TASClient/Misc.pas
===================================================================
--- Lobby/TASClient/Misc.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/Misc.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -136,7 +136,6 @@
   Increment: Integer = 1): Integer;
 function IsWindowsVista: Boolean;
 function IsWindowsXP: Boolean;
-procedure RemoveSpTBXTitleBarMarges(form: TForm);
 function InputColor(title: String; defaultColor: TColor):TColor;
 procedure FixFormSizeConstraints(form: TForm);
 procedure DrawMultilineText(AString: string;
@@ -1897,16 +1896,6 @@
   Result := (VerInfo.dwMajorVersion = 5) and (VerInfo.dwMinorVersion = 1) ;
 end;
 
-procedure RemoveSpTBXTitleBarMarges(form: TForm);
-begin
-  TSpTBXTitleBar(form.FindChildControl('SpTBXTitleBar1')).Align := alNone;
-  TSpTBXTitleBar(form.FindChildControl('SpTBXTitleBar1')).Top := -30;
-  form.HorzScrollBar.Visible := False;
-  form.VertScrollBar.Visible := false;
-  form.Width := form.Width-10;
-  form.Height := form.Height-30;
-end;
-
 function InputColor(title: String; defaultColor: TColor):TColor;
 var
   i: integer;

Modified: Lobby/TASClient/NewAccountUnit.dfm
===================================================================
--- Lobby/TASClient/NewAccountUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/NewAccountUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -25,6 +25,7 @@
     Width = 268
     Height = 199
     Caption = 'Create new account'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/NotificationsUnit.dfm
===================================================================
--- Lobby/TASClient/NotificationsUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/NotificationsUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 322
     Height = 276
     Caption = 'Notification Manager'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/NotificationsUnit.pas
===================================================================
--- Lobby/TASClient/NotificationsUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/NotificationsUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -344,8 +344,6 @@
 begin
   TranslateComponent(self);
   
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
   for i := 0 to Length(Notifications)-1 do Notifications[TNotificationType(i)] := TStringList.Create;
 end;
 

Modified: Lobby/TASClient/PerformFormUnit.dfm
===================================================================
--- Lobby/TASClient/PerformFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/PerformFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 397
     Height = 358
     Caption = 'Perform'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/PerformFormUnit.pas
===================================================================
--- Lobby/TASClient/PerformFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/PerformFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -184,9 +184,6 @@
 procedure TPerformForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-  
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 procedure TPerformForm.FormClose(Sender: TObject;

Modified: Lobby/TASClient/PreferencesFormUnit.dfm
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/PreferencesFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,13 +1,10 @@
 object PreferencesForm: TPreferencesForm
-  Left = 1204
-  Top = 131
-  BorderStyle = bsDialog
+  Left = 972
+  Top = 146
+  Width = 576
+  Height = 541
   Caption = 'Preferences'
-  ClientHeight = 524
-  ClientWidth = 568
   Color = clBtnFace
-  Constraints.MaxHeight = 1150
-  Constraints.MaxWidth = 1920
   Font.Charset = DEFAULT_CHARSET
   Font.Color = clWindowText
   Font.Height = -11
@@ -25,8 +22,9 @@
     Left = 0
     Top = 0
     Width = 568
-    Height = 524
+    Height = 514
     Caption = 'Preferences'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False
@@ -90,7 +88,7 @@
       Top = 56
       Width = 553
       Height = 417
-      ActiveTabIndex = 5
+      ActiveTabIndex = 6
       TabAutofit = True
       HiddenItems = &lt;&gt;
       object SpTBXTabItem6: TSpTBXTabItem
@@ -122,12 +120,12 @@
       object SpTBXTabItem1: TSpTBXTabItem
         Caption = 'Skins'
         Wrapping = twWrap
-        Checked = True
         CustomWidth = 78
       end
       object SpTBXTabItem7: TSpTBXTabItem
         Caption = 'Scripts'
         Wrapping = twWrap
+        Checked = True
         CustomWidth = 78
       end
       object SpTBXTabSheet2: TSpTBXTabSheet
@@ -684,60 +682,6 @@
           end
         end
       end
-      object SpTBXTabSheet7: TSpTBXTabSheet
-        Left = 0
-        Top = 44
-        Width = 553
-        Height = 373
-        Caption = 'Scripts'
-        ImageIndex = -1
-        TabItem = 'SpTBXTabItem7'
-        object ScriptsDebugWindowBt: TSpTBXButton
-          Left = 160
-          Top = 56
-          Width = 233
-          Height = 25
-          Caption = 'Debug Window'
-          TabOrder = 0
-          OnClick = ScriptsDebugWindowBtClick
-        end
-        object ScriptsReloadBt: TSpTBXButton
-          Left = 160
-          Top = 88
-          Width = 233
-          Height = 25
-          Caption = 'Reload scripts'
-          TabOrder = 1
-          OnClick = ScriptsReloadBtClick
-        end
-        object ScriptsLoadNewBt: TSpTBXButton
-          Left = 160
-          Top = 120
-          Width = 233
-          Height = 25
-          Caption = 'Load new scripts'
-          TabOrder = 2
-          OnClick = ScriptsLoadNewBtClick
-        end
-        object ScriptsAdvancedOptionsBt: TSpTBXButton
-          Left = 160
-          Top = 152
-          Width = 233
-          Height = 25
-          Caption = 'Advanced options'
-          TabOrder = 3
-          Visible = False
-          OnClick = ScriptsAdvancedOptionsBtClick
-        end
-        object EnableScriptsCheckBox: TSpTBXCheckBox
-          Left = 180
-          Top = 24
-          Width = 193
-          Height = 15
-          Caption = 'Enable scripts BETA (requires restart)'
-          TabOrder = 4
-        end
-      end
       object SpTBXTabSheet6: TSpTBXTabSheet
         Left = 0
         Top = 44
@@ -944,6 +888,60 @@
           end
         end
       end
+      object SpTBXTabSheet7: TSpTBXTabSheet
+        Left = 0
+        Top = 44
+        Width = 553
+        Height = 373
+        Caption = 'Scripts'
+        ImageIndex = -1
+        TabItem = 'SpTBXTabItem7'
+        object ScriptsDebugWindowBt: TSpTBXButton
+          Left = 160
+          Top = 56
+          Width = 233
+          Height = 25
+          Caption = 'Debug Window'
+          TabOrder = 0
+          OnClick = ScriptsDebugWindowBtClick
+        end
+        object ScriptsReloadBt: TSpTBXButton
+          Left = 160
+          Top = 88
+          Width = 233
+          Height = 25
+          Caption = 'Reload scripts'
+          TabOrder = 1
+          OnClick = ScriptsReloadBtClick
+        end
+        object ScriptsLoadNewBt: TSpTBXButton
+          Left = 160
+          Top = 120
+          Width = 233
+          Height = 25
+          Caption = 'Load new scripts'
+          TabOrder = 2
+          OnClick = ScriptsLoadNewBtClick
+        end
+        object ScriptsAdvancedOptionsBt: TSpTBXButton
+          Left = 160
+          Top = 152
+          Width = 233
+          Height = 25
+          Caption = 'Advanced options'
+          TabOrder = 3
+          Visible = False
+          OnClick = ScriptsAdvancedOptionsBtClick
+        end
+        object EnableScriptsCheckBox: TSpTBXCheckBox
+          Left = 180
+          Top = 24
+          Width = 193
+          Height = 15
+          Caption = 'Enable scripts BETA (requires restart)'
+          TabOrder = 4
+        end
+      end
     end
     object ApplyAndCloseButton: TSpTBXButton
       Left = 119

Modified: Lobby/TASClient/PreferencesFormUnit.pas
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/PreferencesFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -329,7 +329,7 @@
   AutoTeamsUnit, ChannelsListFormUnit, AutoJoinFormUnit, InitWaitFormUnit,
   DisableUnitsFormUnit, MenuFormUnit, AddBotUnit, AwayMessageFormUnit,
   UploadReplayUnit,CustomizeGUIFormUnit, HostInfoUnit, HelpUnit, Types,
-  HttpGetUnit;
+  HttpGetUnit, SplashScreenUnit;
 
 {$R *.dfm}
 
@@ -475,6 +475,7 @@
     try BattleForm.Width := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\BattleForm', 'Width'); except end;
     try BattleForm.Height := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\BattleForm', 'Height'); except end;
     try BattleForm.WindowState := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\BattleForm', 'WindowState'); except end;
+    FixFormBounds(BattleForm);
     //try BattleForm.Panel1.Height := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\BattleForm', 'Splitter4'); except end;
     //try BattleForm.Panel4.Height := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\BattleForm', 'Splitter2'); except end;
     //try BattleForm.Panel6.Width := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\BattleForm', 'Splitter3'); except end;
@@ -524,7 +525,7 @@
     try MapListForm.Width := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\MapListForm', 'Width'); except end;
     try MapListForm.Height := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\MapListForm', 'Height'); except end;
     try MapListForm.WindowState := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Forms\MapListForm', 'WindowState'); except end;
-    FixFormBounds(MapListForm);  
+    FixFormBounds(MapListForm);
 
     // read custom team colors to registry:
     // (first assign default team colors in case if reading from registry fails)
@@ -839,22 +840,46 @@
 procedure TPreferencesForm.ApplyCurrentThemeType; // we must call this every time we change Preferences.ThemeType field
 var
   i: Integer;
+  titleBar: TSpTBXTitleBar;
+  c: TControl;
+  f: TForm;
+  h: Integer;
 begin
   for i := 0 to Screen.FormCount-1 do
   begin
-    if (Screen.Forms[i].ClassType = TCustomizeGUIForm) or (Screen.Forms[i].ClassType = THttpGetForm) then
-      Continue;
-    SkinManager.ChangeControlSkinType(Screen.Forms[i],Preferences.ThemeType,True);
-    if (Preferences.ThemeType&lt;&gt;sknSkin) or not Preferences.SkinnedTitlebars then
+    f := Screen.Forms[i];
+    if (f &lt;&gt; SplashScreenForm) and (f &lt;&gt; CustomizeGUIForm) and (f &lt;&gt; HttpGetForm) then
     begin
-      try
-        TSpTBXTitleBar(Screen.Forms[i].FindChildControl('SpTBXTitleBar1')).Active := False;
-      except
+      SkinManager.ChangeControlSkinType(f,Preferences.ThemeType,True);
+
+      if MainForm.Visible then Continue;
+
+      c := f.FindChildControl('SpTBXTitleBar1');
+      if c = nil then
+        c := f.FindChildControl('MainTitleBar');
+
+      if c &lt;&gt; nil then
+      begin
+        titleBar := TSpTBXTitleBar(c);
+        if (Preferences.ThemeType=sknSkin) and Preferences.SkinnedTitlebars then
+        begin
+          h := f.Height;
+          titleBar.Active := True;
+          titleBar.Refresh;
+          f.BorderStyle := Forms.bsNone;
+          f.Height := h-GetSystemMetrics(SM_CYCAPTION)-SkinManager.CurrentSkin.FloatingWindowBorderSize*2;
+        end
+        else if titleBar.FixedSize and not titleBar.Active then
+        begin
+          f.BorderStyle := bsDialog;
+          titleBar.Align := alNone;
+          titleBar.Top := -26;
+          f.HorzScrollBar.Visible := False;
+          f.VertScrollBar.Visible := false;
+          f.Width := f.Width-5;
+          f.Height := f.Height-26;
+        end;
       end;
-      try
-        TSpTBXTitleBar(Screen.Forms[i].FindChildControl('MainTitleBar')).Active := False;
-      except
-      end;
     end;
   end;
 
@@ -897,6 +922,7 @@
     ReplaysForm.ScriptRichEdit.BorderStyle := Forms.bsNone;
     BattleForm.AutoHostMsgsRichEdit.Color := IfNotClNone(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1,clBtnFace);
     HelpForm.TntScrollBox1.Color := IfNotClNone(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1,clWindow);
+    AwayMessageForm.MessageRichEdit.BorderStyle := Forms.bsNone;
     AwayMessageForm.MessageRichEdit.Color := IfNotClNone(SkinManager.CurrentSkin.Options(skncTabBackground).Body.Color1,clWindow);
     HostInfoForm.Label3.Font.Color := clWhite;
     HostInfoForm.Label5.Font.Color := clWhite;
@@ -925,6 +951,7 @@
     ReplaysForm.ScriptRichEdit.BorderStyle :=Forms.bsSingle;
     BattleForm.AutoHostMsgsRichEdit.Color := clBtnFace;
     HelpForm.TntScrollBox1.Color := clWindow;
+    AwayMessageForm.MessageRichEdit.BorderStyle := Forms.bsSingle;
     AwayMessageForm.MessageRichEdit.Color := clWindow;
     HostInfoForm.Label3.Font.Color := clBlue;
     HostInfoForm.Label5.Font.Color := clBlue;
@@ -933,6 +960,7 @@
     BattleForm.lblUnits.Font.Color := clBlue;
     MapListForm.lblLoadMissingMinimaps.Font.Color := clBlue;
     MapListForm.SortLabel.Font.Color := clBlue;
+    MapListForm.ScrollBox1.Color :=  clMedGray;
     MainForm.MainDockPanel.Color :=  clBtnFace;
     BattleForm.BattleMiddlePanel.Color :=  clBtnFace;
     BattleForm.MapPanel.Color :=  clBtnFace;
@@ -1331,9 +1359,6 @@
   i:integer;
 begin
   TranslateComponent(self);
-  
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 
   SpTBXTabControl1.ActiveTabIndex := 0;
 
@@ -1531,18 +1556,21 @@
 
 procedure TPreferencesForm.SpTBXRadioButton1Click(Sender: TObject);
 begin
+  if not (Sender is TSpTBXRadioButton) or not TSpTBXRadioButton(Sender).Focused then Exit;
   Preferences.ThemeType := sknNone;
   ApplyCurrentThemeType;
 end;
 
 procedure TPreferencesForm.SpTBXRadioButton2Click(Sender: TObject);
 begin
+  if not (Sender is TSpTBXRadioButton) or not TSpTBXRadioButton(Sender).Focused then Exit;
   Preferences.ThemeType := sknWindows;
   ApplyCurrentThemeType;
 end;
 
 procedure TPreferencesForm.SpTBXRadioButton3Click(Sender: TObject);
 begin
+  if not (Sender is TSpTBXRadioButton) or not TSpTBXRadioButton(Sender).Focused then Exit;
   Preferences.ThemeType := sknSkin;
   ApplyCurrentThemeType;
 end;

Modified: Lobby/TASClient/ProgressBarWindow.dfm
===================================================================
--- Lobby/TASClient/ProgressBarWindow.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ProgressBarWindow.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -28,6 +28,7 @@
     Width = 425
     Height = 65
     Caption = 'SpTBXTitleBar1'
+    Active = False
     FixedSize = True
     Options.Close = False
     Options.Minimize = False

Modified: Lobby/TASClient/ProgressBarWindow.pas
===================================================================
--- Lobby/TASClient/ProgressBarWindow.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ProgressBarWindow.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -56,9 +56,6 @@
 procedure TProgressBarForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-  
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 end.

Modified: Lobby/TASClient/Python/api.txt
===================================================================
--- Lobby/TASClient/Python/api.txt	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/Python/api.txt	2010-04-17 23:30:14 UTC (rev 7470)
@@ -41,6 +41,7 @@
 
 callout :
 
+- GetVersion: string
 - Print(string) thread safe debug print
 - Disconnect
 - ExitLobby

Modified: Lobby/TASClient/ReplaysUnit.dfm
===================================================================
--- Lobby/TASClient/ReplaysUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/ReplaysUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 852
     Height = 604
     Caption = 'Replays'
+    Active = False
     DesignSize = (
       852
       604)

Modified: Lobby/TASClient/SpringDownloaderFormUnit.dfm
===================================================================
--- Lobby/TASClient/SpringDownloaderFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/SpringDownloaderFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,6 +1,6 @@
 object SpringDownloaderForm: TSpringDownloaderForm
-  Left = 240
-  Top = 33
+  Left = 226
+  Top = 127
   BorderStyle = bsDialog
   Caption = 'Downloading ...'
   ClientHeight = 174
@@ -25,6 +25,7 @@
     Width = 455
     Height = 174
     Caption = 'Downloading ...'
+    Active = False
     FixedSize = True
     Options.Maximize = False
     DesignSize = (

Modified: Lobby/TASClient/SpringDownloaderFormUnit.pas
===================================================================
--- Lobby/TASClient/SpringDownloaderFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/SpringDownloaderFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -5,7 +5,7 @@
 uses
   Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, SpTBXItem, SpTBXControls, JclRegistry, ExtCtrls,ShellAPI,
-  LobbyScriptUnit, Math;
+  LobbyScriptUnit, Math, SpTBXSkins;
 
 type
   TProgressEvent = procedure(snc: PScriptDownloadCallback;progress: integer) of object;
@@ -77,7 +77,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := MainForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 
@@ -244,9 +244,10 @@
 procedure TSpringDownloaderForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 
+  if Preferences.ThemeType = sknSkin then
+    SpTBXTitleBar1.Active := True;
+
   FOnProgress := nil;
 end;
 

Modified: Lobby/TASClient/SpringSettingsProfileFormUnit.dfm
===================================================================
--- Lobby/TASClient/SpringSettingsProfileFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/SpringSettingsProfileFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 398
     Height = 385
     Caption = 'Spring settings profiles'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/SpringSettingsProfileFormUnit.pas
===================================================================
--- Lobby/TASClient/SpringSettingsProfileFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/SpringSettingsProfileFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -53,9 +53,6 @@
 procedure TSpringSettingsProfileForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-  
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 
   cpNames := TStringList.Create;
   cpFiles := TStringList.Create;

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/TASClient.dof	2010-04-17 23:30:14 UTC (rev 7470)
@@ -113,9 +113,9 @@
 IncludeVerInfo=1
 AutoIncBuild=1
 MajorVer=0
-MinorVer=72
+MinorVer=73
 Release=0
-Build=874
+Build=885
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=Spring RTS Engine lobby client
-FileVersion=0.72.0.874
+FileVersion=0.73.0.885
 InternalName=
 LegalCopyright=
 LegalTrademarks=
@@ -141,8 +141,9 @@
 Count=1
 Item0=WinTypes=Windows;WinProcs=Windows;DbiTypes=BDE;DbiProcs=BDE;DbiErrs=BDE;
 [HistoryLists\hlSearchPath]
-Count=1
+Count=2
 Item0=hics32-1_5_1
+Item1=$(DELPHI)\Lib\Debug;D:\Tools\DEVELO~1\TASCLI~2\01_JCL\lib\d7\debug;hics32-1_5_1
 [HistoryLists\hlOutputDirectorry]
 Count=1
 Item0=C:\Program Files\Spring

Modified: Lobby/TASClient/TASClient.dpr
===================================================================
--- Lobby/TASClient/TASClient.dpr	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/TASClient.dpr	2010-04-17 23:30:14 UTC (rev 7470)
@@ -84,7 +84,6 @@
   SpringDownloaderFormUnit in 'SpringDownloaderFormUnit.pas' {SpringDownloaderForm},
   LogonFormUnit in 'LogonFormUnit.pas' {LogonForm},
   MapSelectionFormUnit in 'MapSelectionFormUnit.pas' {MapSelectionForm},
-  OKCANCL1 in '..\..\..\Program Files\Borland\Delphi7\ObjRepos\OKCANCL1.pas' {OKBottomDlg},
   TipsFormUnit in 'TipsFormUnit.pas' {TipsForm},
   CustomizeGUIFormUnit in 'CustomizeGUIFormUnit.pas' {CustomizeGUIForm},
   SetValuesFormUnit in 'SetValuesFormUnit.pas' {SetValuesForm},
@@ -164,8 +163,10 @@
   if MainUnit.Debug.Enabled then
     Misc.TryToAddLog(MainUnit.StartDebugLog,'Loading preferences ...');
 
-  // first create splash screen (but preferences must already be loaded!):
-  //Application.CreateForm(TSplashScreenForm, SplashScreenForm);
+  // preload preferences, since we need to know about &quot;TaskbarButtons&quot; field before we create other forms:
+  Preferences := DEFAULT_PREFERENCES;
+  PreferencesForm.ReadPreferencesRecordFromRegistry(Preferences);
+
   SplashScreenForm := TSplashScreenForm.Create(nil);
   SplashScreenForm.VersionLabel.Caption := VERSION_NUMBER;
   SplashScreenForm.Show;
@@ -173,10 +174,6 @@
   // load the tasclient.ini file
   LoadTASClientIni(CUSTOM_TASCLIENT_FILE);
     
-  // preload preferences, since we need to know about &quot;TaskbarButtons&quot; field before we create other forms:
-  Preferences := DEFAULT_PREFERENCES;
-  PreferencesForm.ReadPreferencesRecordFromRegistry(Preferences);
-
   MainUnit.RunningUnderWine := MainUnit.RunningUnderWine;
 
   if MainUnit.Debug.Enabled then

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)

Modified: Lobby/TASClient/TipsFormUnit.dfm
===================================================================
--- Lobby/TASClient/TipsFormUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/TipsFormUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 369
     Height = 317
     Caption = 'Tips'
+    Active = False
     FixedSize = True
     Options.Maximize = False
     object btNextTip: TSpTBXButton

Modified: Lobby/TASClient/TipsFormUnit.pas
===================================================================
--- Lobby/TASClient/TipsFormUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/TipsFormUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -109,9 +109,6 @@
   
   TipList := TList.Create;
   CurrentFormTipList := TList.Create;
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 procedure TTipsForm.btNextTipClick(Sender: TObject);

Modified: Lobby/TASClient/UploadReplayUnit.dfm
===================================================================
--- Lobby/TASClient/UploadReplayUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/UploadReplayUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -26,6 +26,7 @@
     Width = 494
     Height = 345
     Caption = 'Upload replay'
+    Active = False
     Options.Maximize = False
     object SpTBXGroupBox1: TSpTBXGroupBox
       Left = 16

Modified: Lobby/TASClient/UploadReplayUnit.pas
===================================================================
--- Lobby/TASClient/UploadReplayUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/UploadReplayUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -181,9 +181,6 @@
 procedure TUploadReplayForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-  
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 procedure TUploadReplayForm.DeleteButtonClick(Sender: TObject);

Modified: Lobby/TASClient/WaitForAckUnit.dfm
===================================================================
--- Lobby/TASClient/WaitForAckUnit.dfm	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/WaitForAckUnit.dfm	2010-04-17 23:30:14 UTC (rev 7470)
@@ -1,11 +1,10 @@
 object WaitForAckForm: TWaitForAckForm
   Left = 518
   Top = 582
+  Width = 278
+  Height = 141
   BorderIcons = [biSystemMenu]
-  BorderStyle = bsSingle
   Caption = 'Waiting for acknowledgement'
-  ClientHeight = 114
-  ClientWidth = 270
   Color = clBtnFace
   Constraints.MaxHeight = 1000
   Constraints.MaxWidth = 1680
@@ -28,6 +27,7 @@
     Width = 270
     Height = 114
     Caption = 'Waiting for acknowledgement'
+    Active = False
     FixedSize = True
     Options.Minimize = False
     Options.Maximize = False

Modified: Lobby/TASClient/WaitForAckUnit.pas
===================================================================
--- Lobby/TASClient/WaitForAckUnit.pas	2010-04-16 22:04:07 UTC (rev 7469)
+++ Lobby/TASClient/WaitForAckUnit.pas	2010-04-17 23:30:14 UTC (rev 7470)
@@ -51,7 +51,7 @@
 
   with Params do begin
     ExStyle := ExStyle or WS_EX_APPWINDOW;
-    WndParent := BattleForm.Handle;
+    WndParent := GetDesktopWindow;
   end;
 end;
 
@@ -99,11 +99,6 @@
 procedure TWaitForAckForm.FormCreate(Sender: TObject);
 begin
   TranslateComponent(self);
-
-  SpTBXTitleBar1.Active := Preferences.ThemeType=sknSkin;
-
-  if not SpTBXTitleBar1.Active then
-    RemoveSpTBXTitleBarMarges(self);
 end;
 
 end.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002239.html">[Taspring-linux-commit] r7469 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="002241.html">[Taspring-linux-commit] r7471 - Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2240">[ date ]</a>
              <a href="thread.html#2240">[ thread ]</a>
              <a href="subject.html#2240">[ subject ]</a>
              <a href="author.html#2240">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
