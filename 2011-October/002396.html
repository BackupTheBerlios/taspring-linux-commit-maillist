<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r7626 - Lobby/TASClient
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2011-October/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7626%20-%20Lobby/TASClient&In-Reply-To=%3C20111016111327.2DF66377E9%40it-l.eu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002395.html">
   <LINK REL="Next"  HREF="002397.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r7626 - Lobby/TASClient</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r7626%20-%20Lobby/TASClient&In-Reply-To=%3C20111016111327.2DF66377E9%40it-l.eu%3E"
       TITLE="[Taspring-linux-commit] r7626 - Lobby/TASClient">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Sun Oct 16 13:13:27 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002395.html">[Taspring-linux-commit] r7625 - Lobby/TASClient
</A></li>
        <LI>Next message: <A HREF="002397.html">[Taspring-linux-commit] r7627 - Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2396">[ date ]</a>
              <a href="thread.html#2396">[ thread ]</a>
              <a href="subject.html#2396">[ subject ]</a>
              <a href="author.html#2396">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: satirik
Date: 2011-10-16 13:13:23 +0200 (Sun, 16 Oct 2011)
New Revision: 7626

Modified:
   Lobby/TASClient/BattleFormUnit.dfm
   Lobby/TASClient/BattleFormUnit.pas
   Lobby/TASClient/HelpUnit.dfm
   Lobby/TASClient/HelpUnit.pas
   Lobby/TASClient/HostBattleFormUnit.pas
   Lobby/TASClient/LobbyScriptUnit.pas
   Lobby/TASClient/MainUnit.dfm
   Lobby/TASClient/MainUnit.pas
   Lobby/TASClient/MapListFormUnit.pas
   Lobby/TASClient/PreferencesFormUnit.pas
   Lobby/TASClient/ProgressBarWindow.pas
   Lobby/TASClient/TASClient.dof
   Lobby/TASClient/TASClient.res
Log:
* removed every references to the old ladder system

Modified: Lobby/TASClient/BattleFormUnit.dfm
===================================================================
--- Lobby/TASClient/BattleFormUnit.dfm	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/BattleFormUnit.dfm	2011-10-16 11:13:23 UTC (rev 7626)
@@ -1,6 +1,6 @@
 object BattleForm: TBattleForm
-  Left = 1203
-  Top = 198
+  Left = 745
+  Top = 271
   Width = 923
   Height = 638
   Caption = 'Battle window'
@@ -4663,17 +4663,6 @@
         TabOrder = 5
         DropDownMenu = AdminPopupMenu
       end
-      object LadderRulesButton: TSpTBXButton
-        Left = 797
-        Top = 8
-        Width = 97
-        Height = 25
-        Caption = 'Ladder'
-        Anchors = [akTop, akRight]
-        TabOrder = 6
-        Visible = False
-        DropDownMenu = LadderPopupMenu
-      end
       object SSProfileButton: TSpTBXButton
         Left = 797
         Top = 8
@@ -4684,7 +4673,7 @@
         Anchors = [akTop, akRight]
         ParentShowHint = False
         ShowHint = True
-        TabOrder = 7
+        TabOrder = 6
         DropDownMenu = SpringSettingsProfilePopupMenu
       end
       object StartProgressBar: TSpTBXProgressBar
@@ -4720,7 +4709,7 @@
         Width = 105
         Height = 25
         Caption = 'Join'
-        TabOrder = 10
+        TabOrder = 9
         Visible = False
         OnClick = JoinButtonClick
       end
@@ -13488,31 +13477,6 @@
     Left = 572
     Top = 307
   end
-  object LadderPopupMenu: TSpTBXPopupMenu
-    AutoHotkeys = maManual
-    Left = 868
-    Top = 539
-    object SpTBXItem9: TSpTBXItem
-      Caption = 'Rules'
-      OnClick = SpTBXItem9Click
-    end
-    object SpTBXItem11: TSpTBXItem
-      Caption = 'Refresh maps'
-      OnClick = SpTBXItem11Click
-    end
-    object SpTBXItem10: TSpTBXItem
-      Caption = 'Refresh ranks and cups'
-      OnClick = SpTBXItem10Click
-    end
-    object SpTBXSeparatorItem8: TSpTBXSeparatorItem
-    end
-    object SpTBXItem12: TSpTBXItem
-      Caption = 'Ladder Headquarters'
-      OnClick = SpTBXItem12Click
-    end
-    object SpTBXSeparatorItem12: TSpTBXSeparatorItem
-    end
-  end
   object MapsPopupMenu: TSpTBXFormPopupMenu
     TrackButton = tbLeftButton
     OnPopup = MapsPopupMenuPopup

Modified: Lobby/TASClient/BattleFormUnit.pas
===================================================================
--- Lobby/TASClient/BattleFormUnit.pas	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/BattleFormUnit.pas	2011-10-16 11:13:23 UTC (rev 7626)
@@ -81,21 +81,13 @@
     mnuFixTeams: TSpTBXItem;
     mnuBlockTeams: TSpTBXItem;
     HttpCli2: THttpCli;
-    LadderRulesButton: TSpTBXButton;
     HttpCli3: THttpCli;
-    LadderPopupMenu: TSpTBXPopupMenu;
-    SpTBXItem9: TSpTBXItem;
-    SpTBXItem10: TSpTBXItem;
-    SpTBXItem11: TSpTBXItem;
     RingItem: TSpTBXItem;
     KeepRatioItem: TSpTBXItem;
     SpTBXSeparatorItem7: TSpTBXSeparatorItem;
-    SpTBXItem12: TSpTBXItem;
-    SpTBXSeparatorItem8: TSpTBXSeparatorItem;
     SpTBXSeparatorItem9: TSpTBXSeparatorItem;
     SpTBXSeparatorItem10: TSpTBXSeparatorItem;
     SpTBXSeparatorItem11: TSpTBXSeparatorItem;
-    SpTBXSeparatorItem12: TSpTBXSeparatorItem;
     MapsPopupMenu: TSpTBXFormPopupMenu;
     BattlePlayerListPanel: TSpTBXPanel;
     VDTBattleClients: TVirtualDrawTree;
@@ -392,7 +384,7 @@
     procedure DisconnectButtonClick(Sender: TObject); overload;
     procedure StartPosRadioGroupClick(Sender: TObject);
     procedure GameTimerTimer(Sender: TObject);
-    procedure UploadReplayAndLadderReport;
+    procedure UploadReplay;
     procedure InputEditKeyPress(Sender: TObject; var Key: Char);
     procedure InputEditKeyDown(Sender: TObject; var Key: Word;
       Shift: TShiftState);
@@ -450,7 +442,6 @@
     //  Viewer: TTBItemViewer; Font: TFont; StateFlags: Integer);
     procedure mnuLimitRankAutoKickClick(Sender: TObject);
     procedure SpTBXItem8Click(Sender: TObject);
-    procedure RefreshLadderRanks;
     procedure mnuLimitRankAutoSpecClick(Sender: TObject);
     procedure mnuRankLimitDisabledClick(Sender: TObject);
     procedure VDTBattleClientsDrawHint(Sender: TBaseVirtualTree;
@@ -460,10 +451,6 @@
       Node: PVirtualNode; Column: TColumnIndex; var R: TRect);
     procedure mnuFixTeamsClick(Sender: TObject);
     procedure mnuBlockTeamsClick(Sender: TObject);
-    function LadderTeamReady:boolean;
-    procedure SpTBXItem9Click(Sender: TObject);
-    procedure SpTBXItem10Click(Sender: TObject);
-    procedure SpTBXItem11Click(Sender: TObject);
     procedure RingItemClick(Sender: TObject);
     procedure VDTBattleClientsHeaderClick(Sender: TVTHeader;
   HitInfo: TVTHeaderHitInfo);
@@ -484,7 +471,6 @@
     procedure btLoadDefaultMDOClick(Sender: TObject);
     procedure btLoadDefaultMPOClick(Sender: TObject);
     procedure KeepRatioItemClick(Sender: TObject);
-    procedure SpTBXItem12Click(Sender: TObject);
     procedure VDTDisabledUnitsDrawNode(Sender: TBaseVirtualTree;
       const PaintInfo: TVTPaintInfo);
     procedure ChatExRichEditDblClick(Sender: TObject);
@@ -688,49 +674,6 @@
     Rect: TRect;
     PaintBox: TPaintBox;
   end;
-
-  TLadderRanksThread = class(TThread)
-  private
-    procedure Refresh;
-    procedure OnTerminateProcedure(Sender : TObject);
-
-  protected
-    procedure Execute; override;
-
-  public
-    constructor Create(Suspended : Boolean);
-  end;
-
-  TLadderMapThread = class(TTASClientThread)
-  private
-    StatusMsg : string;
-    StartButtonEnabled: boolean;
-
-    procedure Initialize;
-    procedure Finalize(sbe : boolean);
-    procedure Finalizer;
-    procedure ShowMessageStatus;
-    procedure UpdateMessageStatus(msg : string);
-    procedure Refresh;
-    procedure OnTerminateProcedure(Sender : TObject);
-
-  protected
-    procedure Execute; override;
-    
-  public
-    constructor Create(Suspended : Boolean);
-  end;
-
-  TUploadLadderDataThread = class(TTASClientThread)
-  private
-    procedure UploadData;
-    procedure OnTerminateProcedure(Sender : TObject);
-
-  protected
-    procedure Execute; override;
-  public
-    constructor Create(Suspended : Boolean);
-  end;
 var
   BattleForm: TBattleForm;
   BattleState:
@@ -746,11 +689,9 @@
       WindowHandle : HWND;
     end;
 
-    LadderIndex: integer;
     AutoSendDescription : boolean;
     AutoKickRankLimit : boolean;
     AutoSpecRankLimit : boolean;
-    AutoKickSpringMark : integer;
     StartRects: array of TStartRect;
     DrawingStartRect: Shortint; // if -1, then we are not drawing a &quot;start rectangle&quot;
     MovingStartRect: Shortint; // if -1, then we are not moving a &quot;start rectangle&quot;
@@ -763,7 +704,6 @@
     SelectedStartRect: Shortint; // if -1, no start rect is selected
     BanList:TIntegerList;
     DisabledUnits: TStringList;
-    TryingToJoinLadderBattle: Boolean;
     AutoHost: Boolean;
     AutoHostType: integer; // 0 = SPADS, 1 = Springie
 
@@ -881,22 +821,6 @@
       GameEndRadioGroup.Enabled := not Status;
       if Status then DisableControlAndChildren(ResourcesGroupBox) else EnableControlAndChildren(ResourcesGroupBox);
       if Status then DisableControlAndChildren(UnitsGroupBox) else EnableControlAndChildren(UnitsGroupBox);
-
-      if BattleState.LadderIndex &gt;= 0 then begin
-        LoadDefaultButton.Enabled := False;
-        btLoadDefaultMDO.Enabled := False;
-        btLoadModsDefaultMDO.Enabled := False;
-        btLoadDefaultMPO.Enabled := False;
-        btLoadMapsDefaultMPO.Enabled := False;
-        with TLadder(LadderList[BattleState.LadderIndex]) do begin
-          StartPosRadioGroup.Enabled := StartPosRadioGroup.Enabled and (StartPos = 255);
-          GameEndRadioGroup.Enabled := GameEndRadioGroup.Enabled and (GameMode = 255);
-          MetalTracker.Enabled := MetalTracker.Enabled and ((MetalMin = -1) or (MetalMin &lt;&gt; MetalMax));
-          EnergyTracker.Enabled := EnergyTracker.Enabled and ((EnergyMin = -1) or (EnergyMin &lt;&gt; EnergyMax));
-          UnitsTracker.Enabled := UnitsTracker.Enabled and ((UnitsMin = -1) or (UnitsMin &lt;&gt; UnitsMax));
-          AddUnitsSpeedButton.Enabled := False;
-        end;
-      end;
     end;
   end;
 
@@ -1548,8 +1472,7 @@
   for i:=0 to Utility.MapList.Count-1 do
     if (
       ((filter = '') or (Pos(LowerCase(filter),LowerCase(Utility.MapList[i])) &gt; 0)) and // filter
-      ((Utility.ModValidMaps = nil) or (Utility.ModValidMaps.Count = 0) or (Utility.ModValidMaps.IndexOf(Utility.MapList[i]) &gt;= 0)) and // valid maps
-      ((BattleState.LadderIndex = -1) or (TLadder(LadderList[BattleState.LadderIndex]).Maps.IndexOf(Utility.MapList[i]) &gt;= 0)) // ladder maps
+      ((Utility.ModValidMaps = nil) or (Utility.ModValidMaps.Count = 0) or (Utility.ModValidMaps.IndexOf(Utility.MapList[i]) &gt;= 0)) // valid maps
     ) then
       MapSelectionForm.MapListBox.Items.Add(Utility.MapList[i]);
   MapSelectionForm.MapListBox.Items.EndUpdate;
@@ -1727,7 +1650,6 @@
     Status.AmIInGame := True;
     MainForm.TryToSendCommand('MYSTATUS', '1');
     GameTimer.Enabled := True;
-    BattleState.Battle.RefreshRanksNCupsOnSuccessReport := True;
     if (BattleState.Status = Hosting) and not BattleState.Battle.Locked and mnuAutoLockOnStart.Checked then
       LockedCheckBoxClick(nil);
   end
@@ -1781,7 +1703,6 @@
   btLoadMapsDefaultMPO.Enabled := False;
   AutoStartRectsApplyItem.Enabled := False;
   AutoStartRectsOptionsItem.Enabled := False;
-  LadderRulesButton.Enabled := BattleState.Battle.IsLadderBattle;
 
   MetalTracker.Min := 0;
   MetalTracker.Max:= 10000;
@@ -1883,7 +1804,6 @@
   btLoadMapsDefaultMPO.Enabled := False;
   AutoStartRectsApplyItem.Enabled := False;
   AutoStartRectsOptionsItem.Enabled := False;
-  LadderRulesButton.Enabled := False;
 
 //  SetMyBattleStatus(SideComboBox.ItemIndex, False, 0, 0, 1, MyTeamColorIndex); *** we will update it once we receive REQUESTBATTLESTATUS
   // we will send our battle status to server as soon as we receive REQUESTBATTLESTATUS (server should send it after he is finished sending us battle statuses of other players)
@@ -1934,7 +1854,6 @@
   i:integer;
   disabledUnits: string;
   Battle: TBattle;
-  LMThread : TLadderMapThread;
   validMaps: TStringList;
 begin
   Result := False;
@@ -1966,7 +1885,6 @@
   LockedCheckBox.Checked := False;
   AutoStartRectsApplyItem.Enabled := True;
   AutoStartRectsOptionsItem.Enabled := True;
-  LadderRulesButton.Enabled := BattleState.Battle.IsLadderBattle;
 
   SetMyBattleStatus(MySideButton.Tag, False, 0, 0, 1);
   ChangeTeamColor(MyTeamColorIndex, False);
@@ -1991,9 +1909,6 @@
   if not Preferences.DisableAllSounds then PlayResSound('battle');
   BattleForm.mnuLoadBoxesClick(BattleForm.mnuLoadBoxes);
 
-  if BattleState.LadderIndex &gt; -1 then
-    LMThread := TLadderMapThread.Create(False);
-
   PopulatePopupMenuMapList;
 
   // load map options
@@ -2060,7 +1975,6 @@
   btLoadMapsDefaultMPO.Enabled := False;
   AutoStartRectsApplyItem.Enabled := False;
   AutoStartRectsOptionsItem.Enabled := False;
-  LadderRulesButton.Enabled := BattleState.Battle.IsLadderBattle;
 
   SetMyBattleStatus(0, False, 0, 0, 1);
   // we will send our battle status to server as soon as we receive REQUESTBATTLESTATUS
@@ -2164,7 +2078,6 @@
   btLoadMapsDefaultMPO.Enabled := False;
   AutoStartRectsApplyItem.Enabled := False;
   AutoStartRectsOptionsItem.Enabled := False;
-  LadderRulesButton.Enabled := False;
 
   SetMyBattleStatus(MySideButton.Tag, False, 0, 0, 1);
   DisableControlAndChildren(MyOptionsGroupBox);
@@ -2812,7 +2725,6 @@
   Left := 10;
   Top := 10;
   BattleState.DisabledUnits := TStringList.Create;
-  BattleState.LadderIndex := -1;
 
   FCurrentMapIndex := -1;
   MapHeight := nil;
@@ -2956,7 +2868,7 @@
 
 function TBattleForm.isBattleReadyToStart: Boolean;
 begin
-  Result := (BattleState.Battle &lt;&gt; nil) and BattleState.Battle.AreAllClientsReady and BattleState.Battle.AreAllClientsSynced and LadderTeamReady and (BattleState.Status = Hosting);
+  Result := (BattleState.Battle &lt;&gt; nil) and BattleState.Battle.AreAllClientsReady and BattleState.Battle.AreAllClientsSynced and (BattleState.Status = Hosting);
 end;
 
 procedure TBattleForm.StartButtonClick(Sender: TObject);
@@ -3705,7 +3617,7 @@
       AcquireMainThread;
       try if not Preferences.ScriptsDisabled then handlers.onBackFromGame(); except end;
       ReleaseMainThread;
-      UploadReplayAndLadderReport;
+      UploadReplay;
     end
   else
   begin
@@ -3724,11 +3636,11 @@
     AcquireMainThread;
     try if not Preferences.ScriptsDisabled then handlers.onBackFromGame(); except end;
     ReleaseMainThread;
-    UploadReplayAndLadderReport;
+    UploadReplay;
   end;
 end;
 
-procedure TBattleForm.UploadReplayAndLadderReport;
+procedure TBattleForm.UploadReplay;
 var
   sr: TSearchRec;
   FileAttrs: Integer;
@@ -3736,14 +3648,9 @@
   s,su: string;
   FileName : string;
   i,j:integer;
-  LadderUpThread : TUploadLadderDataThread;
 begin
-  if (not Preferences.UploadReplay and ((BattleState.LadderIndex = -1) or (BattleState.Status = Joined))) or (BattleState.Battle.BattleType=1) then begin
-    if (BattleState.LadderIndex &gt; -1) and (BattleState.Battle.BattleType=0) and (Status.Me.GetMode &lt;&gt; 0) then begin
-      UploadReplayForm.UploadedReplayId := '';
-      ProgressBarForm.TakeAction := 2;
-      ProgressBarForm.ShowModal;
-    end;
+  if not Preferences.UploadReplay or (BattleState.Battle.BattleType=1) then
+  begin
     Exit;
   end;
 
@@ -3771,99 +3678,12 @@
 
   UploadReplayForm.FileName := FileName;
 
-  if BattleState.LadderIndex &gt;= 0 then
-    UploadReplayForm.Description := _('Ladder battle : ') + TLadder(LadderList[BattleState.LadderIndex]).Name;
-
   UploadReplayForm.UploadedReplayId := '';
   UploadReplayForm.AutoUpload := True;
 
   UploadReplayForm.ShowModal;
-
-  if (BattleState.LadderIndex &gt;= 0) and (Status.Me.GetMode &lt;&gt; 0) then begin
-    ProgressBarForm.Close;
-    ProgressBarForm.TakeAction := 2;
-    ProgressBarForm.ShowModal;
-  end;
-
 end;
 
-
-constructor TUploadLadderDataThread.Create(Suspended: Boolean);
-begin
-   FreeOnTerminate := True;
-   inherited Create(Suspended);      
-   OnTerminate := OnTerminateProcedure;
-end;
-
-procedure TUploadLadderDataThread.Execute;
-begin
-  UploadData;
-end;
-
-procedure TUploadLadderDataThread.OnTerminateProcedure(Sender: TObject);
-begin
-  PostMessage(ProgressBarForm.Handle, WM_CLOSE, 0, 0); // close form
-end;
-
-procedure TUploadLadderDataThread.UploadData;
-var
-  ResponseStream: TMemoryStream;
-  ResponseStr : string;
-  MultiPartFormDataStream: TMsMultiPartFormDataStream;
-  ResponseStrList : TStrings;
-begin
-  with UploadReplayForm do begin
-  MultiPartFormDataStream := TMsMultiPartFormDataStream.Create;
-  ResponseStream := TMemoryStream.Create;
-  ResponseStrList := TStringList.Create;
-  try
-    IdHTTP1.Request.ContentType := MultiPartFormDataStream.RequestContentType;
-    MultiPartFormDataStream.AddFormField('username', Preferences.Username);
-    MultiPartFormDataStream.AddFormField('password', Preferences.LadderPassword);
-    MultiPartFormDataStream.AddFormField('replay', UploadReplayForm.UploadedReplayId);
-    MultiPartFormDataStream.AddFormField('submit', 'submit');
-
-    if FileExists('infolog.txt') and FileExists('script.txt') then begin
-      MultiPartFormDataStream.AddFile('infolog', ExtractFilePath(Application.ExeName) + '\infolog.txt' , 'application/octet-stream');
-      MultiPartFormDataStream.AddFile('script', ExtractFilePath(Application.ExeName) + '\script.txt' , 'application/octet-stream');
-    end
-    else
-    begin
-      MessageDlgThread(_('Error : infolog.txt or script.txt not found !'),mtError,[mbOk],0);
-      MultiPartFormDataStream.Free;
-      ResponseStream.Free;
-      Exit;
-    end;
-
-    { You must make sure you call this method *before* sending the stream }
-    MultiPartFormDataStream.PrepareStreamForDispatch;
-    MultiPartFormDataStream.Position := 0;
-    ProgressBarForm.Refresh;
-    ProgressBarForm.pb.Max := MultiPartFormDataStream.Size;
-    ProgressBarForm.pb.Position := 0;
-    IdHTTP1.Post(LADDER_PREFIX_URL+'report.php', MultiPartFormDataStream, ResponseStream);
-    ResponseStream.Seek(0,0);
-    SetLength(ResponseStr, ResponseStream.Size);
-    ResponseStream.ReadBuffer(Pointer(ResponseStr)^, ResponseStream.Size);
-  finally
-    MultiPartFormDataStream.Free;
-    ResponseStream.Free;
-  end;
-  PostMessage(ProgressBarForm.Handle, WM_CLOSE, 0, 0); // close form
-  Misc.ParseDelimited(ResponseStrList,ResponseStr,' ','');
-  if (ResponseStrList.Count &gt; 0) and (ResponseStrList[0] = 'notice') then begin
-    ResponseStrList.Delete(0);
-    MainForm.TryToSendCommand('SAYBATTLEEX', _('has successfully reported the game.'));
-    MessageDlgThread(Misc.JoinStringList(ResponseStrList,' '), mtInformation,[mbOk], 0);
-  end
-  else
-  begin
-    ResponseStrList.Delete(0);
-    MessageDlgThread(Misc.JoinStringList(ResponseStrList,' '), mtInformation,[mbOk], 0);
-  end;
-  end;
-end;
-
 procedure TBattleForm.InputEditKeyPress(Sender: TObject; var Key: Char);
 begin
   if Key = #13 then Key := #0; // To avoid that annoying noise when pressing #13 key (RETURN/ENTER key)
@@ -4290,9 +4110,7 @@
     4: Result := CompareArgs([Client1.GetSync, Client1.DisplayName],[Client2.GetSync, Client2.DisplayName]);
     5: Result := CompareArgs([Client1.CPU],[Client2.CPU]);
     6: Result := CompareArgs([-Client1.GetMode, Client1.GetHandicap],[-Client2.GetMode, Client2.GetHandicap]);
-    7: Result := CompareArgs([Client1.CurrentLadderRank],[Client2.CurrentLadderRank]);
-    8: Result := CompareArgs([Client1.CurrentLadderRating],[Client2.CurrentLadderRating]);
-    9: Result := CompareArgs([BattleState.Battle.Clients.IndexOf(Client1)],[BattleState.Battle.Clients.IndexOf(Client2)]);
+    7: Result := CompareArgs([BattleState.Battle.Clients.IndexOf(Client1)],[BattleState.Battle.Clients.IndexOf(Client2)]);
   end;
 end;
 
@@ -4588,15 +4406,6 @@
           else if TClient(BattleState.Battle.Clients[RealIndex]).GetInGameStatus then
             Canvas.Font.Color := MainUnit.Colors.ClientIngame;
 
-          // cups
-          with TClient(BattleState.Battle.Clients[RealIndex]) do
-          begin
-            for i:=0 to CupList.Count-1 do
-            begin
-              MainForm.LadderCups.Draw(Canvas, R.Left + Pos, R.Top, Integer(CupList[i]^));
-              Inc(Pos, MainForm.LadderCups.Width + 1);
-            end;
-          end;
 
           // username:
           s := TClient(BattleState.Battle.Clients[RealIndex]).DisplayName;
@@ -5568,23 +5377,6 @@
   AutoTeamsForm.ShowModal;
 end;
 
-
-procedure TBattleForm.RefreshLadderRanks;
-var
-  ThreadLR : TLadderRanksThread;
-  i : integer;
-begin
-  for i:=0 to BattleState.Battle.Clients.Count -1 do
-    if TClient(BattleState.Battle.Clients[i]).CurrentLadderId &lt;&gt; BattleState.Battle.GetLadderId then begin
-      TClient(BattleState.Battle.Clients[i]).CurrentLadderRank := -1;
-      TClient(BattleState.Battle.Clients[i]).CurrentLadderRating := -1;
-    end;
-
-  if BattleState.Battle.IsLadderBattle or (BattleState.LadderIndex &gt; -1) then begin
-    ThreadLR := TLadderRanksThread.Create(False);
-  end;
-end;
-
 procedure TBattleForm.mnuLimitRankAutoSpecClick(Sender: TObject);
 var
   i: integer;
@@ -5785,320 +5577,6 @@
   mnuBlockTeams.Checked := not mnuBlockTeams.Checked;
 end;
 
-constructor TLadderRanksThread.Create(Suspended: Boolean);
-begin
-   FreeOnTerminate := True;
-   inherited Create(Suspended);
-   OnTerminate := OnTerminateProcedure;
-end;
-
-procedure TLadderRanksThread.Execute;
-begin
-  Refresh;
-end;
-
-procedure TLadderRanksThread.Refresh;
-var
-  i,j,k:integer;
-  phpParams:string;
-  playerList : TStrings;
-  html:string;
-  parse1 : TStrings;
-  parse2 : TStrings;
-  nick : PChar;
-  forceSpecNickList: TStringList;
-begin
-  if BattleState.LadderIndex = -1 then
-    Exit;
-
-  forceSpecNickList := TStringList.Create;
-    
-  with BattleForm do begin
-  playerList := TStringList.Create;
-  parse1 := TStringList.Create;
-  parse2 := TStringList.Create;
-  if (BattleState.Status = None) then
-    Exit;
-
-  // make the list of player without ladder data (now all players are refreshed each time someone join)
-  for i:=0 to BattleState.Battle.Clients.Count-1 do
-    playerList.Add(TClient(BattleState.Battle.Clients[i]).Name);
-
-  playerList.Add(TClient(Status.Me).Name);
-
-  if playerList.Count &gt; 0 then begin
-    // make the php parameters url
-    phpParams := '';
-    for i:=0 to playerList.Count-1 do
-      phpParams := phpParams+'&amp;players[]='+playerList[i];
-
-    // get the html result
-    with BattleForm do begin
-      {if Preferences.UseProxy then
-      begin
-        HttpCli3.Proxy := Preferences.ProxyAddress;
-        HttpCli3.ProxyPort := IntToStr(Preferences.ProxyPort);
-        HttpCli3.ProxyUsername := Preferences.ProxyUsername;
-        HttpCli3.ProxyPassword := Preferences.ProxyPassword
-      end
-      else }HttpCli3.Proxy := '';
-      HttpCli3.URL := LADDER_PREFIX_URL + 'ranking.php?ladder='+IntToStr(TLadder(LadderList[BattleState.LadderIndex]).id)+phpParams;
-      HttpCli3.RcvdStream := TMemoryStream.Create;
-      try
-        HttpCli3.Get;
-      except
-        MainForm.AddMainLog(_('Error: Ladder server unavailable.'), Colors.Error);
-        Exit;
-      end;
-      HttpCli3.RcvdStream.Seek(0,0);
-      SetLength(html, HttpCli3.RcvdStream.Size);
-      HttpCli3.RcvdStream.ReadBuffer(Pointer(html)^, HttpCli3.RcvdStream.Size);
-    end;
-    // set all players to refresh to 'no ladder record'
-    for i:=0 to BattleState.Battle.Clients.Count-1 do
-      if TClient(BattleState.Battle.Clients[i]).CurrentLadderRank = -1 then
-      begin
-        TClient(BattleState.Battle.Clients[i]).CurrentLadderRank := -2;
-        TClient(BattleState.Battle.Clients[i]).CurrentLadderRating := -2;
-      end;
-
-    // parse the html result
-    Misc.ParseDelimited(parse1,html,#$A,'');
-    for i:= 0 to parse1.Count -1 do // for each player result
-      if parse1[i] &lt;&gt; '' then begin
-        Misc.ParseDelimited(parse2,parse1[i],' ','');
-        // find the player in battlelist
-        for j:= 0 to BattleState.Battle.Clients.count-1 do begin
-          if TClient(BattleState.Battle.Clients[j]).Name = parse2[0] then begin
-            with TClient(BattleState.Battle.Clients[j]) do begin
-              if parse2[1] = 'n/a' then
-              begin
-                CurrentLadderRating := 0;
-                if (GetMode &lt;&gt; 0) and (BattleState.Status = Hosting) then
-                begin
-                  MainForm.TryToSendCommand('FORCESPECTATORMODE', Name);
-                  forceSpecNickList.Add(Name);
-                end;
-              end
-              else
-                CurrentLadderRating := StrToInt(parse2[1]);
-              if parse2[2] = 'n/a' then
-                CurrentLadderRank := 0
-              else
-                CurrentLadderRank := StrToInt(parse2[2]);
-              CurrentLadderId := TLadder(LadderList[BattleState.LadderIndex]).id;
-            end;
-            break;
-          end;
-        end;
-      end;
-      VDTBattleClients.Refresh;
-      if forceSpecNickList.Count &gt;0 then
-        MainForm.TryToSendCommand('SAYBATTLEEX', 'is forcing spectator players without ladder account: '+JoinStringList(forceSpecNickList,' '));
-      forceSpecNickList.Free;
-  end;
-  end;
-end;
-
-procedure TLadderRanksThread.OnTerminateProcedure(Sender: TObject);
-begin
-end;
-
-constructor TLadderMapThread.Create(Suspended: Boolean);
-begin
-   FreeOnTerminate := True;
-   inherited Create(Suspended);
-   OnTerminate := OnTerminateProcedure;
-end;
-
-procedure TLadderMapThread.Execute;
-begin
-  Refresh;
-end;
-
-procedure TLadderMapThread.Initialize;
-begin
-    MapSelectionForm.MapListBox.Enabled := false;
-    MapSelectionForm.MapListBox.Items.Clear;
-    MapSelectionForm.MapListBox.Items.Add(_('Loading ladder map list ...'));
-    BattleForm.StartButton.Enabled := False;
-end;
-
-procedure TLadderMapThread.Finalize(sbe : boolean);
-begin
-    StartButtonEnabled := sbe;
-    Synchronize(Finalizer);
-end;
-
-procedure TLadderMapThread.Finalizer;
-begin
-  if BattleState.Status = Hosting then
-    BattleForm.StartButton.Enabled := StartButtonEnabled;
-  MapSelectionForm.MapListBox.Enabled := True;
-  BattleForm.MinimapPanelResize(nil);
-end;
-
-procedure TLadderMapThread.ShowMessageStatus;
-begin
-  MapSelectionForm.MapListBox.Items.Strings[0] := StatusMsg;
-end;
-
-procedure TLadderMapThread.UpdateMessageStatus(msg : string);
-begin
-  StatusMsg := msg;
-  Synchronize(ShowMessageStatus);
-end;
-
-procedure TLadderMapThread.Refresh;
-var
-  html:string;
-  i: integer;
-  sl : TStringList;
-begin
-  with BattleForm do begin
-    Synchronize(Initialize);
-    // get the html result
-
-    {if Preferences.UseProxy then
-    begin
-      HttpCli2.Proxy := Preferences.ProxyAddress;
-      HttpCli2.ProxyPort := IntToStr(Preferences.ProxyPort);
-      HttpCli2.ProxyUsername := Preferences.ProxyUsername;
-      HttpCli2.ProxyPassword := Preferences.ProxyPassword
-    end
-    else }HttpCli2.Proxy := '';
-    HttpCli2.URL := LADDER_PREFIX_URL + 'maplist.php?ladder='+IntToStr(TLadder(LadderList[BattleState.LadderIndex]).id);
-    HttpCli2.RcvdStream := TMemoryStream.Create;
-    try
-      HttpCli2.Get;
-    except
-      // try again:
-      try
-        HttpCli2.Get;
-      except
-        //MainForm.AddMainLog('Error: Ladder map list unavailable :'+IntToStr(TLadder(LadderList[BattleState.LadderIndex]).id), Colors.Error);
-        UpdateMessageStatus('Error: Ladder server unavailable.');
-        Finalize(isBattleReadyToStart);
-        MessageDlgThread(_('The ladder server is unavailable, if the ladder url has changed you may fix this by updating your lobby.'),mtError,[mbOk],0);
-        Synchronize(BattleForm.DisconnectButtonClick);
-        Exit;
-      end;
-    end;
-    HttpCli2.RcvdStream.Seek(0,0);
-    SetLength(html, HttpCli2.RcvdStream.Size);
-    HttpCli2.RcvdStream.ReadBuffer(Pointer(html)^, HttpCli2.RcvdStream.Size);
-
-    if html = '' then
-    begin
-      UpdateMessageStatus(_('Error: Empty map list.'));
-      Finalize(False);
-      Exit;
-    end;
-
-    if LowerCase(LeftStr(html,6)) = 'error' then
-    begin
-      //UpdateMessageStatus('Error: Ladder not found.');
-      MessageDlgThread('The ladder you joined does not exist, if the ladder url has changed you may fix this by updating your lobby.',mtError,[mbOk],0);
-      Synchronize(BattleForm.DisconnectButtonClick);
-      Finalize(false);
-      Exit;
-    end;
-
-    Misc.ParseDelimited(TLadder(LadderList[BattleState.LadderIndex]).Maps,html,#$A,'');
-
-    Synchronize(BattleForm.PopulatePopupMenuMapList);
-
-    if BattleState.Status = Hosting then
-    begin
-      if MapSelectionForm.MapListBox.Items.Count &gt; 0 then
-      begin
-        Synchronize(ChangeMapToFirstOne);
-        if IsBattleActive and (BattleState.Status = Hosting) then
-          Synchronize(SendBattleInfoToServer);
-      end
-      else
-      begin
-        DisconnectButtonClick(nil);
-        sl := TStringList.Create;
-        if Utility.ModValidMaps.Count = 0 then
-          sl.Assign(TLadder(LadderList[BattleState.LadderIndex]).Maps)
-        else
-        begin
-          for i:=0 to Utility.ModValidMaps.Count-1 do
-          begin
-            if TLadder(LadderList[BattleState.LadderIndex]).Maps.IndexOf(Utility.ModValidMaps[i]) &gt; -1 then
-              sl.Add(Utility.ModValidMaps[i]);
-          end;
-        end;
-        if sl.Count = 0 then
-          MessageDlgThread(_('You can''t play this ladder with that mod because no map from the ladder is valid for this mod.'), mtWarning, [mbOK], 0)
-        else
-          MessageDlgThread(_('To host this ladder battle, you need at least one of the following map :')+EOL+Misc.JoinStringList(sl,' ; '), mtWarning, [mbOK], 0);
-        Finalize(false);
-        Exit;
-      end;
-
-      Finalize(isBattleReadyToStart);
-  end;
- end;
-end;
-
-procedure TLadderMapThread.OnTerminateProcedure(Sender: TObject);
-begin
-  // nothing
-end;
-
-function TBattleForm.LadderTeamReady:boolean;
-var
-  i : integer;
-  nb : array [1..MAX_TEAMS] of Integer;
-  nbTeam : integer;
-begin
-  if (BattleState.Status &lt;&gt; None) and (BattleState.LadderIndex &gt;=0) then begin
-    for i:= 1 to MAX_TEAMS do begin
-      nb[i] := 0;
-    end;
-    for i:=0 to BattleState.Battle.Clients.Count-1 do begin
-      if TClient(BattleState.Battle.Clients[i]).GetMode &lt;&gt; 0 then begin
-        nb[TClient(BattleState.Battle.Clients[i]).GetAllyNo+1] := nb[TClient(BattleState.Battle.Clients[i]).GetAllyNo+1] + 1;
-      end;
-    end;
-    with TLadder(LadderList[BattleState.LadderIndex]) do begin
-      Result := False;
-      nbTeam := 0;
-      for i:= 1 to MAX_TEAMS do
-        if nb[i] &gt; 0 then begin
-          nbTeam := nbTeam +1;
-          if (nbTeam &gt; 2) or (nb[i] &lt; MinPlayersPerAllyTeam) or (nb[i] &gt; MaxPlayersPerAllyTeam) then
-            Exit;
-        end;
-      if nbTeam &lt; 2 then
-        Exit;
-      Result := True;
-    end;
-  end
-  else
-    Result := True;
-end;
-
-procedure TBattleForm.SpTBXItem9Click(Sender: TObject);
-begin
-  MessageDlg(TLadder(LadderList[BattleState.LadderIndex]).Rules,mtInformation,[mbOk],0);
-end;
-
-procedure TBattleForm.SpTBXItem10Click(Sender: TObject);
-begin
-  RefreshLadderRanks;
-  MainForm.LadderCupsRefreshTimer(nil);
-end;
-
-procedure TBattleForm.SpTBXItem11Click(Sender: TObject);
-var
-  LMThread : TLadderMapThread;
-begin
-  LMThread := TLadderMapThread.Create(false);
-end;
-
 procedure TBattleForm.RingItemClick(Sender: TObject);
 var
   RealIndex: Integer;
@@ -6353,11 +5831,6 @@
   MinimapPanelResize(nil);
 end;
 
-procedure TBattleForm.SpTBXItem12Click(Sender: TObject);
-begin
-  Misc.OpenURLInDefaultBrowser('<A HREF="http://springladder.no-ip.org/">http://springladder.no-ip.org/</A>');
-end;
-
 procedure TBattleForm.PopulateDisabledUnitsVDT;
 begin
   VDTDisabledUnits.Clear;

Modified: Lobby/TASClient/HelpUnit.dfm
===================================================================
--- Lobby/TASClient/HelpUnit.dfm	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/HelpUnit.dfm	2011-10-16 11:13:23 UTC (rev 7626)
@@ -1,6 +1,6 @@
 object HelpForm: THelpForm
-  Left = 282
-  Top = 318
+  Left = 483
+  Top = 520
   Width = 793
   Height = 506
   Caption = 'Help'
@@ -33,11 +33,10 @@
       Top = 24
       Width = 785
       Height = 417
-      ActiveTabIndex = 0
+      ActiveTabIndex = 2
       HiddenItems = &lt;&gt;
       object SpTBXTabItem3: TSpTBXTabItem
         Caption = 'Icons and Shortcuts'
-        Checked = True
         CustomHeight = 35
         FontSettings.Style = [fsBold]
       end
@@ -47,231 +46,9 @@
       end
       object SpTBXTabItem1: TSpTBXTabItem
         Caption = 'Tips and commands'
+        Checked = True
         FontSettings.Style = [fsBold]
       end
-      object SpTBXTabItem4: TSpTBXTabItem
-        Caption = 'Page 4'
-        Visible = False
-      end
-      object SpTBXTabSheet4: TSpTBXTabSheet
-        Left = 0
-        Top = 39
-        Width = 785
-        Height = 378
-        Caption = 'Page 4'
-        ImageIndex = -1
-        TabVisible = False
-        TabItem = 'SpTBXTabItem4'
-        object Image12: TImage
-          Left = 56
-          Top = 56
-          Width = 17
-          Height = 17
-          Picture.Data = {
-            07544269746D617036050000424D360500000000000036040000280000001000
-            000010000000010008000000000000010000130B0000130B0000000100000001
-            00000793AC0000D2FE0000E0FE008EFEFE0000E1FE000098A70000F3FE0000E9
-            DC000490CA0000D7FE00E1FCEC0000C5FB0000A0A6000492AB0076EBDA000091
-            CC00029EE900009CD200A0E9F100D1ECFE00DDFEE10000ECFE009EFEFE0000CE
-            FE0001F3FE0000ACA80001DEF00047E6F30001ECE00000E2F00090FBFE000084
-            CA0000E7FE0000B1A4000AE1FE0000A9AA0001DEE80000DEF60000D0CE00B2FE
-            F5000085BE0000CFFE0085EDFE0000E3DE00FFFFFF0000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            00002C2C2C2C2C2C2C2C2C2C2C2C2C2C2C2C2C2C2C2C2C0000000000002C2C2C
-            2C2C2C2C2C2C2C001C032421002C2C2C2C2C2C2C2C2C2C2C000000002C2C2C2C
-            2C2C2C2C2C2C2C2C2C00002C2C2C2C2C2C2C2C2C2C2C2C2C2C00002C2C2C2C2C
-            2C2C2C2C2C2C2C2C00190D002C2C2C2C2C2C2C2C2C2C2C0002010F05002C2C2C
-            2C2C2C2C2C2C00042B1626101F002C2C2C2C2C2C2C0000201E0E18010800002C
-            2C2C2C2C002C00221B271D250C002C002C2C2C002C2C000B03141A0911002C2C
-            002C2C002C2C00062A0A172928002C2C002C2C2C000000071312150223000000
-            2C2C2C2C2C2C00000000000000002C2C2C2C2C2C2C2C2C2C2C2C2C2C2C2C2C2C
-            2C2C}
-          Transparent = True
-        end
-        object Image13: TImage
-          Left = 56
-          Top = 80
-          Width = 17
-          Height = 17
-          Picture.Data = {
-            07544269746D617036050000424D360500000000000036040000280000001000
-            000010000000010008000000000000010000130B0000130B0000000100000001
-            0000FFFFFF00898A8A007070710097979800A2A2A30071727200B0B1B1007778
-            78008B8B8C009E9F9F009F9FA000A5A5A600959696007C7C7D00676767009A9A
-            9A0060606000F2F3F40062626300909091008B8C8C0084858500A8A9AA00696A
-            6A00AEAEAF007B7B7C0092929300ADAEAE008989890068686900A0A1A1008383
-            84006F7070008B8B8B009B9C9C009C9D9D00A9A9AA00C9C9CA00888888006A6A
-            6B00747575007A7B7B009C9C9D00ADADAE008A8A8B0074747500A2A2A2007D7D
-            7D00949495007576760087888800ACADAE00AAABAB0065656500838383007373
-            730080808000A6A7A700C5C5C6009FA0A0009A9B9B0070707000818182006969
-            6A00767676007D7E7E007B7C7C00787979007A7A7B006A6B6B00EEEFEF007D7D
-            7E0078787900525252008E8F8F006B6C6C00FFFFFF0000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            00004C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4527171D0E354C4C4C
-            4C4C4C4C4C4C4C02072531493F4C4C4C4C4C4C4C4C4C4C4C2D3705204C4C4C4C
-            4C4C4C4C4C4C4C4C4C07404C4C4C4C4C4C4C4C4C4C4C4C4C4C0D444C4C4C4C4C
-            4C4C4C4C4C4C4C4C3610430D4C4C4C4C4C4C4C4C4C4C4C0101323D4B474C4C4C
-            4C4C4C4C4C4C130F1C00283005414C4C4C4C4C4C4C030C0C00112E2C083E2F4C
-            4C4C4C4C094C3C3A4600210812154C194C4C4C394C4C3B090000042242264C4C
-            484C4C334C4C0B1B0000242338144C4C294C4C4C0618340A00000A04024A011F
-            4C4C4C4C4C4C062B160B1E2A031A4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C4C
-            4C4C}
-          Transparent = True
-        end
-        object Image14: TImage
-          Left = 56
-          Top = 104
-          Width = 17
-          Height = 17
-          Picture.Data = {
-            07544269746D617036050000424D360500000000000036040000280000001000
-            000010000000010008000000000000010000130B0000130B0000000100000001
-            00000159A8000095DE0063C3DE0000B7DE0000A3DE0000ADC80000AFCB0000AF
-            DE000075A2007CC3D800004CB4000070A40000A2D50000A4DE005DB1DE0099C3
-            CB0092AFDE0053AEC7000061C2009CC0D200009ADE00006DA6000056BC0002A4
-            DE0064BFDE000091DE0000ABDE000092DE000058A7000088DC0000A2D0006FC3
-            DE00005DA30000A5D5000057BE000093BF000064A30000A2D90000A7CA0030A9
-            D7000062D100004BBC0070ADD600FFFFFF000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            0000000000000000000000000000000000000000000000000000000000000000
-            00002B2B2B2B2B2B2B2B2B2B2B2B2B2B2B2B2B2B2B2B2B0000000000002B2B2B
-            2B2B2B2B2B2B2B0006021E08002B2B2B2B2B2B2B2B2B2B2B000000002B2B2B2B
-            2B2B2B2B2B2B2B2B2B00002B2B2B2B2B2B2B2B2B2B2B2B2B2B00002B2B2B2B2B
-            2B2B2B2B2B2B2B2B000B1C002B2B2B2B2B2B2B2B2B2B2B0004012220002B2B2B
-            2B2B2B2B2B2B000D261F232829002B2B2B2B2B2B2B00001A181103011600002B
-            2B2B2B2B002B00172709212524002B002B2B2B002B2B001D020F0C1412002B2B
-            002B2B002B2B00030E13191B0A002B2B002B2B2B00000005102A070415000000
-            2B2B2B2B2B2B00000000000000002B2B2B2B2B2B2B2B2B2B2B2B2B2B2B2B2B2B
-            2B2B}
-          Transparent = True
-        end
-        object Label51: TLabel
-          Left = 24
-          Top = 224
-          Width = 521
-          Height = 52
-          Caption = 
-            'You can only play ladder battles if you have an account. To make' +
-            ' an account go to the Options -&gt; Account. If  you have been forc' +
-            'ed to spectator mode because you didn'#39't have an account, ask the' +
-            ' hoster to refresh the ranks using the &quot;Ladder -&gt; Refresh ranks ' +
-            'and cups&quot; button (bottom right of the battle window) and then un' +
-            'spec. You can also refresh ranks after a ladder battle end to se' +
-            'e the rating and ranks changes.'
-          Transparent = True
-          WordWrap = True
-        end
-        object SpTBXLabel10: TSpTBXLabel
-          Left = 32
-          Top = 32
-          Width = 79
-          Height = 13
-          Caption = 'Ladder rewards :'
-        end
-        object SpTBXLabel11: TSpTBXLabel
-          Left = 88
-          Top = 56
-          Width = 165
-          Height = 13
-          Caption = 'Gold cup for the best ladder player.'
-        end
-        object SpTBXLabel12: TSpTBXLabel
-          Left = 88
-          Top = 80
-          Width = 104
-          Height = 13
-          Caption = 'Silver cup for the 2nd.'
-        end
-        object SpTBXLabel13: TSpTBXLabel
-          Left = 88
-          Top = 104
-          Width = 108
-          Height = 13
-          Caption = 'Bronze cup for the 3rd.'
-        end
-        object SpTBXLabel14: TSpTBXLabel
-          Left = 32
-          Top = 136
-          Width = 233
-          Height = 49
-          Caption = 
-            'Players can have 1 cup per active ladder. To see  the rules, the' +
-            ' maps and the ranking page of each ladder, visit the ladder web ' +
-            'site.'
-          AutoSize = False
-          Wrapping = twWrap
-        end
-      end
       object SpTBXTabSheet2: TSpTBXTabSheet
         Left = 0
         Top = 39
@@ -741,246 +518,6 @@
           Caption = '&gt; 3000 h = ghost'
         end
       end
-      object SpTBXTabSheet1: TSpTBXTabSheet
-        Left = 0
-        Top = 39
-        Width = 785
-        Height = 378
-        Caption = 'Tips and commands'
-        ImageIndex = -1
-        TabItem = 'SpTBXTabItem1'
-        object TntScrollBox1: TTntScrollBox
-          Left = 2
-          Top = 0
-          Width = 781
-          Height = 376
-          HorzScrollBar.Range = 408
-          VertScrollBar.Range = 480
-          VertScrollBar.Smooth = True
-          Align = alClient
-          AutoScroll = False
-          BorderStyle = bsNone
-          ParentBackground = True
-          TabOrder = 0
-          object Label18: TSpTBXLabel
-            Left = 0
-            Top = 0
-            Width = 52
-            Height = 13
-            Caption = 'Useful tips:'
-          end
-          object Label19: TSpTBXLabel
-            Left = 0
-            Top = 16
-            Width = 259
-            Height = 13
-            Caption = '* Right-click on a channel or private chat tab to close it'
-          end
-          object Label20: TSpTBXLabel
-            Left = 0
-            Top = 32
-            Width = 318
-            Height = 13
-            Caption = 
-              '* Double on the player to open private chat (in the list or in t' +
-              'he chat)'
-          end
-          object Label21: TSpTBXLabel
-            Left = 0
-            Top = 48
-            Width = 233
-            Height = 13
-            Caption = '* Double-click or click on Join button to join battle'
-          end
-          object Label34: TSpTBXLabel
-            Left = 0
-            Top = 64
-            Width = 203
-            Height = 13
-            Caption = '* Double-click on bot to change his options'
-          end
-          object Label22: TSpTBXLabel
-            Left = 0
-            Top = 80
-            Width = 215
-            Height = 13
-            Caption = '* Click on minimap to view fixed start positions'
-          end
-          object Label23: TSpTBXLabel
-            Left = 0
-            Top = 96
-            Width = 334
-            Height = 13
-            Caption = 
-              '* Right click on the minimap to get options like auto boxes or k' +
-              'eep ratio'
-          end
-          object Label24: TSpTBXLabel
-            Left = 0
-            Top = 128
-            Width = 87
-            Height = 13
-            Caption = 'Useful commands:'
-          end
-          object Label25: TSpTBXLabel
-            Left = 0
-            Top = 152
-            Width = 154
-            Height = 13
-            Caption = '* /me to talk in &quot;/me&quot; mIRC style'
-          end
-          object Label26: TSpTBXLabel
-            Left = 0
-            Top = 168
-            Width = 211
-            Height = 13
-            Caption = '* /join or /j (+channel'#39's name) to join channel'
-          end
-          object Label27: TSpTBXLabel
-            Left = 0
-            Top = 184
-            Width = 283
-            Height = 13
-            Caption = '* /part or /p to close current channel or private chat window'
-          end
-          object Label28: TSpTBXLabel
-            Left = 0
-            Top = 200
-            Width = 246
-            Height = 13
-            Caption = '* /channels or /list to receive a list of open channels'
-          end
-          object Label67: TSpTBXLabel
-            Left = 0
-            Top = 216
-            Width = 283
-            Height = 13
-            Caption = '* /rename &lt;new name&gt; to change your account'#39's username'
-          end
-          object SpTBXLabel1: TSpTBXLabel
-            Left = 0
-            Top = 232
-            Width = 334
-            Height = 13
-            Caption = 
-              '* /password &lt;oldpass&gt; &lt;newpass&gt; will change your account passwor' +
-              'd'
-          end
-          object Label68: TSpTBXLabel
-            Left = 0
-            Top = 248
-            Width = 202
-            Height = 13
-            Caption = '* /ring while hosting a battle to call a player'
-          end
-          object Label44: TSpTBXLabel
-            Left = 0
-            Top = 264
-            Width = 283
-            Height = 13
-            Caption = '* /ping will tell you the lag between you and the lobby server'
-          end
-          object Label69: TSpTBXLabel
-            Left = 0
-            Top = 280
-            Width = 242
-            Height = 13
-            Caption = '* /msg &lt;user&gt; {message} will send message to user'
-          end
-          object Label70: TSpTBXLabel
-            Left = 0
-            Top = 296
-            Width = 295
-            Height = 13
-            Caption = 
-              '* /ignore [&lt;user&gt;] will add &lt;user&gt; to ignore list and open the l' +
-              'ist'
-          end
-          object Label72: TSpTBXLabel
-            Left = 0
-            Top = 312
-            Width = 236
-            Height = 13
-            Caption = '* /mutelist &lt;channel&gt; will return channel'#39's mute list'
-          end
-          object SpTBXLabel4: TSpTBXLabel
-            Left = 0
-            Top = 328
-            Width = 265
-            Height = 13
-            Caption = '* /ingame will return your total amount of ingame minutes'
-          end
-          object SpTBXLabel18: TSpTBXLabel
-            Left = 0
-            Top = 344
-            Width = 408
-            Height = 13
-            Caption = 
-              '* /forceupdate /forcebetaupdate will force the lobby update even' +
-              ' if it seems up to date'
-          end
-          object SpTBXLabel19: TSpTBXLabel
-            Left = 0
-            Top = 360
-            Width = 122
-            Height = 13
-            Caption = '* /help  will show this help'
-          end
-          object SpTBXLabel20: TSpTBXLabel
-            Left = 0
-            Top = 376
-            Width = 180
-            Height = 13
-            Caption = '* /uptime will tell you the server uptime'
-          end
-          object SpTBXLabel21: TSpTBXLabel
-            Left = 0
-            Top = 392
-            Width = 292
-            Height = 13
-            Caption = 
-              '* /version will tell you the TASClient lobby version and revisio' +
-              'n'
-          end
-          object SpTBXLabel22: TSpTBXLabel
-            Left = 0
-            Top = 408
-            Width = 326
-            Height = 13
-            Caption = 
-              '* /scriptsdebugwindow will show the pythong scripting debug wind' +
-              'ow'
-          end
-          object SpTBXLabel23: TSpTBXLabel
-            Left = 0
-            Top = 422
-            Width = 664
-            Height = 13
-            Caption = 
-              '* /forcestart will simulate a game start event (either to try to' +
-              ' rejoin a game already started or to force a game start even if ' +
-              'players are not ready)'
-          end
-          object SpTBXLabel24: TSpTBXLabel
-            Left = 0
-            Top = 436
-            Width = 494
-            Height = 13
-            Caption = 
-              '* /isspadsautohost to tell the lobby the current host is a spads' +
-              ' autohost (and show the autohost interface)'
-          end
-          object SpTBXLabel25: TSpTBXLabel
-            Left = 0
-            Top = 452
-            Width = 510
-            Height = 13
-            Caption = 
-              '* /isspringieautohost to tell the lobby the current host is a sp' +
-              'ringie autohost (and show the autohost interface)'
-          end
-        end
-      end
       object SpTBXTabSheet3: TSpTBXTabSheet
         Left = 0
         Top = 39
@@ -2476,14 +2013,6 @@
           Height = 13
           Caption = '- Automated bot (bot mode)'
         end
-        object SpTBXLabel2: TSpTBXLabel
-          Left = 80
-          Top = 210
-          Width = 62
-          Height = 13
-          Caption = 'Ladder battle'
-          Visible = False
-        end
         object SpTBXLabel5: TSpTBXLabel
           Left = 400
           Top = 352
@@ -2508,6 +2037,246 @@
             'e'
         end
       end
+      object SpTBXTabSheet1: TSpTBXTabSheet
+        Left = 0
+        Top = 39
+        Width = 785
+        Height = 378
+        Caption = 'Tips and commands'
+        ImageIndex = -1
+        TabItem = 'SpTBXTabItem1'
+        object TntScrollBox1: TTntScrollBox
+          Left = 2
+          Top = 0
+          Width = 781
+          Height = 376
+          HorzScrollBar.Range = 408
+          VertScrollBar.Range = 480
+          VertScrollBar.Smooth = True
+          Align = alClient
+          AutoScroll = False
+          BorderStyle = bsNone
+          ParentBackground = True
+          TabOrder = 0
+          object Label18: TSpTBXLabel
+            Left = 0
+            Top = 0
+            Width = 52
+            Height = 13
+            Caption = 'Useful tips:'
+          end
+          object Label19: TSpTBXLabel
+            Left = 0
+            Top = 16
+            Width = 259
+            Height = 13
+            Caption = '* Right-click on a channel or private chat tab to close it'
+          end
+          object Label20: TSpTBXLabel
+            Left = 0
+            Top = 32
+            Width = 318
+            Height = 13
+            Caption = 
+              '* Double on the player to open private chat (in the list or in t' +
+              'he chat)'
+          end
+          object Label21: TSpTBXLabel
+            Left = 0
+            Top = 48
+            Width = 233
+            Height = 13
+            Caption = '* Double-click or click on Join button to join battle'
+          end
+          object Label34: TSpTBXLabel
+            Left = 0
+            Top = 64
+            Width = 203
+            Height = 13
+            Caption = '* Double-click on bot to change his options'
+          end
+          object Label22: TSpTBXLabel
+            Left = 0
+            Top = 80
+            Width = 215
+            Height = 13
+            Caption = '* Click on minimap to view fixed start positions'
+          end
+          object Label23: TSpTBXLabel
+            Left = 0
+            Top = 96
+            Width = 334
+            Height = 13
+            Caption = 
+              '* Right click on the minimap to get options like auto boxes or k' +
+              'eep ratio'
+          end
+          object Label24: TSpTBXLabel
+            Left = 0
+            Top = 128
+            Width = 87
+            Height = 13
+            Caption = 'Useful commands:'
+          end
+          object Label25: TSpTBXLabel
+            Left = 0
+            Top = 152
+            Width = 154
+            Height = 13
+            Caption = '* /me to talk in &quot;/me&quot; mIRC style'
+          end
+          object Label26: TSpTBXLabel
+            Left = 0
+            Top = 168
+            Width = 211
+            Height = 13
+            Caption = '* /join or /j (+channel'#39's name) to join channel'
+          end
+          object Label27: TSpTBXLabel
+            Left = 0
+            Top = 184
+            Width = 283
+            Height = 13
+            Caption = '* /part or /p to close current channel or private chat window'
+          end
+          object Label28: TSpTBXLabel
+            Left = 0
+            Top = 200
+            Width = 246
+            Height = 13
+            Caption = '* /channels or /list to receive a list of open channels'
+          end
+          object Label67: TSpTBXLabel
+            Left = 0
+            Top = 216
+            Width = 283
+            Height = 13
+            Caption = '* /rename &lt;new name&gt; to change your account'#39's username'
+          end
+          object SpTBXLabel1: TSpTBXLabel
+            Left = 0
+            Top = 232
+            Width = 334
+            Height = 13
+            Caption = 
+              '* /password &lt;oldpass&gt; &lt;newpass&gt; will change your account passwor' +
+              'd'
+          end
+          object Label68: TSpTBXLabel
+            Left = 0
+            Top = 248
+            Width = 202
+            Height = 13
+            Caption = '* /ring while hosting a battle to call a player'
+          end
+          object Label44: TSpTBXLabel
+            Left = 0
+            Top = 264
+            Width = 283
+            Height = 13
+            Caption = '* /ping will tell you the lag between you and the lobby server'
+          end
+          object Label69: TSpTBXLabel
+            Left = 0
+            Top = 280
+            Width = 242
+            Height = 13
+            Caption = '* /msg &lt;user&gt; {message} will send message to user'
+          end
+          object Label70: TSpTBXLabel
+            Left = 0
+            Top = 296
+            Width = 295
+            Height = 13
+            Caption = 
+              '* /ignore [&lt;user&gt;] will add &lt;user&gt; to ignore list and open the l' +
+              'ist'
+          end
+          object Label72: TSpTBXLabel
+            Left = 0
+            Top = 312
+            Width = 236
+            Height = 13
+            Caption = '* /mutelist &lt;channel&gt; will return channel'#39's mute list'
+          end
+          object SpTBXLabel4: TSpTBXLabel
+            Left = 0
+            Top = 328
+            Width = 265
+            Height = 13
+            Caption = '* /ingame will return your total amount of ingame minutes'
+          end
+          object SpTBXLabel18: TSpTBXLabel
+            Left = 0
+            Top = 344
+            Width = 408
+            Height = 13
+            Caption = 
+              '* /forceupdate /forcebetaupdate will force the lobby update even' +
+              ' if it seems up to date'
+          end
+          object SpTBXLabel19: TSpTBXLabel
+            Left = 0
+            Top = 360
+            Width = 122
+            Height = 13
+            Caption = '* /help  will show this help'
+          end
+          object SpTBXLabel20: TSpTBXLabel
+            Left = 0
+            Top = 376
+            Width = 180
+            Height = 13
+            Caption = '* /uptime will tell you the server uptime'
+          end
+          object SpTBXLabel21: TSpTBXLabel
+            Left = 0
+            Top = 392
+            Width = 292
+            Height = 13
+            Caption = 
+              '* /version will tell you the TASClient lobby version and revisio' +
+              'n'
+          end
+          object SpTBXLabel22: TSpTBXLabel
+            Left = 0
+            Top = 408
+            Width = 326
+            Height = 13
+            Caption = 
+              '* /scriptsdebugwindow will show the pythong scripting debug wind' +
+              'ow'
+          end
+          object SpTBXLabel23: TSpTBXLabel
+            Left = 0
+            Top = 422
+            Width = 664
+            Height = 13
+            Caption = 
+              '* /forcestart will simulate a game start event (either to try to' +
+              ' rejoin a game already started or to force a game start even if ' +
+              'players are not ready)'
+          end
+          object SpTBXLabel24: TSpTBXLabel
+            Left = 0
+            Top = 436
+            Width = 494
+            Height = 13
+            Caption = 
+              '* /isspadsautohost to tell the lobby the current host is a spads' +
+              ' autohost (and show the autohost interface)'
+          end
+          object SpTBXLabel25: TSpTBXLabel
+            Left = 0
+            Top = 452
+            Width = 510
+            Height = 13
+            Caption = 
+              '* /isspringieautohost to tell the lobby the current host is a sp' +
+              'ringie autohost (and show the autohost interface)'
+          end
+        end
+      end
     end
     object Button3: TSpTBXButton
       Left = 444

Modified: Lobby/TASClient/HelpUnit.pas
===================================================================
--- Lobby/TASClient/HelpUnit.pas	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/HelpUnit.pas	2011-10-16 11:13:23 UTC (rev 7626)
@@ -79,23 +79,11 @@
     Button2: TSpTBXButton;
     Image10: TImage;
     Label43: TSpTBXLabel;
-    SpTBXLabel2: TSpTBXLabel;
     SpTBXLabel5: TSpTBXLabel;
     SpTBXLabel6: TSpTBXLabel;
     SpTBXLabel7: TSpTBXLabel;
     SpTBXLabel8: TSpTBXLabel;
     SpTBXLabel9: TSpTBXLabel;
-    SpTBXTabItem4: TSpTBXTabItem;
-    SpTBXTabSheet4: TSpTBXTabSheet;
-    Image12: TImage;
-    Image13: TImage;
-    Image14: TImage;
-    SpTBXLabel10: TSpTBXLabel;
-    SpTBXLabel11: TSpTBXLabel;
-    SpTBXLabel12: TSpTBXLabel;
-    SpTBXLabel13: TSpTBXLabel;
-    SpTBXLabel14: TSpTBXLabel;
-    Label51: TLabel;
     Image15: TImage;
     Image16: TImage;
     TntScrollBox1: TTntScrollBox;
@@ -142,7 +130,6 @@
     procedure FormCreate(Sender: TObject);
     procedure Button3Click(Sender: TObject);
     procedure Button2Click(Sender: TObject);
-    procedure JvXPButton1Click(Sender: TObject);
   private
     { Private declarations }
   public
@@ -181,9 +168,4 @@
   else PageControl1.ActiveTabIndex := PageControl1.ActiveTabIndex - 1;
 end;
 
-procedure THelpForm.JvXPButton1Click(Sender: TObject);
-begin
-  Misc.OpenURLInDefaultBrowser(WIKI_PAGE_LINK);
-end;
-
 end.

Modified: Lobby/TASClient/HostBattleFormUnit.pas
===================================================================
--- Lobby/TASClient/HostBattleFormUnit.pas	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/HostBattleFormUnit.pas	2011-10-16 11:13:23 UTC (rev 7626)
@@ -337,8 +337,6 @@
   else
     s := s + ModList[ModArchiveList.IndexOf(replay.Script.ReadKeyValue('GAME/gametype'))];
 
-  BattleState.LadderIndex := -1;
-
   // send the command:
   MainForm.TryToSendCommand('OPENBATTLE', s);
 

Modified: Lobby/TASClient/LobbyScriptUnit.pas
===================================================================
--- Lobby/TASClient/LobbyScriptUnit.pas	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/LobbyScriptUnit.pas	2011-10-16 11:13:23 UTC (rev 7626)
@@ -2415,8 +2415,6 @@
     Result := BattleForm.mnuBalanceSub
   else if name = 'BattleAdminRankLimit' then
     Result := BattleForm.mnuRankLimit
-  else if name = 'BattleLadder' then
-    Result := BattleForm.LadderPopupMenu.Items
   else if name = 'ReplayItem' then
     Result := ReplaysForm.ReplayListPopupMenu.Items
   else if name = 'Chat' then
@@ -3248,8 +3246,6 @@
      imgL := MainForm.BattleStatusImageList
     else if lcName = 'readystate' then
      imgL := MainForm.ReadyStateImageList
-    else if lcName = 'laddercup' then
-     imgL := MainForm.LadderCups
     else if lcName = 'arrow' then
      imgL := MainForm.ArrowList
     else

Modified: Lobby/TASClient/MainUnit.dfm
===================================================================
--- Lobby/TASClient/MainUnit.dfm	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/MainUnit.dfm	2011-10-16 11:13:23 UTC (rev 7626)
@@ -834,49 +834,40 @@
                     TabOrder = 1
                     OnClick = InProgressFilterClick
                   end
-                  object LadderFilter: TSpTBXCheckBox
-                    Left = 8
-                    Top = 40
-                    Width = 51
-                    Height = 15
-                    Caption = 'Ladder'
-                    TabOrder = 2
-                    OnClick = LadderFilterClick
-                  end
                   object LockedFilter: TSpTBXCheckBox
                     Left = 8
-                    Top = 56
+                    Top = 40
                     Width = 54
                     Height = 15
                     Caption = 'Locked'
-                    TabOrder = 3
+                    TabOrder = 2
                     OnClick = LockedFilterClick
                   end
                   object PasswordedFilter: TSpTBXCheckBox
                     Left = 8
-                    Top = 72
+                    Top = 56
                     Width = 76
                     Height = 15
                     Caption = 'Passworded'
-                    TabOrder = 4
+                    TabOrder = 3
                     OnClick = PasswordedFilterClick
                   end
                   object RankLimitFilter: TSpTBXCheckBox
                     Left = 112
-                    Top = 72
+                    Top = 56
                     Width = 109
                     Height = 15
                     Caption = 'Min rank &gt; My rank'
-                    TabOrder = 5
+                    TabOrder = 4
                     OnClick = RankLimitFilterClick
                   end
                   object ReplaysFilter: TSpTBXCheckBox
-                    Left = 112
-                    Top = 56
+                    Left = 8
+                    Top = 72
                     Width = 51
                     Height = 15
                     Caption = 'Replay'
-                    TabOrder = 6
+                    TabOrder = 5
                     OnClick = ReplaysFilterClick
                   end
                   object ModsNotAvailableFilter: TSpTBXCheckBox
@@ -885,7 +876,7 @@
                     Width = 102
                     Height = 15
                     Caption = 'Mod not available'
-                    TabOrder = 7
+                    TabOrder = 6
                     OnClick = ModsNotAvailableFilterClick
                   end
                   object MapsNotAvailableFilter: TSpTBXCheckBox
@@ -894,7 +885,7 @@
                     Width = 102
                     Height = 15
                     Caption = 'Map not available'
-                    TabOrder = 8
+                    TabOrder = 7
                     OnClick = MapsNotAvailableFilterClick
                   end
                   object NatTraversalFilter: TSpTBXCheckBox
@@ -903,7 +894,7 @@
                     Width = 78
                     Height = 15
                     Caption = 'Nat traversal'
-                    TabOrder = 9
+                    TabOrder = 8
                     OnClick = NatTraversalFilterClick
                   end
                   object PlayersSignButton: TSpTBXButton
@@ -912,7 +903,7 @@
                     Width = 25
                     Height = 20
                     Caption = '&lt;'
-                    TabOrder = 10
+                    TabOrder = 9
                     OnClick = PlayersSignButtonClick
                   end
                   object MaxPlayersSignButton: TSpTBXButton
@@ -921,7 +912,7 @@
                     Width = 25
                     Height = 20
                     Caption = '&lt;'
-                    TabOrder = 11
+                    TabOrder = 10
                     OnClick = MaxPlayersSignButtonClick
                   end
                   object MaxPlayersFilter: TSpTBXCheckBox
@@ -930,7 +921,7 @@
                     Width = 78
                     Height = 15
                     Caption = 'Max Players '
-                    TabOrder = 12
+                    TabOrder = 11
                     OnClick = MaxPlayersFilterClick
                   end
                   object PlayersFilter: TSpTBXCheckBox
@@ -939,7 +930,7 @@
                     Width = 55
                     Height = 15
                     Caption = 'Players '
-                    TabOrder = 13
+                    TabOrder = 12
                     OnClick = PlayersFilterClick
                   end
                   object Players2Filter: TSpTBXCheckBox
@@ -948,7 +939,7 @@
                     Width = 55
                     Height = 15
                     Caption = 'Players '
-                    TabOrder = 14
+                    TabOrder = 13
                     OnClick = Players2FilterClick
                   end
                   object Players2SignButton: TSpTBXButton
@@ -957,7 +948,7 @@
                     Width = 25
                     Height = 20
                     Caption = '&lt;'
-                    TabOrder = 15
+                    TabOrder = 14
                     OnClick = Players2SignButtonClick
                   end
                   object RankFilter: TSpTBXCheckBox
@@ -966,7 +957,7 @@
                     Width = 66
                     Height = 15
                     Caption = 'Avg Rank'
-                    TabOrder = 16
+                    TabOrder = 15
                     OnClick = RankFilterClick
                   end
                   object RankSignButton: TSpTBXButton
@@ -975,7 +966,7 @@
                     Width = 25
                     Height = 20
                     Caption = '&lt;'
-                    TabOrder = 17
+                    TabOrder = 16
                     OnClick = RankSignButtonClick
                   end
                   object PlayersValueTextBox: TSpTBXSpinEdit
@@ -983,7 +974,7 @@
                     Top = 8
                     Width = 41
                     Height = 21
-                    TabOrder = 18
+                    TabOrder = 17
                     OnChange = PlayersValueTextBoxChange
                     SpinButton.Left = 23
                     SpinButton.Top = 0
@@ -999,7 +990,7 @@
                     Top = 32
                     Width = 41
                     Height = 21
-                    TabOrder = 19
+                    TabOrder = 18
                     OnChange = Players2ValueTextBoxChange
                     SpinButton.Left = 23
                     SpinButton.Top = 0
@@ -1015,7 +1006,7 @@
                     Top = 56
                     Width = 41
                     Height = 21
-                    TabOrder = 20
+                    TabOrder = 19
                     OnChange = MaxPlayersValueTextBoxChange
                     SpinButton.Left = 23
                     SpinButton.Top = 0
@@ -1033,7 +1024,7 @@
                     Top = 80
                     Width = 41
                     Height = 21
-                    TabOrder = 21
+                    TabOrder = 20
                     OnChange = RankValueTextBoxChange
                     SpinButton.Left = 23
                     SpinButton.Top = 0
@@ -5620,11 +5611,6 @@
       Caption = 'Spring Replays'
       OnClick = mnuSpringReplaysClick
     end
-    object mnuSpringLadder: TSpTBXItem
-      Caption = 'Spring Ladder'
-      Visible = False
-      OnClick = mnuSpringLadderClick
-    end
     object SpTBXItem4: TSpTBXItem
       Caption = 'Alternative lobby : SpringLobby'
       OnClick = SpTBXItem4Click
@@ -5673,11 +5659,6 @@
       Caption = 'Host battle'
       OnClick = menuHostBattleClick
     end
-    object mnuHostLadderBattle: TSpTBXItem
-      Caption = 'Host ladder battle'
-      Visible = False
-      OnClick = mnuHostLadderBattleClick
-    end
     object mnuHostReplay: TSpTBXItem
       Caption = 'Host replay'
       OnClick = mnuHostReplayClick
@@ -5926,13 +5907,6 @@
       F00FF00FF00F0000FFFFFFFFFFFF000000000000000000000000000000000000
       000000000000}
   end
-  object LadderCupsRefresh: TTimer
-    Enabled = False
-    Interval = 600000
-    OnTimer = LadderCupsRefreshTimer
-    Left = 388
-    Top = 166
-  end
   object ClientPopupMenu: TSpTBXPopupMenu
     AutoHotkeys = maManual
     OnPopup = ClientPopupMenuPopup

Modified: Lobby/TASClient/MainUnit.pas
===================================================================
--- Lobby/TASClient/MainUnit.pas	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/MainUnit.pas	2011-10-16 11:13:23 UTC (rev 7626)
@@ -439,11 +439,8 @@
 
   RELAYHOST_MANAGER_NAME = 'RelayHostManagerList';
   LOG_FILENAME = 'TASClient_Debug.log';
-  MODS_PAGE_LINK = '<A HREF="http://spring.jobjol.nl/files.php?subcategory_id=5">http://spring.jobjol.nl/files.php?subcategory_id=5</A>';
-  MAPS_PAGE_LINK = '<A HREF="http://spring.jobjol.nl/files.php?subcategory_id=2">http://spring.jobjol.nl/files.php?subcategory_id=2</A>';
-  WIKI_PAGE_LINK = '<A HREF="http://taspring.clan-sy.com/wiki/Main_Page">http://taspring.clan-sy.com/wiki/Main_Page</A>';
-  LADDER_PREFIX_URL = '<A HREF="http://blendax.informatik.uni-bremen.de/jan/spring/ladder/lobby/">http://blendax.informatik.uni-bremen.de/jan/spring/ladder/lobby/</A>'; //'<A HREF="http://springladder.no-ip.org/lobby/">http://springladder.no-ip.org/lobby/</A>';
-  LADDER_BATTLE_PASSWORD = 'ladderlock2';
+  MODS_PAGE_LINK = '<A HREF="http://springfiles.com/spring/games">http://springfiles.com/spring/games</A>';
+  MAPS_PAGE_LINK = '<A HREF="http://springfiles.com/spring/spring-maps">http://springfiles.com/spring/spring-maps</A>';
   AWAY_TIME = 300000; // in milliseconds. After this period of time (of inactivity), client will set its state to &quot;away&quot;
   IDL_DEFAULT_MSG = 'The user has been idling for $t minutes.';
   AWAY_DEFAULT_MSG = 'I am currently away from the computer.';
@@ -711,11 +708,6 @@
     Country: string; // two-character country code based on ISO 3166
     CPU: Integer; // CPU's speed in MHz (or equivalent if AMD). Value of 0 means that client couldn't figure out its CPU speed.
     StatusRefreshed : Boolean;
-    CurrentLadderId : integer; // ladder id of the current ladder information
-    CurrentLadderRank : integer; // since its the rank of the client in the current ladder, it must be set to -1 each time he join a battle
-    CurrentLadderRating : integer; // same as the rank
-    CupList: TList;
-    CupLadderList: TStringList;
     IP: string; // this field is assigned by the CLIENTIPPORT command only when needed, generally it is set to '' (empty string)
     PublicPort: Integer; // client's public UDP source port. Used with NAT traversing (e.g. &quot;hole punching&quot;)
     AwayMessageSent: boolean; // to not resend the away message each time the player send you a message
@@ -831,18 +823,6 @@
     procedure Execute; override;
   end;
 
-  TLadderTopPlayersThread = class(TThread)
-  private
-    procedure Refresh;
-    procedure OnTerminateProcedure(Sender : TObject);
-
-  protected
-    procedure Execute; override;
-
-  public
-    constructor Create(Suspended : Boolean);
-  end;
-
   TTestThread = class(TThread)
   protected
     procedure Execute; override;
@@ -891,30 +871,6 @@
     constructor Create(Suspended: Boolean;timer: integer);
   end;
 
-  TLadder = class
-  public
-    id: integer;
-    Name: string;
-    ModName: string;
-    MinPlayersPerAllyTeam: integer;
-    MaxPlayersPerAllyTeam: integer;
-    StartPos: byte; // -1 = any
-    GameMode: byte; // -1 = any
-    DGun: byte; // -1 = any
-    Ghost: byte; // -1 = any
-    Diminish: byte; // -1 = any
-    MetalMin: integer;  // -1 = any
-    MetalMax: integer;
-    EnergyMin: integer; // -1 = any
-    EnergyMax: integer;
-    UnitsMin: integer; // -1 = any
-    UnitsMax: integer;
-    Restricted : TStrings;
-    Rules: string;
-    Maps : TStrings;
-    constructor Create(id: integer; Name: string);
-  end;
-
   TBot = class
   public
     Name: string;
@@ -959,7 +915,6 @@
     RankLimit: Shortint; // if 0, no rank limit is set. If 1 or higher, only players with this rank (or higher) can join the battle (Note: rank index 1 means seconds rank, not the first one, since you can't limit game to players of the first rank because that means game is open to all players and you don't have to limit it in that case)
     Visible : boolean;
     ForcedHidden: boolean;
-    RefreshRanksNCupsOnSuccessReport: boolean;
     StartTimeUknown: Boolean;
     StartTime: TDateTime;
 
@@ -982,8 +937,6 @@
     function AreAllBotsSet: Boolean;
     function IsBattleFull: Boolean;
     function IsBattleInProgress: Boolean;
-    function IsLadderBattle: Boolean;
-    function GetLadderId: integer;
     function GetState: Integer; // use it to get index of image from BattleStatusImageList
     function ClientsToString(separator: string=', ';displayName: boolean=True): string; // returns user names in a string, separated by spaces
     function GetClient(Name: string): TClient;
@@ -1054,7 +1007,6 @@
     FileName: String;
     Full: Boolean;
     InProgress: Boolean;
-    Ladder: Boolean;
     Locked: Boolean;
     Passworded: Boolean;
     NatTraversal: Boolean;
@@ -1122,7 +1074,6 @@
     mnuBugTracker: TSpTBXItem;
     mnuJobJol: TSpTBXItem;
     mnuSpringReplays: TSpTBXItem;
-    mnuSpringLadder: TSpTBXItem;
     HttpCli1: THttpCli;
     SpTBXSeparatorItem7: TSpTBXSeparatorItem;
     SubMenuWiki: TSpTBXSubmenuItem;
@@ -1132,7 +1083,6 @@
     mnuStrategyAndTactics: TSpTBXItem;
     HostBattlePopupMenu: TSpTBXPopupMenu;
     menuHostBattle: TSpTBXItem;
-    mnuHostLadderBattle: TSpTBXItem;
     mnuHostReplay: TSpTBXItem;
     SpTBXSeparatorItem8: TSpTBXSeparatorItem;
     mnuBattleScreen: TSpTBXItem;
@@ -1168,8 +1118,6 @@
     SpTBXSeparatorItem12: TSpTBXSeparatorItem;
     SpTBXSeparatorItem13: TSpTBXSeparatorItem;
     HttpCli2: THttpCli;
-    LadderCups: TImageList;
-    LadderCupsRefresh: TTimer;
     mnuBattleHost: TSpTBXSubmenuItem;
     ClientPopupMenu: TSpTBXPopupMenu;
     PlayerSubMenu: TSpTBXSubmenuItem;
@@ -1273,7 +1221,6 @@
     SpTBXPanel2: TSpTBXPanel;
     FullFilter: TSpTBXCheckBox;
     InProgressFilter: TSpTBXCheckBox;
-    LadderFilter: TSpTBXCheckBox;
     LockedFilter: TSpTBXCheckBox;
     PasswordedFilter: TSpTBXCheckBox;
     RankLimitFilter: TSpTBXCheckBox;
@@ -1376,8 +1323,6 @@
     procedure ClientsListBoxClick(Sender: TObject);
     procedure mnuRemoveFromGroupClick(Sender: TObject);
     procedure mnuHelpClick(Sender: TObject);
-    procedure mnuSpringmarkClick(Sender: TObject);
-    procedure mnuSpringLadderClick(Sender: TObject);
     procedure mnuSpringReplaysClick(Sender: TObject);
     procedure mnuJobJolClick(Sender: TObject);
     procedure mnuBugTrackerClick(Sender: TObject);
@@ -1389,7 +1334,6 @@
     procedure mnuStrategyAndTacticsClick(Sender: TObject);
     procedure mnuBattleScreenClick(Sender: TObject);
     procedure menuHostBattleClick(Sender: TObject);
-    procedure mnuHostLadderBattleClick(Sender: TObject);
     procedure mnuHostReplayClick(Sender: TObject);
     procedure SpTBXItem6Click(Sender: TObject);
     procedure AutoJoin1Click(Sender: TObject);
@@ -1409,7 +1353,6 @@
     procedure MaxPlayersValueTextBoxChange(Sender: TObject);
     procedure FullFilterClick(Sender: TObject);
     procedure InProgressFilterClick(Sender: TObject);
-    procedure LadderFilterClick(Sender: TObject);
     procedure LockedFilterClick(Sender: TObject);
     procedure PasswordedFilterClick(Sender: TObject);
     procedure NatTraversalFilterClick(Sender: TObject);
@@ -1444,7 +1387,6 @@
     procedure SpTBXItem2Click(Sender: TObject);
     procedure mnuFindIPClick(Sender: TObject);
     procedure mnuUnmuteClick(Sender: TObject);
-    procedure LadderCupsRefreshTimer(Sender: TObject);
     procedure FilterListChecking(Sender: TBaseVirtualTree;
       Node: PVirtualNode; var NewState: TCheckState; var Allowed: Boolean);
     procedure mnuDisplayOnlyHostClick(Sender: TObject);
@@ -1941,8 +1883,6 @@
   // used with Socket:
   ReceiveBuffer: WideString; // this is temp buffer of what we receive from socket
 
-  LadderList: TList;
-
   HostButtonMenuIndex : Integer;
 
   { we have to use messaging queue, since TWSocket doesn't seem to work correctly if certain methods are called
@@ -2661,8 +2601,6 @@
   tmp: TClient;
 begin
   Client := TClient.Create(Name, Status2, Country, IfThen(CPU&gt;10000,0,Integer(CPU)),id);
-  Client.CurrentLadderRank := -1;
-  Client.CurrentLadderRating := -1;
   AllClients.Add(Client);
 
   // sort
@@ -2879,8 +2817,6 @@
   Self.CPU := CPU;
   Self.IP := ''; // IP will get assigned by the CLIENTIPPORT command when needed
   Self.TeamColor := 0;
-  Self.CupList := TList.Create;
-  Self.CupLadderList := TStringList.Create;
   Self.AutoKickMsgSent := 0;
   Self.AutoSpecMsgSent := 0;
   Self.Visible := True;
@@ -3371,7 +3307,6 @@
   SortedClients := TList.Create;
   Bots := TList.Create;
   CurrentHighLightGroup := nil;
-  RefreshRanksNCupsOnSuccessReport := False;
   ForcedHidden := False;
   StartTimeUknown := True;
   StartTime := Now;
@@ -3441,23 +3376,6 @@
   Result := True;
 end;
 
-function TBattle.IsLadderBattle: Boolean;
-begin
-  Result := LeftStr(Self.Description,8) = '(ladder ';
-end;
-
-function TBattle.GetLadderId: integer;
-var
-  tmp : string;
-begin
-  Result := -1;
-  if Self.IsLadderBattle then
-  begin
-    tmp := MidStr(Self.Description,9,5000);
-    try Result := StrToInt(LeftStr(tmp,Pos(')',tmp)-1)); except end;
-  end;
-end;
-
 function TBattle.IsBattleFull: Boolean;
 begin
   if BattleType = 0 then
@@ -3478,7 +3396,6 @@
   else if IsBattleFull then Inc(Result);
   if Password then Inc(Result, 3);
   if BattleType = 1 then Inc(Result, 6);
-  if IsLadderBattle and Password then Inc(Result,11);
 end;
 
 function TBattle.ClientsToString(separator: string=', ';displayName: boolean=True): string;
@@ -4368,8 +4285,6 @@
 
   MuteListForms := TList.Create;
 
-  LadderList := TList.Create;
-
   FindIPQueueList := TStringList.Create;
 
   SpringDownloaderFormUnit.DownloadList := TStringList.Create;
@@ -5978,7 +5893,6 @@
         SortClientsList(TMyTabSheet(MainForm.ChatTabs[i]).Clients, Preferences.SortStyle, Preferences.SortAsc);
       UpdateClientsListBox;
       VDTBattles.Invalidate;
-      LadderCupsRefreshTimer(nil);
 
       // joins every channels opened
       for i:=0 to ChatTabs.Count-1 do
@@ -7278,8 +7192,6 @@
           Status.BattleStatusRequestSent := True;
         end; // else the method which will receive the request will also send the battle status
 
-        BattleState.LadderIndex := -1;
-
         BattleForm.SortBotList(Preferences.BattleClientSortStyle,Preferences.BattleClientSortDirection,True);
         BattleForm.SortClientList(Preferences.BattleClientSortStyle,Preferences.BattleClientSortDirection,True);
 
@@ -7301,8 +7213,6 @@
         AmbiguousCommand(s,'', Colors.Error,78);
         Exit;
       end;
-      if BattleState.TryingToJoinLadderBattle then
-        MessageDlg(_('You are trying to join a battle with another ladder version, updating your lobby should fix that problem.'),mtWarning,[mbOk],0);
       AddMainLog(_('Failed to join the battle (Reason: ') + MakeSentenceWS(sl, 1) + ')', Colors.Error);
     end
     else if sl[0] = 'OPENBATTLEFAILED' then
@@ -7485,7 +7395,6 @@
       Status.Synced := True; // host is always synced with himself!
       WaitForAckForm.ModalResult := mrOK;
       WaitForAckForm.Close;
-      BattleForm.RefreshLadderRanks;
       BattleForm.SortClientList(Preferences.BattleClientSortStyle,Preferences.BattleClientSortDirection,True);
       BattleForm.SortBotList(Preferences.BattleClientSortStyle,Preferences.BattleClientSortDirection,True);
 
@@ -7655,9 +7564,6 @@
           if not BattleForm.Active then
             if NotificationsForm.FindNotification(nfJoinedBattle, []) or ((BattleState.Status = Hosting) and NotificationsForm.FindNotification(nfJoinedMyHostedBattle, [])) then
               AddNotification(_('Player joined battle'), '&lt;'+ Client.DisplayName + _('&gt; has joined battle.'), 2000);
-          Client.CurrentLadderRank := -1;
-          Client.CurrentLadderRating := -1;
-          BattleForm.RefreshLadderRanks;
         end;
     end
     else if sl[0] = 'LEFTBATTLE' then
@@ -8146,17 +8052,7 @@
                 Client.AutoSpecMsgSent := Client.AutoSpecMsgSent + 1;
               end;
               MainForm.TryToSendCommand('FORCESPECTATORMODE', Client.Name);
-            end
-            else
-              if (BattleState.Status=Hosting) and (Client.GetMode &lt;&gt; 0) and BattleState.Battle.IsLadderBattle and (Client.CurrentLadderRating=0) then
-              begin
-                if Client.AutoSpecMsgSent &lt; MAX_AUTOSENDMSG then
-                begin
-                  MainForm.TryToSendCommand('SAYBATTLEEX', '*** No ladder account auto-spec : '+Client.Name+' ***');
-                  Client.AutoSpecMsgSent := Client.AutoSpecMsgSent + 1;
-                end;
-                MainForm.TryToSendCommand('FORCESPECTATORMODE', Client.Name);
-              end;
+            end;
 
           BattleForm.SendBattleInfoToServer;
         end;
@@ -8287,8 +8183,7 @@
       begin
         tmp := MidStr(tmp,Pos('&lt;',tmp)+1,500000);
         tmp := LeftStr(tmp,Pos('&gt;',tmp)-1);
-        //if Preferences.LadderPassword &lt;&gt; '' then
-        //  RenameThread := TLadderRenameAccountThread.Create(False,tmp);
+
         Preferences.Username := tmp;
         PreferencesForm.UpdatePreferencesFrom(Preferences);
       end;
@@ -8932,16 +8827,6 @@
   WideCanvasTextOut((Control as TTntListBox).Canvas, xpos, Rect.Top, TClient(cList[realIndex]).DisplayName);
   Inc(xpos, WideCanvasTextWidth((Control as TTntListBox).Canvas,TClient(cList[realIndex]).DisplayName));
 
-  // ladder cup
-  with TClient(cList[realIndex]) do
-  begin
-    for i:=0 to CupList.Count-1 do
-    begin
-      LadderCups.Draw((Control as TTntListBox).Canvas, xpos, Rect.Top, Integer(CupList[i]^));
-      Inc(xpos, LadderCups.Width + 1);
-    end;
-  end;
-
   // custom icons
   if not Preferences.ScriptsDisabled then
     for i:=0 to lobbyScriptUnit.PlayerIconTypeNames.Count-1 do
@@ -9830,13 +9715,7 @@
       ;
       1: // description
       begin
-        if Battle.IsLadderBattle then begin
-          BattleStatusImageList.Draw(Canvas, ContentRect.Left, R.Top, 17);
-          s := MidStr(Battle.Description,Pos(') ',Battle.Description)+2,99999);
-          Inc(R.Left,16);
-        end
-        else
-          s := Battle.Description; // game's name (description, title)
+        s := Battle.Description; // game's name (description, title)
       end;
       2: // host
       begin
@@ -9967,10 +9846,7 @@
     0: NodeWidth := ButtonImageList.Width; // join
     1:
     begin // description
-      if Battle.IsLadderBattle then
-        NodeWidth := 16 + Canvas.TextWidth(MidStr(Battle.Description,Pos(') ',Battle.Description)+2,99999)) + 2 * AMargin
-      else
-        NodeWidth := Canvas.TextWidth(Battle.Description) + 2 * AMargin;
+      NodeWidth := Canvas.TextWidth(Battle.Description) + 2 * AMargin;
     end;
     2: NodeWidth := Canvas.TextWidth(TClient(Battle.Clients[0]).Name) + 2 * AMargin; // host
     3: NodeWidth := Canvas.TextWidth(Copy(Battle.Map, 1, Length(Battle.Map)-4)) + 2 * AMargin; // map
@@ -10070,13 +9946,10 @@
 
   if Battle.Password and (Password = '') then
   begin
-    if Battle.IsLadderBattle then
-      Password := LADDER_BATTLE_PASSWORD
-    else
-      if LobbyScriptUnit.ScriptJoining then
-        Exit
-      else if not InputQuery(_('Password'), _('Password:'), Password) then
-        Exit;
+    if LobbyScriptUnit.ScriptJoining then
+      Exit
+    else if not InputQuery(_('Password'), _('Password:'), Password) then
+      Exit;
   end;
 
   JoinAsSpectator := SpecatorMode;
@@ -10095,11 +9968,8 @@
       Exit;
     end;
   end;
-  //mnuAutoplayFirstAvailable.Checked := False;
-  //mnuAutospecFirstAvailable.Checked := False;
-  BattleState.TryingToJoinLadderBattle := Battle.IsLadderBattle;
+
   BattleState.JoiningBattle := True;
-  BattleState.LadderIndex := -1;
   Randomize;
   Status.Me.BattleJoinPassword := IntToHex(Random(MaxInt),8);
   TryToSendCommand('JOINBATTLE', IntToStr(Battle.ID) + IFF(Password &lt;&gt; '', ' ' + Password, ' ')+' '+Status.Me.BattleJoinPassword);
@@ -10126,7 +9996,6 @@
 
   HighlighBattlesTimer.Enabled := False;
   KeepAliveTimer.Enabled := False;
-  LadderCupsRefresh.Enabled := False;
 
   if Debug.Log then (TMyTabSheet(MainForm.ChatTabs[0]).FindChildControl('RichEdit') as TExRichEdit).Lines.SaveToFile(ExtractFilePath(Application.ExeName) + LOG_FILENAME);
   if FiltersButton.ImageIndex = 1 then
@@ -10575,7 +10444,7 @@
       
   Result :=
       (Filters.Locked or (not Battle.Locked)) and
-      ((Filters.Passworded and Filters.Ladder) or (not Battle.Password) or (not Filters.Passworded and Filters.Ladder and Battle.IsLadderBattle) or (Filters.Passworded and not Battle.IsLadderBattle)) and
+      (Filters.Passworded or not Battle.Password) and
       (Filters.Full or (not Battle.IsBattleFull)) and
       (Filters.MapNotAvailable or (Utility.MapList.IndexOf(Battle.Map) &gt;-1)) and
       (Filters.ModNotAvailable or (Utility.ModList.IndexOf(Battle.ModName) &gt; -1)) and
@@ -10764,14 +10633,12 @@
           R := Rect(0, 0, Canvas.TextWidth(_('Battle in progress, you can join it but you will have to wait until it ends.')) + 20, 18)
         else if Battle.Locked then
           R := Rect(0, 0, Canvas.TextWidth(_('Battle locked, you can''t join it.')) + 20, 18)
-        else if Battle.Password and not Battle.IsLadderBattle then
+        else if Battle.Password then
           R := Rect(0, 0, Canvas.TextWidth(_('You need the password to join that battle.')) + 20, 18)
         else if Battle.IsBattleFull then
           R := Rect(0, 0, Canvas.TextWidth(_('The battle is full, you can join but you will be spectator.')+tmpStr) + 20, 18)
         else if Battle.RankLimit &gt; Status.Me.GetRank then
           R := Rect(0, 0, Canvas.TextWidth(_('You don''t have the rank required to join that battle. However you can still try to join it if you think you are good enough.')+tmpStr) + 20, 18)
-        else if Battle.IsLadderBattle then
-          R := Rect(0, 0, Canvas.TextWidth(_('This is a ladder battle, you can join it. Read the help(F1) for further information.')+tmpStr) + 20, 18)
         else
           R := Rect(0, 0, Canvas.TextWidth(_('Battle opened.')+tmpStr) + 20, 18);
       end;
@@ -10857,14 +10724,12 @@
           TextOut(5, 2, _('Battle in progress, you can join it but you will have to wait until it ends.'))
         else if Battle.Locked then
           TextOut(5, 2, _('Battle locked, you can''t join it.'))
-        else if Battle.Password and not Battle.IsLadderBattle then
+        else if Battle.Password then
           TextOut(5, 2, _('You need the password to join that battle.'))
         else if Battle.IsBattleFull then
           TextOut(5, 2, _('The battle is full, you can join but you will be spectator.')+tmpStr)
         else if Battle.RankLimit &gt; Status.Me.GetRank then
           TextOut(5, 2, _('You don''t have the rank required to join that battle. However you can still try to join it if you think you are good enough.')+tmpStr)
-        else if Battle.IsLadderBattle then
-          TextOut(5, 2, _('This is a ladder battle, you can join it. Read the help(F1) for further information.')+tmpStr)
         else
           TextOut(5, 2, 'Battle opened.'+tmpStr);
       end;
@@ -11024,10 +10889,6 @@
       groupStr := ', '+TClient(cList[realIndex]).GetGroup.Name;
     (Sender as TTntListBox).Hint := TClient(cList[realIndex]).Name + ', ' + GetCountryName(TClient(cList[realIndex]).Country)+groupStr;
 
-    // cups
-    if TClient(cList[realIndex]).CupLadderList.Count &gt; 0 then
-      (Sender as TTntListBox).Hint := (Sender as TTntListBox).Hint + ', '+Misc.JoinStringList(TClient(cList[realIndex]).CupLadderList,', ');
-
     // custom icons
     if not Preferences.ScriptsDisabled then
     for i:=0 to lobbyScriptUnit.PlayerIconTypeNames.Count-1 do
@@ -11679,16 +11540,6 @@
     HelpForm.ShowModal;
 end;
 
-procedure TMainForm.mnuSpringmarkClick(Sender: TObject);
-begin
-  Misc.OpenURLInDefaultBrowser('<A HREF="http://www.jobjol.com/springmark.html">http://www.jobjol.com/springmark.html</A>');
-end;
-
-procedure TMainForm.mnuSpringLadderClick(Sender: TObject);
-begin
-  Misc.OpenURLInDefaultBrowser('<A HREF="http://springladder.no-ip.org/">http://springladder.no-ip.org/</A>');
-end;
-
 procedure TMainForm.mnuSpringReplaysClick(Sender: TObject);
 begin
   Misc.OpenURLInDefaultBrowser('<A HREF="http://replays.adune.nl/">http://replays.adune.nl/</A>');
@@ -11719,14 +11570,6 @@
   TLobbyUpdateThread.Create(false,Preferences.AutoUpdateToBeta,True);
 end;
 
-constructor TLadder.Create(id: integer; Name: string);
-begin
-  Self.id := id;
-  Self.Name := Name;
-  Self.Restricted := TStringList.Create;
-  Self.Maps := TStringList.Create;
-end;
-
 procedure TTASClientThread.ShowLastMessage;
 begin
   MessageDlgReturn := MessageDlg(MsgT,DlgTypeT,ButtonsT,HelpCtxT);
@@ -11783,13 +11626,6 @@
     Misc.ShowAndSetFocus(BattleForm.InputEdit);
 end;
 
-procedure TMainForm.mnuHostLadderBattleClick(Sender: TObject);
-begin
-  HostButtonMenuIndex := 1;
-  BattleForm.HostButton.OnClick(nil);
-  Misc.ShowAndSetFocus(BattleForm.InputEdit);
-end;
-
 procedure TMainForm.mnuHostReplayClick(Sender: TObject);
 begin
   HostButtonMenuIndex := 2;
@@ -12040,13 +11876,6 @@
   FiltersUpdated;
 end;
 
-procedure TMainForm.LadderFilterClick(Sender: TObject);
-begin
-  if not LadderFilter.Focused then Exit;
-  CurrentFilters.Ladder := LadderFilter.Checked;
-  FiltersUpdated;
-end;
-
 procedure TMainForm.LockedFilterClick(Sender: TObject);
 begin
   if not LockedFilter.Focused then Exit;
@@ -12264,7 +12093,6 @@
     Ini.WriteString('PresetInfo','Name',Filters.Name);
     Ini.WriteBool('StaticFilters','Full',Filters.Full);
     Ini.WriteBool('StaticFilters','InProgress',Filters.InProgress);
-    Ini.WriteBool('StaticFilters','Ladder',Filters.Ladder);
     Ini.WriteBool('StaticFilters','Locked',Filters.Locked);
     Ini.WriteBool('StaticFilters','Passworded',Filters.Passworded);
     Ini.WriteBool('StaticFilters','NatTraversal',Filters.NatTraversal);
@@ -12351,7 +12179,6 @@
   Filters.Name := Ini.ReadString('PresetInfo','Name','Preset_'+IntToStr(RandomRange(1,MaxInt)));
   Filters.Full := Ini.ReadBool('StaticFilters', 'Full', True);
   Filters.InProgress := Ini.ReadBool('StaticFilters', 'InProgress', True);
-  Filters.Ladder := Ini.ReadBool('StaticFilters', 'Ladder', True);
   Filters.Locked := Ini.ReadBool('StaticFilters', 'Locked', True);
   Filters.Passworded := Ini.ReadBool('StaticFilters', 'Passworded', True);
   Filters.NatTraversal := Ini.ReadBool('StaticFilters', 'NatTraversal', True);
@@ -12470,7 +12297,6 @@
 begin
   dstFilters.Full := srcFilters.Full;
   dstFilters.InProgress := srcFilters.InProgress;
-  dstFilters.Ladder := srcFilters.Ladder;
   dstFilters.Locked := srcFilters.Locked;
   dstFilters.Passworded := srcFilters.Passworded;
   dstFilters.NatTraversal := srcFilters.NatTraversal;
@@ -12517,7 +12343,6 @@
 begin
   FullFilter.Checked := pFilters.Full;
   InProgressFilter.Checked := pFilters.InProgress;
-  LadderFilter.Checked := pFilters.Ladder;
   LockedFilter.Checked := pFilters.Locked;
   PasswordedFilter.Checked := pFilters.Passworded;
   NatTraversalFilter.Checked := pFilters.NatTraversal;
@@ -12707,139 +12532,6 @@
   end;
 end;
 
-constructor TLadderTopPlayersThread.Create(Suspended: Boolean);
-begin
-   FreeOnTerminate := True;
-   inherited Create(Suspended);
-   OnTerminate := OnTerminateProcedure;
-end;
-
-procedure TLadderTopPlayersThread.Execute;
-begin
-  if not Status.LoggedIn then
-    Exit;
-  Refresh;
-end;
-
-procedure TLadderTopPlayersThread.Refresh;
-var
-  i,j,k:integer;
-  html:string;
-  parse1 : TStrings;
-  parse2 : TStrings;
-  parse3 : TStrings;
-  tmp: ^integer;
-begin
-  parse1 := TStringList.Create;
-  parse2 := TStringList.Create;
-  parse3 := TStringList.Create;
-
-  with MainForm do
-  begin
-
-  // get the html result
-  {if Preferences.UseProxy then
-  begin
-    HttpCli2.Proxy := Preferences.ProxyAddress;
-    HttpCli2.ProxyPort := IntToStr(Preferences.ProxyPort);
-    HttpCli2.ProxyUsername := Preferences.ProxyUsername;
-    HttpCli2.ProxyPassword := Preferences.ProxyPassword
-  end
-  else }HttpCli2.Proxy := '';
-  HttpCli2.URL := LADDER_PREFIX_URL + 'top.php?minplayers=15&amp;minbattles=40&amp;fraction=0&amp;number=3';
-  HttpCli2.RcvdStream := TMemoryStream.Create;
-  try
-    HttpCli2.Get;
-  except
-    if Pos(_('Warning: Ladder server unavailable.'),(TMyTabSheet(ChatTabs[i]).FindChildControl('RichEdit') as TExRichEdit).Lines.Text) = 0 then
-      MainForm.AddMainLog(_('Warning: Ladder server unavailable.'), Colors.Normal);
-    Exit;
-  end;
-  HttpCli2.RcvdStream.Seek(0,0);
-  SetLength(html, HttpCli2.RcvdStream.Size);
-  HttpCli2.RcvdStream.ReadBuffer(Pointer(html)^, HttpCli2.RcvdStream.Size);
-  HttpCli2.RcvdStream.Free;
-
-  // clear players cups
-
-  for i:=0 to AllClients.Count-1 do
-  begin
-    TClient(AllClients[i]).CupList.Clear;
-    TClient(AllClients[i]).CupLadderList.Clear;
-  end;
-
-  // parse the html result
-  Misc.ParseDelimited(parse1,TrimRight(TrimLeft(html)),#$A,'');
-  for i:=0 to parse1.Count-1 do
-  begin
-    try
-      Misc.ParseDelimited(parse2,MidStr(parse1[i],Pos(' ',parse1[i]),MaxInt),#9,'');
-    except
-      if Pos(_('Warning: Error while parsing top players ladder page.'),(TMyTabSheet(ChatTabs[0]).FindChildControl('RichEdit') as TExRichEdit).Lines.Text) = 0 then
-        MainForm.AddMainLog(_('Warning: Error while parsing top players ladder page.'), Colors.Normal);
-      parse1.Free;
-      parse2.Free;
-      parse3.Free;
-      Exit;
-    end;
-    if parse2.Count &lt;&gt; 2 then
-    begin
-      if Pos(_('Warning: Error while parsing top players ladder page.'),(TMyTabSheet(ChatTabs[0]).FindChildControl('RichEdit') as TExRichEdit).Lines.Text) = 0 then
-        MainForm.AddMainLog(_('Warning: Error while parsing top players ladder page.'), Colors.Normal);
-      parse1.Free;
-      parse2.Free;
-      parse3.Free;
-      Exit;
-    end;
-    Misc.ParseDelimited(parse3,TrimRight(TrimLeft(parse2[1])),' ','');
-    if parse3.Count &lt;&gt; 3 then
-    begin
-      if Pos(_('Warning: Error while parsing top players ladder page.'),(TMyTabSheet(ChatTabs[0]).FindChildControl('RichEdit') as TExRichEdit).Lines.Text) = 0 then
-        MainForm.AddMainLog(_('Warning: Error while parsing top players ladder page.'), Colors.Normal);
-      parse1.Free;
-      parse2.Free;
-      parse3.Free;
-      Exit;
-    end;
-    new(tmp);
-    tmp^ := 0;
-    try
-      MainForm.GetClient(parse3[0]).CupList.Add(tmp);
-      MainForm.GetClient(parse3[0]).CupLadderList.Add(TrimRight(TrimLeft(parse2[0])));
-    except
-      //
-    end;
-    new(tmp);
-    tmp^ := 1;
-    try
-      MainForm.GetClient(parse3[1]).CupList.Add(tmp);
-      MainForm.GetClient(parse3[1]).CupLadderList.Add(parse2[0]);
-    except
-      //
-    end;
-    new(tmp);
-    tmp^ := 2;
-    try
-      MainForm.GetClient(parse3[2]).CupList.Add(tmp);
-      MainForm.GetClient(parse3[2]).CupLadderList.Add(parse2[0]);
-    except
-      //
-    end;
-    parse2.Clear;
-    parse3.Clear;
-  end;
-  Synchronize(BattleForm.VDTBattleClients.Refresh);
-  parse1.Free;
-  parse2.Free;
-  parse3.Free;
-  end;
-end;
-
-procedure TLadderTopPlayersThread.OnTerminateProcedure(Sender: TObject);
-begin
-  // nothing
-end;
-
 constructor TDownloadMapThread.Create(Suspended : Boolean;hash: integer;name: string);
 begin
    FreeOnTerminate := True;
@@ -12918,12 +12610,6 @@
   // nothing
 end;
 
-procedure TMainForm.LadderCupsRefreshTimer(Sender: TObject);
-begin
-  //if Status.LoggedIn then
-  //  TLadderTopPlayersThread.Create(false);
-end;
-
 procedure TMainForm.FilterListChecking(Sender: TBaseVirtualTree;
   Node: PVirtualNode; var NewState: TCheckState; var Allowed: Boolean);
 begin
@@ -13277,7 +12963,7 @@
   begin
     with TBattle(Battles[i]) do
     begin
-      if not IsBattleInProgress and not Password and (BattleType = 0) and not Locked and not IsBattleFull and (RankLimit &lt;= Status.Me.GetRank) and not IsLadderBattle then
+      if not IsBattleInProgress and not Password and (BattleType = 0) and not Locked and not IsBattleFull and (RankLimit &lt;= Status.Me.GetRank) then
       begin
         if (Clients.Count-SpectatorCount)/MaxPlayers &gt; ratioPlayerMaxPlayer then
         begin

Modified: Lobby/TASClient/MapListFormUnit.pas
===================================================================
--- Lobby/TASClient/MapListFormUnit.pas	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/MapListFormUnit.pas	2011-10-16 11:13:23 UTC (rev 7626)
@@ -964,8 +964,7 @@
     if TMapItem(SortedMaps[i]).MainPanel = nil then Exit; // happens when the map details loading is enabled back
 
     TMapItem(SortedMaps[i]).Visible := re.Exec(LowerCase(TMapItem(SortedMaps[i]).MapName)) and
-                                      ((Utility.ModValidMaps = nil) or (Utility.ModValidMaps.Count = 0) or (Utility.ModValidMaps.IndexOf(TMapItem(SortedMaps[i]).MapName) &gt;= 0)) and
-                                      ((BattleState.LadderIndex = -1) or (TLadder(LadderList[BattleState.LadderIndex]).Maps.IndexOf(TMapItem(SortedMaps[i]).MapName) &gt;= 0));
+                                      ((Utility.ModValidMaps = nil) or (Utility.ModValidMaps.Count = 0) or (Utility.ModValidMaps.IndexOf(TMapItem(SortedMaps[i]).MapName) &gt;= 0));
 
     if TMapItem(SortedMaps[i]).Visible then
     begin

Modified: Lobby/TASClient/PreferencesFormUnit.pas
===================================================================
--- Lobby/TASClient/PreferencesFormUnit.pas	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/PreferencesFormUnit.pas	2011-10-16 11:13:23 UTC (rev 7626)
@@ -42,7 +42,6 @@
 
     Username: string[255];
     Password: string[255];
-    LadderPassword : string;
     RememberPasswords : boolean;
 
     ConnectOnStartup: Boolean;
@@ -365,7 +364,6 @@
       Preferences.RememberPasswords := Preferences.Password &lt;&gt; '';
     end;
 
-    try Preferences.LadderPassword := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'LadderPassword'); except end;
     try Preferences.ConnectOnStartup := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'ConnectOnStartup'); except end;
     try Preferences.SortStyle := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'SortStyle'); except end;
     try Preferences.SortAsc := Misc.GetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'SortAsc'); except end;
@@ -778,12 +776,10 @@
     if Preferences.RememberPasswords then
     begin
       Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'Password', rdString, Preferences.Password);
-      Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'LadderPassword', rdString, Preferences.LadderPassword);
     end
     else
     begin
       Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'Password', rdString, '');
-      Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'LadderPassword', rdString, '');
     end;
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'RememberPasswords', rdInteger, Misc.BoolToInt(Preferences.RememberPasswords));
     Misc.SetRegistryData(HKEY_CURRENT_USER, TASCLIENT_REGISTRY_KEY+'\Preferences', 'UseLogonForm', rdInteger, Misc.BoolToInt(Preferences.UseLogonForm));

Modified: Lobby/TASClient/ProgressBarWindow.pas
===================================================================
--- Lobby/TASClient/ProgressBarWindow.pas	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/ProgressBarWindow.pas	2011-10-16 11:13:23 UTC (rev 7626)
@@ -19,7 +19,6 @@
     procedure FormCreate(Sender: TObject);
   private
     ThreadUp :TUploadThread;
-    ThreadLadderUp : TUploadLadderDataThread;
   public
     TakeAction : byte;
   end;
@@ -42,11 +41,6 @@
   if TakeAction = 1 then begin
     ProgressBarForm.SpTBXTitleBar1.Caption := _('Uploading your replay ...');
     ThreadUp := TUploadThread.Create(False);
-  end
-  else if TakeAction = 2 then begin
-    ProgressBarForm.SpTBXTitleBar1.Caption := _('Uploading ladder report ...');
-    ThreadLadderUp := TUploadLadderDataThread.Create(False);
-    CancelButton.Enabled := False;
   end;
 end;
 

Modified: Lobby/TASClient/TASClient.dof
===================================================================
--- Lobby/TASClient/TASClient.dof	2011-10-15 15:48:45 UTC (rev 7625)
+++ Lobby/TASClient/TASClient.dof	2011-10-16 11:13:23 UTC (rev 7626)
@@ -115,7 +115,7 @@
 MajorVer=0
 MinorVer=93
 Release=0
-Build=1332
+Build=1333
 Debug=0
 PreRelease=0
 Special=0
@@ -126,7 +126,7 @@
 [Version Info Keys]
 CompanyName=
 FileDescription=Spring RTS Engine lobby client
-FileVersion=0.93.0.1332
+FileVersion=0.93.0.1333
 InternalName=
 LegalCopyright=
 LegalTrademarks=

Modified: Lobby/TASClient/TASClient.res
===================================================================
(Binary files differ)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002395.html">[Taspring-linux-commit] r7625 - Lobby/TASClient
</A></li>
	<LI>Next message: <A HREF="002397.html">[Taspring-linux-commit] r7627 - Lobby/TASClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2396">[ date ]</a>
              <a href="thread.html#2396">[ thread ]</a>
              <a href="subject.html#2396">[ subject ]</a>
              <a href="author.html#2396">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
