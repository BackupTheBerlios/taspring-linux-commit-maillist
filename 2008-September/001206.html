<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Taspring-linux-commit] r6436 - in trunk/rts: Game Lua Map	Map/SM3/terrain Sim/Features Sim/Misc Sim/MoveTypes	Sim/Projectiles Sim/Units/CommandAI System	System/Platform/Win lib/gml
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/taspring-linux-commit/2008-September/index.html" >
   <LINK REL="made" HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6436%20-%20in%20trunk/rts%3A%20Game%20Lua%20Map%0A%09Map/SM3/terrain%20Sim/Features%20Sim/Misc%20Sim/MoveTypes%0A%09Sim/Projectiles%20Sim/Units/CommandAI%20System%0A%09System/Platform/Win%20lib/gml&In-Reply-To=%3C20080918175848.1E4104581%40progate.clan-sy.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001205.html">
   <LINK REL="Next"  HREF="001207.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Taspring-linux-commit] r6436 - in trunk/rts: Game Lua Map	Map/SM3/terrain Sim/Features Sim/Misc Sim/MoveTypes	Sim/Projectiles Sim/Units/CommandAI System	System/Platform/Win lib/gml</H1>
    <B>taspring-linux-commit at lists.berlios.de</B> 
    <A HREF="mailto:taspring-linux-commit%40lists.berlios.de?Subject=Re%3A%20%5BTaspring-linux-commit%5D%20r6436%20-%20in%20trunk/rts%3A%20Game%20Lua%20Map%0A%09Map/SM3/terrain%20Sim/Features%20Sim/Misc%20Sim/MoveTypes%0A%09Sim/Projectiles%20Sim/Units/CommandAI%20System%0A%09System/Platform/Win%20lib/gml&In-Reply-To=%3C20080918175848.1E4104581%40progate.clan-sy.com%3E"
       TITLE="[Taspring-linux-commit] r6436 - in trunk/rts: Game Lua Map	Map/SM3/terrain Sim/Features Sim/Misc Sim/MoveTypes	Sim/Projectiles Sim/Units/CommandAI System	System/Platform/Win lib/gml">taspring-linux-commit at lists.berlios.de
       </A><BR>
    <I>Thu Sep 18 19:58:47 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001205.html">[Taspring-linux-commit] r6435 - in trunk: . AI rts rts/Game	rts/System tools/DedicatedServer tools/unitsync
</A></li>
        <LI>Next message: <A HREF="001207.html">[Taspring-linux-commit] r6437 - in trunk: . AI rts/build/cmake	rts/lib rts/lib/streflop tools/DedicatedServer tools/unitsync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1206">[ date ]</a>
              <a href="thread.html#1206">[ thread ]</a>
              <a href="subject.html#1206">[ subject ]</a>
              <a href="author.html#1206">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: zerver
Date: 2008-09-18 19:58:46 +0200 (Thu, 18 Sep 2008)
New Revision: 6436

Modified:
   trunk/rts/Game/Action.cpp
   trunk/rts/Game/GameVersion.cpp
   trunk/rts/Game/PlayerBase.cpp
   trunk/rts/Game/PlayerRoster.cpp
   trunk/rts/Game/WaitCommandsAI.cpp
   trunk/rts/Lua/LuaOpenGL.cpp
   trunk/rts/Lua/LuaRules.cpp
   trunk/rts/Map/Ground.cpp
   trunk/rts/Map/SM3/terrain/Lightcalc.cpp
   trunk/rts/Map/SM3/terrain/QuadRenderData.cpp
   trunk/rts/Map/SM3/terrain/Terrain.cpp
   trunk/rts/Map/SM3/terrain/TerrainTexEnvCombine.cpp
   trunk/rts/Map/SM3/terrain/TerrainTextureGLSL.cpp
   trunk/rts/Sim/Features/Feature.cpp
   trunk/rts/Sim/Misc/LosHandler.h
   trunk/rts/Sim/Misc/RadarHandler.h
   trunk/rts/Sim/MoveTypes/MoveType.cpp
   trunk/rts/Sim/Projectiles/ExplosionGenerator.cpp
   trunk/rts/Sim/Units/CommandAI/AirCAI.cpp
   trunk/rts/Sim/Units/CommandAI/BuilderCAI.cpp
   trunk/rts/Sim/Units/CommandAI/CommandAI.cpp
   trunk/rts/Sim/Units/CommandAI/MobileCAI.cpp
   trunk/rts/System/GlobalStuff.cpp
   trunk/rts/System/Platform/Win/WinFileSystemHandler.cpp
   trunk/rts/System/Platform/Win/WinVersion.cpp
   trunk/rts/lib/gml/gml.cpp
Log:
Fixed serious bug in CMobileCAI::RefuelIfNeeded.
Added #include assert and #include stdafx to a some files.

Modified: trunk/rts/Game/Action.cpp
===================================================================
--- trunk/rts/Game/Action.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Game/Action.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -1,3 +1,4 @@
+#include &quot;StdAfx.h&quot;
 #include &lt;vector&gt;
 #include &lt;algorithm&gt;
 

Modified: trunk/rts/Game/GameVersion.cpp
===================================================================
--- trunk/rts/Game/GameVersion.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Game/GameVersion.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -4,6 +4,7 @@
 	file to append the version string with the SVN revision number.
 */
 
+#include &quot;StdAfx.h&quot;
 #include &quot;GameVersion.h&quot;
 
 /** The game version. */

Modified: trunk/rts/Game/PlayerBase.cpp
===================================================================
--- trunk/rts/Game/PlayerBase.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Game/PlayerBase.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -1,3 +1,4 @@
+#include &quot;StdAfx.h&quot;
 #include &quot;PlayerBase.h&quot;
 
 

Modified: trunk/rts/Game/PlayerRoster.cpp
===================================================================
--- trunk/rts/Game/PlayerRoster.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Game/PlayerRoster.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -8,6 +8,7 @@
 #include &quot;PlayerRoster.h&quot;
 #include &quot;Player.h&quot;
 #include &quot;Team.h&quot;
+#include &lt;assert.h&gt;
 
 static int CompareAllies     (const void* a, const void* b);
 static int CompareTeamIDs    (const void* a, const void* b);

Modified: trunk/rts/Game/WaitCommandsAI.cpp
===================================================================
--- trunk/rts/Game/WaitCommandsAI.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Game/WaitCommandsAI.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -24,8 +24,8 @@
 #include &quot;UI/CursorIcons.h&quot;
 #include &quot;creg/STL_Map.h&quot;
 #include &quot;creg/STL_List.h&quot;
+#include &lt;assert.h&gt;
 
-
 CWaitCommandsAI waitCommandsAI;
 
 

Modified: trunk/rts/Lua/LuaOpenGL.cpp
===================================================================
--- trunk/rts/Lua/LuaOpenGL.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Lua/LuaOpenGL.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -1592,6 +1592,7 @@
 		} else {
 			int tmpLod = lua_toint(L, 3);
 			if (tmpLod &lt; 0) {
+				lod = 0;
 				useLOD = false;
 			} else {
 				lod = std::min(unit-&gt;lodCount - 1, (unsigned int)tmpLod);

Modified: trunk/rts/Lua/LuaRules.cpp
===================================================================
--- trunk/rts/Lua/LuaRules.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Lua/LuaRules.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -39,8 +39,8 @@
 #include &quot;System/LogOutput.h&quot;
 #include &quot;System/FileSystem/FileHandler.h&quot;
 #include &quot;System/Platform/FileSystem.h&quot;
+#include &lt;assert.h&gt;
 
-
 CLuaRules* luaRules = NULL;
 
 string CLuaRules::configString;

Modified: trunk/rts/Map/Ground.cpp
===================================================================
--- trunk/rts/Map/Ground.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Map/Ground.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -12,6 +12,7 @@
 #include &quot;Sim/Projectiles/Projectile.h&quot;
 #include &quot;LogOutput.h&quot;
 #include &quot;Sim/Misc/GeometricObjects.h&quot;
+#include &lt;assert.h&gt;
 
 //////////////////////////////////////////////////////////////////////
 // Construction/Destruction

Modified: trunk/rts/Map/SM3/terrain/Lightcalc.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/Lightcalc.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Map/SM3/terrain/Lightcalc.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -37,6 +37,7 @@
 
 #include &lt;SDL.h&gt;
 #include &lt;IL/il.h&gt;
+#include &lt;assert.h&gt;
 
 namespace terrain {
 

Modified: trunk/rts/Map/SM3/terrain/QuadRenderData.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/QuadRenderData.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Map/SM3/terrain/QuadRenderData.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -33,6 +33,7 @@
 #include &quot;TerrainBase.h&quot;
 #include &quot;TerrainNode.h&quot;
 #include &quot;TerrainTexture.h&quot;
+#include &lt;assert.h&gt;
 
 namespace terrain {
 	using namespace std;

Modified: trunk/rts/Map/SM3/terrain/Terrain.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/Terrain.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Map/SM3/terrain/Terrain.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -43,6 +43,7 @@
 #include &quot;TerrainTexture.h&quot;
 #include &quot;TerrainNode.h&quot;
 #include &quot;FileSystem/FileHandler.h&quot;
+#include &lt;assert.h&gt;
 
 // define this for big endian machines
 //#define SWAP_SHORT

Modified: trunk/rts/Map/SM3/terrain/TerrainTexEnvCombine.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/TerrainTexEnvCombine.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Map/SM3/terrain/TerrainTexEnvCombine.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -32,6 +32,7 @@
 
 #include &quot;TerrainTexture.h&quot;
 #include &quot;TerrainTexEnvCombine.h&quot;
+#include &lt;assert.h&gt;
 
 namespace terrain {
 

Modified: trunk/rts/Map/SM3/terrain/TerrainTextureGLSL.cpp
===================================================================
--- trunk/rts/Map/SM3/terrain/TerrainTextureGLSL.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Map/SM3/terrain/TerrainTextureGLSL.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -40,6 +40,7 @@
 
 #include &lt;fstream&gt;
 #include &lt;list&gt;
+#include &lt;assert.h&gt;
 
 namespace terrain {
 using namespace std;

Modified: trunk/rts/Sim/Features/Feature.cpp
===================================================================
--- trunk/rts/Sim/Features/Feature.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Sim/Features/Feature.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -24,6 +24,7 @@
 #include &quot;Sim/Projectiles/Unsynced/SmokeProjectile.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
+#include &lt;assert.h&gt;
 
 CR_BIND_DERIVED(CFeature, CSolidObject, )
 

Modified: trunk/rts/Sim/Misc/LosHandler.h
===================================================================
--- trunk/rts/Sim/Misc/LosHandler.h	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Sim/Misc/LosHandler.h	2008-09-18 17:58:46 UTC (rev 6436)
@@ -13,6 +13,7 @@
 #include &quot;Sim/Objects/WorldObject.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;RadarHandler.h&quot;
+#include &lt;assert.h&gt;
 
 #define MAX_LOS_TABLE 110
 

Modified: trunk/rts/Sim/Misc/RadarHandler.h
===================================================================
--- trunk/rts/Sim/Misc/RadarHandler.h	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Sim/Misc/RadarHandler.h	2008-09-18 17:58:46 UTC (rev 6436)
@@ -5,8 +5,8 @@
 
 #include &quot;Object.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
+#include &lt;assert.h&gt;
 
-
 #define RADAR_SIZE 8
 
 

Modified: trunk/rts/Sim/MoveTypes/MoveType.cpp
===================================================================
--- trunk/rts/Sim/MoveTypes/MoveType.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Sim/MoveTypes/MoveType.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -5,6 +5,7 @@
 #include &quot;Map/Ground.h&quot;
 #include &quot;Sim/Units/Unit.h&quot;
 #include &quot;Sim/Units/UnitDef.h&quot;
+#include &lt;assert.h&gt;
 
 CR_BIND_DERIVED_INTERFACE(AMoveType, CObject);
 

Modified: trunk/rts/Sim/Projectiles/ExplosionGenerator.cpp
===================================================================
--- trunk/rts/Sim/Projectiles/ExplosionGenerator.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Sim/Projectiles/ExplosionGenerator.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -23,6 +23,7 @@
 #include &quot;Sim/Projectiles/Unsynced/SpherePartProjectile.h&quot;
 #include &quot;Sim/Projectiles/Unsynced/WakeProjectile.h&quot;
 #include &quot;Sim/Projectiles/Unsynced/WreckProjectile.h&quot;
+#include &lt;assert.h&gt;
 
 using std::min;
 using std::max;

Modified: trunk/rts/Sim/Units/CommandAI/AirCAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/AirCAI.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Sim/Units/CommandAI/AirCAI.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -17,7 +17,9 @@
 #include &quot;Sim/Weapons/WeaponDefHandler.h&quot;
 #include &quot;System/myMath.h&quot;
 #include &quot;System/LogOutput.h&quot;
+#include &lt;assert.h&gt;
 
+
 CR_BIND_DERIVED(CAirCAI,CMobileCAI , );
 
 CR_REG_METADATA(CAirCAI, (

Modified: trunk/rts/Sim/Units/CommandAI/BuilderCAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/BuilderCAI.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Sim/Units/CommandAI/BuilderCAI.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -33,6 +33,7 @@
 #include &quot;Sim/Units/UnitTypes/TransportUnit.h&quot;
 #include &quot;myMath.h&quot;
 #include &quot;creg/STL_Map.h&quot;
+#include &lt;assert.h&gt;
 
 
 CR_BIND_DERIVED(CBuilderCAI ,CMobileCAI , );

Modified: trunk/rts/Sim/Units/CommandAI/CommandAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/CommandAI.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Sim/Units/CommandAI/CommandAI.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -31,6 +31,7 @@
 #include &quot;myMath.h&quot;
 #include &quot;creg/STL_Set.h&quot;
 #include &quot;creg/STL_Deque.h&quot;
+#include &lt;assert.h&gt;
 
 #define TARGET_LOST_TIMER 120	// in calls to SlowUpdate() (approx. once every second)
 

Modified: trunk/rts/Sim/Units/CommandAI/MobileCAI.cpp
===================================================================
--- trunk/rts/Sim/Units/CommandAI/MobileCAI.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/Sim/Units/CommandAI/MobileCAI.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -23,6 +23,7 @@
 #include &quot;Sim/Weapons/DGunWeapon.h&quot;
 #include &quot;System/LogOutput.h&quot;
 #include &quot;myMath.h&quot;
+#include &lt;assert.h&gt;
 
 CR_BIND_DERIVED(CMobileCAI ,CCommandAI , );
 
@@ -289,9 +290,8 @@
 				}
 			}
 		} else if(owner-&gt;currentFuel &lt;
-				(owner-&gt;moveType-&gt;repairBelowHealth * owner-&gt;unitDef-&gt;maxFuel)
-				&amp;&amp; commandQue.empty() || commandQue.front().id == CMD_PATROL
-				|| commandQue.front().id == CMD_FIGHT) {
+				(owner-&gt;moveType-&gt;repairBelowHealth * owner-&gt;unitDef-&gt;maxFuel) &amp;&amp; 
+				(commandQue.empty() || commandQue.front().id == CMD_PATROL || commandQue.front().id == CMD_FIGHT)) {
 			CAirBaseHandler::LandingPad* lp =
 				airBaseHandler-&gt;FindAirBase(owner, owner-&gt;unitDef-&gt;minAirBasePower);
 			if(lp) {

Modified: trunk/rts/System/GlobalStuff.cpp
===================================================================
--- trunk/rts/System/GlobalStuff.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/System/GlobalStuff.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -19,6 +19,7 @@
 #include &quot;Lua/LuaRules.h&quot;
 #include &quot;SDL_types.h&quot;
 #include &quot;SDL_timer.h&quot;
+#include &lt;assert.h&gt;
 
 /**
  * @brief global synced

Modified: trunk/rts/System/Platform/Win/WinFileSystemHandler.cpp
===================================================================
--- trunk/rts/System/Platform/Win/WinFileSystemHandler.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/System/Platform/Win/WinFileSystemHandler.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -1 +1,2 @@
+#include &quot;StdAfx.h&quot;
 #include &quot;Platform/Linux/UnixFileSystemHandler.cpp&quot;

Modified: trunk/rts/System/Platform/Win/WinVersion.cpp
===================================================================
--- trunk/rts/System/Platform/Win/WinVersion.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/System/Platform/Win/WinVersion.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -1,3 +1,4 @@
+#include &quot;StdAfx.h&quot;
 #include &lt;sstream&gt;
 #include &lt;string&gt;
 

Modified: trunk/rts/lib/gml/gml.cpp
===================================================================
--- trunk/rts/lib/gml/gml.cpp	2008-09-18 11:36:19 UTC (rev 6435)
+++ trunk/rts/lib/gml/gml.cpp	2008-09-18 17:58:46 UTC (rev 6436)
@@ -31,8 +31,8 @@
 // Please note: Some functions may require more advanced coding to implement
 // If a function is not yet supported by GML, a compile error pointing to 'GML_FUNCTION_NOT_IMPLEMENTED' will occur
 
+#include &quot;StdAfx.h&quot;
 #ifdef USE_GML
-#include &quot;StdAfx.h&quot;
 #include &quot;gmlcls.h&quot;
 
 #define EXEC_RUN (BYTE *)NULL


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001205.html">[Taspring-linux-commit] r6435 - in trunk: . AI rts rts/Game	rts/System tools/DedicatedServer tools/unitsync
</A></li>
	<LI>Next message: <A HREF="001207.html">[Taspring-linux-commit] r6437 - in trunk: . AI rts/build/cmake	rts/lib rts/lib/streflop tools/DedicatedServer tools/unitsync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1206">[ date ]</a>
              <a href="thread.html#1206">[ thread ]</a>
              <a href="subject.html#1206">[ subject ]</a>
              <a href="author.html#1206">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/taspring-linux-commit">More information about the Taspring-linux-commit
mailing list</a><br>
</body></html>
